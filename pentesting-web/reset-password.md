# Bypass de Redefini√ß√£o/Recupera√ß√£o de Senha

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de recompensas por bugs!

**Percep√ß√µes de Hacking**\
Envolver-se com conte√∫do que mergulha na emo√ß√£o e desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e percep√ß√µes em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os mais recentes programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais na plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

## **Vazamento de Token de Redefini√ß√£o de Senha via Referer**

* O cabe√ßalho HTTP referer pode vazar o token de redefini√ß√£o de senha se estiver inclu√≠do na URL. Isso pode ocorrer quando um usu√°rio clica em um link de um site de terceiros ap√≥s solicitar uma redefini√ß√£o de senha.
* **Impacto**: Poss√≠vel tomada de conta da conta via ataques de Cross-Site Request Forgery (CSRF).
* **Explora√ß√£o**: Para verificar se um token de redefini√ß√£o de senha est√° vazando no cabe√ßalho referer, **solicite uma redefini√ß√£o de senha** para o seu endere√ßo de e-mail e **clique no link de redefini√ß√£o** fornecido. **N√£o altere sua senha** imediatamente. Em vez disso, **navegue para um site de terceiros** (como Facebook ou Twitter) enquanto **intercepta as solicita√ß√µes usando o Burp Suite**. Inspecione as solicita√ß√µes para ver se o **cabe√ßalho referer cont√©m o token de redefini√ß√£o de senha**, pois isso poderia expor informa√ß√µes sens√≠veis a terceiros.
* **Refer√™ncias**:
* [Relat√≥rio HackerOne 342693](https://hackerone.com/reports/342693)
* [Relat√≥rio HackerOne 272379](https://hackerone.com/reports/272379)
* [Artigo de Vazamento de Token de Redefini√ß√£o de Senha](https://medium.com/@rubiojhayz1234/toyotas-password-reset-token-and-email-address-leak-via-referer-header-b0ede6507c6a)

## **Envenenamento de Redefini√ß√£o de Senha**

* Os atacantes podem manipular o cabe√ßalho Host durante as solicita√ß√µes de redefini√ß√£o de senha para apontar o link de redefini√ß√£o para um site malicioso.
* **Impacto**: Leva √† poss√≠vel tomada de conta vazando tokens de redefini√ß√£o para os atacantes.
* **Passos de Mitiga√ß√£o**:
* Valide o cabe√ßalho Host contra uma lista branca de dom√≠nios permitidos.
* Use m√©todos seguros e do lado do servidor para gerar URLs absolutos.
* **Corre√ß√£o**: Use `$_SERVER['SERVER_NAME']` para construir URLs de redefini√ß√£o de senha em vez de `$_SERVER['HTTP_HOST']`.
* **Refer√™ncias**:
* [Artigo da Acunetix sobre Envenenamento de Redefini√ß√£o de Senha](https://www.acunetix.com/blog/articles/password-reset-poisoning/)

## **Redefini√ß√£o de Senha Manipulando o Par√¢metro de E-mail**

Os atacantes podem manipular a solicita√ß√£o de redefini√ß√£o de senha adicionando par√¢metros de e-mail adicionais para desviar o link de redefini√ß√£o.

* Adicione o e-mail do atacante como segundo par√¢metro usando &
```php
POST /resetPassword
[...]
email=victim@email.com&email=attacker@email.com
```
* Adicione o email do atacante como segundo par√¢metro usando %20
```php
POST /resetPassword
[...]
email=victim@email.com%20email=attacker@email.com
```
* Adicione o email do atacante como segundo par√¢metro usando |
```php
POST /resetPassword
[...]
email=victim@email.com|email=attacker@email.com
```
* Adicione o email do atacante como segundo par√¢metro usando cc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dcc:attacker@mail.tld"
```
* Adicione o email do atacante como segundo par√¢metro usando bcc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dbcc:attacker@mail.tld"
```
* Adicione o email do atacante como segundo par√¢metro usando ,
```php
POST /resetPassword
[...]
email="victim@mail.tld",email="attacker@mail.tld"
```
* Adicione o email do atacante como segundo par√¢metro no array json
```php
POST /resetPassword
[...]
{"email":["victim@mail.tld","atracker@mail.tld"]}
```
* **Passos de Mitiga√ß√£o**:
* Analisar e validar corretamente os par√¢metros de email no servidor.
* Utilizar declara√ß√µes preparadas ou consultas parametrizadas para prevenir ataques de inje√ß√£o.
* **Refer√™ncias**:
* [https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be](https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be)
* [https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/](https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/)
* [https://twitter.com/HusseiN98D/status/1254888748216655872](https://twitter.com/HusseiN98D/status/1254888748216655872)

## **Alterando Email e Senha de Qualquer Usu√°rio atrav√©s dos Par√¢metros da API**

* Os atacantes podem modificar os par√¢metros de email e senha em solicita√ß√µes de API para alterar as credenciais da conta.
```php
POST /api/changepass
[...]
("form": {"email":"victim@email.tld","password":"12345678"})
```
* **Passos de Mitiga√ß√£o**:
* Garantir valida√ß√£o rigorosa de par√¢metros e verifica√ß√µes de autentica√ß√£o.
* Implementar registro e monitoramento robustos para detectar e responder a atividades suspeitas.
* **Refer√™ncia**:
* [Assumir Controle Total da Conta via Manipula√ß√£o de Par√¢metros da API](https://medium.com/@adeshkolte/full-account-takeover-changing-email-and-password-of-any-user-through-api-parameters-3d527ab27240)

## **Sem Limite de Taxa: Bombardeio de E-mails**

* A falta de limita√ß√£o de taxa em solicita√ß√µes de redefini√ß√£o de senha pode levar a um bombardeio de e-mails, sobrecarregando o usu√°rio com e-mails de redefini√ß√£o.
* **Passos de Mitiga√ß√£o**:
* Implementar limita√ß√£o de taxa com base no endere√ßo IP ou na conta do usu√°rio.
* Utilizar desafios CAPTCHA para prevenir abusos automatizados.
* **Refer√™ncias**:
* [Relat√≥rio HackerOne 280534](https://hackerone.com/reports/280534)

## **Descobrir Como o Token de Redefini√ß√£o de Senha √© Gerado**

* Compreender o padr√£o ou m√©todo por tr√°s da gera√ß√£o de tokens pode levar √† previs√£o ou for√ßa bruta de tokens. Algumas op√ß√µes:
* Com base no Timestamp
* Com base no ID do Usu√°rio
* Com base no e-mail do Usu√°rio
* Com base no Nome e Sobrenome
* Com base na Data de Nascimento
* Com base em Criptografia
* **Passos de Mitiga√ß√£o**:
* Utilizar m√©todos criptogr√°ficos fortes para a gera√ß√£o de tokens.
* Garantir aleatoriedade e comprimento suficientes para evitar previsibilidade.
* **Ferramentas**: Utilizar o Burp Sequencer para analisar a aleatoriedade dos tokens.

## **UUID Adivinh√°vel**

* Se os UUIDs (vers√£o 1) forem adivinh√°veis ou previs√≠veis, os atacantes podem for√ß√°-los para gerar tokens de redefini√ß√£o v√°lidos. Verificar:

{% content-ref url="uuid-insecurities.md" %}
[uuid-insecurities.md](uuid-insecurities.md)
{% endcontent-ref %}

* **Passos de Mitiga√ß√£o**:
* Utilizar GUID vers√£o 4 para aleatoriedade ou implementar medidas de seguran√ßa adicionais para outras vers√µes.
* **Ferramentas**: Utilizar [guidtool](https://github.com/intruder-io/guidtool) para analisar e gerar GUIDs.

## **Manipula√ß√£o de Resposta: Substituir Resposta Ruim por Boa**

* Manipular respostas HTTP para contornar mensagens de erro ou restri√ß√µes.
* **Passos de Mitiga√ß√£o**:
* Implementar verifica√ß√µes no lado do servidor para garantir a integridade da resposta.
* Utilizar canais de comunica√ß√£o seguros como HTTPS para prevenir ataques de homem no meio.
* **Refer√™ncia**:
* [Bug Cr√≠tico em Evento de Ca√ßa ao Bug ao Vivo](https://medium.com/@innocenthacker/how-i-found-the-most-critical-bug-in-live-bug-bounty-event-7a88b3aa97b3)

## **Utilizando Token Expirado**

* Testar se tokens expirados ainda podem ser usados para redefini√ß√£o de senha.
* **Passos de Mitiga√ß√£o**:
* Implementar pol√≠ticas estritas de expira√ß√£o de token e validar a expira√ß√£o do token no lado do servidor.

## **For√ßa Bruta no Token de Redefini√ß√£o de Senha**

* Tentativa de for√ßa bruta no token de redefini√ß√£o usando ferramentas como Burpsuite e IP-Rotator para contornar limites de taxa baseados em IP.
* **Passos de Mitiga√ß√£o**:
* Implementar mecanismos robustos de limita√ß√£o de taxa e bloqueio de conta.
* Monitorar atividades suspeitas indicativas de ataques de for√ßa bruta.

## **Tentar Usar Seu Token**

* Testar se o token de redefini√ß√£o de senha de um atacante pode ser usado em conjunto com o e-mail da v√≠tima.
* **Passos de Mitiga√ß√£o**:
* Garantir que os tokens estejam vinculados √† sess√£o do usu√°rio ou a outros atributos espec√≠ficos do usu√°rio.

## **Invalida√ß√£o de Sess√£o em Logout/Redefini√ß√£o de Senha**

* Garantir que as sess√µes sejam invalidadas quando um usu√°rio faz logout ou redefine sua senha.
* **Passos de Mitiga√ß√£o**:
* Implementar gerenciamento adequado de sess√µes, garantindo que todas as sess√µes sejam invalidadas ao fazer logout ou redefinir a senha.

## **Invalida√ß√£o de Sess√£o em Logout/Redefini√ß√£o de Senha**

* Os tokens de redefini√ß√£o devem ter um tempo de expira√ß√£o ap√≥s o qual se tornam inv√°lidos.
* **Passos de Mitiga√ß√£o**:
* Definir um tempo de expira√ß√£o razo√°vel para os tokens de redefini√ß√£o e aplic√°-lo estritamente no lado do servidor.

## Refer√™ncias

* [https://anugrahsr.github.io/posts/10-Password-reset-flaws/#10-try-using-your-token](https://anugrahsr.github.io/posts/10-Password-reset-flaws/#10-try-using-your-token)

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de bugs!

**Percep√ß√µes de Hacking**\
Engaje-se com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os novos programas de recompensas por bugs lan√ßados e atualiza√ß√µes cruciais na plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
