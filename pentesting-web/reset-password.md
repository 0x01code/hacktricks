# パスワードリセット/忘れたパスワードのバイパス

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong>でAWSハッキングをゼロからヒーローまで学ぶ</summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝したい**または**HackTricksをPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスウォッグ**](https://peass.creator-spring.com)を入手
- 独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションである[**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見
- **Discordグループ**に参加して[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)経験豊富なハッカーやバグバウンティハンターとコミュニケーションを取る！

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

経験豊富なハッカーやバグバウンティハンターとコミュニケーションを取るために[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)サーバーに参加しましょう！

**ハッキングの洞察**\
ハッキングのスリルとチャレンジに深く入り込むコンテンツに参加

**リアルタイムハックニュース**\
リアルタイムのニュースと洞察を通じてハッキングの世界を最新の状態に保つ

**最新のアナウンス**\
最新のバグバウンティの開始や重要なプラットフォームの更新について情報を得る

**Discord**に参加して、今日からトップハッカーと協力を始めましょう！

## **リファラー経由のパスワードリセットトークン漏洩**
* HTTPリファラーヘッダーにパスワードリセットトークンが含まれている場合、URLに漏洩する可能性があります。これは、ユーザーがパスワードリセットをリクエストした後にサードパーティのウェブサイトリンクをクリックした場合に発生する可能性があります。
* **影響**: クロスサイトリクエストフォージェリ（CSRF）攻撃による潜在的なアカウント乗っ取り。
* **参考**:
- [HackerOne Report 342693](https://hackerone.com/reports/342693)
- [HackerOne Report 272379](https://hackerone.com/reports/272379)
- [パスワードリセットトークン漏洩記事](https://medium.com/@rubiojhayz1234/toyotas-password-reset-token-and-email-address-leak-via-referer-header-b0ede6507c6a)

## **パスワードリセットポイズニング**
* 攻撃者は、パスワードリセットリクエスト中にホストヘッダーを操作して、リセットリンクを悪意のあるサイトに向けることがあります。
* **パッチ**: `$_SERVER['HTTP_HOST']`の代わりに`$_SERVER['SERVER_NAME']`を使用してパスワードリセットURLを構築します。
* **影響**: リセットトークンが攻撃者に漏洩してアカウント乗っ取りにつながります。
* **緩和手順**:
- ホストヘッダーを許可されたドメインのホワイトリストと照合します。
- 予測不可能性を防ぐために、セキュアでサーバーサイドの方法を使用して絶対URLを生成します。
* **参考**:
- [Acunetixによるパスワードリセットポイズニングの記事](https://www.acunetix.com/blog/articles/password-reset-poisoning/)

## **Emailパラメータの操作によるパスワードリセット**
* 攻撃者は、リセットリンクを逸らすために追加のメールパラメータをパスワードリセットリクエストに操作することができます。
* **緩和手順**:
- サーバーサイドでメールパラメータを適切に解析および検証します。
- インジェクション攻撃を防ぐために、準備されたステートメントまたはパラメータ化されたクエリを使用します。
* **参考**:
- [Readme.comアカウント乗っ取り](https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be)

## **APIパラメータを操作して任意のユーザーのメールアドレスとパスワードを変更**
* 攻撃者は、APIリクエスト中のメールアドレスとパスワードパラメータを変更してアカウント資格情報を変更することができます。
* **緩和手順**:
- 厳格なパラメータ検証と認証チェックを確保します。
- 不審なアクティビティを検出および対応するための堅牢なログ記録と監視を実装します。
* **参考**:
- [APIパラメータ操作による完全なアカウント乗っ取り](https://medium.com/@adeshkolte/full-account-takeover-changing-email-and-password-of-any-user-through-api-parameters-3d527ab27240)

## **レート制限なし: メールボミング**
* パスワードリセットリクエストのレート制限がないと、ユーザーがリセットメールで圧倒される可能性があります。
* **緩和手順**:
- IPアドレスまたはユーザーアカウントに基づいたレート制限を実装します。
- 自動化された悪用を防ぐためにCAPTCHAチャレンジを使用します。
* **参考**:
- [HackerOne Report 280534](https://hackerone.com/reports/280534)

## **パスワードリセットトークンの生成方法を特定する**
* トークン生成のパターンや方法を理解することで、トークンの予測やブルートフォース攻撃が可能になります。
* **緩和手順**:
- 予測不可能性を防ぐために強力な暗号化方法を使用します。
- 予測不可能性を防ぐために十分なランダム性と長さを確保します。
* **ツール**: トークンのランダム性を分析するためにBurp Sequencerを使用します。

## **推測可能なGUID**
* GUID（例：バージョン1）が推測可能または予測可能な場合、攻撃者は有効なリセットトークンを生成するためにそれらをブルートフォースする可能性があります。
* **緩和手順**:
- ランダム性のためにGUIDバージョン4を使用するか、他のバージョンに対して追加のセキュリティ対策を実装します。
* **ツール**: GUIDの分析および生成に[guidtool](https://github.com/intruder-io/guidtool)を使用します。

## **レスポンス操作: 悪いレスポンスを良いものに置き換える**
* HTTPレスポンスを操作してエラーメッセージや制限をバイパスします。
* **緩和手順**:
- 応答の整合性を確保するためにサーバーサイドのチェックを実装します。
- 中間者攻撃を防ぐためにHTTPSなどの安全な通信チャネルを使用します。
* **参考**:
- [ライブバグバウンティイベントでの致命的なバグ](https://medium.com/@innocenthacker/how-i-found-the-most-critical-bug-in-live-bug-bounty-event-7a88b3aa97b3)

## **期限切れトークンの使用**
* 期限切れのトークンがまだパスワードリセットに使用できるかどうかをテストします。
* **緩和手順**:
- 厳格なトークン有効期限ポリシーを実装し、サーバーサイドでトークンの有効期限を検証します。

## **ブルートフォースパスワードリセットトークン**
* リセットトークンをブルートフォース攻撃する試みは、IPベースのレート制限をバイパスするためにBurpsuiteやIP-Rotatorなどのツールを使用します。
* **緩和手順**:
- 強固なレート制限およびアカウントロックアウトメカニズムを実装します。
- ブルートフォース攻撃を示す不審なアクティビティを監視します。

## **あなたのトークンを使用してみてください**
* 攻撃者のリセットトークンが被害者のメールと一緒に使用できるかどうかをテストします。
* **緩和手順**:
- トークンがユーザーセッションや他のユーザー固有の属性にバインドされていることを確認します。

## **ログアウト/パスワードリセット時のセッション無効化**
* ユーザーがログアウトしたりパスワードをリセットしたときにセッションが無効になっていることを確認します。
* **緩和手順**:
- ログアウトまたはパスワードリセット時にすべてのセッションが無効になるように適切なセッション管理を実装します。

## **ログアウト/パスワードリセット時のセッション無効化**
* リセットトークンには、無効になる期限時間を設定する必要があります。
* **緩和手順**:
- リセットトークンのために合理的な有効期限を設定し、サーバーサイドで厳密に強制します。

# 参考文献
* [https://anugrahsr.github.io/posts/10-Password-reset-flaws/#10-try-using-your-token](https://anugrahsr.github.io/posts/10-Password-reset-flaws/#10-try-using-your-token)

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

経験豊富なハッカーやバグバウンティハンターとコミュニケーションを取るために[**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy)サーバーに参加しましょう！

**ハッキングの洞察**\
ハッキングのスリルとチャレンジに深く入り込むコンテンツに参加

**リアルタイムハックニュース**\
リアルタイムのニュースと洞察を通じてハッキングの世界を最新の状態に保つ

**最新のアナウンス**\
最新のバグバウンティの開始や重要なプラットフォームの更新について情報を得る

**Discord**に参加して、今日からトップハッカーと協力を始めましょう！
