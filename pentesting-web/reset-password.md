# Bypass de Restablecimiento/Olvido de Contrase침a

<details>

<summary><strong>Aprende hacking en AWS de cero a h칠roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de HackTricks AWS)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n [**art칤culos oficiales de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de recompensas por errores.

**Informaci칩n sobre Hacking**\
Invol칰crate con contenido que explora la emoci칩n y los desaf칤os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente actualizado con el mundo del hacking a trav칠s de noticias e informaci칩n en tiempo real

**칔ltimos Anuncios**\
Mantente informado sobre los nuevos programas de recompensas por errores y actualizaciones importantes de plataformas

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy mismo!

## **Fuga de Token de Restablecimiento de Contrase침a a trav칠s del Referente**

* El encabezado HTTP referer puede filtrar el token de restablecimiento de contrase침a si se incluye en la URL. Esto puede ocurrir cuando un usuario hace clic en un enlace de un sitio web de terceros despu칠s de solicitar un restablecimiento de contrase침a.
* **Impacto**: Posible toma de control de cuenta a trav칠s de ataques de Falsificaci칩n de Petici칩n en Sitio Cruzado (CSRF).
* **Explotaci칩n**: Para verificar si un token de restablecimiento de contrase침a se filtra en el encabezado del referente, **solicita un restablecimiento de contrase침a** a tu direcci칩n de correo electr칩nico y **haz clic en el enlace de restablecimiento** proporcionado. **No cambies tu contrase침a** inmediatamente. En su lugar, **navega a un sitio web de terceros** (como Facebook o Twitter) mientras **interceptas las solicitudes usando Burp Suite**. Inspecciona las solicitudes para ver si el **encabezado del referente contiene el token de restablecimiento de contrase침a**, ya que esto podr칤a exponer informaci칩n sensible a terceros.
* **Referencias**:
* [Informe de HackerOne 342693](https://hackerone.com/reports/342693)
* [Informe de HackerOne 272379](https://hackerone.com/reports/272379)
* [Art칤culo sobre Fuga de Token de Restablecimiento de Contrase침a](https://medium.com/@rubiojhayz1234/toyotas-password-reset-token-and-email-address-leak-via-referer-header-b0ede6507c6a)

## **Envenenamiento de Restablecimiento de Contrase침a**

* Los atacantes pueden manipular el encabezado Host durante las solicitudes de restablecimiento de contrase침a para dirigir el enlace de restablecimiento a un sitio malicioso.
* **Impacto**: Conduce a una posible toma de control de cuenta al filtrar tokens de restablecimiento a los atacantes.
* **Pasos de Mitigaci칩n**:
* Validar el encabezado Host contra una lista blanca de dominios permitidos.
* Utilizar m칠todos seguros y del lado del servidor para generar URLs absolutas.
* **Parche**: Utilizar `$_SERVER['SERVER_NAME']` para construir URLs de restablecimiento de contrase침a en lugar de `$_SERVER['HTTP_HOST']`.
* **Referencias**:
* [Art칤culo de Acunetix sobre Envenenamiento de Restablecimiento de Contrase침a](https://www.acunetix.com/blog/articles/password-reset-poisoning/)

## **Restablecimiento de Contrase침a Manipulando el Par치metro de Correo Electr칩nico**

Los atacantes pueden manipular la solicitud de restablecimiento de contrase침a agregando par치metros de correo electr칩nico adicionales para desviar el enlace de restablecimiento.

* Agregar el correo electr칩nico del atacante como segundo par치metro usando &
```php
POST /resetPassword
[...]
email=victim@email.com&email=attacker@email.com
```
* Agregue el correo electr칩nico del atacante como segundo par치metro usando %20
```php
POST /resetPassword
[...]
email=victim@email.com%20email=attacker@email.com
```
* Agregar el correo electr칩nico del atacante como segundo par치metro usando |
```php
POST /resetPassword
[...]
email=victim@email.com|email=attacker@email.com
```
* Agregue el correo electr칩nico del atacante como segundo par치metro usando cc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dcc:attacker@mail.tld"
```
* Agregue el correo electr칩nico del atacante como segundo par치metro usando bcc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dbcc:attacker@mail.tld"
```
* Agregar el correo electr칩nico del atacante como segundo par치metro usando ,
```php
POST /resetPassword
[...]
email="victim@mail.tld",email="attacker@mail.tld"
```
* Agregar el correo electr칩nico del atacante como segundo par치metro en el arreglo json
```php
POST /resetPassword
[...]
{"email":["victim@mail.tld","atracker@mail.tld"]}
```
* **Pasos de Mitigaci칩n**:
* Analizar y validar adecuadamente los par치metros de correo electr칩nico en el servidor.
* Utilizar declaraciones preparadas o consultas parametrizadas para prevenir ataques de inyecci칩n.
* **Referencias**:
* [https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be](https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be)
* [https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/](https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/)
* [https://twitter.com/HusseiN98D/status/1254888748216655872](https://twitter.com/HusseiN98D/status/1254888748216655872)

## **Cambiar Correo Electr칩nico y Contrase침a de cualquier Usuario a trav칠s de Par치metros de API**

* Los atacantes pueden modificar los par치metros de correo electr칩nico y contrase침a en las solicitudes de API para cambiar las credenciales de la cuenta.
```php
POST /api/changepass
[...]
("form": {"email":"victim@email.tld","password":"12345678"})
```
* **Pasos de Mitigaci칩n**:
* Asegurar una estricta validaci칩n de par치metros y comprobaciones de autenticaci칩n.
* Implementar un registro y monitoreo robustos para detectar y responder a actividades sospechosas.
* **Referencia**:
* [Toma completa de cuenta a trav칠s de la manipulaci칩n de par치metros de API](https://medium.com/@adeshkolte/full-account-takeover-changing-email-and-password-of-any-user-through-api-parameters-3d527ab27240)

## **Sin L칤mite de Tasa: Bombardeo de Correo Electr칩nico**

* La falta de l칤mite de tasa en las solicitudes de restablecimiento de contrase침a puede llevar a un bombardeo de correos electr칩nicos, abrumando al usuario con correos electr칩nicos de restablecimiento.
* **Pasos de Mitigaci칩n**:
* Implementar l칤mites de tasa basados en la direcci칩n IP o la cuenta de usuario.
* Utilizar desaf칤os CAPTCHA para prevenir abusos automatizados.
* **Referencias**:
* [Informe de HackerOne 280534](https://hackerone.com/reports/280534)

## **Descubrir C칩mo se Genera el Token de Restablecimiento de Contrase침a**

* Comprender el patr칩n o m칠todo detr치s de la generaci칩n de tokens puede llevar a predecir o realizar fuerza bruta en los tokens. Algunas opciones:
* Basado en la Marca de Tiempo
* Basado en el ID de Usuario
* Basado en el Correo Electr칩nico del Usuario
* Basado en el Nombre y Apellido
* Basado en la Fecha de Nacimiento
* Basado en Criptograf칤a
* **Pasos de Mitigaci칩n**:
* Utilizar m칠todos criptogr치ficos s칩lidos para la generaci칩n de tokens.
* Asegurar suficiente aleatoriedad y longitud para prevenir la predictibilidad.
* **Herramientas**: Utilizar Burp Sequencer para analizar la aleatoriedad de los tokens.

## **UUID Adivinable**

* Si los UUID (versi칩n 1) son adivinables o predecibles, los atacantes pueden realizar fuerza bruta en ellos para generar tokens de restablecimiento v치lidos. Verificar:

{% content-ref url="uuid-insecurities.md" %}
[uuid-insecurities.md](uuid-insecurities.md)
{% endcontent-ref %}

* **Pasos de Mitigaci칩n**:
* Utilizar GUID versi칩n 4 para aleatoriedad o implementar medidas de seguridad adicionales para otras versiones.
* **Herramientas**: Utilizar [guidtool](https://github.com/intruder-io/guidtool) para analizar y generar GUIDs.

## **Manipulaci칩n de Respuesta: Reemplazar una Mala Respuesta por una Buena**

* Manipular respuestas HTTP para evadir mensajes de error o restricciones.
* **Pasos de Mitigaci칩n**:
* Implementar comprobaciones en el lado del servidor para asegurar la integridad de la respuesta.
* Utilizar canales de comunicaci칩n seguros como HTTPS para prevenir ataques de intermediarios.
* **Referencia**:
* [Error Cr칤tico en Evento de Recompensa de Bugs en Vivo](https://medium.com/@innocenthacker/how-i-found-the-most-critical-bug-in-live-bug-bounty-event-7a88b3aa97b3)

## **Uso de Token Expirado**

* Probar si los tokens expirados a칰n pueden ser utilizados para el restablecimiento de contrase침a.
* **Pasos de Mitigaci칩n**:
* Implementar pol칤ticas estrictas de expiraci칩n de tokens y validar la expiraci칩n del token en el lado del servidor.

## **Fuerza Bruta en Token de Restablecimiento de Contrase침a**

* Intentar realizar fuerza bruta en el token de restablecimiento utilizando herramientas como Burpsuite e IP-Rotator para evadir los l칤mites de tasa basados en IP.
* **Pasos de Mitigaci칩n**:
* Implementar mecanismos robustos de limitaci칩n de tasa y bloqueo de cuentas.
* Monitorear actividades sospechosas que indiquen ataques de fuerza bruta.

## **Intentar Usar tu Token**

* Probar si el token de restablecimiento de un atacante puede ser utilizado junto con el correo electr칩nico de la v칤ctima.
* **Pasos de Mitigaci칩n**:
* Asegurarse de que los tokens est칠n vinculados a la sesi칩n del usuario u otros atributos espec칤ficos del usuario.

## **Invalidaci칩n de Sesi칩n en Cierre de Sesi칩n/Restablecimiento de Contrase침a**

* Asegurar que las sesiones sean invalidadas cuando un usuario cierra la sesi칩n o restablece su contrase침a.
* **Pasos de Mitigaci칩n**:
* Implementar una gesti칩n adecuada de sesiones, asegurando que todas las sesiones sean invalidadas al cerrar la sesi칩n o restablecer la contrase침a.

## **Invalidaci칩n de Sesi칩n en Cierre de Sesi칩n/Restablecimiento de Contrase침a**

* Los tokens de restablecimiento deben tener un tiempo de expiraci칩n despu칠s del cual se vuelven inv치lidos.
* **Pasos de Mitigaci칩n**:
* Establecer un tiempo de expiraci칩n razonable para los tokens de restablecimiento y hacer cumplir estrictamente esta pol칤tica en el lado del servidor.

## Referencias

* [https://anugrahsr.github.io/posts/10-Password-reset-flaws/#10-try-using-your-token](https://anugrahsr.github.io/posts/10-Password-reset-flaws/#10-try-using-your-token)

<figure><img src="../.gitbook/assets/image (380).png" alt=""><figcaption></figcaption></figure>

칔nete al servidor de [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para comunicarte con hackers experimentados y cazadores de bugs!

**Perspectivas de Hacking**\
Invol칰crate con contenido que profundiza en la emoci칩n y desaf칤os del hacking

**Noticias de Hacking en Tiempo Real**\
Mantente al d칤a con el mundo del hacking a trav칠s de noticias e informaci칩n en tiempo real

**칔ltimos Anuncios**\
Mantente informado sobre los nuevos programas de recompensas por bugs que se lanzan y actualizaciones cruciales de plataformas

**칔nete a nosotros en** [**Discord**](https://discord.com/invite/N3FrSbmwdy) y comienza a colaborar con los mejores hackers hoy!

<details>

<summary><strong>Aprende a hackear AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
