# Clickjacking

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir e **automatizar fluxos de trabalho** com as ferramentas comunit√°rias mais avan√ßadas do mundo.\
Obtenha acesso hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## O que √© Clickjacking

Clickjacking √© um ataque que **enganar** um **usu√°rio** para **clicar** em um **elemento** de uma p√°gina da web que √© **invis√≠vel** ou disfar√ßado como outro elemento. Isso pode fazer com que os usu√°rios inadvertidamente baixem malware, acessem p√°ginas da web maliciosas, forne√ßam credenciais ou informa√ß√µes sens√≠veis, transfiram dinheiro ou comprem produtos online. (De [aqui](https://www.imperva.com/learn/application-security/clickjacking/)).

### Truque de preencher formul√°rios

√Äs vezes √© poss√≠vel **preencher o valor dos campos de um formul√°rio usando par√¢metros GET ao carregar uma p√°gina**. Um atacante pode abusar desse comportamento para preencher um formul√°rio com dados arbitr√°rios e enviar a carga de clickjacking para que o usu√°rio pressione o bot√£o Enviar.

### Preencher formul√°rio com Arrastar e Soltar

Se voc√™ precisa que o usu√°rio **preencha um formul√°rio**, mas n√£o quer pedir diretamente a ele para escrever algumas informa√ß√µes espec√≠ficas (como o e-mail e/ou senha espec√≠fica que voc√™ conhece), voc√™ pode simplesmente pedir a ele para **Arrastar e Soltar** algo que escrever√° seus dados controlados como neste [**exemplo**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Payload b√°sico
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Carga √önica em V√°rios Passos

Clickjacking attacks can be made more effective by using a multistep payload. In a multistep payload, the attacker divides the malicious action into multiple steps, each triggered by a separate click event. This technique can help bypass certain security measures that may be in place to detect and prevent clickjacking attacks.

To implement a multistep payload, the attacker first identifies the target action they want to perform on the victim's behalf. This could be anything from submitting a form to making a purchase. The attacker then breaks down this action into smaller steps, each of which can be triggered by a separate click event.

For example, let's say the target action is submitting a form. The attacker can divide this action into three steps: filling out the form, clicking the submit button, and confirming the submission. Each step is triggered by a separate click event, and the attacker can use various techniques to hide these clicks from the victim.

By using a multistep payload, the attacker can make the clickjacking attack more covert and increase the chances of successfully executing the malicious action. It is important for developers and security professionals to be aware of this technique and implement appropriate measures to mitigate the risk of clickjacking attacks.
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Carga de Arrastar e Soltar + Clique

Clickjacking can be combined with drag and drop functionality to create a more sophisticated attack. In this technique, the attacker tricks the user into dragging and dropping an object onto a hidden button or link, which triggers a malicious action.

O clickjacking pode ser combinado com a funcionalidade de arrastar e soltar para criar um ataque mais sofisticado. Nessa t√©cnica, o atacante engana o usu√°rio para arrastar e soltar um objeto em um bot√£o ou link oculto, o que aciona uma a√ß√£o maliciosa.

To perform this attack, the attacker first creates a transparent overlay on top of the target website. This overlay contains a draggable object that appears harmless to the user. The attacker then uses JavaScript to capture the user's drag and drop events and redirect them to the hidden button or link.

Para realizar esse ataque, o atacante primeiro cria uma sobreposi√ß√£o transparente sobre o site alvo. Essa sobreposi√ß√£o cont√©m um objeto arrast√°vel que parece inofensivo para o usu√°rio. O atacante ent√£o usa JavaScript para capturar os eventos de arrastar e soltar do usu√°rio e redirecion√°-los para o bot√£o ou link oculto.

When the user unknowingly drags and drops the object onto the hidden button or link, they inadvertently trigger the malicious action associated with it. This can include actions such as submitting a form, making a purchase, or performing any other action that the attacker desires.

Quando o usu√°rio, sem saber, arrasta e solta o objeto no bot√£o ou link oculto, ele inadvertidamente aciona a a√ß√£o maliciosa associada a ele. Isso pode incluir a√ß√µes como enviar um formul√°rio, fazer uma compra ou realizar qualquer outra a√ß√£o que o atacante desejar.

To protect against drag and drop + click payloads, web developers should implement measures such as frame-busting code, X-Frame-Options headers, and Content Security Policy (CSP) to prevent clickjacking attacks.

Para se proteger contra cargas de arrastar e soltar + clique, os desenvolvedores web devem implementar medidas como c√≥digo de quebra de frames, cabe√ßalhos X-Frame-Options e Pol√≠tica de Seguran√ßa de Conte√∫do (CSP) para evitar ataques de clickjacking.
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Se voc√™ identificou um ataque **XSS que requer que o usu√°rio clique** em algum elemento para **acionar** o XSS e a p√°gina √© **vulner√°vel a clickjacking**, voc√™ pode abusar disso para enganar o usu√°rio a clicar no bot√£o/link.\
Exemplo:\
_Voc√™ encontrou um **self XSS** em alguns detalhes privados da conta (detalhes que **apenas voc√™ pode definir e ler**). A p√°gina com o **formul√°rio** para definir esses detalhes √© **vulner√°vel** a **Clickjacking** e voc√™ pode **preencher** o **formul√°rio** com os par√¢metros GET._\
\_\_Um atacante poderia preparar um ataque de **Clickjacking** para aquela p√°gina, **preenchendo** o **formul√°rio** com o **payload XSS** e **enganando** o **usu√°rio** a **enviar** o formul√°rio. Assim, **quando o formul√°rio for enviado** e os valores forem modificados, o **usu√°rio executar√° o XSS**.

## Como evitar o Clickjacking

### Defesas do lado do cliente

√â poss√≠vel executar scripts no lado do cliente que realizam alguns ou todos os seguintes comportamentos para evitar o Clickjacking:

* verificar e garantir que a janela de aplicativo atual seja a janela principal ou superior,
* tornar todos os frames vis√≠veis,
* impedir o clique em frames invis√≠veis,
* interceptar e sinalizar poss√≠veis ataques de clickjacking para um usu√°rio.

#### Bypass

Como os frame busters s√£o JavaScript, as configura√ß√µes de seguran√ßa do navegador podem impedir sua opera√ß√£o ou at√© mesmo o navegador pode n√£o suportar JavaScript. Uma forma eficaz de contornar os frame busters √© usar o **atributo `sandbox` do iframe do HTML5**. Quando isso √© definido com os valores `allow-forms` ou `allow-scripts` e o valor `allow-top-navigation` √© omitido, o script do frame buster pode ser neutralizado, pois o iframe n√£o pode verificar se √© ou n√£o a janela superior:
```markup
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
Tanto os valores `allow-forms` quanto `allow-scripts` permitem as a√ß√µes especificadas dentro do iframe, mas a navega√ß√£o de n√≠vel superior √© desativada. Isso inibe comportamentos de quebra de frame, permitindo ao mesmo tempo a funcionalidade dentro do site-alvo.

Dependendo do tipo de ataque de Clickjacking realizado, **voc√™ tamb√©m pode precisar permitir**: `allow-same-origin` e `allow-modals` ou [ainda mais](https://www.w3schools.com/tags/att\_iframe\_sandbox.asp). Ao preparar o ataque, verifique o console do navegador, pois ele pode informar quais outros comportamentos voc√™ precisa permitir.

### X-Frame-Options

O cabe√ßalho de resposta HTTP **`X-Frame-Options`** pode ser usado para indicar se um navegador deve ou n√£o **permitir** a renderiza√ß√£o de uma p√°gina em um `<frame>` ou `<iframe>`. Os sites podem usar isso para evitar ataques de Clickjacking, garantindo que **seu conte√∫do n√£o seja incorporado em outros sites**. Defina o cabe√ßalho **`X-Frame-Options`** para todas as respostas que cont√™m conte√∫do HTML. Os valores poss√≠veis s√£o:

* `X-Frame-Options: deny`, que **impede que qualquer dom√≠nio incorpore o conte√∫do** _(valor recomendado)_
* `X-Frame-Options: sameorigin`, que permite apenas que o **site atual** incorpore o conte√∫do.
* `X-Frame-Options: allow-from https://trusted.com`, que **permite que o 'uri' especificado** incorpore esta p√°gina.
* Verifique as limita√ß√µes abaixo, pois **isso falhar√° se o navegador n√£o o suportar**.
* Outros navegadores suportam a nova diretiva **CSP frame-ancestors**. Alguns suportam ambos.

### Diretiva frame-ancestors da Pol√≠tica de Seguran√ßa de Conte√∫do (CSP)

A prote√ß√£o recomendada contra Clickjacking √© incorporar a diretiva **`frame-ancestors`** na Pol√≠tica de Seguran√ßa de Conte√∫do da aplica√ß√£o.\
A diretiva **`frame-ancestors 'none'`** √© semelhante ao comportamento da diretiva **X-Frame-Options `deny`** (_Ningu√©m pode incorporar a p√°gina_).\
A diretiva **`frame-ancestors 'self'`** √© amplamente equivalente √† diretiva **X-Frame-Options `sameorigin`** (_apenas o site atual pode incorpor√°-lo_).\
A diretiva **`frame-ancestors trusted.com`** √© amplamente equivalente √† diretiva **X-Frame-Options** `allow-from` (_apenas o site confi√°vel pode incorpor√°-lo_).

A seguinte CSP permite apenas frames do mesmo dom√≠nio:

`Content-Security-Policy: frame-ancestors 'self';`

Consulte a documenta√ß√£o a seguir para obter mais detalhes e exemplos mais complexos:

* [https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors)

### Limita√ß√µes <a href="#limitations" id="limitations"></a>

* **Compatibilidade com navegadores:** O CSP frame-ancestors ainda n√£o √© suportado por todos os principais navegadores.
* **X-Frame-Options tem prioridade:** A se√ß√£o "Rela√ß√£o com X-Frame-Options" da especifica√ß√£o CSP diz: "_Se um recurso for entregue com uma pol√≠tica que inclua uma diretiva chamada frame-ancestors e cuja disposi√ß√£o seja 'enforce', o cabe√ßalho X-Frame-Options DEVE ser ignorado_", mas o Chrome 40 e o Firefox 35 ignoram a diretiva frame-ancestors e seguem o cabe√ßalho X-Frame-Options.

## Refer√™ncias

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para criar e **automatizar fluxos de trabalho** com facilidade, usando as ferramentas comunit√°rias mais avan√ßadas do mundo.\
Acesse hoje mesmo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? Ou gostaria de ter acesso √† **vers√£o mais recente do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo Telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
