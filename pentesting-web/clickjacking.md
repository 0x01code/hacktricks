# Clickjacking

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**swag oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
Usa [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) para construir y **automatizar flujos de trabajo** con las herramientas comunitarias m√°s avanzadas del mundo.\
Obt√©n acceso hoy mismo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## ¬øQu√© es el Clickjacking?

El Clickjacking es un ataque que **enga√±a** a un **usuario** para que **haga clic** en un **elemento** de una p√°gina web que est√° **invisible** o disfrazado como otro elemento. Esto puede hacer que los usuarios descarguen malware sin saberlo, visiten p√°ginas web maliciosas, proporcionen credenciales o informaci√≥n sensible, transfieran dinero o compren productos en l√≠nea. (De [aqu√≠](https://www.imperva.com/learn/application-security/clickjacking/)).

### Truco de prellenado de formularios

A veces es posible **rellenar el valor de los campos de un formulario utilizando par√°metros GET al cargar una p√°gina**. Un atacante puede abusar de este comportamiento para llenar un formulario con datos arbitrarios y enviar la carga de clickjacking para que el usuario presione el bot√≥n Enviar.

### Rellenar formulario con Arrastrar y soltar

Si necesitas que el usuario **llene un formulario** pero no quieres pedirle directamente que escriba informaci√≥n espec√≠fica (como el correo electr√≥nico o una contrase√±a espec√≠fica que conoces), simplemente puedes pedirle que **Arrastre y suelte** algo que escribir√° tus datos controlados como en [**este ejemplo**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Carga b√°sica
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Carga de m√∫ltiples pasos

Clickjacking can be made more effective by using a multistep payload. In this technique, the attacker tricks the victim into performing a series of actions, each of which contributes to the success of the attack.

The multistep payload can be implemented using various methods. One common approach is to divide the payload into multiple steps and spread them across different web pages. The attacker first lures the victim to a page that contains the initial step of the payload. This step may involve clicking on a button, entering some information, or performing any other action.

Once the victim completes the first step, they are redirected to another page that contains the second step of the payload. This process continues until all the steps are completed. Each step may appear harmless or unrelated to the overall attack, making it difficult for the victim to realize they are being manipulated.

By dividing the payload into multiple steps, the attacker can bypass certain security measures that may be in place. For example, if a website has implemented protection against clickjacking by using frame-busting techniques, the multistep payload can help bypass this protection. Since each step is performed on a different page, the frame-busting code will not be triggered.

To defend against multistep payloads, it is important to educate users about the risks of clickjacking and the importance of being cautious while interacting with unfamiliar websites. Additionally, web developers should implement proper security measures to prevent clickjacking attacks, such as using X-Frame-Options headers or Content Security Policy (CSP) directives.
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Carga de arrastrar y soltar + clic

Clickjacking can be combined with drag and drop functionality to create a more sophisticated attack. In this technique, the attacker tricks the user into dragging and dropping an object onto a hidden button or link, which triggers a malicious action.

El clickjacking se puede combinar con la funcionalidad de arrastrar y soltar para crear un ataque m√°s sofisticado. En esta t√©cnica, el atacante enga√±a al usuario para que arrastre y suelte un objeto sobre un bot√≥n o enlace oculto, lo cual desencadena una acci√≥n maliciosa.

To perform this attack, the attacker first creates a transparent layer on top of the target website. This layer contains a hidden button or link that is positioned exactly where the user is expected to drag and drop an object.

Para llevar a cabo este ataque, el atacante primero crea una capa transparente sobre el sitio web objetivo. Esta capa contiene un bot√≥n o enlace oculto que se posiciona exactamente donde se espera que el usuario arrastre y suelte un objeto.

When the user interacts with the website and attempts to drag and drop an object, they unknowingly trigger the hidden button or link underneath. This can lead to unintended actions, such as submitting a form, making a purchase, or performing any other action that the attacker desires.

Cuando el usuario interact√∫a con el sitio web e intenta arrastrar y soltar un objeto, sin saberlo, activa el bot√≥n o enlace oculto que se encuentra debajo. Esto puede llevar a acciones no deseadas, como enviar un formulario, realizar una compra o realizar cualquier otra acci√≥n que el atacante desee.

To protect against drag and drop + click payloads, website owners should implement frame-busting techniques and ensure that their websites cannot be embedded within iframes on other domains.

Para protegerse contra las cargas de arrastrar y soltar + clic, los propietarios de sitios web deben implementar t√©cnicas de rompimiento de marcos y asegurarse de que sus sitios web no puedan ser incrustados en iframes en otros dominios.
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Si has identificado un ataque **XSS que requiere que el usuario haga clic** en alg√∫n elemento para **activar** el XSS y la p√°gina es **vulnerable a clickjacking**, podr√≠as abusar de ello para enga√±ar al usuario y hacer que haga clic en el bot√≥n/enlace.\
Ejemplo:\
_Has encontrado un **self XSS** en algunos detalles privados de la cuenta (detalles que **solo t√∫ puedes configurar y leer**). La p√°gina con el **formulario** para configurar estos detalles es **vulnerable** a **clickjacking** y puedes **prellenar** el **formulario** con los par√°metros GET._\
\_\_Un atacante podr√≠a preparar un ataque de **clickjacking** a esa p√°gina **prellenando** el **formulario** con la **carga √∫til XSS** y **enga√±ando** al **usuario** para que **env√≠e** el formulario. As√≠, **cuando se env√≠e el formulario** y se modifiquen los valores, el **usuario ejecutar√° el XSS**.

## C√≥mo evitar el Clickjacking

### Defensas del lado del cliente

Es posible ejecutar scripts en el lado del cliente que realicen algunos o todos los siguientes comportamientos para prevenir el clickjacking:

* verificar y hacer cumplir que la ventana de la aplicaci√≥n actual sea la ventana principal o superior,
* hacer que todos los marcos sean visibles,
* evitar hacer clic en marcos invisibles,
* interceptar y marcar posibles ataques de clickjacking en un usuario.

#### Bypass

Como los bloqueadores de marcos son JavaScript, la configuraci√≥n de seguridad del navegador puede evitar su funcionamiento o incluso el navegador podr√≠a no admitir JavaScript. Una forma efectiva de evitar los bloqueadores de marcos por parte de un atacante es utilizar el **atributo `sandbox` del iframe de HTML5**. Cuando se establece con los valores `allow-forms` o `allow-scripts` y se omite el valor `allow-top-navigation`, el script del bloqueador de marcos puede neutralizarse ya que el iframe no puede verificar si es o no la ventana superior.
```markup
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
Tanto los valores `allow-forms` como `allow-scripts` permiten las acciones especificadas dentro del iframe, pero la navegaci√≥n de nivel superior est√° deshabilitada. Esto inhibe los comportamientos de rompimiento de marco al tiempo que permite la funcionalidad dentro del sitio objetivo.

Dependiendo del tipo de ataque de Clickjacking realizado, **tambi√©n puede ser necesario permitir**: `allow-same-origin` y `allow-modals` o [incluso m√°s](https://www.w3schools.com/tags/att\_iframe\_sandbox.asp). Al preparar el ataque, simplemente verifica la consola del navegador, ya que puede indicarte qu√© otros comportamientos debes permitir.

### X-Frame-Options

El encabezado de respuesta HTTP **`X-Frame-Options`** se puede utilizar para indicar si un navegador debe **permitir** o no que se represente una p√°gina en un `<frame>` o `<iframe>`. Los sitios pueden utilizar esto para evitar ataques de Clickjacking, asegur√°ndose de que **su contenido no se incruste en otros sitios**. Establece el encabezado **`X-Frame-Options`** para todas las respuestas que contengan contenido HTML. Los valores posibles son:

* `X-Frame-Options: deny`, que **impide que cualquier dominio enmarque el contenido** _(valor recomendado)_
* `X-Frame-Options: sameorigin`, que solo **permite que el sitio actual** enmarque el contenido.
* `X-Frame-Options: allow-from https://trusted.com`, que **permite que el 'uri' especificado** enmarque esta p√°gina.
* Verifica las limitaciones a continuaci√≥n porque **esto fallar√° si el navegador no lo admite**.
* Otros navegadores admiten la nueva directiva **CSP frame-ancestors en su lugar**. Algunos admiten ambos.

### Directiva frame-ancestors de Content Security Policy (CSP)

La protecci√≥n de Clickjacking **recomendada** es incorporar la directiva **`frame-ancestors`** en la Pol√≠tica de Seguridad de Contenido de la aplicaci√≥n.\
La directiva **`frame-ancestors 'none'`** es similar en comportamiento a la directiva **X-Frame-Options `deny`** (_Nadie puede enmarcar la p√°gina_).\
La directiva **`frame-ancestors 'self'`** es ampliamente equivalente a la directiva **X-Frame-Options `sameorigin`** (_solo el sitio actual puede enmarcarlo_).\
La directiva **`frame-ancestors trusted.com`** es ampliamente equivalente a la directiva **X-Frame-Options** `allow-from` (_solo el sitio de confianza puede enmarcarlo_).

La siguiente CSP permite enmarcar solo en el mismo dominio:

`Content-Security-Policy: frame-ancestors 'self';`

Consulta la siguiente documentaci√≥n para obtener m√°s detalles y ejemplos m√°s complejos:

* [https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors)

### Limitaciones <a href="#limitations" id="limitations"></a>

* **Compatibilidad del navegador:** CSP frame-ancestors a√∫n no es compatible con todos los principales navegadores.
* **X-Frame-Options tiene prioridad:** La secci√≥n "Relaci√≥n con X-Frame-Options" de la especificaci√≥n CSP dice: "_Si un recurso se entrega con una pol√≠tica que incluye una directiva llamada frame-ancestors y cuya disposici√≥n es 'enforce', entonces el encabezado X-Frame-Options DEBE ser ignorado_", pero Chrome 40 y Firefox 35 ignoran la directiva frame-ancestors y siguen el encabezado X-Frame-Options en su lugar.

## Referencias

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="/.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

\
Utiliza [**Trickest**](https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks) para construir y **automatizar flujos de trabajo** f√°cilmente con las herramientas comunitarias m√°s avanzadas del mundo.\
Obt√©n acceso hoy mismo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabajas en una **empresa de ciberseguridad**? ¬øQuieres ver tu **empresa anunciada en HackTricks**? ¬øO quieres tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obt√©n el [**merchandising oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önete al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
