# BrowExt - dozvole i host\_dozvole

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju reklamiranu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>

## Osnovne informacije

### **`dozvole`**

Dozvole se definišu u **`manifest.json`** fajlu ekstenzije koristeći **`permissions`** svojstvo i omogućavaju pristup skoro svemu čemu browser može pristupiti (kolačićima ili fizičkom skladištu):

Prethodni manifest deklariše da ekstenzija zahteva `storage` dozvolu. Ovo znači da može koristiti [storage API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) za trajno skladištenje podataka. Za razliku od kolačića ili `localStorage` API-ja koji korisnicima daju neki nivo kontrole, **skladište ekstenzije se obično može očistiti samo deinstaliranjem ekstenzije**.

Ekstenzija će zatražiti dozvole navedene u svom **`manifest.json`** fajlu i nakon instaliranja ekstenzije, uvek možete **proveriti njene dozvole u vašem browser-u**, kao što je prikazano na ovoj slici:

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

Možete pronaći [**kompletan spisak dozvola koje Chromium Browser Extension može zahtevati ovde**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) i [**kompletan spisak za Firefox ekstenzije ovde**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

### `host_permissions`

Opciono, ali moćno podešavanje **`host_permissions`** ukazuje sa kojim hostovima će ekstenzija moći da interaguje putem API-ja kao što su [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) i [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs).

Sledeće `host_permissions` omogućavaju praktično svakom web-u:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
Ovo su hostovi kojima browser ekstenzija može slobodno pristupiti. To je zato što kada browser ekstenzija pozove **`fetch("https://gmail.com/")`**, nije ograničena od strane CORS-a.

## Zloupotreba `permissions` i `host_permissions`

### Tabovi

Osim toga, **`host_permissions`** takođe otključavaju "napredne" [**tabs API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **funkcionalnosti**. Omogućavaju ekstenziji da pozove [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) i ne samo da dobije **listu korisničkih tabova pregledača**, već i da sazna koja **web stranica (što znači adresa i naslov) je učitana**.

{% hint style="danger" %}
Nije samo to, slušači poput [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) **postaju mnogo korisniji**. Oni će biti obavešteni svaki put kada se nova stranica učita u tab.
{% endhint %}

### Pokretanje skripti sadržaja <a href="#running-content-scripts" id="running-content-scripts"></a>

Skripte sadržaja nisu nužno statički napisane u manifestu ekstenzije. Uz dovoljno **`host_permissions`**, ekstenzije ih takođe mogu dinamički učitati pozivajući [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) **ili** [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript).

Oba API-ja omogućavaju izvršavanje ne samo datoteka koje se nalaze u ekstenzijama kao skripte sadržaja, već i **proizvoljnog koda**. Prvi API omogućava prosleđivanje JavaScript koda kao string, dok drugi očekuje JavaScript funkciju koja je manje podložna ranjivostima ubacivanja. Ipak, oba API-ja će napraviti haos ako se zloupotrebe.

{% hint style="danger" %}
Pored gore navedenih mogućnosti, skripte sadržaja na primer mogu **presresti akreditive** dok se unose na web stranicama. Još jedan klasičan način zloupotrebe je **ubacivanje reklama** na svaku web stranicu. Moguće je dodavanje **prevara** kako bi se zloupotrebila kredibilnost vesti na web stranicama. Na kraju, mogu **manipulisati bankovnim** web stranicama kako bi preusmerile novčane transfere.
{% endhint %}

### Implicitne privilegije <a href="#implicit-privileges" id="implicit-privileges"></a>

Neki privilegije ekstenzija **ne moraju biti eksplicitno deklarisane**. Jedan primer je [tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs): njegova osnovna funkcionalnost je dostupna bez ikakvih privilegija. Svaka ekstenzija može biti obaveštena kada otvorite i zatvorite tabove, samo neće znati sa kojom veb stranicom se ti tabovi podudaraju.

Zvuči bezopasno? [tabs.create() API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) je nešto manje bezopasan. Može se koristiti za **kreiranje novog taba**, suštinski isto kao [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open) koji može biti pozvan od strane bilo koje web stranice. Međutim, dok je `window.open()` podložan **blokiranju iskačućih prozora, `tabs.create()` nije**.

{% hint style="danger" %}
Ekstenzija može kreirati bilo koji broj tabova kad god želi.
{% endhint %}

Ako pogledate moguće parametre `tabs.create()`, primetićete da njegove mogućnosti idu mnogo dalje od onoga što je `window.open()` dozvoljeno da kontroliše. I dok Firefox ne dozvoljava korišćenje `data:` URI-ja sa ovim API-jem, Chrome nema takvu zaštitu. **Upotreba takvih URI-ja na najvišem nivou je** [**zabranjena zbog zloupotrebe u phishing napadima**](https://bugzilla.mozilla.org/show_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) je vrlo sličan `tabs.create()` ali će **izmeniti postojeći tab**. Dakle, zlonamerna ekstenzija na primer može proizvoljno učitati stranicu sa reklamama u jedan od vaših tabova i može aktivirati odgovarajući tab.

### Kamera, geolokacija i drugi <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Verovatno znate da web stranice mogu zatražiti posebne dozvole, na primer za pristup vašoj kameri (alati za video konferencije) ili geografskoj lokaciji (mape). To su funkcionalnosti sa značajnim potencijalom za zloupotrebu, pa korisnici svaki put moraju potvrditi da li i dalje žele to.

{% hint style="danger" %}
To nije slučaj sa browser ekstenzijama. **Ako browser ekstenzija** [**želi pristup vašoj kameri ili mikrofonu**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)**, samo treba jednom zatražiti dozvolu**
{% endhint %}

Obično će ekstenzija to učiniti odmah nakon instalacije. Nakon što se ovaj dijalog prihvati, **pristup kameri je moguć u bilo koje vreme**, čak i ako korisnik trenutno ne koristi ekstenziju. Da, korisnik će prihvatiti ovaj dijalog samo ako ekstenzija zaista treba pristup kameri. Ali nakon toga moraju verovati ekstenziji da neće tajno snimati ništa.

Sa pristupom [vašoj tačnoj geografskoj lokaciji](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) ili [sadržaju vašeg clipboard-a](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API), eksplicitno odobrenje nije potrebno. **Ekstenzija jednostavno dodaje `geolocation` ili `clipboard` u** [**ulaz za dozvole**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **svog manifesta**. Ove privilegije pristupa se automatski dodeljuju prilikom instalacije ekstenzije. Dakle, zlonamerna ili kompromitovana ekstenzija sa ovim privilegijama može kreirati vaš profil kretanja ili pratiti vaš clipboard za kopirane lozinke, a da vi to ne primetite.

Dodavanje ključne reči **`history`** u [ulaz za dozvole](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) manifesta ekstenzije omogućava **pristup** [**history API-ju**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history). To omogućava dobijanje celokupne istorije pregledanja korisnika odjednom, bez čekanja da korisnik ponovo poseti te web stranice.

Dozvola **`bookmarks`** ima sličan potencijal za zloupotrebu, ova dozvola omogućava **čitanje svih obeleživača putem** [**bookmarks API-ja**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks).

### Dozvola
## **Reference**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Drugi načini podrške HackTricks-u:

* Ako želite da vidite **vašu kompaniju oglašenu na HackTricks-u** ili **preuzmete HackTricks u PDF formatu** Proverite [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Otkrijte [**The PEASS Family**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* **Pridružite se** 💬 [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili nas **pratite** na **Twitter-u** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**HackTricks**](https://github.com/carlospolop/hacktricks) i [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repozitorijume.

</details>
