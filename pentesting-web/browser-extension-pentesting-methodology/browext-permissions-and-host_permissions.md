# BrowExt - toestemmings & host_toestemmings

<details>

<summary><strong>Leer AWS-hacking vanaf nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>

## Basiese Inligting

### **`toestemmings`**

Toestemmings word in die uitbreiding se **`manifest.json`**-l√™er gedefinieer deur die **`toestemmings`**-eienskap en gee toegang tot byna enige iets waartoe 'n webblaaier toegang kan verkry (Koekies of Fisiese Berging):

Die vorige manifest verklaar dat die uitbreiding die `storage`-toestemming benodig. Dit beteken dat dit die [berging-API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) kan gebruik om sy data volhoubaar te stoor. Anders as koekies of `localStorage`-API's wat gebruikers 'n mate van beheer gee, kan **uitbreidingsberging normaalweg slegs deur die uitbreiding te de√Ønstalleer, skoongemaak word**.

'n Uitbreiding sal die toestemmings wat in sy **`manifest.json`**-l√™er aangedui word, aanvra en nadat die uitbreiding ge√Ønstalleer is, kan jy **altyd sy toestemmings in jou webblaaier nagaan**, soos in hierdie prentjie gewys word:

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

Jy kan die [**volledige lys van toestemmings wat 'n Chromium-webblaaieruitbreiding kan aanvra, hier vind**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) en 'n [**volledige lys vir Firefox-uitbreidings hier**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api_permissions)**.**

### `host_toestemmings`

Die opsionele maar kragtige instelling **`host_toestemmings`** dui aan met watter gasheerbedieners die uitbreiding in staat sal wees om te interaksieer via API's soos [`koekies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest), en [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs).

Die volgende `host_toestemmings` maak basies elke webblaaier moontlik:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
Hierdie is die gasheer wat die webblaaier-uitbreiding vrylik kan toegang. Dit is omdat wanneer 'n webblaaier-uitbreiding **`fetch("https://gmail.com/")`** roep, dit nie beperk word deur CORS nie.

## Misbruik van `permissions` en `host_permissions`

### Vlakke

Verder ontgrendel **`host_permissions`** ook "gevorderde" [**tabs API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **funksionaliteit.** Dit stel die uitbreiding in staat om [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) te roep en nie net 'n **lys van die gebruiker se blaaier-vlakke** terug te kry nie, maar ook te leer watter **webbladsy (beteken adres en titel) gelaai is**.

{% hint style="danger" %}
Nie net dit nie, luisteraars soos [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) **word ook baie nuttiger**. Hierdie sal in kennis gestel word wanneer 'n nuwe bladsy in 'n vlak gelaai word.
{% endhint %}

### Uitvoering van inhoudskripte <a href="#running-content-scripts" id="running-content-scripts"></a>

Inhoudskripte word nie noodwendig staties in die uitbreidings-manifest geskryf nie. Met voldoende **`host_permissions`** kan uitbreidings hulle ook dinamies laai deur [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) **of** [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript) te roep.

Beide API's maak dit moontlik om nie net l√™ers wat in die uitbreiding as inhoudskripte ingesluit is nie, maar ook **willekeurige kode** uit te voer. Die eerste maak dit moontlik om JavaScript-kode as 'n string in te voer, terwyl die laaste 'n JavaScript-funksie verwag wat minder vatbaar is vir inspuitingskwesbaarhede. Tog sal beide API's skade aanrig as dit verkeerd gebruik word.

{% hint style="danger" %}
Bo en behalwe die bogenoemde vermo√´ns, kan inhoudskripte byvoorbeeld ook **geloofsbriewe onderskep** soos dit in webbladsye ingevoer word. 'n Klassieke manier om hulle te misbruik, is om **advertensies in te spuit** op elke webwerf. Dit is ook moontlik om **bedrieglike boodskappe** by te voeg om die geloofwaardigheid van nuuswebwerwe te misbruik. Uiteindelik kan hulle **bankwebwerwe manipuleer** om geldoordragte om te lei.
{% endhint %}

### Implisiete voorregte <a href="#implicit-privileges" id="implicit-privileges"></a>

Sommige uitbreidingsvoorregte **hoef nie eksplisiet verklaar te word nie**. Een voorbeeld hiervan is die [tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs): sy basiese funksionaliteit is toeganklik sonder enige voorregte. Enige uitbreiding kan in kennis gestel word wanneer jy vlakke oopmaak en sluit, dit sal eenvoudig nie weet met watter webwerf hierdie vlakke ooreenstem nie.

Klink dit te onskadelik? Die [tabs.create() API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) is ietwat minder onskadelik. Dit kan gebruik word om **'n nuwe vlak te skep**, essensieel dieselfde as [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open) wat deur enige webwerf geroep kan word. Tog is `window.open()` onderhewig aan die **pop-up blokkeerder, `tabs.create()` nie**.

{% hint style="danger" %}
'n Uitbreiding kan enige aantal vlakke skep wanneer dit wil.
{% endhint %}

As jy deur moontlike `tabs.create()`-parameters kyk, sal jy ook besef dat sy vermo√´ns verder gaan as wat `window.open()` toegelaat word om te beheer. En terwyl Firefox nie toelaat dat `data:`-URI's met hierdie API gebruik word nie, het Chrome geen sulke beskerming nie. **Die gebruik van sulke URI's op die boonste vlak is** [**verbied weens misbruik vir hengelary**](https://bugzilla.mozilla.org/show\_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) is baie soortgelyk aan `tabs.create()` maar sal **'n bestaande vlak wysig**. 'n Kwaadwillige uitbreiding kan byvoorbeeld arbitr√™r 'n advertensiebladsy in een van jou vlakke laai, en dit kan ook die ooreenstemmende vlak aktiveer.

### Webcam, geolokalisering en vriende <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Jy weet waarskynlik dat webwerwe spesiale toestemmings kan vra, bv. om toegang tot jou webcam (video-konferensie-instrumente) of geografiese ligging (kaarte) te verkry. Dit is funksies met aansienlike potensiaal vir misbruik, sodat gebruikers elke keer moet bevestig dat hulle dit steeds wil h√™.

{% hint style="danger" %}
Nie so met webblaaier-uitbreidings nie. **As 'n webblaaier-uitbreiding** [**toegang tot jou webcam of mikrofoon wil h√™**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)**, hoef dit net een keer om toestemming te vra**
{% endhint %}

Gewoonlik sal 'n uitbreiding dit onmiddellik na installasie doen. Sodra hierdie versoek aanvaar is, is **webcam-toegang te eniger tyd moontlik**, selfs as die gebruiker nie op daardie oomblik met die uitbreiding interaksie het nie. Ja, 'n gebruiker sal hierdie versoek slegs aanvaar as die uitbreiding regtig webcam-toegang benodig. Maar daarna moet hulle die uitbreiding vertrou om niks heimlik op te neem nie.

Met toegang tot [jou presiese geografiese ligging](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) of [inhoud van jou knipbord](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard\_API), is dit heeltemal onnodig om toestemming eksplisiet te verleen. **'n Uitbreiding voeg eenvoudig `geolocation` of `clipboard` by die** [**permissions entry**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **van sy manifest**. Hierdie toegangsvoorregte word dan implisiet verleen wanneer die uitbreiding ge√Ønstalleer word. Dus kan 'n kwaadwillige of gekompromitteerde uitbreiding met hierdie voorregte jou bewegingsprofiel skep of jou knipbord monitor vir gekopieerde wagwoorde sonder dat jy iets daarvan besef.

Deur die sleutelwoord **`history`** by die [permissions entry](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) van die uitbreidings-manifest te voeg, word **toegang tot die** [**history API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history) **verleen**. Dit maak dit moontlik om die gebruiker se volledige blaai-geskiedenis in een keer te herwin, sonder om te wag vir die gebruiker om hierdie webwerwe weer te besoek.

Die **`bookmarks`** **permission** het soortgelyke misbruikspotensiaal, dit maak dit moontlik om **alle bladmerke uit te lees via die** [**bookmarks API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks).

### Stoor-toestemming <a href="#the-storage-permission" id="the-storage-permission"></a>

Die
## **Verwysings**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-repos.

</details>
