# BrowExt - izinler ve host\_permissions

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahramana kadar öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Kırmızı Takım Uzmanı)</strong></a><strong> ile!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**PEASS Ailesi'ni**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın** veya **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)'u **takip edin**.
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>

## Temel Bilgiler

### **`izinler`**

İzinler, genellikle bir tarayıcının erişebileceği hemen hemen her şeye erişim sağlayan **`manifest.json`** dosyasında tanımlanır ve (Çerezler veya Fiziksel Depolama):

Önceki manifest dosyası, uzantının `storage` iznini gerektirdiğini belirtir. Bu, [depolama API'sini](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) kullanarak verilerini kalıcı olarak depolayabilir. Kullanıcılara belirli bir kontrol seviyesi sağlayan çerezler veya `localStorage` API'lerinin aksine, **uzantı depolaması genellikle yalnızca uzantının kaldırılmasıyla temizlenebilir**.

Bir uzantı, **`manifest.json`** dosyasında belirtilen izinleri isteyecek ve Uzantıyı yükledikten sonra, tarayıcınızda **her zaman izinlerini kontrol edebilirsiniz**, bu resimde gösterildiği gibi:

<figure><img src="../../.gitbook/assets/image (15).png" alt=""><figcaption></figcaption></figure>

[**Bir Chromium Tarayıcı Uzantısının isteyebileceği izinlerin tam listesini burada bulabilirsiniz**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) ve [**Firefox uzantıları için tam liste burada**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

### `host_permissions`

İsteğe bağlı ancak güçlü olan **`host_permissions`** ayarı, uzantının [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) ve [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) gibi API'ler aracılığıyla etkileşimde bulunabileceği ana bilgisayarları belirtir.

Aşağıdaki `host_permissions` temel olarak her web sitesine izin verir:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
## `permissions` ve `host_permissions` Kötüye Kullanımı

### Sekmeler

Ayrıca, **`host_permissions`** ayrıca "gelişmiş" [**sekme API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **işlevselliğini** açar. Bu, uzantının [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) çağrısına izin verir ve sadece kullanıcının tarayıcı sekmelerinin bir **listesini almakla kalmaz, aynı zamanda yüklenen web sayfasının (adres ve başlık anlamına gelen) hangisi olduğunu da öğrenir**.

{% hint style="danger" %}
Bununla da kalmaz, [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) gibi dinleyiciler de **çok daha kullanışlı hale gelir**. Bunlar, bir sekmede yeni bir sayfa yüklendiğinde bildirilecektir.
{% endhint %}

### İçerik betiklerinin çalıştırılması <a href="#running-content-scripts" id="running-content-scripts"></a>

İçerik betikleri genellikle uzantı manifestosuna statik olarak yazılmaz. Yeterli **`host_permissions`** verildiğinde, **uzantılar ayrıca** [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) **veya** [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript) **çağrısını yaparak bunları dinamik olarak yükleyebilir**.

Her iki API de, içerik betikleri olarak uzantıda bulunan dosyaları değil, aynı zamanda **keyfi kod**u da yürütmeye izin verir. İlk API, JavaScript kodunu bir dize olarak iletmeyi sağlarken, ikincisi enjeksiyon güvenlik açıklarına daha az duyarlı olan bir JavaScript işlevini bekler. Yine de, her iki API de yanlış kullanıldığında büyük zararlara neden olabilir.

{% hint style="danger" %}
Yukarıdaki yeteneklerin yanı sıra, içerik betikleri örneğin **kimlik bilgilerini ele geçirebilir** çünkü bunlar web sayfalarına girilir. Onları kötüye kullanmanın klasik yollarından biri de her web sitesine **reklam enjekte etmektir**. Haber sitelerinin güvenilirliğini kötüye kullanmak için **dolandırıcılık mesajları eklemek** de mümkündür. Son olarak, bankacılık web sitelerini **para transferlerini yeniden yönlendirmek** için manipüle edebilirler.
{% endhint %}

### Dolaylı ayrıcalıklar <a href="#implicit-privileges" id="implicit-privileges"></a>

Bazı uzantı ayrıcalıkları **açıkça bildirilmesi gerekmez**. Bir örnek, [sekme API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) dir: temel işlevselliğine hiçbir ayrıcalık olmadan erişilebilir. Herhangi bir uzantı, açtığınız ve kapattığınız sekmeler hakkında bilgilendirilebilir, ancak bu sekmelerin hangi web sitesine karşılık geldiğini bilemez.

Çok masum görünüyor mu? [tabs.create() API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) biraz daha az masumdur. **Yeni bir sekme oluşturmak** için kullanılabilir, temelde herhangi bir web sitesi tarafından çağrılabilen [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open) ile aynıdır. Ancak `window.open()` pop-up engeline tabidir, `tabs.create()` değildir.

{% hint style="danger" %}
Bir uzantı istediğinde her zaman istediği sayıda sekme oluşturabilir.
{% endhint %}

`tabs.create()` parametrelerini incelediğinizde, yeteneklerinin `window.open()`'in kontrol etmesine izin verilenin çok ötesine gittiğini fark edeceksiniz. Ve Firefox, bu API ile `data:` URI'ların kullanılmasına izin vermezken, Chrome'un böyle bir koruması yoktur. **Bu tür URI'ların üst düzeyde kullanımı** [**dolandırıcılık için kötüye kullanıldığından yasaklanmıştır**](https://bugzilla.mozilla.org/show\_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) `tabs.create()`'e çok benzer ancak **mevcut bir sekmeyi değiştirir**. Bu nedenle, kötü niyetli bir uzantı örneğin rastgele bir reklam sayfasını sekmelerinizden birine yükleyebilir ve ilgili sekmeyi de etkinleştirebilir.

### Kamera, coğrafi konum ve arkadaşlar <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Muhtemelen web sitelerinin özel izinler isteyebileceğini biliyorsunuzdur, örneğin kameranıza (video konferans araçları) veya coğrafi konumunuza (haritalar) erişmek için. Bu, kötüye kullanım potansiyeli yüksek özelliklerdir, bu nedenle kullanıcılar her seferinde bunu hala istediklerine dair onay vermek zorundadır.

{% hint style="danger" %}
Ancak tarayıcı uzantıları için durum farklıdır. **Tarayıcı uzantısı** [**kameranıza veya mikrofonunuza erişmek istiyorsa**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)**, sadece bir kez izin istemesi yeterlidir**
{% endhint %}

Genellikle, bir uzantı bunu yüklendikten hemen sonra yapar. Bu izin verildiğinde, **kamera erişimi her zaman mümkündür**, hatta kullanıcı bu noktada uzantıyla etkileşimde değilse bile. Evet, bir kullanıcı yalnızca uzantının gerçekten kamera erişimine ihtiyaç duyduğunda bu izni kabul eder. Ancak bundan sonra uzantının gizlice bir şey kaydetmemesi için uzantıya güvenmek zorundadır.

[Tam olarak coğrafi konumunuz](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) veya [panonuzun içeriği](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard\_API) erişimine, açıkça izin verme zorunluluğu yoktur. **Bir uzantı sadece manifestosunun** [**izinler girişine**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **`geolocation` veya `clipboard` ekler**. Bu erişim ayrıcalıkları, uzantı yüklendiğinde zımni olarak verilir. Bu nedenle, bu ayrıcalıklara sahip kötü niyetli veya tehlikeye atılmış bir uzantı, fark etmeden hareket profilinizi oluşturabilir veya panonuzdaki kopyalanan şifreleri izleyebilir.

[**history`** anahtarını uzantı manifestosunun](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **izinler girişine eklemek**, [**geçmiş API'sine**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history) **erişim sağlar**. Bu, kullanıcının tüm gezinme geçmişini beklemeksizin bir seferde almasına olanak tanır.

**`bookmarks`** **izin** benzer kötüye kullanım potansiyeline sahiptir, bu izin **tüm yer işaretlerini** [**yer işaretleri API'si**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks) **aracılığıyla okumaya izin verir**.

### Depolama izni <a href="#the-storage-permission" id="the-storage-permission"></a>

Uzantı depolama alanı yalnızca bir anahtar-değer koleksiyonudur, herhangi bir web sitesinin kullanabileceği [localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) ile çok benzerdir. Bu nedenle burada hassas bilgiler saklanmamalıdır.

Ancak, reklam şirketleri de bu depolamayı kötüye kullanabilir.

### Daha fazla izin

[**Bir Chromium Tarayıcı Uzantısının isteyebileceği izinlerin tam listesini burada bulabilirsiniz**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) ve [**Firefox uzantıları için tam listeyi burada bulabilirsiniz**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**
## **Referanslar**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>Sıfırdan kahraman olmak için AWS hackleme öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **Katılın** 💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) veya bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)** takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
