# BrowExt - izinler ve host_permissions

<details>

<summary><strong>AWS hacklemeyi sıfırdan kahramana öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> ile!</strong></summary>

HackTricks'i desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın veya** bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)'da **takip edin**.
* **Hacking püf noktalarınızı paylaşarak PR göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>

## Temel Bilgiler

### **`izinler`**

İzinler, genellikle bir tarayıcının erişebileceği hemen hemen her şeye erişim sağlayan **`manifest.json`** dosyasında tanımlanır ve (Çerezler veya Fiziksel Depolama):

Önceki manifest dosyası, uzantının `storage` iznini gerektirdiğini belirtir. Bu, [depolama API'sini](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) kullanarak verilerini kalıcı olarak depolayabilir. Kullanıcılara belirli bir kontrol seviyesi sunan çerezler veya `localStorage` API'lerinin aksine, **uzantı depolaması genellikle yalnızca uzantının kaldırılmasıyla temizlenebilir**.

Bir uzantı, **`manifest.json`** dosyasında belirtilen izinleri isteyecek ve Uzantıyı yükledikten sonra, tarayıcınızda **her zaman izinlerini kontrol edebilirsiniz**, bu resimde gösterildiği gibi:

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

[Chromium Tarayıcı Uzantısının isteyebileceği izinlerin tam listesini burada bulabilirsiniz](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) ve [Firefox uzantıları için tam liste burada](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

### `host_permissions`

İsteğe bağlı ancak güçlü olan **`host_permissions`** ayarı, uzantının [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) ve [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) gibi API'ler aracılığıyla etkileşimde bulunabileceği ana bilgisayarları belirtir.

Aşağıdaki `host_permissions` temel olarak her web sitesine izin verir:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
## `permissions` ve `host_permissions` Kötüye Kullanımı

### Sekmeler

Ayrıca, **`host_permissions`** ayrıca "gelişmiş" [**sekme API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **işlevselliğini** açar. Bu, uzantının [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) çağrısına izin verir ve sadece kullanıcının tarayıcı sekmelerinin bir **listesini almakla kalmaz, aynı zamanda yüklenen web sayfasının (adres ve başlık anlamına gelen) hangisi olduğunu da öğrenir.**

{% hint style="danger" %}
Bununla birlikte, [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) gibi dinleyiciler de **daha da kullanışlı hale gelir**. Bunlar, bir sekme içine yeni bir sayfa yüklendiğinde bildirilecektir.
{% endhint %}

### İçerik betiklerinin çalıştırılması <a href="#running-content-scripts" id="running-content-scripts"></a>

İçerik betikleri genellikle uzantı manifestosuna statik olarak yazılmaz. Yeterli **`host_permissions`** verildiğinde, **uzantılar ayrıca** [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) **veya** [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript) **çağrısını yaparak bunları dinamik olarak yükleyebilir.**

Her iki API de, içerik betikleri olarak uzantı içinde bulunan dosyaları değil, aynı zamanda **keyfi kodu da yürütmeye olanak tanır**. İlk API, JavaScript kodunu bir dize olarak iletmeyi sağlarken, ikincisi enjeksiyon güvenlik açıklarına daha az duyarlı olan bir JavaScript işlevi bekler. Yine de, her iki API de yanlış kullanıldığında ciddi sorunlara yol açabilir.

{% hint style="danger" %}
Yukarıdaki yeteneklerin yanı sıra, içerik betikleri örneğin **web sayfalarına girilen kimlik bilgilerini** ele geçirebilir. Bunları kötüye kullanmanın klasik yollarından biri her web sitesine **reklam enjekte etmektir**. Haber sitelerinin güvenilirliğini kötüye kullanmak için **dolandırıcılık mesajları eklemek** de mümkündür. Son olarak, bankacılık web sitelerini **para transferlerini yeniden yönlendirmek için manipüle edebilirler.**
{% endhint %}

### Dolaylı ayrıcalıklar <a href="#implicit-privileges" id="implicit-privileges"></a>

Bazı uzantı ayrıcalıkları **açıkça bildirilmek zorunda değildir**. Bir örnek, [sekme API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) dir: temel işlevselliğine hiçbir ayrıcalık olmadan erişilebilir. Herhangi bir uzantı, açtığınız ve kapattığınız sekmeler hakkında bilgilendirilebilir, ancak bu sekmelerin hangi web sitesine karşılık geldiğini bilemeyecektir.

Çok zararsız görünüyor mu? [tabs.create() API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) biraz daha az zararlıdır. Yeni bir sekme oluşturmak için kullanılabilir, temelde herhangi bir web sitesi tarafından çağrılabilen [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open) ile aynıdır. Ancak `window.open()` pop-up engeline tabi iken, `tabs.create()` değildir.

{% hint style="danger" %}
Bir uzantı, istediğinde herhangi bir sayıda sekme oluşturabilir.
{% endhint %}

`tabs.create()` parametrelerini incelediğinizde, yeteneklerinin `window.open()`'in kontrol etmesine izin verilenin çok ötesine gittiğini fark edeceksiniz. Ve Firefox, bu API ile `data:` URI'ların kullanılmasına izin vermezken, Chrome'un böyle bir koruması yoktur. **Bu tür URI'ların üst düzeyde kullanımı** [**dolandırıcılık amacıyla kötüye kullanıldığı için yasaklanmıştır**](https://bugzilla.mozilla.org/show\_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) `tabs.create()`'e çok benzer ancak **mevcut bir sekmeyi değiştirir**. Bu nedenle, kötü niyetli bir uzantı örneğin reklam sayfasını keyfi olarak sekmelerinizden birine yükleyebilir ve ilgili sekmeyi de etkinleştirebilir.

### Kamera, coğrafi konum ve arkadaşlar <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Muhtemelen web sitelerinin özel izinler isteyebileceğini biliyorsunuzdur, örneğin web kamerasına (video konferans araçları) veya coğrafi konuma (haritalar) erişmek için. Bu, kötüye kullanım potansiyeli yüksek özelliklerdir, bu nedenle kullanıcılar her seferinde bunu hala istediklerine dair onay vermek zorundadır.

{% hint style="danger" %}
Ancak tarayıcı uzantıları için durum farklıdır. **Tarayıcı uzantısı** [**web kamerasına veya mikrofona erişmek istiyorsa**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)**, izin sadece bir kez istenmelidir**
{% endhint %}

Genellikle, bir uzantı bunu yüklendikten hemen sonra yapar. Bu izin verildiğinde, **web kamerasına her zaman erişilebilir**, hatta kullanıcı bu noktada uzantıyla etkileşimde değilse bile. Evet, bir kullanıcı yalnızca uzantının gerçekten web kamerasına ihtiyacı olduğunda bu izni kabul eder. Ancak bundan sonra uzantının gizlice herhangi bir şey kaydetmemesi için uzantıya güvenmek zorundadır.

[**Tam olarak coğrafi konumunuz**](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) veya [**panonuzun içeriği**](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard\_API) erişimine, açıkça izin verme gerekmez. **Bir uzantı sadece manifestosunun** [**izinler girişine**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **`geolocation` veya `clipboard` ekler.** Bu erişim ayrıcalıkları, uzantı yüklendiğinde zımni olarak verilir. Bu nedenle, bu ayrıcalıklara sahip kötü niyetli veya tehlikeye atılmış bir uzantı, fark etmeden hareket profilinizi oluşturabilir veya panonuzu kopyalanan şifreler için izleyebilir.

[**history`** anahtarını uzantı manifestosunun [izinler girişine](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) eklemek, **kullanıcının tüm gezinme geçmişine** [**erişim sağlar**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history). Bu, kullanıcının bu web sitelerini tekrar ziyaret etmesini beklemeksizin tüm gezinme geçmişini almayı mümkün kılar.

**`bookmarks`** **izin** benzer kötüye kullanım potansiyeline sahiptir, bu izin **tüm yer işaretlerini** [**yer işaretleri API'si**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks) **aracılığıyla okumayı sağlar.**

### Depolama izni <a href="#the-storage-permission" id="the-storage-permission"></a>

Uzantı depolama alanı yalnızca bir anahtar-değer koleksiyonudur, herhangi bir web sitesinin kullanabileceği [localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) ile çok benzerdir. Bu nedenle burada hassas bilgiler saklanmamalıdır.

Ancak, reklam şirketleri de bu depolamayı kötüye kullanabilir.

### Daha fazla izin

[**Bir Chromium Tarayıcı Uzantısının isteyebileceği izinlerin tam listesini burada bulabilirsiniz**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) ve [**Firefox uzantıları için tam listeyi burada bulabilirsiniz**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**
## **Referanslar**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>Sıfırdan kahraman olmak için AWS hackleme öğrenin</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks'ı desteklemenin diğer yolları:

* **Şirketinizi HackTricks'te reklamını görmek istiyorsanız** veya **HackTricks'i PDF olarak indirmek istiyorsanız** [**ABONELİK PLANLARI**](https://github.com/sponsors/carlospolop)'na göz atın!
* [**Resmi PEASS & HackTricks ürünlerini**](https://peass.creator-spring.com) edinin
* [**The PEASS Family'yi**](https://opensea.io/collection/the-peass-family) keşfedin, özel [**NFT'lerimiz**](https://opensea.io/collection/the-peass-family) koleksiyonumuz
* **💬 [**Discord grubuna**](https://discord.gg/hRep4RUj7f) veya [**telegram grubuna**](https://t.me/peass) **katılın veya** bizi **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**'da takip edin.**
* **Hacking püf noktalarınızı paylaşarak PR'lar göndererek** [**HackTricks**](https://github.com/carlospolop/hacktricks) ve [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github depolarına katkıda bulunun.

</details>
