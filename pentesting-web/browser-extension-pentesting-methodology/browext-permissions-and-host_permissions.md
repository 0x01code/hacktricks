# BrowExt - permessi e host\_permissions

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai** [**HackTricks**](https://github.com/carlospolop/hacktricks) **e ai** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **repository di github.**

</details>

## Informazioni di base

### **`permissions`**

I permessi sono definiti nel file **`manifest.json`** dell'estensione utilizzando la propriet√† **`permissions`** e consentono l'accesso a quasi tutto ci√≤ a cui un browser pu√≤ accedere (Cookie o Storage fisico):

Il manifesto precedente dichiara che l'estensione richiede il permesso `storage`. Ci√≤ significa che pu√≤ utilizzare [l'API di storage](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) per memorizzare i suoi dati in modo persistente. A differenza dei cookie o delle API `localStorage` che danno agli utenti un certo livello di controllo, **lo storage dell'estensione pu√≤ essere normalmente cancellato solo disinstallando l'estensione**.

Un'estensione richieder√† i permessi indicati nel suo file **`manifest.json`** e dopo l'installazione dell'estensione, √® possibile **verificare sempre i suoi permessi nel browser**, come mostrato in questa immagine:

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

√à possibile trovare l'[**elenco completo dei permessi che un'estensione del browser Chromium pu√≤ richiedere qui**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) e un [**elenco completo per le estensioni di Firefox qui**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

### `host_permissions`

L'impostazione opzionale ma potente **`host_permissions`** indica con quali host l'estensione sar√† in grado di interagire tramite API come [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) e [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs).

Le seguenti `host_permissions` consentono essenzialmente a ogni sito web:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
Questi sono gli host a cui l'estensione del browser pu√≤ accedere liberamente. Ci√≤ accade perch√© quando un'estensione del browser chiama **`fetch("https://gmail.com/")`** non √® limitata da CORS.

## Abuso di `permissions` e `host_permissions`

### Schede

Inoltre, **`host_permissions`** sblocca anche la "funzionalit√† avanzata" dell'[API delle schede](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs). Consentono all'estensione di chiamare [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) e non solo ottenere un elenco delle schede del browser dell'utente, ma anche sapere quale pagina web (indirizzo e titolo) √® caricata.

{% hint style="danger" %}
Non solo questo, anche i listener come [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) diventano molto pi√π utili. Verranno notificati ogni volta che una nuova pagina viene caricata in una scheda.
{% endhint %}

### Esecuzione di script di contenuto <a href="#running-content-scripts" id="running-content-scripts"></a>

Gli script di contenuto non sono necessariamente scritti staticamente nel manifesto dell'estensione. Con sufficienti **`host_permissions`**, le estensioni possono anche caricarli dinamicamente chiamando [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) o [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript).

Entrambe le API consentono di eseguire non solo file contenuti nell'estensione come script di contenuto, ma anche **codice arbitrario**. La prima consente di passare il codice JavaScript come stringa, mentre la seconda si aspetta una funzione JavaScript che √® meno soggetta a vulnerabilit√† di injection. Tuttavia, entrambe le API possono causare danni se utilizzate in modo errato.

{% hint style="danger" %}
Oltre alle capacit√† sopra elencate, gli script di contenuto potrebbero ad esempio intercettare le credenziali mentre vengono inserite nelle pagine web. Un modo classico per abusarne √® l'inserimento di pubblicit√† su ogni sito web. √à anche possibile aggiungere messaggi di truffa per abusare della credibilit√† dei siti di notizie. Infine, potrebbero manipolare i siti web bancari per dirottare i trasferimenti di denaro.
{% endhint %}

### Privilegi impliciti <a href="#implicit-privileges" id="implicit-privileges"></a>

Alcuni privilegi delle estensioni **non devono essere dichiarati esplicitamente**. Un esempio √® l'API delle schede: la sua funzionalit√† di base √® accessibile senza alcun privilegio. Qualsiasi estensione pu√≤ essere notificata quando si aprono e si chiudono schede, semplicemente non sapr√† a quale sito web corrispondono queste schede.

Sembra innocuo? L'API [tabs.create()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) √® un po' meno innocua. Pu√≤ essere utilizzata per **creare una nuova scheda**, essenzialmente la stessa cosa di [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open) che pu√≤ essere chiamato da qualsiasi sito web. Tuttavia, mentre `window.open()` √® soggetto al blocco dei popup, `tabs.create()` non lo √®.

{% hint style="danger" %}
Un'estensione pu√≤ creare quante schede desidera quando vuole.
{% endhint %}

Se si esaminano i possibili parametri di `tabs.create()`, si noter√† che le sue capacit√† vanno ben oltre quelle consentite a `window.open()`. E se Firefox non consente l'utilizzo di URI `data:` con questa API, Chrome non ha questa protezione. **L'uso di tali URI al livello superiore √® stato** [**vietato a causa dell'abuso per il phishing**](https://bugzilla.mozilla.org/show_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) √® molto simile a `tabs.create()` ma **modificher√† una scheda esistente**. Quindi un'estensione maligna pu√≤ ad esempio caricare arbitrariamente una pagina pubblicitaria in una delle tue schede e pu√≤ anche attivare la scheda corrispondente.

### Webcam, geolocalizzazione e amici <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Probabilmente sai che i siti web possono richiedere autorizzazioni speciali, ad esempio per accedere alla tua webcam (strumenti di videoconferenza) o alla tua posizione geografica (mappe). Queste sono funzionalit√† con un notevole potenziale di abuso, quindi gli utenti devono confermare ogni volta che desiderano ancora concedere tali autorizzazioni.

{% hint style="danger" %}
Non √® cos√¨ per le estensioni del browser. **Se un'estensione del browser** [**vuole accedere alla tua webcam o al tuo microfono**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)**, deve chiedere l'autorizzazione solo una volta**
{% endhint %}

Di solito, un'estensione lo fa immediatamente dopo essere stata installata. Una volta accettata questa richiesta, **l'accesso alla webcam √® possibile in qualsiasi momento**, anche se l'utente non sta interagendo con l'estensione in quel momento. S√¨, un utente accetter√† questa richiesta solo se l'estensione ha davvero bisogno dell'accesso alla webcam. Ma dopo ci√≤, l'utente deve fidarsi dell'estensione di non registrare nulla in segreto.

Con l'accesso alla [tua posizione geografica esatta](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) o al [contenuto della tua clipboard](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API), non √® necessario concedere esplicitamente l'autorizzazione. **Un'estensione aggiunge semplicemente `geolocation` o `clipboard` all'** [**entry delle autorizzazioni**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **del suo manifesto**. Questi privilegi di accesso vengono quindi concessi implicitamente quando l'estensione viene installata. Quindi un'estensione maligna o compromessa con questi privilegi pu√≤ creare il tuo profilo di movimento o monitorare la tua clipboard per le password copiate senza che tu te ne accorga.

Aggiungendo la parola chiave **`history`** all'**entry delle autorizzazioni** del manifesto dell'estensione si ottiene l'**accesso all'** [**API della cronologia**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history). Consente di recuperare tutta la cronologia di navigazione dell'utente in una sola volta, senza dover aspettare che l'utente visiti nuovamente questi siti web.

Il **permesso dei segnalibri** ha un potenziale di abuso simile, questo permette di **leggere tutti i segnalibri tramite l'** [**API dei segnalibri**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks).

### Permesso di archiviazione <a href="#the-storage-permission" id="the-storage-permission"></a>

L'archiviazione dell'estensione √® semplicemente una raccolta chiave-valore, molto simile a [localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage) che potrebbe essere utilizzato da qualsiasi sito web. Quindi non dovrebbero essere memorizzate informazioni sensibili qui.

Tuttavia, le aziende pubblicitarie potrebbero abusare anche di questa archiviazione.

### Altri permessi

Puoi trovare l'**elenco completo dei permessi che un'estensione del browser Chromium pu√≤ richiedere qui**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) e un [**elenco completo per le estensioni di Firefox qui**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api_permissions)**.**

## Prevenzione <a href="#why-not-restrict-extension-privileges" id="why-not-restrict-extension-privileges"></a>

La politica dello sviluppatore di Google vieta esplicitamente alle estensioni di richiedere pi√π privilegi di quelli necessari per la loro funzionalit√†, mitigando efficacemente le richieste eccessive di autorizzazioni. Un caso in cui un'estensione del
## **Riferimenti**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata in HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di esclusive [**NFT**](https://opensea.io/collection/the-peass-family)
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository github di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
