# BrowExt - Berechtigungen & host_permissions

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## Grundlegende Informationen

### **`Berechtigungen`**

Berechtigungen werden in der Datei **`manifest.json`** der Erweiterung mit der Eigenschaft **`permissions`** definiert und erm√∂glichen den Zugriff auf fast alles, worauf ein Browser zugreifen kann (Cookies oder physischer Speicher):

Das vorherige Manifest erkl√§rt, dass die Erweiterung die Berechtigung `storage` ben√∂tigt. Dies bedeutet, dass sie die [Speicher-API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) verwenden kann, um ihre Daten dauerhaft zu speichern. Im Gegensatz zu Cookies oder `localStorage`-APIs, die den Benutzern ein gewisses Ma√ü an Kontrolle geben, **kann der Erweiterungsspeicher normalerweise nur durch Deinstallieren der Erweiterung gel√∂scht werden**.

Eine Erweiterung fordert die Berechtigungen an, die in ihrer **`manifest.json`**-Datei angegeben sind, und nach der Installation der Erweiterung k√∂nnen Sie **immer ihre Berechtigungen in Ihrem Browser √ºberpr√ºfen**, wie in diesem Bild gezeigt:

<figure><img src="../../.gitbook/assets/image (2) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Sie finden die [**vollst√§ndige Liste der Berechtigungen, die eine Chromium-Browsererweiterung anfordern kann, hier**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) und eine [**vollst√§ndige Liste f√ºr Firefox-Erweiterungen hier**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

### `host_permissions`

Die optionale, aber leistungsstarke Einstellung **`host_permissions`** gibt an, mit welchen Hosts die Erweiterung √ºber APIs wie [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) und [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) interagieren kann.

Die folgenden `host_permissions` erlauben im Grunde jeder Webseite:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
Dies sind die Hosts, auf die die Browsererweiterung frei zugreifen kann. Dies liegt daran, dass, wenn eine Browsererweiterung **`fetch("https://gmail.com/")`** aufruft, sie nicht durch CORS eingeschr√§nkt ist.

## Missbrauch von `permissions` und `host_permissions`

### Tabs

Dar√ºber hinaus entsperren **`host_permissions`** auch die "fortgeschrittene" [**Tabs-API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **Funktionalit√§t**. Sie erm√∂glichen es der Erweiterung, [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) aufzurufen und nicht nur eine **Liste der Browser-Tabs des Benutzers** zur√ºckzuerhalten, sondern auch zu erfahren, welche **Webseite (d.h. Adresse und Titel) geladen ist**.

{% hint style="danger" %}
Nicht nur das, auch Listener wie [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) **werden ebenfalls viel n√ºtzlicher**. Diese werden benachrichtigt, wann immer eine neue Seite in einem Tab geladen wird.
{% endhint %}

### Ausf√ºhren von Inhalts-Skripten <a href="#running-content-scripts" id="running-content-scripts"></a>

Inhaltsskripte sind nicht unbedingt statisch in das Erweiterungsmanifest geschrieben. Bei ausreichenden **`host_permissions`** **k√∂nnen Erweiterungen sie auch dynamisch laden, indem sie** [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) **oder** [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript) **aufrufen**.

Beide APIs erm√∂glichen nicht nur die Ausf√ºhrung von Dateien, die in den Erweiterungen als Inhalts-Skripte enthalten sind, sondern auch **beliebigen Code**. Ersteres erm√∂glicht das √úbergeben von JavaScript-Code als Zeichenfolge, w√§hrend letzteres eine JavaScript-Funktion erwartet, die weniger anf√§llig f√ºr Injection-Schwachstellen ist. Dennoch werden beide APIs Chaos anrichten, wenn sie missbraucht werden.

{% hint style="danger" %}
Zus√§tzlich zu den oben genannten F√§higkeiten k√∂nnten Inhaltsskripte beispielsweise **Anmeldeinformationen abfangen**, die in Webseiten eingegeben werden. Eine weitere klassische M√∂glichkeit, sie zu missbrauchen, besteht darin, **Werbung einzuf√ºgen** auf jeder Website. Das Hinzuf√ºgen von **Betrugsnachrichten** zur Ausnutzung der Glaubw√ºrdigkeit von Nachrichtenwebsites ist ebenfalls m√∂glich. Schlie√ülich k√∂nnten sie **Banking**-Websites manipulieren, um Geldtransfers umzuleiten.
{% endhint %}

### Implizite Berechtigungen <a href="#implicit-privileges" id="implicit-privileges"></a>

Einige Erweiterungsberechtigungen **m√ºssen nicht explizit deklariert werden**. Ein Beispiel ist die [Tabs-API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs): Ihre grundlegende Funktionalit√§t ist ohne jegliche Berechtigungen zug√§nglich. Jede Erweiterung kann benachrichtigt werden, wenn Sie Tabs √∂ffnen und schlie√üen, sie wird lediglich nicht wissen, mit welcher Website diese Tabs korrespondieren.

Klingt zu harmlos? Die [tabs.create() API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) ist etwas weniger harmlos. Sie kann verwendet werden, um **einen neuen Tab zu erstellen**, im Grunde dasselbe wie [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open), das von jeder Website aufgerufen werden kann. W√§hrend `window.open()` jedoch dem **Pop-up-Blocker unterliegt, `tabs.create()` nicht**.

{% hint style="danger" %}
Eine Erweiterung kann jederzeit beliebig viele Tabs erstellen.
{% endhint %}

Wenn Sie sich die m√∂glichen Parameter von `tabs.create()` ansehen, werden Sie auch feststellen, dass seine F√§higkeiten weit √ºber das hinausgehen, was `window.open()` steuern darf. Und w√§hrend Firefox die Verwendung von `data:` URIs mit dieser API nicht erlaubt, hat Chrome keinen solchen Schutz. **Die Verwendung solcher URIs auf der obersten Ebene wurde** [**verboten, weil sie f√ºr Phishing missbraucht wurden**](https://bugzilla.mozilla.org/show\_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) ist dem `tabs.create()` sehr √§hnlich, wird jedoch **einen vorhandenen Tab √§ndern**. So kann eine b√∂sartige Erweiterung beispielsweise willk√ºrlich eine Werbeseite in einen Ihrer Tabs laden und den entsprechenden Tab auch aktivieren.

### Webcam, Geolokalisierung und Co. <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Sie wissen wahrscheinlich, dass Websites spezielle Berechtigungen anfordern k√∂nnen, z.B. um auf Ihre Webcam (Videokonferenztools) oder geografischen Standort (Karten) zuzugreifen. Es sind Funktionen mit erheblichem Missbrauchspotenzial, sodass Benutzer jedes Mal best√§tigen m√ºssen, dass sie dies noch m√∂chten.

{% hint style="danger" %}
Nicht so bei Browsererweiterungen. **Wenn eine Browsererweiterung** [**Zugriff auf Ihre Webcam oder Mikrofon**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)** m√∂chte, muss sie dies nur einmal** anfordern.
{% endhint %}

Normalerweise wird eine Erweiterung dies sofort nach der Installation tun. Sobald diese Aufforderung akzeptiert wurde, ist **der Zugriff auf die Webcam jederzeit** m√∂glich, auch wenn der Benutzer zu diesem Zeitpunkt nicht mit der Erweiterung interagiert. Ja, ein Benutzer wird diese Aufforderung nur akzeptieren, wenn die Erweiterung wirklich Zugriff auf die Webcam ben√∂tigt. Aber danach muss er der Erweiterung vertrauen, nichts heimlich aufzuzeichnen.

Mit Zugriff auf [Ihren genauen geografischen Standort](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) oder [Inhalte Ihrer Zwischenablage](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard\_API) ist eine explizite Genehmigung √ºberhaupt nicht erforderlich. **Eine Erweiterung f√ºgt einfach `geolocation` oder `clipboard` zum** [**Berechtigungseintrag**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **in ihrem Manifest hinzu**. Diese Zugriffsrechte werden dann implizit erteilt, wenn die Erweiterung installiert ist. So kann eine b√∂sartige oder kompromittierte Erweiterung mit diesen Berechtigungen Ihr Bewegungsprofil erstellen oder Ihre Zwischenablage auf kopierte Passw√∂rter √ºberwachen, ohne dass Sie etwas bemerken.

Das Hinzuf√ºgen des Schl√ºsselworts **`history`** zum [Berechtigungseintrag](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) des Erweiterungsmanifests gew√§hrt **Zugriff auf die** [**History-API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/history). Es erm√∂glicht das Abrufen der gesamten Browser-Historie des Benutzers auf einmal, ohne darauf zu warten, dass der Benutzer diese Websites erneut besucht.

Die **`bookmarks`** **Berechtigung** hat ein √§hnliches Missbrauchspotenzial, sie erm√∂glicht es, **alle Lesezeichen √ºber die** [**Bookmarks-API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/bookmarks) **auszulesen**.

### Speicherberechtigung <a href="#the-storage-permission" id="the-storage-permission"></a>

Der Speicher der Erweiterung ist lediglich eine Schl√ºssel-Wert-Sammlung, sehr √§hnlich zu [localStorage](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage), das von jeder Website verwendet werden k√∂nnte. Daher sollten hier keine sensiblen Informationen gespeichert werden.

Jedoch k√∂nnten auch Werbeunternehmen diesen Speicher missbrauchen.

### Weitere Berechtigungen

Sie finden die [**vollst√§ndige Liste der Berechtigungen, die eine Chromium-Browsererweiterung anfordern kann, hier**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) und eine [**vollst√§ndige Liste f√ºr Firefox-Erweiterungen hier**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

## Pr√§vention <a href="#why-not-restrict-extension-privileges" id="why-not-restrict-extension-privileges"></a>

Die Richtlinie von Googles Entwickler untersagt ausdr√ºcklich Erweiterungen, die mehr Berechtigungen anfordern, als f√ºr ihre Funktionalit√§t notwendig sind, um √ºberm√§√üige Berechtigungsanfragen wirksam zu reduzieren. Ein Beispiel, bei dem eine Browsererweiterung diese Grenze √ºberschritten hat, war ihre Verteilung mit dem Browser selbst anstelle √ºber einen Add-On-Store.

Browser k√∂nnten den Missbrauch von Erweiterungsberechtigungen weiter einschr√§nken. Beispielsweise sind Chromes [tabCapture](https://developer.chrome.com/docs/extensions/reference/tabCapture/) und [desktopCapture](https://developer.chrome.com/docs/extensions/reference/desktopCapture/) APIs, die f√ºr die Bildschirmaufzeichnung verwendet werden, darauf ausgelegt, Missbrauch zu minimieren. Die tabCapture-API kann nur durch direkte Benutzerinteraktion aktiviert werden, z. B. durch Klicken auf das Erweiterungssymbol, w√§hrend desktopCapture eine Benutzerbest√§tigung f√ºr die Aufzeichnung des Fensters erfordert, um heimliche Aufzeichnungsaktivit√§ten zu verhindern.

Das Versch√§rfen von Sicherheitsma√ünahmen f√ºhrt jedoch oft zu einer verringerten Flexibilit√§t und Benutzerfreundlichkeit von Erweiterungen. Die [activeTab-Berechtigung](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#activetab\_permission) verdeutlicht diesen Kompromiss. Sie wurde eingef√ºhrt, um die Notwendigkeit zu beseitigen, dass Erweiterungen Host-Berechtigungen im gesamten Internet anfordern m√ºssen, und erm√∂glicht es Erweiterungen, nur auf den aktuellen Tab zuzugreifen, wenn der Benutzer dies explizit aktiviert. Dieses Modell ist effektiv f√ºr Erweiterungen, die benutzerinitiierte Aktionen erfordern, aber weniger geeignet f√ºr solche, die automatische oder vorbeugende Ma√ünahmen erfordern, was die Bequemlichkeit und sofortige Reaktionsf√§higkeit beeintr√§chtigt.
## **Referenzen**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
