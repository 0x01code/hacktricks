# BrowExt - άδειες & host\_permissions

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Βασικές Πληροφορίες

### **`permissions`**

Οι άδειες καθορίζονται στο αρχείο **`manifest.json`** της επέκτασης χρησιμοποιώντας την ιδιότητα **`permissions`** και επιτρέπουν πρόσβαση σε σχεδόν οτιδήποτε μπορεί να προσπελάσει ένας περιηγητής (Cookies ή Φυσική Αποθήκευση):

Το προηγούμενο manifest δηλώνει ότι η επέκταση απαιτεί την άδεια `storage`. Αυτό σημαίνει ότι μπορεί να χρησιμοποιήσει [το API αποθήκευσης](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) για να αποθηκεύσει τα δεδομένα της με αντοχή. Αντίθετα από τα cookies ή τα APIs του `localStorage` που δίνουν στους χρήστες κάποιο επίπεδο ελέγχου, **η αποθήκευση της επέκτασης μπορεί συνήθως να διαγραφεί μόνο με την απεγκατάσταση της επέκτασης**.

Μια επέκταση θα ζητήσει τις άδειες που αναφέρονται στο αρχείο **`manifest.json`** της και μετά την εγκατάσταση της επέκτασης, μπορείτε **πάντα να ελέγξετε τις άδειές της στον περιηγητή σας**, όπως φαίνεται σε αυτήν την εικόνα:

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

Μπορείτε να βρείτε την [**πλήρη λίστα των άδειων που μπορεί να ζητήσει μια επέκταση περιηγητή Chromium εδώ**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) και μια [**πλήρη λίστα για επεκτάσεις Firefox εδώ**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

### `host_permissions`

Η προαιρετική αλλά ισχυρή ρύθμιση **`host_permissions`** υποδεικνύει με ποιούς hosts η επέκταση θα μπορεί να αλληλεπιδράσει μέσω των διεπαφών όπως [`cookies`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`webRequest`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest) και [`tabs`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs).

Οι παρακάτω `host_permissions` επιτρέπουν ουσιαστικά σε κάθε ιστοσελίδα:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
Αυτοί είναι οι κεντρικοί υπολογιστές που η προσθήκη του προγράμματος περιήγησης μπορεί να έχει πρόσβαση ελεύθερα. Αυτό συμβαίνει επειδή όταν μια προσθήκη περιήγησης καλεί την **`fetch("https://gmail.com/")`** δεν περιορίζεται από το CORS.

## Κατάχρηση των `permissions` και `host_permissions`

### Καρτέλες

Επιπλέον, οι **`host_permissions`** ξεκλειδώνουν επίσης την "προηγμένη" [**tabs API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **λειτουργικότητα**. Επιτρέπουν στην προσθήκη να καλέσει την [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) και όχι μόνο να λάβει μια **λίστα με τις καρτέλες του προγράμματος περιήγησης του χρήστη**, αλλά και να μάθει ποια **ιστοσελίδα (διεύθυνση και τίτλος) είναι φορτωμένη**.

{% hint style="danger" %}
Όχι μόνο αυτό, οι ακροατές όπως ο [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) γίνονται επίσης πολύ πιο χρήσιμοι. Θα ειδοποιούνται κάθε φορά που φορτώνεται μια νέα σελίδα σε μια καρτέλα.
{% endhint %}

### Εκτέλεση σεναρίων περιεχομένου <a href="#running-content-scripts" id="running-content-scripts"></a>

Τα σενάρια περιεχομένου δεν απαιτούνται απαραίτητα να γραφούν στατικά στο αρχείο προσθήκης. Δεδομένων των επαρκών **`host_permissions`**, οι προσθήκες μπορούν επίσης να τα φορτώσουν δυναμικά καλώντας τις [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) ή [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript).

Και οι δύο διεπαφές επιτρέπουν την εκτέλεση όχι μόνο αρχείων που περιέχονται στην προσθήκη ως σενάρια περιεχομένου, αλλά και **αυθαίρετου κώδικα**. Η πρώτη επιτρέπει την παράδοση κώδικα JavaScript ως συμβολοσειρά, ενώ η δεύτερη αναμένει μια συνάρτηση JavaScript που είναι λιγότερο ευάλωτη σε ευπάθειες ενέσεων. Παρόλα αυτά, και οι δύο διεπαφές θα προκαλέσουν προβλήματα αν χρησιμοποιηθούν εσφαλμένα.

{% hint style="danger" %}
Εκτός από τις παραπάνω δυνατότητες, τα σενάρια περιεχομένου μπορούν για παράδειγμα να **παρακολουθήσουν διαπιστευτήρια** καθώς αυτά εισάγονται σε ιστοσελίδες. Ένας κλασικός τρόπος κατάχρησής τους είναι η **εισαγωγή διαφημίσεων** σε κάθε ιστοσελίδα. Είναι επίσης δυνατή η προσθήκη **απάτης μηνυμάτων** για να καταχραστεί η αξιοπιστία ιστοτόπων ειδήσεων. Τέλος, μπορούν να **παρεμβάλλουν τραπεζικές** ιστοσελίδες για να ανακατευθύνουν μεταφορές χρημάτων.
{% endhint %}

### Προνόμια υπονοούμενα <a href="#implicit-privileges" id="implicit-privileges"></a>

Ορισμένα προνόμια της προσθήκης **δεν χρειάζεται να δηλωθούν ρητά**. Ένα παράδειγμα είναι η [tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs): η βασική της λειτουργικότητα είναι προσβάσιμη χωρίς κανένα προνόμιο. Οποιαδήποτε προσθήκη μπορεί να ειδοποιηθεί όταν ανοίγετε και κλείνετε καρτέλες, απλώς δεν θα γνωρίζει ποια ιστοσελίδα αντιστοιχεί σε αυτές τις καρτέλες.

Σας φαίνεται ακίνδυνο; Η [tabs.create() API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) είναι κάπως λιγότερο ακίνδυνη. Μπ
## **Αναφορές**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
