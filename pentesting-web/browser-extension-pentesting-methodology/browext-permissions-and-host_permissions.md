# BrowExt - ruhusu & ruhusu za mwenyeji

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inayotangazwa katika HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Taarifa Msingi

### **`ruhusu`**

Ruhusu zinatambuliwa katika faili ya **`manifest.json`** ya nyongeza kwa kutumia mali ya **`ruhusu`** na kuruhusu ufikiaji wa karibu kila kitu ambacho kivinjari kinaweza kufikia (Vidakuzi au Uhifadhi wa Kimwili):

Kielelezo kilichopita kinatangaza kuwa nyongeza inahitaji ruhusu ya `uhifadhi`. Hii inamaanisha kuwa inaweza kutumia [API ya uhifadhi](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) kuweka data yake kwa muda mrefu. Tofauti na vidakuzi au API ya `localStorage` ambayo humpa mtumiaji kiwango fulani cha udhibiti, **uhifadhi wa nyongeza kawaida unaweza kufutwa tu kwa kufuta nyongeza**.

Nyongeza itaomba ruhusa zilizoonyeshwa katika faili yake ya **`manifest.json`** na Baada ya kusakinisha nyongeza, unaweza **kuangalia ruhusa zake kila wakati kwenye kivinjari chako**, kama inavyoonyeshwa kwenye picha hii:

<figure><img src="../../.gitbook/assets/image (2) (1).png" alt=""><figcaption></figcaption></figure>

Unaweza kupata [**orodha kamili ya ruhusu ambazo Nyongeza ya Kivinjari cha Chromium inaweza kuomba hapa**](https://developer.chrome.com/docs/extensions/develop/concepts/declare-permissions#permissions) na [**orodha kamili kwa nyongeza za Firefox hapa**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions#api\_permissions)**.**

### `ruhusu za mwenyeji`

Mazingira ya hiari lakini yenye nguvu ya **`ruhusu za mwenyeji`** inaonyesha ni mwenyeji gani nyongeza itaweza kuingiliana nayo kupitia apis kama vile [`vidakuzi`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/cookies), [`ombi la wavuti`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/webRequest), na [`vichupo`](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs).

Ruhusa za `ruhusu za mwenyeji` zifuatazo kimsingi huruhusu kila wavuti:
```json
"host_permissions": [
"*://*/*"
]

// Or:
"host_permissions": [
"http://*/*",
"https://*/*"
]

// Or:
"host_permissions": [
"<all_urls>"
]
```
Hizi ndizo seva ambazo kivinjari cha nyongeza kinaweza kufikia kwa uhuru. Hii ni kwa sababu wakati kivinjari cha nyongeza kinaita **`fetch("https://gmail.com/")`** haizuiliwi na CORS.

## Kutumia `permissions` na `host_permissions`

### Vichupo

Zaidi ya hayo, **`host_permissions`** pia hufungua "advanced" [**tabs API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) **kazi.** Inaruhusu nyongeza kuita [tabs.query()](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query) na sio tu kupata **orodha ya vichupo vya kivinjari cha mtumiaji** lakini pia kujua ni **ukurasa wa wavuti (maana yake anwani na kichwa) uliopakia**.

{% hint style="danger" %}
Sio hivyo tu, wasikilizaji kama [**tabs.onUpdated**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/onUpdated) **pia huwa na manufaa zaidi**. Hizi zitapokea taarifa wakati wowote ukurasa mpya unapakia kwenye kichupo.
{% endhint %}

### Kutekeleza hati za maudhui <a href="#running-content-scripts" id="running-content-scripts"></a>

Hati za maudhui hazihitaji kuandikwa kwa njia ya msingi kwenye hati ya nyongeza. Kwa kuzingatia **`host_permissions`** za kutosha, nyongeza pia inaweza kuzipakia kwa njia ya kudumu kwa kuita [**tabs.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript) **au** [**scripting.executeScript()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/scripting/executeScript).

Zote mbili zinaruhusu kutekeleza sio tu faili zilizomo kwenye nyongeza kama hati za maudhui lakini pia **nambari za kiholela**. Ya kwanza inaruhusu kuwasilisha nambari ya JavaScript kama herufi wakati ya pili inatarajia kazi ya JavaScript ambayo ni dhaifu zaidi kwa mashambulizi ya kuingiza. Hata hivyo, zote mbili zinaweza kusababisha madhara ikitumiwa vibaya.

{% hint style="danger" %}
Mbali na uwezo ulioelezewa hapo juu, hati za maudhui zinaweza kwa mfano **kukamata siri** wakati zinaingizwa kwenye kurasa za wavuti. Njia nyingine ya kawaida ya kuzitumia vibaya ni **kuweka matangazo** kwenye kila tovuti. Kuongeza **ujumbe wa udanganyifu** ili kudhoofisha uaminifu wa tovuti za habari pia ni jambo linalowezekana. Hatimaye, zinaweza **kubadilisha tovuti za benki** ili kubadilisha uhamisho wa pesa.
{% endhint %}

### Uwezo wa kutoa ruhusa kwa siri <a href="#implicit-privileges" id="implicit-privileges"></a>

Baadhi ya uwezo wa nyongeza **hauhitaji kutangazwa wazi**. Mfano mmoja ni [tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs): uwezo wake wa msingi unapatikana bila ruhusa yoyote. Nyongeza yoyote inaweza kupokea taarifa wakati unafungua na kufunga vichupo, lakini haitajua tovuti gani hizo vichupo vinahusiana nazo.

Inasikika kuwa salama sana? [tabs.create() API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/create) sio hivyo kabisa. Inaweza kutumika ku **kuunda kichupo kipya**, sawa na [window.open()](https://developer.mozilla.org/en-US/docs/Web/API/Window/open) ambayo inaweza kuitwa na tovuti yoyote. Lakini wakati `window.open()` inazuiliwa na **kizuizi cha pop-up, `tabs.create()` haizuiwi**.

{% hint style="danger" %}
Nyongeza inaweza kuunda idadi yoyote ya vichupo wakati wowote inapotaka.
{% endhint %}

Ukiangalia kupitia vigezo vinavyowezekana vya `tabs.create()`, utaona pia kuwa uwezo wake unazidi ule wa `window.open()`. Na wakati Firefox haikubali matumizi ya URI za `data:` na API hii, Chrome haina ulinzi kama huo. **Matumizi ya URI kama hizo kwenye kiwango cha juu zimepigwa marufuku kwa sababu zilitumiwa vibaya kwa ajili ya ulaghai** [**(phishing)**](https://bugzilla.mozilla.org/show_bug.cgi?id=1331351)**.**

[**tabs.update()**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/update) ni sawa sana na `tabs.create()` lakini ita **badilisha kichupo kilichopo**. Kwa hivyo, nyongeza yenye nia mbaya inaweza kwa mfano kupakia ukurasa wa matangazo kwa hiari kwenye moja ya vichupo vyako, na inaweza pia kuamsha kichupo kinachohusiana.

### Kamera, mahali na marafiki <a href="#webcam-geolocation-and-friends" id="webcam-geolocation-and-friends"></a>

Labda unajua kuwa tovuti zinaweza kuomba ruhusa maalum, kwa mfano kupata kamera yako (zana za mkutano wa video) au mahali ulipo (ramani). Hizi ni huduma zenye uwezo mkubwa wa kutumiwa vibaya, kwa hivyo watumiaji wanapaswa kuthibitisha mara kwa mara kuwa bado wanataka kutoa ruhusa hii.

{% hint style="danger" %}
Sio hivyo kwa nyongeza za kivinjari. **Ikiwa nyongeza ya kivinjari** [**inataka kupata kamera yako au kipaza sauti**](https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia)**, inahitaji tu kuomba ruhusa mara moja**
{% endhint %}

Kwa kawaida, nyongeza itafanya hivyo mara tu baada ya kusakinishwa. Mara tu kibali hiki kinapokubaliwa, **upatikanaji wa kamera unawezekana wakati wowote**, hata ikiwa mtumiaji hafanyi mwingiliano na nyongeza wakati huu. Ndiyo, mtumiaji atakubali kibali hiki tu ikiwa nyongeza inahitaji kwa kweli upatikanaji wa kamera. Lakini baada ya hapo, wanapaswa kuamini nyongeza hiyo isirekodi kitu kwa siri.

Kwa kupata [eneo lako sahihi](https://developer.mozilla.org/en-US/docs/Web/API/Geolocation) au [maudhui ya ubao wa kunakili](https://developer.mozilla.org/en-US/docs/Web/API/Clipboard_API), kutoa ruhusa kwa uwazi sio muhimu kabisa. **Nyongeza inaweza tu kuongeza `geolocation` au `clipboard` kwenye** [**ingizo la ruhusa**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions) **ya hati yake**. Ruhusa hizi za upatikanaji zinatolewa kwa siri wakati nyongeza inasakinishwa. Kwa hivyo, nyongeza mbaya au iliyodukuliwa yenye ruhusa hizi inaweza kuunda maelezo yako ya harakati au kufuatilia ubao wako wa kunakili kwa nywila zilizokopwa bila wewe kugundua chochote.

Kuongeza neno **`history`** kwenye [ingizo la ruhusa](https://developer.mozilla.org/en-US/docs
## **Marejeo**

* [https://palant.info/2022/08/17/impact-of-extension-privileges/](https://palant.info/2022/08/17/impact-of-extension-privileges/)
* [https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing](https://www.cobalt.io/blog/introduction-to-chrome-browser-extension-security-testing)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa kwenye HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>
