# рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдореЗрдердбреЛрд▓реЙрдЬреА

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert) рдХреЗ рд╕рд╛рде</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рд╣рдорд╛рд░реА рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди JavaScript рдореЗрдВ рд▓рд┐рдЦреЗ рдЬрд╛рддреЗ рд╣реИрдВ рдФрд░ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рджреНрд╡рд╛рд░рд╛ рдкрд┐рдЫрд▓реЗ рдкреНрд▓рд╛рди рдореЗрдВ рд▓реЛрдб рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ [DOM](https://www.w3schools.com/js/js\_htmldom.asp) рд╣реЛрддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдпрд╣ рдЕрдиреНрдп рд╕рд╛рдЗрдЯреЛрдВ рдХреЗ DOM рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрд╣ рдЕрдиреНрдп рд╕рд╛рдЗрдЯреЛрдВ рдХреА рдЧреЛрдкрдиреАрдпрддрд╛, рдЕрдЦрдВрдбрддрд╛, рдФрд░ рдЙрдкрд▓рдмреНрдзрддрд╛ (CIA) рдХреЛ рдХрдордЬреЛрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

## рдореБрдЦреНрдп рдШрдЯрдХ

рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд▓реЗрдЖрдЙрдЯ рдЬрдм рд╡рд┐рдЬреБрдЕрд▓рд╛рдЗрдЬрд╝ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рддреЛ рддреАрди рдШрдЯрдХреЛрдВ рд╕реЗ рдорд┐рд▓рддреЗ рд╣реИрдВред рдЪрд▓рд┐рдП рд╣рд░ рдШрдЯрдХ рдХреЛ рдЧрд╣рд░рд╛рдИ рд╕реЗ рджреЗрдЦрддреЗ рд╣реИрдВред

<figure><img src="../../.gitbook/assets/image (4).png" alt=""><figcaption><p><a href="http://webblaze.cs.berkeley.edu/papers/Extensions.pdf">http://webblaze.cs.berkeley.edu/papers/Extensions.pdf</a></p></figcaption></figure>

### **рдХрдВрдЯреЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕**

рдкреНрд░рддреНрдпреЗрдХ рдХрдВрдЯреЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдкрд╛рд╕ рдПрдХ **рдПрдХрд▓ рд╡реЗрдм рдкреГрд╖реНрда** рдХреЗ DOM рддрдХ рд╕реАрдзрд╛ рдкрд╣реБрдВрдЪ рд╣реЛрддрд╛ рд╣реИ рдФрд░ рдЗрд╕рд▓рд┐рдП **рд╕рдВрднрд╛рд╡рд┐рдд рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рдЗрдирдкреБрдЯ** рдХреЗ рд▓рд┐рдП рдЕрд╡ exposed рд╣реЛрддрд╛ рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХрдВрдЯреЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдХреЛрдИ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдирд╣реАрдВ рд╣реЛрддреАрдВ рдХреЗрд╡рд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛрд░ рдХреЛ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИред

### **рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛрд░**

рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛрд░ рдореЗрдВ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рдЕрдзрд┐рдХрд╛рд░/рдкрд╣реБрдВрдЪ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИ, рд▓реЗрдХрд┐рди рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛрд░ рдХреЗрд╡рд▓ [XMLHttpRequest](https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest) рдФрд░ рдХрдВрдЯреЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡реЗрдм рд╕рд╛рдордЧреНрд░реА рдХреЗ рд╕рд╛рде рдмрд╛рддрдЪреАрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛрд░ рдХреЛ рд╣реЛрд╕реНрдЯ рдорд╢реАрди рдХрд╛ рд╕реАрдзрд╛ рдкрд╣реБрдВрдЪ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред

### **рдиреЗрдЯрд┐рд╡ рдмрд╛рдЗрдирд░реА**

рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдПрдХ рдиреЗрдЯрд┐рд╡ рдмрд╛рдЗрдирд░реА рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкреВрд░реНрдг рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЗ рд╕рд╛рде рд╣реЛрд╕реНрдЯ рдорд╢реАрди рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддрд╛ рд╣реИред рдиреЗрдЯрд┐рд╡ рдмрд╛рдЗрдирд░реА рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛрд░ рдХреЗ рд╕рд╛рде рд╕реНрдЯреИрдВрдбрд░реНрдб рдиреЗрдЯрд╕реНрдХреЗрдк рдкреНрд▓рдЧрдЗрди рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкреНрд░реЛрдЧреНрд░рд╛рдорд┐рдВрдЧ рдЗрдВрдЯрд░рдлреЗрд╕ ([NPAPI](https://en.wikipedia.org/wiki/NPAPI)) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрд╛рддрдЪреАрдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдлреНрд▓реИрд╢ рдФрд░ рдЕрдиреНрдп рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдкреНрд▓рдЧрдЗрдиреНрд╕ рджреНрд╡рд╛рд░рд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

### рд╕реАрдорд╛рдПрдБ

{% hint style="danger" %}
рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдкреВрд░реНрдг рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рджрд┐рд╡реНрдп рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕реЗ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛрд░ рддрдХ рдФрд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛрд░ рд╕реЗ рдиреЗрдЯрд┐рд╡ рдмрд╛рдЗрдирд░реА рддрдХ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рдЗрдирдкреБрдЯ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд░рд╛рдЬреА рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред
{% endhint %}

рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рдШрдЯрдХ рдХреЛ рдПрдХ-рджреВрд╕рд░реЗ рд╕реЗ **рдордЬрдмреВрдд рд╕реБрд░рдХреНрд╖рд╛рддреНрдордХ рд╕реАрдорд╛рдПрдБ** рджреНрд╡рд╛рд░рд╛ рдЕрд▓рдЧ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдкреНрд░рддреНрдпреЗрдХ рдШрдЯрдХ рдПрдХ **рдЕрд▓рдЧ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рдкреНрд░рдХреНрд░рд┐рдпрд╛** рдореЗрдВ рдЪрд▓рддрд╛ рд╣реИред рдХрдВрдЯреЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдФрд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛрд░ **рд╕реИрдВрдбрдмреЙрдХреНрд╕ рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ** рдореЗрдВ рдЪрд▓рддреЗ рд╣реИрдВ рдЬреЛ рдЕрдзрд┐рдХрд╛рдВрд╢ рдСрдкрд░реЗрдЯрд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЕрдиреБрдкрд▓рдмреНрдз рд╣реЛрддреЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдХрдВрдЯреЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдЕрдкрдиреЗ рд╕рдВрдмрдВрдзрд┐рдд рд╡реЗрдм рдкреГрд╖реНрдареЛрдВ рд╕реЗ **рдПрдХ рдЕрд▓рдЧ JavaScript рд╣реАрдк рдореЗрдВ рдЪрд▓рддреЗ рд╣реИрдВ**ред рдХрдВрдЯреЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ рд╡реЗрдм рдкреГрд╖реНрда рдХреЗ рдкрд╛рд╕ **рдПрдХ рд╣реА рдЖрдзрд╛рд░рд┐рдХ DOM** рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рджреЛрдиреЛрдВ **рдХрднреА рднреА JavaScript рдкреЙрдЗрдВрдЯрд░реНрд╕ рдПрдХреНрд╕рдЪреЗрдВрдЬ рдирд╣реАрдВ рдХрд░рддреЗ**, рдЬрд┐рд╕рд╕реЗ JavaScript рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХрд╛ рд▓реАрдХ рд╣реЛрдиреЗ рд╕реЗ рдмрдЪрд╛ рдЬрд╛рддрд╛ рд╣реИред

## **`manifest.json`**

рдПрдХ Chrome рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдмрд╕ рдПрдХ [.crx рдлрд╝рд╛рдЗрд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди](https://www.lifewire.com/crx-file-2620391) рд╡рд╛рд▓реА ZIP рдлрд╝реЛрд▓реНрдбрд░ рд╣реЛрддреА рд╣реИред рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛрд░ рдлрд╝реЛрд▓реНрдбрд░ рдХреА рдореВрд▓ рдлрд╝рд╛рдЗрд▓ **`manifest.json`** рд╣реЛрддреА рд╣реИ, рдЬреЛ рд▓реЗрдЖрдЙрдЯ, рдЕрдиреБрдорддрд┐рдпрд╛рдБ, рдФрд░ рдЕрдиреНрдп рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рд╡рд┐рдХрд▓реНрдкреЛрдВ рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддреА рд╣реИред

рдЙрджрд╛рд╣рд░рдг:
```json
{
"manifest_version": 2,
"name": "My extension",
"version": "1.0",
"permissions": [
"storage"
],
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
"background": {
"scripts": [
"background.js"
]
},
"options_ui": {
"page": "options.html"
}
}
```
### `content_scripts`

рдХрдВрдЯреЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ **рд▓реЛрдб** рд╣реЛрддреЗ рд╣реИрдВ рдЬрдм рднреА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ **рдПрдХ рдорд┐рд▓рддреА рдЬреБрд▓рддреА рдкреЗрдЬ рдкрд░ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░рддрд╛ рд╣реИ**, рд╣рдорд╛рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдХрд┐рд╕реА рднреА рдкреЗрдЬ рдкрд░ рдЬреЛ **`https://example.com/*`** рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рд╕реЗ рдорд┐рд▓рддреА рд╣реИ рдФрд░ **`*://*/*/business*`** рд░реЗрдЬреЗрдХреНрд╕ рд╕реЗ рдорд┐рд▓рддреА рдирд╣реАрдВ рд╣реИред рд╡реЗ рдкреЗрдЬ рдХреЗ рдЕрдкрдиреЗ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреА рддрд░рд╣ **рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд** рд╣реЛрддреЗ рд╣реИрдВ рдФрд░ рдкреЗрдЬ рдХреЗ [рдбреЙрдХреНрдпреВрдореЗрдВрдЯ рдСрдмреНрдЬ
```json
"content_scripts": [
{
"js": [
"script.js"
],
"matches": [
"https://example.com/*",
"https://www.example.com/*"
],
"exclude_matches": ["*://*/*business*"],
}
],
```
рдЕрдзрд┐рдХ URL рд╢рд╛рдорд┐рд▓ рдпрд╛ рдЕрдкрд╡рд░реНрдЬрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **`include_globs`** рдФрд░ **`exclude_globs`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рднреА рд╕рдВрднрд╡ рд╣реИред

рдпрд╣ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╣реИ рдЬреЛ рдкреГрд╖реНрда рдореЗрдВ рдПрдХ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдмрдЯрди рдЬреЛрдбрд╝реЗрдЧрд╛ рдЬрдм [рд╕реНрдЯреЛрд░реЗрдЬ API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/storage) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд╕реНрдЯреЛрд░реЗрдЬ рд╕реЗ `message` рдорд╛рди рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
```js
chrome.storage.local.get("message", result =>
{
let div = document.createElement("div");
div.innerHTML = result.message + " <button>Explain</button>";
div.querySelector("button").addEventListener("click", () =>
{
chrome.runtime.sendMessage("explain");
});
document.body.appendChild(div);
});
```
<figure><img src="../../.gitbook/assets/image (7).png" alt=""><figcaption></figcaption></figure>

рдЬрдм рдпрд╣ рдмрдЯрди рдХреНрд▓рд┐рдХ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рджреНрд╡рд╛рд░рд╛ рдПрдХ рд╕рдВрджреЗрд╢ рд╡рд┐рд╕реНрддрд╛рд░ рдкреГрд╖реНрдареЛрдВ рдХреЛ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ, [**runtime.sendMessage() API**](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред рдпрд╣ рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рд╕реАрдзреА рдкрд╣реБрдВрдЪ рдХреА рд╕реАрдорд╛ рдХреЗ рдХрд╛рд░рдг рд╣реИ, `storage` рдореЗрдВ рдХреБрдЫ рдЕрдкрд╡рд╛рджреЛрдВ рдХреЗ рдмреАрдЪред рдЗрди рдЕрдкрд╡рд╛рджреЛрдВ рд╕реЗ рдкрд░реЗ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП, рд╕рдВрджреЗрд╢ рд╡рд┐рд╕реНрддрд╛рд░ рдкреГрд╖реНрдареЛрдВ рдХреЛ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ рдЬрд┐рдирдХреЗ рд╕рд╛рде рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рдВрдЪрд╛рд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

{% hint style="warning" %}
рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рдЖрдзрд╛рд░ рдкрд░, рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рдХреНрд╖рдорддрд╛рдПрдБ рдереЛрдбрд╝реА рднрд┐рдиреНрди рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рдЪреНрд░реЛрдорд┐рдпрдо рдЖрдзрд╛рд░рд┐рдд рдмреНрд░рд╛рдЙрдЬрд╝рд░реЛрдВ рдХреЗ рд▓рд┐рдП, рдХреНрд╖рдорддрд╛рдУрдВ рдХреА рд╕реВрдЪреА [Chrome Developers рджрд╕реНрддрд╛рд╡реЗрдЬрд╝реАрдХрд░рдг](https://developer.chrome.com/docs/extensions/mv3/content_scripts/#capabilities) рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реИ, рдФрд░ рдлрд╝рд╛рдпрд░рдлрд╝реЙрдХреНрд╕ рдХреЗ рд▓рд┐рдП, [MDN](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts#webextension_apis) рдореБрдЦреНрдп рд╕реНрд░реЛрдд рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред\
рдпрд╣ рднреА рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯреЛрдВ рдХреЛ рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕рд╕реЗ рд╡реЗ рдХреНрд░рд┐рдпрд╛рдПрдБ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдБ рд╡рд╛рдкрд╕ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред
{% endhint %}

рдХреНрд░реЛрдо рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рджреЗрдЦрдиреЗ рдФрд░ рдбреАрдмрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╡рд┐рдХрд╛рд╕рдХ рдЙрдкрдХрд░рдг рдореЗрдиреВ Chrome рдбреЗрд╡рд▓рдкрд░ рдЯреВрд▓реНрд╕ рд╕реЗ рдПрдХреНрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ Options > More tools > Developer tools рдпрд╛ Ctrl + Shift + I рджрдмрд╛рдХрд░ред

рд╡рд┐рдХрд╛рд╕рдХ рдЙрдкрдХрд░рдг рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрдиреЗ рдкрд░, **Source рдЯреИрдм** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬрд┐рд╕рдХреЗ рдмрд╛рдж **Content Scripts рдЯреИрдм** рдкрд░ рдХреНрд▓рд┐рдХ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рд╡рд┐рднрд┐рдиреНрди рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╕реЗ рдЪрд▓ рд░рд╣реЗ рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреА рдЕрд╡рд▓реЛрдХрди рдХрд░рдиреЗ рдФрд░ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рдпрди рдлреНрд▓реЛ рдХреЛ рдЯреНрд░реИрдХ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмреНрд░реЗрдХрдкреЙрдЗрдВрдЯ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред

### рдЗрдВрдЬреЗрдХреНрдЯреЗрдб рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ

{% hint style="success" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЕрдирд┐рд╡рд╛рд░реНрдп рдирд╣реАрдВ рд╣реИрдВ** рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ **рдбрд╛рдпрдирд╛рдорд┐рдХ рд░реВрдк рд╕реЗ рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░рдирд╛ рднреА рд╕рдВрднрд╡ рд╣реИ рдФрд░ рдЙрдиреНрд╣реЗрдВ **рдкреНрд░реЛрдЧреНрд░рд╛рдореЗрдЯрд┐рдХ рд░реВрдк рд╕реЗ рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **`tabs.executeScript`** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╡реЗрдм рдкреГрд╖реНрдареЛрдВ рдореЗрдВ **рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░рдирд╛ред рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдЕрдзрд┐рдХ **рдЧреНрд░реИрдиреБрд▓рд░ рдирд┐рдпрдВрддреНрд░рдг** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред
{% endhint %}

рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдкреНрд░реЛрдЧреНрд░рд╛рдореЗрдЯрд┐рдХ рдЗрдВрдЬреЗрдХреНрд╢рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рдкреГрд╖реНрда рдХреЗ рд▓рд┐рдП [host permissions](https://developer.chrome.com/docs/extensions/reference/permissions) рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдП рдЬрд╛рдиреЗ рд╣реИрдВред рдпреЗ рдЕрдиреБрдорддрд┐рдпрд╛рдБ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдореИрдирд┐рдлрд╝реЗрд╕реНрдЯ рдореЗрдВ рдЙрдиреНрд╣реЗрдВ рдорд╛рдВрдЧрдиреЗ рдпрд╛ рдЕрд╕реНрдерд╛рдпреА рд░реВрдк рд╕реЗ [**activeTab**](https://developer.chrome.com/docs/extensions/reference/manifest/activeTab) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реБрд░рдХреНрд╖рд┐рдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИрдВред

#### рдЙрджрд╛рд╣рд░рдг activeTab рдЖрдзрд╛рд░рд┐рдд рдПрдХреНрд╕рдЯреЗрдВрд╢рди

{% code title="manifest.json" %}
```json
{
"name": "My extension",
...
"permissions": [
"activeTab",
"scripting"
],
"background": {
"service_worker": "background.js"
},
"action": {
"default_title": "Action Button"
}
}
```
{% endcode %}

* **рдХреНрд▓рд┐рдХ рдкрд░ рдЬреЗрдПрд╕ рдлрд╝рд╛рдЗрд▓ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░реЗрдВ:**
```javascript
// content-script.js
document.body.style.backgroundColor = "orange";

//service-worker.js - Inject the JS file
chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target: { tabId: tab.id },
files: ["content-script.js"]
});
});
```
* **рдХреНрд▓рд┐рдХ рдкрд░ рдПрдХ рдлрд╝рдВрдХреНрд╢рди рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░реЗрдВ:
```javascript
//service-worker.js - Inject a function
function injectedFunction() {
document.body.style.backgroundColor = "orange";
}

chrome.action.onClicked.addListener((tab) => {
chrome.scripting.executeScript({
target : {tabId : tab.id},
func : injectedFunction,
});
});
```
#### рдЙрджрд╛рд╣рд░рдг рд╕реНрдХреНрд░рд┐рдкреНрдЯрд┐рдВрдЧ рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рд╕рд╛рде
```javascript
// service-workser.js
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
excludeMatches : [ "*://*/*business*" ],
js : [ "contentScript.js" ],
}]);

// Another example
chrome.tabs.executeScript(tabId, { file: "content_script.js" });
```
рдЕрдзрд┐рдХ URLs рд╢рд╛рдорд┐рд▓ рдпрд╛ рдЕрдкрд╢рд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **`include_globs`** рдФрд░ **`exclude_globs`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рднреА рд╕рдВрднрд╡ рд╣реИред

### рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ `run_at`

`run_at` рдлрд╝реАрд▓реНрдб **рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рд╡реЗрдм рдкреЗрдЬ рдореЗрдВ рдХрдм рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдП** рдЗрд╕реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИред рдкрд╕рдВрджреАрджрд╛ рдФрд░ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рдорд╛рди `"document_idle"` рд╣реИред

рд╕рдВрднрд╛рд╡рд┐рдд рдорд╛рди рд╣реИрдВ:

* **`document_idle`**: рдЬрдм рднреА рд╕рдВрднрд╡ рд╣реЛ
* **`document_start`**: `css` рд╕реЗ рдХрд┐рд╕реА рднреА рдлрд╝рд╛рдЗрд▓ рдХреЗ рдмрд╛рдж, рд▓реЗрдХрд┐рди рдХрд┐рд╕реА рднреА рдЕрдиреНрдп DOM рдирд┐рд░реНрдорд┐рдд рдирд╣реАрдВ рд╣реИ рдпрд╛ рдХреЛрдИ рдЕрдиреНрдп рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдЪрд▓ рд░рд╣рд╛ рд╣реИред
* **`document_end`**: DOM рдкреВрд░рд╛ рд╣реЛрдиреЗ рдХреЗ рддреБрд░рдВрдд рдмрд╛рдж, рд▓реЗрдХрд┐рди рдЫрд╡рд┐рдпреЛрдВ рдФрд░ рдлрд╝реНрд░реЗрдореНрд╕ рдЬреИрд╕реЗ рд╕рдм-рд╕рдВрд╕рд╛рдзрди рд▓реЛрдб рд╣реЛрдиреЗ рд╕реЗ рдкрд╣рд▓реЗред

#### `manifest.json` рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ
```json
{
"name": "My extension",
...
"content_scripts": [
{
"matches": ["https://*.example.com/*"],
"run_at": "document_idle",
"js": ["contentScript.js"]
}
],
...
}

```
рджреНрд╡рд╛рд░рд╛ **`service-worker.js`**
```javascript
chrome.scripting.registerContentScripts([{
id : "test",
matches : [ "https://*.example.com/*" ],
runAt : "document_idle",
js : [ "contentScript.js" ],
}]);
```
### `рдкреГрд╖реНрдарднреВрдорд┐`

рдХрдВрдЯреЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рджреНрд╡рд╛рд░рд╛ рднреЗрдЬреЗ рдЧрдП рд╕рдВрджреЗрд╢ **рдкреГрд╖реНрдарднреВрдорд┐ рдкреГрд╖реНрда** рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ, рдЬреЛ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдШрдЯрдХреЛрдВ рдХреЛ рд╕рдордиреНрд╡рдпрд┐рдд рдХрд░рдиреЗ рдореЗрдВ рдореБрдЦреНрдп рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддрд╛ рд╣реИред рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ, рдкреГрд╖реНрдарднреВрдорд┐ рдПрдХ рдЕрдкрдирд╛ рдбреЙрдХреНрдпреВрдореЗрдВрдЯ рдСрдмреНрдЬреЗрдХреНрдЯ рдореЙрдбрд▓ (DOM) рд░рдЦрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдЬрдЯрд┐рд▓ рдмрд╛рддрдЪреАрдд рдФрд░ рд╕реНрдерд┐рддрд┐ рдкреНрд░рдмрдВрдзрди рд╕рдВрднрд╡ рд╣реЛрддрд╛ рд╣реИред

**рдореБрдЦреНрдп рдмрд┐рдВрджреБ**:

- **рдкреГрд╖реНрдарднреВрдорд┐ рдХреА рднреВрдорд┐рдХрд╛:** рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд▓рд┐рдП рддрдВрддреБ рдХреЗрдВрджреНрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ, рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╣рд┐рд╕реНрд╕реЛрдВ рдХреЗ рдмреАрдЪ рд╕рдВрдЪрд╛рд░ рдФрд░ рд╕рдордиреНрд╡рдп рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддрд╛ рд╣реИред
- **рд╕реНрдерд╛рдпрд┐рддреНрд╡:** рдпрд╣ рдПрдХ рд╕рджреИрд╡ рдореМрдЬреВрджрд╛ рдПрдВрдЯрд┐рдЯреА рд╣реИ, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд▓рд┐рдП рдЕрджреГрд╢реНрдп рд╣реЛрддрд╛ рд╣реИ рд▓реЗрдХрд┐рди рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдХреЗ рд▓рд┐рдП рдЕрднрд┐рдиреНрди рд╣реИред
- **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрддреНрдкрд╛рджрди:** рдпрджрд┐ рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдПрдХ рдкреГрд╖реНрдарднреВрдорд┐ рдмрдирд╛рдПрдЧрд╛ред рдпрд╣ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЙрддреНрдкрд╛рджрд┐рдд рдкреГрд╖реНрда рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдореИрдирд┐рдлреЗрд╕реНрдЯ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕рднреА рдкреГрд╖реНрдарднреВрдорд┐ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдЧрд╛, рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдкреГрд╖реНрдарднреВрдорд┐ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд╕рд╣рдЬ рд╕рдВрдЪрд╛рд▓рди рдХреА рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреЗ рд╣реБрдПред

{% hint style="success" %}
рдмреНрд░рд╛рдЙрдЬрд╝рд░ рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреГрд╖реНрдарднреВрдорд┐ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд╛рди рдХреА рдЧрдИ рд╕реБрд╡рд┐рдзрд╛ (рдЬрдм рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ рдШреЛрд╖рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛ) рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИ рдХрд┐ рд╕рднреА рдЖрд╡рд╢реНрдпрдХ рдкреГрд╖реНрдарднреВрдорд┐ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдПрдХреАрдХреГрдд рдФрд░ рд╕рдВрдЪрд╛рд▓рдирд╢реАрд▓ рд╣реИрдВ, рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рд╕реЗрдЯрдЕрдк рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕реБрдЧрдо рдмрдирд╛рддреЗ рд╣реИрдВред
{% endhint %}

рдЙрджрд╛рд╣рд░рдг рдкреГрд╖реНрдарднреВрдорд┐ рд╕реНрдХреНрд░рд┐рдкреНрдЯ:
```js
chrome.runtime.onMessage.addListener((request, sender, sendResponse) =>
{
if (request == "explain")
{
chrome.tabs.create({ url: "https://example.net/explanation" });
}
})
```
рдпрд╣ рдореИрд╕реЗрдЬ рд╕реБрдирдиреЗ рдХреЗ рд▓рд┐рдП [runtime.onMessage API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЬрдм рдПрдХ `"explain"` рдореИрд╕реЗрдЬ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдпрд╣ [tabs API](https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдкреГрд╖реНрда рдХреЛ рдПрдХ рдирдП рдЯреИрдм рдореЗрдВ рдЦреЛрд▓рддрд╛ рд╣реИред

рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдбреАрдмрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк **рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╡рд┐рд╡рд░рдг рдкрд░ рдЬрд╛рдХрд░ рд╕реЗрд╡рд╛ рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ,** рдпрд╣ рдбреЗрд╡рд▓рдкрд░ рдЯреВрд▓реНрд╕ рдХреЛ рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рд╕рд╛рде рдЦреЛрд▓реЗрдЧрд╛:

<figure><img src="broken-reference" alt=""><figcaption></figcaption></figure>

### рд╡рд┐рдХрд▓реНрдк рдкреГрд╖реНрда рдФрд░ рдЕрдиреНрдп

рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдореЗрдВ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░ рдХреЗ рдкреГрд╖реНрда рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ:

* **рдХреНрд░рд┐рдпрд╛ рдкреГрд╖реНрда** рдПрдХ **рдбреНрд░реЙрдк-рдбрд╛рдЙрди рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрддреЗ рд╣реИрдВ рдЬрдм рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдЖрдЗрдХреЙрди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред
* рдкреГрд╖реНрда рдЬреЛ рдПрдХреНрд╕рдЯреЗрдВрд╢рди **рдирдП рдЯреИрдм рдореЗрдВ рд▓реЛрдб рдХрд░реЗрдЧрд╛**ред
* **рд╡рд┐рдХрд▓реНрдк рдкреГрд╖реНрда**: рдпрд╣ рдкреГрд╖реНрда рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░рдиреЗ рдкрд░ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрддрд╛ рд╣реИред рдкрд┐рдЫрд▓реЗ рдореИрдирд┐рдлреЗрд╕реНрдЯ рдореЗрдВ рдореЗрд░реА рд╕реНрдерд┐рддрд┐ рдореЗрдВ рдореИрдВ рдЗрд╕ рдкреГрд╖реНрда рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрд╛ `chrome://extensions/?options=fadlhnelkbeojnebcbkacjilhnbjfjca` рдпрд╛ рдХреНрд▓рд┐рдХ рдХрд░рдХреЗ:

<figure><img src="../../.gitbook/assets/image (8).png" alt="" width="375"><figcaption></figcaption></figure>

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпреЗ рдкреГрд╖реНрда рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рдкреЗрдЬ рдХреА рддрд░рд╣ рд╕реНрдерд╛рдпреА рдирд╣реАрдВ рд╣реИрдВ рдХреНрдпреЛрдВрдХрд┐ рдпреЗ рдЖрд╡рд╢реНрдпрдХрддрд╛ рдкрд░ рдбрд╛рдпрдирд╛рдорд┐рдХ рд░реВрдк рд╕реЗ рд╕рд╛рдордЧреНрд░реА рд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдмрд╛рд╡рдЬреВрдж, рдЗрдиреНрд╣реЗрдВ рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рдкреЗрдЬ рдХреЗ рд╕рд╛рде рдХреБрдЫ рдпреЛрдЧреНрдпрддрд╛рдПрдБ рд╕рд╛рдЭрд╛ рдХрд░рдиреА рдкрдбрд╝рддреА рд╣реИрдВ:

- **рдХрдВрдЯреЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЗ рд╕рд╛рде рд╕рдВрдЪрд╛рд░:** рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рдкреЗрдЬ рдХреА рддрд░рд╣, рдпреЗ рдкреГрд╖реНрда рдХрдВрдЯреЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рд╕реЗ рдореИрд╕реЗрдЬ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рднреАрддрд░ рдмрд╛рддрдЪреАрдд рдХреЛ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рдмрдирд╛рддреЗ рд╣реИрдВред
- **рдПрдХреНрд╕рдЯреЗрдВрд╢рди-рд╡рд┐рд╢рд┐рд╖реНрдЯ API рддрдХ рдкрд╣реБрдВрдЪ:** рдпреЗ рдкреГрд╖реНрда рдПрдХреНрд╕рдЯреЗрдВрд╢рди-рд╡рд┐рд╢рд┐рд╖реНрдЯ API рдХреА рд╡реНрдпрд╛рдкрдХ рдкрд╣реБрдВрдЪ рдХрд╛ рдЖрдирдВрдж рд▓реЗрддреЗ рд╣реИрдВ, рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рд▓рд┐рдП рдкрд░рд┐рднрд╛рд╖рд┐рдд рдЕрдиреБрдорддрд┐рдпреЛрдВ рдХреЗ рдЕрдзреАрдиред

### `permissions` рдФрд░ `host_permissions`

**`permissions`** рдФрд░ **`host_permissions`** `manifest.json` рд╕реЗ рдПрдВрдЯреНрд░реА рд╣реИрдВ рдЬреЛ рджрд┐рдЦрд╛рдПрдЧреА **рдХрд┐ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд┐рд╕ рдЕрдиреБрдорддрд┐рдпреЛрдВ** рдХреЛ рд╣реИ (рд╕реНрдЯреЛрд░реЗрдЬ, рд╕реНрдерд╛рди...) рдФрд░ **рдХрд┐рд╕ рд╡реЗрдм рдкреГрд╖реНрдареЛрдВ** рдореЗрдВред

рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдЗрддрдиреА **рд╡рд┐рд╢реЗрд╖рд╛рдзрд┐рдХрд╛рд░реА** рд╣реЛ рд╕рдХрддреА рд╣реИрдВ, рдПрдХ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рдпрд╛ рдХрд┐рд╕реА рдХреЗ рджрдмрд╛рд╡ рдореЗрдВ рдЖрдиреЗ рдкрд░ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рд╡реНрдпрдХреНрддрд┐ рдХреЛ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдЪреБрд░рд╛рдиреЗ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдЬрд╛рд╕реВрд╕реА рдХрд░рдиреЗ рдХреЗ рд╡рд┐рднрд┐рдиреНрди рд╕рд╛рдзрди** рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреА рд╣реИред

рджреЗрдЦреЗрдВ рдХрд┐ рдпреЗ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреИрд╕реЗ рдХрд╛рдо рдХрд░рддреА рд╣реИрдВ рдФрд░ рдХреИрд╕реЗ рдЗрдирдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:

{% content-ref url="browext-permissions-and-host_permissions.md" %}
[browext-permissions-and-host\_permissions.md](browext-permissions-and-host\_permissions.md)
{% endcontent-ref %}

### `content_security_policy`

**рдХрдВрдЯреЗрдВрдЯ рд╕реБрд░рдХреНрд╖рд╛ рдиреАрддрд┐** рдХреЛ `manifest.json` рдХреЗ рдЕрдВрджрд░ рднреА рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрджрд┐ рдПрдХ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рд╣реИ, рддреЛ рдпрд╣ **рд╡рдВрд╢рд╛рд╕реНрдкрдж** рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдкреЗрдЬреЛрдВ рдХреЗ рд▓рд┐рдП рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧ рдмрд╣реБрдд рдкреНрд░рддрд┐рдмрдВрдзрдХ рд╣реИ:
```bash
script-src 'self'; object-src 'self';
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП CSP рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рдмрд╛рдпрдкрд╛рд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="../content-security-policy-csp-bypass/" %}
[content-security-policy-csp-bypass](../content-security-policy-csp-bypass/)
{% endcontent-ref %}

### `web_accessible_resources`

рдПрдХ рд╡реЗрдмрдкреЗрдЬ рдХреЛ рдПрдХ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдкреЗрдЬ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ `.html` рдкреЗрдЬ, рдЗрд╕ рдкреЗрдЬ рдХреЛ `manifest.json` рдХреЗ **`web_accessible_resources`** рдлрд╝реАрд▓реНрдб рдореЗрдВ рдЙрд▓реНрд▓реЗрдЦрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред\
рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```javascript
{
...
"web_accessible_resources": [
{
"resources": [ "images/*.png" ],
"matches": [ "https://example.com/*" ]
},
{
"resources": [ "fonts/*.woff" ],
"matches": [ "https://example.com/*" ]
}
],
...
}
```
рдпреЗ рдкреЗрдЬ URL рдореЗрдВ рдПрдХреНрд╕реЗрд╕ рдХрд░рдиреЗ рдпреЛрдЧреНрдп рд╣реИрдВ:
```
chrome-extension://<extension-id>/message.html
```
рдЬрдирддрд╛ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдореЗрдВ **рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдЖрдИрдбреА рдПрдХреНрд╕реЗрд╕рд┐рдмрд▓** рд╣реИ:

<figure><img src="../../.gitbook/assets/image (722).png" alt="" width="375"><figcaption></figcaption></figure>

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдЧрд░ `manifest.json` рдкреИрд░рд╛рдореАрдЯрд░ **`use_dynamic_url`** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдпрд╣ **рдЖрдИрдбреА рдбрд╛рдпрдирд╛рдорд┐рдХ рд╣реЛ рд╕рдХрддреА рд╣реИ**ред

рдЗрди рдкреЗрдЬреЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╕реЗ рдпреЗ рдкреЗрдЬ **рдкреЛрдЯреЗрдВрд╢рд┐рдпрд▓реА рд╡рд▓рдирд░реЗрдмрд▓ рдХреНрд▓рд┐рдХрдЬреИрдХрд┐рдВрдЧ** рдмрди рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="browext-clickjacking.md" %}
[browext-clickjacking.md](browext-clickjacking.md)
{% endcontent-ref %}

{% hint style="success" %}
рдЗрди рдкреЗрдЬреЛрдВ рдХреЛ рдХреЗрд╡рд▓ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рджреНрд╡рд╛рд░рд╛ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╕реЗ CLickJacking рд╣рдорд▓реЛрдВ рдХреЛ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
{% endhint %}

### `externally_connectable`

[**рджрд╕реНрддрд╛рд╡реЗрдЬрд╝**](https://developer.chrome.com/docs/extensions/reference/manifest/externally-connectable) рдХреЗ рдЕрдиреБрд╕рд╛рд░, `"externally_connectable"` рдореИрдирд┐рдлреЗрд╕реНрдЯ рдкреНрд░реЙрдкрд░реНрдЯреА рдШреЛрд╖рд┐рдд рдХрд░рддреА рд╣реИ **рдХрд┐ рдХреМрди рд╕реА рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдФрд░ рд╡реЗрдм рдкреЗрдЬ рдЖрдкрдХреЗ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** [runtime.connect](https://developer.chrome.com/docs/extensions/reference/runtime#method-connect) рдФрд░ [runtime.sendMessage](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage) рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред

* рдЕрдЧрд░ **`externally_connectable`** рдХреБрдВрдЬреА рдЖрдкрдХреЗ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдореИрдирд┐рдлреЗрд╕реНрдЯ рдореЗрдВ рдШреЛрд╖рд┐рдд рдирд╣реАрдВ рд╣реИ рдпрд╛ рдпрд╣ **`"ids": ["*"]`** рдХреЗ рд░реВрдк рдореЗрдВ рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ **рд╕рднреА рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд▓реЗрдХрд┐рди рдХреЛрдИ рд╡реЗрдм рдкреЗрдЬ рдХрдиреЗрдХреНрдЯ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛**ред
* рдпрджрд┐ **рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЖрдИрдбреА** рдШреЛрд╖рд┐рдд рдХрд┐рдП рдЧрдП рд╣реИрдВ, рдЬреИрд╕реЗ `"ids": ["aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa"]`, **рдХреЗрд╡рд▓ рд╡реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред
* рдпрджрд┐ **рдореИрдЪреЗрд╕** рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВ, рддреЛ рд╡реЗ рд╡реЗрдм рдРрдкреНрд╕ рдХрдиреЗрдХреНрдЯ рдХрд░ рд╕рдХреЗрдВрдЧреЗ:
```json
"matches": [
"https://*.google.com/*",
"*://*.chromium.org/*",
```
* рдпрджрд┐ рдпрд╣ рд░рд┐рдХреНрдд рд░реВрдк рд╕реЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ: **`"externally_connectable": {}`**, рдХреЛрдИ рднреА рдРрдк рдпрд╛ рд╡реЗрдм рдХрдиреЗрдХреНрдЯ рдирд╣реАрдВ рдХрд░ рд╕рдХреЗрдЧрд╛ред

рдпрд╣рд╛рдБ рдЬрд┐рддрдиреЗ **рдХрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдФрд░ рдпреВрдЖрд░рдПрд▓** рджрд┐рдЦрд╛рдП рдЧрдП рд╣реИрдВ, **рд╣рдорд▓реЗ рдХрд╛ рд╕рддрд╣ рдЫреЛрдЯрд╛** рд╣реЛрдЧрд╛ред

{% hint style="danger" %}
рдпрджрд┐ рдХрд┐рд╕реА рд╡реЗрдм рдкреГрд╖реНрда рдореЗрдВ **XSS рдпрд╛ рдЯреЗрдХрдУрд╡рд░** рдХреЗ рд▓рд┐рдП рд╡рд┐рдХрд▓реНрдкрд┐рдд рд╣реИ рдЬреЛ **`externally_connectable`** рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **рд╕рдВрджреЗрд╢ рд╕реАрдзреЗ рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рдореЗрдВ рднреЗрдЬрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдЧреА, рдкреВрд░реА рддрд░рд╣ рд╕реЗ Content Script рдФрд░ рдЗрд╕рдХреА CSP рдХреЛ рдЫреЛрдбрд╝рдХрд░ред

рдЗрд╕рд▓рд┐рдП, рдпрд╣ рдПрдХ **рдмрд╣реБрдд рд╢рдХреНрддрд┐рд╢рд╛рд▓реА рдмрд╛рдпрдкрд╛рд╕** рд╣реИред
{% endhint %}

## рд╡реЗрдм **тЖФя╕О** рдХрдВрдЯреЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рдВрдЪрд╛рд░

**рдХрдВрдЯреЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рдХреЗ рдХрд╛рд░реНрдпрд╛рд▓рдп рдФрд░ рдЬрд╣рд╛рдВ рдореЗрдЬрд╝рдмрд╛рди рдкреГрд╖реНрда рдореМрдЬреВрдж рд╣реИрдВ, рд╡реЗ рдПрдХ рджреВрд╕рд░реЗ рд╕реЗ **рдЕрд▓рдЧ** рд╣реИрдВ, **рд╡рд┐рднрд╛рдЬрд┐рдд** рд╣реИрдВред рдЗрд╕ рд╡рд┐рднрд╛рдЬрди рдХреЗ рдмрд╛рд╡рдЬреВрдж, рджреЛрдиреЛрдВ рдХреЛ рдкреГрд╖реНрда рдХреЗ **рдбреЙрдХреНрдпреВрдореЗрдВрдЯ рдСрдмреНрдЬ
```javascript
var port = chrome.runtime.connect();

window.addEventListener("message", (event) => {
// We only accept messages from ourselves
if (event.source !== window) {
return;
}

if (event.data.type && (event.data.type === "FROM_PAGE")) {
console.log("Content script received: " + event.data.text);
port.postMessage(event.data.text);
}
}, false);
```
{% endcode %}

{% code title="example.js" %}
```javascript
document.getElementById("theButton").addEventListener("click", () => {
window.postMessage(
{type : "FROM_PAGE", text : "Hello from the webpage!"}, "*");
}, false);
```
{% endcode %}

рдПрдХ рд╕реБрд░рдХреНрд╖рд┐рдд Post Message рд╕рдВрдЪрд╛рд░ рдХреЛ рдкреНрд░рд╛рдкреНрдд рд╕рдВрджреЗрд╢ рдХреА рдкреНрд░рд╛рдорд╛рдгрд┐рдХрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП, рдпрд╣ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬрд╛рдВрдЪ рдХрд░рдХреЗ рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ:

* **`event.isTrusted`**: рдпрд╣ рдХреЗрд╡рд▓ рддрдм рд╕рдЪ рд╣реИ рдЕрдЧрд░ рдШрдЯрдирд╛ рдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдХреНрд░рд┐рдпрд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░реЗрд░рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛
* рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рдВрджреЗрд╢ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдХреЗрд╡рд▓ рдЕрдЧрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛрдИ рдХреНрд░рд┐рдпрд╛ рдХрд░рддрд╛ рд╣реИ
* **рдореВрд▓ рдбреЛрдореЗрди**: рд╕рдВрджреЗрд╢ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХреЗрд╡рд▓ рдбреЛрдореЗрди рдХреА allowlist рдХрд░ рд╕рдХрддрд╛ рд╣реИред
* рдпрджрд┐ рдПрдХ regex рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдмрд╣реБрдд рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ
* **рд╕реНрд░реЛрдд**: `received_message.source !== window` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдпрд╣ рдЬрд╛рдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рд╕рдВрджреЗрд╢ **рд╡рд╣реА рд╡рд┐рдВрдбреЛ рд╕реЗ** рдерд╛ рдЬрд╣рд╛рдВ рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕реБрди рд░рд╣рд╛ рдерд╛ред

рдкрд┐рдЫрд▓реА рдЬрд╛рдВрдЪреЗрдВ, рдпрджрд┐ рдХреА рдЧрдИ рд╣реЛрдВ, рднреА рд╡рд┐рдХрд▓реНрдк рд╣реЛ рд╕рдХрддреА рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдореЗрдВ **рдкреЛрдЯреЗрдВрд╢рд┐рдпрд▓ рдкреЛрд╕реНрдЯ рд╕рдВрджреЗрд╢ рдмрд╛рдпрдкрд╛рд╕** рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="../postmessage-vulnerabilities/" %}
[postmessage-vulnerabilities](../postmessage-vulnerabilities/)
{% endcontent-ref %}

### рдЖрдИрдлреНрд░реЗрдо

рдПрдХ рдФрд░ рд╕рдВрднрд╛рд╡рд┐рдд рд╕рдВрдЪрд╛рд░ рдХрд╛ рддрд░реАрдХрд╛ **рдЖрдИрдлреНрд░реЗрдо URLs** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдореЗрдВ рдПрдХ рдЙрджрд╛рд╣рд░рдг рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

### DOM

рдпрд╣ "рдареАрдХ-рдард╛рдХ" рдПрдХ рд╕рдВрдЪрд╛рд░ рддрд░реАрдХрд╛ рдирд╣реАрдВ рд╣реИ, рд▓реЗрдХрд┐рди **рд╡реЗрдм рдФрд░ рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рд╡реЗрдм DOM рддрдХ рдкрд╣реБрдВрдЪ рд╣реЛрдЧреА**ред рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ **рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рдХреБрдЫ рдЬрд╛рдирдХрд╛рд░реА рдкрдврд╝ рд░рд╣рд╛ рд╣реИ, **рд╡реЗрдм DOM рдкрд░ рднрд░реЛрд╕рд╛ рдХрд░рддрд╛ рд╣реИ**, рддреЛ рд╡реЗрдм **рдЗрд╕ рдбреЗрдЯрд╛ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд** рдХрд░ рд╕рдХрддрд╛ рд╣реИ (рдХреНрдпреЛрдВрдХрд┐ рд╡реЗрдм рдкрд░ рднрд░реЛрд╕рд╛ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдпрд╛ рдХреНрдпреЛрдВрдХрд┐ рд╡реЗрдм XSS рдХреЗ рд▓рд┐рдП рд╡рдВрд╢рд╡рд╛рджреА рд╣реИ) рдФрд░ **рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдХреНрд╖рддрд┐ рдкрд╣реБрдВрдЪрд╛ рд╕рдХрддрд╛ рд╣реИ**ред

рдЖрдк рдПрдХ **DOM рдЖрдзрд╛рд░рд┐рдд XSS рдХрд╛ рдЙрджрд╛рд╣рд░рдг рднреА рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВ рдПрдХ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рдХреНрд╖рддрд┐ рдкрд╣реБрдВрдЪрд╛рдиреЗ рдХреЗ рд▓рд┐рдП** рдореЗрдВ:

{% content-ref url="browext-xss-example.md" %}
[browext-xss-example.md](browext-xss-example.md)
{% endcontent-ref %}

## рдореЗрдореЛрд░реА/рдХреЛрдб рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА

рдпрджрд┐ рдПрдХ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди **рдЕрдкрдиреА рдореЗрдореЛрд░реА рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рддрд╛ рд╣реИ**, рддреЛ рдпрд╣ **рдбрдВрдк** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ Windows рдорд╢реАрдиреЛрдВ рдореЗрдВ) рдФрд░ рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП **рдЦреЛрдЬреА** рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред

рдЗрд╕рд▓рд┐рдП, рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рдореЗрдореЛрд░реА **рд╕реБрд░рдХреНрд╖рд┐рдд рдорд╛рдиреА рдирд╣реАрдВ рдЬрд╛рдиреА рдЪрд╛рд╣рд┐рдП** рдФрд░ **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА** рдЬреИрд╕реЗ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓ рдпрд╛ рдореНрдиреЗрдореЛрдирд┐рдХ рд╡рд╛рдХреНрдпрд╛рдВрд╢ **рд╕рдВрдЧреНрд░рд╣рд┐рдд рдирд╣реАрдВ рдХрд┐рдП рдЬрд╛рдиреЗ рдЪрд╛рд╣рд┐рдП**ред

рдмреЗрд╢рдХ, **рдХреЛрдб рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рди рдбрд╛рд▓реЗрдВ**, рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ** рд╣реЛрдЧрд╛ред

## рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ **тЖФя╕О** рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рд╕реНрдХреНрд░рд┐рдкреНрдЯ рд╕рдВрдЪрд╛рд░

рдПрдХ рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдлрд╝рдВрдХреНрд╢рди [**runtime.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/runtime#method-sendMessage) **рдпрд╛** [**tabs.sendMessage()**](https://developer.chrome.com/docs/extensions/reference/tabs#method-sendMessage) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдПрдХ **рдПрдХ-рдмрд╛рд░ рдХрд╛ JSON-serializable** рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдПред

**рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рд╡рд╛рдкрд╕реА **Promise** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдкрд┐рдЫрд▓реА рд╕рдВрдЧрддрддрд╛ рдХреЗ рд▓рд┐рдП, рдЖрдк рдЕрдм рднреА рдЖрдЦрд┐рд░реА рддрд░реАрдХреЗ рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ **рдХреЙрд▓рдмреИрдХ** рдкрд╛рд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

**рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ** рд╕реЗ рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдирд╛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рджрд┐рдЦрддрд╛ рд╣реИ:
```javascript
(async () => {
const response = await chrome.runtime.sendMessage({greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдирд╛ **рдПрдХреНрд╕рдЯреЗрдВрд╢рди** рд╕реЗ (рд╕рд╛рдорд╛рдиреНрдпрдд: рдПрдХ **рдмреИрдХрдЧреНрд░рд╛рдЙрдВрдб рд╕реНрдХреНрд░рд┐рдкреНрдЯ**) рдПрдХ рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдлрд╝рдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдХреЗрд╡рд▓ рдЖрдкрдХреЛ рдпрд╣ рд╕реНрдкрд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдХрд┐ рдЖрдк рдЗрд╕реЗ рдХрд┐рд╕ рдЯреИрдм рдХреЛ рднреЗрдЬрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред рдЪрдпрдирд┐рдд рдЯреИрдм рдореЗрдВ рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХрд╛ рдЙрджрд╛рд╣рд░рдг:
```javascript
// From https://stackoverflow.com/questions/36153999/how-to-send-a-message-between-chrome-extension-popup-and-content-script
(async () => {
const [tab] = await chrome.tabs.query({active: true, lastFocusedWindow: true});
const response = await chrome.tabs.sendMessage(tab.id, {greeting: "hello"});
// do something with response here, not outside the function
console.log(response);
})();
```
**рдкреНрд░рд╛рдкреНрддрд┐ рд╕реНрдерд┐рддрд┐** рдкрд░, рдЖрдкрдХреЛ рд╕рдВрджреЗрд╢ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП [**runtime.onMessage**](https://developer.chrome.com/docs/extensions/reference/runtime#event-onMessage) **рдШрдЯрдирд╛ рд╕реБрдирдиреЗ рд╡рд╛рд▓рд╛** рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдпрд╣ рд╕рд╛рдордЧреНрд░реА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдпрд╛ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдкреЗрдЬ рд╕реЗ рдПрдХ рдЬреИрд╕рд╛ рджрд┐рдЦрддрд╛ рд╣реИред
```javascript
// From https://stackoverflow.com/questions/70406787/javascript-send-message-from-content-js-to-background-js
chrome.runtime.onMessage.addListener(
function(request, sender, sendResponse) {
console.log(sender.tab ?
"from a content script:" + sender.tab.url :
"from the extension");
if (request.greeting === "hello")
sendResponse({farewell: "goodbye"});
}
);
```
рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, **`sendResponse()`** рдХреЛ рд╕рдорд╡рд░реНрддреА рдврдВрдЧ рд╕реЗ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред `sendResponse()` рдХреЛ рдЕрд╕рдорд╡рд░реНрддреА рдврдВрдЧ рд╕реЗ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `sendResponse()` рдХреЛ рдЕрд╕рдорд╡рд░реНрддреА рдврдВрдЧ рд╕реЗ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `return true;` рд╢рд╛рдорд┐рд▓ рдХрд░рдирд╛ рдЕрддреНрдпрдзрд┐рдХ рдЖрд╡рд╢реНрдпрдХ рд╣реИред

рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╡рд┐рдЪрд╛рд░ рд╣реИ рдХрд┐ рдЬрд╣рд╛рдВ рдХрдИ рдкреГрд╖реНрда `onMessage` рдШрдЯрдирд╛рдПрдБ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд┐рдП рдЧрдП рд╣реИрдВ, **рдПрдХ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдШрдЯрдирд╛ рдХреЗ рд▓рд┐рдП `sendResponse()` рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдкрд╣рд▓рд╛ рдкреГрд╖реНрда** рдХреЗрд╡рд▓ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХреЗрдЧрд╛ред рдПрдХ рд╣реА рдШрдЯрдирд╛ рдХреЗ рд▓рд┐рдП рдХрд┐рд╕реА рднреА рдЖрдЧрд╛рдореА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛рдПрдБ рдзреНрдпрд╛рди рдореЗрдВ рдирд╣реАрдВ рд▓реА рдЬрд╛рдПрдВрдЧреАред

рдирдП рдПрдХреНрд╕рдЯреЗрдВрд╢рди рддреИрдпрд╛рд░ рдХрд░рддреЗ рд╕рдордп, рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рдкреНрд░реЙрдорд┐рд╕реЗрд╕ рдХреА рдУрд░ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдФрд░ рдХреЙрд▓рдмреИрдХреНрд╕ рдХреА рдмрдЬрд╛рдпред рдХреЙрд▓рдмреИрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд╕рдВрдмрдВрдз рдореЗрдВ, `sendResponse()` рдлрд╝рдВрдХреНрд╢рди рдХреЗрд╡рд▓ рддрднреА рдорд╛рдиреНрдп рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдЕрдЧрд░ рдпрд╣ рд╕реАрдзреЗ рд╕рдорд╡рд░реНрддреА рд╕рдВрджрд░реНрдн рдореЗрдВ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдпрд╛ рдпрджрд┐ рдШрдЯрдирд╛ рд╣реИрдВрдбрд▓рд░ рдЕрд╕рдорд╡рд░реНрддреА рд╕рдВрдЪрд╛рд▓рди рдХреА рд╕реВрдЪрдирд╛ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ `true` рд▓реМрдЯрд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рдХреЛрдИ рднреА рд╣реИрдВрдбрд▓рд░ `true` рдирд╣реАрдВ рд▓реМрдЯрд╛рддрд╛ рд╣реИ рдпрд╛ рдпрджрд┐ `sendResponse()` рдлрд╝рдВрдХреНрд╢рди рдХреЛ рдореЗрдореЛрд░реА рд╕реЗ рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ (рдЧрд╛рд░реНрдмреЗрдЬ-рдХрд▓реЗрдХреНрдЯреЗрдб), рддреЛ `sendMessage()` рдлрд╝рдВрдХреНрд╢рди рдХреЗ рд╕рд╛рде рд╕рдВрдмрдВрдзрд┐рдд рдХреЙрд▓рдмреИрдХ рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд░реВрдк рд╕реЗ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрдЧрд╛ред
```bash
extension_id=your_extension_id   # Replace with the actual extension ID
curl -L -o "$extension_id.zip" "https://clients2.google.com/service/update2/crx?response=redirect&os=mac&arch=x86-64&nacl_arch=x86-64&prod=chromecrx&prodchannel=stable&prodversion=44.0.2403.130&x=id%3D$extension_id%26uc"
unzip -d "$extension_id-source" "$extension_id.zip"
```
### CRX рд╡реНрдпреВрдЕрд░ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ

[https://robwu.nl/crxviewer/](https://robwu.nl/crxviewer/)

### CRX рд╡реНрдпреВрдЕрд░ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ

рдПрдХ рдФрд░ рд╕реБрд╡рд┐рдзрд╛рдЬрдирдХ рддрд░реАрдХрд╛ рд╣реИ рдХреНрд░реЛрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╕реЛрд░реНрд╕ рд╡реНрдпреВрдЕрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛, рдЬреЛ рдПрдХ рдУрдкрди-рд╕реЛрд░реНрд╕ рдкрд░рд┐рдпреЛрдЬрдирд╛ рд╣реИред рдЗрд╕реЗ [Chrome Web Store](https://chrome.google.com/webstore/detail/chrome-extension-source-v/jifpbeccnghkjeaalbbjmodiffmgedin?hl=en) рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд╡реНрдпреВрдЕрд░ рдХрд╛ рд╕реНрд░реЛрдд рдХреЛрдб рдЗрд╕рдХреЗ [GitHub рднрдВрдбрд╛рд░](https://github.com/Rob--W/crxviewer) рдореЗрдВ рдЙрдкрд▓рдмреНрдз рд╣реИред

### рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХрд╛ рд╕реНрд░реЛрдд рджреЗрдЦреЗрдВ

рд╕реНрдерд╛рдиреАрдп рд░реВрдк рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХреНрд░реЛрдо рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рдЬрд╛рдВрдЪ рднреА рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░реАрдХреЗ рд╕реЗ:

1. "Profile Path" рдлреАрд▓реНрдб рдХреЛ рдвреВрдВрдврдХрд░ `chrome://version/` рдкрд░ рдЬрд╛рдХрд░ рдЕрдкрдиреЗ рдХреНрд░реЛрдо рд╕реНрдерд╛рдиреАрдп рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рддрдХ рдкрд╣реБрдВрдЪреЗрдВред
2. рдкреНрд░реЛрдлрд╝рд╛рдЗрд▓ рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХреЗ рдЕрдВрджрд░ `Extensions/` рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдЬрд╛рдПрдВред
3. рдпрд╣ рдЙрдкрдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕рднреА рд╕реНрдерд╛рдкрд┐рдд рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЛ рд╕рдореЗрдд рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рд╕рд╛рдорд╛рдиреНрдпрдд: рдЙрдирдХреЗ рд╕реНрд░реЛрдд рдХреЛрдб рдХреЛ рдПрдХ рдкрдардиреАрдп рд╕реНрд╡рд░реВрдк рдореЗрдВ рд░рдЦрддреЗ рд╣реИрдВред

рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдЙрдирдХреЗ рдЖрдИрдбреА рдХреЛ рдирд╛рдореЛрдВ рд╕реЗ рдореИрдк рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

- `about:extensions` рдкреГрд╖реНрда рдкрд░ "Developer Mode" рдХреЛ рд╕рдХреНрд╖рдо рдХрд░реЗрдВ рддрд╛рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рдЖрдИрдбреА рджреЗрдЦ рд╕рдХреЗрдВред
- рдкреНрд░рддреНрдпреЗрдХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреЗ рдлрд╝реЛрд▓реНрдбрд░ рдХреЗ рдЕрдВрджрд░, `manifest.json` рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдПрдХ рдкрдардиреАрдп `name` рдлрд╝реАрд▓реНрдб рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдЖрдкрдХреЛ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред
