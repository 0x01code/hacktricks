# SOME - Same Origin Method Execution

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Εργάζεστε σε μια **εταιρεία κυβερνοασφάλειας**; Θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks**; ή θέλετε να έχετε πρόσβαση στην **τελευταία έκδοση του PEASS ή να κατεβάσετε το HackTricks σε PDF**; Ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Ανακαλύψτε τη [**Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Εγγραφείτε** στη [**💬**](https://emojipedia.org/speech-balloon/) [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα τηλεγραφήματος**](https://t.me/peass) ή **ακολουθήστε** με στο **Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs** στο [**αποθετήριο hacktricks**](https://github.com/carlospolop/hacktricks) **και** [**αποθετήριο hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="/.gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) είναι μια μηχανή αναζήτησης που τροφοδοτείται από το **dark web** και προσφέρει **δωρεάν** λειτουργίες για να ελέγξετε αν μια εταιρεία ή οι πελάτες της έχουν **διαρρεύσει** από **κλέφτες κακόβουλου λογισμικού**.

Ο βασικός στόχος του WhiteIntel είναι η καταπολέμηση των αποκλεισμών λογαριασμών και των επιθέσεων ransomware που προκύπτουν από κακόβουλο λογισμικό που κλέβει πληροφορίες.

Μπορείτε να ελέγξετε τον ιστότοπό τους και να δοκιμάσετε τη μηχανή τους δωρεάν στο:

{% embed url="https://whiteintel.io" %}

---

## Same Origin Method Execution

Θα υπάρχουν περιπτώσεις όπου μπορείτε να εκτελέσετε κάποιο περιορισμένο javascript σε μια σελίδα. Για παράδειγμα, στην περίπτωση όπου μπορείτε να [**ελέγξετε μια τιμή επιστροφής που θα εκτελεστεί**](./#javascript-function).

Σε αυτές τις περιπτώσεις, ένα από τα καλύτερα πράγματα που θα μπορούσατε να κάνετε είναι να **έχετε πρόσβαση στο DOM για να καλέσετε οποιαδήποτε** ευαίσθητη ενέργεια μπορείτε να βρείτε εκεί (όπως το κλικ σε ένα κουμπί). Ωστόσο, συνήθως θα βρείτε αυτήν την ευπάθεια σε **μικρά σημεία που δεν έχουν κάτι ενδιαφέρον στο DOM**.

Σε αυτά τα σενάρια, αυτή η επίθεση θα είναι πολύ χρήσιμη, επειδή ο στόχος της είναι να μπορείτε να **καταχραστείτε την περιορισμένη εκτέλεση JS μέσα σε ένα DOM από μια διαφορετική σελίδα από τον ίδιο τομέα** με πολλές ενδιαφέρουσες ενέργειες.

Βασικά, η ροή της επίθεσης είναι η ακόλουθη:

* Βρείτε ένα **callback που μπορείτε να καταχραστείτε** (ενδεχομένως περιορισμένο σε \[\w\\.\_]).
* Αν δεν είναι περιορισμένο και μπορείτε να εκτελέσετε οποιοδήποτε JS, μπορείτε απλά να καταχραστείτε αυτό ως ένα κανονικό XSS
* Κάντε τον **θύμα να ανοίξει μια σελίδα** που ελέγχεται από τον **επιτιθέμενο**
* Η **σελίδα θα ανοίξει μόνη της** σε ένα **διαφορετικό παράθυρο** (το νέο παράθυρο θα έχει το αντικείμενο **`opener`** που αναφέρεται στο αρχικό)
* Η **αρχική σελίδα** θα φορτώσει τη **σελίδα** όπου βρίσκεται το **ενδιαφέρον DOM**.
* Η **δεύτερη σελίδα** θα φορτώσει τη **ευάθροτη σελίδα καταχρώμενη το callback** και χρησιμοποιώντας το αντικείμενο **`opener`** για να **έχει πρόσβαση και να εκτελέσει κάποια ενέργεια στην αρχική σελίδα** (η οποία περιέχει πλέον το ενδιαφέρον DOM).

{% hint style="danger" %}
Σημειώστε ότι ακόμα κι αν η αρχική σελίδα έχει πρόσβαση σε ένα νέο URL μετά τη δημιουργία της δεύτερης σελίδας, το **`opener` αντικείμενο της δεύτερης σελίδας εξακολουθεί να είναι έγκυρη αναφορά στην πρώτη σελίδα στο νέο DOM**.

Επιπλέον, για να μπορεί η δεύτερη σελίδα να χρησιμοποιήσει το αντικείμενο opener **και οι δύο σελίδες πρέπει να είναι στην ίδια προέλευση**. Αυτό είναι ο λόγος για τον οποίο, για να καταχραστείτε αυτήν την ευπάθεια, πρέπει να βρείτε κάποιο είδος **XSS στην ίδια προέλευση**.
{% endhint %}

### Εκμετάλλευση

* Μπορείτε να χρησιμοποιήσετε αυτήν τη φόρμα για να **δημιουργήσετε ένα PoC** για την εκμετάλλευση αυτού του τύπου ευπαθειών: [https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* Για να βρείτε ένα μονοπάτι DOM προς ένα στοιχείο HTML με ένα κλικ μπορείτε να χρησιμοποιήσετε αυτήν την επέκταση προγράμματος περιήγησης: [https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Παράδειγμα

* Μπορείτε να βρείτε ένα ευάθροτο παράδειγμα στο [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)
* Σημειώστε ότι σε αυτό το παράδειγμα ο διακομιστής **δημιουργεί κώδικα javascript** και τον **προσθέτει** στο HTML με βάση το **περιεχόμενο της παραμέτρου κλήσης επιστροφής:** `<script>opener.{callbacl_content}</script>` . Γι' αυτό σε αυτό το παράδειγμα δεν χρειάζεται να υποδείξετε τη χρήση του `opener` ρητά.
* Ελέγξτε επίσης αυτό το CTF writeup: [https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## Αναφορές

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/) 

<details>

<summary><strong>Μάθετε το χάκινγκ στο AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Εργάζεστε σε μια **εταιρεία κυβερνοασφάλειας**; Θέλετε να δείτε την **εταιρεία σας διαφημισμένη στο HackTricks**; ή θέλετε να έχετε πρόσβαση στην **τελευταία έκδοση του PEASS ή να κατεβάσετε το HackTricks σε PDF**; Ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Ανακαλύψτε τη [**Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Εγγραφείτε
