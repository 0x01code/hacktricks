# SOME - Wykonanie metody o tej samej domenie

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmującej się cyberbezpieczeństwem**? Chcesz zobaczyć swoją **firmę reklamowaną w HackTricks**? A może chcesz mieć dostęp do **najnowszej wersji PEASS lub pobrać HackTricks w formacie PDF**? Sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Dołącz do** [**💬**](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**repozytorium hacktricks**](https://github.com/carlospolop/hacktricks) **i** [**repozytorium hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Wykonanie metody o tej samej domenie

Zdarzą się sytuacje, w których możesz wykonać pewien ograniczony kod JavaScript na stronie. Na przykład, w przypadku, gdy możesz **kontrolować wartość wywołania zwrotnego, która zostanie wykonana**.

W takich przypadkach jedną z najlepszych rzeczy, które możesz zrobić, jest **uzyskanie dostępu do DOM, aby wywołać dowolną** wrażliwą akcję, którą można tam znaleźć (np. kliknięcie przycisku). Jednak zazwyczaj tę podatność znajdziesz w **małych punktach końcowych bez żadnych interesujących elementów w DOM**.

W takich scenariuszach ten atak będzie bardzo przydatny, ponieważ jego celem jest **wykorzystanie ograniczonego wykonywania JS wewnątrz DOM z innej strony o tej samej domenie** z bardziej interesującymi akcjami.

Podstawowy przebieg ataku jest następujący:

* Znajdź **zwrotkę, którą można wykorzystać** (potencjalnie ograniczoną do \[\w\\.\_]).
* Jeśli nie jest ograniczona i możesz wykonać dowolny kod JS, możesz po prostu wykorzystać to jako zwykłe XSS.
* Spowoduj, że **ofiara otworzy stronę** kontrolowaną przez **atakującego**.
* **Strona otworzy się** w **innym oknie** (nowe okno będzie miało obiekt **`opener`**, który odnosi się do początkowego okna).
* **Początkowa strona** załaduje **stronę**, na której znajduje się **interesujący DOM**.
* **Druga strona** załaduje **podatną stronę, wykorzystując zwrotkę** i używając obiektu **`opener`**, aby **uzyskać dostęp i wykonać pewną akcję w początkowej stronie** (która teraz zawiera interesujący DOM).

{% hint style="danger" %}
Należy zauważyć, że nawet jeśli początkowa strona uzyska dostęp do nowego adresu URL po utworzeniu drugiej strony, **obiekt `opener` drugiej strony wciąż jest ważnym odwołaniem do pierwszej strony w nowym DOM**.

Ponadto, aby druga strona mogła używać obiektu opener, **obie strony muszą być w tej samej domenie**. Dlatego też, aby wykorzystać tę podatność, musisz znaleźć pewien rodzaj **XSS w tej samej domenie**.
{% endhint %}

### Wykorzystanie

* Możesz użyć tego formularza do **wygenerowania PoC** w celu wykorzystania tego rodzaju podatności: [https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* Aby znaleźć ścieżkę DOM do elementu HTML z kliknięciem, możesz użyć tego rozszerzenia przeglądarki: [https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Przykład

* Możesz znaleźć przykład podatności na stronie [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)
* Zauważ, że w tym przykładzie serwer **generuje kod JavaScript** i **dodaje** go do HTML na podstawie **zawartości parametru zwrotki:** `<script>opener.{callbacl_content}</script>`. Dlatego w tym przykładzie nie musisz wskazywać użycia `opener` explicite.
* Sprawdź również ten opis rozwiązania CTF: [https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## Odwołania

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)

<details>

<summary><strong>Naucz się hakować AWS od zera do bohatera z</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Pracujesz w **firmie zajmującej się cyberbezpieczeństwem**? Chcesz zobaczyć swoją **firmę reklamowaną w HackTricks**? A może chcesz mieć dostęp do **najnowszej wersji PEASS lub pobrać HackTricks w formacie PDF**? Sprawdź [**PLAN SUBSKRYPCJI**](https://github.com/sponsors/carlospolop)!
* Odkryj [**Rodzinę PEASS**](https://opensea.io/collection/the-peass-family), naszą kolekcję ekskluzywnych [**NFT**](https://opensea.io/collection/the-peass-family)
* Zdobądź [**oficjalne gadżety PEASS & HackTricks**](https://peass.creator-spring.com)
* **Dołącz do** [**💬**](https://emojipedia.org/speech-balloon/) [**grupy Discord**](https://discord.gg/hRep4RUj7f) lub [**grupy telegramowej**](https://t.me/peass) lub **śledź** mnie na **Twitterze** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Podziel się swoimi sztuczkami hakerskimi, przesyłając PR-y do** [**repozytorium hacktricks**](https://github.com/carlospolop/hacktricks) **i** [**repozytorium hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
