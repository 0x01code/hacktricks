# SOME - 同一オリジンメソッド実行

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong>で**ゼロからヒーローまでAWSハッキングを学ぶ**</summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで企業を宣伝**したいですか？または、**PEASSの最新バージョンにアクセス**したいですか？または、**HackTricksをPDFでダウンロード**したいですか？[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)コレクションをご覧ください
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* **💬** [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**Telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **ハッキングトリックを共有する**には、[**hacktricksリポジトリ**](https://github.com/carlospolop/hacktricks)と[**hacktricks-cloudリポジトリ**](https://github.com/carlospolop/hacktricks-cloud)にPRを提出してください。

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="/.gitbook/assets/image (1224).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io)は、**ダークウェブ**を活用した検索エンジンで、企業やその顧客が**盗難マルウェア**によって**侵害**されていないかをチェックする**無料**機能を提供しています。

WhiteIntelの主な目標は、情報窃取マルウェアによるアカウント乗っ取りやランサムウェア攻撃に対抗することです。

彼らのウェブサイトをチェックして、無料でエンジンを試すことができます：

{% embed url="https://whiteintel.io" %}

---

## 同一オリジンメソッド実行

ページ内で一部の制限付きjavascriptを実行できる場合があります。たとえば、実行される**コールバック値を制御できる場合**です。

そのような場合、できることの1つは、**DOMにアクセスして**（たとえばボタンをクリックするなどの）**機密アクションを呼び出すこと**です。ただし、通常、**DOMに興味深いものがない小さなエンドポイントでこの脆弱性を見つけることがあります**。

そのようなシナリオでは、この攻撃は非常に役立ちます。なぜなら、その目的は、**同じドメインの異なるページ内のDOM内の制限付きJS実行を悪用できるようにする**ことです。

基本的に、攻撃フローは次のとおりです：

* **悪用できるコールバックを見つける**（おそらく\[\w\\.\_]に制限されている可能性があります）。
* 制限がなく、任意のJSを実行できる場合は、これを通常のXSSとして悪用できます
* **被害者に** **攻撃者が制御するページを開かせる**
* **ページは** **異なるウィンドウ**で**自分自身を開く**（新しいウィンドウには初期のものを参照する**`opener`**オブジェクトが含まれます）
* **初期ページ**は、**興味深いDOMがあるページ**を読み込みます。
* **2番目のページ**は、**コールバックを悪用**し、**`opener`**オブジェクトを使用して**初期ページ内でアクションをアクセスして実行**します（これは今や興味深いDOMを含んでいます）。

{% hint style="danger" %}
初期ページが2番目のページを作成した後に新しいURLにアクセスしても、2番目のページの**`opener`オブジェクトは新しいDOM内の最初のページへの有効な参照**です。

さらに、2番目のページがopenerオブジェクトを使用できるようにするには、**両方のページが同じオリジンにある必要があります**。この脆弱性を悪用するには、**同じオリジンのXSS**の種類を見つける必要があります。
{% endhint %}

### 悪用

* このフォームを使用して、この種の脆弱性を悪用する**PoCを生成**できます：[https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* クリックするHTML要素へのDOMパスを見つけるには、このブラウザ拡張機能を使用できます：[https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### 例

* [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)で脆弱な例を見つけることができます
* この例では、サーバーが**javascriptコードを生成**し、**コールバックパラメータの内容に基づいて**HTMLに**追加**しています：`<script>opener.{callbacl_content}</script>`。この例では、`opener`の使用を明示する必要はありません。
* また、このCTF解説をチェックしてください：[https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## 参考文献

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)
