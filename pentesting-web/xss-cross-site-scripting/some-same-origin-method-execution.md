# SOME - Same Origin Method Execution

{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
学习与实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注** 我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 分享黑客技巧。

</details>
{% endhint %}

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io) 是一个由 **暗网** 驱动的搜索引擎，提供 **免费** 功能以检查公司或其客户是否被 **窃取恶意软件** **入侵**。

WhiteIntel 的主要目标是打击由于信息窃取恶意软件导致的账户接管和勒索软件攻击。

您可以访问他们的网站并免费尝试他们的引擎：

{% embed url="https://whiteintel.io" %}

***

## Same Origin Method Execution

有时您可以在页面中执行一些有限的 JavaScript。例如，在您可以[ **控制将被执行的回调值**](./#javascript-function)的情况下。

在这些情况下，您可以做的最好的事情之一是 **访问 DOM 以调用您能找到的任何** 敏感操作（例如点击按钮）。然而，通常您会在 **没有任何有趣内容的 DOM 的小端点** 中发现此漏洞。

在这些场景中，这种攻击将非常有用，因为其目标是能够 **滥用来自同一域的不同页面中的有限 JS 执行**，以进行更有趣的操作。

基本上，攻击流程如下：

* 找到一个 **您可以滥用的回调**（可能限制为 \[\w\\.\_]）。
* 如果没有限制并且您可以执行任何 JS，您可以像常规 XSS 一样滥用它。
* 让 **受害者打开一个** 由 **攻击者** 控制的页面。
* **页面将自己** 在 **不同窗口** 中打开（新窗口将有对象 **`opener`** 引用初始窗口）。
* **初始页面** 将加载 **有趣的 DOM** 所在的 **页面**。
* **第二个页面** 将加载 **滥用回调的易受攻击页面**，并使用 **`opener`** 对象 **访问并在初始页面中执行某些操作**（现在包含有趣的 DOM）。

{% hint style="danger" %}
请注意，即使初始页面在创建第二个页面后访问新 URL，**第二个页面的 `opener` 对象仍然是对新 DOM 中第一个页面的有效引用**。

此外，为了使第二个页面能够使用 opener 对象，**两个页面必须在同一源**。这就是为什么为了滥用此漏洞，您需要找到某种 **同源中的 XSS**。
{% endhint %}

### Exploitation

* 您可以使用此表单来 **生成 PoC** 以利用此类漏洞：[https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* 为了找到带有点击的 HTML 元素的 DOM 路径，您可以使用此浏览器扩展：[https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Example

* 您可以在 [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/) 找到一个易受攻击的示例。
* 请注意，在此示例中，服务器 **生成 JavaScript 代码** 并 **将其添加** 到基于 **回调参数内容的 HTML** 中：`<script>opener.{callbacl_content}</script>`。这就是为什么在此示例中您不需要明确指示使用 `opener`。
* 还可以查看此 CTF 文章：[https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## References

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)

{% hint style="success" %}
学习与实践 AWS 黑客技术：<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks 培训 AWS 红队专家 (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
学习与实践 GCP 黑客技术：<img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks 培训 GCP 红队专家 (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>支持 HackTricks</summary>

* 查看 [**订阅计划**](https://github.com/sponsors/carlospolop)!
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**Telegram 群组**](https://t.me/peass) 或 **关注** 我们的 **Twitter** 🐦 [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub 仓库提交 PR 分享黑客技巧。

</details>
{% endhint %}
