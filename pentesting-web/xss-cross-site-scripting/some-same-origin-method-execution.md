# SOME - 同源方法执行

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在一家**网络安全公司**工作吗？想要在HackTricks中看到你的**公司广告**吗？或者想要**获取PEASS的最新版本或下载HackTricks的PDF**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品——[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或者**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享你的黑客技巧。**

</details>

## 同源方法执行

有时候你可以在一个页面中执行一些有限的javascript代码。例如，在你可以**控制将要执行的回调值**的情况下。

在这种情况下，你可以做的最好的事情之一就是**访问DOM以调用其中的敏感操作**（比如点击一个按钮）。然而，通常你会在**没有任何有趣的DOM内容的小型端点**中发现这个漏洞。

在这些场景中，这种攻击将非常有用，因为它的目标是能够从**同一域中的不同页面滥用DOM中的有限JS执行**，并执行更有趣的操作。

基本上，攻击流程如下：

* 找到一个可以滥用的**回调函数**（可能仅限于\[\w\\.\_]）。
* 如果没有限制并且你可以执行任何JS代码，你可以将其视为常规的XSS攻击。
* 让**受害者打开**由**攻击者控制的页面**。
* **页面将在不同的窗口中打开**（新窗口将具有引用初始窗口的**`opener`**对象）。
* **初始页面**将加载包含**有趣DOM**的**页面**。
* **第二个页面**将加载**滥用回调函数的易受攻击页面**，并使用**`opener`**对象来**访问并在初始页面中执行某些操作**（现在包含有趣的DOM）。

{% hint style="danger" %}
请注意，即使初始页面在创建第二个页面后访问了一个新的URL，第二个页面的**`opener`对象仍然是对新DOM中第一个页面的有效引用**。

此外，为了使第二个页面能够使用opener对象，**两个页面必须处于同一源**。这就是为什么为了滥用这个漏洞，你需要找到一种**在同一源中的XSS漏洞**的原因。
{% endhint %}

### 利用

* 你可以使用这个表单来**生成一个用于利用这种类型漏洞的PoC**：[https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* 为了找到一个具有点击功能的HTML元素的DOM路径，你可以使用这个浏览器扩展：[https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### 示例

* 你可以在[https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)找到一个易受攻击的示例。
* 请注意，在这个示例中，服务器**生成javascript代码**并将其基于**回调参数的内容**添加到HTML中：`<script>opener.{callbacl_content}</script>`。这就是为什么在这个示例中，你不需要显式指示使用`opener`的原因。
* 还请查看这个CTF解题报告：[https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## 参考资料

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 你在一家**网络安全公司**工作吗？想要在HackTricks中看到你的**公司广告**吗？或者想要**获取PEASS的最新版本或下载HackTricks的PDF**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品——[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获取[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或者**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享你的黑客技巧。**
</details>
