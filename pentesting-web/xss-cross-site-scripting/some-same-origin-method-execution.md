# SOME - Esecuzione di metodi con la stessa origine

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Lavori in una **azienda di sicurezza informatica**? Vuoi vedere la tua **azienda pubblicizzata in HackTricks**? O vuoi avere accesso all'**ultima versione di PEASS o scaricare HackTricks in PDF**? Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* **Unisciti al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR al** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **e al** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Esecuzione di metodi con la stessa origine

Ci saranno occasioni in cui puoi eseguire un po' di codice JavaScript limitato in una pagina. Ad esempio, nel caso in cui puoi **controllare un valore di callback che verr√† eseguito**.

In questi casi, una delle migliori cose che puoi fare √® **accedere al DOM per chiamare qualsiasi** azione sensibile che puoi trovare l√¨ (come fare clic su un pulsante). Tuttavia, di solito troverai questa vulnerabilit√† in **piccoli endpoint senza nulla di interessante nel DOM**.

In questi scenari, questo attacco sar√† molto utile, perch√© il suo obiettivo √® quello di **sfruttare l'esecuzione JS limitata all'interno di un DOM da una pagina diversa dello stesso dominio** con azioni molto interessanti.

In sostanza, il flusso dell'attacco √® il seguente:

* Trova una **callback che puoi sfruttare** (potenzialmente limitata a \[\w\\.\_]).
* Se non √® limitata e puoi eseguire qualsiasi JS, puoi semplicemente sfruttarla come un normale XSS.
* Fai **aprire una pagina** controllata dall'**attaccante** alla **vittima**.
* La **pagina si aprir√† da sola** in una **finestra diversa** (la nuova finestra avr√† l'oggetto **`opener`** che fa riferimento a quella iniziale).
* La **pagina iniziale** caricher√† la **pagina** in cui si trova il **DOM interessante**.
* La **seconda pagina** caricher√† la **pagina vulnerabile sfruttando la callback** e utilizzando l'oggetto **`opener`** per **accedere ed eseguire un'azione nella pagina iniziale** (che ora contiene il DOM interessante).

{% hint style="danger" %}
Nota che anche se la pagina iniziale accede a un nuovo URL dopo aver creato la seconda pagina, l'**oggetto `opener` della seconda pagina √® ancora un riferimento valido alla prima pagina nel nuovo DOM**.

Inoltre, affinch√© la seconda pagina possa utilizzare l'oggetto opener, **entrambe le pagine devono essere nella stessa origine**. Questa √® la ragione per cui, per sfruttare questa vulnerabilit√†, √® necessario trovare una sorta di **XSS nella stessa origine**.
{% endhint %}

### Sfruttamento

* Puoi utilizzare questo modulo per **generare un PoC** per sfruttare questo tipo di vulnerabilit√†: [https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* Per trovare un percorso DOM verso un elemento HTML con un clic, puoi utilizzare questa estensione del browser: [https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Esempio

* Puoi trovare un esempio vulnerabile su [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)
* Nota che in questo esempio il server sta **generando codice JavaScript** e lo **aggiunge** all'HTML in base al **contenuto del parametro di callback:** `<script>opener.{callbacl_content}</script>`. Ecco perch√© in questo esempio non √® necessario indicare esplicitamente l'uso di `opener`.
* Controlla anche questo writeup CTF: [https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## Riferimenti

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)

<details>

<summary><strong>Impara l'hacking di AWS da zero a esperto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Lavori in una **azienda di sicurezza informatica**? Vuoi vedere la tua **azienda pubblicizzata in HackTricks**? O vuoi avere accesso all'**ultima versione di PEASS o scaricare HackTricks in PDF**? Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT esclusivi**](https://opensea.io/collection/the-peass-family)
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* **Unisciti al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguimi** su **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR al** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **e al** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
