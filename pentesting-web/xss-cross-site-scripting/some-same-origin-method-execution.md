# SOME - 同一オリジンメソッド実行

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>を通じてゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

* **サイバーセキュリティ企業**で働いていますか？ **HackTricksで企業を宣伝**したいですか？または、**最新バージョンのPEASSにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)コレクションをご覧ください
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* **💬** [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter**で私をフォローする🐦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **ハッキングテクニックを共有するために** [**hacktricksリポジトリ**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloudリポジトリ**](https://github.com/carlospolop/hacktricks-cloud) **にPRを提出してください**。

</details>

### [WhiteIntel](https://whiteintel.io)

<figure><img src="../../.gitbook/assets/image (1227).png" alt=""><figcaption></figcaption></figure>

[**WhiteIntel**](https://whiteintel.io)は、**ダークウェブ**を活用した検索エンジンで、企業やその顧客が**盗難マルウェア**によって**侵害**されていないかをチェックする**無料**機能を提供しています。

WhiteIntelの主な目標は、情報窃取マルウェアによるアカウント乗っ取りやランサムウェア攻撃に対抗することです。

彼らのウェブサイトをチェックして、無料でエンジンを試すことができます：

{% embed url="https://whiteintel.io" %}

***

## 同一オリジンメソッド実行

ページ内で一部の制限付きjavascriptを実行できる場合があります。たとえば、[**実行されるコールバック値を制御できる場合**](./#javascript-function)です。

そのような場合、できることの1つは、**DOMにアクセスして**（たとえば、ボタンをクリックするなど）**そこで見つけた機密アクションを呼び出すこと**です。ただし、通常、**DOMに興味深いものがない小さなエンドポイントでこの脆弱性を見つける**ことがあります。

そのようなシナリオでは、この攻撃は非常に役立ちます。なぜなら、その目的は、**同じドメイン内の異なるページからDOM内の制限付きJS実行を悪用できるようにする**ことです。

基本的に、攻撃フローは次のとおりです：

* **悪用できるコールバックを見つける**（おそらく\[\w\\.\_]に制限されている可能性があります）。
* 制限がなく、任意のJSを実行できる場合は、これを通常のXSSとして悪用できます
* **被害者に** **攻撃者が制御するページを開かせる**
* **ページは** **異なるウィンドウ**で**自分自身を開く**（新しいウィンドウには初期のウィンドウを参照する**`opener`**オブジェクトがあります）
* **初期ページ**は、**興味深いDOMがあるページ**を読み込みます。
* **2番目のページ**は、**コールバックを悪用**し、**`opener`**オブジェクトを使用して**初期ページ**で**アクションをアクセスして実行**します（これには今や興味深いDOMが含まれています）。

{% hint style="danger" %}
初期ページが2番目のページを作成した後に新しいURLにアクセスしても、**2番目のページの`opener`オブジェクトは新しいDOM内の最初のページへの有効な参照**です。

さらに、2番目のページがopenerオブジェクトを使用できるようにするには、**両方のページが同じオリジンにある必要があります**。この脆弱性を悪用するには、**同じオリジン内のXSSの種類を見つける必要がある**ためです。
{% endhint %}

### 悪用

* このフォームを使用して、この種の脆弱性を悪用するPoCを**生成**できます：[https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* クリックでHTML要素へのDOMパスを見つけるには、このブラウザ拡張機能を使用できます：[https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### 例

* [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)で脆弱な例を見つけることができます
* この例では、サーバーが**javascriptコードを生成**し、**コールバックパラメータの内容に基づいて**HTMLに**追加**しています：`<script>opener.{callbacl_content}</script>`。この例では、`opener`の使用を明示する必要がないため、注意してください。
* また、このCTF解説もチェックしてください：[https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## 参考文献

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)
