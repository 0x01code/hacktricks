# SOME - Same Origin Method Execution

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* **サイバーセキュリティ企業**で働いていますか？**HackTricksで企業を宣伝**したいですか？または**最新版のPEASSにアクセスしたり、HackTricksをPDFでダウンロード**したいですか？[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)コレクションを入手してください
* [**公式PEASS＆HackTricksグッズ**](https://peass.creator-spring.com)を手に入れましょう
* [**💬**](https://emojipedia.org/speech-balloon/) [**Discordグループ**](https://discord.gg/hRep4RUj7f)または[**telegramグループ**](https://t.me/peass)に**参加**するか、**Twitter** 🐦[**@carlospolopm**](https://twitter.com/hacktricks_live)**をフォロー**してください。
* **ハッキングテクニックを共有するために** [**hacktricksリポジトリ**](https://github.com/carlospolop/hacktricks) **と** [**hacktricks-cloudリポジトリ**](https://github.com/carlospolop/hacktricks-cloud) **にPRを提出**してください。

</details>

## Same Origin Method Execution

あるページで**制限されたJavaScriptを実行**できる場合があります。たとえば、**実行されるコールバック値を制御できる**場合です。

そのような場合、できることの1つは、**DOMにアクセスして**（たとえばボタンをクリックするなどの）**機密アクションを呼び出すこと**です。ただし、通常、**DOMに興味深いものがない小さなエンドポイント**でこの脆弱性を見つけることがあります。

そのようなシナリオでは、この攻撃は非常に役立ちます。なぜなら、その目的は、**同じドメインの異なるページからDOM内の制限されたJS実行を悪用**して、より興味深いアクションを実行できるようにすることです。

基本的に、攻撃フローは次のとおりです：

* **悪用できるコールバックを見つける**（おそらく\[\w\\.\_]に制限されている可能性があります）。
* 制限がなく、任意のJSを実行できる場合は、これを通常のXSSとして悪用できます。
* **被害者に** **攻撃者が制御するページを開かせる**
* **ページは自分自身を** **異なるウィンドウ**（新しいウィンドウには初期のウィンドウを参照する**`opener`**オブジェクトがあります）で**開きます**
* **初期ページ**は**興味深いDOMがあるページ**を読み込みます。
* **2番目のページ**は**コールバックを悪用**し、**`opener`**オブジェクトを使用して**初期ページ**（今や興味深いDOMを含む）で**アクションをアクセスして実行**します。

{% hint style="danger" %}
初期ページが2番目のページを作成した後に新しいURLにアクセスしても、**2番目のページの`opener`オブジェクトは新しいDOM内の最初のページへの有効な参照**です。

さらに、2番目のページがopenerオブジェクトを使用できるようにするには、**両方のページが同じオリジンにある必要があります**。この脆弱性を悪用するには、**同じオリジンのXSS**を見つける必要があるためです。
{% endhint %}

### Exploitation

* このフォームを使用して、この種の脆弱性を悪用する**PoCを生成**できます：[https://www.someattack.com/Playground/SOMEGenerator](https://www.someattack.com/Playground/SOMEGenerator)
* クリックするHTML要素へのDOMパスを見つけるために、このブラウザ拡張機能を使用できます：[https://www.someattack.com/Playground/targeting\_tool](https://www.someattack.com/Playground/targeting\_tool)

### Example

* [https://www.someattack.com/Playground/](https://www.someattack.com/Playground/)で脆弱な例を見つけることができます。
* この例では、サーバーが**JavaScriptコードを生成**し、**コールバックパラメータの内容に基づいて**HTMLに**追加**しています：`<script>opener.{callbacl_content}</script>`。この例では、`opener`の使用を明示する必要はありません。
* また、このCTF解説もチェックしてください：[https://ctftime.org/writeup/36068](https://ctftime.org/writeup/36068)

## References

* [https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/](https://conference.hitb.org/hitbsecconf2017ams/sessions/everybody-wants-some-advance-same-origin-method-execution/)
