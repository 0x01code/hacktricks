## XSS DOM

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une entreprise de **cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) **groupe Discord** ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Vuln√©rabilit√©s DOM**

> **Sources**
>
> Une source est une propri√©t√© JavaScript qui accepte des donn√©es potentiellement contr√¥l√©es par un attaquant. Un exemple de source est la propri√©t√© `location.search` car elle lit l'entr√©e de la cha√Æne de requ√™te, qui est relativement simple √† contr√¥ler pour un attaquant. En fin de compte, toute propri√©t√© qui peut √™tre contr√¥l√©e par l'attaquant est une source potentielle. Cela inclut l'URL de r√©f√©rence (expos√©e par la cha√Æne `document.referrer`), les cookies de l'utilisateur (expos√©s par la cha√Æne `document.cookie`) et les messages Web.

> **Sinks**
>
> Un sink est une fonction JavaScript potentiellement dangereuse ou un objet DOM qui peut causer des effets ind√©sirables si des donn√©es contr√¥l√©es par un attaquant lui sont transmises. Par exemple, la fonction `eval()` est un sink car elle traite l'argument qui lui est pass√© en tant que JavaScript. Un exemple de sink HTML est `document.body.innerHTML` car il permet potentiellement √† un attaquant d'injecter du HTML malveillant et d'ex√©cuter du JavaScript arbitraire.

Fondamentalement, les vuln√©rabilit√©s bas√©es sur le DOM surviennent lorsqu'un site Web **transmet des donn√©es d'une source √† un sink**, qui traite ensuite les donn√©es de mani√®re non s√©curis√©e dans le contexte de la session du client.

{% hint style="info" %}
**Vous pouvez trouver une liste plus mise √† jour des sources et des sinks dans** [**https://github.com/wisec/domxsswiki/wiki**](https://github.com/wisec/domxsswiki/wiki)
{% endhint %}

**Sources courantes :**
```javascript
document.URL
document.documentURI
document.URLUnencoded
document.baseURI
location
document.cookie
document.referrer
window.name
history.pushState
history.replaceState
localStorage
sessionStorage
IndexedDB (mozIndexedDB, webkitIndexedDB, msIndexedDB)
Database
```
**Sources courantes :**

| [**Redirection ouverte**](dom-xss.md#open-redirect)                                    | [**Injection de Javascript**](dom-xss.md#javascript-injection)                         | [**Manipulation de donn√©es DOM**](dom-xss.md#dom-data-manipulation) | **jQuery**                                                             |
| -------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- | ------------------------------------------------------------- | ---------------------------------------------------------------------- |
| `location`                                                                       | `eval()`                                                                            | `scriptElement.src`                                           | `add()`                                                                |
| `location.host`                                                                  | `Function() constructor`                                                            | `scriptElement.text`                                          | `after()`                                                              |
| `location.hostname`                                                              | `setTimeout()`                                                                      | `scriptElement.textContent`                                   | `append()`                                                             |
| `location.href`                                                                  | `setInterval()`                                                                     | `scriptElement.innerText`                                     | `animate()`                                                            |
| `location.pathname`                                                              | `setImmediate()`                                                                    | `someDOMElement.setAttribute()`                               | `insertAfter()`                                                        |
| `location.search`                                                                | `execCommand()`                                                                     | `someDOMElement.search`                                       | `insertBefore()`                                                       |
| `location.protocol`                                                              | `execScript()`                                                                      | `someDOMElement.text`                                         | `before()`                                                             |
| `location.assign()`                                                              | `msSetImmediate()`                                                                  | `someDOMElement.textContent`                                  | `html()`                                                               |
| `location.replace()`                                                             | `range.createContextualFragment()`                                                  | `someDOMElement.innerText`                                    | `prepend()`                                                            |
| `open()`                                                                         | `crypto.generateCRMFRequest()`                                                      | `someDOMElement.outerText`                                    | `replaceAll()`                                                         |
| `domElem.srcdoc`                                                                 | **\`\`**[**Manipulation de chemin de fichier local**](dom-xss.md#local-file-path-manipulation) | `someDOMElement.value`                                        | `replaceWith()`                                                        |
| `XMLHttpRequest.open()`                                                          | `FileReader.readAsArrayBuffer()`                                                    | `someDOMElement.name`                                         | `wrap()`                                                               |
| `XMLHttpRequest.send()`                                                          | `FileReader.readAsBinaryString()`                                                   | `someDOMElement.target`                                       | `wrapInner()`                                                          |
| `jQuery.ajax()`                                                                  | `FileReader.readAsDataURL()`                                                        | `someDOMElement.method`                                       | `wrapAll()`                                                            |
| `$.ajax()`                                                                       | `FileReader.readAsText()`                                                           | `someDOMElement.type`                                         | `has()`                                                                |
| **\`\`**[**Manipulation de requ√™te Ajax**](dom-xss.md#ajax-request-manipulation)    | `FileReader.readAsFile()`                                                           | `someDOMElement.backgroundImage`                              | `constructor()`                                                        |
| `XMLHttpRequest.setRequestHeader()`                                              | `FileReader.root.getFile()`                                                         | `someDOMElement.cssText`                                      | `init()`                                                               |
| `XMLHttpRequest.open()`                                                          | `FileReader.root.getFile()`                                                         | `someDOMElement.codebase`                                     | `index()`                                                              |
| `XMLHttpRequest.send()`                                                          | [**Manipulation de lien**](dom-xss.md#link-manipulation)                               | `someDOMElement.innerHTML`                                    | `jQuery.parseHTML()`                                                   |
| `jQuery.globalEval()`                                                            | `someDOMElement.href`                                                               | `someDOMElement.outerHTML`                                    | `$.parseHTML()`                                                        |
| `$.globalEval()`                                                                 | `someDOMElement.src`                                                                | `someDOMElement.insertAdjacentHTML`                           | [**Injection de JSON c√¥t√© client**](dom-xss.md#client-side-sql-injection) |
| **\`\`**[**Manipulation de stockage HTML5**](dom-xss.md#html-5-storage-manipulation) | `someDOMElement.action`                                                             | `someDOMElement.onevent`                                      | `JSON.parse()`                                                         |
| `sessionStorage.setItem()`                                                       | [**Injection XPath**](dom-xss.md#xpath-injection)                                   | `document.write()`                                            | `jQuery.parseJSON()`                                                   |
| `localStorage.setItem()`                                                         | `document.evaluate()`                                                               | `document.writeln()`                                          | `$.parseJSON()`                                                        |
| **``**[**`D√©ni de service`**](dom-xss.md#denial-of-service)**``**              | `someDOMElement.evaluate()`                                                         | `document.title`                                              | **\`\`**[**Manipulation de cookie**](dom-xss.md#cookie-manipulation)      |
| `requestFileSystem()`                                                            | **\`\`**[**Manipulation de domaine de document**](dom-xss.md#document-domain-manipulation) | `document.implementation.createHTMLDocument()`                | `document.cookie`                                                      |
| `RegExp()`                                                                       | `document.domain`                                                                   | `history.pushState()`                                         | [**Empoisonnement d'URL WebSocket**](dom-xss.md#websocket-url-poisoning)      |
| [**Injection SQL c√¥t√© client**](dom-xss.md#client-side-sql-injection)            | [**Manipulation de message Web**](dom-xss.md#web-message-manipulation)                 | `history.replaceState()`                                      | `WebSocket`                                                            |
| `executeSql()`                                                                   | `postMessage()`                                                                     | \`\`                                                          | \`\`                                                                   |

Le puits **`innerHTML`** n'accepte pas les √©l√©ments `script` sur les navigateurs modernes, ni les √©v√©nements `svg onload`. Cela signifie que vous devrez utiliser des √©l√©ments alternatifs tels que `img` ou `iframe`.

Ce type de XSS est probablement le **plus difficile √† trouver**, car vous devez regarder √† l'int√©rieur du code JS, voir s'il **utilise** un objet dont vous contr√¥lez la **valeur**, et dans ce cas, voir s'il y a **un moyen de l'exploiter** pour ex√©cuter du JS arbitraire.

## Outils pour les trouver

* [https://github.com/mozilla/eslint-plugin-no-unsanitized](https://github.com/mozilla/eslint-plugin-no-unsanitized)

## Exemples

### Redirection ouverte

De : [https://portswigger.net/web-security/dom-based/open-redirection](https://portswigger.net/web-security/dom-based/open-redirection)

#### Comment

Les vuln√©rabilit√©s de redirection ouverte bas√©es sur le DOM surviennent lorsqu'un script √©crit des donn√©es **contr√¥lables par l'attaquant** dans un **puits** qui peut d√©clencher une **navigation entre domaines**.

Rappelez-vous que **si vous pouvez d√©marrer l'URL** o√π la victime va √™tre **redirig√©e**, vous pouvez ex√©cuter du **code arbitraire** comme : **`javascript:alert(1)`**

#### Puits
```
location
location.host
location.hostname
location.href
location.pathname
location.search
location.protocol
location.assign()
location.replace()
open()
domElem.srcdoc
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.ajax()
$.ajax()
```
### Manipulation de cookies

De: [https://portswigger.net/web-security/dom-based/cookie-manipulation](https://portswigger.net/web-security/dom-based/cookie-manipulation)

#### Comment

Les vuln√©rabilit√©s de manipulation de cookies bas√©es sur le DOM surviennent lorsqu'un script √©crit des donn√©es contr√¥l√©es par l'attaquant dans la valeur d'un cookie.\
Cela peut √™tre abus√© pour faire en sorte que la page se comporte de mani√®re inattendue (si le cookie est utilis√© sur le web) ou pour effectuer une attaque de fixation de session (si le cookie est utilis√© pour suivre la session de l'utilisateur).

#### Sources
```
document.cookie
```
### Injection de JavaScript

De: [https://portswigger.net/web-security/dom-based/javascript-injection](https://portswigger.net/web-security/dom-based/javascript-injection)

#### Comment

Les vuln√©rabilit√©s d'injection de JavaScript bas√©es sur le DOM se produisent lorsqu'un script ex√©cute des donn√©es contr√¥l√©es par l'attaquant en tant que JavaScript.

#### Cibles
```
eval()
Function() constructor
setTimeout()
setInterval()
setImmediate()
execCommand()
execScript()
msSetImmediate()
range.createContextualFragment()
crypto.generateCRMFRequest()
```
### Manipulation de document-domain

De: [https://portswigger.net/web-security/dom-based/document-domain-manipulation](https://portswigger.net/web-security/dom-based/document-domain-manipulation)

#### Comment

Les vuln√©rabilit√©s de manipulation de document-domain surviennent lorsqu'un script utilise des donn√©es contr√¥l√©es par l'attaquant pour d√©finir la propri√©t√© `document.domain`.

La propri√©t√© `document.domain` est utilis√©e par les navigateurs dans leur application de la politique de m√™me origine. Si deux pages de diff√©rentes origines d√©finissent explicitement la m√™me valeur de `document.domain`, alors ces deux pages peuvent interagir de mani√®re non restreinte.\
Les navigateurs imposent g√©n√©ralement certaines restrictions sur les valeurs qui peuvent √™tre attribu√©es √† `document.domain`, et peuvent emp√™cher l'utilisation de valeurs compl√®tement diff√©rentes de l'origine r√©elle de la page. Mais cela ne se produit pas toujours et ils permettent g√©n√©ralement d'utiliser des domaines enfants ou parents.

#### Sinks
```
document.domain
```
### Empoisonnement d'URL WebSocket

De: [https://portswigger.net/web-security/dom-based/websocket-url-poisoning](https://portswigger.net/web-security/dom-based/websocket-url-poisoning)

#### Comment

L'empoisonnement d'URL WebSocket se produit lorsqu'un script utilise des donn√©es contr√¥lables comme URL cible d'une connexion WebSocket.

#### Sources

Le constructeur `WebSocket` peut conduire √† des vuln√©rabilit√©s d'empoisonnement d'URL WebSocket.

### Manipulation de lien

De: [https://portswigger.net/web-security/dom-based/link-manipulation](https://portswigger.net/web-security/dom-based/link-manipulation)

#### Comment

Les vuln√©rabilit√©s de manipulation de lien bas√©es sur le DOM se produisent lorsqu'un script √©crit des donn√©es contr√¥lables par l'attaquant vers une cible de navigation dans la page actuelle, telle qu'un lien cliquable ou l'URL de soumission d'un formulaire.

#### Sources
```
someDOMElement.href
someDOMElement.src
someDOMElement.action
```
### Manipulation de requ√™te Ajax

De: [https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation](https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation)

#### Comment

Les vuln√©rabilit√©s de manipulation de requ√™te Ajax surviennent lorsqu'un script √©crit des donn√©es contr√¥l√©es par l'attaquant dans une requ√™te Ajax qui est √©mise √† l'aide d'un objet `XmlHttpRequest`.

#### Sinks
```
XMLHttpRequest.setRequestHeader()
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.globalEval()
$.globalEval()
```
### Manipulation de chemin de fichier local

De: [https://portswigger.net/web-security/dom-based/local-file-path-manipulation](https://portswigger.net/web-security/dom-based/local-file-path-manipulation)

#### Comment

Les vuln√©rabilit√©s de manipulation de chemin de fichier local surviennent lorsqu'un script transmet des donn√©es contr√¥l√©es par l'attaquant √† une API de gestion de fichiers en tant que param√®tre `filename`. Un attaquant peut utiliser cette vuln√©rabilit√© pour construire une URL qui, si elle est visit√©e par un autre utilisateur, **forcera le navigateur de l'utilisateur √† ouvrir/√©crire un fichier local arbitraire**.

#### Sources
```
FileReader.readAsArrayBuffer()
FileReader.readAsBinaryString()
FileReader.readAsDataURL()
FileReader.readAsText()
FileReader.readAsFile()
FileReader.root.getFile()
FileReader.root.getFile()
```
### Injection SQL c√¥t√© client

De: [https://portswigger.net/web-security/dom-based/client-side-sql-injection](https://portswigger.net/web-security/dom-based/client-side-sql-injection)

#### Comment

Les vuln√©rabilit√©s d'injection SQL c√¥t√© client surviennent lorsqu'un script incorpore des donn√©es contr√¥l√©es par l'attaquant dans une requ√™te SQL c√¥t√© client de mani√®re non s√©curis√©e.

#### Cibles
```
executeSql()
```
### Manipulation de stockage HTML5

De: [https://portswigger.net/web-security/dom-based/html5-storage-manipulation](https://portswigger.net/web-security/dom-based/html5-storage-manipulation)

#### Comment

Les vuln√©rabilit√©s de manipulation de stockage HTML5 surviennent lorsqu'un script **stocke des donn√©es contr√¥l√©es par l'attaquant dans le stockage HTML5** du navigateur web (soit `localStorage` soit `sessionStorage`).\
Ce **comportement ne constitue pas en soi une vuln√©rabilit√© de s√©curit√©**. Cependant, si l'application **lit ult√©rieurement les donn√©es stock√©es et les traite de mani√®re non s√©curis√©e**, un attaquant peut exploiter le m√©canisme de stockage pour d√©livrer d'autres attaques bas√©es sur le DOM, telles que l'injection de script et la faille XSS (cross-site scripting).

#### Sinks
```
sessionStorage.setItem()
localStorage.setItem()
```
### Injection XPath

De: [https://portswigger.net/web-security/dom-based/client-side-xpath-injection](https://portswigger.net/web-security/dom-based/client-side-xpath-injection)

#### Comment

Les vuln√©rabilit√©s d'injection XPath bas√©es sur le DOM se produisent lorsqu'un script incorpore des donn√©es contr√¥l√©es par l'attaquant dans une requ√™te XPath.

#### Cibles
```
document.evaluate()
someDOMElement.evaluate()
```
### Injection JSON c√¥t√© client

De: [https://portswigger.net/web-security/dom-based/client-side-json-injection](https://portswigger.net/web-security/dom-based/client-side-json-injection)

#### Comment

Les vuln√©rabilit√©s d'injection JSON bas√©es sur le DOM se produisent lorsqu'un script incorpore des donn√©es contr√¥l√©es par l'attaquant dans une cha√Æne qui est analys√©e en tant que structure de donn√©es JSON, puis trait√©e par l'application.

#### Cibles
```
JSON.parse()
jQuery.parseJSON()
$.parseJSON()
```
### Manipulation de messages Web

De: [https://portswigger.net/web-security/dom-based/web-message-manipulation](https://portswigger.net/web-security/dom-based/web-message-manipulation)

#### Comment

Les vuln√©rabilit√©s de messages Web se produisent lorsqu'un script envoie des donn√©es contr√¥l√©es par un attaquant en tant que message Web √† un autre document dans le navigateur.\
**Exemple** de manipulation de messages Web vuln√©rables dans [https://portswigger.net/web-security/dom-based/controlling-the-web-message-source](https://portswigger.net/web-security/dom-based/controlling-the-web-message-source)

#### Sources

La m√©thode `postMessage()` pour l'envoi de messages Web peut entra√Æner des vuln√©rabilit√©s si l'√©couteur d'√©v√©nements pour la r√©ception de messages g√®re les donn√©es entrantes de mani√®re non s√©curis√©e.

### Manipulation de donn√©es DOM

De: [https://portswigger.net/web-security/dom-based/dom-data-manipulation](https://portswigger.net/web-security/dom-based/dom-data-manipulation)

#### Comment

Les vuln√©rabilit√©s de manipulation de donn√©es DOM se produisent lorsqu'un script √©crit des donn√©es contr√¥l√©es par un attaquant dans un champ du DOM qui est utilis√© dans l'interface utilisateur visible ou la logique c√¥t√© client. Un attaquant peut utiliser cette vuln√©rabilit√© pour construire une URL qui, si elle est visit√©e par un autre utilisateur, modifiera l'apparence ou le comportement de l'interface utilisateur c√¥t√© client.

#### Sources
```
scriptElement.src
scriptElement.text
scriptElement.textContent
scriptElement.innerText
someDOMElement.setAttribute()
someDOMElement.search
someDOMElement.text
someDOMElement.textContent
someDOMElement.innerText
someDOMElement.outerText
someDOMElement.value
someDOMElement.name
someDOMElement.target
someDOMElement.method
someDOMElement.type
someDOMElement.backgroundImage
someDOMElement.cssText
someDOMElement.codebase
document.title
document.implementation.createHTMLDocument()
history.pushState()
history.replaceState()
```
### D√©ni de service

De: [https://portswigger.net/web-security/dom-based/denial-of-service](https://portswigger.net/web-security/dom-based/denial-of-service)

#### Comment

Les vuln√©rabilit√©s de d√©ni de service bas√©es sur le DOM surviennent lorsqu'un script transmet des donn√©es contr√¥l√©es par l'attaquant de mani√®re non s√©curis√©e √† une API de plateforme probl√©matique, telle qu'une API dont l'invocation peut amener l'ordinateur de l'utilisateur √† consommer des quantit√©s excessives de CPU ou d'espace disque. Cela peut entra√Æner des effets secondaires si le navigateur restreint la fonctionnalit√© du site Web, par exemple en rejetant les tentatives de stockage de donn√©es dans `localStorage` ou en tuant les scripts occup√©s.

#### Sinks
```
requestFileSystem()
RegExp()
```
## Dom Clobbering

{% content-ref url="dom-clobbering.md" %}
[dom-clobbering.md](dom-clobbering.md)
{% endcontent-ref %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* Travaillez-vous dans une entreprise de **cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) **groupe Discord** ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR au** [**repo hacktricks**](https://github.com/carlospolop/hacktricks) **et au** [**repo hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
