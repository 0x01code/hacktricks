# DOM XSS

<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Arbeiten Sie in einem **Cybersicherheitsunternehmen**? M√∂chten Sie Ihr **Unternehmen in HackTricks bewerben**? Oder m√∂chten Sie Zugriff auf die **neueste Version von PEASS oder HackTricks im PDF-Format** haben? √úberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* **Treten Sie der** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an das** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **und das** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **senden**.

</details>

## DOM-Schwachstellen

DOM-Schwachstellen treten auf, wenn Daten aus von Angreifern kontrollierten **Quellen** (wie `location.search`, `document.referrer` oder `document.cookie`) unsicher an **Senken** √ºbertragen werden. Senken sind Funktionen oder Objekte (z. B. `eval()`, `document.body.innerHTML`), die sch√§dlichen Inhalt ausf√ºhren oder rendern k√∂nnen, wenn ihnen b√∂sartige Daten √ºbergeben werden.

- **Quellen** sind Eingaben, die von Angreifern manipuliert werden k√∂nnen, einschlie√ülich URLs, Cookies und Webnachrichten.
- **Senken** sind potenziell gef√§hrliche Endpunkte, an denen b√∂sartige Daten zu negativen Auswirkungen f√ºhren k√∂nnen, wie z. B. das Ausf√ºhren von Skripten.

Das Risiko entsteht, wenn Daten von einer Quelle zu einer Senke flie√üen, ohne ordnungsgem√§√üe Validierung oder Bereinigung, was Angriffe wie XSS erm√∂glicht.

{% hint style="info" %}
**Eine aktualisierte Liste von Quellen und Senken finden Sie unter** [**https://github.com/wisec/domxsswiki/wiki**](https://github.com/wisec/domxsswiki/wiki)
{% endhint %}

**H√§ufige Quellen:**
```javascript
document.URL
document.documentURI
document.URLUnencoded
document.baseURI
location
document.cookie
document.referrer
window.name
history.pushState
history.replaceState
localStorage
sessionStorage
IndexedDB (mozIndexedDB, webkitIndexedDB, msIndexedDB)
Database
```
**H√§ufige Schwachstellen:**

| [**Offene Weiterleitung**](dom-xss.md#open-redirect)                                    | [**Javascript-Injection**](dom-xss.md#javascript-injection)                         | [**DOM-Datenmanipulation**](dom-xss.md#dom-data-manipulation) | **jQuery**                                                             |
| -------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- | ------------------------------------------------------------- | ---------------------------------------------------------------------- |
| `location`                                                                       | `eval()`                                                                            | `scriptElement.src`                                           | `add()`                                                                |
| `location.host`                                                                  | `Function() constructor`                                                            | `scriptElement.text`                                          | `after()`                                                              |
| `location.hostname`                                                              | `setTimeout()`                                                                      | `scriptElement.textContent`                                   | `append()`                                                             |
| `location.href`                                                                  | `setInterval()`                                                                     | `scriptElement.innerText`                                     | `animate()`                                                            |
| `location.pathname`                                                              | `setImmediate()`                                                                    | `someDOMElement.setAttribute()`                               | `insertAfter()`                                                        |
| `location.search`                                                                | `execCommand()`                                                                     | `someDOMElement.search`                                       | `insertBefore()`                                                       |
| `location.protocol`                                                              | `execScript()`                                                                      | `someDOMElement.text`                                         | `before()`                                                             |
| `location.assign()`                                                              | `msSetImmediate()`                                                                  | `someDOMElement.textContent`                                  | `html()`                                                               |
| `location.replace()`                                                             | `range.createContextualFragment()`                                                  | `someDOMElement.innerText`                                    | `prepend()`                                                            |
| `open()`                                                                         | `crypto.generateCRMFRequest()`                                                      | `someDOMElement.outerText`                                    | `replaceAll()`                                                         |
| `domElem.srcdoc`                                                                 | **\`\`**[**Manipulation des lokalen Dateipfads**](dom-xss.md#local-file-path-manipulation) | `someDOMElement.value`                                        | `replaceWith()`                                                        |
| `XMLHttpRequest.open()`                                                          | `FileReader.readAsArrayBuffer()`                                                    | `someDOMElement.name`                                         | `wrap()`                                                               |
| `XMLHttpRequest.send()`                                                          | `FileReader.readAsBinaryString()`                                                   | `someDOMElement.target`                                       | `wrapInner()`                                                          |
| `jQuery.ajax()`                                                                  | `FileReader.readAsDataURL()`                                                        | `someDOMElement.method`                                       | `wrapAll()`                                                            |
| `$.ajax()`                                                                       | `FileReader.readAsText()`                                                           | `someDOMElement.type`                                         | `has()`                                                                |
| **\`\`**[**Manipulation von Ajax-Anfragen**](dom-xss.md#ajax-request-manipulation)    | `FileReader.readAsFile()`                                                           | `someDOMElement.backgroundImage`                              | `constructor()`                                                        |
| `XMLHttpRequest.setRequestHeader()`                                              | `FileReader.root.getFile()`                                                         | `someDOMElement.cssText`                                      | `init()`                                                               |
| `XMLHttpRequest.open()`                                                          | `FileReader.root.getFile()`                                                         | `someDOMElement.codebase`                                     | `index()`                                                              |
| `XMLHttpRequest.send()`                                                          | [**Link-Manipulation**](dom-xss.md#link-manipulation)                               | `someDOMElement.innerHTML`                                    | `jQuery.parseHTML()`                                                   |
| `jQuery.globalEval()`                                                            | `someDOMElement.href`                                                               | `someDOMElement.outerHTML`                                    | `$.parseHTML()`                                                        |
| `$.globalEval()`                                                                 | `someDOMElement.src`                                                                | `someDOMElement.insertAdjacentHTML`                           | [**Client-seitige JSON-Injection**](dom-xss.md#client-side-sql-injection) |
| **\`\`**[**HTML5-Speicher-Manipulation**](dom-xss.md#html-5-storage-manipulation) | `someDOMElement.action`                                                             | `someDOMElement.onevent`                                      | `JSON.parse()`                                                         |
| `sessionStorage.setItem()`                                                       | [**XPath-Injection**](dom-xss.md#xpath-injection)                                   | `document.write()`                                            | `jQuery.parseJSON()`                                                   |
| `localStorage.setItem()`                                                         | `document.evaluate()`                                                               | `document.writeln()`                                          | `$.parseJSON()`                                                        |
| **``**[**`Denial of Service`**](dom-xss.md#denial-of-service)**``**              | `someDOMElement.evaluate()`                                                         | `document.title`                                              | **\`\`**[**Cookie-Manipulation**](dom-xss.md#cookie-manipulation)      |
| `requestFileSystem()`                                                            | **\`\`**[**Manipulation der Dokumentendom√§ne**](dom-xss.md#document-domain-manipulation) | `document.implementation.createHTMLDocument()`                | `document.cookie`                                                      |
| `RegExp()`                                                                       | `document.domain`                                                                   | `history.pushState()`                                         | [**WebSocket-URL-Vergiftung**](dom-xss.md#websocket-url-poisoning)      |
| [**Client-seitige SQL-Injection**](dom-xss.md#client-side-sql-injection)            | [**Web-Nachrichten-Manipulation**](dom-xss.md#web-message-manipulation)                 | `history.replaceState()`                                      | `WebSocket`                                                            |
| `executeSql()`                                                                   | `postMessage()`                                                                     | \`\`                                                          | \`\`                                                                   |

Die **`innerHTML`**-Schwachstelle akzeptiert auf keinem modernen Browser `script`-Elemente, und auch `svg onload`-Ereignisse werden nicht ausgel√∂st. Das bedeutet, dass alternative Elemente wie `img` oder `iframe` verwendet werden m√ºssen.

Diese Art von XSS ist wahrscheinlich am **schwierigsten zu finden**, da Sie den JS-Code √ºberpr√ºfen m√ºssen, um zu sehen, ob er ein Objekt verwendet, dessen Wert Sie kontrollieren k√∂nnen, und in diesem Fall pr√ºfen m√ºssen, ob es eine M√∂glichkeit gibt, es zu missbrauchen, um beliebigen JS-Code auszuf√ºhren.

## Tools zum Auffinden

* [https://github.com/mozilla/eslint-plugin-no-unsanitized](https://github.com/mozilla/eslint-plugin-no-unsanitized)

## Beispiele

### Offene Weiterleitung

Von: [https://portswigger.net/web-security/dom-based/open-redirection](https://portswigger.net/web-security/dom-based/open-redirection)

**Offene Weiterleitungs-Schwachstellen im DOM** treten auf, wenn ein Skript Daten, die ein Angreifer kontrollieren kann, in eine Schwachstelle schreibt, die eine Navigation zwischen Domains initiieren kann.

Es ist wichtig zu verstehen, dass die Ausf√ºhrung beliebigen Codes, wie z.B. **`javascript:alert(1)`**, m√∂glich ist, wenn Sie die Kontrolle √ºber den Anfang der URL haben, an dem die Weiterleitung erfolgt.

Schwachstellen:
```javascript
location
location.host
location.hostname
location.href
location.pathname
location.search
location.protocol
location.assign()
location.replace()
open()
domElem.srcdoc
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.ajax()
$.ajax()
```
### Cookie-Manipulation

Von: [https://portswigger.net/web-security/dom-based/cookie-manipulation](https://portswigger.net/web-security/dom-based/cookie-manipulation)

DOM-basierte Cookie-Manipulations-Schwachstellen treten auf, wenn ein Skript Daten, die von einem Angreifer kontrolliert werden k√∂nnen, in den Wert eines Cookies einbindet. Diese Schwachstelle kann zu unerwartetem Verhalten der Webseite f√ºhren, wenn das Cookie innerhalb der Seite verwendet wird. Dar√ºber hinaus kann sie ausgenutzt werden, um einen Session-Fixierungsangriff durchzuf√ºhren, wenn das Cookie zur Verfolgung von Benutzersitzungen verwendet wird. Die Haupt-Sink-Verbindung, die mit dieser Schwachstelle verbunden ist, lautet:

Sinks:
```javascript
document.cookie
```
### JavaScript-Injektion

Quelle: [https://portswigger.net/web-security/dom-based/javascript-injection](https://portswigger.net/web-security/dom-based/javascript-injection)

DOM-basierte JavaScript-Injektionsl√ºcken entstehen, wenn ein Skript Daten ausf√ºhrt, die von einem Angreifer kontrolliert werden k√∂nnen, als JavaScript-Code.

Sinks:
```javascript
eval()
Function() constructor
setTimeout()
setInterval()
setImmediate()
execCommand()
execScript()
msSetImmediate()
range.createContextualFragment()
crypto.generateCRMFRequest()
```
### Manipulation der Dokumentendom√§ne

Von: [https://portswigger.net/web-security/dom-based/document-domain-manipulation](https://portswigger.net/web-security/dom-based/document-domain-manipulation)

**Vulnerabilit√§ten bei der Manipulation der Dokumentendom√§ne** treten auf, wenn ein Skript die Eigenschaft `document.domain` mit Daten setzt, die ein Angreifer kontrollieren kann.

Die Eigenschaft `document.domain` spielt eine **wichtige Rolle** bei der **Durchsetzung** der **Same-Origin-Richtlinie** durch Browser. Wenn zwei Seiten aus unterschiedlichen Urspr√ºngen ihren `document.domain` auf den **gleichen Wert** setzen, k√∂nnen sie ohne Einschr√§nkungen interagieren. Obwohl Browser bestimmte **Grenzen** f√ºr die zuweisbaren Werte von `document.domain` festlegen, um die Zuweisung v√∂llig unabh√§ngiger Werte zum tats√§chlichen Seitenursprung zu verhindern, gibt es Ausnahmen. In der Regel erlauben Browser die Verwendung von **Unter-** oder **Elterndom√§nen**.

Sinks:
```javascript
document.domain
```
### WebSocket-URL-Vergiftung

Von: [https://portswigger.net/web-security/dom-based/websocket-url-poisoning](https://portswigger.net/web-security/dom-based/websocket-url-poisoning)

**WebSocket-URL-Vergiftung** tritt auf, wenn ein Skript **steuerbare Daten als Ziel-URL** f√ºr eine WebSocket-Verbindung verwendet.

Sinks:

Der `WebSocket`-Konstruktor kann zu WebSocket-URL-Vergiftungsschwachstellen f√ºhren.

### Link-Manipulation

Von: [https://portswigger.net/web-security/dom-based/link-manipulation](https://portswigger.net/web-security/dom-based/link-manipulation)

**DOM-basierte Link-Manipulationsschwachstellen** treten auf, wenn ein Skript **angreifersteuerbare Daten in ein Navigationsziel** innerhalb der aktuellen Seite schreibt, wie z.B. einen anklickbaren Link oder die √úbermittlungs-URL eines Formulars.

Sinks:
```javascript
someDOMElement.href
someDOMElement.src
someDOMElement.action
```
### Manipulation von Ajax-Anfragen

Quelle: [https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation](https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation)

**Vulnerabilit√§ten bei der Manipulation von Ajax-Anfragen** treten auf, wenn ein Skript **angreiferkontrollierte Daten in eine Ajax-Anfrage schreibt**, die mithilfe eines `XmlHttpRequest`-Objekts gesendet wird.

Empf√§nger:
```javascript
XMLHttpRequest.setRequestHeader()
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.globalEval()
$.globalEval()
```
### Lokale Dateipfadmanipulation

Von: [https://portswigger.net/web-security/dom-based/local-file-path-manipulation](https://portswigger.net/web-security/dom-based/local-file-path-manipulation)

**Lokale Dateipfadmanipulationsschwachstellen** treten auf, wenn ein Skript **angreifersteuerbare Daten an eine Dateiverarbeitungs-API** als den `filename`-Parameter √ºbergibt. Diese Schwachstelle kann von einem Angreifer ausgenutzt werden, um eine URL zu konstruieren, die, wenn sie von einem anderen Benutzer besucht wird, dazu f√ºhren k√∂nnte, dass der **Browser des Benutzers eine beliebige lokale Datei √∂ffnet oder schreibt**.

Sinks:
```javascript
FileReader.readAsArrayBuffer()
FileReader.readAsBinaryString()
FileReader.readAsDataURL()
FileReader.readAsText()
FileReader.readAsFile()
FileReader.root.getFile()
FileReader.root.getFile()
```
### Client-seitige SQL-Injektion

Von: [https://portswigger.net/web-security/dom-based/client-side-sql-injection](https://portswigger.net/web-security/dom-based/client-side-sql-injection)

**Client-seitige SQL-Injektionsl√ºcken** treten auf, wenn ein Skript **angreiferkontrollierte Daten unsicher in eine clientseitige SQL-Abfrage einbindet**.

Senken:
```javascript
executeSql()
```
### HTML5-Speichermanipulation

Von: [https://portswigger.net/web-security/dom-based/html5-storage-manipulation](https://portswigger.net/web-security/dom-based/html5-storage-manipulation)

**HTML5-Speichermanipulationsl√ºcken** entstehen, wenn ein Skript **angreiferkontrollierte Daten im HTML5-Speicher des Webbrowsers** (`localStorage` oder `sessionStorage`) speichert. Obwohl diese Aktion an sich keine Sicherheitsl√ºcke darstellt, wird sie problematisch, wenn die Anwendung anschlie√üend die gespeicherten Daten **unsicher liest und verarbeitet**. Dadurch k√∂nnte ein Angreifer den Speichermechanismus nutzen, um andere DOM-basierte Angriffe wie Cross-Site Scripting und JavaScript-Injection durchzuf√ºhren.

Sinks:
```javascript
sessionStorage.setItem()
localStorage.setItem()
```
### XPath-Injektion

Von: [https://portswigger.net/web-security/dom-based/client-side-xpath-injection](https://portswigger.net/web-security/dom-based/client-side-xpath-injection)

**DOM-basierte XPath-Injektionsl√ºcken** treten auf, wenn ein Skript **angreiferkontrollierte Daten in eine XPath-Abfrage einbindet**.

Sinks:
```javascript
document.evaluate()
someDOMElement.evaluate()
```
### Client-seitige JSON-Injektion

Von: [https://portswigger.net/web-security/dom-based/client-side-json-injection](https://portswigger.net/web-security/dom-based/client-side-json-injection)

**DOM-basierte JSON-Injektionsl√ºcken** treten auf, wenn ein Skript **angreiferkontrollierte Daten in einen String einf√ºgt, der als JSON-Datenstruktur interpretiert und dann von der Anwendung verarbeitet wird**.

Sinks:
```javascript
JSON.parse()
jQuery.parseJSON()
$.parseJSON()
```
### Web-Nachrichtenmanipulation

Von: [https://portswigger.net/web-security/dom-based/web-message-manipulation](https://portswigger.net/web-security/dom-based/web-message-manipulation)

**Web-Nachrichten-Schwachstellen** treten auf, wenn ein Skript **angreiferkontrollierte Daten als Web-Nachricht an ein anderes Dokument** im Browser sendet. Ein **Beispiel** f√ºr anf√§llige Web-Nachrichtenmanipulation finden Sie in der [Web Security Academy von PortSwigger](https://portswigger.net/web-security/dom-based/controlling-the-web-message-source).

Sinks:

Die Methode `postMessage()` zum Senden von Web-Nachrichten kann zu Schwachstellen f√ºhren, wenn der Ereignislistener zum Empfangen von Nachrichten die eingehenden Daten unsicher verarbeitet.

### DOM-Datenmanipulation

Von: [https://portswigger.net/web-security/dom-based/dom-data-manipulation](https://portswigger.net/web-security/dom-based/dom-data-manipulation)

**DOM-Datenmanipulationsschwachstellen** treten auf, wenn ein Skript **angreiferkontrollierte Daten in ein Feld innerhalb des DOM** schreibt, das in der sichtbaren Benutzeroberfl√§che oder der clientseitigen Logik verwendet wird. Diese Schwachstelle kann von einem Angreifer ausgenutzt werden, um eine URL zu konstruieren, die, wenn sie von einem anderen Benutzer besucht wird, das Aussehen oder Verhalten der clientseitigen Benutzeroberfl√§che √§ndern kann.

Sinks:
```javascript
scriptElement.src
scriptElement.text
scriptElement.textContent
scriptElement.innerText
someDOMElement.setAttribute()
someDOMElement.search
someDOMElement.text
someDOMElement.textContent
someDOMElement.innerText
someDOMElement.outerText
someDOMElement.value
someDOMElement.name
someDOMElement.target
someDOMElement.method
someDOMElement.type
someDOMElement.backgroundImage
someDOMElement.cssText
someDOMElement.codebase
document.title
document.implementation.createHTMLDocument()
history.pushState()
history.replaceState()
```
### Denial of Service

Von: [https://portswigger.net/web-security/dom-based/denial-of-service](https://portswigger.net/web-security/dom-based/denial-of-service)

**DOM-basierte Denial-of-Service-Schwachstellen** treten auf, wenn ein Skript **angreifersteuerbare Daten unsicher an eine problematische Plattform-API** √ºbergibt. Dies umfasst APIs, die, wenn sie aufgerufen werden, dazu f√ºhren k√∂nnen, dass der Computer des Benutzers **√ºberm√§√üig viel CPU- oder Festplattenspeicher** verbraucht. Solche Schwachstellen k√∂nnen erhebliche Nebenwirkungen haben, wie z.B. dass der Browser die Funktionalit√§t der Website einschr√§nkt, indem er Versuche, Daten im `localStorage` zu speichern, ablehnt oder besch√§ftigte Skripte beendet.

Sinks:
```javascript
requestFileSystem()
RegExp()
```
## Dom Clobbering

{% content-ref url="dom-clobbering.md" %}
[dom-clobbering.md](dom-clobbering.md)
{% endcontent-ref %}

<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Arbeiten Sie in einem **Cybersicherheitsunternehmen**? M√∂chten Sie Ihr **Unternehmen in HackTricks bewerben**? Oder m√∂chten Sie Zugriff auf die **neueste Version des PEASS oder HackTricks als PDF herunterladen**? √úberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* **Treten Sie der** [**üí¨**](https://emojipedia.org/speech-balloon/) [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie mir auf **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an das** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **und das** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **senden**.

</details>
