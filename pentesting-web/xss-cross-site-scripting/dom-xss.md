# DOM XSS

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za sajber bezbednost**? Želite li da vidite svoju **kompaniju reklamiranu na HackTricks**? ili želite pristup **najnovijoj verziji PEASS ili preuzimanje HackTricks u PDF formatu**? Proverite [**PLANOVE ZA PRIJAVU**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridružite se** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitteru** 🐦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**hacktricks repozitorijum**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repozitorijum**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## DOM Vulnerabilities

DOM ranjivosti se javljaju kada podaci iz izvora pod kontrolom napadača (kao što su `location.search`, `document.referrer`, ili `document.cookie`) nesigurno dospevaju do **sinks**. Sinks su funkcije ili objekti (npr. `eval()`, `document.body.innerHTML`) koji mogu izvršiti ili prikazati štetan sadržaj ako im se dostave zlonamerni podaci.

* **Izvori** su ulazi koji mogu biti manipulisani od strane napadača, uključujući URL-ove, kolačiće i web poruke.
* **Sinks** su potencijalno opasne tačke gde zlonamerni podaci mogu dovesti do štetnih efekata, kao što je izvršavanje skripti.

Rizik se javlja kada podaci teku od izvora do sinka bez odgovarajuće validacije ili sanitizacije, omogućavajući napade poput XSS.

{% hint style="info" %}
**Možete pronaći ažuriranu listu izvora i sinkova na** [**https://github.com/wisec/domxsswiki/wiki**](https://github.com/wisec/domxsswiki/wiki)
{% endhint %}

**Uobičajeni izvori:**
```javascript
document.URL
document.documentURI
document.URLUnencoded
document.baseURI
location
document.cookie
document.referrer
window.name
history.pushState
history.replaceState
localStorage
sessionStorage
IndexedDB (mozIndexedDB, webkitIndexedDB, msIndexedDB)
Database
```
**Uobičajeni Sifovi:**

| [**Otvoreno Preusmeravanje**](dom-xss.md#open-redirect)                                    | [**Umetanje JavaScript-a**](dom-xss.md#javascript-injection)                         | [**Manipulacija DOM-podacima**](dom-xss.md#dom-data-manipulation) | **jQuery**                                                             |
| -------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------- | ------------------------------------------------------------- | ---------------------------------------------------------------------- |
| `location`                                                                       | `eval()`                                                                            | `scriptElement.src`                                           | `add()`                                                                |
| `location.host`                                                                  | `Function() constructor`                                                            | `scriptElement.text`                                          | `after()`                                                              |
| `location.hostname`                                                              | `setTimeout()`                                                                      | `scriptElement.textContent`                                   | `append()`                                                             |
| `location.href`                                                                  | `setInterval()`                                                                     | `scriptElement.innerText`                                     | `animate()`                                                            |
| `location.pathname`                                                              | `setImmediate()`                                                                    | `someDOMElement.setAttribute()`                               | `insertAfter()`                                                        |
| `location.search`                                                                | `execCommand()`                                                                     | `someDOMElement.search`                                       | `insertBefore()`                                                       |
| `location.protocol`                                                              | `execScript()`                                                                      | `someDOMElement.text`                                         | `before()`                                                             |
| `location.assign()`                                                              | `msSetImmediate()`                                                                  | `someDOMElement.textContent`                                  | `html()`                                                               |
| `location.replace()`                                                             | `range.createContextualFragment()`                                                  | `someDOMElement.innerText`                                    | `prepend()`                                                            |
| `open()`                                                                         | `crypto.generateCRMFRequest()`                                                      | `someDOMElement.outerText`                                    | `replaceAll()`                                                         |
| `domElem.srcdoc`                                                                 | **\`\`**[**Manipulacija Lokalnim Putanjama Datoteka**](dom-xss.md#local-file-path-manipulation) | `someDOMElement.value`                                        | `replaceWith()`                                                        |
| `XMLHttpRequest.open()`                                                          | `FileReader.readAsArrayBuffer()`                                                    | `someDOMElement.name`                                         | `wrap()`                                                               |
| `XMLHttpRequest.send()`                                                          | `FileReader.readAsBinaryString()`                                                   | `someDOMElement.target`                                       | `wrapInner()`                                                          |
| `jQuery.ajax()`                                                                  | `FileReader.readAsDataURL()`                                                        | `someDOMElement.method`                                       | `wrapAll()`                                                            |
| `$.ajax()`                                                                       | `FileReader.readAsText()`                                                           | `someDOMElement.type`                                         | `has()`                                                                |
| **\`\`**[**Manipulacija Ajax zahtevima**](dom-xss.md#ajax-request-manipulation)    | `FileReader.readAsFile()`                                                           | `someDOMElement.backgroundImage`                              | `constructor()`                                                        |
| `XMLHttpRequest.setRequestHeader()`                                              | `FileReader.root.getFile()`                                                         | `someDOMElement.cssText`                                      | `init()`                                                               |
| `XMLHttpRequest.open()`                                                          | `FileReader.root.getFile()`                                                         | `someDOMElement.codebase`                                     | `index()`                                                              |
| `XMLHttpRequest.send()`                                                          | [**Manipulacija Linkova**](dom-xss.md#link-manipulation)                               | `someDOMElement.innerHTML`                                    | `jQuery.parseHTML()`                                                   |
| `jQuery.globalEval()`                                                            | `someDOMElement.href`                                                               | `someDOMElement.outerHTML`                                    | `$.parseHTML()`                                                        |
| `$.globalEval()`                                                                 | `someDOMElement.src`                                                                | `someDOMElement.insertAdjacentHTML`                           | [**Umetanje JSON-a na Klijentskoj Strani**](dom-xss.md#client-side-sql-injection) |
| **\`\`**[**Manipulacija HTML5-skladištem**](dom-xss.md#html-5-storage-manipulation) | `someDOMElement.action`                                                             | `someDOMElement.onevent`                                      | `JSON.parse()`                                                         |
| `sessionStorage.setItem()`                                                       | [**XPath ubacivanje**](dom-xss.md#xpath-injection)                                   | `document.write()`                                            | `jQuery.parseJSON()`                                                   |
| `localStorage.setItem()`                                                         | `document.evaluate()`                                                               | `document.writeln()`                                          | `$.parseJSON()`                                                        |
| **``**[**`Odbijanje usluge`**](dom-xss.md#denial-of-service)**``**              | `someDOMElement.evaluate()`                                                         | `document.title`                                              | **\`\`**[**Manipulacija Kolačićima**](dom-xss.md#cookie-manipulation)      |
| `requestFileSystem()`                                                            | **\`\`**[**Manipulacija Dokument-Domenom**](dom-xss.md#document-domain-manipulation) | `document.implementation.createHTMLDocument()`                | `document.cookie`                                                      |
| `RegExp()`                                                                       | `document.domain`                                                                   | `history.pushState()`                                         | [**WebSocket-URL trovanje**](dom-xss.md#websocket-url-poisoning)      |
| [**Umetanje SQL-a na Klijentskoj Strani**](dom-xss.md#client-side-sql-injection)            | [**Manipulacija Web-porukama**](dom-xss.md#web-message-manipulation)                 | `history.replaceState()`                                      | `WebSocket`                                                            |
| `executeSql()`                                                                   | `postMessage()`                                                                     | \`\`                                                          | \`\`                                                                   |

**`innerHTML`** sif ne prihvata `script` elemente na bilo kom modernom pregledaču, niti će se događaji `svg onload` pokrenuti. To znači da ćete morati koristiti alternativne elemente poput `img` ili `iframe`.

Ovaj tip XSS-a je verovatno **najteži za pronaći**, jer morate pogledati unutar JS koda, videti da li **koristi** bilo koji objekat čiju **vrednost kontrolišete**, i u tom slučaju videti da li postoji **način da se zloupotrebi** kako bi se izvršio proizvoljni JS.

## Alati za pronalaženje

* [https://github.com/mozilla/eslint-plugin-no-unsanitized](https://github.com/mozilla/eslint-plugin-no-unsanitized)
* Proširenje pregledača za proveru svih podataka koji stižu do potencijalnog sifa: [https://github.com/kevin-mizu/domloggerpp](https://github.com/kevin-mizu/domloggerpp)

## Primeri

### Otvoreno Preusmeravanje

Sa: [https://portswigger.net/web-security/dom-based/open-redirection](https://portswigger.net/web-security/dom-based/open-redirection)

**Ranjivosti otvorenog preusmeravanja u DOM-u** se javljaju kada skripta upisuje podatke, koje napadač može kontrolisati, u sif sposoban za pokretanje navigacije preko domena.

Važno je razumeti da je izvršavanje proizvoljnog koda, poput **`javascript:alert(1)`**, moguće ako imate kontrolu nad početkom URL-a gde se preusmerenje dešava.

Sifovi:
```javascript
location
location.host
location.hostname
location.href
location.pathname
location.search
location.protocol
location.assign()
location.replace()
open()
domElem.srcdoc
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.ajax()
$.ajax()
```
### Manipulacija kolačića

Od: [https://portswigger.net/web-security/dom-based/cookie-manipulation](https://portswigger.net/web-security/dom-based/cookie-manipulation)

Ranjivosti manipulacije kolačićima zasnovane na DOM-u javljaju se kada skripta uključuje podatke, koje napadač može kontrolisati, u vrednost kolačića. Ova ranjivost može dovesti do neočekivanog ponašanja veb stranice ako se kolačić koristi unutar sajta. Dodatno, može se iskoristiti za sprovođenje napada fiksacije sesije ako je kolačić uključen u praćenje korisničkih sesija. Primarni izvor povezan sa ovom ranjivošću je:

Izvori:
```javascript
document.cookie
```
### JavaScript Injekcija

Od: [https://portswigger.net/web-security/dom-based/javascript-injection](https://portswigger.net/web-security/dom-based/javascript-injection)

DOM-bazne ranjivosti JavaScript injekcije se stvaraju kada skripta pokreće podatke, koje može kontrolisati napadač, kao JavaScript kod.

Sinks:
```javascript
eval()
Function() constructor
setTimeout()
setInterval()
setImmediate()
execCommand()
execScript()
msSetImmediate()
range.createContextualFragment()
crypto.generateCRMFRequest()
```
### Manipulacija dokument-domena

Sa: [https://portswigger.net/web-security/dom-based/document-domain-manipulation](https://portswigger.net/web-security/dom-based/document-domain-manipulation)

**Ranjivosti manipulacije dokument-domenom** se javljaju kada skripta postavlja svojstvo `document.domain` koristeći podatke koje napadač može kontrolisati.

Svojstvo `document.domain` igra **ključnu ulogu** u **sprovođenju** **politike istog porekla** od strane pregledača. Kada se dve stranice sa različitih porekla postave svoj `document.domain` na **istu vrednost**, mogu međusobno da interaguju bez ograničenja. Iako pregledači nameću određena **ograničenja** na vrednosti koje se mogu dodeliti `document.domain`, sprečavajući dodelu potpuno nepovezanih vrednosti stvarnom poreklu stranice, postoje izuzeci. Obično, pregledači dozvoljavaju korišćenje **poddomena** ili **roditeljskih domena**.

Sinks:
```javascript
document.domain
```
### Trovanje WebSocket-URL-a

Od: [https://portswigger.net/web-security/dom-based/websocket-url-poisoning](https://portswigger.net/web-security/dom-based/websocket-url-poisoning)

**Trovanje WebSocket-URL-a** nastaje kada skripta koristi **kontrolisane podatke kao ciljni URL** za WebSocket konekciju.

Sinks:

Konstruktor `WebSocket` može dovesti do ranjivosti trovanja WebSocket-URL-a.

### Manipulacija linkova

Od: [https://portswigger.net/web-security/dom-based/link-manipulation](https://portswigger.net/web-security/dom-based/link-manipulation)

**Ranjivosti manipulacije linkova zasnovane na DOM-u** nastaju kada skripta upisuje **podatke pod kontrolom napadača ka navigacionom cilju** unutar trenutne stranice, kao što je klikabilni link ili URL za podnošenje forme.
```javascript
someDOMElement.href
someDOMElement.src
someDOMElement.action
```
### Manipulacija Ajax zahtevima

Od: [https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation](https://portswigger.net/web-security/dom-based/ajax-request-header-manipulation)

**Ranjivosti manipulacije Ajax zahtevima** nastaju kada skripta upisuje **podatke koje kontrolira napadač u Ajax zahtev** koji se izdaje koristeći objekat `XmlHttpRequest`.

Sinks:
```javascript
XMLHttpRequest.setRequestHeader()
XMLHttpRequest.open()
XMLHttpRequest.send()
jQuery.globalEval()
$.globalEval()
```
### Manipulacija lokalnih putanja datoteka

Sa: [https://portswigger.net/web-security/dom-based/local-file-path-manipulation](https://portswigger.net/web-security/dom-based/local-file-path-manipulation)

**Ranjivosti manipulacije lokalnih putanja datoteka** nastaju kada skripta prosleđuje **podatke koje kontrolira napadač API-ju za rukovanje datotekama** kao parametar `filename`. Ova ranjivost može biti iskorišćena od strane napadača da konstruiše URL koji, ako ga poseti drugi korisnik, može dovesti do toga da **korisnikov pretraživač otvori ili upiše proizvoljnu lokalnu datoteku**.

Sinks:
```javascript
FileReader.readAsArrayBuffer()
FileReader.readAsBinaryString()
FileReader.readAsDataURL()
FileReader.readAsText()
FileReader.readAsFile()
FileReader.root.getFile()
FileReader.root.getFile()
```
### Klijentska SQL injekcija

Od: [https://portswigger.net/web-security/dom-based/client-side-sql-injection](https://portswigger.net/web-security/dom-based/client-side-sql-injection)

**Klijentske SQL injekcione ranjivosti** se javljaju kada skripta uključuje **podatke koje kontrolira napadač u klijentski SQL upit na nesiguran način**.

Sinks:
```javascript
executeSql()
```
### Manipulacija HTML5 skladištem

Od: [https://portswigger.net/web-security/dom-based/html5-storage-manipulation](https://portswigger.net/web-security/dom-based/html5-storage-manipulation)

**Ranjivosti manipulacije HTML5 skladištem** nastaju kada skripta **smešta podatke koje napadač može kontrolisati u HTML5 skladište veb pregledača** (`localStorage` ili `sessionStorage`). Iako ova radnja po sebi nije bezbednosna ranjivost, postaje problematična ako aplikacija zatim **čita smeštene podatke i obrađuje ih na nesiguran način**. To bi omogućilo napadaču da iskoristi mehanizam skladištenja za sprovođenje drugih napada zasnovanih na DOM-u, poput skriptovanja preko skripte i ubacivanja JavaScript-a.

Sinks:
```javascript
sessionStorage.setItem()
localStorage.setItem()
```
### XPath ubrizgavanje

Od: [https://portswigger.net/web-security/dom-based/client-side-xpath-injection](https://portswigger.net/web-security/dom-based/client-side-xpath-injection)

**Vulnerabilnosti DOM bazirane na XPath ubrizgavanju** se javljaju kada skripta uključuje **podatke koje napadač može kontrolisati u XPath upitu**.

Sinks:
```javascript
document.evaluate()
someDOMElement.evaluate()
```
### Klijentska JSON ubrizgavanje

Od: [https://portswigger.net/web-security/dom-based/client-side-json-injection](https://portswigger.net/web-security/dom-based/client-side-json-injection)

**DOM bazirane JSON-ubrizgavanje ranjivosti** se javljaju kada skripta uključuje **podatke koje kontrolira napadač u string koji se parsira kao JSON podatkovna struktura, a zatim obrađuje od strane aplikacije**.

Sinks:
```javascript
JSON.parse()
jQuery.parseJSON()
$.parseJSON()
```
### Manipulacija web-porukama

Od: [https://portswigger.net/web-security/dom-based/web-message-manipulation](https://portswigger.net/web-security/dom-based/web-message-manipulation)

**Ranjivosti web-poruka** nastaju kada skripta šalje **podatke koje kontrolira napadač kao web-poruku drugom dokumentu** unutar pregledača. **Primer** ranjive manipulacije web-porukama može se pronaći na [PortSwigger-ovoj Akademiji za bezbednost veb-a](https://portswigger.net/web-security/dom-based/controlling-the-web-message-source).

Sinks:

Metoda `postMessage()` za slanje web-poruka može dovesti do ranjivosti ako slušalac događaja za primanje poruka obrađuje dolazne podatke na nesiguran način.

### Manipulacija DOM-podacima

Od: [https://portswigger.net/web-security/dom-based/dom-data-manipulation](https://portswigger.net/web-security/dom-based/dom-data-manipulation)

**Ranjivosti manipulacije DOM-podacima** nastaju kada skripta upisuje **podatke koje kontrolira napadač u polje unutar DOM-a** koje se koristi u vidljivom korisničkom interfejsu ili logici na strani klijenta. Ova ranjivost može biti iskorišćena od strane napadača da konstruiše URL koji, ako ga poseti drugi korisnik, može promeniti izgled ili ponašanje korisničkog interfejsa na strani klijenta.

Sinks:
```javascript
scriptElement.src
scriptElement.text
scriptElement.textContent
scriptElement.innerText
someDOMElement.setAttribute()
someDOMElement.search
someDOMElement.text
someDOMElement.textContent
someDOMElement.innerText
someDOMElement.outerText
someDOMElement.value
someDOMElement.name
someDOMElement.target
someDOMElement.method
someDOMElement.type
someDOMElement.backgroundImage
someDOMElement.cssText
someDOMElement.codebase
document.title
document.implementation.createHTMLDocument()
history.pushState()
history.replaceState()
```
### Odbijanje usluge

Sa: [https://portswigger.net/web-security/dom-based/denial-of-service](https://portswigger.net/web-security/dom-based/denial-of-service)

**DOM bazirane ranjivosti odbijanja usluge** se javljaju kada skripta nebezbedno prosleđuje **podatke koje napadač može kontrolisati ka problematičnoj platformi API-ja**. To uključuje API-je koji, kada se pozovu, mogu dovesti do toga da računar korisnika troši **prekomerne količine CPU-a ili prostora na disku**. Takve ranjivosti mogu imati značajne sporedne efekte, poput pregledača koji ograničava funkcionalnost veb sajta odbijanjem pokušaja čuvanja podataka u `localStorage` ili prekidanja zauzetih skripti.

Sinks:
```javascript
requestFileSystem()
RegExp()
```
## Dom Clobbering

{% content-ref url="dom-clobbering.md" %}
[dom-clobbering.md](dom-clobbering.md)
{% endcontent-ref %}

<details>

<summary><strong>Naučite hakovanje AWS-a od nule do heroja sa</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* Da li radite u **kompaniji za sajber bezbednost**? Želite li da vidite svoju **kompaniju reklamiranu na HackTricks**? ili želite pristup **najnovijoj verziji PEASS ili preuzimanje HackTricks u PDF formatu**? Proverite [**PLANOVE ZA PRETPLATU**](https://github.com/sponsors/carlospolop)!
* Otkrijte [**Porodicu PEASS**](https://opensea.io/collection/the-peass-family), našu kolekciju ekskluzivnih [**NFT-ova**](https://opensea.io/collection/the-peass-family)
* Nabavite [**zvanični PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **Pridružite se** [**💬**](https://emojipedia.org/speech-balloon/) [**Discord grupi**](https://discord.gg/hRep4RUj7f) ili [**telegram grupi**](https://t.me/peass) ili me **pratite** na **Twitteru** 🐦[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Podelite svoje hakovanje trikove slanjem PR-ova na** [**hacktricks repozitorijum**](https://github.com/carlospolop/hacktricks) **i** [**hacktricks-cloud repozitorijum**](https://github.com/carlospolop/hacktricks-cloud).

</details>
