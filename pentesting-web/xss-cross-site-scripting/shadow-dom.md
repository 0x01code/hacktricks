# Shadow DOM

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

Shadow DOM [Web Components](https://developer.mozilla.org/en-US/docs/Web/Web\_Components) рд╕реБрд╡рд┐рдзрд╛ рд╕реВрдЯ рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ, рдЬрд┐рд╕рдХрд╛ рдЙрджреНрджреЗрд╢реНрдп JS рдбреЗрд╡рд▓рдкрд░реНрд╕ рдХреЛ рдкреБрди: рдкреНрд░рдпреЛрдЬреНрдп рдХрд╕реНрдЯрдо рдПрд▓рд┐рдореЗрдВрдЯреНрд╕ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рд╣реИ рдЬрд┐рдирдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреЛрдб рдХреЗ рдмрд╛рдХреА рд╣рд┐рд╕реНрд╕реЛрдВ рд╕реЗ рдЕрд▓рдЧ рдХреА рдЧрдИ рд╣реИред

рдореВрд▓ рд░реВрдк рд╕реЗ, рдЖрдк Shadow DOM рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЕрдкрдиреЗ рдХреМрдореНрдкреЛрдиреЕрдиреНрдЯ рдХреЗ HTML рдФрд░ CSS рдХреЛ рд╡реЗрдмрдкреЗрдЬ рдХреЗ рдмрд╛рдХреА рд╣рд┐рд╕реНрд╕реЛрдВ рд╕реЗ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдЖрдк рдПрдХ shadow DOM рдореЗрдВ рдПрд▓рд┐рдореЗрдВрдЯ IDs рдмрдирд╛рддреЗ рд╣реИрдВ, рддреЛ рд╡реЗ **рдорд╛рддрд╛-рдкрд┐рддрд╛ DOM рдореЗрдВ рдПрд▓рд┐рдореЗрдВрдЯ IDs рдХреЗ рд╕рд╛рде рд╕рдВрдШрд░реНрд╖ рдирд╣реАрдВ рдХрд░реЗрдВрдЧреЗ**ред рдЖрдкрдХреЗ рджреНрд╡рд╛рд░рд╛ shadow DOM рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдХрд┐рд╕реА рднреА CSS рд╕реЗрд▓реЗрдХреНрдЯрд░реНрд╕ рдХреЗрд╡рд▓ shadow DOM рдХреЗ рднреАрддрд░ рд▓рд╛рдЧреВ рд╣реЛрдВрдЧреЗ рдФрд░ рдорд╛рддрд╛-рдкрд┐рддрд╛ DOM рдкрд░ рдирд╣реАрдВ, рдФрд░ рдорд╛рддрд╛-рдкрд┐рддрд╛ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП рдХрд┐рд╕реА рднреА рд╕реЗрд▓реЗрдХреНрдЯрд░реНрд╕ shadow DOM рдХреЗ рднреАрддрд░ рдирд╣реАрдВ рдЬрд╛рдПрдВрдЧреЗред
```js
// creating a shadow DOM
let $element = document.createElement("div");
$shadowDomRef = $element.attachShadow({ mode: "open" }); // open or closed
```
рдЖрдорддреМрд░ рдкрд░, рдЬрдм рдЖрдк рдПрдХ **"рдЦреБрд▓рд╛" рд╢реИрдбреЛ DOM рдХрд┐рд╕реА рддрддреНрд╡ рд╕реЗ рдЬреЛрдбрд╝рддреЗ рд╣реИрдВ**, рдЖрдк **`$element.shadowRoot`** рдХреЗ рд╕рд╛рде рд╢реИрдбреЛ DOM рдХрд╛ рд╕рдВрджрд░реНрдн рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдЧрд░ рд╢реИрдбреЛ DOM **"рдмрдВрдж"** рдореЛрдб рдХреЗ рддрд╣рдд рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЖрдк рдЗрд╕ рддрд░рд╣ рд╕реЗ рдЗрд╕рдХрд╛ рд╕рдВрджрд░реНрдн **рдкреНрд░рд╛рдкреНрдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ**ред рдореИрдВрдиреЗ рдЬрд┐рддрдирд╛ рднреА рдбреЗрд╡рд▓рдкрд░ рджрд╕реНрддрд╛рд╡реЗрдЬ рдкрдврд╝рд╛ рд╣реИ, рдЙрд╕рдХреЗ рдмрд╛рдж рднреА рдореБрдЭреЗ рдмрдВрдж рдореЛрдб рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдереЛрдбрд╝реА рдЕрд╕реНрдкрд╖реНрдЯрддрд╛ рд╣реИред [Google рдХреЗ рдЕрдиреБрд╕рд╛рд░](https://developers.google.com/web/fundamentals/web-components/shadowdom):

> рд╢реИрдбреЛ DOM рдХрд╛ рдПрдХ рдЕрдиреНрдп рдкреНрд░рдХрд╛рд░ "рдмрдВрдж" рдореЛрдб рднреА рд╣реЛрддрд╛ рд╣реИред рдЬрдм рдЖрдк рдПрдХ **рдмрдВрдж** рд╢реИрдбреЛ рдЯреНрд░реА рдмрдирд╛рддреЗ рд╣реИрдВ, **рдмрд╛рд╣рд░реА JavaScript рдЖрдкрдХреЗ рдХреЙрдореНрдкреЛрдиреЗрдВрдЯ рдХреЗ рдЖрдВрддрд░рд┐рдХ DOM рддрдХ рдкрд╣реБрдБрдЪ рдирд╣реАрдВ рдкрд╛рдПрдЧреА**ред рдпрд╣ `<video>` рдЬреИрд╕реЗ рдиреЗрдЯрд┐рд╡ рддрддреНрд╡реЛрдВ рдХреЗ рдХрд╛рдо рдХрд░рдиреЗ рдХреЗ рд╕рдорд╛рди рд╣реИред JavaScript `<video>` рдХреЗ рд╢реИрдбреЛ DOM рддрдХ рдкрд╣реБрдБрдЪ рдирд╣реАрдВ рдкрд╛ рд╕рдХрддреА рдХреНрдпреЛрдВрдХрд┐ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЗрд╕реЗ рдмрдВрдж-рдореЛрдб рд╢реИрдбреЛ рд░реВрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╡реЗ рдпрд╣ рднреА рдХрд╣рддреЗ рд╣реИрдВ:

> рдмрдВрдж рд╢реИрдбреЛ рд░реВрдЯреНрд╕ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╣реЛрддреЗ рд╣реИрдВред рдХреБрдЫ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдмрдВрдж рдореЛрдб рдХреЛ рдПрдХ **рдХреГрддреНрд░рд┐рдо рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛** рдХреЗ рд░реВрдк рдореЗрдВ рджреЗрдЦреЗрдВрдЧреЗред рд▓реЗрдХрд┐рди рд╕реНрдкрд╖реНрдЯ рд░рд╣реЗрдВ, рдпрд╣ рдПрдХ рд╕реБрд░рдХреНрд╖рд╛ рд╕реБрд╡рд┐рдзрд╛ **рдирд╣реАрдВ** рд╣реИред

## рд╢реИрдбреЛ DOM рддрдХ рдкрд╣реБрдБрдЪрдирд╛

### window.find() рдФрд░ рдкрд╛рда рдЪрдпрди <a href="#introducing-windowfind-and-text-selections" id="introducing-windowfind-and-text-selections"></a>

**`window.find("search_text")` рдлрд╝рдВрдХреНрд╢рди рд╢реИрдбреЛ DOM рдХреЗ рднреАрддрд░ рдШреБрд╕рддрд╛ рд╣реИ**ред рдЗрд╕ рдлрд╝рдВрдХреНрд╢рди рдХреА рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╡реЗрдмрдкреЗрдЬ рдкрд░ ctrl-F рдХреЗ рд╕рдорд╛рди рд╣реИред

**`document.execCommand("SelectAll")`** рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рдЪрдпрди рдХреЛ **рдЬрд┐рддрдирд╛ рд╕рдВрднрд╡ рд╣реЛ рдЙрддрдирд╛ рд╡рд┐рд╕реНрддрд╛рд░рд┐рдд** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ **`window.getSelection()`** рдХреЛ рдХреЙрд▓ рдХрд░рдХреЗ рд╢реИрдбреЛ DOM рдХреЗ рдЕрдВрджрд░ рдЪрдпрдирд┐рдд рдкрд╛рда рдХреА **рд╕рд╛рдордЧреНрд░реА рд╡рд╛рдкрд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред

**firefox** рдореЗрдВ рдЖрдк `getSelection()` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ [Selection](https://developer.mozilla.org/en-US/docs/Web/API/Selection) рдСрдмреНрдЬреЗрдХреНрдЯ рд▓реМрдЯрд╛рддрд╛ рд╣реИ, рдЬрд╣рд╛рдБ `anchorElement` рд╢реИрдбреЛ DOM рдореЗрдВ рдПрдХ рддрддреНрд╡ рдХрд╛ **рд╕рдВрджрд░реНрдн рд╣реЛрддрд╛ рд╣реИ**ред рдЗрд╕ рдкреНрд░рдХрд╛рд░, рд╣рдо рд╢реИрдбреЛ DOM рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░реАрдХреЗ рд╕реЗ рдмрд╛рд╣рд░ рдирд┐рдХрд╛рд▓ рд╕рдХрддреЗ рд╣реИрдВ:
```js
getSelection().anchorNode.parentNode.parentNode.parentNode.innerHTML
```
рд▓реЗрдХрд┐рди рдпрд╣ Chromium рдореЗрдВ рдХрд╛рдо рдирд╣реАрдВ рдХрд░рддрд╛ред

### contenteditable рдпрд╛ CSS рдЗрдВрдЬреЗрдХреНрд╢рди <a href="#contenteditable-or-css-injection" id="contenteditable-or-css-injection"></a>

рдПрдХ рддрд░реАрдХрд╛ рдЬрд┐рд╕рд╕реЗ рд╣рдо shadow DOM рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЕрдЧрд░ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ **HTML рдпрд╛ JS рдЗрдВрдЬреЗрдХреНрд╢рди рдЙрд╕рдХреЗ рдЕрдВрджрд░ рд╣реЛ**ред рдХреБрдЫ рджрд┐рд▓рдЪрд╕реНрдк рд╕реНрдерд┐рддрд┐рдпрд╛рдБ рд╣реИрдВ рдЬрд╣рд╛рдБ рдЖрдк shadow DOM рдХреЗ рдЕрдВрджрд░ рдЗрдВрдЬреЗрдХреНрд╢рди рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдЖрдк рдПрдХ рд╕рд╛рдорд╛рдиреНрдп crossorigin рдкреЗрдЬ рдкрд░ рдирд╣реАрдВ рдХрд░ рдкрд╛рдПрдВрдЧреЗред

рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ, рдЕрдЧрд░ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХреЛрдИ рднреА **рдПрд▓рд┐рдореЗрдВрдЯреНрд╕ `contenteditable` рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рдХреЗ рд╕рд╛рде рд╣реЛ**ред рдпрд╣ рдПрдХ рдкреБрд░рд╛рдирд╛ рдФрд░ рдХрдо рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓рд╛ HTML рдПрдЯреНрд░рд┐рдмреНрдпреВрдЯ рд╣реИ рдЬреЛ рдШреЛрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ **рдЙрд╕ рдПрд▓рд┐рдореЗрдВрдЯ рдХреА рд╕рд╛рдордЧреНрд░реА рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рд╕рдВрдкрд╛рджрди рдпреЛрдЧреНрдп рд╣реИ**ред рд╣рдо **`document.execCommand`** API рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ contenteditable рдПрд▓рд┐рдореЗрдВрдЯ рдХреЗ рд╕рд╛рде рдЗрдВрдЯрд░реИрдХреНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ HTML рдЗрдВрдЬреЗрдХреНрд╢рди рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ!
```js
find('selection within contenteditable');

document.execCommand('insertHTML',false,'<svg/onload=console.log(this.parentElement.outerHTML)>')
```
рд╢рд╛рдпрдж рдФрд░ рднреА рджрд┐рд▓рдЪрд╕реНрдк рдмрд╛рдд рдпрд╣ рд╣реИ рдХрд┐ **`contenteditable`** рдХрд┐рд╕реА рднреА рддрддреНрд╡ рдкрд░ рдХреНрд░реЛрдорд┐рдпрдо рдореЗрдВ рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдПрдХ рдкреБрд░рд╛рдиреЗ **CSS рд╕рдВрдкрддреНрддрд┐ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рдХреЗ: `-webkit-user-modify:read-write`**

рдпрд╣ рд╣рдореЗрдВ **CSS/рд╕реНрдЯрд╛рдЗрд▓ рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЛ HTML рдЗрдВрдЬреЗрдХреНрд╢рди рдореЗрдВ рдмрджрд▓рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ**, рдПрдХ рддрддреНрд╡ рдкрд░ CSS рд╕рдВрдкрддреНрддрд┐ рдЬреЛрдбрд╝рдХрд░, рдФрд░ рдлрд┐рд░ `insertHTML` рдХрдорд╛рдВрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред

## CTF

рдЗрд╕ рд▓реЗрдЦ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдЬрд╣рд╛рдВ рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ CTF рдЪреБрдиреМрддреА рдХреЗ рд░реВрдк рдореЗрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛: [https://github.com/Super-Guesser/ctf/blob/master/2022/dicectf/shadow.md](https://github.com/Super-Guesser/ctf/blob/master/2022/dicectf/shadow.md)

## рд╕рдВрджрд░реНрдн

* [https://blog.ankursundara.com/shadow-dom/](https://blog.ankursundara.com/shadow-dom/)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╕рдВрдЧреНрд░рд╣ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family)
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
