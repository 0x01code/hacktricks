# DOM Invader

<details>

<summary><strong>ゼロからヒーローまでのAWSハッキングを学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE（HackTricks AWS Red Team Expert）</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法：

- **HackTricksで企業を宣伝**したい場合や**HackTricksをPDFでダウンロード**したい場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
- [**公式PEASS＆HackTricksスワッグ**](https://peass.creator-spring.com)を入手する
- [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションを見つける
- **💬 [Discordグループ](https://discord.gg/hRep4RUj7f)**に参加するか、[telegramグループ](https://t.me/peass)に参加するか、**Twitter**で**@carlospolopm**をフォローする🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
- **HackTricks**と**HackTricks Cloud**のgithubリポジトリにPRを提出して、あなたのハッキングテクニックを共有してください。

</details>

## DOM Invader

DOM Invaderは、Burpの組み込みブラウザにインストールされたブラウザツールです。さまざまなソースとシンク（Webメッセージやプロトタイプ汚染を含む）を使用して、**DOM XSS脆弱性を検出**するのに役立ちます。このツールは拡張機能として事前にインストールされています。

DOM Invaderは、ブラウザのDevToolsパネル内にタブを統合し、次の機能を提供します：

1. DOM XSSテスト用のウェブページ上の**制御可能なシンクの識別**、コンテキストおよびサニタイズの詳細を提供します。
2. `postMessage()`メソッドを介して送信された**ウェブメッセージのログ記録、編集、再送信**を行い、DOM XSSテストを行います。DOM Invaderは、特別に作成されたウェブメッセージを使用して脆弱性を自動的に検出することもできます。
3. **クライアントサイドのプロトタイプ汚染**ソースの検出およびリスクのあるシンクに送信される制御可能なガジェットのスキャンを行います。
4. **DOM clobbering脆弱性**の識別。

### 有効にする

Burpの組み込みブラウザで**Burp拡張機能**に移動して、それを有効にします：

<figure><img src="../../.gitbook/assets/image (4) (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

その後、ページを更新し、**Dev Tools**で**DOM Invaderタブ**が見つかります：

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### キャナリーを注入する

前の画像で**ランダムな文字グループ（キャナリー）**が表示されます。これを異なる部分（パラメータ、フォーム、URLなど）に**注入**し、毎回検索をクリックします。DOM Invaderは、悪用できる**興味深いシンクにキャナリーが到達したかどうか**をチェックします。

さらに、**URLパラメータを注入**および**フォームを注入**のオプションは、見つけた**すべてのURL**パラメータと**フォーム**に**キャナリー**を自動的に注入する**新しいタブ**を開きます。

### 空のキャナリーを注入する

シンクが潜在的にある場合でも、それが悪用できなくても、ページが持つ可能性のあるシンクを見つけたい場合は、**空のキャナリーを検索**できます。

### ポストメッセージ

DOM Invaderを使用して、Webメッセージを使用したDOM XSSのテストが可能です。以下の機能を備えたWebメッセージのテストが可能です：

1. `postMessage()`を介して送信された**ウェブメッセージのログ記録**。これは、Burp ProxyのHTTPリクエスト/レスポンス履歴ログと同様です。
2. 手動でDOM XSSをテストするためのWebメッセージの**修正**および**再発行**。これは、Burp Repeaterの機能と同様です。
3. DOM XSSを探るためのWebメッセージの**自動変更**および送信。

#### メッセージの詳細

各メッセージについての詳細情報を表示するには、それをクリックしてください。これには、クライアントサイドのJavaScriptがメッセージの`origin`、`data`、または`source`プロパティにアクセスするかどうかが含まれます。

- **`origin`**：メッセージの**オリジン情報がチェックされていない**場合、任意の外部ドメインからイベントハンドラに対してクロスオリジンメッセージを送信できる可能性があります。ただし、チェックされていない場合は安全ではありません。
- **`data`**：これはペイロードが送信される場所です。このデータが使用されていない場合、シンクは無意味です。
- **`source`**：通常、iframeを参照するsourceプロパティがオリジンの代わりに検証されているかどうかを評価します。これがチェックされていても、検証がバイパスされないことを保証するものではありません。

#### メッセージの返信

1. **メッセージ**ビューから、メッセージをクリックしてメッセージの詳細ダイアログを開きます。
2. 必要に応じて**データ**フィールドを編集します。
3. **送信**をクリックします。

### プロトタイプ汚染

DOM Invaderは**プロトタイプ汚染脆弱性**を検索することもできます。まず、それを有効にする必要があります：

<figure><img src="../../.gitbook/assets/image (5) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

その後、**`Object.prototype`**に任意のプロパティを追加できる**ソースを検索**します。

何か見つかった場合、**テスト**ボタンが表示され、**見つかったソースをテスト**することができます。それをクリックすると、新しいタブが表示され、コンソールでオブジェクトを作成し、`testproperty`が存在するかどうかを確認できます：
```javascript
let b = {}
b.testproperty
```
一度ソースを見つけたら、**ガジェットをスキャン**できます：

1. **DOM Invader** は、**DOM** ビュー内の特定のプロトタイプ汚染ソースの隣にある **Scan for gadgets** ボタンをクリックすると、新しいタブが開かれます。適切なガジェットをスキャンする作業が始まります。
2. 同時に、同じタブで **DOM Invader** タブが DevTools パネルで開かれるべきです。スキャンが完了すると、特定されたガジェットを介してアクセス可能なシンクが **DOM** ビューに表示されます。例えば、`innerHTML` シンクに渡される `html` というガジェットプロパティが以下の例に示されています。

## DOM clobbering

前の画像で、DOM clobbering スキャンをオンにできることがわかります。完了すると、**DOM Invader は DOM clobbering 脆弱性を検索し始めます**。

## 参考文献

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

<details>

<summary><strong>AWS ハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks をサポートする他の方法：

* **HackTricks で企業を宣伝したい**、または **HackTricks を PDF でダウンロードしたい** 場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) をチェックしてください！
* [**公式 PEASS & HackTricks スワッグ**](https://peass.creator-spring.com) を手に入れる
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) を発見し、独占的な [**NFTs**](https://opensea.io/collection/the-peass-family) のコレクションを見つける
* **💬 [Discord グループ](https://discord.gg/hRep4RUj7f)** に参加するか、[telegram グループ](https://t.me/peass) に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks\_live) をフォローする。
* **HackTricks** と **HackTricks Cloud** の github リポジトリに PR を提出して、あなたのハッキングテクニックを共有してください。

</details>
