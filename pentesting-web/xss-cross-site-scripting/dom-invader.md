# DOM Invader

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックする
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* **HackTricks**と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有する。

</details>

## DOM Invader

DOM InvaderはBurpの内蔵ブラウザにインストールされたブラウザツールです。様々なソースとシンクを使用して**DOM XSSの脆弱性を検出する**のに役立ちます。これには、webメッセージやプロトタイプ汚染が含まれます。このツールは拡張機能として事前にインストールされています。

DOM InvaderはブラウザのDevToolsパネル内にタブを統合し、以下を可能にします：

1. DOM XSSテストのためのウェブページ上の**制御可能なシンクの特定**、コンテキストとサニタイズの詳細を提供します。
2. DOM XSSテストのために`postMessage()`メソッドを介して送信される**webメッセージのログ、編集、および再送信**。DOM Invaderは特別に作成されたwebメッセージを使用して自動的に脆弱性を検出することもできます。
3. **クライアントサイドのプロトタイプ汚染**ソースの検出と、リスクの高いシンクに送信される制御可能なガジェットのスキャン。
4. **DOMクロッバリングの脆弱性**の特定。

### 有効にする

Burpの内蔵ブラウザで**Burp拡張機能**に移動し、有効にします：

<figure><img src="../../.gitbook/assets/image (4) (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

今、ページをリフレッシュし、**Dev Tools**で**DOM Invaderタブ**を見つけます：

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### カナリアを注入する

前の画像では、**ランダムな文字のグループ、それがカナリア**です。さまざまなウェブの部分（パラメータ、フォーム、URLなど）にそれを**注入し始め**、毎回検索をクリックします。DOM Invaderは、**カナリアが利用可能な興味深いシンクに終わったかどうか**をチェックします。

さらに、**Inject URL params**とInject formsのオプションは、見つかったすべての**URL**パラメータと**フォーム**に**カナリア**を**注入**する**新しいタブ**を自動的に開きます。

### 空のカナリアを注入する

ページに潜在的なシンクがあるかどうかを見つけたいだけの場合、たとえそれらが利用可能でなくても、**空のカナリアを検索する**ことができます。

### ポストメッセージ

DOM Invaderはwebメッセージを使用したDOM XSSのテストを可能にします。その機能には以下が含まれます：

1. `postMessage()`を介して送信される**webメッセージのログ**。これはBurp ProxyのHTTPリクエスト/レスポンス履歴のログと似ています。
2. DOM XSSを手動でテストするためのwebメッセージの**変更**と**再発行**。これはBurp Repeaterの機能に似ています。
3. DOM XSSを探るためのwebメッセージの**自動変更**と送信。

#### メッセージの詳細

各メッセージをクリックすると、クライアントサイドのJavaScriptによってメッセージの`origin`、`data`、または`source`プロパティがアクセスされているかどうかを含む、より詳細な情報を表示できます。

* **`origin`** : メッセージの**origin情報がチェックされていない場合**、任意の外部ドメインからイベントハンドラにクロスオリジンメッセージを送信できる可能性があります。しかし、チェックされていてもまだ安全でない可能性があります。
* **`data`**: ここにペイロードが送信されます。このデータが使用されていない場合、シンクは無意味です。
* **`source`**: 通常はiframeを参照するsourceプロパティがoriginの代わりに検証されているかどうかを評価します。これがチェックされていても、検証がバイパスされないとは限りません。

#### メッセージに返信する

1. **メッセージ**ビューから、任意のメッセージをクリックしてメッセージ詳細ダイアログを開きます。
2. 必要に応じて**Data**フィールドを編集します。
3. **Send**をクリックします。

### プロトタイプ汚染

DOM Invaderは**プロトタイプ汚染の脆弱性**も検索できます。まず、それを有効にする必要があります：

<figure><img src="../../.gitbook/assets/image (5) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

次に、**`Object.prototype`**に任意のプロパティを追加することを可能にする**ソースを検索**します。

何かが見つかった場合、**テスト**ボタンが表示され、**見つかったソースをテスト**します。それをクリックすると、新しいタブが表示されます。コンソールでオブジェクトを作成し、`testproperty`が存在するかどうかを確認します：
```javascript
let b = {}
b.testproperty
```
ソースを見つけたら、**ガジェットをスキャン**することができます：

1. **DOM**ビューから、DOM Invaderが見つけたプロトタイプ汚染ソースの隣にある**ガジェットをスキャン**ボタンをクリックします。DOM Invaderは新しいタブを開き、適切なガジェットのスキャンを開始します。
2. 同じタブで、DevToolsパネルの**DOM Invader**タブを開きます。スキャンが完了すると、**DOM**ビューには、DOM Invaderが特定したガジェットを介してアクセスできたシンクが表示されます。以下の例では、`html`と呼ばれるガジェットプロパティが`innerHTML`シンクに渡されました。

## DOMクロッバリング

前の画像では、DOMクロッバリングスキャンをオンにすることができます。行われると、**DOM InvaderはDOMクロッバリングの脆弱性を探し始めます**。

## 参考文献

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)でAWSハッキングをゼロからヒーローまで学ぶ</strong></summary>

HackTricksをサポートする他の方法：

* **HackTricksに広告を掲載したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手してください。
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクションをチェックしてください。
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加するか**、[**テレグラムグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)で**フォローしてください**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを共有してください。

</details>
