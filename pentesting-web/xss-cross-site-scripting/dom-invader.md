# Invasor del DOM

<details>

<summary><strong>Aprende a hackear AWS de cero a h√©roe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Experto en Equipos Rojos de AWS de HackTricks)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**La Familia PEASS**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repositorios de github.

</details>

## Invasor del DOM

DOM Invader es una herramienta del navegador instalada en el navegador integrado de Burp. Ayuda en **detectar vulnerabilidades de XSS en el DOM** utilizando diversas fuentes y sumideros, incluyendo mensajes web y contaminaci√≥n de prototipos. La herramienta est√° preinstalada como una extensi√≥n.

DOM Invader integra una pesta√±a dentro del panel de DevTools del navegador que permite lo siguiente:

1. **Identificaci√≥n de sumideros controlables** en una p√°gina web para pruebas de XSS en el DOM, proporcionando contexto y detalles de sanitizaci√≥n.
2. **Registro, edici√≥n y reenv√≠o de mensajes web** enviados a trav√©s del m√©todo `postMessage()` para pruebas de XSS en el DOM. DOM Invader tambi√©n puede detectar autom√°ticamente vulnerabilidades utilizando mensajes web especialmente dise√±ados.
3. Detecci√≥n de **fuentes de contaminaci√≥n de prototipos del lado del cliente** y escaneo de gadgets controlables enviados a sumideros riesgosos.
4. Identificaci√≥n de **vulnerabilidades de clobbering del DOM**.

### Habilitarlo

En el navegador integrado de Burp, ve a la **extensi√≥n de Burp** y habil√≠talo:

<figure><img src="../../.gitbook/assets/image (4) (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

Ahora actualiza la p√°gina y en las **Dev Tools** encontrar√°s la pesta√±a **DOM Invader:**

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Inyectar un Canario

En la imagen anterior puedes ver un **grupo aleatorio de caracteres, que es el Canario**. Ahora debes comenzar a **inyectarlo** en diferentes partes de la web (par√°metros, formularios, URL...) y cada vez hacer clic en buscar. DOM Invader verificar√° si el **canario termin√≥ en alg√∫n sumidero interesante** que podr√≠a ser explotado.

Adem√°s, las opciones **Inyectar par√°metros de URL** e Inyectar formularios abrir√°n autom√°ticamente una **nueva pesta√±a** **inyectando** el **canario** en cada **par√°metro de URL** y **formulario** que encuentre.

### Inyectar un Canario vac√≠o

Si solo deseas encontrar sumideros potenciales que la p√°gina pueda tener, incluso si no son explotables, puedes **buscar un canario vac√≠o**.

### Mensajes Post

DOM Invader permite probar XSS en el DOM utilizando mensajes web con funciones como:

1. **Registro de mensajes web** enviados a trav√©s de `postMessage()`, similar al registro de historial de solicitudes/respuestas HTTP de Burp Proxy.
2. **Modificaci√≥n** y **reenv√≠o** de mensajes web para probar manualmente XSS en el DOM, similar a la funci√≥n de Burp Repeater.
3. **Alteraci√≥n autom√°tica** y env√≠o de mensajes web para sondear XSS en el DOM.

#### Detalles del mensaje

Se puede ver informaci√≥n detallada sobre cada mensaje haciendo clic en √©l, lo que incluye si el JavaScript del lado del cliente accede a las propiedades `origin`, `data` o `source` del mensaje.

* **`origin`** : Si la **informaci√≥n de origen del mensaje no se verifica**, es posible enviar mensajes entre dominios al manejador de eventos **desde un dominio externo arbitrario**. Pero si se verifica, a√∫n podr√≠a ser inseguro.
* **`data`**: Aqu√≠ es donde se env√≠a la carga √∫til. Si estos datos no se utilizan, el sumidero es in√∫til.
* **`source`**: Eval√∫a si la propiedad de origen, que generalmente hace referencia a un iframe, est√° validada en lugar del origen. Incluso si esto se verifica, no asegura que la validaci√≥n no pueda ser eludida.

#### Responder a un mensaje

1. Desde la vista de **Mensajes**, haz clic en cualquier mensaje para abrir el cuadro de di√°logo de detalles del mensaje.
2. Edita el campo **Data** seg√∫n sea necesario.
3. Haz clic en **Enviar**.

### Contaminaci√≥n de Prototipos

DOM Invader tambi√©n puede buscar **vulnerabilidades de contaminaci√≥n de prototipos**. Primero, necesitas habilitarlo:

<figure><img src="../../.gitbook/assets/image (5) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

Luego, buscar√° **fuentes** que te permitan agregar propiedades arbitrarias al **`Object.prototype`**.

Si se encuentra algo, aparecer√° un bot√≥n de **Prueba** para **probar la fuente encontrada**. Haz clic en √©l, aparecer√° una nueva pesta√±a, crea un objeto en la consola y verifica si la `testproperty` existe:
```javascript
let b = {}
b.testproperty
```
Una vez que encuentres una fuente, puedes **escanear un gadget**:

1. DOM Invader abre una nueva pesta√±a cuando se hace clic en el bot√≥n **Escanear gadgets**, que se encuentra junto a cualquier fuente de contaminaci√≥n de prototipos identificada en la vista **DOM**. Luego comienza el escaneo en busca de gadgets adecuados.
2. Mientras tanto, en la misma pesta√±a, la pesta√±a **DOM Invader** debe abrirse en el panel DevTools. Despu√©s de que el escaneo se complete, cualquier sink accesible a trav√©s de los gadgets identificados se muestra en la vista **DOM**. Por ejemplo, se muestra en el ejemplo una propiedad de gadget llamada `html` que se pasa al sink `innerHTML`.

## DOM clobbering

En la imagen anterior es posible ver que se puede activar el escaneo de DOM clobbering. Una vez hecho, **DOM Invader comenzar√° a buscar vulnerabilidades de DOM clobbering**.

## Referencias

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si deseas ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** ¬°Consulta los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Obt√©n la [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **√önete al** üí¨ [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠gueme** en **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github.

</details>
