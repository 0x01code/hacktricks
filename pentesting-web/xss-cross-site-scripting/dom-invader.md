# DOM入侵者

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks云 ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 推特 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 YouTube 🎥</strong></a></summary>

* 你在一家**网络安全公司**工作吗？想要在HackTricks中看到你的**公司广告**吗？或者你想要获得**PEASS的最新版本或下载PDF格式的HackTricks**吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[**NFTs**](https://opensea.io/collection/the-peass-family)收藏品——[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获得[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或者**关注**我在**Twitter**上的[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享你的黑客技巧。**

</details>

## DOM入侵者

DOM入侵者是安装在Burp内置浏览器中的浏览器工具。它使用各种源和接收器（包括Web消息和原型污染）来帮助**检测DOM XSS漏洞**。该工具作为扩展预安装。

DOM入侵者在浏览器的DevTools面板中集成了一个选项卡，可以实现以下功能：

1. 识别网页上的**可控接收器**，用于DOM XSS测试，并提供上下文和清理详细信息。
2. 记录、编辑和重新发送通过`postMessage()`方法发送的Web消息，用于DOM XSS测试。DOM入侵者还可以使用特制的Web消息自动检测漏洞。
3. 检测**客户端原型污染**源，并扫描发送到风险接收器的可控小工具。
4. 识别**DOM覆盖漏洞**。

### 启用DOM入侵者

在Burp的内置浏览器中，转到**Burp扩展**并启用它：

<figure><img src="../../.gitbook/assets/image (4) (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

现在刷新页面，在**Dev Tools**中，您将找到**DOM入侵者选项卡**：

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### 注入一个Canary

在上一张图片中，您可以看到一个**随机字符组，即Canary**。现在，您应该开始在Web的不同部分（参数、表单、URL等）中**注入**它，并每次点击搜索。DOM入侵者将检查**Canary是否出现在任何有趣的接收器**中，这些接收器可能会被利用。

此外，选项**注入URL参数**和**注入表单**将自动打开一个**新标签页**，在每个**URL参数**和**表单**中**注入Canary**。

### 注入一个空的Canary

如果您只想找到页面可能具有的潜在接收器，即使它们不能被利用，您也可以**搜索一个空的Canary**。

### 发送消息

DOM入侵者允许使用Web消息进行DOM XSS测试，具有以下功能：

1. 记录通过`postMessage()`发送的Web消息，类似于Burp Proxy的HTTP请求/响应历史记录。
2. 修改和重新发送Web消息，以手动测试DOM XSS，类似于Burp Repeater的功能。
3. 自动修改和发送Web消息以探测DOM XSS。

#### 消息详情

您可以单击每条消息以查看更详细的信息，包括客户端JavaScript是否访问了消息的`origin`、`data`或`source`属性。

* **`origin`**：如果未检查消息的**来源信息**，您可能能够向事件处理程序**从任意外部域**发送跨域消息。但如果检查了它，仍然可能存在不安全性。
* **`data`**：这是负载发送的位置。如果未使用此数据，则接收器无用。
* **`source`**：评估源属性是否经过验证，通常引用一个iframe，而不是来源。即使进行了检查，也不能保证验证无法绕过。

#### 回复消息

1. 从**消息**视图中，单击任何消息以打开消息详细信息对话框。
2. 根据需要编辑**Data**字段。
3. 单击**发送**。

### 原型污染

DOM入侵者还可以搜索**原型污染漏洞**。首先，您需要启用它：

<figure><img src="../../.gitbook/assets/image (5) (1) (1).png" alt=""><figcaption></figcaption></figure>

然后，它将**搜索源**，使您能够向**`Object.prototype`**添加任意属性。

如果找到任何内容，将出现一个**测试**按钮，用于**测试找到的源**。单击它，将出现一个新的标签页，在控制台中创建一个对象，并检查`testproperty`是否存在：
```javascript
let b = {}
b.testproperty
```
一旦找到源代码，您可以**扫描小工具**：

1. 从**DOM**视图中，单击DOM Invader找到的任何原型污染源旁边的**扫描小工具**按钮。DOM Invader将打开一个新标签页并开始扫描适合的小工具。
2. 在同一个标签页中，在DevTools面板中打开**DOM Invader**选项卡。扫描完成后，**DOM**视图将显示DOM Invader通过识别的小工具能够访问的任何漏洞。在下面的示例中，一个名为`html`的小工具属性被传递给了`innerHTML`漏洞。

## DOM覆盖

在上面的图像中，可以看到可以打开DOM覆盖扫描。一旦完成，**DOM Invader将开始搜索DOM覆盖漏洞**。

## 参考资料

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>☁️ HackTricks Cloud ☁️</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>🐦 Twitter 🐦</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>🎙️ Twitch 🎙️</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>🎥 Youtube 🎥</strong></a></summary>

* 您在**网络安全公司**工作吗？您想在HackTricks中看到您的**公司广告**吗？或者您想获得最新版本的PEASS或下载PDF格式的HackTricks吗？请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 发现我们的独家[NFT收藏品](https://opensea.io/collection/the-peass-family)——[**The PEASS Family**](https://opensea.io/collection/the-peass-family)
* 获得[**官方PEASS和HackTricks周边产品**](https://peass.creator-spring.com)
* **加入**[**💬**](https://emojipedia.org/speech-balloon/) [**Discord群组**](https://discord.gg/hRep4RUj7f)或[**电报群组**](https://t.me/peass)，或在**Twitter**上**关注**我[**🐦**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**。**
* **通过向**[**hacktricks repo**](https://github.com/carlospolop/hacktricks) **和**[**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **提交PR来分享您的黑客技巧。**

</details>
