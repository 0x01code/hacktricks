# DOM Invader

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## DOM Invader

DOM Invader √© uma ferramenta de navegador instalada no navegador integrado do Burp. Auxilia na **detec√ß√£o de vulnerabilidades DOM XSS** usando v√°rias fontes e sumidouros, incluindo mensagens web e polui√ß√£o de prot√≥tipo. A ferramenta j√° vem pr√©-instalada como uma extens√£o.

DOM Invader integra uma aba dentro do painel DevTools do navegador, possibilitando o seguinte:

1. **Identifica√ß√£o de sumidouros control√°veis** em uma p√°gina web para testes de DOM XSS, fornecendo contexto e detalhes de sanitiza√ß√£o.
2. **Registro, edi√ß√£o e reenvio de mensagens web** enviadas pelo m√©todo `postMessage()` para testes de DOM XSS. DOM Invader tamb√©m pode detectar automaticamente vulnerabilidades usando mensagens web especialmente criadas.
3. Detec√ß√£o de fontes de **polui√ß√£o de prot√≥tipo do lado do cliente** e varredura de gadgets control√°veis enviados a sumidouros arriscados.
4. Identifica√ß√£o de **vulnerabilidades de DOM clobbering**.

### Ative-o

No navegador integrado do Burp, v√° at√© a **extens√£o Burp** e ative-a:

<figure><img src="../../.gitbook/assets/image (4) (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

Agora atualize a p√°gina e, no **Dev Tools**, voc√™ encontrar√° a **aba DOM Invader:**

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### Injete um Canary

Na imagem anterior, voc√™ pode ver um **grupo aleat√≥rio de caracteres, que √© o Canary**. Agora voc√™ deve come√ßar a **injet√°-lo** em diferentes partes da web (par√¢metros, formul√°rios, URL...) e cada vez clicar para pesquis√°-lo. DOM Invader verificar√° se o **canary terminou em algum sumidouro interessante** que poderia ser explorado.

Al√©m disso, as op√ß√µes **Inject URL params** e Inject forms abrir√£o automaticamente uma **nova aba** **injetando** o **canary** em cada **URL** param e **formul√°rio** encontrado.

### Injete um Canary vazio

Se voc√™ apenas quer encontrar potenciais sumidouros que a p√°gina possa ter, mesmo que n√£o sejam explor√°veis, voc√™ pode **procurar por um canary vazio**.

### Post Messages

DOM Invader permite testar para DOM XSS usando mensagens web com recursos como:

1. **Registro de mensagens web** enviadas via `postMessage()`, semelhante ao registro de hist√≥rico de solicita√ß√µes/respostas HTTP do Burp Proxy.
2. **Modifica√ß√£o** e **reemiss√£o** de mensagens web para testar manualmente o DOM XSS, similar √† fun√ß√£o do Burp Repeater.
3. **Altera√ß√£o autom√°tica** e envio de mensagens web para sondagem de DOM XSS.

#### Detalhes da mensagem

Voc√™ pode clicar em cada mensagem para ver mais informa√ß√µes detalhadas sobre ela, incluindo se as propriedades `origin`, `data` ou `source` da mensagem s√£o acessadas pelo JavaScript do lado do cliente.

* **`origin`** : Se a **informa√ß√£o de origem da mensagem n√£o for verificada**, voc√™ pode ser capaz de enviar mensagens de origem cruzada para o manipulador de eventos **de um dom√≠nio externo arbitr√°rio**. Mas se for verificado, ainda pode ser inseguro.
* **`data`**: Aqui √© onde o payload √© enviado. Se esses dados n√£o forem usados, o sumidouro √© in√∫til.
* **`source`**: Avalia se a propriedade source, geralmente referenciando um iframe, √© validada em vez da origem. Mesmo que isso seja verificado, n√£o garante que a valida√ß√£o n√£o possa ser contornada.

#### Responder a uma mensagem

1. Na visualiza√ß√£o **Messages**, clique em qualquer mensagem para abrir o di√°logo de detalhes da mensagem.
2. Edite o campo **Data** conforme necess√°rio.
3. Clique em **Send**.

### Polui√ß√£o de Prot√≥tipo

DOM Invader tamb√©m pode procurar por vulnerabilidades de **Polui√ß√£o de Prot√≥tipo**. Primeiro, voc√™ precisa ativ√°-lo:

<figure><img src="../../.gitbook/assets/image (5) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

Ent√£o, ele ir√° **procurar por fontes** que permitam adicionar propriedades arbitr√°rias ao **`Object.prototype`**.

Se algo for encontrado, um bot√£o **Test** aparecer√° para **testar a fonte encontrada**. Clique nele, uma nova aba aparecer√°, crie um objeto no console e verifique se a `testproperty` existe:
```javascript
let b = {}
b.testproperty
```
Uma vez que voc√™ encontrou uma fonte, voc√™ pode **procurar por um gadget**:

1. Na visualiza√ß√£o **DOM**, clique no bot√£o **Scan for gadgets** ao lado de qualquer fonte de polui√ß√£o de prot√≥tipo que o DOM Invader encontrou. O DOM Invader abre uma nova aba e come√ßa a procurar por gadgets adequados.
2. Na mesma aba, abra a aba **DOM Invader** no painel DevTools. Uma vez que a varredura esteja conclu√≠da, a visualiza√ß√£o **DOM** exibe quaisquer sinks que o DOM Invader conseguiu acessar atrav√©s dos gadgets identificados. No exemplo abaixo, uma propriedade de gadget chamada `html` foi passada para o sink `innerHTML`.

## DOM clobbering

Na imagem anterior √© poss√≠vel ver que a varredura de DOM clobbering pode ser ativada. Uma vez feito, **o DOM Invader come√ßar√° a procurar por vulnerabilidades de DOM clobbering**.

## Refer√™ncias

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao grupo [**telegram**](https://t.me/peass) ou **siga**-me no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas dicas de hacking enviando PRs para os reposit√≥rios github** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
