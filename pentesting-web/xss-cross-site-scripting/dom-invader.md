# DOM Invader

<details>

<summary><strong>从零到英雄学习AWS黑客攻击</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

支持HackTricks的其他方式：

* 如果您想在**HackTricks中看到您的公司广告**或**下载HackTricks的PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方PEASS & HackTricks商品**](https://peass.creator-spring.com)
* 发现[**PEASS家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs系列**](https://opensea.io/collection/the-peass-family)
* **加入** 💬 [**Discord群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* **通过向** [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github仓库提交PR来分享您的黑客技巧。**

</details>

## DOM Invader

DOM Invader是一个安装在Burp内置浏览器中的浏览器工具。它通过使用各种源和汇，包括web消息和原型污染，帮助**检测DOM XSS漏洞**。该工具作为扩展预装。

DOM Invader在浏览器的DevTools面板中集成了一个标签页，使能以下功能：

1. **识别可控汇**，用于DOM XSS测试的网页，提供上下文和清理细节。
2. **记录、编辑和重新发送web消息**，通过`postMessage()`方法发送用于DOM XSS测试。DOM Invader还可以使用特别制作的web消息自动检测漏洞。
3. 检测**客户端原型污染**源，并扫描发送到危险汇的可控小工具。
4. 识别**DOM篡改漏洞**。

### 启用它

在Burp的内置浏览器中，转到**Burp扩展**并启用它：

<figure><img src="../../.gitbook/assets/image (4) (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

现在刷新页面，在**Dev Tools**中你会找到**DOM Invader标签页**：

<figure><img src="../../.gitbook/assets/image (3) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

### 注入Canary

在前面的图片中，你可以看到一组**随机字符，那是Canary**。你现在应该开始在网页的不同部分（参数、表单、URL...）**注入**它，并每次点击搜索。DOM Invader将检查**canary是否结束在任何有趣的汇**中，这些汇可能被利用。

此外，**注入URL参数**和注入表单的选项将自动打开一个**新标签页**，**注入**每个**URL**参数和它找到的**表单**中的**canary**。

### 注入空Canary

如果你只想找到页面可能有的潜在汇，即使它们不可利用，你可以**搜索一个空的canary**。

### Post消息

DOM Invader允许使用web消息测试DOM XSS，功能包括：

1. **记录web消息**，通过`postMessage()`发送，类似于Burp Proxy的HTTP请求/响应历史记录。
2. **修改**和**重新发出**web消息以手动测试DOM XSS，类似于Burp Repeater的功能。
3. **自动更改**和发送web消息以探测DOM XSS。

#### 消息详情

你可以点击每条消息查看更多关于它的详细信息，包括客户端JavaScript是否访问了消息的`origin`、`data`或`source`属性。

* **`origin`**：如果**消息的来源信息没有检查**，你可能能够**从任意外部域**向事件处理程序发送跨域消息。但即使检查了，它仍然可能不安全。
* **`data`**：这是发送有效载荷的地方。如果这些数据没有被使用，汇就没用。
* **`source`**：评估是否验证了通常引用iframe的source属性，而不是origin。即使这被检查了，也不能保证验证不能被绕过。

#### 回复消息

1. 从**消息**视图中，点击任何消息打开消息详情对话框。
2. 根据需要编辑**数据**字段。
3. 点击**发送**。

### 原型污染

DOM Invader还可以搜索**原型污染漏洞**。首先，你需要启用它：

<figure><img src="../../.gitbook/assets/image (5) (1) (1) (3).png" alt=""><figcaption></figcaption></figure>

然后，它将**搜索源**，使你能够向**`Object.prototype`**添加任意属性。

如果找到了任何东西，一个**测试**按钮将出现以**测试找到的源**。点击它，一个新标签页将出现，在控制台创建一个对象并检查`testproperty`是否存在：
```javascript
let b = {}
b.testproperty
```
一旦你找到了一个源，你可以**扫描小工具**：

1. 从 **DOM** 视图中，点击任何一个 DOM Invader 找到的原型污染源旁边的 **扫描小工具** 按钮。DOM Invader 会打开一个新标签页并开始扫描合适的小工具。
2. 在同一个标签页中，打开 DevTools 面板中的 **DOM Invader** 标签。扫描完成后，**DOM** 视图会显示 DOM Invader 通过识别的小工具能够访问的任何接收点。在下面的例子中，一个名为 `html` 的小工具属性被传递给了 `innerHTML` 接收点。

## DOM 篡改

在前面的图片中可以看到，DOM 篡改扫描可以被打开。一旦完成，**DOM Invader 将开始搜索 DOM 篡改漏洞**。

## 参考资料

* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader](https://portswigger.net/burp/documentation/desktop/tools/dom-invader)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/enabling)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-xss)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/web-messages)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/prototype-pollution)
* [https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering](https://portswigger.net/burp/documentation/desktop/tools/dom-invader/dom-clobbering)

<details>

<summary><strong>通过</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>从零开始学习 AWS 黑客攻击！</strong></summary>

支持 HackTricks 的其他方式：

* 如果你想在 **HackTricks** 中看到你的**公司广告**或**下载 HackTricks 的 PDF**，请查看[**订阅计划**](https://github.com/sponsors/carlospolop)！
* 获取[**官方 PEASS & HackTricks 商品**](https://peass.creator-spring.com)
* 发现[**PEASS 家族**](https://opensea.io/collection/the-peass-family)，我们独家的[**NFTs**](https://opensea.io/collection/the-peass-family)系列
* **加入** 💬 [**Discord 群组**](https://discord.gg/hRep4RUj7f) 或 [**telegram 群组**](https://t.me/peass) 或在 **Twitter** 🐦 上**关注**我 [**@carlospolopm**](https://twitter.com/carlospolopm)**。**
* 通过向 [**HackTricks**](https://github.com/carlospolop/hacktricks) 和 [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github 仓库提交 PR 来**分享你的黑客技巧**。

</details>
