# Contournement de l'authentification √† deux facteurs (2FA/OTP)

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Contournement de l'authentification √† deux facteurs**

### **Contournement direct**

Pour contourner le 2FA, **essayez d'acc√©der directement au point de terminaison suivant** (vous devez conna√Ætre le chemin du point de terminaison suivant). Si cela ne fonctionne pas, essayez de modifier l'en-t√™te **Referrer** comme si vous veniez de la page 2FA.

### **R√©utilisation de token**

Peut-√™tre pouvez-vous r√©utiliser un token pr√©c√©demment utilis√© dans le compte pour vous authentifier.

### Partage de tokens inutilis√©s

V√©rifiez si vous pouvez obtenir le token de votre compte et essayez de l'utiliser pour contourner le 2FA dans un compte diff√©rent.

### Token divulgu√©

Le token est-il divulgu√© dans une r√©ponse de l'application web ?

### Lien de v√©rification par e-mail

Essayez d'utiliser le **lien de v√©rification par e-mail re√ßu lors de la cr√©ation du compte** pour voir si, m√™me si le 2FA a √©t√© configur√©, vous pouvez toujours acc√©der √† votre profil juste avec ce lien ([post](https://srahulceh.medium.com/behind-the-scenes-of-a-security-bug-the-perils-of-2fa-cookie-generation-496d9519771b)).

### Permission de session

En utilisant la m√™me session, commencez le flux en utilisant votre compte et celui de la victime. Lorsque vous atteignez le point 2FA sur les deux comptes, compl√©tez le 2FA avec votre compte mais n'acc√©dez pas √† la partie suivante. Au lieu de cela, essayez d'acc√©der √† l'√©tape suivante avec le flux du compte de la victime. Si le back-end a seulement d√©fini un bool√©en dans vos sessions indiquant que vous avez r√©ussi √† passer le 2FA, vous pourrez contourner le 2FA de la victime.

### **Fonction de r√©initialisation de mot de passe**

Dans presque toutes les applications web, la **fonction de r√©initialisation de mot de passe connecte automatiquement l'utilisateur √† l'application** apr√®s que la proc√©dure de r√©initialisation soit termin√©e.\
V√©rifiez si un **mail** est envoy√© avec un **lien** pour **r√©initialiser le mot de passe** et si vous pouvez **r√©utiliser** ce **lien** pour r√©initialiser le mot de passe **autant de fois que vous le souhaitez** (m√™me si la victime change son adresse e-mail).

Une autre option pour contourner le 2FA avec la fonctionnalit√© de r√©initialisation de mot de passe est de **r√©initialiser le mot de passe avec acc√®s au mail** et d'utiliser le **nouveau mot de passe pour se connecter**, il se pourrait que le 2FA ne soit pas utilis√© apr√®s un changement de mot de passe.

### OAuth

Si vous pouvez compromettre le compte de l'utilisateur sur une plateforme **OAuth** de confiance (Google, Facebook...)

### Force brute

#### Absence de limite de taux

Y a-t-il une limite au nombre de codes que vous pouvez essayer, afin que vous puissiez simplement les forcer brutalement ? Faites attention √† une possible limite de taux "silencieuse", essayez toujours plusieurs codes puis le vrai pour confirmer la vuln√©rabilit√©.

#### Limite de taux de flux mais pas de limite de taux

Dans ce cas, il y a une limite de taux de flux (vous devez le forcer tr√®s lentement : 1 thread et un peu de sommeil avant 2 essais) mais pas de limite de taux. Donc, avec suffisamment de temps, vous pourrez trouver le code valide.

#### Renvoyer le code et r√©initialiser la limite

Il y a une limite de taux mais lorsque vous "renvoyez le code", le m√™me code est envoy√© et la limite de taux est r√©initialis√©e. Ensuite, vous pouvez forcer le code tout en le renvoyant afin que la limite de taux ne soit jamais atteinte.

#### Contournement de la limite de taux c√¥t√© client

{% content-ref url="rate-limit-bypass.md" %}
[rate-limit-bypass.md](rate-limit-bypass.md)
{% endcontent-ref %}

#### Absence de limite de taux dans le compte de l'utilisateur

Parfois, vous pouvez configurer le 2FA pour certaines actions √† l'int√©rieur de votre compte (changer de mail, mot de passe...). Cependant, m√™me dans les cas o√π il y a une limite de taux lorsque vous avez essay√© de vous connecter, il n'y a aucune limite de taux pour prot√©ger les actions √† l'int√©rieur du compte.

#### Absence de limite de taux pour renvoyer le code par SMS

Vous ne pourrez pas contourner le 2FA mais vous pourrez gaspiller l'argent de l'entreprise.

#### R√©g√©n√©ration infinie d'OTP

Si vous pouvez **g√©n√©rer un nouvel OTP un nombre infini de fois**, que l'OTP est **assez simple** (4 chiffres), et que vous pouvez essayer jusqu'√† 4 ou 5 tokens par OTP g√©n√©r√©, vous pouvez simplement essayer les m√™mes 4 ou 5 tokens √† chaque fois et g√©n√©rer des OTP jusqu'√† ce qu'il corresponde √† ceux que vous utilisez.

### Condition de course

Consultez la section sur le contournement du 2FA de la page suivante :

{% content-ref url="race-condition.md" %}
[race-condition.md](race-condition.md)
{% endcontent-ref %}

### CSRF/Clickjacking

V√©rifiez s'il y a une vuln√©rabilit√© de Cross Site Request Forgery (CSRF) ou de Clickjacking pour d√©sactiver le 2FA.

### Fonctionnalit√© "Se souvenir de moi"

#### Cookie devinable

Si la fonctionnalit√© "se souvenir de moi" utilise un nouveau cookie avec un code devinable, essayez de le deviner.

#### Adresse IP

Si la fonctionnalit√© "se souvenir de moi" est attach√©e √† votre adresse IP, vous pouvez essayer de d√©terminer l'adresse IP de la victime et de l'usurper en utilisant l'en-t√™te **X-Forwarded-For**.

### Anciennes versions

#### Sous-domaines

Si vous pouvez trouver des sous-domaines "de test" avec la fonctionnalit√© de connexion, ils pourraient utiliser d'anciennes versions qui ne prennent pas en charge le 2FA (donc il est directement contourn√©) ou ces points de terminaison pourraient supporter une version vuln√©rable du 2FA.

#### APIs

Si vous trouvez que le 2FA utilise une API situ√©e sous un r√©pertoire /v\*/ (comme "/v3/"), cela signifie probablement qu'il existe des points de terminaison d'API plus anciens qui pourraient √™tre vuln√©rables √† une sorte de contournement du 2FA.

### Sessions pr√©c√©dentes

Lorsque le 2FA est activ√©, les sessions pr√©c√©demment cr√©√©es devraient √™tre termin√©es. Cela est d√ª au fait que lorsqu'un client a son compte compromis, il pourrait vouloir le prot√©ger en activant le 2FA, mais si les sessions pr√©c√©dentes ne sont pas termin√©es, cela ne le prot√©gera pas.

### Contr√¥le d'acc√®s inappropri√© aux codes de secours

Les codes de secours sont g√©n√©r√©s imm√©diatement apr√®s l'activation du 2FA et sont disponibles sur une seule requ√™te. Apr√®s chaque appel ult√©rieur √† la requ√™te, les codes peuvent √™tre r√©g√©n√©r√©s ou rester inchang√©s (codes statiques). S'il y a des mauvaises configurations CORS/vuln√©rabilit√©s XSS et d'autres bugs qui vous permettent de "tirer" les codes de secours de la requ√™te de r√©ponse du point de terminaison des codes de secours, alors l'attaquant pourrait voler les codes et contourner le 2FA si le nom d'utilisateur et le mot de passe sont connus.

### Divulgation d'informations

Si vous remarquez que certaines informations confidentielles apparaissent sur la page 2FA que vous ne connaissiez pas auparavant (comme le num√©ro de t√©l√©phone), cela peut √™tre consid√©r√© comme une vuln√©rabilit√© de divulgation d'informations.

### **R√©initialisation du mot de passe == d√©sactivation du 2FA**

1. Cr√©ez un compte et activez le 2FA.
2. D√©connectez-vous de ce compte.
3. Maintenant, allez √† la page de r√©initialisation du mot de passe oubli√©.
4. Changez votre mot de passe.
5. Maintenant, essayez de vous connecter.
6. Si on ne vous demande pas d'entrer un code 2FA, vous pouvez le signaler.

## R√©f√©rences

{% embed url="https://medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35" %}

{% embed url="https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718" %}

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Autres moyens de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La Famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe telegram**](https://t.me/peass) ou **suivez** moi sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux d√©p√¥ts github** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
