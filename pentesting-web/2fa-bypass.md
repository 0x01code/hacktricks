# 2FA/OTP Bypass

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## **Bypassing two-factor authentication**

### **Bypass direto**

Para fazer bypass no 2FA, **tente acessar o pr√≥ximo endpoint diretamente** (voc√™ precisa saber o caminho do pr√≥ximo endpoint). Se isso n√£o funcionar, tente mudar o **cabe√ßalho Referrer** como se voc√™ tivesse vindo da p√°gina do 2FA.

### **Reutiliza√ß√£o de token**

Talvez voc√™ possa reutilizar um token previamente usado dentro da conta para autenticar.

### Compartilhamento de tokens n√£o utilizados

Verifique se voc√™ pode obter o token da sua conta e tentar us√°-lo para fazer bypass no 2FA em uma conta diferente.

### Token Vazado

O token est√° vazado em uma resposta da aplica√ß√£o web?

### Link de verifica√ß√£o de email

Tente usar o **link de verifica√ß√£o de email recebido quando a conta foi criada** para ver se, mesmo com o 2FA configurado, voc√™ ainda pode acessar seu perfil apenas com esse link ([post](https://srahulceh.medium.com/behind-the-scenes-of-a-security-bug-the-perils-of-2fa-cookie-generation-496d9519771b)).

### Permiss√£o de sess√£o

Usando a mesma sess√£o, inicie o fluxo usando sua conta e a conta da v√≠tima. Ao chegar no ponto do 2FA em ambas as contas, complete o 2FA com sua conta, mas n√£o acesse a pr√≥xima parte. Em vez disso, tente acessar o pr√≥ximo passo com o fluxo da conta da v√≠tima. Se o back-end apenas configurou um booleano dentro de suas sess√µes dizendo que voc√™ passou com sucesso pelo 2FA, voc√™ poder√° fazer bypass no 2FA da v√≠tima.

### **Fun√ß√£o de reset de senha**

Em quase todas as aplica√ß√µes web, a **fun√ß√£o de reset de senha automaticamente loga o usu√°rio na aplica√ß√£o** ap√≥s o procedimento de reset ser completado.\
Verifique se um **email** √© enviado com um **link** para **resetar a senha** e se voc√™ pode **reutilizar** esse **link** para resetar a senha **quantas vezes quiser** (mesmo que a v√≠tima mude seu endere√ßo de email).

Outra op√ß√£o para fazer bypass no 2FA com a funcionalidade de reset de senha √© **resetar a senha com acesso ao email** e usar a **nova senha para logar**, pode ser poss√≠vel que ap√≥s uma mudan√ßa de senha o 2FA n√£o seja usado.

### OAuth

Se voc√™ pode comprometer a conta do usu√°rio em uma plataforma **OAuth** confi√°vel (Google, Facebook...)

### For√ßa bruta

#### Falta de limite de taxa

Existe algum limite no n√∫mero de c√≥digos que voc√™ pode tentar, para que voc√™ possa simplesmente for√ßar bruta? Tenha cuidado com um poss√≠vel limite de taxa "silencioso", sempre tente v√°rios c√≥digos e depois o real para confirmar a vulnerabilidade.

#### Limite de taxa de fluxo mas sem limite de taxa

Neste caso, existe um limite de taxa de fluxo (voc√™ tem que for√ßar bruta muito lentamente: 1 thread e algum sono antes de 2 tentativas) mas sem limite de taxa. Ent√£o, com tempo suficiente, voc√™ pode ser capaz de encontrar o c√≥digo v√°lido.

#### Reenviar c√≥digo e resetar o limite

Existe um limite de taxa, mas quando voc√™ "reenvia o c√≥digo", o mesmo c√≥digo √© enviado e o limite de taxa √© resetado. Ent√£o, voc√™ pode for√ßar bruta o c√≥digo enquanto o reenvia para que o limite de taxa nunca seja alcan√ßado.

#### Bypass de limite de taxa do lado do cliente

{% content-ref url="rate-limit-bypass.md" %}
[rate-limit-bypass.md](rate-limit-bypass.md)
{% endcontent-ref %}

#### Falta de limite de taxa na conta do usu√°rio

√Äs vezes voc√™ pode configurar o 2FA para algumas a√ß√µes dentro da sua conta (mudar email, senha...). No entanto, mesmo em casos onde existe um limite de taxa quando voc√™ tentou fazer login, n√£o h√° nenhum limite de taxa para proteger a√ß√µes dentro da conta.

#### Falta de limite de taxa reenviando o c√≥digo via SMS

Voc√™ n√£o ser√° capaz de fazer bypass no 2FA, mas ser√° capaz de gastar o dinheiro da empresa.

#### Regenera√ß√£o infinita de OTP

Se voc√™ pode **gerar um novo OTP infinitas vezes**, o OTP √© **simples o suficiente** (4 n√∫meros), e voc√™ pode tentar at√© 4 ou 5 tokens por OTP gerado, voc√™ pode simplesmente tentar os mesmos 4 ou 5 tokens toda vez e gerar OTPs at√© que coincida com os que voc√™ est√° usando.

### Condi√ß√£o de corrida

Verifique a se√ß√£o sobre bypass de 2FA da seguinte p√°gina:

{% content-ref url="race-condition.md" %}
[race-condition.md](race-condition.md)
{% endcontent-ref %}

### CSRF/Clickjacking

Verifique se existe uma vulnerabilidade de Cross Site Request Forgery (CSRF) ou Clickjacking para desativar o 2FA.

### Funcionalidade "Lembrar de mim"

#### Cookie previs√≠vel

Se a funcionalidade "lembrar de mim" usa um novo cookie com um c√≥digo previs√≠vel, tente adivinh√°-lo.

#### Endere√ßo IP

Se a funcionalidade "lembrar de mim" est√° vinculada ao seu endere√ßo IP, voc√™ pode tentar descobrir o endere√ßo IP da v√≠tima e se passar por ele usando o cabe√ßalho **X-Forwarded-For**.

### Vers√µes antigas

#### Subdom√≠nios

Se voc√™ encontrar alguns subdom√≠nios "de teste" com a funcionalidade de login, eles podem estar usando vers√µes antigas que n√£o suportam 2FA (ent√£o √© diretamente bypassado) ou esses endpoints podem suportar uma vers√£o vulner√°vel do 2FA.

#### APIs

Se voc√™ descobrir que o 2FA est√° usando uma API localizada sob um diret√≥rio /v\*/ (como "/v3/"), isso provavelmente significa que existem endpoints de API mais antigos que poderiam ser vulner√°veis a algum tipo de bypass de 2FA.

### Sess√µes anteriores

Quando o 2FA √© habilitado, sess√µes anteriores criadas devem ser encerradas. Isso porque quando um cliente tem sua conta comprometida, ele pode querer proteg√™-la ativando o 2FA, mas se as sess√µes anteriores n√£o forem encerradas, isso n√£o o proteger√°.

### Controle de acesso inadequado a c√≥digos de backup

C√≥digos de backup s√£o gerados imediatamente ap√≥s o 2FA ser habilitado e est√£o dispon√≠veis em uma √∫nica solicita√ß√£o. Ap√≥s cada chamada subsequente √† solicita√ß√£o, os c√≥digos podem ser regenerados ou permanecer inalterados (c√≥digos est√°ticos). Se houver configura√ß√µes incorretas de CORS/vulnerabilidades de XSS e outros bugs que permitam "puxar" c√≥digos de backup da solicita√ß√£o de resposta do endpoint de c√≥digo de backup, ent√£o o atacante poderia roubar os c√≥digos e fazer bypass no 2FA se o nome de usu√°rio e senha forem conhecidos.

### Divulga√ß√£o de Informa√ß√£o

Se voc√™ notar que algumas informa√ß√µes confidenciais aparecem na p√°gina do 2FA que voc√™ n√£o sabia anteriormente (como o n√∫mero de telefone), ent√£o isso pode ser considerado uma vulnerabilidade de divulga√ß√£o de informa√ß√£o.

### **Reset de Senha == desativar 2FA**

1. Crie uma Conta e Ative o 2FA.
2. Saia dessa conta.
3. Agora, v√° para a p√°gina de esqueci a senha para Resetar a Senha.
4. Mude sua senha.
5. Agora tente fazer login.
6. Se voc√™ n√£o for solicitado a inserir um c√≥digo de 2FA, Voc√™ pode reportar.

## Refer√™ncias

{% embed url="https://medium.com/@iSecMax/two-factor-authentication-security-testing-and-possible-bypasses-f65650412b35" %}

{% embed url="https://azwi.medium.com/2-factor-authentication-bypass-3b2bbd907718" %}

<details>

<summary><strong>Aprenda hacking no AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras formas de apoiar o HackTricks:

* Se voc√™ quer ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF**, confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**material oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o de [**NFTs**](https://opensea.io/collection/the-peass-family) exclusivos
* **Junte-se ao grupo** üí¨ [**Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **Compartilhe suas t√©cnicas de hacking enviando PRs para os reposit√≥rios github do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
