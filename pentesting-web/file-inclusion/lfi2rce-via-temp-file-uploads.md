<details>

<summary><strong>Aprenda hacking AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Outras maneiras de apoiar o HackTricks:

* Se voc√™ quiser ver sua **empresa anunciada no HackTricks** ou **baixar o HackTricks em PDF** Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Junte-se ao** üí¨ [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-nos** no **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para os** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) reposit√≥rios do github.

</details>



**Verifique todos os detalhes desta t√©cnica em [https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf](https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf)**

## **Upload de Arquivos PHP**

Quando um mecanismo **PHP** recebe uma **solicita√ß√£o POST** contendo arquivos formatados de acordo com o RFC 1867, ele gera arquivos tempor√°rios para armazenar os dados enviados. Esses arquivos s√£o cruciais para o tratamento de upload de arquivos em scripts PHP. A fun√ß√£o `move_uploaded_file` deve ser usada para mover esses arquivos tempor√°rios para um local desejado, se for necess√°rio armazenamento persistente al√©m da execu√ß√£o do script. Ap√≥s a execu√ß√£o, o PHP exclui automaticamente quaisquer arquivos tempor√°rios restantes.

{% hint style="info" %}
**Alerta de Seguran√ßa: Atacantes, cientes da localiza√ß√£o dos arquivos tempor√°rios, podem explorar uma vulnerabilidade de Inclus√£o de Arquivo Local para executar c√≥digo acessando o arquivo durante o upload.**
{% endhint %}

O desafio para o acesso n√£o autorizado est√° em prever o nome do arquivo tempor√°rio, que √© intencionalmente randomizado.

#### Explora√ß√£o em Sistemas Windows

No Windows, o PHP gera nomes de arquivos tempor√°rios usando a fun√ß√£o `GetTempFileName`, resultando em um padr√£o como `<caminho>\<pre><uuuu>.TMP`. Notavelmente:

- O caminho padr√£o √© tipicamente `C:\Windows\Temp`.
- O prefixo √© geralmente "php".
- O `<uuuu>` representa um valor hexadecimal √∫nico. Crucialmente, devido √† limita√ß√£o da fun√ß√£o, apenas os 16 bits inferiores s√£o usados, permitindo um m√°ximo de 65.535 nomes √∫nicos com caminho e prefixo constantes, tornando a for√ßa bruta vi√°vel.

Al√©m disso, o processo de explora√ß√£o √© simplificado em sistemas Windows. Uma peculiaridade na fun√ß√£o `FindFirstFile` permite o uso de curingas em caminhos de Inclus√£o de Arquivo Local (LFI). Isso possibilita a cria√ß√£o de um caminho de inclus√£o como o seguinte para localizar o arquivo tempor√°rio:
```
http://site/vuln.php?inc=c:\windows\temp\php<<
```
Em certas situa√ß√µes, pode ser necess√°rio um m√°scara mais espec√≠fica (como `php1<<` ou `phpA<<`). Pode-se tentar sistematicamente essas m√°scaras para descobrir o arquivo tempor√°rio enviado.

#### Explora√ß√£o em Sistemas GNU/Linux

Para sistemas GNU/Linux, a aleatoriedade na nomenclatura de arquivos tempor√°rios √© robusta, tornando os nomes n√£o previs√≠veis nem suscet√≠veis a ataques de for√ßa bruta. Mais detalhes podem ser encontrados na documenta√ß√£o referenciada.
