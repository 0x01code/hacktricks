<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories senden.

</details>



**√úberpr√ºfen Sie die vollst√§ndigen Details dieser Technik unter [https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf](https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf)**

## **PHP-Datei-Uploads**

Wenn ein **PHP**-Engine eine **POST-Anfrage** mit Dateien erh√§lt, die gem√§√ü RFC 1867 formatiert sind, generiert es tempor√§re Dateien, um die hochgeladenen Daten zu speichern. Diese Dateien sind entscheidend f√ºr die Verarbeitung von Datei-Uploads in PHP-Skripten. Die Funktion `move_uploaded_file` muss verwendet werden, um diese tempor√§ren Dateien an einen gew√ºnschten Speicherort zu verschieben, wenn eine dauerhafte Speicherung √ºber die Ausf√ºhrung des Skripts hinaus erforderlich ist. Nach der Ausf√ºhrung l√∂scht PHP automatisch alle verbleibenden tempor√§ren Dateien.

{% hint style="info" %}
**Sicherheitswarnung: Angreifer, die den Speicherort der tempor√§ren Dateien kennen, k√∂nnten eine Schwachstelle f√ºr lokale Dateieinschl√ºsse (Local File Inclusion, LFI) ausnutzen, um Code auszuf√ºhren, indem sie w√§hrend des Uploads auf die Datei zugreifen.**
{% endhint %}

Die Herausforderung f√ºr unbefugten Zugriff besteht darin, den Namen der tempor√§ren Datei vorherzusagen, der absichtlich zuf√§llig generiert wird.

#### Ausnutzung auf Windows-Systemen

Unter Windows generiert PHP tempor√§re Dateinamen mithilfe der Funktion `GetTempFileName`, was zu einem Muster wie `<Pfad>\<Pr√§fix><uuuu>.TMP` f√ºhrt. Beachten Sie insbesondere:

- Der Standardpfad ist in der Regel `C:\Windows\Temp`.
- Das Pr√§fix ist normalerweise "php".
- Das `<uuuu>` repr√§sentiert einen eindeutigen hexadezimalen Wert. Entscheidend ist, dass aufgrund der Einschr√§nkung der Funktion nur die unteren 16 Bits verwendet werden, was maximal 65.535 eindeutige Namen mit konstantem Pfad und Pr√§fix erm√∂glicht und Brute-Force-Angriffe m√∂glich macht.

Dar√ºber hinaus ist der Ausbeutungsprozess auf Windows-Systemen vereinfacht. Eine Besonderheit in der Funktion `FindFirstFile` erm√∂glicht die Verwendung von Platzhaltern in Pfaden f√ºr lokale Dateieinschl√ºsse (Local File Inclusion, LFI). Dadurch kann ein Include-Pfad wie der folgende erstellt werden, um die tempor√§re Datei zu lokalisieren:
```
http://site/vuln.php?inc=c:\windows\temp\php<<
```
In bestimmten Situationen kann eine spezifischere Maske (wie `php1<<` oder `phpA<<`) erforderlich sein. Man kann systematisch diese Masken ausprobieren, um die hochgeladene tempor√§re Datei zu entdecken.

#### Ausnutzung auf GNU/Linux-Systemen

F√ºr GNU/Linux-Systeme ist die Zuf√§lligkeit bei der Benennung tempor√§rer Dateien robust, sodass die Namen weder vorhersehbar noch anf√§llig f√ºr Brute-Force-Angriffe sind. Weitere Details finden Sie in der referenzierten Dokumentation.


<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) **bei oder folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) **und** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **GitHub-Repositories senden.**

</details>
