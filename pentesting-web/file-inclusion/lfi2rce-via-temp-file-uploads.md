<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>



**Consultez les d√©tails complets de cette technique dans [https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf](https://gynvael.coldwind.pl/download.php?f=PHP\_LFI\_rfc1867\_temporary\_files.pdf)**

## **T√©l√©chargements de fichiers PHP**

Lorsqu'un moteur **PHP** re√ßoit une **requ√™te POST** contenant des fichiers format√©s selon la RFC 1867, il g√©n√®re des fichiers temporaires pour stocker les donn√©es t√©l√©charg√©es. Ces fichiers sont essentiels pour la gestion des t√©l√©chargements de fichiers dans les scripts PHP. La fonction `move_uploaded_file` doit √™tre utilis√©e pour d√©placer ces fichiers temporaires vers un emplacement souhait√© si un stockage persistant au-del√† de l'ex√©cution du script est n√©cessaire. Apr√®s l'ex√©cution, PHP supprime automatiquement tout fichier temporaire restant.

{% hint style="info" %}
**Alerte de s√©curit√© : Les attaquants, conscients de l'emplacement des fichiers temporaires, pourraient exploiter une vuln√©rabilit√© d'inclusion de fichier local pour ex√©cuter du code en acc√©dant au fichier lors du t√©l√©chargement.**
{% endhint %}

Le d√©fi de l'acc√®s non autoris√© r√©side dans la pr√©diction du nom du fichier temporaire, qui est intentionnellement al√©atoire.

#### Exploitation sur les syst√®mes Windows

Sur Windows, PHP g√©n√®re des noms de fichiers temporaires en utilisant la fonction `GetTempFileName`, ce qui donne un motif tel que `<chemin>\<pr√©><uuuu>.TMP`. Notamment :

- Le chemin par d√©faut est g√©n√©ralement `C:\Windows\Temp`.
- Le pr√©fixe est g√©n√©ralement "php".
- Le `<uuuu>` repr√©sente une valeur hexad√©cimale unique. Crucialement, en raison de la limitation de la fonction, seuls les 16 bits inf√©rieurs sont utilis√©s, permettant un maximum de 65 535 noms uniques avec un chemin et un pr√©fixe constants, rendant la force brute r√©alisable.

De plus, le processus d'exploitation est simplifi√© sur les syst√®mes Windows. Une particularit√© de la fonction `FindFirstFile` permet l'utilisation de jokers dans les chemins d'inclusion de fichiers locaux (LFI). Cela permet de cr√©er un chemin d'inclusion comme celui-ci pour localiser le fichier temporaire :
```
http://site/vuln.php?inc=c:\windows\temp\php<<
```
Dans certaines situations, un masque plus sp√©cifique (comme `php1<<` ou `phpA<<`) peut √™tre n√©cessaire. On peut syst√©matiquement essayer ces masques pour d√©couvrir le fichier temporaire t√©l√©charg√©.

#### Exploitation sur les syst√®mes GNU/Linux

Pour les syst√®mes GNU/Linux, l'al√©atoire dans le nom des fichiers temporaires est robuste, rendant les noms ni pr√©visibles ni susceptibles aux attaques par force brute. Des d√©tails suppl√©mentaires peuvent √™tre trouv√©s dans la documentation r√©f√©renc√©e.
