# рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

рдпрджрд┐ рдЖрдкрдХреЛ **Local File Inclusion** рдорд┐рд▓рд╛ рд╣реИ, рднрд▓реЗ рд╣реА рдЖрдкрдХреЗ рдкрд╛рд╕ **рд╕рддреНрд░ рди рд╣реЛ** рдФрд░ `session.auto_start` `Off` рд╣реЛред рдпрджрд┐ **`session.upload_progress.enabled`** **`On`** рд╣реИ рдФрд░ рдЖрдк **multipart POST** рдбреЗрдЯрд╛ рдореЗрдВ **`PHP_SESSION_UPLOAD_PROGRESS`** рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, PHP рдЖрдкрдХреЗ рд▓рд┐рдП **рд╕рддреНрд░ рдХреЛ рд╕рдХреНрд╖рдо рдХрд░ рджреЗрдЧрд╛**ред
```bash
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -d 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -F 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'  -F 'file=@/etc/passwd'
$ ls -a /var/lib/php/sessions/
. .. sess_iamorange

In the last example the session will contain the string blahblahblah
```
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **`PHP_SESSION_UPLOAD_PROGRESS`** рдХреЗ рд╕рд╛рде рдЖрдк **рд╕рддреНрд░ рдХреЗ рдЕрдВрджрд░ рдХреЗ рдбреЗрдЯрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдЗрд╕рд▓рд┐рдП рдпрджрд┐ рдЖрдк рдЕрдкрдиреА рд╕рддреНрд░ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдЙрд╕ рд╣рд┐рд╕реНрд╕реЗ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдЖрдк рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ php рд╢реЗрд▓рдХреЛрдб).

{% hint style="info" %}
рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЕрдзрд┐рдХрд╛рдВрд╢ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдЖрдкрдХреЛ рдбрд┐рдмрдЧрд┐рдВрдЧ рдЙрджреНрджреЗрд╢реНрдп рдХреЗ рд▓рд┐рдП `session.upload_progress.cleanup` рдХреЛ `Off` рдкрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рд╕рд▓рд╛рд╣ рджреЗрддреЗ рд╣реИрдВред PHP рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ `session.upload_progress.cleanup` рдЕрднреА рднреА `On` рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдкрдХреА рдЕрдкрд▓реЛрдб рдкреНрд░рдЧрддрд┐ рдХреЛ рд╕рддреНрд░ рдореЗрдВ рдЬрд▓реНрдж рд╕реЗ рдЬрд▓реНрдж рд╕рд╛рдл рдХрд░ рджрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП рдпрд╣ **Race Condition** рд╣реЛрдЧрд╛ред
{% endhint %}

### The CTF

[**рдореВрд▓ CTF**](https://blog.orange.tw/2018/10/) рдореЗрдВ рдЬрд╣рд╛рдВ рдЗрд╕ рддрдХрдиреАрдХ рдХреА рдЯрд┐рдкреНрдкрдгреА рдХреА рдЧрдИ рдереА, Race Condition рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдЗрддрдирд╛ рд╣реА рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рдерд╛ рд▓реЗрдХрд┐рди рд▓реЛрдб рдХреА рдЧрдИ рд╕рд╛рдордЧреНрд░реА рдХреЛ `@<?php` рд╕реНрдЯреНрд░рд┐рдВрдЧ рд╕реЗ рднреА рд╢реБрд░реВ рд╣реЛрдирд╛ рдЖрд╡рд╢реНрдпрдХ рдерд╛ред

`session.upload_progress.prefix` рдХреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧ рдХреЗ рдХрд╛рд░рдг, рд╣рдорд╛рд░реА **SESSION рдлрд╝рд╛рдЗрд▓ рдПрдХ рдХрд╖реНрдЯрдкреНрд░рдж рдкреНрд░реАрдлрд╝рд┐рдХреНрд╕** `upload_progress_` рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрдЧреА рдЬреИрд╕реЗ: `upload_progress_controlledcontentbyattacker`

**рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдкреНрд░реАрдлрд╝рд┐рдХреНрд╕ рдХреЛ рд╣рдЯрд╛рдиреЗ рдХреА рдЪрд╛рд▓** рдереА **рдкреЗрд▓реЛрдб рдХреЛ 3 рдмрд╛рд░ base64encode рдХрд░рдирд╛** рдФрд░ рдлрд┐рд░ `convert.base64-decode` рдлрд┐рд▓реНрдЯрд░реНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕реЗ рдбрд┐рдХреЛрдб рдХрд░рдирд╛, рдпрд╣ рдЗрд╕рд▓рд┐рдП рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **base64 рдбрд┐рдХреЛрдбрд┐рдВрдЧ рдХреЗ рд╕рдордп PHP рдЕрдЬреАрдм рд╡рд░реНрдгреЛрдВ рдХреЛ рд╣рдЯрд╛ рджреЗрдЧрд╛**, рдЗрд╕рд▓рд┐рдП 3 рдмрд╛рд░ рдХреЗ рдмрд╛рдж **рдХреЗрд╡рд▓** **рдкреЗрд▓реЛрдб** **рдЬреЛ** рд╣рдорд▓рд╛рд╡рд░ рдиреЗ **рднреЗрдЬрд╛** рд╣реИ **рдмрдЪреЗрдЧрд╛** (рдФрд░ рдлрд┐рд░ рд╣рдорд▓рд╛рд╡рд░ рдкреНрд░рд╛рд░рдВрднрд┐рдХ рднрд╛рдЧ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ)ред

рдореВрд▓ рд▓реЗрдЦрди рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА [https://blog.orange.tw/2018/10/](https://blog.orange.tw/2018/10/) рдФрд░ рдЕрдВрддрд┐рдо рд╢реЛрд╖рдг [https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py](https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp\_for\_php.py)\
рдПрдХ рдФрд░ рд▓реЗрдЦрди [https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/](https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/)

<details>

<summary><strong>Learn AWS hacking from zero to hero with</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ рд╣рдореЗрдВ ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ**ред
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред

</details>
