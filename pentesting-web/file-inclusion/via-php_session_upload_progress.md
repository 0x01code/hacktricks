# LFI2RCE рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ PHP\_SESSION\_UPLOAD\_PROGRESS

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@hacktricks_live**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ рджреНрд╡рд╛рд░рд╛ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ** [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>

## рдореВрд▓ рдЬрд╛рдирдХрд╛рд░реА

рдЕрдЧрд░ рдЖрдкрдиреЗ **рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓ рд╕рдорд╛рд╡реЗрд╢рди** рдкрд╛рдпрд╛ рд╣реИ рднрд▓реЗ рд╣реА рдЖрдкрдХреЗ рдкрд╛рд╕ **рдХреЛрдИ рд╕рддреНрд░ рди рд╣реЛ** рдФрд░ `session.auto_start` `рдСрдл` рд╣реИред рдЕрдЧрд░ **`session.upload_progress.enabled`** **`рдСрди`** рд╣реИ рдФрд░ рдЖрдк **рдорд▓реНрдЯреАрдкрд╛рд░реНрдЯ POST** рдбреЗрдЯрд╛ рдореЗрдВ **`PHP_SESSION_UPLOAD_PROGRESS`** рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВ, рддреЛ PHP **рдЖрдкрдХреЗ рд▓рд┐рдП рд╕рддреНрд░ рд╕рдХреНрд╖рдо рдХрд░ рджреЗрдЧрд╛**ред
```bash
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -d 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'
$ ls -a /var/lib/php/sessions/
. ..
$ curl http://127.0.0.1/ -H 'Cookie: PHPSESSID=iamorange' -F 'PHP_SESSION_UPLOAD_PROGRESS=blahblahblah'  -F 'file=@/etc/passwd'
$ ls -a /var/lib/php/sessions/
. .. sess_iamorange

In the last example the session will contain the string blahblahblah
```
рд╕рд╛рд╡рдзрд╛рди рд░рд╣реЗрдВ рдХрд┐ **`PHP_SESSION_UPLOAD_PROGRESS`** рдХреЗ рд╕рд╛рде рдЖрдк **рд╕рддреНрд░ рдХреЗ рдЕрдВрджрд░ рдбреЗрдЯрд╛ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**, рдЗрд╕рд▓рд┐рдП рдЕрдЧрд░ рдЖрдк рдЕрдкрдиреЗ рд╕рддреНрд░ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдПрдХ рд╣рд┐рд╕реНрд╕рд╛ рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдЖрдк рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП рдПрдХ PHP рд╢реИрд▓рдХреЛрдб)ред

{% hint style="info" %}
рд╣рд╛рд▓рд╛рдВрдХрд┐ рдЗрдВрдЯрд░рдиреЗрдЯ рдкрд░ рдЕрдзрд┐рдХрд╛рдВрд╢ рдЯреНрдпреВрдЯреЛрд░рд┐рдпрд▓ рдЖрдкрдХреЛ рдбреАрдмрдЧрд┐рдВрдЧ рдХреЗ рдЙрджреНрджреЗрд╢реНрдп рд╕реЗ `session.upload_progress.cleanup` рдХреЛ `Off` рдкрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХрд░рддреЗ рд╣реИрдВред PHP рдореЗрдВ рдбрд┐рдлрд╝реЙрд▓реНрдЯ `session.upload_progress.cleanup` рдЕрдм рднреА `On` рд╣реИред рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдкрдХрд╛ рд╕рддреНрд░ рдореЗрдВ рдЕрдкрд▓реЛрдб рдкреНрд░рдЧрддрд┐ рдХреЛ рдЬрд▓реНрдж рд╕реЗ рдЬрд▓реНрдж рд╕рд╛рдл рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдЗрд╕рд▓рд┐рдП рдпрд╣ **рд░реЗрд╕ рдХрдВрдбреАрд╢рди** рд╣реЛрдЧрд╛ред
{% endhint %}

### CTF

[**рдореВрд▓ CTF**](https://blog.orange.tw/2018/10/) рдореЗрдВ рдЬрд╣рд╛рдБ рдЗрд╕ рддрдХрдиреАрдХ рдкрд░ рдЯрд┐рдкреНрдкрдгреА рдХреА рдЧрдИ рд╣реИ, рд╡рд╣рд╛рдБ рд░реЗрд╕ рдХрдВрдбреАрд╢рди рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдирд╛ рдкрд░реНрдпрд╛рдкреНрдд рдирд╣реАрдВ рдерд╛ рдмрд▓реНрдХрд┐ рд▓реЛрдб рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╕рд╛рдордЧреНрд░реА рднреА `@<?php` рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдереАред

`session.upload_progress.prefix` рдХреА рдбрд┐рдлрд╝реЙрд▓реНрдЯ рд╕реЗрдЯрд┐рдВрдЧ рдХреЗ рдХрд╛рд░рдг, рд╣рдорд╛рд░реА **рд╕рддреНрд░ рдлрд╝рд╛рдЗрд▓ рдПрдХ рдкрд░реЗрд╢рд╛рди рдХрд░рдиреЗ рд╡рд╛рд▓рд╛ рдЙрдкрд╕рд░реНрдЧ рд╕реЗ рд╢реБрд░реВ рд╣реЛрдЧреА** `upload_progress_` рдЬреИрд╕реЗ: `upload_progress_controlledcontentbyattacker`

**рдЖрд░рдВрднрд┐рдХ рдЙрдкрд╕рд░реНрдЧ рдХреЛ рд╣рдЯрд╛рдиреЗ** рдХрд╛ рддрд░реАрдХрд╛ рдерд╛ **рдкреЗрдпрд▓реЛрдб рдХреЛ 3 рдмрд╛рд░ base64encode рдХрд░рдирд╛** рдФрд░ рдлрд┐рд░ `convert.base64-decode` рдлрд╝рд┐рд▓реНрдЯрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕реЗ рдбрд┐рдХреЛрдб рдХрд░рдирд╛, рдпрд╣ рдЗрд╕рд▓рд┐рдП рдХреНрдпреЛрдВрдХрд┐ **рдЬрдм рднреА base64 рдбрд┐рдХреЛрдб рд╣реЛрддрд╛ рд╣реИ рддреЛ PHP рдЕрдЬреАрдм рд╡рд░реНрдг рд╣рдЯрд╛ рджреЗрдЧрд╛**, рдЗрд╕рд▓рд┐рдП 3 рдмрд╛рд░ рдХреЗ рдмрд╛рдж **рдХреЗрд╡рд▓** рд╣рдореЗрдВ рдЖрдХреНрд░рдордгрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ **рднреЗрдЬрд╛ рдЧрдпрд╛ рдкреЗрдпрд▓реЛрдб рд╣реА рдмрдЪреЗрдЧрд╛** (рдФрд░ рдлрд┐рд░ рдЖрдХреНрд░рдордгрдХрд░реНрддрд╛ рдЖрд░рдВрднрд┐рдХ рд╣рд┐рд╕реНрд╕реЗ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ)ред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдореВрд▓ рд▓реЗрдЦ рдореЗрдВ рдЬрд╛рдПрдВ [https://blog.orange.tw/2018/10/](https://blog.orange.tw/2018/10/) рдФрд░ рдЕрдВрддрд┐рдо рд╢реЛрд╖рдг [https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp_for_php.py](https://github.com/orangetw/My-CTF-Web-Challenges/blob/master/hitcon-ctf-2018/one-line-php-challenge/exp_for_php.py)\
рдПрдХ рдФрд░ рд▓реЗрдЦ рдореЗрдВ [https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/](https://spyclub.tech/2018/12/21/one-line-and-return-of-one-line-php-writeup/)
