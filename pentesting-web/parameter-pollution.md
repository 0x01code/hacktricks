# Contaminaci칩n de Par치metros

<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


# Visi칩n General de la Contaminaci칩n de Par치metros HTTP (HPP)

La Contaminaci칩n de Par치metros HTTP (HPP) es una t칠cnica donde los atacantes manipulan los par치metros HTTP para cambiar el comportamiento de una aplicaci칩n web de maneras no deseadas. Esta manipulaci칩n se realiza a침adiendo, modificando o duplicando los par치metros HTTP. El efecto de estas manipulaciones no es visible directamente para el usuario, pero puede alterar significativamente la funcionalidad de la aplicaci칩n en el lado del servidor, con impactos observables en el lado del cliente.

## Ejemplo de Contaminaci칩n de Par치metros HTTP (HPP)

Una URL de transacci칩n de una aplicaci칩n bancaria:

- **URL Original:** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000`

Al insertar un par치metro `from` adicional:

- **URL Manipulada:** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000&from=accountC`

La transacci칩n puede ser incorrectamente cargada a `accountC` en lugar de `accountA`, mostrando el potencial de HPP para manipular transacciones u otras funcionalidades como restablecimientos de contrase침a, configuraciones de 2FA o solicitudes de clave API.

### An치lisis de Par치metros Espec칤ficos de Tecnolog칤a

- La forma en que se analizan y priorizan los par치metros depende de la tecnolog칤a web subyacente, lo que afecta c칩mo se puede explotar HPP.
- Herramientas como [Wappalyzer](https://addons.mozilla.org/en-US/firefox/addon/wappalyzer/) ayudan a identificar estas tecnolog칤as y sus comportamientos de an치lisis.

## Explotaci칩n de PHP y HPP

**Caso de Manipulaci칩n de OTP:**

- **Contexto:** Se explot칩 un mecanismo de inicio de sesi칩n que requer칤a un One-Time Password (OTP).
- **M칠todo:** Al interceptar la solicitud de OTP utilizando herramientas como Burp Suite, los atacantes duplicaron el par치metro `email` en la solicitud HTTP.
- **Resultado:** El OTP, destinado al correo electr칩nico inicial, en lugar se envi칩 a la segunda direcci칩n de correo electr칩nico especificada en la solicitud manipulada. Esta falla permiti칩 el acceso no autorizado al eludir la medida de seguridad prevista.

Este escenario destaca una supervisi칩n cr칤tica en el backend de la aplicaci칩n, que proces칩 el primer par치metro `email` para la generaci칩n de OTP pero utiliz칩 el 칰ltimo para la entrega.

**Caso de Manipulaci칩n de Clave API:**

- **Escenario:** Una aplicaci칩n permite a los usuarios actualizar su clave API a trav칠s de una p치gina de configuraci칩n de perfil.
- **Vector de Ataque:** Un atacante descubre que al agregar un par치metro `api_key` adicional a la solicitud POST, puede manipular el resultado de la funci칩n de actualizaci칩n de la clave API.
- **T칠cnica:** Utilizando una herramienta como Burp Suite, el atacante crea una solicitud que incluye dos par치metros `api_key`: uno leg칤timo y otro malicioso. El servidor, procesando solo la 칰ltima ocurrencia, actualiza la clave API al valor proporcionado por el atacante.
- **Resultado:** El atacante obtiene control sobre la funcionalidad de la API de la v칤ctima, potencialmente accediendo o modificando datos privados de manera no autorizada.

Este ejemplo subraya a칰n m치s la necesidad de un manejo seguro de par치metros, especialmente en funciones tan cr칤ticas como la gesti칩n de claves API.

## An치lisis de Par치metros: Flask vs. PHP

La forma en que las tecnolog칤as web manejan los par치metros HTTP duplicados var칤a, afectando su susceptibilidad a ataques de HPP:

- **Flask:** Adopta el valor del primer par치metro encontrado, como `a=1` en una cadena de consulta `a=1&a=2`, priorizando la instancia inicial sobre duplicados posteriores.
- **PHP (en el Servidor HTTP Apache):** Contrariamente, prioriza el valor del 칰ltimo par치metro, optando por `a=2` en el ejemplo dado. Este comportamiento puede facilitar inadvertidamente las explotaciones de HPP al honrar el par치metro manipulado del atacante sobre el original.

## Referencias
* [https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654](https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654)
* [https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution](https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution)

<figure><img src="/.gitbook/assets/WebSec_1500x400_10fps_21sn_lightoptimized_v2.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


<details>

<summary><strong>Aprende hacking en AWS desde cero hasta experto con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Otras formas de apoyar a HackTricks:

* Si quieres ver tu **empresa anunciada en HackTricks** o **descargar HackTricks en PDF** 춰Consulta los [**PLANES DE SUSCRIPCI칍N**](https://github.com/sponsors/carlospolop)!
* Obt칠n [**merchandising oficial de PEASS & HackTricks**](https://peass.creator-spring.com)
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci칩n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **칔nete al** 游눫 [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s칤guenos** en **Twitter** 游냕 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Comparte tus trucos de hacking enviando PRs a los repositorios de** [**HackTricks**](https://github.com/carlospolop/hacktricks) y [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
