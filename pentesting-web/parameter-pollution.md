# Parameter Pollution

{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


# HTTP Parameter Pollution (HPP) √úbersicht

HTTP Parameter Pollution (HPP) ist eine Technik, bei der Angreifer HTTP-Parameter manipulieren, um das Verhalten einer Webanwendung auf unbeabsichtigte Weise zu √§ndern. Diese Manipulation erfolgt durch das Hinzuf√ºgen, √Ñndern oder Duplizieren von HTTP-Parametern. Die Auswirkungen dieser Manipulationen sind f√ºr den Benutzer nicht direkt sichtbar, k√∂nnen jedoch die Funktionalit√§t der Anwendung auf der Serverseite erheblich ver√§ndern, mit beobachtbaren Auswirkungen auf der Clientseite.

## Beispiel f√ºr HTTP Parameter Pollution (HPP)

Eine Transaktions-URL einer Banking-Anwendung:

- **Urspr√ºngliche URL:** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000`

Durch das Einf√ºgen eines zus√§tzlichen `from`-Parameters:

- **Manipulierte URL:** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000&from=accountC`

Die Transaktion k√∂nnte f√§lschlicherweise `accountC` anstelle von `accountA` belastet werden, was das Potenzial von HPP zur Manipulation von Transaktionen oder anderen Funktionen wie Passwortzur√ºcksetzungen, 2FA-Einstellungen oder API-Schl√ºsselanforderungen zeigt.

### **Technologiespezifische Parameterverarbeitung**

- Die Art und Weise, wie Parameter verarbeitet und priorisiert werden, h√§ngt von der zugrunde liegenden Webtechnologie ab, was die Ausnutzbarkeit von HPP beeinflusst.
- Tools wie [Wappalyzer](https://addons.mozilla.org/en-US/firefox/addon/wappalyzer/) helfen dabei, diese Technologien und deren Verhaltensweisen bei der Verarbeitung zu identifizieren.

## PHP und HPP-Ausnutzung

**OTP-Manipulationsfall:**

- **Kontext:** Ein Anmeldeverfahren, das ein Einmalpasswort (OTP) erfordert, wurde ausgenutzt.
- **Methode:** Durch das Abfangen der OTP-Anfrage mit Tools wie Burp Suite duplizierten die Angreifer den `email`-Parameter in der HTTP-Anfrage.
- **Ergebnis:** Das OTP, das f√ºr die urspr√ºngliche E-Mail gedacht war, wurde stattdessen an die zweite in der manipulierten Anfrage angegebene E-Mail-Adresse gesendet. Dieser Fehler erm√∂glichte unbefugten Zugriff, indem die beabsichtigte Sicherheitsma√ünahme umgangen wurde.

Dieses Szenario hebt einen kritischen Fehler im Backend der Anwendung hervor, das den ersten `email`-Parameter zur OTP-Generierung verarbeitete, aber den letzten f√ºr die Zustellung verwendete.

**API-Schl√ºssel-Manipulationsfall:**

- **Szenario:** Eine Anwendung erm√∂glicht es Benutzern, ihren API-Schl√ºssel √ºber eine Profilseite zu aktualisieren.
- **Angriffsvektor:** Ein Angreifer entdeckt, dass er durch das Anh√§ngen eines zus√§tzlichen `api_key`-Parameters an die POST-Anfrage das Ergebnis der API-Schl√ºsselaktualisierungsfunktion manipulieren kann.
- **Technik:** Mit einem Tool wie Burp Suite erstellt der Angreifer eine Anfrage, die zwei `api_key`-Parameter enth√§lt: einen legitimen und einen b√∂sartigen. Der Server, der nur das letzte Vorkommen verarbeitet, aktualisiert den API-Schl√ºssel auf den vom Angreifer bereitgestellten Wert.
- **Ergebnis:** Der Angreifer erh√§lt die Kontrolle √ºber die API-Funktionalit√§t des Opfers und kann m√∂glicherweise private Daten unbefugt abrufen oder √§ndern.

Dieses Beispiel unterstreicht weiter die Notwendigkeit einer sicheren Parameterverarbeitung, insbesondere bei so kritischen Funktionen wie der Verwaltung von API-Schl√ºsseln.

## Parameterverarbeitung: Flask vs. PHP

Die Art und Weise, wie Webtechnologien doppelte HTTP-Parameter behandeln, variiert und beeinflusst ihre Anf√§lligkeit f√ºr HPP-Angriffe:

- **Flask:** Nimmt den ersten gefundenen Parameterwert an, wie `a=1` in einer Abfragezeichenfolge `a=1&a=2`, und priorisiert die erste Instanz gegen√ºber nachfolgenden Duplikaten.
- **PHP (auf Apache HTTP Server):** Priorisiert hingegen den letzten Parameterwert und w√§hlt `a=2` im gegebenen Beispiel. Dieses Verhalten kann unbeabsichtigt HPP-Angriffe erleichtern, indem es den manipulierten Parameter des Angreifers √ºber den urspr√ºnglichen stellt.

## Referenzen
* [https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654](https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654)
* [https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution](https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


{% hint style="success" %}
Lerne & √ºbe AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lerne & √ºbe GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfe die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Tritt der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folge** uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teile Hacking-Tricks, indem du PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos einreichst.

</details>
{% endhint %}
