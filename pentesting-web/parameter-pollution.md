# パラメータ汚染

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>を通じてゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい**または **HackTricks をPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksスウォッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見る
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)をフォローする
* **ハッキングトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks)と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のGitHubリポジトリにPRを提出してください。

</details>

# HTTPパラメータ汚染（HPP）概要

HTTPパラメータ汚染（HPP）は、HTTPパラメータの操作を通じてWebアプリケーションの予想される動作を変更する攻撃技術です。この種の攻撃は比較的直接的ですが、非常に効果的です。パラメータの操作はサーバーサイドで発生し、ユーザーには見えませんが、その結果としての動作変更はクライアントサイドで観察できます。

## HTTPパラメータ汚染（HPP）の例

銀行アプリケーションの標準的なトランザクションURLを考えてみましょう：

**URL:** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000`

このURLは、accountA から accountB への10,000の取引を開始します。しかし、次のように別の `from` パラメータを追加すると：

**操作されたURL:** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000&from=accountC`

取引が accountA ではなく accountC から差し引かれる可能性があります。これは、HPPがパラメータを操作するためにどのように使用されるかを示しています。特に、この脆弱性はGETリクエストに限定されず、パスワードの変更、2FA、またはAPIキーの送信など、さまざまな機能でPOSTリクエストでも悪用される可能性があります。

パラメータの解析は使用されている特定のWebテクノロジーに依存することを認識することが重要です。[Wappalyzer](https://addons.mozilla.org/en-US/firefox/addon/wappalyzer/)のようなツールを使用して、Webテクノロジーを特定し、そのパラメータ解析の動作を理解することができます。

## PHP

HPPを悪用する注目すべきインスタンスには、次の手順が含まれます：

1. **OTP操作:**
- OTPをリクエストするログインページが対象となりました。
- OTPリクエストを送信した後、次のHTTPリクエストがBurp Suiteを使用して傍受されました。
- 別のメールがリクエストに追加され、`email`パラメータが効果的に複製されました。
- 最初のメール用に意図されたOTPが誤って2番目のメールに送信され、最初のアカウントへの不正アクセスが可能になりました。

このインシデントは、アプリケーションのバックエンドが `email` パラメータを処理し、最初のパラメータをOTP生成に使用し、2番目のパラメータをOTP配信に使用したことを示しています。

# FlaskとPHPにおけるパラメータ解析

異なるWebテクノロジーはパラメータをユニークに解析します。たとえば、`a=1&a=2` というクエリの場合、FlaskとPHPはパラメータを異なる方法で解釈します：

- **Flask:** 最初の出現を取ります（a=1）。
- **PHP（Apache HTTP Server上）:** 最後の出現を取ります（a=2）。

このパラメータ処理の違いは、アプリケーションの動作やHPP攻撃への脆弱性に大きな影響を与える可能性があります。これに関する詳細は、[この解説](https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution)で見つけることができます。

# 参考文献
* [https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654](https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654)
* [https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution](https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution)

<details>

<summary><strong>htARTE（HackTricks AWS Red Team Expert）</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>を通じてゼロからヒーローまでAWSハッキングを学ぶ</strong></a><strong>！</strong></summary>

HackTricks をサポートする他の方法:

* **HackTricks で企業を宣伝したい**または **HackTricks をPDFでダウンロードしたい**場合は、[**SUBSCRIPTION PLANS**](https://github.com/sponsors/carlospolop)をチェックしてください！
* [**公式PEASS＆HackTricksスウォッグ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見し、独占的な[**NFT**](https://opensea.io/collection/the-peass-family)のコレクションを見る
* **💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に参加するか、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)をフォローする
* **ハッキングトリックを共有するには、** [**HackTricks**](https://github.com/carlospolop/hacktricks)と [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) のGitHubリポジトリにPRを提出してください。

</details>
