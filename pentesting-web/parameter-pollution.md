# Polui√ß√£o de Par√¢metros

{% hint style="success" %}
Aprenda e pratique Hacking na AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking no GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


# Vis√£o Geral da Polui√ß√£o de Par√¢metros HTTP (HPP)

A Polui√ß√£o de Par√¢metros HTTP (HPP) √© uma t√©cnica onde atacantes manipulam par√¢metros HTTP para alterar o comportamento de uma aplica√ß√£o web de maneiras n√£o intencionais. Essa manipula√ß√£o √© feita adicionando, modificando ou duplicando par√¢metros HTTP. O efeito dessas manipula√ß√µes n√£o √© diretamente vis√≠vel para o usu√°rio, mas pode alterar significativamente a funcionalidade da aplica√ß√£o no lado do servidor, com impactos observ√°veis no lado do cliente.

## Exemplo de Polui√ß√£o de Par√¢metros HTTP (HPP)

Uma URL de transa√ß√£o de um aplicativo banc√°rio:

- **URL Original:** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000`

Ao inserir um par√¢metro `from` adicional:

- **URL Manipulada:** `https://www.victim.com/send/?from=accountA&to=accountB&amount=10000&from=accountC`

A transa√ß√£o pode ser incorretamente cobrada para `accountC` em vez de `accountA`, demonstrando o potencial da HPP para manipular transa√ß√µes ou outras funcionalidades, como redefini√ß√µes de senha, configura√ß√µes de 2FA ou solicita√ß√µes de chave de API.

### **An√°lise de Par√¢metros Espec√≠fica da Tecnologia**

- A forma como os par√¢metros s√£o analisados e priorizados depende da tecnologia web subjacente, afetando como a HPP pode ser explorada.
- Ferramentas como [Wappalyzer](https://addons.mozilla.org/en-US/firefox/addon/wappalyzer/) ajudam a identificar essas tecnologias e seus comportamentos de an√°lise.

## Explora√ß√£o de HPP em PHP

**Caso de Manipula√ß√£o de OTP:**

- **Contexto:** Um mecanismo de login que requer uma Senha de Uso √önico (OTP) foi explorado.
- **M√©todo:** Ao interceptar a solicita√ß√£o de OTP usando ferramentas como Burp Suite, os atacantes duplicaram o par√¢metro `email` na solicita√ß√£o HTTP.
- **Resultado:** O OTP, destinado ao email inicial, foi enviado para o segundo endere√ßo de email especificado na solicita√ß√£o manipulada. Essa falha permitiu acesso n√£o autorizado ao contornar a medida de seguran√ßa pretendida.

Esse cen√°rio destaca uma falha cr√≠tica no backend da aplica√ß√£o, que processou o primeiro par√¢metro `email` para a gera√ß√£o de OTP, mas usou o √∫ltimo para entrega.

**Caso de Manipula√ß√£o de Chave de API:**

- **Cen√°rio:** Um aplicativo permite que os usu√°rios atualizem sua chave de API atrav√©s de uma p√°gina de configura√ß√µes de perfil.
- **Vetor de Ataque:** Um atacante descobre que, ao anexar um par√¢metro `api_key` adicional √† solicita√ß√£o POST, pode manipular o resultado da fun√ß√£o de atualiza√ß√£o da chave de API.
- **T√©cnica:** Utilizando uma ferramenta como Burp Suite, o atacante elabora uma solicita√ß√£o que inclui dois par√¢metros `api_key`: um leg√≠timo e um malicioso. O servidor, processando apenas a √∫ltima ocorr√™ncia, atualiza a chave de API para o valor fornecido pelo atacante.
- **Resultado:** O atacante ganha controle sobre a funcionalidade da API da v√≠tima, potencialmente acessando ou modificando dados privados de forma n√£o autorizada.

Esse exemplo refor√ßa ainda mais a necessidade de um manuseio seguro de par√¢metros, especialmente em recursos t√£o cr√≠ticos quanto a gest√£o de chaves de API.

## An√°lise de Par√¢metros: Flask vs. PHP

A forma como as tecnologias web lidam com par√¢metros HTTP duplicados varia, afetando sua suscetibilidade a ataques HPP:

- **Flask:** Adota o primeiro valor de par√¢metro encontrado, como `a=1` em uma string de consulta `a=1&a=2`, priorizando a inst√¢ncia inicial em detrimento de duplicatas subsequentes.
- **PHP (no Apache HTTP Server):** Por outro lado, prioriza o √∫ltimo valor de par√¢metro, optando por `a=2` no exemplo dado. Esse comportamento pode inadvertidamente facilitar explora√ß√µes de HPP ao honrar o par√¢metro manipulado pelo atacante em vez do original.

## Refer√™ncias
* [https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654](https://medium.com/@shahjerry33/http-parameter-pollution-its-contaminated-85edc0805654)
* [https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution](https://github.com/google/google-ctf/tree/master/2023/web-under-construction/solution)

<figure><img src="https://pentest.eu/RENDER_WebSec_10fps_21sec_9MB_29042024.gif" alt=""><figcaption></figcaption></figure>

{% embed url="https://websec.nl/" %}


{% hint style="success" %}
Aprenda e pratique Hacking na AWS:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Aprenda e pratique Hacking no GCP: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* Confira os [**planos de assinatura**](https://github.com/sponsors/carlospolop)!
* **Junte-se ao** üí¨ [**grupo do Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo do telegram**](https://t.me/peass) ou **siga**-nos no **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe truques de hacking enviando PRs para os reposit√≥rios do** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>
{% endhint %}
