# Εισαγωγή Email

<figure><img src="../.gitbook/assets/image (3) (1) (1) (1) (1).png" alt=""><figcaption></figcaption></figure>

\
Χρησιμοποιήστε το [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) για να δημιουργήσετε και να αυτοματοποιήσετε ροές εργασίας με τα πιο προηγμένα εργαλεία της κοινότητας.\
Αποκτήστε πρόσβαση σήμερα:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><strong>Μάθετε το hacking του AWS από το μηδέν μέχρι τον ήρωα με το</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Άλλοι τρόποι υποστήριξης του HackTricks:

* Εάν θέλετε να δείτε την εταιρεία σας να διαφημίζεται στο HackTricks ή να κατεβάσετε το HackTricks σε μορφή PDF, ελέγξτε τα [**ΣΧΕΔΙΑ ΣΥΝΔΡΟΜΗΣ**](https://github.com/sponsors/carlospolop)!
* Αποκτήστε το [**επίσημο PEASS & HackTricks swag**](https://peass.creator-spring.com)
* Ανακαλύψτε [**την Οικογένεια PEASS**](https://opensea.io/collection/the-peass-family), τη συλλογή μας από αποκλειστικά [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Εγγραφείτε στη** 💬 [**ομάδα Discord**](https://discord.gg/hRep4RUj7f) ή στη [**ομάδα telegram**](https://t.me/peass) ή **ακολουθήστε** μας στο **Twitter** 🐦 [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Μοιραστείτε τα hacking tricks σας υποβάλλοντας PRs στα** [**HackTricks**](https://github.com/carlospolop/hacktricks) και [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) αποθετήρια του github.

</details>

## Εισαγωγή σε απεσταλμένο email

### Εισαγωγή Cc και Bcc μετά το όρισμα του αποστολέα
```
From:sender@domain.com%0ACc:recipient@domain.co,%0ABcc:recipient1@domain.com
```
### Εισαγωγή ορίσματος
```
From:sender@domain.com%0ATo:attacker@domain.com
```
Το μήνυμα θα αποσταλεί στον αρχικό παραλήπτη και στον λογαριασμό του επιτιθέμενου.

### Εισαγωγή ορίσματος Θέματος
```
From:sender@domain.com%0ASubject:This is%20Fake%20Subject
```
Το ψεύτικο θέμα θα προστεθεί στο αρχικό θέμα και σε ορισμένες περιπτώσεις θα το αντικαταστήσει. Αυτό εξαρτάται από τη συμπεριφορά της υπηρεσίας αλληλογραφίας.

### Αλλαγή του περιεχομένου του μηνύματος

Εισαγάγετε ένα διπλό αλλαγή γραμμής, στη συνέχεια γράψτε το μήνυμά σας για να αλλάξετε το περιεχόμενο του μηνύματος.
```
From:sender@domain.com%0A%0AMy%20New%20%0Fake%20Message.
```
### Εκμετάλλευση της συνάρτησης PHP mail()

The `mail()` function in PHP is commonly used to send emails from a web application. However, if not properly secured, it can be vulnerable to email injection attacks. 

Η συνάρτηση `mail()` στην PHP χρησιμοποιείται συχνά για να στέλνει emails από μια web εφαρμογή. Ωστόσο, αν δεν προστατεύεται σωστά, μπορεί να είναι ευάλωτη σε επιθέσεις εισροής email.

An email injection attack occurs when an attacker is able to manipulate the email headers passed to the `mail()` function, allowing them to inject additional headers or even modify the content of the email. 

Μια επίθεση εισροής email συμβαίνει όταν ένας επιτιθέμενος μπορεί να παραπλανήσει τους κεφαλίδες email που περνούν στη συνάρτηση `mail()`, επιτρέποντάς του να εισαγάγει επιπλέον κεφαλίδες ή ακόμη και να τροποποιήσει το περιεχόμενο του email.

One common method of email injection is by manipulating the "To" field of the email header. By injecting additional email addresses separated by a newline character, the attacker can send a copy of the email to themselves or other recipients. 

Ένας συνηθισμένος τρόπος εισροής email είναι με τον παραπλανητικό τρόπο του πεδίου "To" της κεφαλίδας του email. Εισάγοντας επιπλέον διευθύνσεις email χωρισμένες με έναν χαρακτήρα νέας γραμμής, ο επιτιθέμενος μπορεί να στείλει αντίγραφο του email στον εαυτό του ή σε άλλους παραλήπτες.

Another method is by injecting additional headers such as "Bcc" or "Cc", allowing the attacker to secretly send copies of the email to other recipients without the knowledge of the original recipient. 

Ένας άλλος τρόπος είναι με την εισαγωγή επιπλέον κεφαλίδων όπως "Bcc" ή "Cc", επιτρέποντας στον επιτιθέμενο να στείλει μυστικά αντίγραφα του email σε άλλους παραλήπτες χωρίς τη γνώση του αρχικού παραλήπτη.

To prevent email injection attacks, it is important to properly sanitize and validate user input before using it in the `mail()` function. This includes ensuring that email addresses are properly formatted and do not contain any newline characters. 

Για να αποτραπούν οι επιθέσεις εισροής email, είναι σημαντικό να καθαρίζεται και επικυρώνεται σωστά η είσοδος του χρήστη πριν χρησιμοποιηθεί στη συνάρτηση `mail()`. Αυτό περιλαμβάνει τη διασφάλιση ότι οι διευθύνσεις email έχουν σωστή μορφοποίηση και δεν περιέχουν χαρακτήρες νέας γραμμής.

By implementing proper input validation and sanitization techniques, the risk of email injection attacks can be significantly reduced. 

Με την εφαρμογή κατάλληλων τεχνικών επικύρωσης και καθαρισμού της εισόδου, μπορεί να μειωθεί σημαντικά ο κίνδυνος επιθέσεων εισροής email.
```bash
# The function has the following definition:

php --rf mail

Function [ <internal:standard> function mail ] {
- Parameters [5] {
Parameter #0 [ <required> $to ]
Parameter #1 [ <required> $subject ]
Parameter #2 [ <required> $message ]
Parameter #3 [ <optional> $additional_headers ]
Parameter #4 [ <optional> $additional_parameters ]
}
}
```
#### Ο 5ος παράμετρος ($additional\_parameters)

Αυτή η ενότητα θα βασιστεί στο **πώς να καταχραστείτε αυτήν την παράμετρο υποθέτοντας ότι ένας επιτιθέμενος την ελέγχει**.

Αυτή η παράμετρος θα προστεθεί στη γραμμή εντολών που θα χρησιμοποιεί η PHP για να καλέσει το δυαδικό sendmail. Ωστόσο, θα απολυμαίνεται με τη συνάρτηση `escapeshellcmd($additional_parameters)`.

Ένας επιτιθέμενος μπορεί να **εισαγάγει εξωτερικές παραμέτρους για το sendmail** σε αυτήν την περίπτωση.

#### Διαφορές στην υλοποίηση του /usr/sbin/sendmail

Η διεπαφή **sendmail** παρέχεται από το λογισμικό MTA email (Sendmail, Postfix, Exim κλπ.) που είναι εγκατεστημένο στο σύστημα. Αν και η **βασική λειτουργικότητα** (όπως οι παράμετροι -t -i -f) παραμένει **ίδια** για λόγους συμβατότητας, **άλλες λειτουργίες και παράμετροι** διαφέρουν σημαντικά ανάλογα με το εγκατεστημένο MTA.

Παρακάτω παρατίθενται μερικά παραδείγματα διαφορετικών σελίδων εγχειριδίου για την εντολή/διεπαφή sendmail:

* Sendmail MTA: http://www.sendmail.org/\~ca/email/man/sendmail.html
* Postfix MTA: http://www.postfix.org/mailq.1.html
* Exim MTA: https://linux.die.net/man/8/eximReferences

Ανάλογα με την **προέλευση του δυαδικού sendmail**, έχουν ανακαλυφθεί διάφορες επιλογές για την κατάχρησή τους και την **διαρροή αρχείων ή ακόμα και την εκτέλεση αυθαίρετων εντολών**. Δείτε πώς στο [**https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html**](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)

## Εισαγωγή στο όνομα του email

### Αγνοημένα μέρη ενός email

Τα σύμβολα: **+, -** και **{}** σπάνια μπορούν να χρησιμοποιηθούν για ετικετοποίηση και να αγνοηθούν από τους περισσότερους διακομιστές email.

* Π.χ. john.doe+intigriti@example.com → john.doe@example.com

**Σχόλια μεταξύ παρενθέσεων ()** στην αρχή ή στο τέλος θα αγνοηθούν επίσης

* Π.χ. john.doe(intigriti)@example.com → john.doe@example.com

### Παράκαμψη λευκής λίστας

<figure><img src="../.gitbook/assets/image (4) (6).png" alt="https://www.youtube.com/watch?app=desktop&v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### Εισαγωγικά

<figure><img src="../.gitbook/assets/image (6) (4).png" alt="https://www.youtube.com/watch?app=desktop&v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### Διευθύνσεις IP

Μπορείτε επίσης να χρησιμοποιήσετε διευθύνσεις IP ως ονόματα τομέων μεταξύ αγκύλων:

* john.doe@\[127.0.0.1]
* john.doe@\[IPv6:2001:db8::1]

### Άλλες ευπάθειες

![https://www.youtube.com/watch?app=desktop&v=4ZsTKvfP1g0](<../.gitbook/assets/image (296).png>)

## Τρίτο κομμάτι SSO

### XSS

Ορισμένες υπηρεσίες όπως το **github** ή το **salesforce σας επιτρέπουν** να δημιουργήσετε μια **διεύθυνση email με XSS payloads**. Αν μπορείτε να **χρησιμοποιήσετε αυτούς τους παρόχους για να συνδεθείτε σε άλλες υπηρεσίες** και αυτές οι υπηρεσίες **δεν απολυμαίνουν σωστά** το email, μπορείτε να προκαλέσετε **XSS**.

### Κατάληψη λογαριασμού

Αν μια **υπηρεσία SSO** σας επιτρέπει να **δημιουργήσετε ένα λογαριασμό χωρίς να επαληθεύεται η δοθείσα διεύθυνση email** (όπως το **salesforce**) και στη συνέχεια μπορείτε να χρησιμοποιήσετε αυτόν τον λογαριασμό για να συνδεθείτε σε μια διαφορετική υπηρεσία που **εμπιστεύεται** το salesforce, μπορείτε να αποκτήσετε πρόσβαση σε οποιονδήπ
