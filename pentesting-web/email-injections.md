# Inyecciones de correo electr√≥nico

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
Utilice [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para construir y **automatizar flujos de trabajo** con las herramientas de la comunidad **m√°s avanzadas del mundo**.\
Obtenga acceso hoy mismo:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabaja en una **empresa de ciberseguridad**? ¬øQuiere ver su **empresa anunciada en HackTricks**? ¬øO quiere tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulte los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenga el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önase al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠game** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparta sus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Inyectar en correo electr√≥nico enviado

### Inyectar Cc y Bcc despu√©s del argumento del remitente
```
From:sender@domain.com%0ACc:recipient@domain.co,%0ABcc:recipient1@domain.com
```
El mensaje ser√° enviado a las cuentas del destinatario y destinatario1.

### Inyectar argumento
```
From:sender@domain.com%0ATo:attacker@domain.com
```
El mensaje ser√° enviado tanto al destinatario original como a la cuenta del atacante.

### Inyectar argumento de Asunto
```
From:sender@domain.com%0ASubject:This is%20Fake%20Subject
```
El asunto falso se agregar√° al asunto original y en algunos casos lo reemplazar√°. Depende del comportamiento del servicio de correo.

### Cambiar el cuerpo del mensaje

Inyecte dos saltos de l√≠nea y luego escriba su mensaje para cambiar el cuerpo del mensaje.
```
From:sender@domain.com%0A%0AMy%20New%20%0Fake%20Message.
```
### Explotaci√≥n de la funci√≥n mail() de PHP
```bash
# The function has the following definition:

php --rf mail

Function [ <internal:standard> function mail ] {
  - Parameters [5] {
    Parameter #0 [ <required> $to ]
    Parameter #1 [ <required> $subject ]
    Parameter #2 [ <required> $message ]
    Parameter #3 [ <optional> $additional_headers ]
    Parameter #4 [ <optional> $additional_parameters ]
  }
}
```
#### El quinto par√°metro ($additional\_parameters)

Esta secci√≥n se basar√° en **c√≥mo abusar de este par√°metro suponiendo que un atacante lo controle**.

Este par√°metro se agregar√° a la l√≠nea de comando que PHP usar√° para invocar el binario sendmail. Sin embargo, se sanitizar√° con la funci√≥n `escapeshellcmd($additional_parameters)`.

Un atacante puede **inyectar par√°metros adicionales para sendmail** en este caso.

#### Diferencias en la implementaci√≥n de /usr/sbin/sendmail

La interfaz **sendmail** es **proporcionada por el software MTA de correo electr√≥nico** (Sendmail, Postfix, Exim, etc.) instalado en el sistema. Aunque la **funcionalidad b√°sica** (como los par√°metros -t -i -f) sigue siendo la **misma** por razones de compatibilidad, **otras funciones y par√°metros** var√≠an mucho seg√∫n el MTA instalado.

Aqu√≠ hay algunos ejemplos de diferentes p√°ginas de manual de la interfaz de comando sendmail:

* Sendmail MTA: http://www.sendmail.org/\~ca/email/man/sendmail.html
* Postfix MTA: http://www.postfix.org/mailq.1.html
* Exim MTA: https://linux.die.net/man/8/eximReferences

Dependiendo del **origen del binario sendmail**, se han descubierto diferentes opciones para abusar de ellos y **filtrar archivos o incluso ejecutar comandos arbitrarios**. Ver c√≥mo en [**https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html**](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)

## Inyectar en el nombre del correo electr√≥nico

### Partes ignoradas de un correo electr√≥nico

Los s√≠mbolos: **+, -** y **{}** en raras ocasiones se pueden usar para etiquetar y ser ignorados por la mayor√≠a de los servidores de correo electr√≥nico.

* Ej. john.doe+intigriti@example.com ‚Üí john.doe@example.com

Los **comentarios entre par√©ntesis ()** al principio o al final tambi√©n se ignorar√°n.

* Ej. john.doe(intigriti)@example.com ‚Üí john.doe@example.com

### Bypass de lista blanca

<figure><img src="../.gitbook/assets/image (4) (6).png" alt=""><figcaption></figcaption></figure>

### Comillas

<figure><img src="../.gitbook/assets/image (6) (4).png" alt=""><figcaption></figcaption></figure>

### IPs

Tambi√©n puede usar IPs como nombres de dominio entre corchetes:

* john.doe@\[127.0.0.1]
* john.doe@\[IPv6:2001:db8::1]

### Otras vulnerabilidades

![](<../.gitbook/assets/image (296).png>)

## SSO de terceros

### XSS

Algunos servicios como **github** o **salesforce permiten** crear una **direcci√≥n de correo electr√≥nico con payloads XSS**. Si puede **usar estos proveedores para iniciar sesi√≥n en otros servicios** y estos servicios **no est√°n sanitizando** correctamente el correo electr√≥nico, podr√≠a causar **XSS**.

### Toma de cuenta

Si un **servicio SSO** le permite **crear una cuenta sin verificar la direcci√≥n de correo electr√≥nico proporcionada** (como **salesforce**) y luego puede usar esa cuenta para **iniciar sesi√≥n en un servicio diferente** que **conf√≠a** en salesforce, podr√≠a acceder a cualquier cuenta.\
_Tenga en cuenta que salesforce indica si se verific√≥ o no el correo electr√≥nico proporcionado, pero la aplicaci√≥n tambi√©n deber√≠a tener en cuenta esta informaci√≥n._

## Responder a

Puede enviar un correo electr√≥nico usando _**De: empresa.com**_\*\* \*\* y _**Responder a: atacante.com**_ y si se env√≠a alguna **respuesta autom√°tica** debido a que el correo electr√≥nico se envi√≥ **desde** una **direcci√≥n interna**, el **atacante** podr√≠a ser capaz de **recibir** esa **respuesta**.

## Tasa de rebote duro

Algunas aplicaciones como AWS tienen una **Tasa de rebote duro** (en AWS es del 10%), que cuando est√° sobrecargado, el servicio de correo electr√≥nico se bloquea.

Un **rebote duro** es un **correo electr√≥nico** que no se pudo entregar por algunas razones permanentes. Tal vez la direcci√≥n de correo electr√≥nico es falsa, tal vez el dominio de correo electr√≥nico no es un dominio real, o tal vez el servidor del destinatario de correo electr√≥nico no aceptar√° correos electr√≥nicos, lo que significa que de un total de 1000 correos electr√≥nicos, si 100 de ellos eran falsos o eran inv√°lidos que causaron que todos rebotaran, **AWS SES** bloquear√° su servicio.

Por lo tanto, si puede **enviar correos electr√≥nicos (tal vez invitaciones) desde la aplicaci√≥n web a cualquier direcci√≥n de correo electr√≥nico, podr√≠a provocar este bloqueo enviando cientos de invitaciones a usuarios y dominios inexistentes: DoS del servicio de correo electr√≥nico.**

## Referencias

* [https://resources.infosecinstitute.com/email-injection/](https://resources.infosecinstitute.com/email-injection/)
* [https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)
* [https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view](https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view)
* [https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

* ¬øTrabaja en una **empresa de ciberseguridad**? ¬øQuiere ver su **empresa anunciada en HackTricks**? o ¬øquiere tener acceso a la **√∫ltima versi√≥n de PEASS o descargar HackTricks en PDF**? ¬°Consulte los [**PLANES DE SUSCRIPCI√ìN**](https://github.com/sponsors/carlospolop)!
* Descubre [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nuestra colecci√≥n de exclusivos [**NFTs**](https://opensea.io/collection/the-peass-family)
* Obtenga el [**swag oficial de PEASS y HackTricks**](https://peass.creator-spring.com)
* **√önase al** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo de Discord**](https://discord.gg/hRep4RUj7f) o al [**grupo de telegram**](https://t.me/peass) o **s√≠game** en **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Comparta sus trucos de hacking enviando PR al** [**repositorio de hacktricks**](https://github.com/carlospolop/hacktricks) **y al** [**repositorio de hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

![](<../.gitbook/assets/image (9) (1) (2).png>)

\
Use [**Trickest**](https://trickest.com/?utm\_campaign=hacktrics\&utm\_medium=banner\&utm\_source=hacktricks) para crear y **automatizar flujos de trabajo** con las herramientas de la comunidad m√°s avanzadas del mundo.\
Obtenga acceso hoy:

{% embed url="https://trickest.com/?utm_campaign=hacktrics&utm_medium=banner&utm_source=hacktricks" %}
