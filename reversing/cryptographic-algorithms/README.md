# рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ/рд╕рдВрдкреАрдбрд╝рди рдПрд▓реНрдЧреЛрд░рд┐рджрдо

## рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ/рд╕рдВрдкреАрдбрд╝рди рдПрд▓реНрдЧреЛрд░рд┐рджрдо

<details>

<summary><strong>AWS рд╣реИрдХрд┐рдВрдЧ рд╕реАрдЦреЗрдВ рд╢реВрдиреНрдп рд╕реЗ рдирд╛рдпрдХ рддрдХ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong> рдХреЗ рд╕рд╛рде!</strong></summary>

HackTricks рдХрд╛ рд╕рдорд░реНрдерди рдХрд░рдиреЗ рдХреЗ рдЕрдиреНрдп рддрд░реАрдХреЗ:

* рдпрджрд┐ рдЖрдк рдЪрд╛рд╣рддреЗ рд╣реИрдВ рдХрд┐ рдЖрдкрдХреА **рдХрдВрдкрдиреА рдХрд╛ рд╡рд┐рдЬреНрдЮрд╛рдкрди HackTricks рдореЗрдВ рджрд┐рдЦрд╛рдИ рджреЗ** рдпрд╛ **HackTricks рдХреЛ PDF рдореЗрдВ рдбрд╛рдЙрдирд▓реЛрдб рдХрд░реЗрдВ** рддреЛ [**рд╕рдмреНрд╕рдХреНрд░рд┐рдкреНрд╢рди рдкреНрд▓рд╛рдиреНрд╕**](https://github.com/sponsors/carlospolop) рджреЗрдЦреЗрдВ!
* [**рдЖрдзрд┐рдХрд╛рд░рд┐рдХ PEASS & HackTricks рд╕реНрд╡реИрдЧ**](https://peass.creator-spring.com) рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family) рдХреА рдЦреЛрдЬ рдХрд░реЗрдВ, рд╣рдорд╛рд░реЗ рд╡рд┐рд╢реЗрд╖ [**NFTs**](https://opensea.io/collection/the-peass-family) рдХрд╛ рд╕рдВрдЧреНрд░рд╣
* ЁЯТм [**Discord рд╕рдореВрд╣**](https://discord.gg/hRep4RUj7f) рдореЗрдВ **рд╢рд╛рдорд┐рд▓ рд╣реЛрдВ** рдпрд╛ [**telegram рд╕рдореВрд╣**](https://t.me/peass) рдпрд╛ **Twitter** ЁЯРж рдкрд░ рдореБрдЭреЗ **рдлреЙрд▓реЛ** рдХрд░реЗрдВ [**@carlospolopm**](https://twitter.com/carlospolopm)**.**
* **рдЕрдкрдиреА рд╣реИрдХрд┐рдВрдЧ рдЯреНрд░рд┐рдХреНрд╕ рд╕рд╛рдЭрд╛ рдХрд░реЗрдВ [**HackTricks**](https://github.com/carlospolop/hacktricks) рдФрд░ [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos рдореЗрдВ PRs рд╕рдмрдорд┐рдЯ рдХрд░рдХреЗ.**

</details>

## рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреА рдкрд╣рдЪрд╛рди

рдпрджрд┐ рдЖрдкрдХреЛ рдХреЛрдб рдореЗрдВ **рд╢рд┐рдлреНрдЯ рд░рд╛рдЗрдЯреНрд╕ рдФрд░ рд▓реЗрдлреНрдЯреНрд╕, xors рдФрд░ рдХрдИ рдЕрдВрдХрдЧрдгрд┐рддреАрдп рдСрдкрд░реЗрд╢рдиреНрд╕** рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП рджреЗрдЦреЗрдВ, рддреЛ рдпрд╣ рд╕рдВрднрд╛рд╡рдирд╛ рд╣реИ рдХрд┐ рдпрд╣ рдПрдХ **рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рдПрд▓реНрдЧреЛрд░рд┐рджрдо** рдХрд╛ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рд╣реИред рдпрд╣рд╛рдБ рдХреБрдЫ рддрд░реАрдХреЗ рджрд┐рдЦрд╛рдП рдЬрд╛рдПрдВрдЧреЗ рдХрд┐ рдХреИрд╕реЗ **рдмрд┐рдирд╛ рдкреНрд░рддреНрдпреЗрдХ рдЪрд░рдг рдХреЛ рдЙрд▓рдЯреЗ рдмрд┐рдирд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛ рд░рд╣реЗ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреА рдкрд╣рдЪрд╛рди рдХреА рдЬрд╛ рд╕рдХрддреА рд╣реИ**ред

### API рдлрдВрдХреНрд╢рдиреНрд╕

**CryptDeriveKey**

рдпрджрд┐ рдпрд╣ рдлрдВрдХреНрд╢рди рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдк рджреВрд╕рд░реЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдорд╛рди рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕рд╛ **рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ**:

![](<../../.gitbook/assets/image (375) (1) (1) (1) (1).png>)

рд╕рдВрднрд╛рд╡рд┐рдд рдПрд▓реНрдЧреЛрд░рд┐рджрдореНрд╕ рдФрд░ рдЙрдирдХреЗ рдЕрд╕рд╛рдЗрди рдХрд┐рдП рдЧрдП рдорд╛рдиреЛрдВ рдХреА рддрд╛рд▓рд┐рдХрд╛ рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ: [https://docs.microsoft.com/en-us/windows/win32/seccrypto/alg-id](https://docs.microsoft.com/en-us/windows/win32/seccrypto/alg-id)

**RtlCompressBuffer/RtlDecompressBuffer**

рдбреЗрдЯрд╛ рдХреЗ рдПрдХ рджрд┐рдП рдЧрдП рдмрдлрд░ рдХреЛ рд╕рдВрдкреАрдбрд╝рд┐рдд рдФрд░ рдбрд┐рдХрдВрдкреНрд░реЗрд╕ рдХрд░рддрд╛ рд╣реИред

**CryptAcquireContext**

**CryptAcquireContext** рдлрдВрдХреНрд╢рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдХреНрд░рд┐рдкреНрдЯреЛрдЧреНрд░рд╛рдлрд┐рдХ рд╕рд░реНрд╡рд┐рд╕ рдкреНрд░реЛрд╡рд╛рдЗрдбрд░ (CSP) рдХреЗ рднреАрддрд░ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдХреА рдХрдВрдЯреЗрдирд░ рдХреЗ рд▓рд┐рдП рдПрдХ рд╣реИрдВрдбрд▓ рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИред **рдпрд╣ рд▓реМрдЯрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИрдВрдбрд▓ CryptoAPI** рдлрдВрдХреНрд╢рдиреНрд╕ рдХреЗ рдХреЙрд▓реНрд╕ рдореЗрдВ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ рдЬреЛ рдЪреБрдиреЗ рдЧрдП CSP рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реИрдВред

**CryptCreateHash**

рдбреЗрдЯрд╛ рдХреЗ рдПрдХ рд╕реНрдЯреНрд░реАрдо рдХреА рд╣реИрд╢рд┐рдВрдЧ рд╢реБрд░реВ рдХрд░рддрд╛ рд╣реИред рдпрджрд┐ рдпрд╣ рдлрдВрдХреНрд╢рди рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ, рддреЛ рдЖрдк рджреВрд╕рд░реЗ рдкреИрд░рд╛рдореАрдЯрд░ рдХреЗ рдорд╛рди рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ рдпрд╣ рдкрддрд╛ рд▓рдЧрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдХреМрди рд╕рд╛ **рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ**:

![](<../../.gitbook/assets/image (376).png>)

\
рд╕рдВрднрд╛рд╡рд┐рдд рдПрд▓реНрдЧреЛрд░рд┐рджрдореНрд╕ рдФрд░ рдЙрдирдХреЗ рдЕрд╕рд╛рдЗрди рдХрд┐рдП рдЧрдП рдорд╛рдиреЛрдВ рдХреА рддрд╛рд▓рд┐рдХрд╛ рдпрд╣рд╛рдБ рджреЗрдЦреЗрдВ: [https://docs.microsoft.com/en-us/windows/win32/seccrypto/alg-id](https://docs.microsoft.com/en-us/windows/win32/seccrypto/alg-id)

### рдХреЛрдб рдХреЙрдиреНрд╕реНрдЯреЗрдВрдЯреНрд╕

рдХрднреА-рдХрднреА рдПрдХ рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреА рдкрд╣рдЪрд╛рди рдХрд░рдирд╛ рдмрд╣реБрдд рдЖрд╕рд╛рди рд╣реЛрддрд╛ рд╣реИ рдХреНрдпреЛрдВрдХрд┐ рдЗрд╕реЗ рдПрдХ рд╡рд┐рд╢реЗрд╖ рдФрд░ рдЕрдиреВрдареЗ рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдирд╛ рдкрдбрд╝рддрд╛ рд╣реИред

![](<../../.gitbook/assets/image (370).png>)

рдпрджрд┐ рдЖрдк Google рдореЗрдВ рдкрд╣рд▓реЗ рдХреЙрдиреНрд╕реНрдЯреЗрдВрдЯ рдХреА рдЦреЛрдЬ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдкрдХреЛ рдпрд╣ рдорд┐рд▓рддрд╛ рд╣реИ:

![](<../../.gitbook/assets/image (371).png>)

рдЗрд╕рд▓рд┐рдП, рдЖрдк рдорд╛рди рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдбрд┐рдХрдВрдкрд╛рдЗрд▓ рдХрд┐рдпрд╛ рдЧрдпрд╛ рдлрдВрдХреНрд╢рди рдПрдХ **sha256 рдХреИрд▓рдХреБрд▓реЗрдЯрд░ рд╣реИред**\
рдЖрдк рдЕрдиреНрдп рдХрд┐рд╕реА рднреА рдХреЙрдиреНрд╕реНрдЯреЗрдВрдЯ рдХреА рдЦреЛрдЬ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдФрд░ рдЖрдкрдХреЛ (рд╢рд╛рдпрдж) рд╡рд╣реА рдкрд░рд┐рдгрд╛рдо рдорд┐рд▓реЗрдЧрд╛ред

### рдбреЗрдЯрд╛ рдЬрд╛рдирдХрд╛рд░реА

рдпрджрд┐ рдХреЛрдб рдореЗрдВ рдХреЛрдИ рдорд╣рддреНрд╡рдкреВрд░реНрдг рдХреЙрдиреНрд╕реНрдЯреЗрдВрдЯ рдирд╣реАрдВ рд╣реИ, рддреЛ рдпрд╣ **.data рд╕реЗрдХреНрд╢рди рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рд▓реЛрдб рдХрд░ рд░рд╣рд╛ рд╣реЛ рд╕рдХрддрд╛ рд╣реИ**ред\
рдЖрдк рдЙрд╕ рдбреЗрдЯрд╛ рддрдХ рдкрд╣реБрдБрдЪ рд╕рдХрддреЗ рд╣реИрдВ, **рдкрд╣рд▓реЗ dword рдХреЛ рд╕рдореВрд╣рд┐рдд рдХрд░реЗрдВ** рдФрд░ рдЗрд╕реЗ Google рдореЗрдВ рдЦреЛрдЬреЗрдВ рдЬреИрд╕рд╛ рдХрд┐ рд╣рдордиреЗ рдкрд╣рд▓реЗ рдЕрдиреБрднрд╛рдЧ рдореЗрдВ рдХрд┐рдпрд╛ рдерд╛:

![](<../../.gitbook/assets/image (372).png>)

рдЗрд╕ рдорд╛рдорд▓реЗ рдореЗрдВ, рдпрджрд┐ рдЖрдк **0xA56363C6** рдХреА рдЦреЛрдЬ рдХрд░рддреЗ рд╣реИрдВ рддреЛ рдЖрдк рдкрд╛ рд╕рдХрддреЗ рд╣реИрдВ рдХрд┐ рдпрд╣ **AES рдПрд▓реНрдЧреЛрд░рд┐рджрдо рдХреА рддрд╛рд▓рд┐рдХрд╛рдУрдВ рд╕реЗ рд╕рдВрдмрдВрдзрд┐рдд рд╣реИ**ред

## RC4 **(рд╕рдордорд┐рдд рдХреНрд░рд┐рдкреНрдЯ)**

### рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ

рдЗрд╕рдореЗрдВ 3 рдореБрдЦреНрдп рднрд╛рдЧ рд╣реЛрддреЗ рд╣реИрдВ:

* **рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЪрд░рдг/**: 0x00 рд╕реЗ 0xFF рддрдХ рдХреЗ **рдорд╛рдиреЛрдВ рдХреА рдПрдХ рддрд╛рд▓рд┐рдХрд╛ рдмрдирд╛рддрд╛ рд╣реИ** (рдХреБрд▓ 256bytes, 0x100)ред рдЗрд╕ рддрд╛рд▓рд┐рдХрд╛ рдХреЛ рдЖрдорддреМрд░ рдкрд░ **рд╕рдмреНрд╕реНрдЯрд┐рдЯреНрдпреВрд╢рди рдмреЙрдХреНрд╕** (рдпрд╛ SBox) рдХрд╣рд╛ рдЬрд╛рддрд╛ рд╣реИред
* **рд╕реНрдХреНрд░реИрдореНрдмрд▓рд┐рдВрдЧ рдЪрд░рдг**: рдЗрд╕рд╕реЗ рдкрд╣рд▓реЗ рдмрдирд╛рдИ рдЧрдИ рддрд╛рд▓рд┐рдХрд╛ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ **рд▓реВрдк рдХрд░реЗрдЧрд╛** (рдлрд┐рд░ рд╕реЗ 0x100 рдЗрдЯрд░реЗрд╢рдиреНрд╕ рдХрд╛ рд▓реВрдк) рдкреНрд░рддреНрдпреЗрдХ рдорд╛рди рдХреЛ **рдЕрд░реНрдз-рд░реИрдВрдбрдо** рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рд╕рдВрд╢реЛрдзрд┐рдд рдХрд░рддреЗ рд╣реБрдПред рдЗрди рдЕрд░реНрдз-рд░реИрдВрдбрдо рдмрд╛рдЗрдЯреНрд╕ рдХреЛ рдмрдирд╛рдиреЗ рдХреЗ рд▓рд┐рдП, RC4 **рдХреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред RC4 **рдХреА** **1 рд╕реЗ 256 рдмрд╛рдЗрдЯреНрд╕ рдХреА рд▓рдВрдмрд╛рдИ рдХреЗ рдмреАрдЪ рд╣реЛ рд╕рдХрддреА рд╣реИ**, рд╣рд╛рд▓рд╛рдВрдХрд┐ рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИ рдХрд┐ рдпрд╣ 5 рдмрд╛рдЗрдЯреНрд╕ рд╕реЗ рдКрдкрд░ рд╣реЛред рдЖрдорддреМрд░ рдкрд░, RC4 рдХреА 16 рдмрд╛рдЗрдЯреНрд╕ рдХреА рд▓рдВрдмрд╛рдИ рдХреА рд╣реЛрддреА рд╣реИред
* **XOR рдЪрд░рдг**: рдЕрдВрдд рдореЗрдВ, рдкреНрд▓реЗрди-рдЯреЗрдХреНрд╕реНрдЯ рдпрд╛ рд╕рд╛рдЗрдлрд░рдЯреЗрдХреНрд╕реНрдЯ рдХреЛ **рдкрд╣рд▓реЗ рдмрдирд╛рдП рдЧрдП рдорд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде XORed рдХрд┐рдпрд╛ рдЬрд╛рддрд╛ рд╣реИ**ред рдПрдиреНрдХреНрд░рд┐рдкреНрдЯ рдФрд░ рдбрд┐рдХреНрд░рд┐рдкреНрдЯ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдлрдВрдХреНрд╢рди рдПрдХ рд╣реА рд╣реИред рдЗрд╕рдХреЗ рд▓рд┐рдП, **рдмрдирд╛рдП рдЧрдП 256 рдмрд╛рдЗрдЯреНрд╕ рдХреЗ рдорд╛рдзреНрдпрдо рд╕реЗ рдПрдХ рд▓реВрдк** рдЬрд┐рддрдиреА рдмрд╛рд░ рдЖрд╡рд╢реНрдпрдХ рд╣реЛ рдЙрддрдиреА рдмрд╛рд░ рдХрд┐рдпрд╛ рдЬрд╛рдПрдЧрд╛ред рдпрд╣ рдЖрдорддреМрд░ рдкрд░ рдПрдХ рдбрд┐рдХрдВрдкрд╛рдЗрд▓ рдХреЛрдб рдореЗрдВ **%256 (mod 256)** рдХреЗ рд╕рд╛рде рдкрд╣рдЪрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред

{% hint style="info" %}
**рдПрдХ RC4 рдХреА рдкрд╣рдЪрд╛рди рдбрд┐рд╕реИрд╕реЗрдВрдмрд▓реА/рдбрд┐рдХрдВрдкрд╛рдЗрд▓ рдХреЛрдб рдореЗрдВ рдЖрдк 2 рд▓реВрдкреНрд╕ рдХреА рдЬрд╛рдВрдЪ рдХрд░рдХреЗ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВ рдЬрд┐рдирдХрд╛ рдЖрдХрд╛рд░ 0x100 рд╣реИ (рдХреА рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рд╕рд╛рде) рдФрд░ рдлрд┐рд░ рдЗрдирдкреБрдЯ рдбреЗрдЯрд╛ рдХреЛ рдкрд╣рд▓реЗ рдХреЗ 2 рд▓реВрдкреНрд╕ рдореЗрдВ рдмрдирд╛рдП рдЧрдП 256 рдорд╛рдиреЛрдВ рдХреЗ рд╕рд╛рде XOR рдХрд░рдирд╛ рд╢рд╛рдпрдж %256 (mod 256) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ**
{% endhint %}

### **рдкреНрд░рд╛рд░рдВрднрд┐рдХ рдЪрд░рдг/рд╕рдмреНрд╕реНрдЯрд┐рдЯреНрдпреВрд╢рди рдмреЙрдХреНрд╕:** (256 рдХреА рд╕рдВрдЦреНрдпрд╛ рдХреЛ рдХрд╛рдЙрдВрдЯрд░ рдХреЗ рд░реВрдк рдореЗрдВ рдФрд░ 256 рдЕрдХреНрд╖рд░реЛрдВ рдХреЗ рдкреНрд░рддреНрдпреЗрдХ рд╕реНрдерд╛рди рдкрд░ рдПрдХ 0 рд▓рд┐рдЦрдиреЗ рдХрд╛ рдзреНрдпрд╛рди рджреЗрдВ)

![](<../../.gitbook/assets/image (377).png>)

### **рд╕реНрдХреНрд░реИрдореНрдмрд▓рд┐рдВрдЧ рдЪрд░рдг:**

![](<../../.gitbook/assets/image (378).png>)

### **XOR рдЪрд░рдг:**

![](<../../.gitbook/assets/image (379).png>)

## **AES (рд╕рдордорд┐рдд рдХреНрд░рд┐рдкреНрдЯ)**

### **рд╡рд┐рд╢реЗрд╖рддрд╛рдПрдБ**

* **рд╕рдмреНрд╕реНрдЯрд┐рдЯреНрдпреВрд╢рди рдмреЙрдХреНрд╕ рдФрд░ рд▓реБрдХрдЕрдк рдЯреЗрдмрд▓реНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ**
* рд╡рд┐рд╢рд┐рд╖реНрдЯ рд▓реБрдХрдЕрдк рдЯреЗрдмрд▓ рдорд╛рдиреЛрдВ (рдХреЙрдиреНрд╕реНрдЯреЗрдВрдЯреНрд╕) рдХреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдХрд╛рд░рдг AES рдХреЛ **рдкрд╣рдЪрд╛рдирдирд╛ рд╕рдВрднрд╡ рд╣реИ**ред _рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ **рдХреЙрдиреНрд╕реНрдЯреЗрдВрдЯ** рдмрд╛рдЗрдирд░реА рдореЗрдВ **рд╕рдВрдЧреНрд░рд╣реАрдд** рд╣реЛ рд╕рдХрддрд╛ рд╣реИ
