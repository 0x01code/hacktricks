<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Trouvez les vuln√©rabilit√©s les plus importantes afin de les corriger plus rapidement. Intruder suit votre surface d'attaque, lance des analyses de menaces proactives, trouve des probl√®mes dans l'ensemble de votre pile technologique, des API aux applications web et aux syst√®mes cloud. [**Essayez-le gratuitement**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) aujourd'hui.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

# G√©n√©rique

## R√©seau

| Sockets bruts | Sockets WinAPI |
| ------------- | -------------- |
| socket()      | WSAStratup()   |
| bind()        | bind()         |
| listen()      | listen()       |
| accept()      | accept()       |
| connect()     | connect()      |
| read()/recv() | recv()         |
| write()       | send()         |
| shutdown()    | WSACleanup()   |

## Persistance

| Registre         | Fichier       | Service                      |
| ---------------- | ------------- | ---------------------------- |
| RegCreateKeyEx() | GetTempPath() | OpenSCManager                |
| RegOpenKeyEx()   | CopyFile()    | CreateService()              |
| RegSetValueEx()  | CreateFile()  | StartServiceCtrlDispatcher() |
| RegDeleteKeyEx() | WriteFile()   |                              |
| RegGetValue()    | ReadFile()    |                              |

## Chiffrement

| Nom                   |
| --------------------- |
| WinCrypt              |
| CryptAcquireContext() |
| CryptGenKey()         |
| CryptDeriveKey()      |
| CryptDecrypt()        |
| CryptReleaseContext() |

## Anti-Analyse/VM

| Nom de la fonction                                        | Instructions d'assemblage |
| --------------------------------------------------------- | ------------------------ |
| IsDebuggerPresent()                                       | CPUID()                 |
| GetSystemInfo()                                           | IN()                    |
| GlobalMemoryStatusEx()                                    |                         |
| GetVersion()                                              |                         |
| CreateToolhelp32Snapshot \[V√©rifier si un processus est en cours d'ex√©cution] |                         |
| CreateFileW/A \[V√©rifier si un fichier existe]            |                         |

## Furtivit√©

| Nom                     |                                                                            |
| ------------------------ | -------------------------------------------------------------------------- |
| VirtualAlloc             | Allouer de la m√©moire (packers)                                           |
| VirtualProtect           | Changer les autorisations de m√©moire (packer donnant l'autorisation d'ex√©cution √† une section) |
| ReadProcessMemory        | Injection dans des processus externes                                    |
| WriteProcessMemoryA/W    | Injection dans des processus externes                                    |
| NtWriteVirtualMemory     |                                                                            |
| CreateRemoteThread       | Injection de DLL/processus...                                           |
| NtUnmapViewOfSection     |                                                                            |
| QueueUserAPC             |                                                                            |
| CreateProcessInternalA/W |                                                                            |

## Ex√©cution

| Nom de la fonction    |
| ---------------- |
| CreateProcessA/W |
| ShellExecute     |
| WinExec          |
| ResumeThread     |
| NtResumeThread   |

## Divers

* GetAsyncKeyState() -- Enregistrement des touches
* SetWindowsHookEx -- Enregistrement des touches
* GetForeGroundWindow -- Obtenir le nom de la fen√™tre en cours d'ex√©cution (ou le site web √† partir d'un navigateur)
* LoadLibrary() -- Importer une biblioth√®que
* GetProcAddress() -- Importer une biblioth√®que
* CreateToolhelp32Snapshot() -- Liste des processus en cours d'ex√©cution
* GetDC() -- Capture d'√©cran
* BitBlt() -- Capture d'√©cran
* InternetOpen(), InternetOpenUrl(), InternetReadFile(), InternetWriteFile() -- Acc√©der √† Internet
* FindResource(), LoadResource(), LockResource() -- Acc√©der aux ressources de l'ex√©cutable

# Techniques de logiciels malveillants

## Injection de DLL

Ex√©cutez une DLL arbitraire √† l'int√©rieur d'un autre processus

1. Localisez le processus pour injecter la DLL malveillante : CreateToolhelp32Snapshot, Process32First, Process32Next
2. Ouvrez le processus : GetModuleHandle, GetProcAddress, OpenProcess
3. √âcrivez le chemin de la DLL √† l'int√©rieur du processus : VirtualAllocEx, WriteProcessMemory
4. Cr√©ez un thread dans le processus qui chargera la DLL malveillante : CreateRemoteThread, LoadLibrary

Autres fonctions √† utiliser : NTCreateThreadEx, RtlCreateUserThread

## Injection de DLL r√©fl√©chie

Chargez une DLL malveillante sans appeler les appels API Windows normaux.\
La DLL est mapp√©e √† l'int√©rieur d'un processus, elle r√©soudra les adresses d'importation, corrigera les relocalisations et appellera la fonction DllMain.

## D√©tournement de thread

Trouvez un thread d'un processus et faites-le charger une DLL malveillante

1. Trouvez un thread cible : CreateToolhelp32Snapshot, Thread32First, Thread32Next
2. Ouvrez le thread : OpenThread
3. Suspendez le thread : SuspendThread
4. √âcrivez le chemin de la DLL malveillante √† l'int√©rieur du processus victime : VirtualAllocEx, WriteProcessMemory
5. Reprenez le thread en chargeant la biblioth√®que : ResumeThread

## Injection PE

Injection d'ex√©cution portable : L'ex√©cutable sera √©crit dans la m√©moire du processus victime et sera ex√©cut√© √† partir de l√†.

## Creusement de processus

Le logiciel malveillant d√©sallouera le code l√©gitime de la m√©moire du processus et chargera un binaire malveillant

1. Cr√©ez un nouveau processus : CreateProcess
2. D√©sallouez la m√©moire : ZwUnmapViewOfSection, NtUnmapViewOfSection
3. √âcrivez le binaire malveillant dans la m√©moire du processus : VirtualAllocEc, WriteProcessMemory
4. D√©finissez le point d'entr√©e et ex√©cutez : SetThreadContext, ResumeThread

# Accrochage

* La **SSDT** (**System Service Descriptor Table**) pointe vers les fonctions du noyau (ntoskrnl.exe) ou du pilote GUI (win32k.sys) afin que les processus utilisateur puissent appeler ces fonctions.
* Un rootkit peut modifier ces pointeurs vers des adresses qu'il contr√¥le
* Les **IRP** (**I/O Request Packets**) transmettent des morceaux de donn√©es d'un composant √† un autre. Presque tout dans le noyau utilise des IRP et chaque objet de p√©riph√©rique a sa propre table de fonctions qui peut √™tre accroch√©e : DKOM (Direct Kernel Object Manipulation)
* L'**IAT** (**Import Address Table**) est utile pour r√©soudre les d√©pendances. Il est possible d'accrocher cette table afin de d√©tourner le code qui sera appel√©.
* Accrochage de l'**EAT** (**Export Address Table**). Ces accrochages peuvent √™tre faits depuis l'**espace utilisateur**. Le but est d'accrocher les fonctions export√©es par les DLL.
* **Accrochages en ligne** : Ce type est difficile √† r√©aliser. Cela implique de modifier le code des fonctions elles-m√™mes. Peut-√™tre en mettant un saut au d√©but de celles-ci.

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Trouvez les vuln√©rabilit√©s les plus importantes afin de les corriger plus rapidement. Intruder suit votre surface d'attaque, lance des analyses de menaces proactives, trouve des probl√®mes dans l'ensemble de votre pile technologique, des API aux applications web et aux syst√®mes cloud. [**Essayez-le gratuitement**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) aujourd'hui.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert en √©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFT**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>
