<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

最も重要な脆弱性を見つけて、より早く修正してください。Intruderは攻撃面を追跡し、積極的な脅威スキャンを実行し、APIからウェブアプリ、クラウドシステムまで、あなたの技術スタック全体にわたる問題を見つけます。今日[**無料で試す**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)。

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***


# 一般的な技術

## ネットワーキング

| Raw Sockets   | WinAPI Sockets |
| ------------- | -------------- |
| socket()      | WSAStratup()   |
| bind()        | bind()         |
| listen()      | listen()       |
| accept()      | accept()       |
| connect()     | connect()      |
| read()/recv() | recv()         |
| write()       | send()         |
| shutdown()    | WSACleanup()   |

## 永続性

| Registry         | File          | Service                      |
| ---------------- | ------------- | ---------------------------- |
| RegCreateKeyEx() | GetTempPath() | OpenSCManager                |
| RegOpenKeyEx()   | CopyFile()    | CreateService()              |
| RegSetValueEx()  | CreateFile()  | StartServiceCtrlDispatcher() |
| RegDeleteKeyEx() | WriteFile()   |                              |
| RegGetValue()    | ReadFile()    |                              |

## 暗号化

| Name                  |
| --------------------- |
| WinCrypt              |
| CryptAcquireContext() |
| CryptGenKey()         |
| CryptDeriveKey()      |
| CryptDecrypt()        |
| CryptReleaseContext() |

## アンチアナリシス/VM

| Function Name                                             | Assembly Instructions |
| --------------------------------------------------------- | --------------------- |
| IsDebuggerPresent()                                       | CPUID()               |
| GetSystemInfo()                                           | IN()                  |
| GlobalMemoryStatusEx()                                    |                       |
| GetVersion()                                              |                       |
| CreateToolhelp32Snapshot \[プロセスが実行中かチェック] |                       |
| CreateFileW/A \[ファイルが存在するかチェック]            |                       |

## ステルス

| Name                     |                                                                            |
| ------------------------ | -------------------------------------------------------------------------- |
| VirtualAlloc             | メモリを割り当てる（パッカー）                                            |
| VirtualProtect           | メモリの権限を変更する（セクションに実行権限を与えるパッカー）          |
| ReadProcessMemory        | 外部プロセスへのインジェクション                                          |
| WriteProcessMemoryA/W    | 外部プロセスへのインジェクション                                          |
| NtWriteVirtualMemory     |                                                                            |
| CreateRemoteThread       | DLL/プロセスインジェクション...                                            |
| NtUnmapViewOfSection     |                                                                            |
| QueueUserAPC             |                                                                            |
| CreateProcessInternalA/W |                                                                            |

## 実行

| Function Name    |
| ---------------- |
| CreateProcessA/W |
| ShellExecute     |
| WinExec          |
| ResumeThread     |
| NtResumeThread   |

## その他

* GetAsyncKeyState() -- キーロギング
* SetWindowsHookEx -- キーロギング
* GetForeGroundWindow -- 実行中のウィンドウ名を取得する（またはブラウザからのウェブサイト）
* LoadLibrary() -- ライブラリをインポートする
* GetProcAddress() -- ライブラリをインポートする
* CreateToolhelp32Snapshot() -- 実行中のプロセスをリストする
* GetDC() -- スクリーンショット
* BitBlt() -- スクリーンショット
* InternetOpen(), InternetOpenUrl(), InternetReadFile(), InternetWriteFile() -- インターネットにアクセスする
* FindResource(), LoadResource(), LockResource() -- 実行可能ファイルのリソースにアクセスする

# マルウェア技術

## DLLインジェクション

別のプロセス内で任意のDLLを実行する

1. 悪意のあるDLLをインジェクトするプロセスを特定する: CreateToolhelp32Snapshot, Process32First, Process32Next
2. プロセスを開く: GetModuleHandle, GetProcAddress, OpenProcess
3. プロセス内にDLLへのパスを書き込む: VirtualAllocEx, WriteProcessMemory
4. 悪意のあるDLLをロードするスレッドをプロセス内に作成する: CreateRemoteThread, LoadLibrary

他の使用する関数: NTCreateThreadEx, RtlCreateUserThread

## リフレクティブDLLインジェクション

通常のWindows APIコールを呼び出さずに悪意のあるDLLをロードする。\
DLLはプロセス内にマップされ、インポートアドレスを解決し、リロケーションを修正し、DllMain関数を呼び出す。

## スレッドハイジャック

プロセスからスレッドを見つけ、それに悪意のあるDLLをロードさせる

1. ターゲットスレッドを見つける: CreateToolhelp32Snapshot, Thread32First, Thread32Next
2. スレッドを開く: OpenThread
3. スレッドを一時停止する: SuspendThread
4. 被害者プロセス内に悪意のあるDLLへのパスを書き込む: VirtualAllocEx, WriteProcessMemory
5. ライブラリをロードしてスレッドを再開する: ResumeThread

## PEインジェクション

Portable Execution Injection: 実行可能ファイルは被害者プロセスのメモリに書き込まれ、そこから実行される。

## プロセスホローイング

マルウェアはプロセスのメモリから合法的なコードをアンマップし、悪意のあるバイナリをロードする

1. 新しいプロセスを作成する: CreateProcess
2. メモリをアンマップする: ZwUnmapViewOfSection, NtUnmapViewOfSection
3. プロセスメモリに悪意のあるバイナリを書き込む: VirtualAllocEc, WriteProcessMemory
4. エントリポイントを設定し、実行する: SetThreadContext, ResumeThread

# フッキング

* **SSDT**（**System Service Descriptor Table**）は、ユーザープロセスがこれらの関数を呼び出せるように、カーネル関数（ntoskrnl.exe）またはGUIドライバー（win32k.sys）を指す。
* ルートキットはこれらのポインタを自分が制御するアドレスに変更することがある。
* **IRP**（**I/O Request Packets**）は、コンポーネント間でデータの断片を伝達する。カーネルのほとんどすべてがIRPを使用し、各デバイスオブジェクトにはフック可能な独自の関数テーブルがある：DKOM（Direct Kernel Object Manipulation）
* **IAT**（**Import Address Table**）は依存関係を解決するのに役立つ。このテーブルをフックして、呼び出されるコードをハイジャックすることが可能。
* **EAT**（**Export Address Table**）フック。このフックは**ユーザーランド**から行うことができる。目的は、DLLによってエクスポートされた関数をフックすること。
* **インラインフック**：このタイプは難しい。これには、関数自体のコードを変更することが含まれる。たとえば、これの始めにジャンプを置くことによって。

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

最も重要な脆弱性を見つけて、より早く修正してください。Intruderは攻撃面を追跡し、積極的な脅威スキャンを実行し、APIからウェブアプリ、クラウドシステムまで、あなたの技術スタック全体にわたる問題を見つけます。今日[**無料で試す**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks)。

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

<details>

<summary><strong>AWSハッキングをゼロからヒーローまで学ぶ</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>！</strong></summary>

HackTricksをサポートする他の方法:

* **HackTricksにあなたの会社を広告したい**、または**HackTricksをPDFでダウンロードしたい**場合は、[**サブスクリプションプラン**](https://github.com/sponsors/carlospolop)をチェックしてください。
* [**公式PEASS & HackTricksグッズ**](https://peass.creator-spring.com)を入手する
* [**The PEASS Family**](https://opensea.io/collection/the-peass-family)を発見する、私たちの独占的な[**NFTs**](https://opensea.io/collection/the-peass-family)のコレクション
* 💬 [**Discordグループ**](https://discord.gg/hRep4RUj7f)に**参加する**か、[**telegramグループ**](https://t.me/peass)に参加するか、**Twitter** 🐦 [**@carlospolopm**](https://twitter.com/carlospolopm)を**フォローする**。
* [**HackTricks**](https://github.com/carlospolop/hacktricks)と[**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud)のgithubリポジトリにPRを提出して、あなたのハッキングのコツを**共有する**。

</details>
