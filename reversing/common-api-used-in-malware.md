<details>

<summary><strong>Lernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks bewerben m√∂chten** oder **HackTricks als PDF herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories senden.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Finden Sie die wichtigsten Sicherheitsl√ºcken, damit Sie sie schneller beheben k√∂nnen. Intruder verfolgt Ihre Angriffsfl√§che, f√ºhrt proaktive Bedrohungsscans durch und findet Probleme in Ihrer gesamten Technologie-Stack, von APIs √ºber Webanwendungen bis hin zu Cloud-Systemen. [**Probieren Sie es noch heute kostenlos aus**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks).

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***


# Allgemein

## Netzwerk

| Raw Sockets   | WinAPI Sockets |
| ------------- | -------------- |
| socket()      | WSAStratup()   |
| bind()        | bind()         |
| listen()      | listen()       |
| accept()      | accept()       |
| connect()     | connect()      |
| read()/recv() | recv()         |
| write()       | send()         |
| shutdown()    | WSACleanup()   |

## Persistenz

| Registry         | Datei         | Dienst                       |
| ---------------- | ------------- | ---------------------------- |
| RegCreateKeyEx() | GetTempPath() | OpenSCManager                |
| RegOpenKeyEx()   | CopyFile()    | CreateService()              |
| RegSetValueEx()  | CreateFile()  | StartServiceCtrlDispatcher() |
| RegDeleteKeyEx() | WriteFile()   |                              |
| RegGetValue()    | ReadFile()    |                              |

## Verschl√ºsselung

| Name                  |
| --------------------- |
| WinCrypt              |
| CryptAcquireContext() |
| CryptGenKey()         |
| CryptDeriveKey()      |
| CryptDecrypt()        |
| CryptReleaseContext() |

## Anti-Analyse/VM

| Funktionsname                                            | Assembly-Anweisungen |
| -------------------------------------------------------- | -------------------- |
| IsDebuggerPresent()                                      | CPUID()              |
| GetSystemInfo()                                          | IN()                 |
| GlobalMemoryStatusEx()                                   |                      |
| GetVersion()                                             |                      |
| CreateToolhelp32Snapshot \[√úberpr√ºfen, ob ein Prozess l√§uft] |                      |
| CreateFileW/A \[√úberpr√ºfen, ob eine Datei existiert]      |                      |

## Stealth

| Name                     |                                                                            |
| ------------------------ | -------------------------------------------------------------------------- |
| VirtualAlloc             | Speicher zuweisen (Packer)                                                 |
| VirtualProtect           | Berechtigungen f√ºr Speicher √§ndern (Packer, der einer Sektion Ausf√ºhrungsberechtigung gibt) |
| ReadProcessMemory        | Injektion in externe Prozesse                                             |
| WriteProcessMemoryA/W    | Injektion in externe Prozesse                                             |
| NtWriteVirtualMemory     |                                                                            |
| CreateRemoteThread       | DLL-/Prozessinjektion...                                                   |
| NtUnmapViewOfSection     |                                                                            |
| QueueUserAPC             |                                                                            |
| CreateProcessInternalA/W |                                                                            |

## Ausf√ºhrung

| Funktionsname    |
| ---------------- |
| CreateProcessA/W |
| ShellExecute     |
| WinExec          |
| ResumeThread     |
| NtResumeThread   |

## Sonstiges

* GetAsyncKeyState() -- Tastenprotokollierung
* SetWindowsHookEx -- Tastenprotokollierung
* GetForeGroundWindow -- Namen des aktiven Fensters abrufen (oder die Website eines Browsers)
* LoadLibrary() -- Bibliothek importieren
* GetProcAddress() -- Bibliothek importieren
* CreateToolhelp32Snapshot() -- Liste der laufenden Prozesse
* GetDC() -- Bildschirmfoto
* BitBlt() -- Bildschirmfoto
* InternetOpen(), InternetOpenUrl(), InternetReadFile(), InternetWriteFile() -- Zugriff auf das Internet
* FindResource(), LoadResource(), LockResource() -- Zugriff auf Ressourcen der ausf√ºhrbaren Datei

# Malware-Techniken

## DLL-Injektion

F√ºhren Sie eine beliebige DLL in einem anderen Prozess aus

1. Finden Sie den Prozess, in den die sch√§dliche DLL injiziert werden soll: CreateToolhelp32Snapshot, Process32First, Process32Next
2. √ñffnen Sie den Prozess: GetModuleHandle, GetProcAddress, OpenProcess
3. Schreiben Sie den Pfad zur DLL in den Prozess: VirtualAllocEx, WriteProcessMemory
4. Erstellen Sie einen Thread im Prozess, der die sch√§dliche DLL l√§dt: CreateRemoteThread, LoadLibrary

Andere zu verwendende Funktionen: NTCreateThreadEx, RtlCreateUserThread

## Reflektierende DLL-Injektion

Laden Sie eine sch√§dliche DLL, ohne normale Windows-API-Aufrufe zu t√§tigen.\
Die DLL wird in einem Prozess abgebildet, sie l√∂st die Importadressen auf, behebt die Relokationen und ruft die DllMain-Funktion auf.

## Thread-Hijacking

Finden Sie einen Thread in einem Prozess und lassen Sie ihn eine sch√§dliche DLL laden

1. Finden Sie einen Zielthread: CreateToolhelp32Snapshot, Thread32First, Thread32Next
2. √ñffnen Sie den Thread: OpenThread
3. Unterbrechen Sie den Thread: SuspendThread
4. Schreiben Sie den Pfad zur sch√§dlichen DLL in den Opferprozess: VirtualAllocEx, WriteProcessMemory
5. Setzen Sie den Thread fort und laden Sie die Bibliothek: ResumeThread

## PE-Injektion

Portable Execution Injection: Die ausf√ºhrbare Datei wird im Speicher des Opferprozesses geschrieben und von dort aus ausgef√ºhrt.

## Process Hollowing

Die Malware entl√§dt den legitimen Code aus dem Speicher des Prozesses und l√§dt eine sch√§dliche Bin√§rdatei

1. Erstellen Sie einen neuen Prozess: CreateProcess
2. Entladen Sie den Speicher: ZwUnmapViewOfSection, NtUnmapViewOfSection
3. Schreiben Sie die sch√§dliche Bin√§rdatei in den Prozessspeicher: VirtualAllocEc, WriteProcessMemory
4. Setzen Sie den Einstiegspunkt und f√ºhren Sie aus: SetThreadContext, ResumeThread

# Hooking

* Die **SSDT** (**System Service Descriptor Table**) zeigt auf Kernel-Funktionen (ntoskrnl.exe) oder GUI-Treiber (win32k.sys), damit Benutzerprozesse diese Funktionen aufrufen k√∂nnen.
* Ein Rootkit kann diese Zeiger auf Adressen √§ndern, die er kontrolliert.
* **IRP** (**I/O Request Packets**) √ºbertragen Datenst√ºcke von einer Komponente zur anderen. Fast alles im Kernel verwendet IRPs, und jedes Ger√§teobjekt hat seine eigene Funktionstabelle, die gehookt werden kann:
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) **bei** oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs zu den** [**HackTricks**](https://github.com/carlospolop/hacktricks) **und** [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) **GitHub-Repositories einreichen.**

</details>
