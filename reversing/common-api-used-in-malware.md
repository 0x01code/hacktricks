<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Voc√™ trabalha em uma **empresa de seguran√ßa cibern√©tica**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? ou voc√™ quer ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Verifique os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe seus truques de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [reposit√≥rio hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Encontre vulnerabilidades que s√£o mais importantes para que voc√™ possa corrigi-las mais rapidamente. O Intruder rastreia sua superf√≠cie de ataque, executa varreduras proativas de amea√ßas, encontra problemas em toda a sua pilha de tecnologia, desde APIs at√© aplicativos da web e sistemas em nuvem. [**Experimente gratuitamente**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) hoje.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***

# Gen√©rico

## Rede

| Raw Sockets   | WinAPI Sockets |
| ------------- | -------------- |
| socket()      | WSAStratup()   |
| bind()        | bind()         |
| listen()      | listen()       |
| accept()      | accept()       |
| connect()     | connect()      |
| read()/recv() | recv()         |
| write()       | send()         |
| shutdown()    | WSACleanup()   |

## Persist√™ncia

| Registro           | Arquivo       | Servi√ßo                      |
| ------------------ | ------------- | ---------------------------- |
| RegCreateKeyEx()   | GetTempPath() | OpenSCManager                |
| RegOpenKeyEx()     | CopyFile()    | CreateService()              |
| RegSetValueEx()    | CreateFile()  | StartServiceCtrlDispatcher() |
| RegDeleteKeyEx()   | WriteFile()   |                              |
| RegGetValue()      | ReadFile()    |                              |

## Criptografia

| Nome                  |
| --------------------- |
| WinCrypt              |
| CryptAcquireContext() |
| CryptGenKey()         |
| CryptDeriveKey()      |
| CryptDecrypt()        |
| CryptReleaseContext() |

## Anti-An√°lise/VM

| Nome da Fun√ß√£o                                           | Instru√ß√µes de Assembly |
| -------------------------------------------------------- | --------------------- |
| IsDebuggerPresent()                                      | CPUID()               |
| GetSystemInfo()                                          | IN()                  |
| GlobalMemoryStatusEx()                                   |                       |
| GetVersion()                                             |                       |
| CreateToolhelp32Snapshot \[Verificar se um processo est√° em execu√ß√£o] |                       |
| CreateFileW/A \[Verificar se um arquivo existe]           |                       |

## Furtividade

| Nome                     |                                                                            |
| ------------------------ | -------------------------------------------------------------------------- |
| VirtualAlloc             | Alocar mem√≥ria (empacotadores)                                              |
| VirtualProtect           | Alterar permiss√£o de mem√≥ria (empacotador dando permiss√£o de execu√ß√£o a uma se√ß√£o) |
| ReadProcessMemory        | Inje√ß√£o em processos externos                                          |
| WriteProcessMemoryA/W    | Inje√ß√£o em processos externos                                          |
| NtWriteVirtualMemory     |                                                                            |
| CreateRemoteThread       | Inje√ß√£o de DLL/Processo...                                                   |
| NtUnmapViewOfSection     |                                                                            |
| QueueUserAPC             |                                                                            |
| CreateProcessInternalA/W |                                                                            |

## Execu√ß√£o

| Nome da Fun√ß√£o    |
| ---------------- |
| CreateProcessA/W |
| ShellExecute     |
| WinExec          |
| ResumeThread     |
| NtResumeThread   |

## Diversos

* GetAsyncKeyState() -- Registro de teclas
* SetWindowsHookEx -- Registro de teclas
* GetForeGroundWindow -- Obter nome da janela em execu√ß√£o (ou o site de um navegador)
* LoadLibrary() -- Importar biblioteca
* GetProcAddress() -- Importar biblioteca
* CreateToolhelp32Snapshot() -- Listar processos em execu√ß√£o
* GetDC() -- Captura de tela
* BitBlt() -- Captura de tela
* InternetOpen(), InternetOpenUrl(), InternetReadFile(), InternetWriteFile() -- Acessar a Internet
* FindResource(), LoadResource(), LockResource() -- Acessar recursos do execut√°vel

# T√©cnicas de Malware

## Inje√ß√£o de DLL

Execute uma DLL arbitr√°ria dentro de outro processo

1. Localize o processo para injetar a DLL maliciosa: CreateToolhelp32Snapshot, Process32First, Process32Next
2. Abra o processo: GetModuleHandle, GetProcAddress, OpenProcess
3. Escreva o caminho para a DLL dentro do processo: VirtualAllocEx, WriteProcessMemory
4. Crie uma thread no processo que carregar√° a DLL maliciosa: CreateRemoteThread, LoadLibrary

Outras fun√ß√µes a serem usadas: NTCreateThreadEx, RtlCreateUserThread

## Inje√ß√£o de DLL Reflexiva

Carregue uma DLL maliciosa sem chamar as chamadas normais da API do Windows.\
A DLL √© mapeada dentro de um processo, ela resolver√° os endere√ßos de importa√ß√£o, corrigir√° as realoca√ß√µes e chamar√° a fun√ß√£o DllMain.
## Sequestro de Thread

Encontre uma thread de um processo e fa√ßa com que ela carregue uma DLL maliciosa

1. Encontre a thread alvo: CreateToolhelp32Snapshot, Thread32First, Thread32Next
2. Abra a thread: OpenThread
3. Suspenda a thread: SuspendThread
4. Escreva o caminho para a DLL maliciosa dentro do processo v√≠tima: VirtualAllocEx, WriteProcessMemory
5. Retome a thread carregando a biblioteca: ResumeThread

## Inje√ß√£o PE

Inje√ß√£o de Execu√ß√£o Port√°til: O execut√°vel ser√° escrito na mem√≥ria do processo v√≠tima e ser√° executado a partir de l√°.

## Process Hollowing

O malware desmapear√° o c√≥digo leg√≠timo da mem√≥ria do processo e carregar√° um bin√°rio malicioso

1. Crie um novo processo: CreateProcess
2. Desmapeie a mem√≥ria: ZwUnmapViewOfSection, NtUnmapViewOfSection
3. Escreva o bin√°rio malicioso na mem√≥ria do processo: VirtualAllocEx, WriteProcessMemory
4. Defina o ponto de entrada e execute: SetThreadContext, ResumeThread

# Hooking

* A **SSDT** (**System Service Descriptor Table**) aponta para fun√ß√µes do kernel (ntoskrnl.exe) ou driver GUI (win32k.sys) para que os processos do usu√°rio possam chamar essas fun√ß√µes.
* Um rootkit pode modificar esses ponteiros para endere√ßos que ele controla.
* **IRP** (**I/O Request Packets**) transmitem peda√ßos de dados de um componente para outro. Quase tudo no kernel usa IRPs e cada objeto de dispositivo tem sua pr√≥pria tabela de fun√ß√µes que pode ser hookada: DKOM (Direct Kernel Object Manipulation)
* A **IAT** (**Import Address Table**) √© √∫til para resolver depend√™ncias. √â poss√≠vel hookar essa tabela para sequestrar o c√≥digo que ser√° chamado.
* Hooks de **EAT** (**Export Address Table**). Esses hooks podem ser feitos a partir do **userland**. O objetivo √© hookar fun√ß√µes exportadas por DLLs.
* **Inline Hooks**: Esse tipo √© dif√≠cil de alcan√ßar. Isso envolve modificar o c√≥digo das pr√≥prias fun√ß√µes. Talvez colocando um salto no in√≠cio disso.

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Encontre vulnerabilidades que s√£o mais importantes para que voc√™ possa corrigi-las mais rapidamente. O Intruder rastreia sua superf√≠cie de ataque, executa varreduras proativas de amea√ßas, encontra problemas em toda a sua pilha de tecnologia, desde APIs at√© aplicativos da web e sistemas em nuvem. [**Experimente gratuitamente**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) hoje mesmo.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Voc√™ quer ver sua **empresa anunciada no HackTricks**? Ou voc√™ quer ter acesso √† **vers√£o mais recente do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!

- Descubra [**The PEASS Family**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)

- Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)

- **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live)**.**

- **Compartilhe seus truques de hacking enviando PRs para o [reposit√≥rio hacktricks](https://github.com/carlospolop/hacktricks) e [hacktricks-cloud repo](https://github.com/carlospolop/hacktricks-cloud)**.

</details>
