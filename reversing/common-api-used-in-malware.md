<details>

<summary><a href="https://cloud.hacktricks.xyz/pentesting-cloud/pentesting-cloud-methodology"><strong>‚òÅÔ∏è HackTricks Cloud ‚òÅÔ∏è</strong></a> -<a href="https://twitter.com/hacktricks_live"><strong>üê¶ Twitter üê¶</strong></a> - <a href="https://www.twitch.tv/hacktricks_live/schedule"><strong>üéôÔ∏è Twitch üéôÔ∏è</strong></a> - <a href="https://www.youtube.com/@hacktricks_LIVE"><strong>üé• Youtube üé•</strong></a></summary>

- Travaillez-vous dans une entreprise de cybers√©curit√© ? Voulez-vous voir votre entreprise annonc√©e dans HackTricks ? ou voulez-vous avoir acc√®s √† la derni√®re version de PEASS ou t√©l√©charger HackTricks en PDF ? Consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !

- D√©couvrez [**The PEASS Family**](https://opensea.io/collection/the-peass-family), notre collection d'[**NFTs**](https://opensea.io/collection/the-peass-family) exclusifs.

- Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com).

- **Rejoignez** le [**üí¨**](https://emojipedia.org/speech-balloon/) **groupe Discord** ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-moi** sur **Twitter** [**üê¶**](https://github.com/carlospolop/hacktricks/tree/7af18b62b3bdc423e11444677a6a73d4043511e9/\[https:/emojipedia.org/bird/README.md)[**@carlospolopm**](https://twitter.com/hacktricks_live).

- **Partagez vos astuces de piratage en soumettant des PR au [d√©p√¥t hacktricks](https://github.com/carlospolop/hacktricks) et au [d√©p√¥t hacktricks-cloud](https://github.com/carlospolop/hacktricks-cloud)**.

</details>


# G√©n√©rique

## R√©seau

| Sockets bruts | Sockets WinAPI |
| ------------- | -------------- |
| socket()      | WSAStratup()   |
| bind()        | bind()         |
| listen()      | listen()       |
| accept()      | accept()       |
| connect()     | connect()      |
| read()/recv() | recv()         |
| write()       | send()         |
| shutdown()    | WSACleanup()   |

## Persistance

| Registre           | Fichier        | Service                      |
| ------------------ | -------------- | ---------------------------- |
| RegCreateKeyEx()   | GetTempPath()  | OpenSCManager                |
| RegOpenKeyEx()     | CopyFile()     | CreateService()              |
| RegSetValueEx()    | CreateFile()   | StartServiceCtrlDispatcher() |
| RegDeleteKeyEx()   | WriteFile()    |                              |
| RegGetValue()      | ReadFile()     |                              |

## Cryptage

| Nom                   |
| --------------------- |
| WinCrypt              |
| CryptAcquireContext() |
| CryptGenKey()         |
| CryptDeriveKey()      |
| CryptDecrypt()        |
| CryptReleaseContext() |

## Anti-Analyse/VM

| Nom de la fonction                                        | Instructions d'assemblage |
| --------------------------------------------------------- | ------------------------ |
| IsDebuggerPresent()                                       | CPUID()                  |
| GetSystemInfo()                                           | IN()                     |
| GlobalMemoryStatusEx()                                    |                          |
| GetVersion()                                              |                          |
| CreateToolhelp32Snapshot \[V√©rifier si un processus est en cours d'ex√©cution] |                          |
| CreateFileW/A \[V√©rifier si un fichier existe]                    |                          |

## Furtivit√©

| Nom                     |                                                                            |
| ------------------------ | -------------------------------------------------------------------------- |
| VirtualAlloc             | Allouer de la m√©moire (packers)                                                     |
| VirtualProtect           | Modifier les autorisations de la m√©moire (packer donnant l'autorisation d'ex√©cution √† une section) |
| ReadProcessMemory        | Injection dans des processus externes                                          |
| WriteProcessMemoryA/W    | Injection dans des processus externes                                          |
| NtWriteVirtualMemory     |                                                                            |
| CreateRemoteThread       | Injection de DLL/processus...                                                   |
| NtUnmapViewOfSection     |                                                                            |
| QueueUserAPC             |                                                                            |
| CreateProcessInternalA/W |                                                                            |

## Ex√©cution

| Nom de la fonction    |
| ---------------- |
| CreateProcessA/W |
| ShellExecute     |
| WinExec          |
| ResumeThread     |
| NtResumeThread   |

## Divers

* GetAsyncKeyState() -- Enregistrement des touches
* SetWindowsHookEx -- Enregistrement des touches
* GetForeGroundWindow -- Obtenir le nom de la fen√™tre en cours d'ex√©cution (ou le site web d'un navigateur)
* LoadLibrary() -- Importer une biblioth√®que
* GetProcAddress() -- Importer une biblioth√®que
* CreateToolhelp32Snapshot() -- Liste des processus en cours d'ex√©cution
* GetDC() -- Capture d'√©cran
* BitBlt() -- Capture d'√©cran
* InternetOpen(), InternetOpenUrl(), InternetReadFile(), InternetWriteFile() -- Acc√®s √† Internet
* FindResource(), LoadResource(), LockResource() -- Acc√©der aux ressources de l'ex√©cutable

# Techniques de malware

## Injection de DLL

Ex√©cuter une DLL arbitraire √† l'int√©rieur d'un autre processus

1. Localiser le processus pour injecter la DLL malveillante : CreateToolhelp32Snapshot, Process32First, Process32Next
2. Ouvrir le processus : GetModuleHandle, GetProcAddress, OpenProcess
3. √âcrire le chemin de la DLL √† l'int√©rieur du processus : VirtualAllocEx, WriteProcessMemory
4. Cr√©er un thread dans le processus qui chargera la DLL malveillante : CreateRemoteThread, LoadLibrary

Autres fonctions √† utiliser : NTCreateThreadEx, RtlCreateUserThread

## Injection de DLL r√©fl√©chie

Charger une DLL malveillante sans appeler les appels API Windows normaux.\
La DLL est mapp√©e √† l'int√©rieur d'un processus, elle r√©soudra les adresses d'importation, corrigera les relocalisations et appellera la fonction DllMain.

## D√©tournement de thread

Trouver un thread d'un processus et le faire charger une DLL malveillante

1. Trouver un thread cible : CreateToolhelp32Snapshot, Thread32First, Thread32Next
2. Ouvrir le thread : OpenThread
3. Suspendre le thread : SuspendThread
4. √âcrire le chemin de la DLL malveillante √† l'int√©rieur du processus victime : VirtualAllocEx, WriteProcessMemory
5. Reprendre le thread en chargeant la biblioth√®que : ResumeThread

## Injection PE

Injection d'ex√©cution portable : L'ex√©cutable sera √©crit dans la m√©moire du processus victime et sera ex√©cut√© √† partir de l√†.

## Creusement de processus

Le malware va d√©sallouer le code l√©gitime de la m√©moire du processus et charger un binaire malveillant

1. Cr√©er un nouveau processus : CreateProcess
2. D√©sallouer la m√©moire : ZwUnmapViewOfSection, N
