<details>

<summary><strong>Impara l'hacking di AWS da zero a eroe con</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Altri modi per supportare HackTricks:

* Se vuoi vedere la tua **azienda pubblicizzata su HackTricks** o **scaricare HackTricks in PDF** Controlla i [**PACCHETTI DI ABBONAMENTO**](https://github.com/sponsors/carlospolop)!
* Ottieni il [**merchandising ufficiale di PEASS & HackTricks**](https://peass.creator-spring.com)
* Scopri [**The PEASS Family**](https://opensea.io/collection/the-peass-family), la nostra collezione di [**NFT**](https://opensea.io/collection/the-peass-family) esclusivi
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository di** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) su GitHub.

</details>

<figure><img src="/.gitbook/assets/image (675).png" alt=""><figcaption></figcaption></figure>

Trova le vulnerabilit√† pi√π importanti in modo da poterle correggere pi√π velocemente. Intruder traccia la tua superficie di attacco, esegue scansioni proattive delle minacce, trova problemi in tutta la tua infrastruttura tecnologica, dalle API alle applicazioni web e ai sistemi cloud. [**Provalo gratuitamente**](https://www.intruder.io/?utm\_source=referral\&utm\_campaign=hacktricks) oggi.

{% embed url="https://www.intruder.io/?utm_campaign=hacktricks&utm_source=referral" %}

***


# Generico

## Networking

| Raw Sockets   | WinAPI Sockets |
| ------------- | -------------- |
| socket()      | WSAStratup()   |
| bind()        | bind()         |
| listen()      | listen()       |
| accept()      | accept()       |
| connect()     | connect()      |
| read()/recv() | recv()         |
| write()       | send()         |
| shutdown()    | WSACleanup()   |

## Persistenza

| Registro         | File          | Servizio                     |
| ---------------- | ------------- | ---------------------------- |
| RegCreateKeyEx() | GetTempPath() | OpenSCManager                |
| RegOpenKeyEx()   | CopyFile()    | CreateService()              |
| RegSetValueEx()  | CreateFile()  | StartServiceCtrlDispatcher() |
| RegDeleteKeyEx() | WriteFile()   |                              |
| RegGetValue()    | ReadFile()    |                              |

## Crittografia

| Nome                  |
| --------------------- |
| WinCrypt              |
| CryptAcquireContext() |
| CryptGenKey()         |
| CryptDeriveKey()      |
| CryptDecrypt()        |
| CryptReleaseContext() |

## Anti-Analisi/VM

| Nome Funzione                                             | Istruzioni Assembly |
| --------------------------------------------------------- | ------------------- |
| IsDebuggerPresent()                                       | CPUID()             |
| GetSystemInfo()                                           | IN()                |
| GlobalMemoryStatusEx()                                    |                     |
| GetVersion()                                              |                     |
| CreateToolhelp32Snapshot \[Verifica se un processo √® in esecuzione] |                     |
| CreateFileW/A \[Verifica se un file esiste]                    |                     |

## Stealth

| Nome                     |                                                                            |
| ------------------------ | -------------------------------------------------------------------------- |
| VirtualAlloc             | Alloca memoria (packer)                                                     |
| VirtualProtect           | Cambia le autorizzazioni della memoria (packer che d√† autorizzazioni di esecuzione a una sezione) |
| ReadProcessMemory        | Iniezione in processi esterni                                          |
| WriteProcessMemoryA/W    | Iniezione in processi esterni                                          |
| NtWriteVirtualMemory     |                                                                            |
| CreateRemoteThread       | Iniezione DLL/processo...                                                   |
| NtUnmapViewOfSection     |                                                                            |
| QueueUserAPC             |                                                                            |
| CreateProcessInternalA/W |                                                                            |

## Esecuzione

| Nome Funzione    |
| ---------------- |
| CreateProcessA/W |
| ShellExecute     |
| WinExec          |
| ResumeThread     |
| NtResumeThread   |

## Varie

* GetAsyncKeyState() -- Key logging
* SetWindowsHookEx -- Key logging
* GetForeGroundWindow -- Ottieni il nome della finestra in esecuzione (o il sito web da un browser)
* LoadLibrary() -- Importa una libreria
* GetProcAddress() -- Importa una libreria
* CreateToolhelp32Snapshot() -- Elenco dei processi in esecuzione
* GetDC() -- Screenshot
* BitBlt() -- Screenshot
* InternetOpen(), InternetOpenUrl(), InternetReadFile(), InternetWriteFile() -- Accesso a Internet
* FindResource(), LoadResource(), LockResource() -- Accesso alle risorse dell'eseguibile

# Tecniche di Malware

## Iniezione DLL

Esegue una DLL arbitraria all'interno di un altro processo

1. Trova il processo in cui iniettare la DLL malevola: CreateToolhelp32Snapshot, Process32First, Process32Next
2. Apri il processo: GetModuleHandle, GetProcAddress, OpenProcess
3. Scrivi il percorso della DLL all'interno del processo: VirtualAllocEx, WriteProcessMemory
4. Crea un thread nel processo che caricher√† la DLL malevola: CreateRemoteThread, LoadLibrary

Altre funzioni da utilizzare: NTCreateThreadEx, RtlCreateUserThread

## Iniezione DLL Riflessiva

Carica una DLL malevola senza chiamare le normali chiamate alle API di Windows.\
La DLL viene mappata all'interno di un processo, risolver√† gli indirizzi di importazione, corregger√† le rilocazioni e chiamer√† la funzione DllMain.

## Hijacking del Thread

Trova un thread di un processo e fai in modo che carichi una DLL malevola

1. Trova un thread di destinazione: CreateToolhelp32Snapshot, Thread32First, Thread32Next
2. Apri il thread: OpenThread
3. Sospendi il thread: SuspendThread
4. Scrivi il percorso della DLL malevola all'interno del processo vittima: VirtualAllocEx, WriteProcessMemory
5. Riprendi il thread caricando la libreria: ResumeThread

## Iniezione PE

Iniezione di Portable Execution: l'eseguibile verr√† scritto nella memoria del processo vittima e verr√† eseguito da l√¨.

## Process Hollowing

Il malware canceller√† il codice legittimo dalla memoria del processo e caricher√† un binario malevolo

1. Crea un nuovo processo: CreateProcess
2. Cancella la memoria: ZwUnmapViewOfSection, NtUnmapViewOfSection
3. Scrivi il binario malevolo nella memoria del processo: VirtualAllocEc, WriteProcessMemory
4. Imposta il punto di ingresso ed esegui: SetThreadContext, ResumeThread

# Hooking

* La **SSDT** (**System Service Descriptor Table**) punta alle funzioni del kernel (ntoskrnl.exe) o al driver GUI (win32k.sys) in modo che i processi utente possano chiamare queste funzioni.
* Un rootkit pu√≤ modificare questi puntatori a indirizzi che controlla.
* **IRP** (**I/O Request Packets**) trasmettono pezzi di dati da un componente all'altro. Quasi tutto nel kernel utilizza gli IRP e ogni oggetto dispositivo ha la propria tabella delle funzioni che possono essere hookate: DKOM (Direct Kernel Object Manipulation)
* L'**IAT** (**Import Address Table**) √® utile per risolvere le dipendenze. √à possibile hookare questa tabella per dirottare il codice che verr√† chiamato.
* **EAT**
* **Unisciti al** üí¨ [**gruppo Discord**](https://discord.gg/hRep4RUj7f) o al [**gruppo Telegram**](https://t.me/peass) o **seguici** su **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks_live)**.**
* **Condividi i tuoi trucchi di hacking inviando PR ai repository** [**HackTricks**](https://github.com/carlospolop/hacktricks) e [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) su GitHub.

</details>
