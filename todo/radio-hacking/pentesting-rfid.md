# Pentesting RFID

<details>

<summary><strong>Aprenda a hackear a AWS do zero ao her√≥i com</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Especialista em Equipe Vermelha AWS do HackTricks)</strong></a><strong>!</strong></summary>

* Voc√™ trabalha em uma **empresa de ciberseguran√ßa**? Gostaria de ver sua **empresa anunciada no HackTricks**? ou gostaria de ter acesso √† **√∫ltima vers√£o do PEASS ou baixar o HackTricks em PDF**? Confira os [**PLANOS DE ASSINATURA**](https://github.com/sponsors/carlospolop)!
* Descubra [**A Fam√≠lia PEASS**](https://opensea.io/collection/the-peass-family), nossa cole√ß√£o exclusiva de [**NFTs**](https://opensea.io/collection/the-peass-family)
* Adquira o [**swag oficial do PEASS & HackTricks**](https://peass.creator-spring.com)
* **Junte-se ao** [**üí¨**](https://emojipedia.org/speech-balloon/) [**grupo Discord**](https://discord.gg/hRep4RUj7f) ou ao [**grupo telegram**](https://t.me/peass) ou **siga-me** no **Twitter** üê¶[**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Compartilhe seus truques de hacking enviando PRs para o** [**reposit√≥rio hacktricks**](https://github.com/carlospolop/hacktricks) **e** [**reposit√≥rio hacktricks-cloud**](https://github.com/carlospolop/hacktricks-cloud).

</details>

## Introdu√ß√£o

**Identifica√ß√£o por Radiofrequ√™ncia (RFID)** √© a solu√ß√£o de r√°dio de curto alcance mais popular. Geralmente √© usada para armazenar e transmitir informa√ß√µes que identificam uma entidade.

Uma etiqueta RFID pode depender de **sua pr√≥pria fonte de energia (ativa)**, como uma bateria embutida, ou receber sua energia da antena de leitura usando a **corrente induzida pelas ondas de r√°dio recebidas** (**passiva**).

### Classes

A EPCglobal divide as etiquetas RFID em seis categorias. Uma etiqueta em cada categoria possui todas as capacidades listadas na categoria anterior, tornando-a compat√≠vel com vers√µes anteriores.

* As etiquetas da **Classe 0** s√£o etiquetas **passivas** que operam em bandas **UHF**. O fornecedor as **pr√©-programa** na f√°brica de produ√ß√£o. Como resultado, voc√™ **n√£o pode alterar** as informa√ß√µes armazenadas em sua mem√≥ria.
* As etiquetas da **Classe 1** tamb√©m podem operar em bandas **HF**. Al√©m disso, elas podem ser **gravadas apenas uma vez** ap√≥s a produ√ß√£o. Muitas etiquetas da Classe 1 tamb√©m podem processar **verifica√ß√µes de redund√¢ncia c√≠clica** (CRCs) dos comandos que recebem. Os CRCs s√£o alguns bytes extras no final dos comandos para detec√ß√£o de erros.
* As etiquetas da **Classe 2** podem ser **gravadas v√°rias vezes**.
* As etiquetas da **Classe 3** podem conter **sensores embutidos** que podem registrar par√¢metros ambientais, como a temperatura atual ou o movimento da etiqueta. Essas etiquetas s√£o **semi-passivas**, porque embora **tenham** uma fonte de energia embutida, como uma **bateria** integrada, elas **n√£o podem iniciar** a **comunica√ß√£o** sem fio com outras etiquetas ou leitores.
* As etiquetas da **Classe 4** podem iniciar a comunica√ß√£o com outras etiquetas da mesma classe, tornando-as etiquetas **ativas**.
* As etiquetas da **Classe 5** podem fornecer **energia para outras etiquetas e se comunicar com todas as classes de etiquetas anteriores**. As etiquetas da Classe 5 podem atuar como **leitores RFID**.

### Informa√ß√µes Armazenadas em Etiquetas RFID

A mem√≥ria de uma etiqueta RFID geralmente armazena quatro tipos de dados: os **dados de identifica√ß√£o**, que **identificam** a **entidade** √† qual a etiqueta est√° anexada (esses dados incluem campos definidos pelo usu√°rio, como contas banc√°rias); os **dados suplementares**, que fornecem **mais detalhes** sobre a entidade; os **dados de controle**, usados para a **configura√ß√£o interna** da etiqueta; e os **dados do fabricante** da etiqueta, que cont√™m um Identificador √önico da etiqueta (**UID**) e detalhes sobre a **produ√ß√£o**, **tipo** e **fornecedor** da etiqueta. Voc√™ encontrar√° os dois primeiros tipos de dados em todas as etiquetas comerciais; os dois √∫ltimos podem variar com base no fornecedor da etiqueta.

O padr√£o ISO especifica o valor do Identificador de Fam√≠lia de Aplicativos (**AFI**), um c√≥digo que indica o **tipo de objeto** ao qual a etiqueta pertence. Outro registro importante, tamb√©m especificado pela ISO, √© o Identificador de Formato de Armazenamento de Dados (**DSFID**), que define a **organiza√ß√£o l√≥gica dos dados do usu√°rio**.

A maioria dos **controles de seguran√ßa** de RFID possui mecanismos que **restringem** as opera√ß√µes de **leitura** ou **grava√ß√£o** em cada bloco de mem√≥ria do usu√°rio e nos registros especiais que cont√™m os valores AFI e DSFID. Esses **mecanismos de bloqueio** usam dados armazenados na mem√≥ria de controle e t√™m **senhas padr√£o** pr√©-configuradas pelo fornecedor, mas permitem que os propriet√°rios da etiqueta **configurem senhas personalizadas**.

### Compara√ß√£o de etiquetas de baixa e alta frequ√™ncia

<figure><img src="../../.gitbook/assets/image (27).png" alt=""><figcaption></figcaption></figure>

## Etiquetas RFID de Baixa Frequ√™ncia (125kHz)

As **etiquetas de baixa frequ√™ncia** s√£o frequentemente usadas em sistemas que **n√£o requerem alta seguran√ßa**: acesso a edif√≠cios, chaves de intercomunica√ß√£o, cart√µes de associa√ß√£o de academia, etc. Devido ao seu alcance maior, s√£o convenientes para uso em estacionamentos pagos: o motorista n√£o precisa aproximar o cart√£o do leitor, pois ele √© acionado de longe. Ao mesmo tempo, as etiquetas de baixa frequ√™ncia s√£o muito primitivas, t√™m uma baixa taxa de transfer√™ncia de dados. Por esse motivo, √© imposs√≠vel implementar uma transfer√™ncia de dados bidirecional complexa para coisas como manter o saldo e criptografia. As etiquetas de baixa frequ√™ncia apenas transmitem seu ID curto sem nenhum meio de autentica√ß√£o.

Esses dispositivos dependem da tecnologia **RFID passiva** e operam em uma **faixa de 30 kHz a 300 kHz**, embora seja mais comum usar 125 kHz a 134 kHz:

* **Alcance Longo** ‚Äî a frequ√™ncia mais baixa se traduz em maior alcance. Existem alguns leitores EM-Marin e HID, que funcionam a uma dist√¢ncia de at√© um metro. Eles s√£o frequentemente usados em estacionamentos.
* **Protocolo primitivo** ‚Äî devido √† baixa taxa de transfer√™ncia de dados, essas etiquetas s√≥ podem transmitir seu ID curto. Na maioria dos casos, os dados n√£o s√£o autenticados e n√£o s√£o protegidos de forma alguma. Assim que o cart√£o est√° dentro do alcance do leitor, ele come√ßa a transmitir seu ID.
* **Baixa seguran√ßa** ‚Äî esses cart√µes podem ser facilmente copiados, ou at√© mesmo lidos do bolso de outra pessoa devido √† primitividade do protocolo.

**Protocolos populares de 125 kHz:**

* **EM-Marin** ‚Äî EM4100, EM4102. O protocolo mais popular na CEI. Pode ser lido a cerca de um metro de dist√¢ncia devido √† sua simplicidade e estabilidade.
* **HID Prox II** ‚Äî protocolo de baixa frequ√™ncia introduzido pela HID Global. Este protocolo √© mais popular nos pa√≠ses ocidentais. √â mais complexo e os cart√µes e leitores para este protocolo s√£o relativamente caros.
* **Indala** ‚Äî protocolo de baixa frequ√™ncia muito antigo introduzido pela Motorola e posteriormente adquirido pela HID. √â menos prov√°vel que voc√™ encontre isso na natureza em compara√ß√£o com os dois anteriores, pois est√° caindo em desuso.

Na realidade, existem muitos mais protocolos de baixa frequ√™ncia. Mas todos eles usam a mesma modula√ß√£o na camada f√≠sica e podem ser considerados, de uma forma ou de outra, uma varia√ß√£o dos listados acima.

### Ataque

Voc√™ pode **atacar essas Etiquetas com o Flipper Zero**:

{% content-ref url="flipper-zero/fz-125khz-rfid.md" %}
[fz-125khz-rfid.md](flipper-zero/fz-125khz-rfid.md)
{% endcontent-ref %}

## Etiquetas RFID de Alta Frequ√™ncia (13,56 MHz)

As **etiquetas de alta frequ√™ncia** s√£o usadas para uma intera√ß√£o mais complexa entre leitor e etiqueta quando √© necess√°rio criptografia, uma grande transfer√™ncia de dados bidirecional, autentica√ß√£o, etc.\
Geralmente s√£o encontradas em cart√µes banc√°rios, transporte p√∫blico e outras passagens seguras.

**As etiquetas de alta frequ√™ncia de 13,56 MHz s√£o um conjunto de padr√µes e protocolos**. Geralmente s√£o referidas como [NFC](https://nfc-forum.org/what-is-nfc/about-the-technology/), mas nem sempre √© correto. O conjunto b√°sico de protocolos usado nos n√≠veis f√≠sico e l√≥gico √© o ISO 14443. Protocolos de alto n√≠vel, bem como padr√µes alternativos (como o ISO 19092), s√£o baseados nele. Muitas pessoas se referem a essa tecnologia como **Near Field Communication (NFC)**, um termo para dispositivos que operam na frequ√™ncia de 13,56 MHz.

<figure><img src="../../.gitbook/assets/image (22).png" alt=""><figcaption></figcaption></figure>

Para simplificar, a arquitetura do NFC funciona assim: o protocolo de transmiss√£o √© escolhido pela empresa que fabrica os cart√µes e implementado com base no padr√£o ISO 14443 de baixo n√≠vel. Por exemplo, a NXP inventou seu pr√≥prio protocolo de transmiss√£o de alto n√≠vel chamado Mifare. Mas em um n√≠vel mais baixo, os cart√µes Mifare s√£o baseados no padr√£o ISO 14443-A.

O Flipper pode interagir tanto com o protocolo de baixo n√≠vel ISO 14443, quanto com o protocolo de transfer√™ncia de dados Mifare Ultralight e EMV usado em cart√µes banc√°rios. Estamos trabalhando para adicionar suporte ao Mifare Classic e NFC NDEF. Uma an√°lise detalhada dos protocolos e padr√µes que comp√µem o NFC vale um artigo separado que planejamos publicar posteriormente.

Todos os cart√µes de alta frequ√™ncia baseados no padr√£o ISO 14443-A t√™m um ID de chip √∫nico. Ele atua como o n√∫mero de s√©rie do cart√£o, como o endere√ßo MAC de um cart√£o de rede. **Normalmente, o UID tem 4 ou 7 bytes de comprimento**, mas raramente pode chegar a **10**. Os UIDs n√£o s√£o um segredo e s√£o facilmente leg√≠veis, **√†s vezes at√© impressos no pr√≥prio cart√£o**.

Existem muitos sistemas de controle de acesso que dependem do UID para **autenticar e conceder acesso**. √Äs vezes isso acontece **mesmo** quando as etiquetas RFID **suportam criptografia**. Esse **uso indevido** as coloca no mesmo n√≠vel das **etiquetas de 125 kHz** em termos de **seguran√ßa**. Cart√µes virtuais (como o Apple Pay) usam um UID din√¢mico para que os propriet√°rios de telefones n√£o saiam abrindo portas com seu aplicativo de pagamento.

* **Curto alcance** ‚Äî os cart√µes de alta frequ√™ncia s√£o projetados especificamente para serem colocados perto do leitor. Isso tamb√©m ajuda a proteger o cart√£o de intera√ß√µes n√£o autorizadas. A dist√¢ncia m√°xima de leitura que conseguimos alcan√ßar foi de cerca de 15 cm, e isso foi com leitores de longo alcance feitos sob medida.
* **Protocolos avan√ßados** ‚Äî velocidades de transfer√™ncia de dados de at√© 424 kbps permitem protocolos complexos com transfer√™ncia de dados bidirecional completa. O que, por sua vez, **permite criptografia**, transfer√™ncia de dados, etc.
* **Alta seguran√ßa** ‚Äî os cart√µes sem contato de alta frequ√™ncia n√£o s√£o de forma alguma inferiores aos cart√µes inteligentes. Existem cart√µes que suportam algoritmos criptograficamente fortes como AES e implementam criptografia assim√©trica.

### Ataque

Voc√™ pode **atacar essas Etiquetas com o Flipper Zero**:

{% content-ref url="flipper-zero/fz-nfc.md" %}
[fz-nfc.md](flipper-zero/fz-nfc.md)
{% endcontent-ref %}

Ou usando o **proxmark**:

{% content-ref url="proxmark-3.md" %}
[proxmark-3.md](proxmark-3.md)
{% endcontent-ref %}

## Refer√™ncias

* [https://blog.flipperzero.one/rfid/](https://blog.flipperzero.one/rfid/)
