# Pentesting BLE - Bluetooth Low Energy

<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>

## Einf√ºhrung

Seit der Bluetooth 4.0-Spezifikation verwendet BLE nur 40 Kan√§le im Bereich von 2400 bis 2483,5 MHz. Im Gegensatz dazu verwendet herk√∂mmliches Bluetooth 79 Kan√§le in diesem Bereich.

BLE-Ger√§te kommunizieren, indem sie **Werbe-Pakete** (**Beacons**) senden, die die Existenz des BLE-Ger√§ts anderen nahegelegenen Ger√§ten mitteilen. Diese Beacons senden manchmal auch **Daten**.

Das empfangende Ger√§t, auch Zentralger√§t genannt, kann auf ein Werbepaket mit einer **SCAN-Anforderung** antworten, die speziell an das werbende Ger√§t gesendet wird. Die **Antwort** auf diesen Scan verwendet die gleiche Struktur wie das **Werbe**-Paket mit zus√§tzlichen Informationen, die nicht in der urspr√ºnglichen Werbe-Anfrage enthalten waren, wie z.B. der vollst√§ndige Ger√§tename.

![](<../../.gitbook/assets/image (152).png>)

Das Pr√§ambelbyte synchronisiert die Frequenz, w√§hrend die vier Byte lange Zugriffsadresse ein **Verbindungsidentifikator** ist, der in Szenarien verwendet wird, in denen mehrere Ger√§te versuchen, Verbindungen auf denselben Kan√§len herzustellen. Als N√§chstes enth√§lt die Protocol Data Unit (**PDU**) die **Werbedaten**. Es gibt mehrere Arten von PDU; die am h√§ufigsten verwendeten sind ADV\_NONCONN\_IND und ADV\_IND. Ger√§te verwenden den PDU-Typ **ADV\_NONCONN\_IND**, wenn sie **keine Verbindungen akzeptieren**, und √ºbertragen Daten nur im Werbepaket. Ger√§te verwenden **ADV\_IND**, wenn sie **Verbindungen zulassen** und nachdem eine **Verbindung hergestellt** wurde, keine Werbepakete mehr senden.

### GATT

Das **Generic Attribute Profile** (GATT) definiert, wie das **Ger√§t Daten formatieren und √ºbertragen soll**. Bei der Analyse der Angriffsfl√§che eines BLE-Ger√§ts konzentrieren Sie sich oft auf das GATT (oder GATTs), da es ausl√∂st, wie die **Ger√§tefunktionalit√§t ausgel√∂st wird** und wie Daten gespeichert, gruppiert und ge√§ndert werden. Das GATT listet die Merkmale, Deskriptoren und Dienste eines Ger√§ts in einer Tabelle als 16- oder 32-Bit-Werte auf. Ein **Merkmal** ist ein **Datenwert**, der zwischen dem Zentralger√§t und dem Peripherieger√§t **gesendet** wird. Diese Merkmale k√∂nnen **Deskriptoren** haben, die **zus√§tzliche Informationen √ºber sie bereitstellen**. **Merkmale** sind oft in **Diensten** gruppiert, wenn sie mit der Ausf√ºhrung einer bestimmten Aktion zusammenh√§ngen.

## Enumeration
```bash
hciconfig #Check config, check if UP or DOWN
# If DOWN try:
sudo modprobe -c bluetooth
sudo hciconfig hci0 down && sudo hciconfig hci0 up

# Spoof MAC
spooftooph -i hci0 -a 11:22:33:44:55:66
```
### GATTool

**GATTool** erm√∂glicht es, eine Verbindung zu einem anderen Ger√§t herzustellen, die Eigenschaften dieses Ger√§ts aufzulisten und seine Attribute zu lesen und zu schreiben.\
GATTTool kann eine interaktive Shell mit der Option `-I` starten:
```bash
gatttool -i hci0 -I
[ ][LE]> connect 24:62:AB:B1:A8:3E Attempting to connect to A4:CF:12:6C:B3:76 Connection successful
[A4:CF:12:6C:B3:76][LE]> characteristics
handle: 0x0002, char properties: 0x20, char value handle:
0x0003, uuid: 00002a05-0000-1000-8000-00805f9b34fb
handle: 0x0015, char properties: 0x02, char value handle:
0x0016, uuid: 00002a00-0000-1000-8000-00805f9b34fb
[...]

# Write data
gatttool -i <Bluetooth adapter interface> -b <MAC address of device> --char-write-req <characteristic handle> -n <value>
gatttool -b a4:cf:12:6c:b3:76 --char-write-req -a 0x002e -n $(echo -n "04dc54d9053b4307680a"|xxd -ps)

# Read data
gatttool -i <Bluetooth adapter interface> -b <MAC address of device> --char-read -a 0x16

# Read connecting with an authenticated encrypted connection
gatttool --sec-level=high -b a4:cf:12:6c:b3:76 --char-read -a 0x002c
```
### Bettercap
```bash
# Start listening for beacons
sudo bettercap --eval "ble.recon on"
# Wait some time
>> ble.show # Show discovered devices
>> ble.enum <mac addr> # This will show the service, characteristics and properties supported

# Write data in a characteristic
>> ble.write <MAC ADDR> <UUID> <HEX DATA>
>> ble.write <mac address of device> ff06 68656c6c6f # Write "hello" in ff06
```
<details>

<summary><strong>Erlernen Sie AWS-Hacking von Null auf Held mit</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (HackTricks AWS Red Team Expert)</strong></a><strong>!</strong></summary>

Andere M√∂glichkeiten, HackTricks zu unterst√ºtzen:

* Wenn Sie Ihr **Unternehmen in HackTricks beworben sehen m√∂chten** oder **HackTricks im PDF-Format herunterladen m√∂chten**, √ºberpr√ºfen Sie die [**ABONNEMENTPL√ÑNE**](https://github.com/sponsors/carlospolop)!
* Holen Sie sich das [**offizielle PEASS & HackTricks-Merchandise**](https://peass.creator-spring.com)
* Entdecken Sie [**The PEASS Family**](https://opensea.io/collection/the-peass-family), unsere Sammlung exklusiver [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Treten Sie der** üí¨ [**Discord-Gruppe**](https://discord.gg/hRep4RUj7f) oder der [**Telegram-Gruppe**](https://t.me/peass) bei oder **folgen** Sie uns auf **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Teilen Sie Ihre Hacking-Tricks, indem Sie PRs an die** [**HackTricks**](https://github.com/carlospolop/hacktricks) und [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) GitHub-Repositories einreichen.

</details>
