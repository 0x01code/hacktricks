# Pentester BLE - Bluetooth Low Energy

<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

Autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop)!
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) d√©p√¥ts GitHub.

</details>

## Introduction

Disponible depuis la sp√©cification Bluetooth 4.0, le BLE utilise uniquement 40 canaux, couvrant la plage de 2400 √† 2483,5 MHz. En revanche, le Bluetooth traditionnel utilise 79 canaux dans la m√™me plage.

Les appareils BLE communiquent en envoyant des **paquets publicitaires** (**balises**), ces paquets diffusent l'existence de l'appareil BLE √† d'autres appareils √† proximit√©. Ces balises envoient parfois aussi des **donn√©es**.

Le dispositif d'√©coute, √©galement appel√© dispositif central, peut r√©pondre √† un paquet publicitaire avec une **demande de SCAN** envoy√©e sp√©cifiquement √† l'appareil publicitaire. La **r√©ponse** √† ce scan utilise la m√™me structure que le **paquet publicitaire** avec des informations suppl√©mentaires qui n'ont pas pu √™tre incluses dans la demande publicitaire initiale, telles que le nom complet de l'appareil.

![](<../../.gitbook/assets/image (152).png>)

L'octet de pr√©ambule synchronise la fr√©quence, tandis que l'adresse d'acc√®s sur quatre octets est un **identifiant de connexion**, utilis√© dans les sc√©narios o√π plusieurs appareils tentent d'√©tablir des connexions sur les m√™mes canaux. Ensuite, l'Unit√© de Donn√©es de Protocole (**PDU**) contient les **donn√©es publicitaires**. Il existe plusieurs types de PDU ; les plus couramment utilis√©s sont ADV\_NONCONN\_IND et ADV\_IND. Les appareils utilisent le type de PDU **ADV\_NONCONN\_IND** s'ils **n'acceptent pas les connexions**, transmettant des donn√©es uniquement dans le paquet publicitaire. Les appareils utilisent **ADV\_IND** s'ils **autorisent les connexions** et **arr√™tent d'envoyer des paquets publicitaires** une fois qu'une **connexion** a √©t√© **√©tablie**.

### GATT

Le **Profil d'Attribut G√©n√©rique** (GATT) d√©finit comment le **dispositif doit formater et transf√©rer les donn√©es**. Lorsque vous analysez la surface d'attaque d'un appareil BLE, vous concentrerez souvent votre attention sur le GATT (ou les GATTs), car c'est ainsi que la **fonctionnalit√© de l'appareil est d√©clench√©e** et comment les donn√©es sont stock√©es, regroup√©es et modifi√©es. Le GATT r√©pertorie les caract√©ristiques, descripteurs et services d'un appareil dans un tableau sous forme de valeurs de 16 ou 32 bits. Une **caract√©ristique** est une **valeur de donn√©es** **envoy√©e** entre le dispositif central et p√©riph√©rique. Ces caract√©ristiques peuvent avoir des **descripteurs** qui **fournissent des informations suppl√©mentaires √† leur sujet**. Les **caract√©ristiques** sont souvent **regroup√©es** dans des **services** s'ils sont li√©s √† l'ex√©cution d'une action particuli√®re.

## √ânum√©ration
```bash
hciconfig #Check config, check if UP or DOWN
# If DOWN try:
sudo modprobe -c bluetooth
sudo hciconfig hci0 down && sudo hciconfig hci0 up

# Spoof MAC
spooftooph -i hci0 -a 11:22:33:44:55:66
```
### GATTool

**GATTool** permet d'**√©tablir** une **connexion** avec un autre appareil, d'afficher les **caract√©ristiques** de cet appareil, et de lire et √©crire ses attributs.\
GATTTool peut lancer un shell interactif avec l'option `-I` :
```bash
gatttool -i hci0 -I
[ ][LE]> connect 24:62:AB:B1:A8:3E Attempting to connect to A4:CF:12:6C:B3:76 Connection successful
[A4:CF:12:6C:B3:76][LE]> characteristics
handle: 0x0002, char properties: 0x20, char value handle:
0x0003, uuid: 00002a05-0000-1000-8000-00805f9b34fb
handle: 0x0015, char properties: 0x02, char value handle:
0x0016, uuid: 00002a00-0000-1000-8000-00805f9b34fb
[...]

# Write data
gatttool -i <Bluetooth adapter interface> -b <MAC address of device> --char-write-req <characteristic handle> -n <value>
gatttool -b a4:cf:12:6c:b3:76 --char-write-req -a 0x002e -n $(echo -n "04dc54d9053b4307680a"|xxd -ps)

# Read data
gatttool -i <Bluetooth adapter interface> -b <MAC address of device> --char-read -a 0x16

# Read connecting with an authenticated encrypted connection
gatttool --sec-level=high -b a4:cf:12:6c:b3:76 --char-read -a 0x002c
```
### Bettercap
```bash
# Start listening for beacons
sudo bettercap --eval "ble.recon on"
# Wait some time
>> ble.show # Show discovered devices
>> ble.enum <mac addr> # This will show the service, characteristics and properties supported

# Write data in a characteristic
>> ble.write <MAC ADDR> <UUID> <HEX DATA>
>> ble.write <mac address of device> ff06 68656c6c6f # Write "hello" in ff06
```
<details>

<summary><strong>Apprenez le piratage AWS de z√©ro √† h√©ros avec</strong> <a href="https://training.hacktricks.xyz/courses/arte"><strong>htARTE (Expert de l'√©quipe rouge AWS de HackTricks)</strong></a><strong>!</strong></summary>

D'autres fa√ßons de soutenir HackTricks :

* Si vous souhaitez voir votre **entreprise annonc√©e dans HackTricks** ou **t√©l√©charger HackTricks en PDF**, consultez les [**PLANS D'ABONNEMENT**](https://github.com/sponsors/carlospolop) !
* Obtenez le [**swag officiel PEASS & HackTricks**](https://peass.creator-spring.com)
* D√©couvrez [**La famille PEASS**](https://opensea.io/collection/the-peass-family), notre collection exclusive de [**NFTs**](https://opensea.io/collection/the-peass-family)
* **Rejoignez le** üí¨ [**groupe Discord**](https://discord.gg/hRep4RUj7f) ou le [**groupe Telegram**](https://t.me/peass) ou **suivez-nous** sur **Twitter** üê¶ [**@carlospolopm**](https://twitter.com/hacktricks\_live)**.**
* **Partagez vos astuces de piratage en soumettant des PR aux** [**HackTricks**](https://github.com/carlospolop/hacktricks) et [**HackTricks Cloud**](https://github.com/carlospolop/hacktricks-cloud) github repos.

</details>
